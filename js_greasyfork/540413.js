// ==UserScript==
// @name         ğŸš€ ğŸ¬ Enhanced Twitter Media Downloader | æ¨ç‰¹åª’ä½“ä¸‹è½½å™¨
// @name:ar      ğŸš€ ğŸ¬ Ù…Ø­Ø³Ù† ØªÙ†Ø²ÙŠÙ„ ÙˆØ³Ø§Ø¦Ø· ØªÙˆÙŠØªØ± | ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„ØµÙˆØ±Ø© Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø©
// @name:bg      ğŸš€ ğŸ¬ ĞŸĞ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½ Twitter Media Downloader | HD Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
// @name:ckb     ğŸš€ ğŸ¬ Ù¾Û•ÛŒØ´Ú©Û•ÙˆØªÙˆÙˆÛŒ Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ù…ÛŒØ¯ÛŒØ§ÛŒ ØªÙˆÛŒØªÛ•Ø± | Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ú¤ÛŒØ¯ÛŒÛ† Ùˆ ÙˆÛÙ†Û•ÛŒ HD
// @name:cs      ğŸš€ ğŸ¬ VylepÅ¡enÃ½ Twitter Media Downloader | HD video a obrÃ¡zky
// @name:da      ğŸš€ ğŸ¬ Forbedret Twitter Media Downloader | HD video og billeder
// @name:de      ğŸš€ ğŸ¬ Verbesserter Twitter Media Downloader | HD Video und Bilder
// @name:el      ğŸš€ ğŸ¬ Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î¿Ï‚ Twitter Media Downloader | HD Î²Î¯Î½Ï„ÎµÎ¿ ÎºÎ±Î¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚
// @name:en      ğŸš€ ğŸ¬ Enhanced Twitter Media Downloader | HD Video&Image Download
// @name:eo      ğŸš€ ğŸ¬ Plibonigita Twitter Media Downloader | HD video kaj bildoj
// @name:es      ğŸš€ ğŸ¬ Descargador Mejorado de Twitter | Descarga HD de Video e Imagen
// @name:es-419  ğŸš€ ğŸ¬ Descargador Mejorado de Twitter | Descarga HD de Video e Imagen
// @name:fi      ğŸš€ ğŸ¬ Parannettu Twitter Media Downloader | HD video ja kuvat
// @name:fr      ğŸš€ ğŸ¬ TÃ©lÃ©chargeur Twitter AmÃ©liorÃ© | VidÃ©o et Image HD
// @name:fr-CA   ğŸš€ ğŸ¬ TÃ©lÃ©chargeur Twitter AmÃ©liorÃ© | VidÃ©o et Image HD
// @name:he      ğŸš€ ğŸ¬ ××•×¨×“ ××“×™×” ××˜×•×•×™×˜×¨ ××©×•×¤×¨ | ×•×™×“××• ×•×ª××•× ×” ×‘××™×›×•×ª HD
// @name:hr      ğŸš€ ğŸ¬ PoboljÅ¡ani Twitter Media Downloader | HD video i slike
// @name:hu      ğŸš€ ğŸ¬ Fejlett Twitter Media Downloader | HD videÃ³ Ã©s kÃ©pek
// @name:id      ğŸš€ ğŸ¬ Twitter Media Downloader Ditingkatkan | Video dan Gambar HD
// @name:it      ğŸš€ ğŸ¬ Twitter Media Downloader Migliorato | Video e Immagini HD
// @name:ja      ğŸš€ ğŸ¬ Enhanced Twitter ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ | HDå‹•ç”»ãƒ»ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
// @name:ka      ğŸš€ ğŸ¬ áƒ’áƒáƒ£áƒ›áƒ¯áƒáƒ‘áƒ”áƒ¡áƒ”áƒ‘áƒ£áƒšáƒ˜ Twitter Media Downloader | HD áƒ•áƒ˜áƒ“áƒ”áƒ áƒ“áƒ áƒ¡áƒ£áƒ áƒáƒ—áƒ”áƒ‘áƒ˜
// @name:ko      ğŸš€ ğŸ¬ í–¥ìƒëœ Twitter ë¯¸ë””ì–´ ë‹¤ìš´ë¡œë” | HD ë¹„ë””ì˜¤ ë° ì´ë¯¸ì§€
// @name:nb      ğŸš€ ğŸ¬ Forbedret Twitter Media Downloader | HD video og bilder
// @name:nl      ğŸš€ ğŸ¬ Verbeterde Twitter Media Downloader | HD video en afbeeldingen
// @name:pl      ğŸš€ ğŸ¬ Ulepszony Twitter Media Downloader | HD wideo i obrazy
// @name:pt-BR   ğŸš€ ğŸ¬ Baixador Aprimorado do Twitter | Download HD de VÃ­deo e Imagem
// @name:ro      ğŸš€ ğŸ¬ Twitter Media Downloader ÃmbunÄƒtÄƒÈ›it | Video È™i imagini HD
// @name:ru      ğŸš€ ğŸ¬ Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Twitter Media Downloader | HD Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
// @name:sk      ğŸš€ ğŸ¬ VylepÅ¡enÃ½ Twitter Media Downloader | HD video a obrÃ¡zky
// @name:sr      ğŸš€ ğŸ¬ PoboljÅ¡ani Twitter Media Downloader | HD video i slike
// @name:sv      ğŸš€ ğŸ¬ FÃ¶rbÃ¤ttrad Twitter Media Downloader | HD video och bilder
// @name:th      ğŸš€ ğŸ¬ Twitter Media Downloader à¸—à¸µà¹ˆà¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¹à¸¥à¹‰à¸§ | à¸§à¸´à¸”à¸µà¹‚à¸­à¹à¸¥à¸°à¸£à¸¹à¸›à¸ à¸²à¸ HD
// @name:tr      ğŸš€ ğŸ¬ GeliÅŸtirilmiÅŸ Twitter Medya Ä°ndirici | HD Video ve Resim
// @name:uk      ğŸš€ ğŸ¬ ĞŸĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¹ Twitter Media Downloader | HD Ğ²Ñ–Ğ´ĞµĞ¾ Ñ‚Ğ° Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ
// @name:ug      ğŸš€ ğŸ¬ ØªÛ•Ø±Û•Ù‚Ù‚Ù‰ÙŠ Ù‚Ù‰Ù„ØºØ§Ù† Twitter Media Downloader | HD Ø³Ù‰Ù† Û‹Û• Ø±Û•Ø³Ù‰Ù…
// @name:vi      ğŸš€ ğŸ¬ TrÃ¬nh Táº£i Twitter Media NÃ¢ng Cao | Video vÃ  HÃ¬nh áº¢nh HD
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description        ğŸ¬ Twitter/Xå¹³å°ä¸“ä¸šåª’ä½“ä¸‹è½½å™¨ï¼ğŸ“± ä¸€é”®ä¸‹è½½é«˜æ¸…è§†é¢‘å’Œå›¾ç‰‡ï¼Œæ”¯æŒæ¨æ–‡æ—¶é—´çº¿ã€è§†é¢‘æ’­æ”¾å™¨ã€å›¾ç‰‡æ¨¡æ€æ¡†å¤šä½ç½®ä¸‹è½½æŒ‰é’® ğŸ”¥ è‡ªåŠ¨è·å–æœ€é«˜ç”»è´¨ï¼Œæ‰¹é‡ä¸‹è½½ï¼Œå®Œå…¨å…è´¹æ— å¹¿å‘Š âœ¨
// @description:ar     ğŸ¬ Ù…Ù†Ø²Ù„ ÙˆØ³Ø§Ø¦Ø· Twitter/X Ø§Ù„Ù…Ù‡Ù†ÙŠ! ğŸ“± ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„ØµÙˆØ± Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¯Ù‚Ø© Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØºØ±ÙŠØ¯Ø§Øª ÙˆÙ…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆÙ†Ø§ÙØ°Ø© Ø§Ù„ØµÙˆØ±Ø© ğŸ”¥ Ø§Ù„Ø­ØµÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©ØŒ Ø¯Ø¹Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…Ø¹ØŒ Ù…Ø¬Ø§Ù†ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª âœ¨
// @description:bg     ğŸ¬ ĞŸÑ€Ğ¾Ñ„ĞµÑĞ¸Ğ¾Ğ½Ğ°Ğ»ĞµĞ½ Ğ¸Ğ·Ñ‚ĞµĞ³Ğ»ÑÑ‰ Ğ·Ğ° Twitter/X Ğ¼ĞµĞ´Ğ¸Ñ! ğŸ“± Ğ•Ğ´Ğ½Ğ¾ ĞºĞ»Ğ¸ĞºĞ²Ğ°Ğ½Ğµ Ğ·Ğ° Ğ¸Ğ·Ñ‚ĞµĞ³Ğ»ÑĞ½Ğµ Ğ½Ğ° HD Ğ²Ğ¸Ğ´ĞµĞ¾ĞºĞ»Ğ¸Ğ¿Ğ¾Ğ²Ğµ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ Ğ±ÑƒÑ‚Ğ¾Ğ½Ğ¸ Ğ·Ğ° Ğ¸Ğ·Ñ‚ĞµĞ³Ğ»ÑĞ½Ğµ Ğ² Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸ÑÑ‚Ğ° Ğ½Ğ° Ñ‚ÑƒĞ¸Ñ‚Ğ¾Ğ²ĞµÑ‚Ğµ, Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¿Ğ»ĞµĞ¹ÑŠÑ€Ğ° Ğ¸ Ğ¼Ğ¾Ğ´Ğ°Ğ»Ğ½Ğ¾Ñ‚Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ğŸ”¥ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ½Ğ°Ğ¹-Ğ²Ğ¸ÑĞ¾ĞºĞ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾, Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ° Ğ·Ğ° Ğ¿Ğ°ĞºĞµÑ‚Ğ½Ğ¾ Ğ¸Ğ·Ñ‚ĞµĞ³Ğ»ÑĞ½Ğµ, Ğ½Ğ°Ğ¿ÑŠĞ»Ğ½Ğ¾ Ğ±ĞµĞ·Ğ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ¸ Ğ±ĞµĞ· Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ¸ âœ¨
// @description:ckb    ğŸ¬ Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ù¾ÛŒØ´Û•ÛŒÛŒ Ù…ÛŒØ¯ÛŒØ§ÛŒ Twitter/X! ğŸ“± Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ ÛŒÛ•Ú© Ú©Ù„ÛŒÚ© Ø¨Û† Ú¤ÛŒØ¯ÛŒÛ† Ùˆ ÙˆÛÙ†Û•Ú©Ø§Ù†ÛŒ HD Ù„Û•Ú¯Û•Úµ Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†ÛŒ Ø¯Ø§Ú¯Ø±ØªÙ† Ù„Û• Ú©Ø§ØªÛŒ ØªÙˆÛŒØªÛ•Ú©Ø§Ù†ØŒ Ù„ÛØ¯Û•Ø±ÛŒ Ú¤ÛŒØ¯ÛŒÛ† Ùˆ Ù…Û†Ø¯Ø§Ù„ÛŒ ÙˆÛÙ†Û• ğŸ”¥ Ø¨Û•Ø¯Û•Ø³ØªÙ‡ÛÙ†Ø§Ù†ÛŒ Ø¦Û†ØªÛ†Ù…Ø§ØªÛŒÚ©ÛŒ Ø¨Ø§ÚµØ§ØªØ±ÛŒÙ† Ú©ÙˆØ§Ù„ÛŒØªÛŒØŒ Ù¾Ø´ØªÚ¯ÛŒØ±ÛŒ Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒØŒ ØªÛ•ÙˆØ§Ùˆ Ø®Û†Ú•Ø§ÛŒÛŒ Ùˆ Ø¨Û•Ø¨Û Ú•ÛŒÚ©Ù„Ø§Ù… âœ¨
// @description:cs     ğŸ¬ ProfesionÃ¡lnÃ­ stahovÃ¡nÃ­ mÃ©diÃ­ Twitter/X! ğŸ“± Jedno kliknutÃ­ ke staÅ¾enÃ­ HD videÃ­ a obrÃ¡zkÅ¯ s tlaÄÃ­tky stahovÃ¡nÃ­ na ÄasovÃ© ose tweetÅ¯, video pÅ™ehrÃ¡vaÄi a modÃ¡lnÃ­m oknÄ› obrÃ¡zku ğŸ”¥ AutomatickÃ© zÃ­skÃ¡nÃ­ nejvyÅ¡Å¡Ã­ kvality, podpora dÃ¡vkovÃ©ho stahovÃ¡nÃ­, zcela zdarma bez reklam âœ¨
// @description:da     ğŸ¬ Professionel Twitter/X mediedownloader! ğŸ“± Et-klik download af HD-videoer og billeder med download-knapper i tweet-timeline, videoafspiller og billedmodal ğŸ”¥ Automatisk hentning af hÃ¸jeste kvalitet, understÃ¸ttelse af batch-download, helt gratis uden annoncer âœ¨
// @description:de     ğŸ¬ Professioneller Twitter/X Medien-Downloader! ğŸ“± Ein-Klick-Download von HD-Videos und Bildern mit Download-Buttons in Tweet-Timeline, Video-Player und Bild-Modal ğŸ”¥ Automatische Erfassung hÃ¶chster QualitÃ¤t, Batch-Download-UnterstÃ¼tzung, vÃ¶llig kostenlos ohne Werbung âœ¨
// @description:el     ğŸ¬ Î•Ï€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¹ÎºÏŒÏ‚ downloader Î¼Î­ÏƒÏ‰Î½ Twitter/X! ğŸ“± Î›Î®ÏˆÎ· Î¼Îµ Î­Î½Î± ÎºÎ»Î¹Îº HD Î²Î¯Î½Ï„ÎµÎ¿ ÎºÎ±Î¹ ÎµÎ¹ÎºÏŒÎ½Ï‰Î½ Î¼Îµ ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Î»Î®ÏˆÎ·Ï‚ ÏƒÏ„Î· Ï‡ÏÎ¿Î½Î¿ÏƒÎµÎ¹ÏÎ¬ tweet, Î²Î¯Î½Ï„ÎµÎ¿ player ÎºÎ±Î¹ modal ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ ğŸ”¥ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î»Î®ÏˆÎ· Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ·Ï‚ Ï€Î¿Î¹ÏŒÏ„Î·Ï„Î±Ï‚, Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· batch Î»Î®ÏˆÎ·Ï‚, ÎµÎ½Ï„ÎµÎ»ÏÏ‚ Î´Ï‰ÏÎµÎ¬Î½ Ï‡Ï‰ÏÎ¯Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¯ÏƒÎµÎ¹Ï‚ âœ¨
// @description:en     ğŸ¬ Professional Twitter/X media downloader! ğŸ“± One-click download HD videos and images with download buttons in tweet timeline, video player, and image modal ğŸ”¥ Auto-fetch highest quality, batch download support, completely free & no ads âœ¨
// @description:eo     ğŸ¬ Profesia Twitter/X aÅ­dvidaÄµa elÅutilo! ğŸ“± Unu-klaka elÅuto de HD videoj kaj bildoj kun elÅutaj butonoj en tweet-kronologio, video-ludilo kaj bild-modalo ğŸ”¥ AÅ­tomata akiro de plej alta kvalito, subteno por amasa elÅuto, tute senpaga sen reklamoj âœ¨
// @description:es     ğŸ¬ Â¡Descargador profesional de medios de Twitter/X! ğŸ“± Descarga con un clic videos HD e imÃ¡genes con botones de descarga en lÃ­nea de tiempo de tweets, reproductor de video y modal de imagen ğŸ”¥ ObtenciÃ³n automÃ¡tica de mÃ¡xima calidad, soporte de descarga por lotes, completamente gratis sin anuncios âœ¨
// @description:es-419 ğŸ¬ Â¡Descargador profesional de medios de Twitter/X! ğŸ“± Descarga con un clic videos HD e imÃ¡genes con botones de descarga en lÃ­nea de tiempo de tweets, reproductor de video y modal de imagen ğŸ”¥ ObtenciÃ³n automÃ¡tica de mÃ¡xima calidad, soporte de descarga por lotes, completamente gratis sin anuncios âœ¨
// @description:fi     ğŸ¬ Ammattimainen Twitter/X median latausohjelma! ğŸ“± Yhden klikkauksen HD-videoiden ja kuvien lataus latausnappe illa tweet-aikajanalla, videosoittimessa ja kuvamodaalissa ğŸ”¥ Automaattinen korkein laadun haku, erÃ¤lataustuki, tÃ¤ysin ilmainen ilman mainoksia âœ¨
// @description:fr     ğŸ¬ TÃ©lÃ©chargeur professionnel de mÃ©dias Twitter/X ! ğŸ“± TÃ©lÃ©chargement en un clic de vidÃ©os HD et d'images avec des boutons de tÃ©lÃ©chargement dans la timeline des tweets, le lecteur vidÃ©o et la modale d'image ğŸ”¥ RÃ©cupÃ©ration automatique de la plus haute qualitÃ©, support de tÃ©lÃ©chargement par lots, entiÃ¨rement gratuit sans publicitÃ©s âœ¨
// @description:fr-CA  ğŸ¬ TÃ©lÃ©chargeur professionnel de mÃ©dias Twitter/X ! ğŸ“± TÃ©lÃ©chargement en un clic de vidÃ©os HD et d'images avec des boutons de tÃ©lÃ©chargement dans la chronologie des tweets, le lecteur vidÃ©o et la fenÃªtre modale d'image ğŸ”¥ RÃ©cupÃ©ration automatique de la plus haute qualitÃ©, support de tÃ©lÃ©chargement par lots, entiÃ¨rement gratuit sans publicitÃ©s âœ¨
// @description:he     ğŸ¬ ××•×¨×“ ××“×™×” ××§×¦×•×¢×™ ×©×œ Twitter/X! ğŸ“± ×”×•×¨×“×” ×‘×œ×—×™×¦×” ××—×ª ×©×œ ×¡×¨×˜×•× ×™ HD ×•×ª××•× ×•×ª ×¢× ×›×¤×ª×•×¨×™ ×”×•×¨×“×” ×‘×¦×™×¨ ×”×–××Ÿ ×©×œ ×”×˜×•×•×™×˜×™×, × ×’×Ÿ ×”×•×•×™×“××• ×•××•×“×œ ×”×ª××•× ×” ğŸ”¥ ×§×‘×œ×” ××•×˜×•××˜×™×ª ×©×œ ××™×›×•×ª ×’×‘×•×”×” ×‘×™×•×ª×¨, ×ª××™×›×” ×‘×”×•×¨×“×” ×§×‘×•×¦×ª×™×ª, ×—×™× × ×œ×—×œ×•×˜×™×Ÿ ×œ×œ× ×¤×¨×¡×•××•×ª âœ¨
// @description:hr     ğŸ¬ Profesionalni Twitter/X preuzimatelja medija! ğŸ“± Jednim klikom preuzmite HD videozapise i slike s gumbovima za preuzimanje u vremenskoj liniji tweetova, video playeru i slika modalu ğŸ”¥ Automatsko dohvaÄ‡anje najviÅ¡e kvalitete, podrÅ¡ka za grupno preuzimanje, potpuno besplatno bez oglasa âœ¨
// @description:hu     ğŸ¬ ProfesszionÃ¡lis Twitter/X mÃ©dia letÃ¶ltÅ‘! ğŸ“± Egy kattintÃ¡ssal tÃ¶lts le HD videÃ³kat Ã©s kÃ©peket letÃ¶ltÃ©si gombokkal a tweet idÅ‘vonalon, videÃ³ lejÃ¡tszÃ³ban Ã©s kÃ©p modÃ¡lban ğŸ”¥ Automatikus legmagasabb minÅ‘sÃ©g lekÃ©rÃ©s, tÃ¶meges letÃ¶ltÃ©s tÃ¡mogatÃ¡s, teljesen ingyenes reklÃ¡mok nÃ©lkÃ¼l âœ¨
// @description:id     ğŸ¬ Pengunduh media Twitter/X profesional! ğŸ“± Unduh video HD dan gambar sekali klik dengan tombol unduh di timeline tweet, pemutar video, dan modal gambar ğŸ”¥ Pengambilan otomatis kualitas tertinggi, dukungan unduh batch, sepenuhnya gratis tanpa iklan âœ¨
// @description:it     ğŸ¬ Downloader professionale di media Twitter/X! ğŸ“± Download con un clic di video HD e immagini con pulsanti di download nella timeline dei tweet, lettore video e modale immagine ğŸ”¥ Recupero automatico della massima qualitÃ , supporto per download in batch, completamente gratuito senza pubblicitÃ  âœ¨
// @description:ja     ğŸ¬ ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªTwitter/Xãƒ¡ãƒ‡ã‚£ã‚¢ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ğŸ“± ãƒ„ã‚¤ãƒ¼ãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã€å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã€ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã§HDå‹•ç”»ãƒ»ç”»åƒã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ğŸ”¥ æœ€é«˜ç”»è³ªè‡ªå‹•å–å¾—ã€ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾å¿œã€å®Œå…¨ç„¡æ–™ãƒ»åºƒå‘Šãªã— âœ¨
// @description:ka     ğŸ¬ áƒáƒ áƒáƒ¤áƒ”áƒ¡áƒ˜áƒáƒœáƒáƒšáƒ£áƒ áƒ˜ Twitter/X áƒ›áƒ”áƒ“áƒ˜áƒ áƒ©áƒáƒ›áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ! ğŸ“± áƒ”áƒ áƒ—áƒ˜ áƒ¬áƒ™áƒáƒáƒ˜áƒ— HD áƒ•áƒ˜áƒ“áƒ”áƒáƒ”áƒ‘áƒ˜áƒ¡áƒ áƒ“áƒ áƒ¡áƒ£áƒ áƒáƒ—áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ›áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ©áƒáƒ›áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ¦áƒ˜áƒšáƒáƒ™áƒ”áƒ‘áƒ˜áƒ— tweet áƒ–áƒáƒšáƒ–áƒ”, áƒ•áƒ˜áƒ“áƒ”áƒ áƒ“áƒáƒ™áƒ•áƒ áƒáƒ¨áƒ˜ áƒ“áƒ áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡ áƒ›áƒáƒ“áƒáƒšáƒ¨áƒ˜ ğŸ”¥ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ£áƒ›áƒáƒ¦áƒšáƒ”áƒ¡áƒ˜ áƒ®áƒáƒ áƒ˜áƒ¡áƒ®áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ, áƒœáƒáƒ™áƒ áƒ”áƒ‘áƒ˜ áƒ©áƒáƒ›áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ, áƒ¡áƒ áƒ£áƒšáƒ˜áƒáƒ“ áƒ£áƒ¤áƒáƒ¡áƒ áƒ áƒ”áƒ™áƒšáƒáƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ áƒ”áƒ¨áƒ” âœ¨
// @description:ko     ğŸ¬ ì „ë¬¸ Twitter/X ë¯¸ë””ì–´ ë‹¤ìš´ë¡œë”! ğŸ“± íŠ¸ìœ— íƒ€ì„ë¼ì¸, ë¹„ë””ì˜¤ í”Œë ˆì´ì–´, ì´ë¯¸ì§€ ëª¨ë‹¬ì—ì„œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ìœ¼ë¡œ HD ë¹„ë””ì˜¤ì™€ ì´ë¯¸ì§€ë¥¼ ì›í´ë¦­ ë‹¤ìš´ë¡œë“œ ğŸ”¥ ìµœê³  í’ˆì§ˆ ìë™ ê°€ì ¸ì˜¤ê¸°, ì¼ê´„ ë‹¤ìš´ë¡œë“œ ì§€ì›, ì™„ì „ ë¬´ë£Œ ë° ê´‘ê³  ì—†ìŒ âœ¨
// @description:nb     ğŸ¬ Profesjonell Twitter/X medianedlaster! ğŸ“± Ett-klikks nedlasting av HD-videoer og bilder med nedlastingsknapper i tweet-tidslinje, videospiller og bildemodal ğŸ”¥ Automatisk henting av hÃ¸yeste kvalitet, stÃ¸tte for batch-nedlasting, helt gratis uten annonser âœ¨
// @description:nl     ğŸ¬ Professionele Twitter/X media downloader! ğŸ“± EÃ©n-klik download van HD video's en afbeeldingen met download knoppen in tweet tijdlijn, videospeler en afbeelding modal ğŸ”¥ Automatisch ophalen van hoogste kwaliteit, batch download ondersteuning, volledig gratis zonder advertenties âœ¨
// @description:pl     ğŸ¬ Profesjonalny pobieracz mediÃ³w Twitter/X! ğŸ“± Jednym klikniÄ™ciem pobierz filmy HD i obrazy z przyciskami pobierania na osi czasu tweetÃ³w, odtwarzaczu wideo i modalnym obrazie ğŸ”¥ Automatyczne pobieranie najwyÅ¼szej jakoÅ›ci, wsparcie dla pobierania wsadowego, caÅ‚kowicie za darmo bez reklam âœ¨
// @description:pt-BR  ğŸ¬ Baixador profissional de mÃ­dia do Twitter/X! ğŸ“± Download com um clique de vÃ­deos HD e imagens com botÃµes de download na timeline de tweets, player de vÃ­deo e modal de imagem ğŸ”¥ ObtenÃ§Ã£o automÃ¡tica da qualidade mÃ¡xima, suporte a download em lote, totalmente gratuito sem anÃºncios âœ¨
// @description:ro     ğŸ¬ DescÄƒrcÄƒtor profesional de media Twitter/X! ğŸ“± DescÄƒrcare cu un clic a videoclipurilor HD È™i imaginilor cu butoane de descÄƒrcare Ã®n cronologia tweet-urilor, playerul video È™i modalul imaginii ğŸ”¥ ObÈ›inerea automatÄƒ a celei mai Ã®nalte calitÄƒÈ›i, suport pentru descÄƒrcare Ã®n lot, complet gratuit fÄƒrÄƒ reclame âœ¨
// @description:ru     ğŸ¬ ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼ĞµĞ´Ğ¸Ğ° Twitter/X! ğŸ“± Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° HD Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ĞºĞ»Ğ¸ĞºĞ¾Ğ¼ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ² Ğ»ĞµĞ½Ñ‚Ğµ Ñ‚Ğ²Ğ¸Ñ‚Ğ¾Ğ², Ğ²Ğ¸Ğ´ĞµĞ¾Ğ¿Ğ»ĞµĞµÑ€Ğµ Ğ¸ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºĞ½Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ğŸ”¥ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹ÑĞ¾Ñ‡Ğ°Ğ¹ÑˆĞµĞ³Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿Ğ°ĞºĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸, Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ±ĞµĞ· Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹ âœ¨
// @description:sk     ğŸ¬ ProfesionÃ¡lny sÅ¥ahovaÄ mÃ©diÃ­ Twitter/X! ğŸ“± JednÃ½m kliknutÃ­m si stiahnite HD videÃ¡ a obrÃ¡zky s tlaÄidlami sÅ¥ahovania na Äasovej osi tweetov, video prehrÃ¡vaÄi a modÃ¡lnom obrÃ¡zku ğŸ”¥ AutomatickÃ© zÃ­skavanie najvyÅ¡Å¡ej kvality, podpora dÃ¡vkovÃ©ho sÅ¥ahovania, Ãºplne zadarmo bez reklÃ¡m âœ¨
// @description:sr     ğŸ¬ Profesionalni Twitter/X preuzimaÄ medija! ğŸ“± Jednim klikom preuzmite HD video zapise i slike sa dugmiÄ‡ima za preuzimanje u vremenskoj liniji tweetova, video pleeru i modalnoj slici ğŸ”¥ Automatsko dobijanje najviÅ¡eg kvaliteta, podrÅ¡ka za grupno preuzimanje, potpuno besplatno bez reklama âœ¨
// @description:sv     ğŸ¬ Professionell Twitter/X medianedladdare! ğŸ“± Enklicks nedladdning av HD-videor och bilder med nedladdningsknappar i tweet-tidslinje, videospelare och bildmodal ğŸ”¥ Automatisk hÃ¤mtning av hÃ¶gsta kvalitet, stÃ¶d fÃ¶r batch-nedladdning, helt gratis utan annonser âœ¨
// @description:th     ğŸ¬ à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸ªà¸·à¹ˆà¸­ Twitter/X à¹à¸šà¸šà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸! ğŸ“± à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸§à¸´à¸”à¸µà¹‚à¸­ HD à¹à¸¥à¸°à¸£à¸¹à¸›à¸ à¸²à¸à¸”à¹‰à¸§à¸¢à¸à¸²à¸£à¸„à¸¥à¸´à¸à¹€à¸”à¸µà¸¢à¸§à¸à¸£à¹‰à¸­à¸¡à¸›à¸¸à¹ˆà¸¡à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹ƒà¸™à¹„à¸—à¸¡à¹Œà¹„à¸¥à¸™à¹Œà¸—à¸§à¸µà¸• à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸¥à¹ˆà¸™à¸§à¸´à¸”à¸µà¹‚à¸­ à¹à¸¥à¸°à¹‚à¸¡à¸”à¸±à¸¥à¸£à¸¹à¸›à¸ à¸²à¸ ğŸ”¥ à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸¸à¸“à¸ à¸²à¸à¸ªà¸¹à¸‡à¸ªà¸¸à¸”à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ à¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹à¸šà¸šà¸à¸¥à¸¸à¹ˆà¸¡ à¸Ÿà¸£à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¹„à¸¡à¹ˆà¸¡à¸µà¹‚à¸†à¸©à¸“à¸² âœ¨
// @description:tr     ğŸ¬ Profesyonel Twitter/X medya indirici! ğŸ“± Tweet zaman Ã§izelgesi, video oynatÄ±cÄ± ve resim modalÄ±nda indirme dÃ¼ÄŸmeleri ile tek tÄ±kla HD video ve resim indirme ğŸ”¥ Otomatik en yÃ¼ksek kalite getirme, toplu indirme desteÄŸi, tamamen Ã¼cretsiz ve reklamasÄ±z âœ¨
// @description:uk     ğŸ¬ ĞŸÑ€Ğ¾Ñ„ĞµÑÑ–Ğ¹Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒĞ²Ğ°Ñ‡ Ğ¼ĞµĞ´Ñ–Ğ° Twitter/X! ğŸ“± Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ HD Ğ²Ñ–Ğ´ĞµĞ¾ Ñ‚Ğ° Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ĞºĞ»Ñ–ĞºĞ¾Ğ¼ Ğ· ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ² ÑÑ‚Ñ€Ñ–Ñ‡Ñ†Ñ– Ñ‚Ğ²Ñ–Ñ‚Ñ–Ğ², Ğ²Ñ–Ğ´ĞµĞ¾Ğ¿Ğ»ĞµÑ”Ñ€Ñ– Ñ‚Ğ° Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ– ğŸ”¥ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ Ğ½Ğ°Ğ¹Ğ²Ğ¸Ñ‰Ğ¾Ñ— ÑĞºĞ¾ÑÑ‚Ñ–, Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° Ğ¿Ğ°ĞºĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ, Ğ¿Ğ¾Ğ²Ğ½Ñ–ÑÑ‚Ñ Ğ±ĞµĞ·ĞºĞ¾ÑˆÑ‚Ğ¾Ğ²Ğ½Ğ¾ Ğ±ĞµĞ· Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ¸ âœ¨
// @description:ug     ğŸ¬ ÙƒÛ•Ø³Ù¾Ù‰ÙŠ Twitter/X Û‹Ø§Ø³Ù‰ØªÛ• Ú†ÛˆØ´ÛˆØ±Ú¯ÛˆÚ†! ğŸ“± ØªÙ‰Û‹Ù‰Øª Û‹Ø§Ù‚Ù‰Øª Ø¦Ù‰Ø²Ù‰ØŒ Ø³Ù‰Ù† Ù‚ÙˆÙŠØºÛ‡Ú† Û‹Û• Ø±Û•Ø³Ù‰Ù… Ù…ÙˆØ¯Ø§Ù„Ù„Ù‰Ø±Ù‰Ø¯Ø§ Ú†ÛˆØ´ÛˆØ±ÛˆØ´ ÙƒÛ‡Ù†Û‡Ù¾ÙƒÙ‰Ù„Ù‰Ø±Ù‰ Ø¨Ù‰Ù„Û•Ù† Ø¨Ù‰Ø± Ú†ÛÙƒÙ‰Ø´ Ø¦Ø§Ø±Ù‚Ù‰Ù„Ù‰Ù‚ HD Ø³Ù‰Ù† Û‹Û• Ø±Û•Ø³Ù‰Ù…Ù„Û•Ø±Ù†Ù‰ Ú†ÛˆØ´ÛˆØ±ÛˆÚ­ ğŸ”¥ Ø¦Ø§Ù¾ØªÙˆÙ…Ø§ØªÙ‰Ùƒ Ø¦Û•Ú­ ÙŠÛ‡Ù‚Ù‰Ø±Ù‰ Ø³ÛˆÙ¾Û•Øª Ø¦ÛÙ„Ù‰Ø´ØŒ ØªÙˆÙ¾ Ú†ÛˆØ´ÛˆØ±ÛˆØ´ Ù‚ÙˆÙ„Ù„Ø§Ø´ØŒ ØªÙˆÙ„Û‡Ù‚ Ú¾Û•Ù‚Ø³Ù‰Ø² Û‹Û• Ø¦ÛÙ„Ø§Ù†Ø³Ù‰Ø² âœ¨
// @description:vi     ğŸ¬ TrÃ¬nh táº£i xuá»‘ng phÆ°Æ¡ng tiá»‡n Twitter/X chuyÃªn nghiá»‡p! ğŸ“± Táº£i xuá»‘ng video HD vÃ  hÃ¬nh áº£nh báº±ng má»™t cÃº nháº¥p chuá»™t vá»›i cÃ¡c nÃºt táº£i xuá»‘ng trong dÃ²ng thá»i gian tweet, trÃ¬nh phÃ¡t video vÃ  modal hÃ¬nh áº£nh ğŸ”¥ Tá»± Ä‘á»™ng láº¥y cháº¥t lÆ°á»£ng cao nháº¥t, há»— trá»£ táº£i xuá»‘ng hÃ ng loáº¡t, hoÃ n toÃ n miá»…n phÃ­ khÃ´ng cÃ³ quáº£ng cÃ¡o âœ¨
// @author       YouhouLab
// @license      MIT
// @match        *://*.twitter.com/*
// @match        *://*.x.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=twitter.com
// @grant        none
// @run-at       document-start
// @compatible   chrome
// @compatible   firefox
// @compatible   opera
// @compatible   edge
// @compatible   safari
// @keywords     twitter, x, download, video, image, media, hd, 1080p, 2k, 4k, free, no ads, batch download, enhanced, æ¨ç‰¹, åª’ä½“, ä¸‹è½½, è§†é¢‘, å›¾ç‰‡, é«˜æ¸…, å…è´¹, æ— å¹¿å‘Š, æ‰¹é‡ä¸‹è½½, ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼, ãƒ¡ãƒ‡ã‚£ã‚¢, ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰, å‹•ç”», ç”»åƒ, é«˜ç”»è³ª, ç„¡æ–™, å¹¿å‘Šãªã—, descarga, video, imagen, gratis, sin anuncios, baixar, vÃ­deo, imagem, gratuito, sem anÃºncios, ğŸš€, ğŸ¬, ğŸ“±, ğŸ”¥, âœ¨, ğŸ“º, ğŸ–¼ï¸, ğŸ’¾, â¬‡ï¸, ğŸ¯
// @downloadURL https://update.greasyfork.org/scripts/540413/%F0%9F%9A%80%20%F0%9F%8E%AC%20Enhanced%20Twitter%20Media%20Downloader%20%7C%20%E6%8E%A8%E7%89%B9%E5%AA%92%E4%BD%93%E4%B8%8B%E8%BD%BD%E5%99%A8.user.js
// @updateURL https://update.greasyfork.org/scripts/540413/%F0%9F%9A%80%20%F0%9F%8E%AC%20Enhanced%20Twitter%20Media%20Downloader%20%7C%20%E6%8E%A8%E7%89%B9%E5%AA%92%E4%BD%93%E4%B8%8B%E8%BD%BD%E5%99%A8.meta.js
// ==/UserScript==

/**
 * Enhanced Twitteråª’ä½“ä¸‹è½½å™¨ - å®Œæ•´ç‰ˆ ğŸš€
 * åŸºäºåŸæœ‰è„šæœ¬å¢å¼ºï¼Œæ”¯æŒå¤šä½ç½®ä¸‹è½½æŒ‰é’®é›†æˆ
 */

class EnhancedTwitterMediaDownloader {
    constructor() {
        this.mediaStore = []; // å­˜å‚¨ä»APIä¸­æå–çš„åª’ä½“ä¿¡æ¯
        this.init();
    }

    /**
     * åˆå§‹åŒ–ä¸‹è½½å™¨
     */
    init() {
        this.interceptXMLHttpRequest();
        this.setupAllObservers();
        this.injectStyles();
    }

    /**
     * è®¾ç½®æ‰€æœ‰è§‚å¯Ÿå™¨
     */
    setupAllObservers() {
        this.observeTweetElements();    // æ¨ç‰¹åŠ¨æ€æŒ‰é’®
        this.observeVideoElements();   // è§†é¢‘æ§åˆ¶æŒ‰é’®
        this.observeImageModal();      // å›¾ç‰‡æ”¾å¤§æ°´å°æŒ‰é’®
    }

    /**
     * æ‹¦æˆªXMLHttpRequestï¼Œç›‘å¬Twitter APIå“åº”
     */
    interceptXMLHttpRequest() {
        const originalOpen = XMLHttpRequest.prototype.open;
        const self = this;

        XMLHttpRequest.prototype.open = function(method, url) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯Twitter APIè¯·æ±‚
            if (/(api\.)?(twitter|x)\.com\/(i\/api\/)?(2|graphql|1\.1)\//i.test(url)) {
                const originalSend = this.send;
                
                this.send = function() {
                    const originalOnReadyStateChange = this.onreadystatechange;
                    
                    this.onreadystatechange = function() {
                        // è¯·æ±‚å®Œæˆæ—¶è§£æå“åº”
                        if (this.readyState === XMLHttpRequest.DONE && this.responseText) {
                            try {
                                const responseData = JSON.parse(this.responseText);
                                self.extractMediaFromResponse(responseData);
                            } catch (error) {
                                console.error('è§£æAPIå“åº”å¤±è´¥:', error);
                            }
                        }
                        
                        // è°ƒç”¨åŸå§‹å›è°ƒ
                        if (originalOnReadyStateChange) {
                            return originalOnReadyStateChange.apply(this, arguments);
                        }
                    };
                    
                    return originalSend.apply(this, arguments);
                };
            }
            
            return originalOpen.apply(this, arguments);
        };
    }

    /**
     * ä»APIå“åº”ä¸­æå–åª’ä½“ä¿¡æ¯
     */
    extractMediaFromResponse(data) {
        try {
            // æŸ¥æ‰¾æ‰€æœ‰åŒ…å«æ‰©å±•å®ä½“çš„å¯¹è±¡
            const entitiesWithMedia = this.findObjectsWithProperty(data, 'extended_entities');
            
            // æŸ¥æ‰¾åŒ…å«å­—ç¬¦ä¸²å€¼çš„å¯¹è±¡ï¼ˆå¯èƒ½åŒ…å«åª’ä½“ä¿¡æ¯ï¼‰
            const stringValues = this.findObjectsWithProperty(data, 'string_value');
            
            // è§£æå­—ç¬¦ä¸²å€¼ä¸­çš„åª’ä½“ä¿¡æ¯
            const parsedStringMedia = stringValues
                .map(obj => this.parseStringValueMedia(obj.string_value))
                .filter(Boolean);

            // åˆå¹¶æ‰€æœ‰åª’ä½“æº
            const allMediaSources = [...entitiesWithMedia, ...parsedStringMedia];
            
            // æå–åª’ä½“ä¿¡æ¯
            const mediaItems = this.extractMediaItems(allMediaSources);
            
            if (mediaItems.length > 0) {
                this.mediaStore.push(...mediaItems);
                console.log('æå–åˆ°åª’ä½“ä¿¡æ¯:', mediaItems);
            }
            
        } catch (error) {
            console.error('æå–åª’ä½“ä¿¡æ¯å¤±è´¥:', error);
        }
    }

    /**
     * é€’å½’æŸ¥æ‰¾åŒ…å«æŒ‡å®šå±æ€§çš„å¯¹è±¡
     */
    findObjectsWithProperty(obj, property, results = []) {
        if (!obj || typeof obj !== 'object') return results;

        if (obj.hasOwnProperty(property)) {
            results.push(obj);
        } else {
            Object.values(obj).forEach(value => {
                results.push(...this.findObjectsWithProperty(value, property));
            });
        }

        return results;
    }

    /**
     * è§£æå­—ç¬¦ä¸²å€¼ä¸­çš„åª’ä½“ä¿¡æ¯
     */
    parseStringValueMedia(stringValue) {
        try {
            const parsed = JSON.parse(stringValue);
            const mediaEntities = Object.values(parsed.media_entities || {});
            const mediaEntity = mediaEntities.find(entity => this.isValidMediaType(entity));
            
            if (mediaEntity) {
                return {
                    extended_entities: {
                        media: [mediaEntity]
                    },
                    id_str: mediaEntity.id_str
                };
            }
        } catch (error) {
            // è§£æå¤±è´¥ï¼Œå¿½ç•¥æ­¤é¡¹
        }
        return null;
    }

    /**
     * æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åª’ä½“ç±»å‹
     */
    isValidMediaType(entity) {
        return entity && ['video', 'animated_gif', 'photo'].includes(entity.type);
    }

    /**
     * ä»åª’ä½“æºä¸­æå–åª’ä½“é¡¹
     */
    extractMediaItems(mediaSources) {
        return mediaSources
            .filter(source => {
                const mediaArray = source.extended_entities?.media || [];
                return mediaArray.some(media => this.isValidMediaType(media));
            })
            .flatMap(source => {
                const entityId = source.id_str || source.conversation_id_str;
                const mediaArray = source.extended_entities.media.filter(media => this.isValidMediaType(media));
                
                return mediaArray.map(media => ({
                    id: media.id_str,
                    entityId: entityId,
                    thumbnail: this.getThumbnailUrl(media),
                    photo: this.getPhotoUrl(media),
                    video: this.getVideoUrl(media),
                    text: this.generateDisplayText(source)
                }));
            })
            .filter((item, index, array) => {
                // å»é‡
                return array.findIndex(other => other.id === item.id) === index;
            });
    }

    /**
     * è·å–ç¼©ç•¥å›¾URL
     */
    getThumbnailUrl(media) {
        const url = media.media_url_https;
        return url.substr(0, url.lastIndexOf('.'));
    }

    /**
     * è·å–å›¾ç‰‡URL
     */
    getPhotoUrl(media) {
        const url = media.media_url_https;
        const hasLargeSize = media.sizes?.large;
        return url + (hasLargeSize ? ':large' : '');
    }

    /**
     * è·å–è§†é¢‘URLï¼ˆæœ€é«˜è´¨é‡ï¼‰
     */
    getVideoUrl(media) {
        const variants = media.video_info?.variants;
        if (!variants) return null;

        const mp4Variants = variants
            .filter(variant => variant.content_type === 'video/mp4')
            .sort((a, b) => b.bitrate - a.bitrate);

        return mp4Variants[0]?.url || null;
    }

    /**
     * ç”Ÿæˆæ˜¾ç¤ºæ–‡æœ¬
     */
    generateDisplayText(source) {
        const id = source.id_str || source.conversation_id_str;
        if (!source.full_text) return id;

        let text = source.full_text
            .split('https://t.co')[0]
            .trim()
            .replace(/(\r\n|\n|\r)/gm, '')
            .substr(0, 50);

        return text || id;
    }

    // =================================
    // æ¨ç‰¹åŠ¨æ€æŒ‰é’®é›†æˆ
    // =================================

    observeTweetElements() {
        const tweetObserver = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node instanceof HTMLElement) {
                        // æ£€æŸ¥æ¨ç‰¹åŠ¨æ€
                        const articles = node.querySelectorAll('article[role="article"]');
                        articles.forEach(article => this.handleTweetElement(article));
                        
                        // å¦‚æœèŠ‚ç‚¹æœ¬èº«æ˜¯article
                        if (node.matches('article[role="article"]')) {
                            this.handleTweetElement(node);
                        }
                    }
                });
            });
        });
        
        tweetObserver.observe(document, {
            childList: true,
            subtree: true
        });
    }

    handleTweetElement(articleElement) {
        // å»¶è¿Ÿå¤„ç†ï¼Œç­‰å¾…å…ƒç´ å®Œå…¨æ¸²æŸ“
        setTimeout(() => {
            // æ£€æŸ¥æ˜¯å¦åŒ…å«åª’ä½“
            const mediaElements = articleElement.querySelectorAll('img[src*="pbs.twimg.com"], video');
            if (mediaElements.length === 0) return;
            
            // æŸ¥æ‰¾äº’åŠ¨æŒ‰é’®åŒºåŸŸ - ä½¿ç”¨XPathæä¾›çš„ç²¾ç¡®è·¯å¾„é€»è¾‘
            const buttonGroups = articleElement.querySelectorAll('div[role="group"]');
            const actionGroup = buttonGroups[buttonGroups.length - 1];
            
            if (!actionGroup) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ 
            if (actionGroup.querySelector('.tweet-download-btn')) return;
            
            // æŸ¥æ‰¾å¯¹åº”çš„åª’ä½“æ•°æ®
            const mediaItem = this.findMediaForTweet(articleElement);
            if (!mediaItem) return;
            
            // æ·»åŠ ä¸‹è½½æŒ‰é’®
            this.addTweetDownloadButton(actionGroup, mediaItem);
        }, 1000);
    }

    addTweetDownloadButton(actionGroup, mediaItem) {
        const downloadButton = document.createElement('div');
        downloadButton.className = 'tweet-download-btn';
        downloadButton.setAttribute('role', 'button');
        downloadButton.setAttribute('aria-label', 'ä¸‹è½½åª’ä½“');
        downloadButton.setAttribute('tabindex', '0');
        
        // è·å–å…¶ä»–æŒ‰é’®çš„æ ·å¼å‚è€ƒ
        const otherButtons = actionGroup.querySelectorAll('div[role="button"]');
        const referenceButton = otherButtons[0];
        
        // è®¾ç½®åœ†å½¢æŒ‰é’®æ ·å¼ - CSSç±»ä¼šè¦†ç›–è¿™äº›åŸºç¡€æ ·å¼
        
        downloadButton.innerHTML = `
            <div>
                <svg class="download-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M3,14 v5 q0,2 2,2 h14 q2,0 2,-2 v-5 M7,10 l4,4 q1,1 2,0 l4,-4 M12,3 v11"/>
                </svg>
                <svg class="loading-icon" width="20" height="20" viewBox="0 0 32 32" style="display:none;">
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" stroke="currentColor" opacity="0.3"/>
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" stroke="currentColor" stroke-dasharray="87.96" stroke-dashoffset="87.96">
                        <animate attributeName="stroke-dashoffset" dur="2s" values="87.96;0" repeatCount="indefinite"/>
                    </circle>
                </svg>
                <svg class="success-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                    <path d="M9 20c-.264 0-.52-.104-.707-.293l-4.785-4.785c-.39-.39-.39-1.023 0-1.414s1.023-.39 1.414 0l3.946 3.945L18.075 4.11c.32-.45.94-.558 1.395-.24.45.318.56.942.24 1.394L9.817 19.577c-.17.24-.438.395-.732.42-.028.002-.057.003-.085.003z"/>
                </svg>
            </div>
        `;
        
        // æ‚¬åœæ•ˆæœé€šè¿‡CSSå¤„ç†ï¼Œè¿™é‡Œç§»é™¤JavaScriptå¤„ç†
        
        downloadButton.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            // ç«‹å³ç§»é™¤ç„¦ç‚¹ï¼Œé¿å…åœ†ç¯æ®‹ç•™
            downloadButton.blur();
            await this.handleDownload(e, downloadButton, mediaItem);
        });
        
        actionGroup.appendChild(downloadButton);
    }

    // =================================
    // è§†é¢‘æ§åˆ¶æŒ‰é’®é›†æˆ
    // =================================

    observeVideoElements() {
        const videoObserver = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node instanceof HTMLElement) {
                        // æ£€æŸ¥è§†é¢‘å…ƒç´ 
                        const videos = node.querySelectorAll('video');
                        videos.forEach(video => this.handleVideoElement(video));
                        
                        // å¦‚æœèŠ‚ç‚¹æœ¬èº«æ˜¯è§†é¢‘
                        if (node.tagName === 'VIDEO') {
                            this.handleVideoElement(node);
                        }
                    }
                });
            });
        });
        
        videoObserver.observe(document, {
            childList: true,
            subtree: true
        });
    }

    handleVideoElement(videoElement) {
        // ç­‰å¾…è§†é¢‘åŠ è½½å®Œæˆ
        const addButton = () => {
            setTimeout(() => {
                this.addVideoDownloadButton(videoElement);
            }, 2000); // ç­‰å¾…æ§åˆ¶æ æ¸²æŸ“
        };

        if (videoElement.readyState >= 1) {
            addButton();
        } else {
            videoElement.addEventListener('loadedmetadata', addButton);
        }
        
        // ä¹Ÿç›‘å¬ç”¨æˆ·äº¤äº’åçš„æ§åˆ¶æ æ˜¾ç¤º
        videoElement.addEventListener('play', addButton);
        videoElement.addEventListener('pause', addButton);
    }

    addVideoDownloadButton(videoElement) {
        const controlBar = this.findVideoControlBar(videoElement);
        if (!controlBar) return;
        
        // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ 
        if (controlBar.querySelector('.video-download-btn')) return;
        
        // æŸ¥æ‰¾å¯¹åº”çš„åª’ä½“æ•°æ®
        const mediaItem = this.findMediaForVideo(videoElement);
        if (!mediaItem || !mediaItem.video) return;
        
        // åˆ›å»ºä¸‹è½½æŒ‰é’®
        const downloadButton = this.createVideoDownloadButton(mediaItem);
        
        // æŸ¥æ‰¾è®¾ç½®æŒ‰é’®å¹¶æ’å…¥åˆ°å…¶æ—è¾¹ - åŸºäºæä¾›çš„XPathé€»è¾‘
        const settingsButton = controlBar.querySelector('button[aria-label*="è®¾ç½®"], button[aria-label*="Settings"], button[aria-label*="æ›´å¤š"]');
        if (settingsButton && settingsButton.parentElement) {
            settingsButton.parentElement.insertBefore(downloadButton, settingsButton.nextSibling);
        } else {
            // å¦‚æœæ‰¾ä¸åˆ°è®¾ç½®æŒ‰é’®ï¼Œæ·»åŠ åˆ°æ§åˆ¶æ æœ«å°¾
            controlBar.appendChild(downloadButton);
        }
    }

    findVideoControlBar(videoElement) {
        // å‘ä¸ŠæŸ¥æ‰¾è§†é¢‘å®¹å™¨
        let container = videoElement.parentElement;
        while (container && !container.matches('div[data-testid="videoComponent"], div[data-testid="videoPlayer"], div[role="group"]')) {
            container = container.parentElement;
            if (container === document.body) return null;
        }
        
        if (!container) return null;
        
        // åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾æ§åˆ¶æ  - é€šå¸¸æ˜¯åŒ…å«æŒ‰é’®çš„div
        const controlBars = container.querySelectorAll('div[role="group"], div:has(button)');
        
        // é€‰æ‹©åŒ…å«æœ€å¤šæŒ‰é’®çš„divä½œä¸ºæ§åˆ¶æ 
        let bestCandidate = null;
        let maxButtons = 0;
        
        controlBars.forEach(bar => {
            const buttonCount = bar.querySelectorAll('button').length;
            if (buttonCount > maxButtons) {
                maxButtons = buttonCount;
                bestCandidate = bar;
            }
        });
        
        return bestCandidate;
    }

    createVideoDownloadButton(mediaItem) {
        const button = document.createElement('button');
        button.className = 'video-download-btn';
        button.setAttribute('aria-label', 'ä¸‹è½½è§†é¢‘');
        // åŸºç¡€æ ·å¼ï¼Œåœ†å½¢æ ·å¼ç”±CSSç±»å¤„ç†
        button.style.cssText = `
            background: none;
            border: none;
            cursor: pointer;
            color: white;
        `;
        
        button.innerHTML = `
            <div>
                <svg class="download-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M3,14 v5 q0,2 2,2 h14 q2,0 2,-2 v-5 M7,10 l4,4 q1,1 2,0 l4,-4 M12,3 v11"/>
                </svg>
                <svg class="loading-icon" width="20" height="20" viewBox="0 0 32 32" style="display:none;">
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" stroke="currentColor" opacity="0.3"/>
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" stroke="currentColor" stroke-dasharray="87.96" stroke-dashoffset="87.96">
                        <animate attributeName="stroke-dashoffset" dur="2s" values="87.96;0" repeatCount="indefinite"/>
                    </circle>
                </svg>
                <svg class="success-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                    <path d="M9 20c-.264 0-.52-.104-.707-.293l-4.785-4.785c-.39-.39-.39-1.023 0-1.414s1.023-.39 1.414 0l3.946 3.945L18.075 4.11c.32-.45.94-.558 1.395-.24.45.318.56.942.24 1.394L9.817 19.577c-.17.24-.438.395-.732.42-.028.002-.057.003-.085.003z"/>
                </svg>
            </div>
        `;
        
        // æ‚¬åœæ•ˆæœé€šè¿‡CSSå¤„ç†ï¼Œç§»é™¤JavaScriptå¤„ç†
        
        button.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            // ç«‹å³ç§»é™¤ç„¦ç‚¹ï¼Œé¿å…åœ†ç¯æ®‹ç•™
            button.blur();
            await this.handleDownload(e, button, mediaItem);
        });
        
        return button;
    }

    // =================================
    // å›¾ç‰‡æ”¾å¤§æ°´å°æŒ‰é’®é›†æˆ
    // =================================

    observeImageModal() {
        const modalObserver = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node instanceof HTMLElement) {
                        // æ£€æŸ¥æ¨¡æ€æ¡†
                        if (node.matches('div[aria-modal="true"]')) {
                            this.handleImageModal(node);
                        }
                        
                        // æ£€æŸ¥å­å…ƒç´ ä¸­çš„æ¨¡æ€æ¡†
                        const modals = node.querySelectorAll('div[aria-modal="true"]');
                        modals.forEach(modal => this.handleImageModal(modal));
                    }
                });
            });
        });
        
        modalObserver.observe(document, {
            childList: true,
            subtree: true
        });
    }

    handleImageModal(modalElement) {
        setTimeout(() => {
            const images = modalElement.querySelectorAll('img[src*="pbs.twimg.com"]');
            images.forEach(img => {
                this.addImageWatermarkButton(img);
            });
        }, 500); // ç­‰å¾…å›¾ç‰‡æ¸²æŸ“å®Œæˆ
    }

    addImageWatermarkButton(imageElement) {
        // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ 
        const container = imageElement.closest('div');
        if (!container || container.querySelector('.image-watermark-download')) return;
        
        // æŸ¥æ‰¾å¯¹åº”çš„åª’ä½“æ•°æ®
        const mediaItem = this.mediaStore.find(item => 
            imageElement.src.indexOf(item.thumbnail) > -1 || 
            imageElement.src.indexOf(item.photo) > -1
        );
        
        if (!mediaItem) return;
        
        // åˆ›å»ºæ°´å°å¼ä¸‹è½½æŒ‰é’®
        const watermarkButton = document.createElement('div');
        watermarkButton.className = 'image-watermark-download';
        watermarkButton.setAttribute('role', 'button');
        watermarkButton.setAttribute('aria-label', 'ä¸‹è½½å›¾ç‰‡');
        watermarkButton.setAttribute('tabindex', '0');
        
        watermarkButton.innerHTML = `
            <div>
                <svg class="download-icon" width="20" height="20" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="12" fill="rgba(0,0,0,0.6)"/>
                    <path d="M3,14 v5 q0,2 2,2 h14 q2,0 2,-2 v-5 M7,10 l4,4 q1,1 2,0 l4,-4 M12,3 v11" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <svg class="loading-icon" width="20" height="20" viewBox="0 0 32 32" style="display:none;">
                    <circle cx="16" cy="16" r="8" fill="rgba(0,0,0,0.6)"/>
                    <circle cx="16" cy="16" fill="none" r="6" stroke-width="2" stroke="white" opacity="0.3"/>
                    <circle cx="16" cy="16" fill="none" r="6" stroke-width="2" stroke="white" stroke-dasharray="37.7" stroke-dashoffset="37.7">
                        <animate attributeName="stroke-dashoffset" dur="2s" values="37.7;0" repeatCount="indefinite"/>
                    </circle>
                </svg>
                <svg class="success-icon" width="20" height="20" viewBox="0 0 24 24" style="display:none;">
                    <circle cx="12" cy="12" r="10" fill="rgba(0,0,0,0.6)"/>
                    <path d="M9 14.2L6.8 12l-1.4 1.4L9 17 19 7l-1.4-1.4L9 14.2z" fill="white"/>
                </svg>
            </div>
        `;
        
        // æ ·å¼è®¾ç½® - åŸºç¡€æ ·å¼ï¼Œè¯¦ç»†åœ†å½¢æ ·å¼ç”±CSSç±»å¤„ç†
        Object.assign(watermarkButton.style, {
            position: 'absolute',
            top: '16px',
            right: '16px',
            cursor: 'pointer',
            zIndex: '1000',
            opacity: '0.8',
            transition: 'opacity 0.2s'
        });
        
        // æ‚¬åœæ•ˆæœé€šè¿‡CSSå¤„ç†
        
        // ç‚¹å‡»ä¸‹è½½
        watermarkButton.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();
            // ç«‹å³ç§»é™¤ç„¦ç‚¹ï¼Œé¿å…åœ†ç¯æ®‹ç•™
            watermarkButton.blur();
            await this.handleDownload(e, watermarkButton, mediaItem);
        });
        
        // ç¡®ä¿å›¾ç‰‡å®¹å™¨æœ‰ç›¸å¯¹å®šä½
        const imageContainer = imageElement.closest('div');
        if (imageContainer) {
            const computedStyle = getComputedStyle(imageContainer);
            if (computedStyle.position === 'static') {
                imageContainer.style.position = 'relative';
            }
            imageContainer.appendChild(watermarkButton);
        }
    }

    // =================================
    // é€šç”¨è¾…åŠ©æ–¹æ³•
    // =================================

    findMediaForVideo(videoElement) {
        // é€šè¿‡è§†é¢‘URLæˆ–å®¹å™¨æŸ¥æ‰¾å¯¹åº”çš„åª’ä½“æ•°æ®
        const videoSrc = videoElement.src || videoElement.currentSrc;
        if (!videoSrc) return null;
        
        return this.mediaStore.find(item => {
            if (!item.video) return false;
            
            // æå–è§†é¢‘IDç”¨äºåŒ¹é…
            const videoId = videoSrc.match(/\/(\d+)\//)?.[1];
            const itemVideoId = item.video.match(/\/(\d+)\//)?.[1];
            
            return videoId && itemVideoId && videoId === itemVideoId;
        });
    }
    
    findMediaForTweet(articleElement) {
        // é€šè¿‡æ¨æ–‡ä¸­çš„å›¾ç‰‡æ‰¾åˆ°å¯¹åº”çš„åª’ä½“æ•°æ®
        const images = articleElement.querySelectorAll('img[src*="pbs.twimg.com"]');
        for (const img of images) {
            const mediaItem = this.mediaStore.find(item => 
                img.src.indexOf(item.thumbnail) > -1
            );
            if (mediaItem) return mediaItem;
        }
        return null;
    }

    /**
     * å¤„ç†ä¸‹è½½äº‹ä»¶
     */
    async handleDownload(event, button, mediaItem) {
        event.preventDefault();
        event.stopImmediatePropagation();

        button.disabled = true;
        this.setButtonState(button, 'loading');

        try {
            // è·å–åŒä¸€æ¡æ¨æ–‡çš„æ‰€æœ‰åª’ä½“
            const relatedMedia = this.mediaStore.filter(item => 
                item.entityId === mediaItem.entityId
            );

            const downloadedUrls = new Set();

            // ä¸‹è½½æ‰€æœ‰ç›¸å…³åª’ä½“
            for (const media of relatedMedia) {
                const downloadUrl = media.video || media.photo;
                if (downloadUrl && !downloadedUrls.has(downloadUrl)) {
                    await this.downloadFile(downloadUrl, media.text);
                    downloadedUrls.add(downloadUrl);
                }
            }

            this.setButtonState(button, 'success');
            
        } catch (error) {
            console.error('ä¸‹è½½å¤±è´¥:', error);
            this.setButtonState(button, 'error');
        }
    }

    /**
     * è®¾ç½®æŒ‰é’®çŠ¶æ€
     */
    setButtonState(button, state) {
        const downloadIcon = button.querySelector('.download-icon');
        const loadingIcon = button.querySelector('.loading-icon');
        const successIcon = button.querySelector('.success-icon');

        // éšè—æ‰€æœ‰å›¾æ ‡
        [downloadIcon, loadingIcon, successIcon].forEach(icon => {
            if (icon) icon.style.display = 'none';
        });

        // æ˜¾ç¤ºå¯¹åº”çŠ¶æ€çš„å›¾æ ‡
        switch (state) {
            case 'loading':
                if (loadingIcon) loadingIcon.style.display = 'block';
                break;
            case 'success':
                if (successIcon) successIcon.style.display = 'block';
                setTimeout(() => {
                    button.disabled = false;
                    if (downloadIcon) downloadIcon.style.display = 'block';
                    if (successIcon) successIcon.style.display = 'none';
                }, 2000);
                break;
            case 'error':
            default:
                if (downloadIcon) downloadIcon.style.display = 'block';
                button.disabled = false;
                break;
        }
    }

    /**
     * ä¸‹è½½æ–‡ä»¶
     */
    async downloadFile(url, filename) {
        try {
            const response = await fetch(url);
            const blob = await response.blob();
            const contentType = response.headers.get('Content-Type');
            
            // ç¡®å®šæ–‡ä»¶æ‰©å±•å
            const extension = this.getFileExtension(contentType);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const downloadLink = document.createElement('a');
            downloadLink.style.display = 'none';
            downloadLink.href = window.URL.createObjectURL(blob);
            downloadLink.setAttribute('target', '_blank');
            downloadLink.setAttribute('download', `${filename}.${extension}`);

            // è§¦å‘ä¸‹è½½
            document.body.appendChild(downloadLink);
            downloadLink.click();
            
            // æ¸…ç†
            window.URL.revokeObjectURL(downloadLink.href);
            document.body.removeChild(downloadLink);
            
        } catch (error) {
            console.error('æ–‡ä»¶ä¸‹è½½å¤±è´¥:', error);
            throw error;
        }
    }

    /**
     * æ ¹æ®MIMEç±»å‹è·å–æ–‡ä»¶æ‰©å±•å
     */
    getFileExtension(contentType) {
        switch (contentType) {
            case 'image/jpeg':
                return 'jpg';
            case 'image/png':
                return 'png';
            case 'video/mp4':
                return 'mp4';
            default:
                return 'mp4'; // é»˜è®¤ä¸ºmp4
        }
    }

    /**
     * æ³¨å…¥æ ·å¼
     */
    injectStyles() {
        const style = document.createElement('style');
        style.textContent = `
            /* æ¨ç‰¹åŠ¨æ€ä¸‹è½½æŒ‰é’®æ ·å¼ - åœ†å½¢è®¾è®¡ */
            .tweet-download-btn {
                color: rgb(83, 100, 113);
                transition: all 0.2s ease-in-out;
                border-radius: 50% !important;
                width: 36px !important;
                height: 36px !important;
                min-width: 36px !important;
                min-height: 36px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                background-color: transparent !important;
                border: none !important;
                cursor: pointer !important;
                outline: none !important;
                margin-top: -3px !important;
            }
            
            .tweet-download-btn:hover {
                color: rgb(29, 161, 242);
                background-color: rgba(29, 161, 242, 0.1) !important;
                transform: scale(1.05);
            }
            
            /* è§†é¢‘ä¸‹è½½æŒ‰é’®æ ·å¼ - åœ†å½¢è®¾è®¡ */
            .video-download-btn {
                border-radius: 50% !important;
                width: 35px !important;
                height: 35px !important;
                min-width: 35px !important;
                min-height: 35px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                transition: all 0.2s ease-in-out !important;
                outline: none !important;
                margin-top: -3px !important;
            }
            
            .video-download-btn:hover {
                background-color: rgba(255, 255, 255, 0.15) !important;
                transform: scale(1.1) !important;
            }
            
            /* å›¾ç‰‡æ°´å°ä¸‹è½½æŒ‰é’®æ ·å¼ - åœ†å½¢è®¾è®¡ */
            .image-watermark-download {
                user-select: none;
                border-radius: 50% !important;
                width: 35px !important;
                height: 35px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                transition: all 0.2s ease-in-out !important;
                outline: none !important;
                margin-top: -3px !important;
            }
            
            .image-watermark-download:hover {
                transform: scale(1.1) !important;
                opacity: 1 !important;
            }
            
            .image-watermark-download svg {
                border-radius: 50% !important;
            }
            
            /* é€šç”¨æ ·å¼ */
            .tweet-download-btn:disabled,
            .video-download-btn:disabled,
            .image-watermark-download:disabled {
                cursor: not-allowed;
                opacity: 0.7;
                transform: none !important;
            }
            
            /* æŒ‰é’®å†…å›¾æ ‡å±…ä¸­ */
            .tweet-download-btn > div,
            .video-download-btn > div,
            .image-watermark-download > div {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                width: 100% !important;
                height: 100% !important;
                padding: 0 !important;
            }
            
            /* åŠ è½½åŠ¨ç”» */
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .loading-icon {
                animation: spin 1s linear infinite;
            }
            
            /* ç§»é™¤æ‰€æœ‰ç„¦ç‚¹å’Œç‚¹å‡»æ—¶çš„åœ†ç¯æ•ˆæœ */
            .tweet-download-btn:focus,
            .tweet-download-btn:active,
            .tweet-download-btn:focus-visible,
            .tweet-download-btn:focus-within,
            .video-download-btn:focus,
            .video-download-btn:active,
            .video-download-btn:focus-visible,
            .video-download-btn:focus-within,
            .image-watermark-download:focus,
            .image-watermark-download:active,
            .image-watermark-download:focus-visible,
            .image-watermark-download:focus-within {
                outline: none !important;
                border: none !important;
                box-shadow: none !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
                appearance: none !important;
            }
            
            /* å¼ºåˆ¶ç§»é™¤æ‰€æœ‰æµè§ˆå™¨é»˜è®¤ç„¦ç‚¹æ ·å¼ */
            .tweet-download-btn *:focus,
            .tweet-download-btn *:active,
            .tweet-download-btn *:focus-visible,
            .video-download-btn *:focus,
            .video-download-btn *:active,
            .video-download-btn *:focus-visible,
            .image-watermark-download *:focus,
            .image-watermark-download *:active,
            .image-watermark-download *:focus-visible {
                outline: none !important;
                border: none !important;
                box-shadow: none !important;
            }
        `;
        
        document.head.appendChild(style);
    }
}

const enhancedDownloader = new EnhancedTwitterMediaDownloader();