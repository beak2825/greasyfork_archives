// ==UserScript==
// @name        steam_game_cards
// @namespace    http://tampermonkey.net/
// @author      jacky
// @license     jacky
// @description steam game cards prices
// @include     http*://steamcommunity.com/profiles/*/gamecards/*
// @include     http*://steamcommunity.com/profiles/*/badges*
// @icon        http://steamcommunity.com/favicon.ico
// @version     2025.12.23.1
// @run-at      document-end
// @require     https://code.jquery.com/jquery-3.7.1.min.js
// @grant       GM_addStyle
// @grant       unsafeWindow
// @downloadURL https://update.greasyfork.org/scripts/468365/steam_game_cards.user.js
// @updateURL https://update.greasyfork.org/scripts/468365/steam_game_cards.meta.js
// ==/UserScript==

GM_addStyle("table{border:solid 1px;border-collapse:collapse;font-size:16px !important;}");
GM_addStyle("td{border:solid 1px;border-collapse:collapse;padding-left:5px;padding-right:5px !important;}");
const list = [34270,43110,43160,35420,50300,863550,310560,44350,236870,321040,12120,12250,12110,12240,12230,12100,201700,219950,205950,286570,737800,12750,760620,252950,1818750,13250,252150,305050,301520,31280,91310,200940,227940,795100,1076280,2300,443910,224220,71240,24740,222900,368420,71230,1078000,254040,211420,1294660,273350,208610,247120,233250,588210,310380,254000,1293830,254020,835950,224420,234630,600430,108200,214560,236830,12830,765900,813820,8080,239450,765890,763970,765850,234710,765840,765860,9160,765910,243120,31220,31230,31240,31250,31260,44340,331360,350300,31290,94500,94510,94520,94530,286440,2290,287260,997070,252850,755790,264240,23310,340310,340300,57640,649190,371420,4540,567730,216250,224920,363480,13210,868270,205350,261880,312710,340650,364470,71260,244930,553210,1662740,206210,355840,259740,224600,50650,442080,315060,299500,375230,285050,421020,570460,225140,13230,13240,555440,208090,530700,263280,461910,907600,448640,274620,427920,13200,328600,255220,382570,356050,399100,8260,8280,8270,8290,8300,42160,310450,264120,284810,268420,8200,8210,8220,11330,8240,8250,201830,257890,284790,228400,72200,107800,766370,709440,204080,105450,330840,8230,260270,258200,11360,47870,2340,2330,9040,9030,2087030,104700,443080,438740,17450,1080110,12770,596650,321260,358610,209520,285580,240200,286500,302120,3970,266940,509840,2777740,206980,323370,545270,337420,258910,226320,293540,32420,344790,9000,394230,407730,364270,304030,3156040,8170,473800,514970,295550,12180,12170,467010,575550,360130,312280,489890,202270,224060,326670,340820,216110,73020,372260,398630,835860,234000,3810,429180,3820,446150,45500,1301210,8370,869760,8340,8350,8360,8380,4550,486880,503300,11590,261490,342150,208500,240180,2428770,576440,407620,663380,287140,654050,240160,635730,633130,316010,351990,2651330,457590,716610,214610,209870,231910,268810,302240,287340,208480,432760,356200,251710,905370,570380,17430,502370,322040,12790,308320,302250,2641470,12160,553880,44360,1399780,340770,237590,332070,15950,329490,414530,317620,1093170,368750,1816670,1024890,463700,336280,1308380,44320,263500,241540,504240,369580,255920,246280,235340,92200,346270,1183940,92220,267750,2391710,333740,384930,358400,247730,280200,92210,301680,1184140,96300,376870,533690,601320,212740,1368910,508380,328870,235400,437400,317060,492800,1531430,348670,347510,1008080,45750,436820,358240,404770,553660,275610,310810,394130,444460,343990,2669490,286340,996470,95000,31700,285440,323460,328060,291410,363790,2075420,585860,300080,630100,508190,456210,102700,358430,562650,2658710,359850,342280,413460,257630,1056600,371500,258700,2083040,644570,61700,358330,386320,358280,333220,358420,358170,526920,557780,358440,358180,1131720,611260,46460,389850,384400,1226470,252290,219340,895040,2606170,419590,349720,346320,536930,1904310,268830,407060,684460,2347110,6100,506140,404620,539380,368720,335080,816020,1033170,2107670,2524680,2811970,1063360,287860,2321580,337180,341780,209120,1952360,239660,586980,24870,322910,402430,735850,416130,636040,232450,1067800,1265860,1385460,331370,337950,349700,358640,250660,368650,1089350,299030,1596380,892510,385490,286940,1652950,539640,37100,781230,445840,300040,2301790,316390,45700,12340,390670,203250,1935570,544190,637960,466830,825190,347030,330570,1997230,651150,432290,728540,18110,1030760,2614720,346370,1128630,391630,922250,579040,564750,226580,412400,253190,330000,2113430,1371480,2090230,1436650,1209040,572300,405370,436300,1704760,699760,419500,423840,322920,3086510,338180,874240,3182450,520530,622170,2973490,315440,307600,47920,611360,454080,2204230,468000,1401530,432260,359290,2241570,1323480,568440,416350,1194250,585630,24470,871120,1995730,280460,485120,513440,854740,2750960,297100,1801560,410290,265670,1687760,782460,706400,1190340,280440,212580,1367020,45000,547470,1359300,11560,341860,1259970,399000,290710,510330,921060,418280,353130,2277780,211880,1558330,1867430,712840,402570,376570,1119480,3120820,383520,340540,645480,346610,578600,1605890,560380,987800,1851350,1406040,2197700,757130,2334220,723780,1853380,331660,333860,230310,583740,1617790,1242790,489460,1127980,626010,729330,2700,1149560,248410,1941980,705220,297090,200050,1265730,286730,1782680,1234290,774711,263080,2485640,1721830,1631250,2361400,1702320,2920830,1037480,280910,1284240,893520,1547990,369400,798730,621880,1212330,266550,349580,336790,1214320,2779850,660830,931070,2008060,629210,439350,646380,340120,302850,712050,2254920,2263550,9930,773170,505700,1163480,878940,877840,1418100,312370,1934780,432180,3054340,562840,327690,1209300,365190,1606570,1171140,350020,1248650,1297720,465650,354640,1245570,2305930,838900,1457150,690510,90500,446270,1821520,1791620,1308650,623820,790160,2457040,73060,619080,1577970,1230430,628720,2947380,343750,336520,1098400,914700,357480,336250,2353450,1678600,2850400,550900,293300,370240,1375740,1421230,711990,876330,2287920,335330,1180630,1279580,348530,362070,33420,1508730,227800,455700,3370,686190,1788110,374670,771580,1248990,685950,1862940,2404020,856620,458680,1605550,1582500,2576960,1823360,382900,291450,562800,1269870,1506530,539650,1503540,1150850,2058950,21970,2442810,737010,772530,810580,3208830,215120,202070,454600,391040,2359850,1289780,1484550,270410,665180,680040,1412510,2350180,284290,2436210,431220,253130,1200990,387960,376110,1519310,2293600,1224720,2549670,737500,247580,535850,546830,511670,1152840,2461800,2460430,291150,590830,2730640,418310,326230,2133670,511750,1561750,360590,229100,1165290,670350,416260,838510,497560,2709590,2005810,1204870,387070,1518680,1269600,750400,1542100,221360,2778550,381090,350510,2392490,2839010,2247560,2399850,1850480,2877220,461490,838330,1044200,1913730,606140,809960,1560500,1074820,891860,404290,739000,2018990,370800,2430870,639450,250740,382890,366040,1805360,1091260,2882810,1575910,223280,2484990,2459280,720090,1477630,1700700,1509420,232810,422420,1259230,3164240,1326700,2586870,281690,404050,435600,2006440,242570,346400,2668680,546810,2363270,467060,2119490,2629810,882070,378020,1581940,2121680,2954600,1225060,2180300,898590,1907430,3056060,344880,1387510,592890,2569480,2221940,1461220,746280,385020,384950,1242700,920470,674690,1145100,1106750,2073930,2377960,1098490,2225970,377970,1757880,345890,609990,1714850,1590900,315600,1408680,483260,956870,796430,339860,529480,3081700,1168000,524970,320840,384840,2326990,97100,2437160,32670,2214080,942310,686180,2216280,2182500,1106850,1668170,713440,2199920,376310,1648210,369230,1515180,2212060,2088180,1494950,960330,2841350,1628750,1274540,1675590,449470,394380,1648550,1685530,1890480,2506950,266150,2306580,1606130,1234040,1905810,1609100,360950,393410,1792450,352460,580910,1474410,676490,1909290,1555380,510190,905450,2340910,70210,404370,410380,440330,2051250,508450,1201940,1305000,1442910,488460,1508490,1708330,2015140,2402420,2099770,1444670,1734770,2920690,1484680,1335210,3134640,2004340,1117350,1360940,690250,2836280,393230,2564640,663920,1036340,368980,356370,2388170,259020,454910,2057370,1632880,200630,2089720,1729700,1218950,2378870,434120,1453730,2796130,319150,2385890,1491550,251890,336040,366810,2098620,1074680,455340,446030,354650,2163810,1829340,2325900,966760,2317910,863420,258240,2837110,1391000,690610,1582620,545230,2098650,1983060,2156070,1717990,1460800,2141230,585340,1813150,2946880,2424880,316720,384330,2882700,2613400,329020,2660620,441020,843930,1662060,378930,1309500,1623620,2199240,2304130,2882800,811540,1026060,2595310,974520,2390140,1983940,2315660,45720,957830,267550,680320,1267350,1594900,1734500,2771200,312510,465710,299640,1889710,1493260,2137770,327650,614940,335890,2502350,2544000,2302650,515220,3083470,670900,385460,241560,2741290,1979820,342130,1945810,743090,2815120,434410,1895280,1727070,327520,1440090,570350,681140,467120,1998140,1670230,2367980,493370,2325330,1189430,246700,940290,2355920,3154630,454680,1379750,2170420,340130,1679670,646440,1456750,1966290,1173950,253490,403170,489700,2446880,2218960,922560,984690,2166320,2373160,2066250,3075350,2947890,2533930,2199750,2661100,752690,1332150,516410,428760,382000,474870,2802550,3068430,3110330,1598410,330110,293520,1865700,1225220,533320,2507410,2973660,1897130,2739460,407120,1949050,1236390,385680,1490010,884220,2920980,1593250,1373270,868470,3056550,1619040,1731590,332650,2192720,498710,836870,577210,1094710,698740,296300,677880,2510560,914510,2078130,416020,802960,788130,1443350,924810,1527070,759510,2879560,1541760,2280270,1904130,920690,558320,2857560,3099020,386350,1887000,2435760,1722270,1278670,2183010,2860220,428420,2520880,361400,1675970,2767970,726990,1585350,1358860,1422150,739960,468250,886160,47730,594770,429020,1104640,205090,545650,875480,2989720,461680,916820,250640,2258870,2634990,327500,681660,547010,503530,2577640,315670,738500,1254540,970550,2206830,1599760,250280,1019250,368800,1401920,919300,1637910,1084630,2232710,392040,1064590,1153700,2174030,2654760,2001960,2765030,796400,2856080,1638100,347410,873910,2601600,2417360,2234030,1872350,2024140,1577770,1515610,2668350,1507570,405980,2016940,863210,371310,703870,317760,513650,307430,337110,322600,319730,1901350,616090,1057240,371120,833640,2690220,1772130,2706730,1400510,416670,3095080,1304450,2581970,420910,367600,2058240,385470,3122300,1421160,759970,3025120,2839990,1759580,1363470,776080,625010,2950720,432610,1124980,448520,3385740,1265240,1591190,2803100,1424930,2202990,851290,2061680,492340,385890,521450,861920,1157330,2057420,648430,409370,487620,223670,493770,589740,2547790,543360,456000,749270,1637410,348710,1518750,839890,1809650,2655320,2668250,1258870,1234810,3167510,415660,326630,1385300,2321610,1264500,403840,915580,412450,1349380,1432220,675560,394450,512600,2659030,2128350,1739970,365930,3108680,2596620,1404500,887830,375420,719430,332970,2394880,1338650,2106640,2143180,1501980,1045310,801220,1991140,3023390,1477530,1079420,2480450,1843430,2360410,539190,272670,1685300,2511270,589430,1309830,24660,2742140,891090,1172140,1523290,2754770,759010,576380,879650,2214370,1222790,2131550,490490,2881890,1503090,398970,305460,1863910,2963250,1199640,438600,1092500,1335050,2279580,656120,3094130,3034140,2173180,254300,783140,1748180,377150,1963500,575090,2428510,1614920,2632220,558750,2410980,718310,575110,1193570,1441010,1337240,1964880,3081050,503410,948850,2862220,1365940,2793390,2106540,1286530,711530,548930,453000,2462690,988480,467430,2923440,1128910,567690,2689500,2550890,932250,1338610,923820,2706570,417730,1325610,2537340,2059400,1981130,485590,386010,3021280,2441250,1488380,3119650,775220,982510,453680,1791050,2534950,1521980,891520,1736570,3016170,2304550,2070390,1477860,2252420,2535620,255480,753110,2153740,1328190,2967390,409410,3072740,448090,1253950,522280,2189740,2450890,2769360,2195920,486540,532090,1360450,1931060,2979760,2496860,1873830,1832930,530740,998340,2910220,1166630,3062090,2574830,1685560,2646030,455290,2526720,733610,2303080,435460,2432680,803220,1316610,2859900,962070,389530,512610,2391760,513970,2707460,1788540,679270,548950,2337890,2576530,427040,404150,999730,2298530,2196070,1937220,2982600,1760080,2647860,2793360,1274450,2379530,3351960,2497550,570550,935270,1421960,534820,3554250,1620690,2215170,854110,3029650,470030,760400,2627050,773340,3112700,475250,2245920,1271140,1935110,333530,984220,2982800,1697400,71390,659570,1833050,3007020,2056250,1434610,2686760,2841520,607200,867090,1137180,1393030,851000,3229180,2445600,399660,1834340,486840,325600,1065160,1798140,587390,1754050,1608170,2725160,1787550,1817380,3069570,2780,409130,2310180,1469250,2096470,691060,2585400,2731350,1598350,680340,3041240,347080,272490,1258970,431360,1200280,603080,383070,451230,551680,2932610,752300,3439150,563570,1087730,397360,514550,27330,497270,1223680,339900,2721920,2484450,3627820,885180,3071180,436350,1714620,822770,1869220,1755120,2360220,1441880,890110,707680,3171310,953370,574910,1532840,1251190,1604260,354910,1136880,504730,3065690,366860,1334760,3125490,1825340,3072750,375720,264260,953250,1855830,498300,600280,1275380,510630,236470,862660,344240,740190,1422300,3104160,803360,745550,517110,520820,754020,989000,2840430,1810240,334290,1390480,2180530,2589790,444860,870000,849920,2183540,957350,320890,421110,561110,589260,1106080,421180,1655660,3069940,1898320,1982750,2938200,1210360,682420,978840,312270,906200,697010,810540,973130,929330,1292220,1674470,3025660,458960,2438130,838420,832550,793680,1433330,2173150,719610,675230,1337100,1053060,1843420,755770,1249520,703950,1639500,2256720,1601830,527730,3087570,895150,565880,612240,412860,688110,469830,777640,1222130,360610,2871760,2214710,1306100,815250,970620,994590,1276730,725400,33750,577700,2877160,851010,348820,907890,457230,1505240,3242420,1800640,688450,2715240,1251560,1359080,2388680,475470,70200,1257560,1456590,2733430,894900,259430,987450,300200,3179000,1378010,3187630,1396930,894920,431870,562590,509380,3389300,380700,384210,1186320,1796380,1255520,1339810,1933590,618260,838430,1524370,729740,1829030,1269720,2731200,1757870,814140,970370,1332610,1927310,695690,1883950,1144740,1942550,1445050,655020,494160,436070,1439300,282350,1510100,390540,412310,2939880,1690400,917610,239720,892690,805110,515740,956780,1512890,1034930,3076480,2588500,914030,2153990,3009510,807780,2712660,362060,433320,1474430,3073250,975030,242610,1883030,1172950,894310,1312150,960130,407510,433300,1795020,1424010,386400,820580,570910,2406130,2617940,411540,831520,283100,1391220,712410,1857910,1490310,1431340,588010,1419090,1421970,937730,807830,1282930,2331100,1157560,1682130,993870,844290,2289280,1833810,1296840,492660,2329720,1535480,2285600,802020,1780330,893040,1044310,236530,3134860,1603190,829390,1025580,1519130,1282600,591530,1015500,1394690,811860,786630,395150,875250,844300,815240,689570,760210,1090420,658320,1768620,1433100,1307920,914250,715220,876860,1653240,234530,1287290,406280,2465300,373080,854310,960300,1325290,2126420,844310,816660,785680,1764250,498390,787430,793950,1660570,847630,1140760,850960,1119560,787440,749780,1551240,787750,882620,786850,1135710,1190530,2343970,860580,953440,1463700,807790,855480,1479150,2149790,876870,1437010,434930,1230210,795140,1270990,759770,1356470,896700,665140,807950,792060,497570,44310,1937830,2985290,348850,1455110,862640,897390,678290,496480,3500410,526680,436060,289910,1119690,488680,523190,2164070,909060,769720,383190,34220,1533700,785690,987350,649900,1434220,432790,1066220,1042900,875360,828460,1976570,759800,816610,1232710,718540,921940,1016350,1962140,454430,969680,693750,1023020,936040,1611510,1692250,394830,21660,1100200,791570,929860,1179790,314860,952090,713760,471270,1588690,840290,1315390,33210,1027200,1242620,358460,529730,1267240,1784750,3440,712440,877190,2134620,878410,1383550,850950,1676980,1360010,2131990,672180,554670,759530,1831690,3400,701020,953990,898010,689650,765800,1856670,1283610,207890,1813210,1255060,603720,473780,867610,722070,561100,914390,350150,1361790,231670,33340,875260,231990,613250,787420,377200,1341230,261600,1546540,814920,602090,288290,1353120,753100,823710,950100,703760,963940,598680,807880,1978790,599060,815940,1884410,719720,2109550,906020,795530,875680,2011070,1516980,807890,1540560,1294300,831510,1103430,750660,513050,807910,948720,752310,709280,449100,595110,1790260,820750,1662660,807860,1828880,813240,706350,727430,813280,1350240,1976350,2471950,803010,1694180,799300,1352380,775920,2426330,1633280,1169340,391530,777660,486160,884200,885100,1790730,625140,1714740,210870,1256850,1004190,1636100,1084050,955250,537740,576690,1447580,853020,878400,1509950,871320,416070,360700,1024010,364260,788910,201760,291090,913970,1115820,862790,559990,1493750,935460,916980,587540,2275710,1364890,897400,1154570,896860,697020,592990,963050,1122510,1841680,663170,592580,331910,614100,726610,548450,365750,853230,858950,1433440,856380,561120,415890,1096970,632580,841300,978620,712790,779410,2864710,911260,63950,943630,482750,856410,1034890,924560,1106880,2902660,323610,1056390,482730,1187670,540160,965460,879260,504810,1047640,1025260,682620,850230,395890,1227800,808550,1083400,898540,1397220,781310,743370,440120,1325880,834060,613800,644110,1036970,660330,604190,841370,336010,920700,989540,553560,978290,505220,866280,777900,375960,1409000,321660,1097210,1075950,58510,866950,760300,1119870,982010,1232980,1039870,598820,1353790,734380,855490,718810,687280,861180,625000,708250,724340,514540,573680,533990,933120,460570,378120,845500,774731,1433540,556440,727090,1013360,798930,718790,628190,577800,217860,845440,1165720,877460,658420,277930,914160,553030,876460,3053510,1300160,814310,1612280,351040,813360,867600,1157350,390090,864920,647430,807940,878160,1389370,48210,765290,999540,864950,568600,649770,1210410,1119950,1219160,895080,352080,839620,935260,965060,967180,807820,1202760,375400,961730,1049040,657930,530070,1415660,898530,2009800,826580,968960,970670,1056500,1090190,808950,1552570,434740,587460,1046490,834070,956580,979170,966600,1117680,922080,601400,1400440,969630,619140,968990,994930,205590,715710,1017080,1733220,942320,951170,839540,1260480,1006390,856580,884830,1330260,732390,1289800,860570,968980,860190,780220,898940,935120,1708520,374050,866170,276770,904560,819080,1514910,1417530,962390,807960,1139670,614860,456610,1259280,1273700,1262030,823730,1114960,1307390,201020,743400,944100,817130,977450,1345730,2116280,1515020,751750,1484030,1399260,619290,389280,963110,1548650,549680,1484031,1008000,756410,1625520,757950,933700,785660,1637750,882280,2101560,969860,2176270,868810,868350,1626880,935450,842030,1576670,2125120,664430,927130,785670,1423880,949690,889210,755940,1273270,365980,1087280,938370,1452180,979520,1049950,1777930,1027140,1554960,1267530,1262960,1516510,2218420,1486170,831690,1047410,1133430,564490,970650,831980,1001760,1519350,299010,900870,933630,1365920,1455660,896730,1147670,19930,511440,475990,1091970,970690,303820,965840,933690,1084880,955470,789960,1936540,885090,890840,983890,926480,1134530,1345980,1321760,1282330,585290,1181340,1522010,1036540,1165670,1832670,1639660,1227910,845530,996830,1203030,1429300,1028780,1265520,1114050,316750,1446660,1001810,15310,1651440,885110,869120,893360,929080,1971690,1201640,988190,373920,1355230,2197950,2092810,1452650,961720,941150,1073360,987620,1434870,248270,1396260,1380210,569590,1572440,1118970,1180310,786020,970660,970680,949710,446560,1777670,524110,1391770,1368810,1221580,1503010,1054850,1402390,1131290,1598920,1334900,515980,2631470,1863310,1502250,1135410,1194770,884240,2231740,2104790,867570,812510,1934850,1711430,748150,2224860,1481030,1359870,441920,928460,2081200,1099980,3293040,421900,1254400,1740870,811900,370210,949330,1201710,1107170,1191190,2317760,1391160,1828890,1928910,1079780,548350,1399650,1698680,1488040,2156260,2875450,891050,1588650,1226690,2248580,245350,1448460,1841900,1796230,2248070,843650,702600,3024480,2055970,1783000,1898640,211140,3294840,2288580,240220,1449540,1354080,2291220,1427770,697810,601420];

var i = 1;
var m = /badges/.exec(document.URL);
if (m){
    m = /p=/.exec(document.URL);
    if (m){
        $('.profile_xp_block').before('<div><a href="javascript:void(0);" onclick="allcheck();">一键检查</a></div>');
        $('.profile_xp_block').before('<table id="b"></table>');
        $('.badge_row').each(function(k, v){
            var a = $(this).find('.badge_row_overlay');
            var app = 0;
            var url = '';
            if (a.length>0){
                url = $(a[0]).attr('href');
                m = /cards\/(\d+)/.exec(url);
                if (m)
                    app = m[1];
            }
            var text = $(this).find('.badge_progress_info:first').text();
            var f = list.indexOf(Number(app));
            if (f < 0)
                $('#b').append(`<tr><td class="${app}">${i++}</td><td class="${app}"><a target=_blank href="${url}">${app}</a></td><td class="${app}">${text}</td><td class="${app}" id="${app}" colspan="4"><a class="chk" href="javascript:void(0);" onclick="getcards2(${app}, '${url}');">检查</a></td></tr>`);
            else
                $('#b').append(`<tr style="background-color:red;"><td class="${app}">${i++}</td><td class="${app}"><a target=_blank href="${url}">${app}</a></td><td class="${app}">${text}</td><td class="${app}" id="${app}" colspan="4">游戏已下架</td></tr>`);

        });
    } else {
        var lv = Math.floor($('.friendPlayerLevelNum').text() / 10) + 1;
        var xp = $('.profile_xp_block_xp').text().replace(/,/, '');
        m = /\d+/.exec(xp);
        if (m){
            xp = 0;
            for(i=1;i<=lv;i++)
                xp += i * 1000;
            xp -= m[0];
            $('.profile_small_header_text').append('Lvl:&nbsp;' + lv * 10);
            $('.profile_small_header_text').append('&nbsp;Exp:&nbsp;' + xp);
            var cd = Math.ceil(xp/100) - $('.badge_craft_button').length;
            $('.profile_small_header_text').append('&nbsp;Card:&nbsp;' + cd);

            $('.profile_xp_block').before('<table id="b"></table>');
            $('.badge_craft_button').each(function(k, v){
                m = /gamecards\/(\d+)/.exec($(v).attr('href'));
                $('#b').append(`<tr id="${m[1]}"><td>${k}</td><td><a href="javascript:void(0);" onclick="craftcard(${m[1]});">${m[1]}</a></td><td></td></tr>`);
            });
        }
    }
} else {
    m = /gamecards\/(\d+)/.exec(location.href);
    var id = m[1];
    var collect = $('.badge_cards_to_collect').html();
    i = 0;
    $('.badge_detail_tasks_rule').after(`<table><tr><td class="${id}" id="${id}" colspan=5></td></tr></table>`);
    $('.badge_detail_tasks_rule').after(`<div><a target=_blank href="/my/gamecards/${id}/">徽章</a> <a target=_blank href="/my/gamecards/${id}/?border=1">闪亮徽章</a> <a target=_blank href="/market/search?appid=753&category_753_Game[]=tag_app_${id}">市场</a></div>`);
    $('.badge_title_stats_drops').append(`<a target=_blank href="https://www.steamcardexchange.net/index.php?gamepage-appid-${id}"><img src="https://www.google.com/s2/favicons?sz=16&domain=steamcardexchange.net" /></a>`);
    checkCards(id, document.body.innerHTML);
}

function checkCards(id, html)
{
    var buy, sell;
    var m = html.match(/multi(buy|sell)[^"]+/ig);
    switch (m.length){
        case 1:
            if (/sell/.exec(m)) {
                buy = m[0].replace('multisell?appid=753&amp;contextid=6','multibuy?appid=753').replace(/qty\[\]=\d+/g, 'qty[]=1');
                sell = m[0];
            } else{
                buy = m[0];
            }
            break;

        case 2:
            sell = m[0];
            buy = m[1];
            break;

        default:
            return;
    }
    var div = document.createElement('div');
    div.innerHTML = `/market/${buy}`;
    buy = div.innerText;
    div.innerHTML = `/market/${sell}`;
    sell = div.innerText;
    var array=[], b=[], p2=0, l;
    $.ajax({
        url: buy,
        type: 'GET',
        async: false,
        crossDomain: true,
        xhrFields: {
            withCredentials: true
        }
    }).done(function (data) {
        var ms = data.match(/var (g_rgAssets|g_rgItemNameIds|g_rgMarketHashNames).*/ig);
        eval(ms.join(' '));
        l = g_rgItemNameIds.length;
        if (l > 0)
            $(`.${id}`).attr('rowspan', l + 2);
        ms = data.matchAll(/(\d+)_name', (\d+), '(\d+)', '(\d+)'/g);
        for(const m of ms){
            var g = g_rgAssets[m[2]][m[3]][m[4]];
            var p = $(data).find(`#buy_${m[1]}_price:first`).val();
            var p1 = Number(p.replace(/[^0-9]/g, ''));
            $(`#${id}`).parent().after(`<tr class="b${id}"><td id="${m[1]}_name"><a target=_blank href="/market/listings/753/${g.market_hash_name}">${g.market_name}</a></td><td id="${m[1]}_buy">${p}</td><td id="${m[1]}_sell"></td><td id="${m[1]}_qty"></td><td id="${m[1]}_note"></td></tr>`);
            if(g.item_expiration)
                $(`#${m[1]}_name`).attr("title", new Date(g.item_expiration).toLocaleString());
            var f = true;
            if (g.marketable) {
                $(`#${m[1]}_buy`).wrapInner(`<a href="javascript:void(0);" onclick="createbuyorder('${g.market_hash_name}',${p1},${m[1]});"></a>`);
            } else {
                $(`#${m[1]}_name`).css("background-color", "yellow");
                f = false;
            }
            array[m[1]] = {'h':g.market_hash_name, 'b': p1, 'f': f};
        }
    }).fail(function (xhr) {

    });

    $.ajax({
        url: sell,
        type: 'GET',
        async: false,
        crossDomain: true,
        xhrFields: {
            withCredentials: true
        }
    }).done(function (data) {
        var ms = data.match(/var (g_rgAssets|g_rgItemNameIds|g_rgMarketHashNames).*/ig);
        eval(ms.join(' '));
        ms = data.matchAll(/(\d+)_name', (\d+), '(\d+)', '(\d+)'/g);
        for(const m of ms){
            var g = g_rgAssets[m[2]][m[3]][m[4]].description;
            var p = $(data).find(`#sell_${m[1]}_price_paid:first`).val();
            var p1 = Number(p.replace(/[^0-9]/g, ''));
            var q = $(data).find(`#sell_${m[1]}_qty:first`).val();
            if (q == 0) {
                p2 += array[m[1]]['b'] / 100;
                b.push({h : g.market_hash_name, p : array[m[1]]['b'], k: m[1]});
                $(`#${m[1]}_qty`).css("background-color","red");
            }
            $(`#${m[1]}_sell`).append(p);
            $(`#${m[1]}_qty`).append(`<a target=_blank href="/market/multisell?appid=753&contextid=6&items[]=${g.market_hash_name}">${q}</a>`);
            array[m[1]]['s'] = p1;
            array[m[1]]['q'] = q;
        }
    }).fail(function (xhr) {
    });

    p2 = p2.toFixed(2);
    var j = JSON.stringify(b).replace(/'/g, '^').replace(/"/g, '\'');
    $(`#${id}`).parent().after(`<tr class="b${id}"><td><a target=_blank href="${buy}">剩余卡牌[${b.length}/${l}]</a></td><td id="${id}_buy">&yen;&nbsp;${p2}</td><td><a href="javascript:void(0);" onclick="createbuyorder2(${j});">一键购买</a></td><td /><td /></tr>`);
    if (b.length > 0 && p2 < 2){
        if (p2 < 0.8)
            $(`#${id}_buy`).css("background-color","green");
        else if (p2 < 1.2)
            $(`#${id}_buy`).css("background-color","yellow");
        else if (p2 < 1.6)
            $(`#${id}_buy`).css("background-color","orange");
        else
            $(`#${id}_buy`).css("background-color","red");
    } else {
        $(`#${id}_buy`).css("background-color","red");
    }
}

unsafeWindow.allcheck =function(){
    $('.chk').each(function(i, k){
        setTimeout(function () {
            $(k).click();
        },5000 * i);
    });
}

unsafeWindow.getcards2 =function(id, url){
    var k = id;
    var v = $(`#${k}`);
    $(`.b${k}`).remove();
    $(`.${k}`).removeAttr('rowspan');
    //$(`#${k}`).attr('colspan', 5);
    //$(`#${id}`).css("background-color","yellow");
    $('html,body').animate({scrollTop: v.offset().top-100}, 100);
    $.ajax({
        url: url,
        type: 'GET',
        async: true,
        crossDomain: true,
        xhrFields: {
            withCredentials: true
        }
    }).done(function (data) {
        checkCards(id, data);
    }).fail(function (xhr) {
        v.css("background-color","red");
    });
}

unsafeWindow.createbuyorder2 = function(a){
    var c = a;
    $.each(c, function(i, v){
        setTimeout(createbuyorder, i++ * 2000, v.h, v.p, v.k, 0);
    });
}

unsafeWindow.createbuyorder = function(hash, p, id, co){
    hash = hash.replace(/\^/g, "'");
    var da = {
        sessionid: g_sessionID,
        currency: 23,
        appid: 753,
        market_hash_name: hash,
        price_total: p,
        tradefee_tax: 0,
        quantity: 1,
        billing_state: '',
        save_my_address: 0,
        confirmation: co
    };
    $(`#${id}_note`).empty();
    $(`#${id}_note`).append('正在购买 ...');
    $.ajax({
        url: '/market/createbuyorder/',
        type: 'POST',
        async: false,
        data: da,
        crossDomain: true,
        xhrFields: {
            withCredentials: true
        }
    }).done(function (data) {
        $(`#${id}_note`).empty();
        if (data.success === 1)
        {
            setTimeout(getbuyorderstatus, 3000, data.buy_orderid, id);
        }
        else
        {
            $(`#${id}_note`).append(data.message);
        }
    }).fail(function (xhr) {
        if (xhr.responseJSON.success == 22 && xhr.responseJSON.need_confirmation)
            $(`#${m[1]}_buy`).wrapInner(`<a href="javascript:void(0);" onclick="createbuyorder('${hash}',${p},${id}, ${xhr.data.confirmation_id});">确认后购买</a>`);
        else
            $(`#${id}_note`).append(xhr.responseJSON.message);
    });
}

unsafeWindow.getbuyorderstatus = function(buy_orderid, id){
    $.ajax({
        url: '/market/getbuyorderstatus/',
        type: 'GET',
        async: false,
        data: {
            sessionid: g_sessionID,
            buy_orderid: buy_orderid
        }
    }).done(function (data) {
        $(`#${id}_note`).empty();
        if (data.success === 1) {
            $(`#${id}_note`).append(buy_orderid);
            $(`#${id}_qty`).css("background-color","green");
        }
        else
            $(`#${id}_note`).append(data);
    }).fail(function (xhr) {
        alert(xhr);
    });
}

unsafeWindow.craftcard = function(id){
    var w = `#${id}`;
    var da = {
        appid: id,
        series: 1,
        border_color: 0,
        sessionid: g_sessionID
    };
    $.ajax({
        url: `/profiles/${g_steamID}/ajaxcraftbadge/`,
        type: 'POST',
        data: da
    }).done(function (data) {
        if (data.success === 1)
        {
            var d = data.Badge.unlocked_time;
            $(w).append(`<td><img src="${data.Badge.image}" /></td><td>${data.Badge.title} (${data.Badge.game})</td><td>${data.Badge.xp}</td>`);
            $.each(data.rgDroppedItems, function (i, item) {
                if (item.level)
                    $(w).append(`<td><span style="color:green;">${item.level} (${item.type})</span></td>`);
                else
                    $(w).append(`<td>${item.title} (${item.label})</td>`);
            });
        }
        else
        {
            $(w).append(data.message);
        }
    }).fail(function (xhr) {
        $(w).append(xhr);
    });
}
