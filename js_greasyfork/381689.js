// ==UserScript==
// @name         Neopets: Auto-Buyer (Magic)
// @namespace    https://greasyfork.org/en/users/248719-rotomdex
// @version      0.1
// @description  A Neopets Magic Shop item auto-clicker. To be used in conjunction with a Neopets Main Shop auto-haggler.
// @author       twitter.com/RotomDex
// @match        http://www.neopets.com/objects.phtml?type=shop&obj_type=2*
// @match        http://www.neopets.com/objects.phtml?obj_type=2*
// @grant        none
// @require      http://code.jquery.com/jquery-3.3.1.min.js
// @downloadURL https://update.greasyfork.org/scripts/381689/Neopets%3A%20Auto-Buyer%20%28Magic%29.user.js
// @updateURL https://update.greasyfork.org/scripts/381689/Neopets%3A%20Auto-Buyer%20%28Magic%29.meta.js
// ==/UserScript==

// mirror of https://raw.githubusercontent.com/hectorvazc/jsfun/master/jsfun.min.js
// just slap this in @require up there https://raw.githubusercontent.com/nerkmid/neo/master/jsfun.js
function find_selector(e,t) {var n=void 0===t?document.querySelectorAll(e):t.querySelectorAll(e);return console.assert(n.length,["find_selector:",e,t,"is undefined"].join(" ")),0===n.length?void 0:1===n.length?n[0]:n}
function isNode(e){return e instanceof Node}
function isNodeList(e){return e instanceof NodeList}
function fn(e){void 0!==e&&function(){e()}(this)}
function foreach(e,t){return void 0!==e&&void $array(e).forEach(function(e,n,i){t(e,n,i)})}
function $array(e){if(void 0===e)return[];var t=[],n=/^\[object (string)\]$/gi.test({}.toString.call(e))||/^\[object (htmlselectelement)\]$/gi.test({}.toString.call(e));return void 0===e.length||n?t.push(e):t=Array.from(e),t}
function $detach(e){var t=e.parentNode;if(t)return t.removeChild(e),e}
function bind_event(e,t,n,i){var i=i||"events",o="",s=[],r=$data(e,i);if(void 0!==r&&(o=e.dataset[i]),empty(o))s=[];else var s=getJSON(o);s.length>0&&s.indexOf(t)!==-1||(s.push(t),e.dataset[i]=setJSON(s),e.addEventListener(t,n))}
function empty(e){return 0===e.length||!e.trim()}
function $data(e,t){return e.dataset[t]}
function newElement(e){return document.createElement(e)}
function key_code(e){return parseInt(e.keyCode||e.which)}
function setJSON(e){return JSON.stringify(e)}function getJSON(e){return JSON.parse(e)}
function parent(e,t){if(void 0===t)return e.parentNode;for(var n=0;n<Number(t);n++)e=e.parentNode;return e}
function ajax(e,t,n){return new Promise(function(i,o){var s;s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s.open(e,t,!0),s.onload=i,s.onerror=o,void 0!==n?s.send(n):s.send()})}
function getObjectSession(e,t){var n=sessionStorage.getItem(e);return null===n?(void 0!==t&&(console.log("Saving default value"),setObjectSession(e,t)),t):getJSON(n)}
function removeObjectSession(e){void 0!==getObjectSession(e)&&(sessionStorage.removeItem(e),void 0===getObjectSession(e)&&console.log("object removed"))}
function setObjectSession(e,t){sessionStorage.setItem(e,setJSON(t))}
function getObject(e,t){var n=localStorage.getItem(e);return null===n?(void 0!==t&&(console.log("Saving default value"),setObject(e,t)),t):getJSON(n)}
function removeObject(e){void 0!==getObject(e)&&(localStorage.removeItem(e),void 0===getObject(e)&&console.log("object removed"))}
function setObject(e,t){localStorage.setItem(e,setJSON(t))}
var debFlag=!0,log=function(e,t){(void 0===t||t)&&debFlag&&console.log(e)},
    js=function e(t){return this instanceof e?(void 0!==t&&(isNode(t)||(t=find_selector(t))),this.element=t,this.context=void 0,this):new e(t)};
    js.prototype.get=function(){return this.context=void 0,this.element},
    js.prototype.getNode=function(e){var t=find_selector(e,this.context);return this.context=void 0,t},
    js.prototype.find=function(e){return this.element=find_selector(e,this.context),this.context=void 0,this},
    js.prototype.here=function(e){if(isNode(e))this.context=e;else{var t=find_selector(e);void 0===t?this.context=void 0:isNodeList(t)?this.context=t[0]:this.context=t}return this},
    js.prototype.html=function(e){return void 0===e?this.element.innerHTML:(this.element.innerHTML=e,this)},
    js.prototype.empty=function(){return this.element.innerHTML="",this},
    js.prototype.append=function(e){return this.element.innerHTML=[this.element.innerHTML,e].join(" "),this},
    js.prototype.exist=function(e){return void 0!==this.element},
    js.prototype.val=function(e){if(void 0!==this.element)return void 0===e?this.element.value:(this.element.value=e,this)},
    js.prototype.clean=function(){this.element=void 0,this.context=void 0},
    js.prototype.first=function(){return this.element=$array(this.element)[0],this},
    js.prototype.setAttribute=function(e){return"object"==typeof e&&(void 0!==this.element?foreach(this.element,function(t){for(var n in e)t.setAttribute(n,e[n])}):log("this.element is undefined. setAttribute call."),this)},
    js.prototype.removeAttribute=function(e){return void 0!==this.element?foreach(this.element,function(t){foreach(e,function(e){t.removeAttribute(e)})}):log("this.element is undefined. removeAttribute call."),this},
    js.prototype.addStyle=function(e){return"object"==typeof e&&(void 0!==this.element?foreach(this.element,function(t){for(var n in e)t.style.setProperty(n,e[n])}):log("this.element is undefined. addStyle call."),this)},
    js.prototype.removeStyle=function(e){return void 0!==this.element?foreach(this.element,function(t){foreach(e,function(e){t.style.removeProperty(e)})}):log("this.element is undefined. removeStyle call."),this},
    js.prototype.addClass=function(e){return void 0!==this.element?foreach(this.element,function(t){foreach(e,function(e){t.classList.add(e)})}):log("this.element is undefined. addClass call."),this},
    js.prototype.removeClass=function(e){return void 0!==this.element?foreach(this.element,function(t){foreach(e,function(e){t.classList.contains(e)&&t.classList.remove(e)})}):log("this.element is undefined. removeClass call."),this},
    js.prototype.hide=function(){return void 0!==this.element?foreach(this.element,function(e){e.style.setProperty("display","none")}):log("this.element is undefined. hide call."),this},
    js.prototype.show=function(){return void 0!==this.element?foreach(this.element,function(e){e.style.removeProperty("display")}):log("this.element is undefined. show call."),this},
    js.prototype.resize=function(){if(void 0!==this.element)return this.element.style.height="1px",this.element.style.height=this.element.scrollHeight+"px",this},
    js.prototype.text=function(){return void 0===this.element?"":this.element.innerText||this.element.textContent},
    js.prototype.insertFirst=function(e){if(void 0!==this.element)return this.element.insertAdjacentElement("afterbegin",e),this},
    js.prototype.insertLast=function(e){if(void 0!==this.element)return this.element.insertAdjacentElement("beforeend",e),this},
    js.prototype.insertBefore=function(e){if(void 0!==this.element)return this.element.insertAdjacentElement("beforebegin",e),this},
    js.prototype.insertAfter=function(e){if(void 0!==this.element)return this.element.insertAdjacentElement("afterend",e),this},
    js.prototype.detach=function(){if(void 0!==this.element){var e=[];return foreach(this.element,function(t){e.push($detach(t))}),e}},
    js.prototype.visible=function(){if(void 0!==this.element)return"none"!==this.element.style.display},
    js.prototype.hidden=function(){if(void 0!==this.element)return!this.visible()},
    js.prototype.each=function(e){void 0!==this.element?(foreach(this.element,e),this.clean()):log("this.element is undefined. show call.")},
    js.prototype.event=function(e,t,n){return void 0===this.element?(log("this.element is undefined. event call."),this):(foreach(this.element,function(i){foreach(e,function(e){bind_event(i,e,t,n)})}),void this.clean())};
// end required shit

var ItemsToIgnore = [
"Ubikiberry Elixir", "Nova", "Juicy Elixir", "Lime Elixir", "Supernova", "Weak Bottled Air Faerie", "Weak Bottled Fire Faerie", "Weak Bottled Water Faerie", "Pale Elixir", "Weak Bottled Dark Faerie", "Healing Springs Residue", "Weak Bottled Earth Faerie", "Unidentifiable Weak Bottled Faerie", "Lutari Healing Potion", "Zap Bottle", "Jar of Eyeballs", "Potion of Concealment", "Pressurised Water", "Starburst Bottle", "Weak Bottled Light Faerie", "Bombaberry Elixir", "Downpour Bottle", "Firestorm Bottle", "Tears of the Water Faerie", "Exploding Potion", "Flamestrike Bottle", "Wet Snowball Wand", "Slippery Floor Potion", "Poison Snowball Wand", "Fire Jug", "Starlight Potion", "Nanka Bottle", "Stream of Light", "Evil Snowball Wand", "Magic Vial", "Magic Wand", "Puce Elixir", "Tornado in a Bottle", "Green Ogrin Morphing Potion", "Blue Ogrin Morphing Potion", "Yellow Ogrin Morphing Potion", "Pirate Techo Morphing Potion", "Pirate Eyrie Morphing Potion", "Red Moehog Morphing Potion", "Red Ogrin Morphing Potion", "Brain Of Mirgle", "Steam Jug", "Green Kyrii Morphing Potion", "Eye Of Mortog", "Magic Hat", "Blue Xweetok Morphing Potion", "Bloodberry Elixir", "Christmas Magic Wand", "Orange Koi Morphing Potion", "Starry Grarrl Morphing Potion", "Split Mynci Morphing Potion", "Pirate Aisha Morphing Potion", "Vial of Vile", "Decanter of Death", "Brown Moehog Morphing Potion", "Golden Elephante Morphing Potion", "Purple JubJub Morphing Potion", "Blue Kyrii Morphing Potion", "Ghost Buzz Morphing Potion", "Red Poogle Morphing Potion", "Carafe of Corruption", "Slorg Slime", "Orange Kougra Morphing Potion", "Green Uni Morphing Potion", "Strawberry Wocky Morphing Potion", "Blue Mynci Morphing Potion", "Speckled Moehog Morphing Potion", "Green Eyrie Morphing Potion", "Illusen Day Elixir", "Green Mynci Morphing Potion", "Camouflage Techo Morphing Potion", "Blue Moehog Morphing Potion", "Yellow Eyrie Morphing Potion", "Rejuvenating Negg Serum", "Checkered Koi Morphing Potion", "Potion of Pestilence", "Camouflage JubJub Morphing Potion", "Yellow Uni Morphing Potion", "Red JubJub Morphing Potion", "Starry Techo Morphing Potion", "Blue JubJub Morphing Potion", "Checkered Techo Morphing Potion", "Green Pteri Morphing Potion", "Green Yurble Morphing Potion", "Red Kyrii Morphing Potion", "Spotted Grarrl Morphing Potion", "Red Uni Morphing Potion", "Camouflage Meerca Morphing Potion", "Brown Techo Morphing Potion", "Camouflage Kyrii Morphing Potion", "Cloud Wocky Morphing Potion", "Yellow Xweetok Morphing Potion", "Spotted Eyrie Morphing Potion", "Yellow Techo Morphing Potion", "Spotted Scorchio Morphing Potion", "Blue Techo Morphing Potion", "Starry Flotsam Morphing Potion", "Yellow JubJub Morphing Potion", "Yellow Kyrii Morphing Potion", "Green Moehog Morphing Potion", "Starry Pteri Morphing Potion", "Yellow Meerca Morphing Potion", "White Grarrl Morphing Potion", "Green Xweetok Morphing Potion", "Split Grarrl Morphing Potion", "Yellow Koi Morphing Potion", "Blue Meerca Morphing Potion", "Fire Flotsam Morphing Potion", "Red Meerca Morphing Potion", "Yellow Kougra Morphing Potion", "Camouflage Mynci Morphing Potion", "Yellow Yurble Morphing Potion", "Yellow Pteri Morphing Potion", "Yellow Flotsam Morphing Potion", "Blue Flotsam Morphing Potion", "Camouflage Wocky Morphing Potion", "Tyrannian Nimmo Morphing Potion", "Pirate Ogrin Morphing Potion", "Purple Yurble Morphing Potion", "Yellow Moehog Morphing Potion", "Camouflage Tuskaninny Morphing Potion", "Red Pteri Morphing Potion", "Zombie Flotsam Morphing Potion", "Camouflage Scorchio Morphing Potion", "Red Flotsam Morphing Potion", "Yellow Quiggle Morphing Potion", "Christmas Ogrin Morphing Potion", "Cloud Pteri Morphing Potion", "Green Techo Morphing Potion", "Green Tonu Morphing Potion", "Starry Tuskaninny Morphing Potion", "Strawberry Mynci Morphing Potion", "Red Tonu Morphing Potion", "Starry Bori Morphing Potion", "Green Elephante Morphing Potion", "Green Koi Morphing Potion", "Skunk Mynci Morphing Potion", "Blue Korbat Morphing Potion", "Electric Tuskaninny Morphing Potion", "Fire Grarrl Morphing Potion", "Fire Techo Morphing Potion", "Halloween Tonu Morphing Potion", "Red Vandagyre Morphing Potion", "Red Xweetok Morphing Potion", "Starry Koi Morphing Potion", "Yellow Mynci Morphing Potion", "Rainbow Tuskaninny Morphing Potion", "Red Kougra Morphing Potion", "Blue Scorchio Morphing Potion", "Blue Pteri Morphing Potion", "Blue Yurble Morphing Potion", "Green Flotsam Morphing Potion", "Purple Techo Morphing Potion", "Red Koi Morphing Potion", "Red Scorchio Morphing Potion", "Red Tuskaninny Morphing Potion", "Yellow Tuskaninny Morphing Potion", "Zombie Blumaroo Morphing Potion", "Spotted Pteri Morphing Potion", "Fire Buzz Morphing Potion", "Starry Korbat Morphing Potion", "Orange Tuskaninny Morphing Potion", "Electric Moehog Morphing Potion", "Ghost Gnorbu Morphing Potion", "Yellow Tonu Morphing Potion", "Blue Elephante Morphing Potion", "Ghost Ogrin Morphing Potion", "Green Gnorbu Morphing Potion", "Rainbow Bori Morphing Potion", "Snowy Flotsam Morphing Potion", "Strawberry Meerca Morphing Potion", "Yellow Gnorbu Morphing Potion", "Rainbow Ogrin Morphing Potion", "Blue Eyrie Morphing Potion", "Blue Gnorbu Morphing Potion", "Green Meerca Morphing Potion", "Orange Yurble Morphing Potion", "Red Mynci Morphing Potion", "Zombie JubJub Morphing Potion", "Spotted Nimmo Morphing Potion", "Pirate Bori Morphing Potion", "Skunk Kyrii Morphing Potion", "Cloud Grarrl Morphing Potion", "Green Vandagyre Morphing Potion", "Blue Kougra Morphing Potion", "Purple Pteri Morphing Potion", "Strawberry Tuskaninny Morphing Potion", "Fire Ogrin Morphing Potion", "Gold Scorchio Morphing Potion", "Red Quiggle Morphing Potion", "Tyrannian Ogrin Morphing Potion", "Red Nimmo Morphing Potion", "Green JubJub Morphing Potion", "Starry Scorchio Morphing Potion", "Spotted Bori Morphing Potion", "Island Pteri Morphing Potion", "Red Elephante Morphing Potion", "Red Gnorbu Morphing Potion", "Striped Flotsam Morphing Potion", "Blue Koi Morphing Potion", "Blue Tonu Morphing Potion", "Blue Vandagyre Morphing Potion", "Starry Yurble Morphing Potion", "Starry Uni Morphing Potion", "Starry Xweetok Morphing Potion", "Speckled Shoyru Morphing Potion", "Split Flotsam Morphing Potion", "Spotted Shoyru Morphing Potion", "Strawberry Techo Morphing Potion", "Blue Buzz Morphing Potion", "Cloud Lenny Morphing Potion", "Yellow Elephante Morphing Potion", "Starry Wocky Morphing Potion", "Blue Nimmo Morphing Potion", "Brown Kougra Morphing Potion", "Pirate Meerca Morphing Potion", "Pirate Pteri Morphing Potion", "Rainbow Korbat Morphing Potion", "Spotted Korbat Morphing Potion", "Tyrannian Bori Morphing Potion", "Yellow Grarrl Morphing Potion", "Blue Tuskaninny Morphing Potion", "Red Wocky Morphing Potion", "Sketch Peophin Morphing Potion", "Desert Ogrin Morphing Potion", "Pirate Flotsam Morphing Potion", "Blue Poogle Morphing Potion", "Blue Wocky Morphing Potion", "Glowing Koi Morphing Potion", "Red Techo Morphing Potion", "Speckled Bori Morphing Potion", "Brown Lenny Morphing Potion", "Yellow Peophin Morphing Potion", "Silver Shoyru Morphing Potion", "Striped Aisha Morphing Potion", "Yellow Vandagyre Morphing Potion", "Red Korbat Morphing Potion", "Yellow Shoyru Morphing Potion", "Starry Shoyru Morphing Potion", "Red Buzz Morphing Potion", "Blue Grarrl Morphing Potion", "Striped Nimmo Morphing Potion", "Striped Scorchio Morphing Potion", "Split Lenny Morphing Potion", "Rainbow Quiggle Morphing Potion", "Pink Ogrin Morphing Potion", "Yellow Buzz Morphing Potion", "Skunk Buzz Morphing Potion", "Green Nimmo Morphing Potion", "Skunk Flotsam Morphing Potion", "Red Grarrl Morphing Potion", "Yellow Wocky Morphing Potion", "Checkered Shoyru Morphing Potion", "Green Kougra Morphing Potion", "Swamp Gas Ogrin Morphing Potion", "Green Buzz Morphing Potion", "Pink Kyrii Morphing Potion", "Christmas Elephante Morphing Potion", "Yellow Korbat Morphing Potion", "Desert Tuskaninny Morphing Potion", "Yellow Kau Morphing Potion", "Checkered Bori Morphing Potion", "Blue Bori Morphing Potion", "Blue Quiggle Morphing Potion", "Red Eyrie Morphing Potion", "Green Grundo Morphing Potion", "Shadow Tonu Morphing Potion", "Christmas Lenny Morphing Potion", "White Kyrii Morphing Potion", "Striped Tuskaninny Morphing Potion", "Glowing Poogle Morphing Potion", "Rainbow Grarrl Morphing Potion", "Red Yurble Morphing Potion", "Starry Eyrie Morphing Potion", "Swamp Gas Techo Morphing Potion", "Green Shoyru Morphing Potion", "Christmas JubJub Morphing Potion", "Christmas Magic Hat", "Desert Buzz Morphing Potion", "Gold Shoyru Morphing Potion", "Green Korbat Morphing Potion", "Dimensional Moehog Morphing Potion", "Strawberry Pteri Morphing Potion", "Speckled Kau Morphing Potion", "Starry Nimmo Morphing Potion", "Striped Korbat Morphing Potion", "Pink Peophin Morphing Potion", "Yellow Nimmo Morphing Potion", "Blue Uni Morphing Potion", "Blue Peophin Morphing Potion", "Red Shoyru Morphing Potion", "Red Lenny Morphing Potion", "Snow Bori Morphing Potion", "Green Tuskaninny Morphing Potion", "Cloud Elephante Morphing Potion", "Speckled Xweetok Morphing Potion", "Electric Grarrl Morphing Potion", "Fire Tuskaninny Morphing Potion", "Green Bori Morphing Potion", "Red Peophin Morphing Potion", "Camouflage Lenny Morphing Potion", "Fire Kyrii Morphing Potion", "Green Peophin Morphing Potion", "Purple Peophin Morphing Potion", "Cloud Peophin Morphing Potion", "Purple Grundo Morphing Potion", "Green Poogle Morphing Potion", "Rainbow Gnorbu Morphing Potion", "Rainbow Grundo Morphing Potion", "Fire Yurble Morphing Potion", "Green Aisha Morphing Potion", "Green Grarrl Morphing Potion", "Red Aisha Morphing Potion", "Blue Grundo Morphing Potion", "Christmas Blumaroo Morphing Potion", "Christmas Bruce Morphing Potion", "Christmas Peophin Morphing Potion", "Eventide Lenny Morphing Potion", "Pink Koi Morphing Potion", "Red Kau Morphing Potion", "Shadow Shoyru Morphing Potion", "Yellow Grundo Morphing Potion", "Fire Moehog Morphing Potion", "Pink Pteri Morphing Potion", "Pirate Usul Morphing Potion", "Shadow Korbat Morphing Potion", "Silver Peophin Morphing Potion", "Christmas Gnorbu Morphing Potion", "Desert Chia Morphing Potion", "Snow Eyrie Morphing Potion", "Rainbow Shoyru Morphing Potion", "Blue Aisha Morphing Potion", "Yellow Aisha Morphing Potion", "Fire Gnorbu Morphing Potion", "Brown Grundo Morphing Potion", "Pink Korbat Morphing Potion", "Yellow Lenny Morphing Potion", "Ghost Lenny Morphing Potion", "Green Lenny Morphing Potion", "Purple Shoyru Morphing Potion", "Cloud Eyrie Morphing Potion", "Striped Blumaroo Morphing Potion", "Chomby Staff", "Faerie Flotsam Morphing Potion", "Ghost Techo Morphing Potion", "Green Kau Morphing Potion", "Rainbow Kyrii Morphing Potion", "Snow Chia Morphing Potion", "Glowing Korbat Morphing Potion", "Green Quiggle Morphing Potion", "Striped Grarrl Morphing Potion", "Fire Nimmo Morphing Potion", "Starry Usul Morphing Potion", "Striped Chia Morphing Potion", "Purple Tonu Morphing Potion", "Striped Kau Morphing Potion", "Tyrannian Usul Morphing Potion", "Speckled Bruce Morphing Potion", "Starry Kau Morphing Potion", "Blue Lenny Morphing Potion", "Pirate Grundo Morphing Potion", "Tyrannian Flotsam Morphing Potion", "Cloud Scorchio Morphing Potion", "Pink Eyrie Morphing Potion", "Cloud Grundo Morphing Potion", "Fire Kau Morphing Potion", "Cloud Bori Morphing Potion", "Snow Aisha Morphing Potion", "Rainbow Uni Morphing Potion", "Strawberry Bruce Morphing Potion", "Striped Meerca Morphing Potion", "Green Kiko Morphing Potion", "Pirate Yurble Morphing Potion", "Tyrannian Eyrie Morphing Potion", "Woodland Acara Morphing Potion", "Ghost Korbat Morphing Potion", "Red Blumaroo Morphing Potion", "Christmas Acara Morphing Potion", "Christmas Kiko Morphing Potion", "Ghost Kiko Morphing Potion", "Ghost Peophin Morphing Potion", "Red Acara Morphing Potion", "Spotted Blumaroo Morphing Potion", "Blue Usul Morphing Potion", "Blue Shoyru Morphing Potion", "Cloud Bruce Morphing Potion", "Yellow Bori Morphing Potion", "Fire Aisha Morphing Potion", "Spotted Grundo Morphing Potion", "White Flotsam Morphing Potion", "Cloud Shoyru Morphing Potion", "Striped Ixi Morphing Potion", "Fire Poogle Morphing Potion", "Checkered Acara Morphing Potion", "Desert Gnorbu Morphing Potion", "Purple Aisha Morphing Potion", "Purple Eyrie Morphing Potion", "Green Wocky Morphing Potion", "Red Bruce Morphing Potion", "Tyrannian Ixi Morphing Potion", "Purple Poogle Morphing Potion", "Christmas Koi Morphing Potion", "Skunk Eyrie Morphing Potion", "Snow Bruce Morphing Potion", "Spotted Flotsam Morphing Potion", "Fire Bori Morphing Potion", "White Shoyru Morphing Potion", "Christmas Chia Morphing Potion", "Desert Grundo Morphing Potion", "Disco Acara Morphing Potion", "Ghost Tuskaninny Morphing Potion", "Pirate Lenny Morphing Potion", "Desert Kyrii Morphing Potion", "Snow Techo Morphing Potion", "Split Bruce Morphing Potion", "Split Chia Morphing Potion", "Green Blumaroo Morphing Potion", "Red Usul Morphing Potion", "Tyrannian Gnorbu Morphing Potion", "Cloud Acara Morphing Potion", "Green Usul Morphing Potion", "Shadow Lenny Morphing Potion", "Ghost Grarrl Morphing Potion", "Blue Blumaroo Morphing Potion", "Eventide Korbat Morphing Potion", "Green Acara Morphing Potion", "Island Ogrin Morphing Potion", "Blue Kau Morphing Potion", "Brown Bruce Morphing Potion", "Purple Uni Morphing Potion", "Checkered Kiko Morphing Potion", "Christmas Grundo Morphing Potion", "Christmas Scorchio Morphing Potion", "Green Ixi Morphing Potion", "Island Koi Morphing Potion", "Woodland Peophin Morphing Potion", "Pirate Gnorbu Morphing Potion", "Yellow Blumaroo Morphing Potion", "Snow Peophin Morphing Potion", "Starry Skeith Morphing Potion", "Yellow Kiko Morphing Potion", "Yellow Skeith Morphing Potion", "Blue Chia Morphing Potion", "Gold Tonu Morphing Potion", "Pirate Draik Morphing Potion", "Christmas Shoyru Morphing Potion", "Green Chia Morphing Potion", "Water Flotsam Morphing Potion", "Rainbow Koi Morphing Potion", "Rainbow Poogle Morphing Potion", "Tyrannian JubJub Morphing Potion", "Disco Moehog Morphing Potion", "Pirate Krawk Morphing Potion", "Cloud Poogle Morphing Potion", "Rainbow Wocky Morphing Potion", "Faerie Eyrie Morphing Potion", "Yellow Acara Morphing Potion", "Brown Uni Morphing Potion", "Checkered Aisha Morphing Potion", "Woodland Skeith Morphing Potion", "Halloween Korbat Morphing Potion", "Shadow Skeith Morphing Potion", "Fire Acara Morphing Potion", "Island Korbat Morphing Potion", "Starry Grundo Morphing Potion", "Fire Pteri Morphing Potion", "Disco Mynci Morphing Potion", "Ghost Elephante Morphing Potion", "Green Skeith Morphing Potion", "Rainbow Flotsam Morphing Potion", "Red Bori Morphing Potion", "Island Acara Morphing Potion", "Woodland Lenny Morphing Potion", "Blue Kiko Morphing Potion", "Faerie Skeith Morphing Potion", "Starry Bruce Morphing Potion", "Christmas Wocky Morphing Potion", "Blue Acara Morphing Potion", "Disco Chomby Morphing Potion", "Yellow Chomby Morphing Potion", "Christmas Kougra Morphing Potion", "Dimensional Shoyru Morphing Potion", "Rainbow Aisha Morphing Potion", "Disco Korbat Morphing Potion", "Fire Ixi Morphing Potion", "Island Usul Morphing Potion", "Christmas Pteri Morphing Potion", "Desert Scorchio Morphing Potion", "Red Chia Morphing Potion", "Fire Skeith Morphing Potion", "Red Ixi Morphing Potion", "Brown Ruki Morphing Potion", "Darigan Techo Morphing Potion", "Faerie Mynci Morphing Potion", "Blue Ruki Morphing Potion", "Brown Aisha Morphing Potion", "Brown Ixi Morphing Potion", "Christmas Chomby Morphing Potion", "Island Nimmo Morphing Potion", "Plushie Techo Morphing Potion", "Rainbow JubJub Morphing Potion", "Zombie Buzz Morphing Potion", "Green Chomby Morphing Potion", "Water Faerie Bubbles", "Checkered Poogle Morphing Potion", "Island Techo Morphing Potion", "Red Chomby Morphing Potion", "Pirate Chomby Morphing Potion", "Snow Wocky Morphing Potion", "Plushie Tonu Morphing Potion", "Island Chomby Morphing Potion", "Ghost Shoyru Morphing Potion", "Halloween Kau Morphing Potion", "Cloud Ixi Morphing Potion", "Maraquan Buzz Morphing Potion", "White Chia Morphing Potion", "Fire Quiggle Morphing Potion", "Halloween Nimmo Morphing Potion", "Plushie Mynci Morphing Potion", "Flaming Torch", "Plushie JubJub Morphing Potion", "Woodland Grundo Morphing Potion", "Yellow Usul Morphing Potion", "Island Wocky Morphing Potion", "Fire Ruki Morphing Potion", "Red Hissi Morphing Potion", "Starry Hissi Morphing Potion", "Faerie Nimmo Morphing Potion", "Green Hissi Morphing Potion", "Striped Skeith Morphing Potion", "Yellow Poogle Morphing Potion", "Blue Chomby Morphing Potion", "Red Skeith Morphing Potion", "Green Ruki Morphing Potion", "Plushie Pteri Morphing Potion", "Woodland Koi Morphing Potion", "Skunk Lupe Morphing Potion", "Striped Jetsam Morphing Potion", "Striped Shoyru Morphing Potion", "Yellow Ixi Morphing Potion", "Christmas Korbat Morphing Potion", "Fire Kiko Morphing Potion", "Grey Lenny Morphing Potion", "Pirate Ixi Morphing Potion", "Pirate Shoyru Morphing Potion", "Red Kiko Morphing Potion", "Red Ruki Morphing Potion", "Yellow Chia Morphing Potion", "Eventide Ixi Morphing Potion", "Eventide Tonu Morphing Potion", "Ghost Acara Morphing Potion", "Halloween Techo Morphing Potion", "Pirate Hissi Morphing Potion", "Dimensional Poogle Morphing Potion", "Pastel Gnorbu Morphing Potion", "Starry Ruki Morphing Potion", "Water Kyrii Morphing Potion", "Blue Jetsam Morphing Potion", "Eventide Zafara Morphing Potion", "Island Eyrie Morphing Potion", "Snow Ogrin Morphing Potion", "Transparent Elephante Morphing Potion", "Electric Ixi Morphing Potion", "Island Buzz Morphing Potion", "Island Tuskaninny Morphing Potion", "Light Faerie Dust", "Shadow Ogrin Morphing Potion", "Tyrannian Peophin Morphing Potion", "Woodland Pteri Morphing Potion", "Woodland Tonu Morphing Potion", "Yellow Ruki Morphing Potion", "Desert Chomby Morphing Potion", "Faerie Tuskaninny Morphing Potion", "White Peophin Morphing Potion", "Blue Hissi Morphing Potion", "Blue Skeith Morphing Potion", "Cloud Ruki Morphing Potion", "Faerie Buzz Morphing Potion", "Fire Chomby Morphing Potion", "Pink Uni Morphing Potion", "Yellow Hissi Morphing Potion", "Desert Yurble Morphing Potion", "Plushie Flotsam Morphing Potion", "Shadow Uni Morphing Potion", "Starry Zafara Morphing Potion", "Blue Zafara Morphing Potion", "Faerie Quiggle Morphing Potion", "Glowing Lupe Morphing Potion", "Rainbow Kau Morphing Potion", "Stealthy Techo Morphing Potion", "Blue Ixi Morphing Potion", "Christmas Ixi Morphing Potion", "Darigan Buzz Morphing Potion", "Fire Wocky Morphing Potion", "Island Uni Morphing Potion", "Purple Zafara Morphing Potion", "Red Zafara Morphing Potion", "Relic Chia Morphing Potion", "Shadow Ruki Morphing Potion", "Split Lupe Morphing Potion", "Dimensional Jetsam Morphing Potion", "Plushie Buzz Morphing Potion", "Strawberry Lupe Morphing Potion", "Christmas Aisha Morphing Potion", "Fire Shoyru Morphing Potion", "Spotted Jetsam Morphing Potion", "Zombie Usul Morphing Potion", "Darigan Quiggle Morphing Potion", "Glowing Jetsam Morphing Potion", "Green Zafara Morphing Potion", "Island Lenny Morphing Potion", "Island Mynci Morphing Potion", "Island Skeith Morphing Potion", "Water Buzz Morphing Potion", "Water Gnorbu Morphing Potion", "Dimensional Aisha Morphing Potion", "Rainbow Lupe Morphing Potion", "Christmas Zafara Morphing Potion", "Plushie Jetsam Morphing Potion", "Yellow Krawk Morphing Potion", "Christmas Lupe Morphing Potion", "Darigan Mynci Morphing Potion", "Halloween Chia Morphing Potion", "Christmas Uni Morphing Potion", "Clay Aisha Morphing Potion", "Faerie Aisha Morphing Potion", "Red Jetsam Morphing Potion", "Red Krawk Morphing Potion", "Transparent Lenny Morphing Potion", "White Skeith Morphing Potion", "Island JubJub Morphing Potion", "Rainbow Chomby Morphing Potion", "Rainbow Swirly Potion", "Wraith Bruce Morphing Potion", "Darigan Kyrii Morphing Potion", "Pirate Wocky Morphing Potion", "Plushie Tuskaninny Morphing Potion", "Red Lupe Morphing Potion", "Transparent Wocky Morphing Potion", "Yellow Zafara Morphing Potion", "Ghost Hissi Morphing Potion", "Snow Blumaroo Morphing Potion", "Baby Shoyru Morphing Potion", "Darigan Grarrl Morphing Potion", "Desert Mynci Morphing Potion", "Green Lupe Morphing Potion", "Halloween Xweetok Morphing Potion", "Water Acara Morphing Potion", "Yellow Lupe Morphing Potion", "Pirate Poogle Morphing Potion", "Zombie Korbat Morphing Potion", "Baby Peophin Morphing Potion", "Plushie Kau Morphing Potion", "Shadow Hissi Morphing Potion", "Shadow Peophin Morphing Potion", "Water Kau Morphing Potion", "Blue Lupe Morphing Potion", "Camouflage Chia Morphing Potion"
];

var DelayMax = 2300;
var DelayMin = 1000;

var ignore = [];
for (var i = 0; i < ItemsToIgnore.length; i++)
{
    ignore.push(new RegExp(ItemsToIgnore[i].replace(/\x20+/g, "\\x20+"), "i"));
}

var shopContents = document.body.textContent || document.body.innerText;
var emptyshop = shopContents.indexOf("Sorry, we are sold out of everything!")!==-1;

if (!emptyshop)
{
    var content = js().getNode('table[align="center"][cellpadding="4"][border="0"]');
    js().here(content).find('tr').each(function(tr){
        js().here(tr).find('td').each(function(td){
            var a = js().here(td).find('a').detach()[0];
            js(a).removeAttribute('onclick');
            js(td).insertFirst(a);
        });
    });

    var items = $("a[href*='haggle']").toArray();

    for (var v = 0, j; v < items.length;)
    {
        for (j = 0; j < ignore.length; j++)
        {
            if (ignore[j].test($(items[v]).siblings("b:first").text()))
            {
                break;
            }
        }
        if (j == ignore.length)
        {
            v++;
        }
        else
        {
            items.splice(v, 1);
        }
    }
    if (items.length)
    {
        items[Math.round(Math.random() * (items.length - 1))].click();
    }
    else
    {
        setTimeout
        (
            function () { $("img[src*='shopkeepers']").parent()[0].click(); },
            (Math.round(Math.random() * (DelayMax - DelayMin)) + DelayMin)
        );
    }
}
else
{
    setTimeout
    (
        function () { $("img[src*='shopkeepers']").parent()[0].click(); },
        (Math.round(Math.random() * (DelayMax - DelayMin)) + DelayMin)
    );
}