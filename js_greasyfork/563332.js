// ==UserScript==
// @name         Torn ACI Member Badge (Indonesia)
// @namespace    https://greasyfork.org/users/aci-indonesia
// @version      1.5.7
// @description  Shows ACI MEMBER badge with Indonesian flag emoji for verified users.
// @author       Altec64
// @license      All Rights Reserved
// @match        https://www.torn.com/profiles.php*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/563332/Torn%20ACI%20Member%20Badge%20%28Indonesia%29.user.js
// @updateURL https://update.greasyfork.org/scripts/563332/Torn%20ACI%20Member%20Badge%20%28Indonesia%29.meta.js
// ==/UserScript==


(function () {
    'use strict';

    // ✅ VERIFIED ACI MEMBERS (Torn IDs)
    const ACI_MEMBERS = new Set([
  "2494934",
  "2389386",
  "3578459",
  "3987491",
  "2495204",
  "3828215",
  "3790148",
  "2830707",
  "3384108",
  "2978309",
  "2590446",
  "3168525",
  "3958556",
  "3952796",
  "4041586",
  "3906955",
  "3864614",
  "4012657",
  "2474497",
  "3431288",
  "3810255",
  "2480837",
  "3806221",
  "3908130",
  "2982654",
  "3100034",
  "3957347",
  "4023354",
  "3956556",
  "2371656",
  "3906998",
  "4051329",
  "3293671",
  "3819465",
  "1927822",
  "3454786",
  "3671928",
  "2634912",
  "2651891",
  "1350061",
  "2964016",
  "2868429",
  "2709355",
  "3872689",
  "4008222",
  "3975301",
  "3982960",
  "2813845",
  "3802448",
  "2636297",
  "744502",
  "3275482",
  "3970257",
  "3095175",
  "2178276",
  "3067397",
  "4017369",
  "2388664",
  "2429224",
  "2701343",
  "4050821",
  "3986030",
  "3824868",
  "3877822",
  "4047755",
  "2571044",
  "4009271",
  "4004649",
  "3969863",
  "2427772",
  "3918530",
  "3986172",
  "3738545",
  "3932288",
  "2637146",
  "2628881",
  "3839386",
  "3844908",
  "2795564",
  "3498848",
  "2645957",
  "3789112",
  "4050133",
  "2392722",
  "2507465",
  "2564396",
  "3873972",
  "3970216",
  "3679099",
  "2634493",
  "2636986",
  "3355925",
  "2781328",
  "3775853",
  "3835377",
  "3108944",
  "3951459",
  "4030142",
  "3788107",
  "3984557",
  "2108850",
  "4013964",
  "3108484",
  "4027409",
  "2808792",
  "3970536",
  "3983531",
  "2367102",
  "686664",
  "2464567",
  "2433613",
  "3361731",
  "3865338",
  "3876671",
  "3888816",
  "3994596",
  "2424192",
  "2414676",
  "1894687",
  "3476243",
  "3770347",
  "4040152",
  "2380130",
  "3988827",
  "4014453",
  "2462882",
  "4001995",
  "3922773",
  "2601437",
  "2087357",
  "3834156",
  "2871497",
  "2462122",
  "2690405",
  "2444415",
  "3804863",
  "4025591",
  "4067025",
  "3079781",
  "3885215",
  "3808390",
  "3891962",
  "3072774",
  "3767900",
  "2856659",
  "3885405",
  "2447352",
  "3882457",
  "2502062",
  "2629216",
  "2818908",
  "3740297",
  "2368770",
  "2637927",
  "2092837",
  "1727463",
  "2702368",
  "2390564",
  "4023653",
  "3099710",
  "3893884",
  "4020592",
  "2643830",
  "2093719",
  "2888210",
  "3864783",
  "2948680",
  "2505140",
  "4028383",
  "3445201",
  "1",
  "3972842",
  "3016610",
  "4011362",
  "3406625",
  "2079756",
  "2367426",
  "3867151",
  "4009160",
  "4029875",
  "3023184",
  "3895538",
  "2512039",
  "785303",
  "3759165",
  "3748427",
  "4047933",
  "2480640",
  "1394036",
  "3570153",
  "2688096",
  "2835467",
  "2807759",
  "2467347",
  "3857040",
  "2808863",
  "2807796",
  "2495023",
  "4021369",
  "3010141",
  "1892442",
  "3858098",
  "472336",
  "2580929",
  "2430598",
  "2813520",
  "3040480",
  "3041265",
  "2701064",
  "2052251",
  "2699719",
  "3259634",
  "2635603",
  "2775710",
  "2646344",
  "3851672",
  "4011034",
  "2248206",
  "3885590",
  "2513853",
  "4021919",
  "3752991",
  "3956085",
  "1945424",
  "3940828",
  "3604249",
  "4008145",
  "3975605",
  "3986515",
  "3622831",
  "3040659",
  "2398083",
  "2508518",
  "2467119",
  "3775829",
  "3072448",
  "2339494",
  "3971807",
  "2677576",
  "3855823",
  "3987497",
  "4007595",
  "3047683",
  "3987515",
  "2860623",
  "3647931",
  "2419258",
  "3768801",
  "3840922",
  "2460267",
  "3759519",
  "2673364",
  "4019386",
  "3112974",
  "3883894",
  "2645895",
  "2690883",
  "3914378",
  "3913542",
  "3105322",
  "3902900",
  "2946897",
  "3950921",
  "3793062",
  "2490366",
  "3899404",
  "4032655",
  "2388096",
  "2696234",
  "1740814",
  "3778358",
  "4067449",
  "2687393",
  "2695052",
  "3858403",
  "2561951",
  "3879930",
  "3101625",
  "3608577",
  "2440374",
  "3952428",
  "2475552",
  "3086100",
  "3911331",
  "3916544",
  "3855514",
  "2692119",
  "2757978",
  "2368599",
  "3719862",
  "2826335",
  "3839293",
  "2346499",
  "2601779",
  "3164014",
  "3798512",
  "3947600",
  "3024623",
  "2103527",
  "3769185",
  "3826294",
  "3910376",
  "2954564",
  "3815774",
  "3701574",
  "2833336",
  "2978867",
  "3938935",
  "2343082",
  "3123508",
  "2775947",
  "2196569",
  "4032773",
  "3841432",
  "2958042",
  "3816034",
  "2612633",
  "3916716",
  "4034448",
  "2509634",
  "3781070",
  "3993641",
  "3619686",
  "3009152",
  "3373004",
  "4025193",
  "3268025",
  "3530387",
  "3980554",
  "2520147",
  "4003682",
  "2641338",
  "4039719",
  "2549899",
  "2499500",
  "2762875",
  "2759761",
  "3917963",
  "3884189",
  "3870315",
  "2375094",
  "3144846",
  "2514993",
  "4018961",
  "4031169",
  "3705803",
  "3780705",
  "3054265",
  "2112641",
  "2512842",
  "4053103",
  "333478",
  "2711806",
  "1977213",
  "2411568",
  "3667591",
  "2798312",
  "4031566",
  "3875078",
  "3966708",
  "2710377",
  "295233",
  "2624825",
  "2774628",
  "3399438",
  "1979738",
  "2389871",
  "2714186",
  "3815632",
  "2733754",
  "2463834",
  "3899940",
  "2830191",
  "3966925",
  "2642809",
  "2778853",
  "4001670",
  "3753129",
  "3926616",
  "3555156",
  "2384054",
  "3057715",
  "2633799",
  "4049554",
  "2726189",
  "3002398",
  "2816854",
  "4032406",
  "3409303",
  "3800206",
  "2366950",
  "2474268",
  "3828506",
  "3840626",
  "3626612",
  "3832890",
  "3841812",
  "3996228",
  "2633657",
  "2952114",
  "3986041",
  "3326320",
  "3974733",
  "4019799",
  "2438512",
  "3797288",
  "4057505",
  "3083981",
  "1830300",
  "4019430",
  "3959221",
  "459025",
  "3859178",
  "2708765",
  "2423671",
  "3730693",
  "4045423",
  "1935939",
  "3998860",
  "3923610",
  "2785259",
  "2177511",
  "3198742",
  "3912454",
  "4040184",
  "2696515",
  "4017415",
  "2598178",
  "2043450",
  "3086963",
  "3957553",
  "3935281",
  "3746387",
  "3873916",
  "2440726",
  "2370953",
  "2384585",
  "3777169",
  "3939001",
  "3587386",
  "3456509",
  "3794639",
  "3744365",
  "3052630",
  "3097400",
  "2505315",
  "3967765",
  "4032997",
  "2804102",
  "3950666",
  "3956498",
  "3766565",
  "3092328",
  "3075450",
  "3837387",
  "4024837",
  "3045700",
  "3975564",
  "2424262",
  "2233001",
  "3898647",
  "4033216",
  "2826203",
  "3455654",
  "2438614",
  "3074936",
  "2637158",
  "4025301",
  "3986771",
  "3853496",
  "4005216",
  "3193220",
  "3892691",
  "3531300",
  "3062877",
  "3261738",
  "3886618",
  "3892462",
  "2330900",
  "4025274",
  "3893460",
  "4020639",
  "3671817",
  "3239371",
  "3696947",
  "2874705",
  "2697508",
  "2821148",
  "2400457",
  "3336010",
  "3841736",
  "2651788",
  "2757426",
  "3779029",
  "2084380",
  "2999542",
  "3773977",
  "2683933",
  "2457286",
  "3777322",
  "4022296",
  "3599570",
  "249119",
  "3755977",
  "3991678",
  "4061701",
  "2684869",
  "3932991",
  "2968276",
  "2410926",
  "3861981",
  "2046239",
  "3881456",
  "3774486",
  "3994664",
  "3423935",
  "3708032",
  "3845579",
  "3874565",
  "3870480",
  "2370138",
  "4003102",
  "2500964",
  "3915590",
  "3426361",
  "4014005",
  "3837365",
  "3059582",
  "4019915",
  "3949153",
  "4019604",
  "3879499",
  "2479075",
  "4016441",
  "3691681",
  "2700428",
  "3882672",
  "4008755",
  "3828583",
  "2304632",
  "3949467",
  "2695460",
  "3409319",
  "2640445",
  "2947971",
  "3585807",
  "3981859",
  "2706225",
  "3047824",
  "3991835",
  "3078389",
  "2709179",
  "4022526",
  "3936424",
  "2992421",
  "4001668",
  "3985646",
  "4012268",
  "2545337",
  "2492880",
  "3800968",
  "3800205",
  "3951153",
  "4029949",
  "3910335",
  "3075107",
  "2381957",
  "2755077",
  "2724916",
  "3952493",
  "3977638",
  "3928632",
  "3898429",
  "3895305",
  "3592244",
  "3031168",
  "2378542",
  "2515628",
  "3057863",
  "2506875",
  "3894478",
  "4061645",
  "2138526",
  "3026651",
  "4045984",
  "3054090",
  "1314786",
  "3634527",
  "3015118",
  "1667631",
  "2829495",
  "4026691",
  "218730",
  "3837057",
  "3811428",
  "2801121",
  "3842835",
  "2737748",
  "2784202",
  "3425196",
  "4014726",
  "2601790",
  "3972700",
  "4065442",
  "3999182",
  "2466793",
  "3790984",
  "3693358",
  "4028979",
  "2814204",
  "3757868",
  "2447907",
  "3966694",
  "3830295",
  "2512640",
  "1181209",
  "2512538",
  "4019397",
  "3983266",
  "3946365",
  "4022939",
  "3556218"
    ]);

const containerId = "aciMemberContainer";

    function getUserId() {
        try {
            const url = new URL(window.location.href);
            const keys = ["XID", "ID", "xid", "id", "userID", "userid"];
            for (const k of keys) {
                const v = url.searchParams.get(k);
                if (v && /^\d{3,}$/.test(v)) return v;
            }
        } catch (e) {}

        const header = document.querySelector("h4#skip-to-content");
        if (header) {
            const m = header.textContent.match(/(\d{6,})/);
            if (m) return m[1];
        }

        const anyLink = document.querySelector(
            'a[href*="profiles.php"][href*="XID="],a[href*="profiles.php"][href*="ID="]'
        );
        if (anyLink && anyLink.href) {
            const m = anyLink.href.match(/[?&](?:XID|ID)=(\d+)/i);
            if (m) return m[1];
        }

        return null;
    }

    function getNameHeader() {
        return document.querySelector("h4#skip-to-content") || document.querySelector("h4");
    }

    function injectBadgeOnce() {
        if (document.getElementById(containerId)) return;

        const userId = getUserId();
        if (!userId) return;

        if (!ACI_MEMBERS.has(String(userId))) return;

        const nameHeader = getNameHeader();
        if (!nameHeader) return;

        const container = document.createElement("span");
        container.id = containerId;
        container.style.marginLeft = "10px";

        const badge = document.createElement("span");
        badge.textContent = "ACI MEMBER";
        badge.title = "ACI Discord Verified Member";
        badge.style.padding = "4px 8px";
        badge.style.backgroundColor = "#c62828";
        badge.style.color = "#ffffff";
        badge.style.fontSize = "12px";
        badge.style.fontWeight = "700";
        badge.style.borderRadius = "4px";

        container.appendChild(badge);
        nameHeader.appendChild(container);
    }

    function boot() {
        // Initial tries
        injectBadgeOnce();

        // Observer (fast DOM changes)
        const obs = new MutationObserver(injectBadgeOnce);
        obs.observe(document.documentElement || document.body, {
            childList: true,
            subtree: true
        });

        // Desktop Torn final render killer → periodic re-inject
        setInterval(injectBadgeOnce, 2000);
    }

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", boot, { once: true });
    } else {
        boot();
    }
})();