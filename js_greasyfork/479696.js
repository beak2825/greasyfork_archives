// ==UserScript==
// @name         SuperStarå°åŠ©æ‰‹-æ”¯æŒä½œä¸šã€è€ƒè¯•ã€è§†é¢‘ã€ç« èŠ‚æµ‹éªŒå…¨è‡ªåŠ¨å¤„ç†
// @namespace    Trprr
// @version      2.5.7
// @author       Trprr
// @description  ã€ğŸ¥‡æ“ä½œç®€å•ã€‘SuperStarå°åŠ©æ‰‹ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼Œå®‰è£…å³å¯ä½¿ç”¨ã€‚ã€ğŸ”ŠåŠŸèƒ½é½å…¨ã€‘æ”¯æŒè§†é¢‘ã€éŸ³é¢‘å€é€Ÿç§’è¿‡ï¼›æ–‡æ¡£ã€å›¾ä¹¦è‡ªåŠ¨å®Œæˆï¼›å­—ä½“è§£å¯†ï¼›ç« èŠ‚æµ‹éªŒã€è¯¾åä½œä¸šã€è€ƒè¯•è‡ªåŠ¨ç­”é¢˜ã€è‡ªåŠ¨æäº¤ã€è‡ªåŠ¨æ”¶å½•ç­”æ¡ˆï¼›æ”¯æŒè‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡ç‚¹ã€è‡ªåŠ¨ç™»å½•ç­‰ã€‚ã€ğŸ“”ä¸°å¯Œé¢˜åº“ã€‘å…è´¹é¢˜åº“ã€è‡ªå»ºé¢˜åº“ã€ç¬¬ä¸‰æ–¹ç‹¬å®¶é¢˜åº“ï¼Œæ¯æ—¥æ›´æ–°ï¼Œç²¾å‡†è¯†åˆ«ï¼Œç­”æ¡ˆå…¨å¯¹ã€‚ã€âœ¨åŠŸèƒ½æ‰©å±•ã€‘å¼€æ”¾è‡ªå®šä¹‰å‚æ•°ï¼ŒåŠŸèƒ½æ§åˆ¶æ›´ç®€å•
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAA5RJREFUWEftlluoVVUUhr/z4IHIwBfFykgTQkQyMMK0pJv4YIWXSsoHBSvNS0WKcUSwIEWwlEjBEEUU0bzkQ5EP3hMqK/GGZRJiN8METRRUFHR+Mlass85Ze6/ty0FwwOJc5hxz/PMfY/xjNtHB1tTB8bmlATQD9wB3A6eBE8DVRhltlAGDvQKMBB4vBLuS1n4Fvk+gPgN+yq13AgYDPeI7BfwBbG8EwPvA63HrfOyDwF3AAwVAnwO/AENSoCcAQRStpSqA9cBL4b0f+AbYm1jYFvS71AXoC4wD3ihJxRbgh2DhKaC5CoBrucNmp9t+DFyKNAwHBgLnAH//L/YOAN7LgX4XWJQ7ZwywDvitHgBv+Wg4ejsplYl3gEGFWz4C7Cv8L8+c+7+Lov0SEOSntQDMBWbFgeZxTwT3UO0YsDaqX1p/LqF9MzAC+Au4LxXjVuBZ4Kg/ywD0i2q+MzktT86vAW8Bn0SQacAy4HKFtnsYMPfdgQ25tIwCNpcBWADMCMqk7pkoOOM9D3xVIXB+iynL18DLAaZUCXcCTwKToqdtwTkpb+buhQaDS/caoFv4/R/cv8sYyCrfAvwxHAW0q8Hgps5U5W0CsCL7R3sAVKs/Q1bvSMUl4n8AWWnELGALWfvWfAOm1m9mLQCPhYNS6q0vAL8DPStGV2DUgGGx/81UgEujEwTxdWjGjeX2GLDPbTXp9rCxSdlOVmDAHBtY0dFkzHrxAprq6IzYBLxYxkAW3PXDwEMVb+2MsGseTCAuAh8mmZ1X8JWFicBiwDZuw0A+eLZuDztsyuzVNAum5FTRLjG4wlS03TGYDC6IVgD6RJ/fC6wO0RiaUvRB2mULFk1lmwy4R1OyFaxixef9/gW6Ar1CPVsB+CKGi3l7GpiqTif1OxNzXNnUWZb8LE7NQnXfqhosuVSqIxZh/1ShByJ3Uq7Gaz4Y1O4lIbmjgftjzfowx060eibYrIXbqKgApgMfAYeAt+NxoW6bDtUvb754TItDqKplouYcUFNamQCeC4mtdaDvPQOvrBo1sdaS64QjgAOujWU6YK8rm4qQY1MllBHnt4IyPjwVkfkxmsuw9AYW5mbG3/ECand/vQdJ5mS+vVFmTkNZOR4PUV/H1pI15Nc5Nqp8jt1SqwrAA3xYWiMWYz2zgAWt8tW0RgBkB5kmq9nq9pnu7c+HXJvrjUlwdiSwZ+sFd/1mAFQ5t/Ke2wA6nIHr54C0BK9FxloAAAAASUVORK5CYII=
// @match      	 *://*.edu.cn/*
// @match      	 *://*.org.cn/*
// @match      	 *://*.hnsyu.net/*
// @match      	 *://*.qutjxjy.cn/*
// @match      	 *://*.ynny.cn/*
// @match      	 *://*.hnvist.cn/*
// @match      	 *://*.fjlecb.cn/*
// @match      	 *://*.gdhkmooc.com/*
// @match      	 *://*.chaoxing.com/*
// @match      	 *://*.zjelib.cn/*
// @match      	 *://*.cqrspx.cn/*
// @match      	 *://*.webtrn.cn/*
// @connect      scriptcat.org
// @connect      lemtk.xyz
// @connect      ioscx.com
// @connect      icodef.com
// @connect      enncy.cn
// @connect    	 localhost
// @connect    	 127.0.0.1
// @connect    	 vanse.top
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_setClipboard
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-end
// @require      https://update.greasyfork.org/scripts/474385/1535220/GF_ElementGetter.js
// @require      https://update.greasyfork.org/scripts/445293/1052390/TyprMd5.js
// @require      https://s4.zstatic.net/ajax/libs/sweetalert2/11.22.3/sweetalert2.all.min.js
// @require      https://s4.zstatic.net/ajax/libs/jquery/3.6.0/jquery.min.js
// @resource     Table  https://www.forestpolice.org/ttf/2.0/table.json
// @license      GPL-3.0-or-later
// @antifeature  payment
// @downloadURL https://update.greasyfork.org/scripts/454801/SuperStar%E5%B0%8F%E5%8A%A9%E6%89%8B-%E6%94%AF%E6%8C%81%E4%BD%9C%E4%B8%9A%E3%80%81%E8%80%83%E8%AF%95%E3%80%81%E8%A7%86%E9%A2%91%E3%80%81%E7%AB%A0%E8%8A%82%E6%B5%8B%E9%AA%8C%E5%85%A8%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86.user.js
// @updateURL https://update.greasyfork.org/scripts/454801/SuperStar%E5%B0%8F%E5%8A%A9%E6%89%8B-%E6%94%AF%E6%8C%81%E4%BD%9C%E4%B8%9A%E3%80%81%E8%80%83%E8%AF%95%E3%80%81%E8%A7%86%E9%A2%91%E3%80%81%E7%AB%A0%E8%8A%82%E6%B5%8B%E9%AA%8C%E5%85%A8%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86.meta.js
// ==/UserScript==

var setting = {
    tikuAdapter: {
      use: 0,
      url: "http://localhost:8060/adapter-service/search?use=local,icodef,buguake,wanneng,lemon&icodefToken=UafYcHViJMGzSVNh&wannengToken=E196FD8B49"
    },
    // tikuAdapter é…ç½®è¯¦è§ https://github.com/DokiDoki1103/tikuAdapter
    showBox: 1,
    // æ˜¾ç¤ºè„šæœ¬æµ®çª—ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œä¸å»ºè®®å…³é—­
    tiku: 1,
    // æŸ æª¬é¢˜åº“æœåŠ¡å™¨åˆ‡æ¢ï¼Œ0ä¸ºä¸»çº¿è·¯ï¼Œ1ä¸ºå¤‡ç”¨çº¿è·¯
    task: 0,
    // åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    video: 1,
    // å¤„ç†è§†é¢‘ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    audio: 1,
    // å¤„ç†éŸ³é¢‘ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    rate: 1,
    // è§†é¢‘/éŸ³é¢‘å€é€Ÿï¼Œ0ä¸ºç§’è¿‡ï¼Œ1ä¸ºæ­£å¸¸é€Ÿç‡ï¼Œæœ€é«˜16å€
    review: 0,
    // å¤ä¹ æ¨¡å¼ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯å¯ä»¥è¡¥æŒ‚è§†é¢‘æ—¶é•¿
    work: 1,
    // æµ‹éªŒè‡ªåŠ¨å¤„ç†ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œå¼€å¯å°†ä¼šå¤„ç†æµ‹éªŒï¼Œå…³é—­ä¼šè·³è¿‡æµ‹éªŒ
    time: 5e3,
    // ç­”é¢˜æ—¶é—´é—´éš”ï¼Œé»˜è®¤5s=5000
    sub: 1,
    // æµ‹éªŒè‡ªåŠ¨æäº¤ï¼Œ0ä¸ºå…³é—­,1ä¸ºå¼€å¯ï¼Œå½“æ²¡ç­”æ¡ˆæ—¶æµ‹éªŒå°†ä¸ä¼šæäº¤ï¼Œå¦‚éœ€æäº¤è¯·è®¾ç½®forceï¼š1
    force: 0,
    // æµ‹éªŒå¼ºåˆ¶æäº¤ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œå¼€å¯æ­¤åŠŸèƒ½å°†ä¼šå¼ºåˆ¶æäº¤æµ‹éªŒï¼ˆæ— è®ºä½œç­”ä¸å¦ï¼‰
    share: 1,
    // è‡ªåŠ¨æ”¶å½•ç­”æ¡ˆï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œæ¨èå¼€å¯ï¼Œä¼šåœ¨ç›¸åº”é¡µé¢è‡ªåŠ¨æ”¶å½•ç­”æ¡ˆ
    decrypt: 1,
    // å­—ä½“è§£å¯†ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œæ¨èå¼€å¯ï¼Œæ–¹æ³•æ¥è‡ªwyn665817å¤§ä½¬
    examTurn: 1,
    // è€ƒè¯•è‡ªåŠ¨è·³è½¬ä¸‹ä¸€é¢˜ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    examTurnTime: 0,
    // è€ƒè¯•è‡ªåŠ¨è·³è½¬ä¸‹ä¸€é¢˜éšæœºé—´éš”æ—¶é—´(3-7s)ä¹‹é—´ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    examAutoClick: 1,
    // è€ƒè¯•è‡ªåŠ¨ç‚¹å‡»ç­”æ¡ˆï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
    autoLogin: 0,
    // è‡ªåŠ¨ç™»å½•ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯ï¼Œå¼€å¯æ­¤åŠŸèƒ½è¯·é…ç½®ç™»é™†é…ç½®é¡¹
    phone: "",
    // ç™»å½•é…ç½®é¡¹ï¼šç™»å½•æ‰‹æœºå·/SuperStarå·
    password: ""
    // ç™»å½•é…ç½®é¡¹ï¼šç™»å½•å¯†ç 
  };
  var _GM_getValue = /* @__PURE__ */ (() => typeof GM_getValue != "undefined" ? GM_getValue : void 0)();
  var _GM_info = /* @__PURE__ */ (() => typeof GM_info != "undefined" ? GM_info : void 0)();
  var _GM_setClipboard = /* @__PURE__ */ (() => typeof GM_setClipboard != "undefined" ? GM_setClipboard : void 0)();
  var _GM_setValue = /* @__PURE__ */ (() => typeof GM_setValue != "undefined" ? GM_setValue : void 0)();
  var _GM_xmlhttpRequest = /* @__PURE__ */ (() => typeof GM_xmlhttpRequest != "undefined" ? GM_xmlhttpRequest : void 0)();
  var _unsafeWindow = /* @__PURE__ */ (() => typeof unsafeWindow != "undefined" ? unsafeWindow : void 0)();
  var _w = _unsafeWindow, _l = location, _d = _w.document, $ = _w.jQuery || top.jQuery, md5 = md5 || window.md5, UE = _w.UE, Swal = Swal || window.Swal, _host = ["aHR0cHM6Ly9hcGkubGVtdGsueHl6", "aHR0cHM6Ly9hcGkudmFuc2UudG9w", "aHR0cHM6Ly9hcGkuaW9zY3guY29t"][setting.tiku];
  var _mlist, _defaults, _domList, $subBtn, $saveBtn, $frame_c;
  var reportUrlChange = 0;
  var isUpdate = 0;
  const tikuAdapter = (_t, _q, _o) => {
    return new Promise(resolve => {
      _GM_xmlhttpRequest({
        method: "POST",
        url: setting.tikuAdapter.url,
        headers: {
          "Content-Type": "application/json;charset=utf-8"
        },
        data: JSON.stringify({
          question: _q,
          options: _o,
          type: _t
        }),
        onload: function (r) {
          try {
            const res = JSON.parse(r.responseText);
            resolve(res.answer.answerText);
          } catch (e) {
            resolve("");
          }
        },
        onerror: function (e) {
          console.log(e);
          resolve("");
        }
      });
    });
  };
  Object.defineProperty(setting, "token", {
    get() {
      return _GM_getValue("lemtk_token") ? _GM_getValue("lemtk_token").trim() : "";
    },
    set(val) {
      _GM_setValue("lemtk_token", val.trim())
    }
  });
  $(document).keydown(function (e) {
    if (e.keyCode == 75 && $("#ne-21notice")[0] != void 0) {
      let show = $("#ne-21box").css("display");
      $("#ne-21box").css("display", show == "block" ? "none" : "block");
    }
  });
  $(".navshow").find("a:contains(ä½“éªŒæ–°ç‰ˆ)")[0] ? $(".navshow").find("a:contains(ä½“éªŒæ–°ç‰ˆ)")[0].click() : "";
  setting.decrypt ? decryptFont() : "";
  if (btoa(_l.hostname) == "aS5tb29jLmNoYW94aW5nLmNvbQ==" || btoa(_l.hostname) == "aS5jaGFveGluZy5jb20=") {
    showTips();
  } else if (_l.pathname == "/login" && setting.autoLogin) {
    showBox();
    setTimeout(() => {
      autoLogin();
    }, 3e3);
  } else if (_l.pathname.includes("/mycourse/studentstudy")) {
    showBox();
    $("#ne-21log", window.parent.document).html("<hr />ğŸ‰ğŸ‰ğŸ‰è„šæœ¬å·²åŠ è½½ï¼Œåˆå§‹åŒ–å®Œæ¯•!ğŸ‰ğŸ‰ğŸ‰");
  } else if (_l.pathname.includes("/knowledge/cards")) {
    if (top.location.href != _GM_getValue("curUrl")) {
      _GM_setValue("curUrl", top.location.href);
      setTimeout(() => {
        top.location.replace(top.location.href);
      }, 1e3);
    } else {
      check_update().then(() => {
        console.log("update...")
      }).catch(() => {
        var params = getTaskParams();
        if (params == null || params == "$mArg" || $.parseJSON(params)["attachments"].length <= 0) {
          logger("æ— ä»»åŠ¡ç‚¹å¯å¤„ç†ï¼Œå³å°†è·³è½¬é¡µé¢", "red");
          toNext();
        } else {
          setTimeout(() => {
            top.checkJob ? top.checkJob = () => false : true;
            _domList = [];
            _mlist = $.parseJSON(params)["attachments"];
            _defaults = $.parseJSON(params)["defaults"];
            $.each($(".wrap .ans-cc .ans-attach-ct"), (i, t) => {
              _domList.push($(t).find("iframe"));
            });
            logger("å…±è®¡" + _mlist.length + "ä¸ªä»»åŠ¡,å³å°†å¼€å§‹é€ä¸ªå¤„ç†~", "#ed4845");
            missonStart();
          }, 3e3);
        }
      })
    }
  } else if (_l.pathname.includes("/exam/test/reVersionTestStartNew")) {
    showBox();
    setTimeout(() => {
      missonExam();
    }, 3e3);
  } else if (_l.pathname.includes("/exam/test/reVersionPaperMarkContentNew")) {
    setting.share && (() => {
      showBox();
      setTimeout(() => {
        uploadExam();
      }, 3e3);
    })();
  } else if (_l.pathname.includes("/mooc2/work/dowork")) {
    showBox();
    setTimeout(() => {
      missonHomeWork();
    }, 3e3);
  } else if (_l.pathname.includes("/mooc2/work/view")) {
    setting.share && (() => {
      showBox();
      setTimeout(() => {
        uploadHomeWork();
      }, 3e3);
    })();
  } else if (_l.pathname.includes("/work/phone/doHomeWork")) {
    _oldal = _w.alert;
    _w.alert = function (msg) {
      if (msg == "ä¿å­˜æˆåŠŸ") {
        return;
      }
      return _oldal(msg);
    };
    _w.workPop = function (content, okTent, okcallback, cancelCallback) {
      okcallback && okcallback();
    };
    _w.workPop2 = function (content, okTent, cancelTent, okcallback, cancelCallback) {
      okcallback && okcallback();
    };
    if (top.workPop2) {
      top.workPop2 = _w.workPop2;
    }
  } else if (_l.pathname.includes("/mooc2/exam/exam-list")) {
    Swal.fire("SuperStarå­¦ä¹ å°åŠ©æ‰‹æç¤º", "æ³¨æ„ï¼šä¸“ä¸šè¯¾å¯èƒ½ä¼šå­˜åœ¨ç­”æ¡ˆä¸å…¨æˆ–æ— ç­”æ¡ˆï¼Œè¯·è°¨æ…ä½¿ç”¨è„šæœ¬è€ƒè¯•ï¼Œä¸€åˆ‡åæœç”±æ‚¨è‡ªå·±æ‰¿æ‹…ã€‚", "info");
  } else if (_l.pathname.includes("/mycourse/studentcourse")) {
    let texts = `<div style="font-size: x-small;">æ³¨æ„ï¼šè¯·å‹¿åœ¨éæ­£å¸¸å­¦ä¹ æ—¶é—´æ®µ(å‡Œæ™¨ã€é€šå®µ)è¿è¡Œè„šæœ¬ï¼Œä»¥å…é€ æˆå­¦ä¹ è¿›åº¦è¢«é‡ç½®ã€‚<hr />æ­¤é¡¹ç›®ä½œä¸ºå¼€æºçš„ç”¨æˆ·è„šæœ¬ï¼Œéµå¾ªç”¨æˆ·è„šæœ¬çš„ç¼–å†™è§„èŒƒï¼Œå¹¶ä¸”ä½¿ç”¨çº¯ç²¹çš„ javascript æ‰§è¡Œä»£ç ï¼Œä¸å¯¹é¡µé¢è¿›è¡Œä»»ä½•æºç çš„ä¿®æ”¹ï¼Œä¸é™„åŠ ä»»ä½•ç­‰éæ³•å…¥ä¾µè®¡ç®—æœºç³»ç»Ÿçš„åŠŸèƒ½ï¼Œä¸å¯¹å®¢æˆ·ç«¯è®¡ç®—æœºè¿›è¡Œä»»ä½•ç ´åè¶Šæƒæ§åˆ¶ç­‰è¡Œä¸ºã€‚</div>`;
    Swal.fire(texts);
  } else {
  
  };
  function http2https(url) {
    let _url = url.replace(/^http:/, "https:");
    return _url;
  }
  function parseUrlParams() {
    let query = window.location.search.substring(1);
    let vars = query.split("&");
    let _p = {};
    for (let i = 0; i < vars.length; i++) {
      let pair = vars[i].split("=");
      _p[pair[0]] = pair[1];
    }
    return _p;
  }
  function showTips() {
    var _msg = `<div style="font-size: x-small;"><span style='color: red;'>é¢˜åº“ä¸ºç¬¬ä¸‰æ–¹é¢˜åº“ï¼Œä¸æœ¬è„šæœ¬æ— ä»»ä½•å…³ç³»ï¼Œæœ‰èƒ½åŠ›è€…å¯è‡ªè¡Œæ›´æ¢ã€‚</span> <br> è„šæœ¬å¤±æ•ˆé—®é¢˜è¯·ç›´æ¥GreasyForkç§ä¿¡æˆ–æ²¹çŒ´ä¸­æ–‡ç½‘ç§ä¿¡ã€‚<br> è„šæœ¬åŸºäºNe-21ä¿®æ”¹ä¸”ä¾›è‡ªå·±ä½¿ç”¨ï¼Œæ„Ÿè°¢Ne-21å¤§ä½¬çš„æºç ï¼</div>`;
    Swal.fire(_msg);
  }
  function switchLemtkPro() {
    if (_GM_getValue("lemtkpro") == 1) {
      $("#lemtkpro").text("å…³é—­é¢˜åº“é«˜çº§æœç´¢");
    } else if (_GM_getValue("lemtkpro") == 0) {
      $("#lemtkpro").text("å¼€å¯é¢˜åº“é«˜çº§æœç´¢");
    } else {
      _GM_setValue("lemtkpro", 0);
      switchLemtkPro();
    }
  }
  function switchLemtkToken() {
    if (setting.token) {
      $("#lemtktoken").val(setting.token);
      $("#lemtkbtn").text("æ¸…ç©ºToken");
      $("#lemtksq").text("é‡ç½®Token");
    } else {
      $("#lemtktoken").val("");
      $("#lemtkbtn").text("ä¿å­˜Token");
      $("#lemtksq").text("è·å–Token");
    }
  }
  function showBox() {
    if (setting.showBox && top.document.querySelector("#ne-21notice") == void 0) {
      var box_html = `<div style="font-family: fangsong;font-weight: bold;"><div id="ne-21box" style="border: 2px dashed rgb(0, 85, 68); width: 380px; position: fixed; top: 6%; right: 20%; z-index: 99999; background-color: rgba(184, 247, 255, 0.7); overflow-x: auto;">
          <div style="display: flex;justify-content: space-between;margin: 0 5%;" title="æŒ‰ké”®å³å¯æ¢å¤é¢æ¿"><h3 style="text-align: center;">ğŸŒ¸SuperStarå­¦ä¹ å°åŠ©æ‰‹v` + _GM_info["script"]["version"] + `</h3><h3 id="ne-21close" style="color: red;">[Ké”®å…³é—­é¢æ¿]</h3></div>
          <div id="ne-21notice" style="border-top: 1px solid #000;border-bottom: 1px solid #000;margin: 4px 0px;overflow: hidden;"></div>
          <div style="padding-bottom: 5px;"><div style="display: flex;padding: 2px 5px; justify-content: space-around;"><div>æŸ æª¬é¢˜åº“Tokenï¼š<input type="password" id="lemtktoken" placeholder="è¯·è¾“å…¥Token" /></div><button style="width: 25%;" id="lemtkcopy">å¤åˆ¶Token</button></div><div style="display: flex;justify-content: space-evenly;align-items: center;"><button id="lemtkpro">å¼€å¯/å…³é—­é«˜çº§æœç´¢</button> - <button id="lemtkbtn">ä¿å­˜Token</button> - <button id="lemtksq">è·å–/é‡ç½®Token</button></div></div>
          <div id="ne-21log" style="max-height:200px;"></div>
      </div></div>`;
      $(box_html).appendTo("body");
      $("#ne-21close").click(function () {
        let show = $("#ne-21box").css("display");
        $("#ne-21box").css("display", show == "block" ? "none" : "block");
      });
      $(`<div id='tips21'>
              <p style="text-align: center;">
              ğŸ”ˆè„šæœ¬æ‰€æœ‰çš„åŠŸèƒ½å‡æ²¡æœ‰å‘ç”¨æˆ·æ”¶å–è´¹ç”¨ï¼Œé¢˜åº“é…ç½®å¦‚æœä¸è®¾ç½®ä»ç„¶å¯ä»¥ä½¿ç”¨è„šæœ¬çš„å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœé¢˜åº“é…ç½®éœ€è¦æ”¶è´¹ï¼Œé‚£ä¹ˆæœ€ç»ˆè§£é‡Šæƒå½’é¢˜åº“é…ç½®çš„æä¾›è€…æ‰€æœ‰ã€‚
              </p>
              <hr />
              <p style="text-align: center;">
              ğŸ‰è„šæœ¬é›†æˆæŸ æª¬é¢˜åº“ï¼Œå¯å…è´¹æœç´¢ï¼Œé¢˜åº“æ”¯æŒè‡ªä¸»ä¸Šä¼ é¢˜ç›®ï¼Œæ¨èä½¿ç”¨é«˜çº§æœç´¢ï¼Œæé«˜é¢˜åº“å‘½ä¸­ç‡~<br />ğŸ‘‰<a href="https://www.lemtk.xyz/#/" target="_blank" style="color: #ee2746;text-decoration: underline;">ç‚¹æ­¤å‰å¾€æŸ æª¬é¢˜åº“</a>ğŸ‘ˆ
              </p>
          </div>`).appendTo("#ne-21notice");
      $("#lemtkbtn").click(function () {
        if (setting.token) {
          setting.token = "";
          logger("Tokenæ¸…é™¤æˆåŠŸï¼", "green");
        } else {
          if ($("#lemtktoken").val().length != 32) {
            logger("Tokenæ ¼å¼ä¸æ­£ç¡®ï¼", "red");
            return;
          }
          setting.token = $("#lemtktoken").val();
          logger("Tokenä¿å­˜æˆåŠŸï¼", "green");
        }
        switchLemtkToken();
      });
      $("#lemtksq").click(function () {
        window.open("https://www.lemtk.xyz/#/", "_blank");
      });
      $("#lemtkpro").click(function () {
        if (_GM_getValue("lemtkpro")) {
          _GM_setValue("lemtkpro", 0);
          logger("å·²å…³é—­é«˜çº§æœç´¢åŠŸèƒ½ï¼", "red");
        } else {
          _GM_setValue("lemtkpro", 1);
          logger("å·²å¼€å¯é«˜çº§æœç´¢åŠŸèƒ½ï¼æœé¢˜éœ€é…ç½®æŸ æª¬é¢˜åº“TOKENã€‚", "red");
        }
        switchLemtkPro();
      });
      $("#lemtkcopy").click(function () {
        _GM_setClipboard($("#lemtktoken").val());
        logger("å·²å¤åˆ¶Tokenåˆ°å‰ªè´´æ¿ï¼", "green");
      });
    } else {
      $("#ne-21log", window.parent.document).html("");
    }
  
    switchLemtkPro();
    switchLemtkToken();
  }
  function logger(str, color) {
    let logSelector = $("#ne-21log", window.parent.document);
    let _time = (/* @__PURE__ */ new Date()).toLocaleTimeString();
    $('<hr /><p style="color: ' + color + ';">[' + _time + "]" + str + "</p>").prependTo(logSelector).on("click", function () {
      if ("é¢˜ç›®".indexOf($(this).html()) != -1) {
        _GM_setClipboard(getStr($(this).html(), "é¢˜ç›®:", "<br>----&gt;"));
        Swal.fire({
          text: "å·²å¤åˆ¶",
          position: "top-end",
          width: 150,
          timer: 1500,
          showConfirmButton: false
        });
      }
    });
  }
  function getStr(str, start, end) {
    let res = str.match(new RegExp(`${start}(.*?)${end}`));
    return res ? res[1] : null;
  }
  function getTaskParams() {
    try {
      var _iframeScripts = _d.scripts, _p = null;
      for (let i = 0; i < _iframeScripts.length; i++) {
        if (_iframeScripts[i].innerHTML.indexOf('mArg = "";') != -1 && _iframeScripts[i].innerHTML.indexOf("==UserScript==") == -1) {
          _p = getStr(_iframeScripts[i].innerHTML.replace(/\s/g, ""), "try{mArg=", ";}catch");
          return _p;
        }
      }
      return _p;
    } catch (e) {
      return null;
    }
  }
  function getCk(name) {
    let _a;
    return (_a = document.cookie.match(`[;s+]?${name}=([^;]*)`)) == null ? void 0 : _a.pop();
  }
  function check_update() {
    return new Promise((reslove, reject) => {
      try {
        _GM_xmlhttpRequest({
          url: "https://scriptcat.org/api/v2/scripts/942",
          method: "GET",
          timeout: 3e3,
          onload: function (xhr) {
            let { code, data, msg } = JSON.parse(xhr.response)
            version_old = _GM_info["script"]["version"]
            version_new = data.script.version
            if (version_old != version_new) {
              logger("âš æ£€æµ‹åˆ°SuperStaræœ€æ–°ç‰ˆæœ¬ä¸ºv" + version_new + ",è¯·è¿›å…¥ä»¥ä¸Šæ‰˜ç®¡åœ°å€å®‰è£…æ›´æ–°ã€‚", "red")
              logger("âš ScriptCatæ‰˜ç®¡åœ°å€ï¼šhttps://scriptcat.org/zh-CN/script-show-page/942", "red")
              logger("âš Greasyforkæ‰˜ç®¡åœ°å€ï¼šhttps://greasyfork.org/scripts/454801", "red")
              reslove()
            } else {
              logger("è„šæœ¬æ›´æ–°æ£€æµ‹æˆåŠŸï¼Œå½“å‰ä¸ºæœ€æ–°ç‰ˆæœ¬", "green")
              reject()
            }
          },
          ontimeout: () => {
            logger("è„šæœ¬æ›´æ–°æ£€æµ‹é“¾æ¥è¶…æ—¶ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥è„šæœ¬æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚", "red")
            logger("ScriptCatæ‰˜ç®¡åœ°å€ï¼šhttps://scriptcat.org/zh-CN/script-show-page/942", "red")
            logger("Greasyforkæ‰˜ç®¡åœ°å€ï¼šhttps://greasyfork.org/scripts/454801", "red")
            reject()
          },
          onerror: (e) => {
            console.log(e)
            logger("è„šæœ¬æ›´æ–°æ£€æµ‹å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥è„šæœ¬æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚", "red")
            logger("ScriptCatæ‰˜ç®¡åœ°å€ï¼šhttps://scriptcat.org/zh-CN/script-show-page/942", "red")
            logger("Greasyforkæ‰˜ç®¡åœ°å€ï¼šhttps://greasyfork.org/scripts/454801", "red")
            reject()
          }
        });
      } catch (e) {
        console.log(e)
        logger("è„šæœ¬æ›´æ–°æ£€æµ‹å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥è„šæœ¬æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚", "red")
        logger("ScriptCatæ‰˜ç®¡åœ°å€ï¼šhttps://scriptcat.org/zh-CN/script-show-page/942", "red")
        logger("Greasyforkæ‰˜ç®¡åœ°å€ï¼šhttps://greasyfork.org/scripts/454801", "red")
        reject()
      }
    })
  }
  function autoLogin() {
    logger("ç”¨æˆ·å·²è®¾ç½®è‡ªåŠ¨ç™»å½•", "green");
    if (setting.phone.length <= 0 || setting.password.length <= 0) {
      logger("ç”¨æˆ·æœªè®¾ç½®ç™»å½•ä¿¡æ¯", "red");
      return;
    }
    setTimeout(() => {
      $("#phone").val(setting.phone);
      $("#pwd").val(setting.password);
      $("#loginBtn").click();
    }, 3e3);
  }
  function toNext() {
    refreshCourseList().then((res) => {
      if (setting.review || !setting.work) {
        setTimeout(() => {
          $("#ne-21log", window.parent.document).html("");
          if (top.document.querySelector("#mainid > .prev_next.next") == void 0) {
            top.document.querySelector("#prevNextFocusNext").click();
            return;
          }
          top.document.querySelector("#mainid > .prev_next.next").click();
        }, 5e3);
        return;
      }
      let _t = [];
      $.each($(res).find("li"), (_, t) => {
        let curid = $(t).find(".posCatalog_select").attr("id"), status = $(t).find(".prevHoverTips").text(), name = $(t).find(".posCatalog_name").attr("title");
        if (curid.indexOf("cur") != -1) {
          _t.push({ "curid": curid, "status": status, "name": name });
        }
      });
      let _curChaterId = $("#coursetree", window.parent.document).find(".posCatalog_active").attr("id");
      let _curIndex = _t.findIndex((item) => item["curid"] == _curChaterId);
      for (_curIndex; _curIndex < _t.length - 1; _curIndex++) {
        if (_t[_curIndex]["status"].indexOf("å¾…å®Œæˆ") != -1) {
          let c_tabs = top.document.querySelectorAll("#prev_tab li");
          let c_active_tab = top.document.querySelector("#prev_tab li.active");
          if (c_tabs && c_active_tab) {
            let c_active_tab_id = c_active_tab.getAttribute("id").replace(/dct/, "");
            if (c_active_tab_id != c_tabs.length) {
              setTimeout(() => {
                $("#ne-21log", window.parent.document).html("");
                if (top.document.querySelector("#mainid > .prev_next.next") == void 0) {
                  top.document.querySelector("#prevNextFocusNext").click();
                  return;
                }
                top.document.querySelector("#mainid > .prev_next.next").click();
              }, 5e3);
              return;
            }
          }
        }
        let t = _t[_curIndex + 1];
        if (t["status"].indexOf("å¾…å®Œæˆ") != -1) {
          setTimeout(() => {
            $("#ne-21log", window.parent.document).html("");
            if (top.document.querySelector("#mainid > .prev_next.next") == void 0) {
              top.document.querySelector("#prevNextFocusNext").click();
              return;
            }
            top.document.querySelector("#mainid > .prev_next.next").click();
            showBox();
          }, 5e3);
          return;
        } else if (t["status"].indexOf("é—¯å…³") != -1) {
          logger("å½“å‰ä¸ºé—¯å…³æ¨¡å¼ï¼Œå­˜åœ¨æœªå®Œæˆä»»åŠ¡ç‚¹ï¼Œè„šæœ¬å·²æš‚åœè¿è¡Œï¼Œè¯·æ‰‹åŠ¨å®Œæˆå¹¶ç‚¹å‡»ä¸‹ä¸€ç« èŠ‚", "red");
          return;
        } else if (t["status"].indexOf("å¼€æ”¾") != -1) {
          logger("ç« èŠ‚æœªå¼€æ”¾", "red");
          return;
        } else {
          // console.log();
        };
      }
      logger("æ­¤è¯¾ç¨‹å¤„ç†å®Œæ¯•", "green");
      return;
    });
  }
  function missonStart() {
    if (_mlist.length <= 0) {
      logger("æ­¤é¡µé¢ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼Œå‡†å¤‡è·³è½¬é¡µé¢", "green");
      return toNext();
    }
    let _type = _mlist[0]["type"], _dom = _domList[0], _task = _mlist[0];
    if (_type == void 0) {
      _type = _mlist[0]["property"]["module"];
    }
    switch (_type) {
      case "video":
        if (_mlist[0]["property"]["module"] == "insertvideo") {
          logger("å¼€å§‹å¤„ç†è§†é¢‘", "purple");
          missonVideo(_dom, _task);
          break;
        } else if (_mlist[0]["property"]["module"] == "insertaudio") {
          logger("å¼€å§‹å¤„ç†éŸ³é¢‘", "purple");
          missonAudio(_dom, _task);
          break;
        } else {
          logger("æœªçŸ¥ç±»å‹ä»»åŠ¡ï¼Œè¯·è”ç³»ä½œè€…ï¼Œè·³è¿‡", "red");
          switchMission();
          break;
        }
      case "workid":
        logger("å¼€å§‹å¤„ç†æµ‹éªŒ", "purple");
        missonWork(_dom, _task);
        break;
      case "document":
        logger("å¼€å§‹å¤„ç†æ–‡æ¡£", "purple");
        missonDoucument(_dom, _task);
        break;
      case "read":
        logger("å¼€å§‹å¤„ç†é˜…è¯»", "purple");
        missonRead(_dom, _task);
        break;
      case "insertbook":
        logger("å¼€å§‹å¤„ç†è¯»ä¹¦", "purple");
        missonBook(_dom, _task);
        break;
      default:
        let GarbageTasks = ["insertimage"];
        if (GarbageTasks.indexOf(_type) != -1) {
          logger("å‘ç°æ— éœ€å¤„ç†ä»»åŠ¡ï¼Œè·³è¿‡ã€‚", "red");
          switchMission();
        } else {
          logger("æš‚ä¸æ”¯æŒå¤„ç†æ­¤ç±»å‹:" + _type + "ï¼Œè·³è¿‡ã€‚", "red");
          switchMission();
        }
    }
  }
  function missonAudio(dom, obj) {
    if (!setting.audio) {
      logger("ç”¨æˆ·è®¾ç½®ä¸å¤„ç†éŸ³é¢‘ä»»åŠ¡ï¼Œå‡†å¤‡å¼€å§‹ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "red");
      setTimeout(() => {
        switchMission();
      }, 3e3);
      return;
    }
    let isDo;
    if (setting.task) {
      logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡", "red");
      if (obj["jobid"] == void 0 ? false : true) {
        isDo = true;
      } else {
        isDo = false;
      }
    } else {
      logger("å½“å‰é»˜è®¤å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆåŒ…æ‹¬éä»»åŠ¡ç‚¹ä»»åŠ¡ï¼‰", "red");
      isDo = true;
    }
    if (isDo) {
      let classId = _defaults["clazzId"], userId = _defaults["userid"], fid = _defaults["fid"], reportUrl = _defaults["reportUrl"], isPassed = obj["isPassed"], otherInfo = obj["otherInfo"], jobId = obj["property"]["_jobid"], name = obj["property"]["name"], objectId = obj["property"]["objectid"];
      if (!setting.review && isPassed == true) {
        logger("éŸ³é¢‘ï¼š" + name + "æ£€æµ‹å·²å®Œæˆï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
        switchMission();
        return;
      } else if (setting.review) {
        logger("å·²å¼€å¯å¤ä¹ æ¨¡å¼ï¼Œå¼€å§‹å¤„ç†éŸ³é¢‘ï¼š" + name, "pink");
      }
      $.ajax({
        url: _l.protocol + "//" + _l.host + "/ananas/status/" + objectId + "?k=" + fid + "&flag=normal&_dc=" + String(Math.round(/* @__PURE__ */ new Date())),
        type: "GET",
        success: function (res) {
          try {
            let duration = res["duration"], dtoken = res["dtoken"], clipTime = "0_" + duration, playingTime = 0, isdrag = "3", _rt = "0.9";
            if (setting.rate == 0) {
              logger("å·²å¼€å¯éŸ³é¢‘ç§’è¿‡ï¼Œ99.9%ä¼šå¯¼è‡´è¿›åº¦é‡ç½®ã€æŒ‚ç§‘ç­‰é—®é¢˜ã€‚", "red");
              logger("å·²å¼€å¯éŸ³é¢‘ç§’è¿‡ï¼Œè¯·ç­‰å¾…5ç§’ï¼ï¼ï¼", "red");
            } else if (setting.rate > 1 && setting.rate <= 16) {
              logger("å·²å¼€å¯éŸ³é¢‘å€é€Ÿï¼Œå½“å‰å€é€Ÿï¼š" + setting.rate + ",99.9%ä¼šå¯¼è‡´è¿›åº¦é‡ç½®ã€æŒ‚ç§‘ç­‰é—®é¢˜ã€‚", "red");
              logger("å·²å¼€å¯éŸ³é¢‘å€é€Ÿï¼Œè¿›åº¦40ç§’æ›´æ–°ä¸€æ¬¡ï¼Œè¯·ç­‰å¾…ï¼", "red");
            } else if (setting.rate > 16) {
              setting.rate = 1;
              logger("è¶…è¿‡å…è®¸è®¾ç½®çš„æœ€å¤§å€æ•°ï¼Œå·²é‡ç½®ä¸º1å€é€Ÿã€‚", "red");
            } else {
              logger("éŸ³é¢‘è¿›åº¦æ¯éš”40ç§’æ›´æ–°ä¸€æ¬¡ï¼Œè¯·ç­‰å¾…è€å¿ƒç­‰å¾…...", "blue");
            }
            logger("éŸ³é¢‘ï¼š" + name + "å¼€å§‹æ’­æ”¾");
            updateAudio(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt).then((status) => {
              switch (status) {
                case 1:
                  logger("éŸ³é¢‘ï¼š" + name + "å·²æ’­æ”¾" + String(playingTime / duration * 100).slice(0, 4) + "%", "purple");
                  isdrag = "0";
                  break;
                case 3:
                  _rt = _rt === "1" ? "0.9" : "1";
                  break;
                default:
                  console.log(status);
              }
            });
            let _loop = setInterval(() => {
              playingTime += 40 * setting.rate;
              if (playingTime >= duration || setting.rate == 0) {
                clearInterval(_loop);
                playingTime = duration;
                isdrag = "4";
              } else if (_rt === "1" && playingTime == 40 * setting.rate) {
                isdrag = "3";
              } else {
                isdrag = "0";
              }
              updateAudio(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt).then((status) => {
                switch (status) {
                  case 0:
                    playingTime -= 40;
                    break;
                  case 1:
                    logger("éŸ³é¢‘ï¼š" + name + "å·²æ’­æ”¾" + String(playingTime / duration * 100).slice(0, 4) + "%", "purple");
                    break;
                  case 2:
                    clearInterval(_loop);
                    logger("éŸ³é¢‘ï¼š" + name + "æ£€æµ‹æ’­æ”¾å®Œæ¯•ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
                    switchMission();
                    break;
                  case 3:
                    playingTime -= 40;
                    _rt = _rt === "1" ? "0.9" : "1";
                    break;
                  default:
                    console.log(status);
                }
              });
            }, setting.rate == 0 ? 5e3 : 4e4);
          } catch (e) {
            logger("å‘ç”Ÿé”™è¯¯ï¼š" + e, "red");
          }
        }
      });
    } else {
      logger("ç”¨æˆ·è®¾ç½®åªå¤„ç†å±äºä»»åŠ¡ç‚¹çš„ä»»åŠ¡ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
      switchMission();
      return;
    }
  }
  function missonVideo(dom, obj) {
    if (!setting.video) {
      logger("ç”¨æˆ·è®¾ç½®ä¸å¤„ç†è§†é¢‘ä»»åŠ¡ï¼Œå‡†å¤‡å¼€å§‹ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "red");
      setTimeout(() => {
        switchMission();
      }, 3e3);
      return;
    }
    let ifs = $(dom).attr("style");
    $(dom).contents().find("body").find(".main").attr("style", "visibility:hidden;");
    $(dom).contents().find("body").prepend(`
          <div id="ne21_mask" style="` + ifs + `display: flex;flex-wrap: wrap;justify-content: center;align-content: center;flex-direction: column;">
              <h1>ğŸŒ¸ SuperStar æé†’æ‚¨ï¼š</h1>
              <br />
              <h3>è§†é¢‘æ­£åœ¨åå°æ’­æ”¾ï¼Œå…·ä½“è¿›åº¦å‚çœ‹å³ä¾§æµ®çª—ã€‚</h3>
              <br />
              <button id="ne21_button">æ˜¾ç¤ºåŸè§†é¢‘</button>
          </div>
      `);
    $(dom).contents().find("body").find("#ne21_button").click(() => {
      $(dom).contents().find("body").find("#ne21_mask").attr("style", "display:none;");
      $(dom).contents().find("body").find(".main").attr("style", "visibility:none;");
    });
    let isDo;
    if (setting.task) {
      logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡", "red");
      if (obj["jobid"] == void 0 ? false : true) {
        isDo = true;
      } else {
        isDo = false;
      }
    } else {
      logger("å½“å‰é»˜è®¤å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆåŒ…æ‹¬éä»»åŠ¡ç‚¹ä»»åŠ¡ï¼‰", "red");
      isDo = true;
    }
    if (isDo) {
      let classId = _defaults["clazzId"], userId = _defaults["userid"], fid = _defaults["fid"], reportUrl = _defaults["reportUrl"], isPassed = obj["isPassed"], otherInfo = obj["otherInfo"], jobId = obj["property"]["_jobid"], name = obj["property"]["name"], objectId = obj["property"]["objectid"];
      if (!setting.review && isPassed == true) {
        logger("è§†é¢‘ï¼š" + name + "æ£€æµ‹å·²å®Œæˆï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
        switchMission();
        return;
      } else if (setting.review) {
        logger("å·²å¼€å¯å¤ä¹ æ¨¡å¼ï¼Œå¼€å§‹å¤„ç†è§†é¢‘ï¼š" + name, "pink");
      }
      $.ajax({
        url: _l.protocol + "//" + _l.host + "/ananas/status/" + objectId + "?k=" + fid + "&flag=normal&_dc=" + String(Math.round(/* @__PURE__ */ new Date())),
        type: "GET",
        success: function (res) {
          try {
            let duration = res["duration"], dtoken = res["dtoken"], clipTime = "0_" + duration, playingTime = 0, isdrag = "3", _rt = "0.9";
            if (setting.rate == 0) {
              logger("å·²å¼€å¯è§†é¢‘ç§’è¿‡ï¼Œ99.9%ä¼šå¯¼è‡´è¿›åº¦é‡ç½®ã€æŒ‚ç§‘ç­‰é—®é¢˜ã€‚", "red");
              logger("å·²å¼€å¯è§†é¢‘ç§’è¿‡ï¼Œè¯·ç­‰å¾…5ç§’ï¼ï¼ï¼", "red");
            } else if (setting.rate > 1 && setting.rate <= 16) {
              logger("å·²å¼€å¯è§†é¢‘å€é€Ÿï¼Œå½“å‰å€é€Ÿï¼š" + setting.rate + ",99.9%ä¼šå¯¼è‡´è¿›åº¦é‡ç½®ã€æŒ‚ç§‘ç­‰é—®é¢˜ã€‚", "red");
              logger("å·²å¼€å¯è§†é¢‘å€é€Ÿï¼Œè¿›åº¦40ç§’æ›´æ–°ä¸€æ¬¡ï¼Œè¯·ç­‰å¾…ï¼", "red");
            } else if (setting.rate > 16) {
              setting.rate = 1;
              logger("è¶…è¿‡å…è®¸è®¾ç½®çš„æœ€å¤§å€æ•°ï¼Œå·²é‡ç½®ä¸º1å€é€Ÿã€‚", "red");
            } else {
              logger("è§†é¢‘è¿›åº¦æ¯éš”40ç§’æ›´æ–°ä¸€æ¬¡ï¼Œè¯·ç­‰å¾…è€å¿ƒç­‰å¾…...", "blue");
            }
            logger("è§†é¢‘ï¼š" + name + "å¼€å§‹æ’­æ”¾");
            updateVideo(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt).then((status) => {
              switch (status) {
                case 1:
                  logger("è§†é¢‘ï¼š" + name + "å·²æ’­æ”¾" + String(playingTime / duration * 100).slice(0, 4) + "%", "purple");
                  isdrag = "0";
                  break;
                case 3:
                  _rt = _rt === "1" ? "0.9" : "1";
                  break;
                default:
                  console.log(status);
              }
            });
            let _loop = setInterval(() => {
              playingTime += 40 * setting.rate;
              if (playingTime >= duration || setting.rate == 0) {
                clearInterval(_loop);
                playingTime = duration;
                isdrag = "4";
              } else if (_rt === "1" && playingTime == 40 * setting.rate) {
                isdrag = "3";
              } else {
                isdrag = "0";
              }
              updateVideo(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt).then((status) => {
                switch (status) {
                  case 0:
                    playingTime -= 40;
                    break;
                  case 1:
                    logger("è§†é¢‘ï¼š" + name + "å·²æ’­æ”¾" + String(playingTime / duration * 100).slice(0, 4) + "%", "purple");
                    break;
                  case 2:
                    clearInterval(_loop);
                    logger("è§†é¢‘ï¼š" + name + "æ£€æµ‹æ’­æ”¾å®Œæ¯•ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
                    switchMission();
                    break;
                  case 3:
                    playingTime -= 40;
                    _rt = _rt === "1" ? "0.9" : "1";
                    break;
                  default:
                    console.log(status);
                }
              });
            }, setting.rate == 0 ? 5e3 : 4e4);
          } catch (e) {
            logger("å‘ç”Ÿé”™è¯¯ï¼š" + e, "red");
          }
        }
      });
    } else {
      logger("ç”¨æˆ·è®¾ç½®åªå¤„ç†å±äºä»»åŠ¡ç‚¹çš„ä»»åŠ¡ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
      switchMission();
      return;
    }
  }
  function missonBook(dom, obj) {
    if (setting.task) {
      if (obj["jobid"] == void 0) {
        logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡,è·³è¿‡", "red");
        switchMission();
        return;
      }
    }
    let jobId = obj["property"]["jobid"], name = obj["property"]["bookname"], jtoken = obj["jtoken"], knowledgeId = _defaults["knowledgeid"], courseId = _defaults["courseid"], clazzId = _defaults["clazzId"];
    if (obj["job"] == void 0) {
      logger("è¯»ä¹¦ï¼š" + name + "æ£€æµ‹å·²å®Œæˆï¼Œå‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
      switchMission();
      return;
    }
    $.ajax({
      url: _l.protocol + "//" + _l.host + "/ananas/job?jobid=" + jobId + "&knowledgeid=" + knowledgeId + "&courseid=" + courseId + "&clazzid=" + clazzId + "&jtoken=" + jtoken + "&_dc=" + String(Math.round(/* @__PURE__ */ new Date())),
      method: "GET",
      success: function (res) {
        if (res.status) {
          logger("è¯»ä¹¦ï¼š" + name + res.msg + ",å‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
        } else {
          logger("è¯»ä¹¦ï¼š" + name + "å¤„ç†å¼‚å¸¸,è·³è¿‡ã€‚", "red");
        }
        switchMission();
        return;
      }
    });
  }
  function missonDoucument(dom, obj) {
    if (setting.task) {
      if (obj["jobid"] == void 0) {
        logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡,è·³è¿‡", "red");
        switchMission();
        return;
      }
    }
    let jobId = obj["property"]["jobid"], name = obj["property"]["name"], jtoken = obj["jtoken"], knowledgeId = _defaults["knowledgeid"], courseId = _defaults["courseid"], clazzId = _defaults["clazzId"];
    if (obj["job"] == void 0) {
      logger("æ–‡æ¡£ï¼š" + name + "æ£€æµ‹å·²å®Œæˆï¼Œå‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
      switchMission();
      return;
    }
    $.ajax({
      url: _l.protocol + "//" + _l.host + "/ananas/job/document?jobid=" + jobId + "&knowledgeid=" + knowledgeId + "&courseid=" + courseId + "&clazzid=" + clazzId + "&jtoken=" + jtoken + "&_dc=" + String(Math.round(/* @__PURE__ */ new Date())),
      method: "GET",
      success: function (res) {
        if (res.status) {
          logger("æ–‡æ¡£ï¼š" + name + res.msg + ",å‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
        } else {
          logger("æ–‡æ¡£ï¼š" + name + "å¤„ç†å¼‚å¸¸,è·³è¿‡ã€‚", "red");
        }
        switchMission();
        return;
      }
    });
  }
  function missonRead(dom, obj) {
    if (setting.task) {
      if (obj["jobid"] == void 0) {
        logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡,è·³è¿‡", "red");
        switchMission();
        return;
      }
    }
    let jobId = obj["property"]["jobid"], name = obj["property"]["title"], jtoken = obj["jtoken"], knowledgeId = _defaults["knowledgeid"], courseId = _defaults["courseid"], clazzId = _defaults["clazzId"];
    if (obj["job"] == void 0) {
      logger("é˜…è¯»ï¼š" + name + ",æ£€æµ‹å·²å®Œæˆï¼Œå‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
      switchMission();
      return;
    }
    $.ajax({
      url: _l.protocol + "//" + _l.host + "/ananas/job/readv2?jobid=" + jobId + "&knowledgeid=" + knowledgeId + "&courseid=" + courseId + "&clazzid=" + clazzId + "&jtoken=" + jtoken + "&_dc=" + String(Math.round(/* @__PURE__ */ new Date())),
      method: "GET",
      success: function (res) {
        if (res.status) {
          logger("é˜…è¯»ï¼š" + name + res.msg + ",å‡†å¤‡æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
        } else {
          logger("é˜…è¯»ï¼š" + name + "å¤„ç†å¼‚å¸¸,è·³è¿‡ã€‚", "red");
        }
        switchMission();
        return;
      }
    });
  }
  function missonWork(dom, obj) {
    if (!setting.work) {
      logger("ç”¨æˆ·è®¾ç½®ä¸è‡ªåŠ¨å¤„ç†æµ‹éªŒï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
      switchMission();
      return;
    }
    let isDo;
    if (setting.task) {
      logger("å½“å‰åªå¤„ç†ä»»åŠ¡ç‚¹ä»»åŠ¡", "red");
      if (obj["jobid"] == void 0 ? false : true) {
        isDo = true;
      } else {
        isDo = false;
      }
    } else {
      logger("å½“å‰é»˜è®¤å¤„ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆåŒ…æ‹¬éä»»åŠ¡ç‚¹ä»»åŠ¡ï¼‰", "red");
      isDo = true;
    }
    if (isDo) {
      if (obj["jobid"] !== void 0) {
        let phoneWeb = _l.protocol + "//" + _l.host + "/work/phone/work?workId=" + obj["jobid"].replace("work-", "") + "&courseId=" + _defaults["courseid"] + "&clazzId=" + _defaults["clazzId"] + "&knowledgeId=" + _defaults["knowledgeid"] + "&jobId=" + obj["jobid"] + "&enc=" + obj["enc"];
        setTimeout(() => {
          startDoPhoneCyWork(0, dom, phoneWeb);
        }, 3e3);
      } else {
        setTimeout(() => {
          startDoCyWork(0, dom);
        }, 3e3);
      }
    } else {
      logger("ç”¨æˆ·è®¾ç½®åªå¤„ç†å±äºä»»åŠ¡ç‚¹çš„ä»»åŠ¡ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡", "green");
      switchMission();
      return;
    }
  }
  function doPhoneWork($dom) {
    let $cy = $dom.find(".Wrappadding form");
    $subBtn = $cy.find(".zquestions .zsubmit .btn-ok-bottom");
    $saveBtn = $cy.find(".zquestions .zsubmit .btn-save");
    let TimuList = $cy.find(".zquestions .Py-mian1");
    startDoPhoneTimu(0, TimuList);
  }
  function startDoPhoneTimu(index, TimuList) {
    if (index == TimuList.length) {
      if (setting.sub) {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå‡†å¤‡è‡ªåŠ¨æäº¤ã€‚", "green");
        setTimeout(() => {
          $subBtn.click();
          setTimeout(() => {
            logger("æäº¤æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
            _mlist.splice(0, 1);
            _domList.splice(0, 1);
            setTimeout(() => {
              switchMission();
            }, 3e3);
          }, 3e3);
        }, 5e3);
      } else if (setting.force) {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå­˜åœ¨æ— ç­”æ¡ˆé¢˜ç›®,ç”±äºç”¨æˆ·è®¾ç½®äº†å¼ºåˆ¶æäº¤ï¼Œå‡†å¤‡è‡ªåŠ¨æäº¤ã€‚", "red");
        setTimeout(() => {
          $subBtn.click();
          setTimeout(() => {
            logger("æäº¤æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
            _mlist.splice(0, 1);
            _domList.splice(0, 1);
            setTimeout(() => {
              switchMission();
            }, 3e3);
          }, 3e3);
        }, 5e3);
      } else {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå­˜åœ¨æ— ç­”æ¡ˆé¢˜ç›®æˆ–ç”¨æˆ·è®¾ç½®ä¸è‡ªåŠ¨æäº¤ï¼Œè‡ªåŠ¨ä¿å­˜ï¼", "green");
        setTimeout(() => {
          $saveBtn.click();
          setTimeout(() => {
            logger("ä¿å­˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
            _mlist.splice(0, 1);
            _domList.splice(0, 1);
            setTimeout(() => {
              switchMission();
            }, 3e3);
          }, 3e3);
        }, 5e3);
      }
      return;
    }
    let questionFull = $(TimuList[index]).find(".Py-m1-title").html();
    let _question = tidyQuestion(questionFull).replace(/.*?\[.*?é¢˜\]\s*\n\s*/, "").trim();
    let _type = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4, é€‰æ‹©é¢˜: 5 }[questionFull.match(/.*?\[(.*?)]|$/)[1]];
    let _a = [];
    let _answerTmpArr, _options;
    switch (_type) {
      case 0:
        // singleChoice
        _answerTmpArr = $(TimuList[index]).find(".answerList.singleChoice li");
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()).replace(/^[A-Z]\s*\n\s*/, "").trim());
        });
        _options = _a.join("|");
        getAnswer(_type, _question, _options).then((agrs) => {
          let _i = _a.findIndex((item) => item == agrs);
          if (_i == -1) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setting.sub = 0;
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          } else {
            $(_answerTmpArr[_i]).click();
            logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        });
        break;
      case 1:
        // multiChoice
        _answerTmpArr = $(TimuList[index]).find('.answerList.multiChoice li')
        _answerTmpArr.each(function () {
          let answerText = tidyStr($(this).html()).replace(/^[A-Z]\s*\n\s*/, "").trim();
          _a.push(answerText);
        });
        _options = _a.join("|");
        getAnswer(_type, _question, _options).then((agrs) => {
          if (agrs == "æš‚æ— ç­”æ¡ˆ") {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setting.sub = 0;
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          } else {
            $.each(_answerTmpArr, (i, t) => {
              let _tt = tidyStr($(t).html()).replace(/^[A-Z]\s*\n\s*/, "").trim();
              if (agrs.indexOf(_tt) != -1) {
                setTimeout(() => {
                  $(_answerTmpArr[i]).click();
                }, 300);
              }
            });
            let check = 0;
            setTimeout(() => {
              $.each(_answerTmpArr, (i, t) => {
                if ($(t).attr("class").indexOf("cur") != -1) {
                  check = 1;
                }
              });
              if (check) {
                logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
              } else {
                logger("æœªèƒ½æ­£ç¡®é€‰æ‹©ç­”æ¡ˆï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©ï¼Œè·³è¿‡æ­¤é¢˜", "red");
                setting.sub = 0;
              }
              setTimeout(() => {
                startDoPhoneTimu(index + 1, TimuList);
              }, setting.time);
            }, 1e3);
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        });
        break;
      case 2:
        // fillBlank 
        _options = "";
        getAnswer(_type, _question, _options).then((agrs) => {
          if (agrs == "æš‚æ— ç­”æ¡ˆ") {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setting.sub = 0;
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
            return;
          }
          let answers = agrs.split("#");
          let tkList = $(TimuList[index]).find(".blankList2 input");
          $.each(tkList, (i, t) => {
            setTimeout(() => {
              $(t).val(answers[i]);
            }, 200);
          });
          setTimeout(() => {
            startDoPhoneTimu(index + 1, TimuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        });
        break;
      case 3:
        // judge
        _options = "å¯¹|é”™";
        getAnswer(_type, _question, _options).then((agrs) => {
          if (agrs == "æš‚æ— ç­”æ¡ˆ") {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setting.sub = 0;
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          } else {
            let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
            _answerTmpArr = $(TimuList[index]).find(".answerList.panduan li");
            if (_true.indexOf(agrs) != -1) {
              $.each(_answerTmpArr, (i, t) => {
                if ($(t).attr("val-param") == "true") {
                  $(t).click();
                }
              });
            } else {
              $.each(_answerTmpArr, (i, t) => {
                if ($(t).attr("val-param") == "false") {
                  $(t).click();
                }
              });
            }
            logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        });
        break;
      case 4:
        // shortAnswer
        _options = "";
        getAnswer(_type, _question, _options).then((agrs) => {
          if (agrs == 'æš‚æ— ç­”æ¡ˆ') {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red")
            setting.sub = 0
            setTimeout(() => { startDoPhoneTimu(index + 1, TimuList) }, setting.time)
            return
          }
          logger("ç®€ç­”é¢˜ä¸æ”¯æŒè‡ªåŠ¨å¡«å…¥ï¼Œè¯·å‚è€ƒä¿®æ”¹ç­”æ¡ˆï¼Œæ‰‹åŠ¨å®Œæˆã€‚", "purple");
          setting.sub = 0
          setTimeout(() => { startDoPhoneTimu(index + 1, TimuList) }, setting.time)
        }).catch((agrs) => {
          if (agrs['c'] == 0) {
            setTimeout(() => { startDoPhoneTimu(index + 1, TimuList) }, setting.time)
          }
        })
        break
  
      case 5:
        // choice 
        _answerTmpArr = $(TimuList[index]).find(".answerList.singleChoice li");
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()).replace(/^[A-Z]\s*\n\s*/, "").trim());
        });
        _options = _a.join("|");
        getAnswer(_type, _question, _options).then((agrs) => {
          setting.sub = 0;
          logger("æ­¤ç±»å‹é¢˜ç›®æ— æ³•åŒºåˆ†å•/å¤šé€‰ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©ç­”æ¡ˆ", "red");
          setTimeout(() => {
            startDoPhoneTimu(index + 1, TimuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              startDoPhoneTimu(index + 1, TimuList);
            }, setting.time);
          }
        });
        break;
      default:
        logger("æš‚ä¸æ”¯æŒå¤„ç†æ­¤ç±»å‹é¢˜ç›®ï¼š" + questionFull.match(/.*?\[(.*?)]|$/)[1] + ",è·³è¿‡ï¼è¯·æ‰‹åŠ¨ä½œç­”ã€‚", "red");
        setting.sub = 0;
        setTimeout(() => {
          startDoPhoneTimu(index + 1, TimuList);
        }, setting.time);
        break;
    }
  }
  function startDoPhoneCyWork(index, doms, phoneWeb) {
    if (index == doms.length) {
      logger("æ­¤é¡µé¢å…¨éƒ¨æµ‹éªŒå·²å¤„ç†å®Œæ¯•ï¼å‡†å¤‡è¿›è¡Œä¸‹ä¸€é¡¹ä»»åŠ¡");
      setTimeout(missonStart, 5e3);
      return;
    }
    logger("ç­‰å¾…æµ‹éªŒæ¡†æ¶åŠ è½½...", "purple");
    elmGetter.get("iframe", $(doms[index]).contents()[0]).then((element) => {
      let workIframe = element;
      if (workIframe.length == 0) {
        setTimeout(() => {
          startDoPhoneCyWork(index, doms);
        }, 5e3);
      }
      let workStatus = $(workIframe).contents().find(".newTestCon .newTestTitle .testTit_status").text().trim();
      if (!workStatus) {
        logger("è·å–æµ‹éªŒçŠ¶æ€å¤±è´¥ï¼Œè¯·è”ç³»ä½œè€…ä¿®å¤ï¼", "red");
        _domList.splice(0, 1);
        setTimeout(missonStart, 2e3);
        return;
      }
      if (setting.share && workStatus.indexOf("å·²å®Œæˆ") != -1) {
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æ£€æµ‹åˆ°æ­¤æµ‹éªŒå·²å®Œæˆ,å‡†å¤‡æ”¶å½•ç­”æ¡ˆã€‚", "green");
        setTimeout(() => {
          upLoadWork(index, doms, workIframe);
        }, 2e3);
      } else if (workStatus.indexOf("å¾…åš") != -1 || workStatus.indexOf("å¾…å®Œæˆ") != -1) {
        logger("æµ‹éªŒï¼š" + (index + 1) + ",å‡†å¤‡å¤„ç†æ­¤æµ‹éªŒ...", "purple");
        $(workIframe).attr("src", phoneWeb);
        elmGetter.get('iframe[src="' + phoneWeb + '"]', $(doms[index]).contents()[0]).then((element2) => {
          setTimeout(() => {
            doPhoneWork($(element2).contents());
          }, 3e3);
        });
      } else if (workStatus.indexOf("å¾…æ‰¹é˜…") != -1) {
        _mlist.splice(0, 1);
        _domList.splice(0, 1);
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æµ‹éªŒå¾…æ‰¹é˜…,è·³è¿‡", "red");
        setTimeout(() => {
          startDoPhoneCyWork(index + 1, doms, phoneWeb);
        }, 5e3);
      } else {
        _mlist.splice(0, 1);
        _domList.splice(0, 1);
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æœªçŸ¥çŠ¶æ€æˆ–ç”¨æˆ·é€‰æ‹©ä¸æ”¶å½•ç­”æ¡ˆ,è·³è¿‡", "red");
        setTimeout(() => {
          startDoPhoneCyWork(index + 1, doms, phoneWeb);
        }, 5e3);
      }
    });
  }
  function startDoCyWork(index, doms) {
    if (index == doms.length) {
      logger("æ­¤é¡µé¢å…¨éƒ¨æµ‹éªŒå·²å¤„ç†å®Œæ¯•ï¼å‡†å¤‡è¿›è¡Œä¸‹ä¸€é¡¹ä»»åŠ¡");
      setTimeout(missonStart, 5e3);
      return;
    }
    logger("ç­‰å¾…æµ‹éªŒæ¡†æ¶åŠ è½½...", "purple");
    elmGetter.get("iframe", $(doms[index]).contents()[0]).then((element) => {
      let workIframe = element;
      if (workIframe.length == 0) {
        setTimeout(() => {
          startDoCyWork(index, doms);
        }, 5e3);
      }
      let workStatus = $(workIframe).contents().find(".newTestCon .newTestTitle .testTit_status").text().trim();
      if (!workStatus) {
        logger("è·å–æµ‹éªŒçŠ¶æ€å¤±è´¥ï¼Œè¯·è”ç³»ä½œè€…ä¿®å¤ï¼", "red");
        _domList.splice(0, 1);
        setTimeout(missonStart, 2e3);
        return;
      }
      if (setting.share && workStatus.indexOf("å·²å®Œæˆ") != -1) {
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æ£€æµ‹åˆ°æ­¤æµ‹éªŒå·²å®Œæˆ,å‡†å¤‡æ”¶å½•ç­”æ¡ˆã€‚", "green");
        setTimeout(() => {
          upLoadWork(index, doms, workIframe);
        }, 2e3);
      } else if (workStatus.indexOf("å¾…åš") != -1 || workStatus.indexOf("å¾…å®Œæˆ") != -1) {
        logger("æµ‹éªŒï¼š" + (index + 1) + ",å‡†å¤‡å¤„ç†æ­¤æµ‹éªŒ...", "purple");
        setTimeout(() => {
          doWork(index, doms, workIframe);
        }, 5e3);
      } else if (workStatus.indexOf("å¾…æ‰¹é˜…") != -1) {
        _mlist.splice(0, 1);
        _domList.splice(0, 1);
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æµ‹éªŒå¾…æ‰¹é˜…,è·³è¿‡", "red");
        setTimeout(() => {
          startDoCyWork(index + 1, doms);
        }, 5e3);
      } else {
        _mlist.splice(0, 1);
        _domList.splice(0, 1);
        logger("æµ‹éªŒï¼š" + (index + 1) + ",æœªçŸ¥çŠ¶æ€æˆ–ç”¨æˆ·é€‰æ‹©ä¸æ”¶å½•ç­”æ¡ˆ,è·³è¿‡", "red");
        setTimeout(() => {
          startDoCyWork(index + 1, doms);
        }, 5e3);
      }
    });
  }
  function missonHomeWork() {
    logger("å¼€å§‹å¤„ç†ä½œä¸š", "green");
    let $_homeworktable = $(".mark_table").find("form");
    let TimuList = $_homeworktable.find(".questionLi");
    doHomeWork(0, TimuList);
  }
  function doHomeWork(index, TiMuList) {
    if (index == TiMuList.length) {
      logger("ä½œä¸šé¢˜ç›®å·²å…¨éƒ¨å®Œæˆ", "green");
      return;
    }
    let _type = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4 }[$(TiMuList[index]).attr("typename")];
    let _questionFull = $(TiMuList[index]).find(".mark_name").html();
    let _question = tidyQuestion(_questionFull).replace(/^[(].*?[)]/, "").trim();
    let _a = [];
    let _answerTmpArr, _textareaList, _options;
    switch (_type) {
      case 0:
        // singleChoice
        _answerTmpArr = $(TiMuList[index]).find(".stem_answer").find(".answer_p");
        _answerTmpArr.each(function () {
          let answerText = tidyStr($(this).text()).replace(/[ABCD]/g, '').trim();
          _a.push(answerText);
        });
        _options = _a.join("|");
        getAnswer(_type, _question, _options).then((agrs) => {
          $.each(_answerTmpArr, (i, t) => {
            _a.push(tidyStr($(t).html()));
          });
          let _i2 = _a.findIndex((item) => item == agrs);
          if (_i2 == -1) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          } else {
            setTimeout(() => {
              let check = $(_answerTmpArr[_i2]).parent().find("span").attr("class");
              if (check.indexOf("check_answer") == -1) {
                $(_answerTmpArr[_i2]).parent().click();
              }
              logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
              setTimeout(() => {
                doHomeWork(index + 1, TiMuList);
              }, setting.time);
            }, 300);
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          }
        });
        break;
      case 1:
        // multiChoice
        _answerTmpArr = $(TiMuList[index]).find(".stem_answer").find(".answer_p");
        _answerTmpArr.each(function () {
          let answerText = tidyStr($(this).text()).replace(/[ABCD]/g, '').trim();
          _a.push(answerText);
        });
        _options = _a.join("|");
        getAnswer(_type, _question, _options).then((agrs) => {
          $.each(_answerTmpArr, (i, t) => {
            if (agrs.indexOf(tidyStr($(t).html())) != -1) {
              setTimeout(() => {
                let check = $(_answerTmpArr[i]).parent().find("span").attr("class");
                if (check.indexOf("check_answer_dx") == -1) {
                  $(_answerTmpArr[i]).parent().click();
                }
              }, 300);
            }
          });
          logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
          setTimeout(() => {
            doHomeWork(index + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          }
        });
        break;
      case 2:
        // fillBlank
        _options = "";
        _textareaList = $(TiMuList[index]).find(".stem_answer").find(".Answer .divText .textDIV textarea");
        getAnswer(_type, _question, _options).then((agrs) => {
          let _answerTmpArr2 = agrs.split("#");
          $.each(_textareaList, (i, t) => {
            let _id = $(t).attr("id");
            setTimeout(() => {
              UE.getEditor(_id).setContent(_answerTmpArr2[i]);
            }, 300);
          });
          logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
          setTimeout(() => {
            doHomeWork(index + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          }
        });
        break;
      case 3:
        // judge
        _options = "å¯¹|é”™";
        let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
        let _false = "é”™è¯¯|å¦|é”™|Ã—|F|wr";
        let _i = 0;
        _answerTmpArr = $(TiMuList[index]).find(".stem_answer").find(".answer_p");
        $.each(_answerTmpArr, (i, t) => {
          _a.push($(t).text().trim());
        });
        getAnswer(_type, _question, _options).then((agrs) => {
          if (_true.indexOf(agrs) != -1) {
            _i = _a.findIndex((item) => _true.indexOf(item) != -1);
          } else if (_false.indexOf(agrs) != -1) {
            _i = _a.findIndex((item) => _false.indexOf(item) != -1);
          } else {
            logger("ç­”æ¡ˆåŒ¹é…å‡ºé”™ï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
            return;
          }
          setTimeout(() => {
            let check = $(_answerTmpArr[_i]).parent().find("span").attr("class");
            if (check.indexOf("check_answer") == -1) {
              $(_answerTmpArr[_i]).parent().click();
            }
          }, 300);
          logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
          setTimeout(() => {
            doHomeWork(index + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          }
        });
        break;
      case 4:
        // shortAnswer
        _options = "";
        _textareaList = $(TiMuList[index]).find(".stem_answer").find(".eidtDiv textarea");
        getAnswer(_type, _question, _options).then((agrs) => {
          $.each(_textareaList, (i, t) => {
            let _id = $(t).attr("id");
            setTimeout(() => {
              UE.getEditor(_id).setContent(agrs);
            }, 300);
          });
          logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
          setTimeout(() => {
            doHomeWork(index + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            setTimeout(() => {
              doHomeWork(index + 1, TiMuList);
            }, setting.time);
          }
        });
        break;
      default:
        logger("æš‚ä¸æ”¯æŒå¤„ç†æ­¤é¢˜å‹ï¼š" + $(TiMuList[index]).attr("typename") + ",è·³è¿‡ã€‚", "red");
        setTimeout(() => {
          doHomeWork(index + 1, TiMuList);
        }, setting.time);
    }
  }
  function missonExam() {
    let $_examtable = $(".mark_table").find(".whiteDiv");
    let _questionFull = tidyStr($_examtable.find("h3.mark_name").html().trim());
    let _qType = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4, è®ºè¿°é¢˜: 4, å†™ä½œé¢˜: 5, ç¿»è¯‘é¢˜: 6 }[_questionFull.match(/[(](.*?),.*?åˆ†[)]|$/)[1]];
    let _question = tidyQuestion(_questionFull.replace(/[(].*?åˆ†[)]/, "").replace(/^\s*/, ""));
    let $_ansdom = $_examtable.find("#submitTest").find(".stem_answer");
    let _answerTmpArr, _options;
    let _a = [];
    switch (_qType) {
      case 0:
        _answerTmpArr = $_ansdom.find(".clearfix.answerBg .fl.answer_p");
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()));
        });
        _options = _a.join("|");
        getAnswer(_qType, _question, _options).then((agrs) => {
  
          let _i2 = _a.findIndex((item) => item == agrs);
          if (_i2 == -1) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡æ­¤é¢˜", "red");
            setTimeout(toNextExam, 5e3);
          } else {
            setTimeout(() => {
              if ($(_answerTmpArr[_i2]).parent().find("span").attr("class").indexOf("check_answer") == -1) {
                $(_answerTmpArr[_i2]).parent().click();
                logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
                toNextExam();
              } else {
                logger("æ­¤é¢˜å·²ä½œç­”ï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
                toNextExam();
              }
            }, 300);
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            toNextExam();
          }
        });
        break;
      case 1:
        // multiChoice
        _answerTmpArr = $_ansdom.find(".clearfix.answerBg .fl.answer_p");
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()))
        });
        _options = _a.join("|");
        getAnswer(_qType, _question, _options).then((agrs) => {
          if ($_ansdom.find(".clearfix.answerBg span.check_answer_dx").length > 0) {
            logger("æ­¤é¢˜å·²ä½œç­”ï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            toNextExam();
          } else {
            $.each(_answerTmpArr, (i, t) => {
              if (agrs.indexOf(tidyStr($(t).html())) != -1) {
                setTimeout(() => {
                  $(_answerTmpArr[i]).parent().click();
                }, 300);
              }
            });
            logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            toNextExam();
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            toNextExam();
          }
        });
        break;
      case 2:
        // fillBlank
        _options = "";
        let _textareaList = $_ansdom.find(".Answer .divText .subEditor textarea");
        getAnswer(_qType, _question, _options).then((agrs) => {
          let _answerTmpArr2 = agrs.split("#");
          $.each(_textareaList, (i, t) => {
            let _id = $(t).attr("id");
            setTimeout(() => {
              UE.getEditor(_id).setContent(_answerTmpArr2[i]);
            }, 300);
          });
          logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
          toNextExam();
        }).catch((agrs) => {
          if (agrs["c"] = 0) {
            toNextExam();
          }
        });
        break;
      case 3:
        _options = "å¯¹|é”™";
        let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
        let _false = "é”™è¯¯|å¦|é”™|Ã—|F|wr";
        let _i = 0;
        _answerTmpArr = $_ansdom.find(".clearfix.answerBg .fl.answer_p");
        $.each(_answerTmpArr, (i, t) => {
          _a.push($(t).text().trim());
        });
        getAnswer(_qType, _question, _options).then((agrs) => {
          if (_true.indexOf(agrs) != -1) {
            _i = _a.findIndex((item) => _true.indexOf(item) != -1);
          } else if (_false.indexOf(agrs) != -1) {
            _i = _a.findIndex((item) => _false.indexOf(item) != -1);
          } else {
            logger("ç­”æ¡ˆåŒ¹é…å‡ºé”™ï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            toNextExam();
            return;
          }
          if ($(_answerTmpArr[_i]).parent().find("span").attr("class").indexOf("check_answer") == -1) {
            setTimeout(() => {
              $(_answerTmpArr[_i]).parent().click();
            }, 300);
            logger("è‡ªåŠ¨ç­”é¢˜æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            toNextExam();
          } else {
            logger("æ­¤é¢˜å·²ä½œç­”ï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€é¢˜", "green");
            toNextExam();
          }
        }).catch((agrs) => {
          if (agrs["c"] == 0) {
            toNextExam();
          }
        });
        break;
      case 4:
        // shortAnswer
        _options = "";
        _answerEle = $_ansdom.find('.subEditor textarea')
        $.each(_answerEle, (i, t) => {
          getAnswer(_qType, _question, _options).then((agrs) => {
            let _id = $(t).attr('name')
            setTimeout(() => { UE.getEditor(_id).setContent(agrs) }, 300);
            toNextExam()
          });
        });
        break;
      case 5:
        // write
        _answerEle = $_ansdom.find('.subEditor textarea')
        _options = "";
        $.each(_answerEle, (i, t) => {
          getAnswer(_qType, _question, _options).then((agrs) => {
            let _id = $(t).attr('name')
            setTimeout(() => { UE.getEditor(_id).setContent(agrs) }, 300);
            toNextExam()
          });
        });
        break;
      case 6:
        // translate
        _answerEle = $_ansdom.find('.subEditor textarea')
        _options
        $.each(_answerEle, (i, t) => {
          getAnswer(_qType, _question, _options).then((agrs) => {
            let _id = $(t).attr('name')
            setTimeout(() => { UE.getEditor(_id).setContent(agrs) }, 300);
            toNextExam()
          });
        });
        break;
      default:
        logger('æš‚ä¸æ”¯æŒå¤„ç†æ­¤é¢˜å‹ï¼š' + $(TiMuList[index]).attr('typename') + ',è·³è¿‡ã€‚', 'red')
        setTimeout(() => { doHomeWork(index + 1, TiMuList) }, setting.time)
    }
  }
  function toNextExam() {
    if (setting.examTurn) {
      let $_examtable = $(".mark_table").find(".whiteDiv");
      let $nextbtn = $_examtable.find(".nextDiv a.jb_btn");
      setTimeout(() => {
        $nextbtn.click();
      }, setting.examTurnTime ? 2e3 + Math.floor(Math.random() * 5 + 1) * 1e3 : 2e3);
    } else {
      logger("ç”¨æˆ·è®¾ç½®ä¸è‡ªåŠ¨è·³è½¬ä¸‹ä¸€é¢˜ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»", "blue");
    }
  }
  function uploadExam() {
    logger("è€ƒè¯•ç­”æ¡ˆæ”¶å½•åŠŸèƒ½å¤„äºbateé˜¶æ®µï¼Œé‡åˆ°bugè¯·åŠæ—¶åé¦ˆ!!", "red");
    logger("å¼€å§‹æ”¶å½•è€ƒè¯•ç­”æ¡ˆ", "green");
    let TimuList = $(".mark_table .mark_item .questionLi");
    let data = [];
    $.each(TimuList, (i, t) => {
      let _a = {};
      let _answer;
      let _answerTmpArr, _answerList = [];
      let TiMuFull = tidyQuestion($(t).find("h3").html());
      let _type = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4 }[TiMuFull.match(/[(](.*?)[)]|$/)[1].replace(/,.*?åˆ†/, "")];
      let _question = TiMuFull.replace(/^[(].*?[)]|$/, "").trim();
      let _rightAns = $(t).find(".mark_answer").find(".colorGreen").text().replace(/æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "").trim();
      switch (_type) {
        case 0:
          if (_rightAns.length <= 0) {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isZero != "0") {
              _rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
            } else {
              break;
            }
          }
          _answerTmpArr = $(t).find(".mark_letter li");
          $.each(_answerTmpArr, (a, b) => {
            _answerList.push(tidyStr($(b).html()).replace(/[A-Z].\s*/, ""));
          });
          let _i = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[_rightAns];
          _answer = _answerList[_i];
          _a["question"] = _question;
          _a["type"] = _type;
          _a["answer"] = _answer;
          data.push(_a);
          break;
        case 1:
          _answer = [];
          if (_rightAns.length <= 0) {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isTrue2 == "marking_bandui" || _isZero != "0") {
              _rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
            } else {
              break;
            }
          }
          _answerTmpArr = $(t).find(".mark_letter li");
          $.each(_answerTmpArr, (a, b) => {
            _answerList.push(tidyStr($(b).html()).replace(/[A-Z].\s*/, ""));
          });
          $.each(_rightAns.split(""), (c, d) => {
            let _i2 = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[d];
            _answer.push(_answerList[_i2]);
          });
          _a["question"] = _question;
          _a["type"] = _type;
          _a["answer"] = _answer.join("#");
          data.push(_a);
          break;
        case 2:
          _answerTmpArr = [];
          let answers = $(t).find(".mark_answer").find(".colorDeep").find("dd");
          if (_rightAns.length <= 0) {
            $.each(answers, (i2, t2) => {
              _isTrue = $(t2).find("span:eq(1)").attr("class");
              if (_isTrue == "marking_dui") {
                _rightAns = $(t2).find("span:eq(0)").html();
                _answerTmpArr.push(_rightAns.replace(/[(][0-9].*?[)]/, "").replace(/ç¬¬.*?ç©º:/, "").trim());
              } else {
                return;
              }
            });
            _answer = _answerTmpArr.join("#");
          } else {
            _answer = _rightAns.replace(/\s/g, "").replace(/[(][0-9].*?[)]/g, "#").replace(/ç¬¬.*?ç©º:/g, "#").replace(/^#*/, "");
          }
          if (_answer.length != 0) {
            _a["question"] = _question;
            _a["type"] = _type;
            _a["answer"] = _answer;
            data.push(_a);
          }
          break;
        case 3:
          if (_rightAns.length <= 0) {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isZero != "0") {
              _rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
            } else {
              let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
              _rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
              if (_true.indexOf(_rightAns) != -1) {
                _rightAns = "é”™";
              } else {
                _rightAns = "å¯¹";
              }
            }
          }
          _a["question"] = _question;
          _a["type"] = _type;
          _a["answer"] = _rightAns;
          data.push(_a);
          break;
        case 4:
          if (_rightAns.length <= 0) {
            break;
          }
          _a["question"] = _question;
          _a["type"] = _type;
          _a["answer"] = _rightAns;
          data.push(_a);
          break;
      }
    });
    setTimeout(() => {
      uploadAnswer(data, 0);
    }, 1500);
  }
  function refreshCourseList() {
    let _p = parseUrlParams();
    return new Promise((resolve, reject) => {
      $.ajax({
        url: _l.protocol + "//" + _l.host + "/mycourse/studentstudycourselist?courseId=" + _p["courseid"] + "&chapterId=" + _p["knowledgeid"] + "&clazzid=" + _p["clazzid"] + "&mooc2=1",
        type: "GET",
        dateType: "html",
        success: function (res) {
          resolve(res);
        }
      });
    });
  }
  function updateAudio(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt) {
    return new Promise((resolve, reject) => {
      getEnc(classId, userId, jobId, objectId, playingTime, duration, clipTime).then((enc) => {
        if (reportUrlChange) {
          reportUrl = http2https(reportUrl);
        }
        $.ajax({
          url: reportUrl + "/" + dtoken + "?clazzId=" + classId + "&playingTime=" + playingTime + "&duration=" + duration + "&clipTime=" + clipTime + "&objectId=" + objectId + "&otherInfo=" + otherInfo + "&jobid=" + jobId + "&userid=" + userId + "&isdrag=" + isdrag + "&view=pc&enc=" + enc + "&rt=" + Number(_rt) + "&dtype=Audio&_t=" + String(Math.round(/* @__PURE__ */ new Date())),
          type: "GET",
          success: function (res) {
            try {
              if (res["isPassed"]) {
                if (setting.review && playingTime != duration) {
                  resolve(1);
                } else {
                  resolve(2);
                }
              } else {
                if (setting.rate == 0 && playingTime == duration) {
                  resolve(2);
                } else {
                  resolve(1);
                }
              }
            } catch (e) {
              logger("å‘ç”Ÿé”™è¯¯ï¼š" + e, "red");
              resolve(0);
            }
          },
          error: function (xhr) {
            if (xhr.status == 403) {
              logger("SuperStarè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå°è¯•æ›´æ¢å‚æ•°ï¼Œ40såå°†é‡è¯•ï¼Œè¯·ç­‰å¾…...", "red");
              resolve(3);
            } else {
              reportUrlChange = 1;
              logger("SuperStarè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæŒç»­å‡ºç°ï¼Œè¯·è”ç³»ä½œè€…", "red");
            }
          }
        });
      });
    });
  }
  function updateVideo(reportUrl, dtoken, classId, playingTime, duration, clipTime, objectId, otherInfo, jobId, userId, isdrag, _rt) {
    return new Promise((resolve, reject) => {
      getEnc(classId, userId, jobId, objectId, playingTime, duration, clipTime).then((enc) => {
        if (reportUrlChange) {
          reportUrl = http2https(reportUrl);
        }
        $.ajax({
          url: reportUrl + "/" + dtoken + "?clazzId=" + classId + "&playingTime=" + playingTime + "&duration=" + duration + "&clipTime=" + clipTime + "&objectId=" + objectId + "&otherInfo=" + otherInfo + "&jobid=" + jobId + "&userid=" + userId + "&isdrag=" + isdrag + "&view=pc&enc=" + enc + "&rt=" + _rt + "&dtype=Video&_t=" + String(Math.round(/* @__PURE__ */ new Date())),
          type: "GET",
          success: function (res) {
            try {
              if (res["isPassed"]) {
                if (setting.review && playingTime != duration) {
                  resolve(1);
                } else {
                  resolve(2);
                }
              } else {
                if (setting.rate == 0 && playingTime == duration) {
                  resolve(2);
                } else {
                  resolve(1);
                }
              }
            } catch (e) {
              logger("å‘ç”Ÿé”™è¯¯ï¼š" + e, "red");
              resolve(0);
            }
          },
          error: function (xhr) {
            if (xhr.status == 403) {
              logger("SuperStarè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå°è¯•æ›´æ¢å‚æ•°ï¼Œ40såå°†é‡è¯•ï¼Œè¯·ç­‰å¾…...", "red");
              resolve(3);
            } else {
              reportUrlChange = 1;
              logger("SuperStarè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæŒç»­å‡ºç°ï¼Œè¯·è”ç³»ä½œè€…", "red");
            }
          }
        });
      });
    });
  }
  function upLoadWork(index, doms, dom) {
    let $CyHtml = $(dom).contents().find(".CeYan");
    let TiMuList = $CyHtml.find(".TiMu");
    let data = [];
    for (let i = 0; i < TiMuList.length; i++) {
      let _a = {};
      let questionFull = $(TiMuList[i]).find(".Zy_TItle.clearfix > div.clearfix").html().trim();
      let _question = tidyQuestion(questionFull);
      let _TimuType = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4 }[questionFull.match(/^<span.*?newZy_TItle.*?ã€(.*?)ã€‘<\/span>|$/)[1]];
      _a["question"] = _question;
      _a["type"] = _TimuType;
      let _selfAnswerCheck = $(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .answerScore .CorrectOrNot span").attr("class");
      switch (_TimuType) {
        case 0:
          if (_selfAnswerCheck == "marking_dui") {
            let _selfAnswer = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[$(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer").text().trim().replace(/æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "").replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim()];
            let _answerForm2 = $(TiMuList[i]).find(".Zy_ulTop li");
            let _answer2 = $(_answerForm2[_selfAnswer]).find("a.fl").html();
            _a["answer"] = tidyStr(_answer2);
          }
          break;
        case 1:
          let _answerArr = $(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer").text().trim().replace(/æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "").replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
          let _answerForm = $(TiMuList[i]).find(".Zy_ulTop li");
          let _answer = [];
          if (_selfAnswerCheck == "marking_dui" || _selfAnswerCheck == "marking_bandui") {
            for (let i2 = 0; i2 < _answerArr.length; i2++) {
              let _answerIndex = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[_answerArr[i2]];
              _answer.push($(_answerForm[_answerIndex]).find("a.fl").html());
            }
          } else {
            break;
          }
          _a["answer"] = tidyStr(_answer.join("#"));
          break;
        case 2:
          let _TAnswerArr = $(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer");
          let _TAnswer = [];
          for (let i2 = 0; i2 < _TAnswerArr.length; i2++) {
            let item = _TAnswerArr[i2];
            if ($(item).find("i").attr("class") == "marking_dui") {
              _TAnswer.push($(item).find("p").html().replace(/[(][0-9].*?[)]/, "").replace(/ç¬¬.*?ç©º:/, "").trim());
            }
          }
          if (_TAnswer.length <= 0) {
            break;
          }
          _a["answer"] = tidyStr(_TAnswer.join("#"));
          break;
        case 3:
          if (_selfAnswerCheck == "marking_dui") {
            let _answer2 = $(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer").html().replace(/æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "").replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
            _a["answer"] = tidyStr(_answer2);
          } else {
            if ($(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer").html()) {
              let _answer2 = $(TiMuList[i]).find(".newAnswerBx > .myAnswerBx > .myAnswer").html().replace(/æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "").replace(/æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "").trim();
              if ("å¯¹|âˆš|æ­£ç¡®".indexOf(tidyStr(_answer2)) != -1) {
                _a["answer"] = "é”™";
              } else {
                _a["answer"] = "å¯¹";
              }
            } else {
              break;
            }
          }
          break;
      }
      if (_a["answer"] != void 0) {
        data.push(_a);
      } else {
        continue;
      }
    }
    uploadAnswer(data, 0).then(() => {
      _mlist.splice(0, 1);
      _domList.splice(0, 1);
      setTimeout(() => {
        startDoCyWork(index + 1, doms);
      }, 3e3);
    });
  }
  function filterAnswerIndex(answertext) {
    let result = answertext.match(/[æˆ‘çš„|æ­£ç¡®]ç­”æ¡ˆ[:ï¼š]\s{1}([A-Z]+?):/);
    return result ? result[1] : null;
  }
  function uploadHomeWork() {
    logger("å¼€å§‹æ”¶å½•ç­”æ¡ˆ", "green");
    let $_homeworktable = $(".mark_table");
    let TiMuList = $_homeworktable.find(".mark_item").find(".questionLi");
    let data = [];
    $.each(TiMuList, (i, t) => {
      let _a = {};
      let _answer;
      let _answerTmpArr, _answerList = [];
      let TiMuFull = tidyQuestion($(t).find("h3.mark_name").html());
      let TiMuType = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4 }[TiMuFull.match(/[(](.*?)[)]|$/)[1].replace(/, .*?åˆ†/, "")];
      let TiMu = TiMuFull.replace(/^[(].*?[)]|$/, "").trim();
      let rightAns_path = $(t).find(".mark_answer").find(".colorGreen")[0];
      switch (TiMuType) {
        case 0:
          let d_rightAns;
          if (rightAns_path) {
            d_rightAns = filterAnswerIndex($(t).find(".mark_answer").find(".colorGreen").text());
          } else {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isZero != "0") {
              d_rightAns = filterAnswerIndex($(t).find(".mark_answer").find(".colorDeep").text());
            } else {
              return;
            }
          }
          _answerTmpArr = $(t).find(".mark_letter li");
          $.each(_answerTmpArr, (a, b) => {
            _answerList.push(tidyStr($(b).html()).replace(/[A-Z].\s*/, ""));
          });
          let _i = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[d_rightAns];
          _answer = _answerList[_i];
          _a["question"] = TiMu;
          _a["type"] = TiMuType;
          _a["answer"] = _answer;
          data.push(_a);
          break;
        case 1:
          _answer = [];
          let m_rightAns;
          if (rightAns_path) {
            m_rightAns = filterAnswerIndex($(t).find(".mark_answer").find(".colorGreen").text());
          } else {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isTrue2 == "marking_bandui" || _isZero != "0") {
              m_rightAns = filterAnswerIndex($(t).find(".mark_answer").find(".colorDeep").text());
            } else {
              break;
            }
          }
          _answerTmpArr = $(t).find(".mark_letter li");
          $.each(_answerTmpArr, (a, b) => {
            _answerList.push(tidyStr($(b).html()).replace(/[A-Z].\s*/, ""));
          });
          $.each(m_rightAns.split(""), (c, d) => {
            let _i2 = { A: 0, B: 1, C: 2, D: 3, E: 4, F: 5, G: 6 }[d];
            _answer.push(_answerList[_i2]);
          });
          _a["question"] = TiMu;
          _a["type"] = TiMuType;
          _a["answer"] = _answer.join("#");
          data.push(_a);
          break;
        case 2:
          _answerTmpArr = [];
          let t_rightAns;
          let answers = $(t).find(".mark_answer").find(".colorDeep").find("dd");
          if (rightAns_path) {
            t_rightAns = $(rightAns_path).text().replace(/\s/g, "").replace(/[(][0-9].*?[)]/g, "#").replace(/ç¬¬.*?ç©º:/g, "#").replace(/^æ­£ç¡®ç­”æ¡ˆ[:ï¼š]#*/, "");
            _answer = t_rightAns;
          } else {
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isZero && _isZero != 0) {
              $.each(answers, (i2, t2) => {
                t_rightAns = $(t2).find("span:eq(0)").text();
                _answerTmpArr.push(t_rightAns.replace(/[(][0-9].*?[)]/, "").replace(/ç¬¬.*?ç©º:/, "").trim());
              });
            } else {
              $.each(answers, (i2, t2) => {
                let _isTrue2 = $(t2).find("span:eq(1)").attr("class");
                if (_isTrue2 == "marking_dui") {
                  t_rightAns = $(t2).find("span:eq(0)").text();
                  _answerTmpArr.push(t_rightAns.replace(/[(][0-9].*?[)]/, "").replace(/ç¬¬.*?ç©º:/, "").trim());
                } else {
                  return;
                }
              });
            }
            _answer = _answerTmpArr.join("#");
          }
          if (_answer.length != 0) {
            _a["question"] = TiMu;
            _a["type"] = TiMuType;
            _a["answer"] = _answer;
            data.push(_a);
          }
          break;
        case 3:
          let p_rightAns;
          if (rightAns_path) {
            p_rightAns = $(rightAns_path).text().replace(/\s/g, "").replace(/^æ­£ç¡®ç­”æ¡ˆ[:ï¼š]/, "");
          } else {
            let _isTrue2 = $(t).find(".mark_answer").find(".mark_score span").attr("class");
            let _isZero = $(t).find(".mark_answer").find(".mark_score .totalScore.fr i").text();
            if (_isTrue2 == "marking_dui" || _isZero != "0") {
              p_rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/\s/g, "").replace(/^æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "");
            } else {
              let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
              p_rightAns = $(t).find(".mark_answer").find(".colorDeep").text().replace(/\s/g, "").replace(/^æˆ‘çš„ç­”æ¡ˆ[:ï¼š]/, "");
              if (_true.indexOf(p_rightAns) != -1) {
                p_rightAns = "é”™";
              } else {
                p_rightAns = "å¯¹";
              }
            }
          }
          _a["question"] = TiMu;
          _a["type"] = TiMuType;
          _a["answer"] = p_rightAns;
          data.push(_a);
          break;
        case 4:
          let j_rightAns;
          if (rightAns_path) {
            j_rightAns = $(rightAns_path).text().replace(/\s/g, "");
          } else {
            break;
          }
          _a["question"] = TiMu;
          _a["type"] = TiMuType;
          _a["answer"] = j_rightAns;
          data.push(_a);
          break;
      }
    });
    setTimeout(() => {
      uploadAnswer(data, 0);
    }, 1500);
  }
  function getEnc(a, b, c, d, e, f, g) {
    return new Promise((resolve, reject) => {
      let strEnc = `[${a}][${b}][${c}][${d}][${e * 1e3}][d_yHJ!$pdA~5][${f * 1e3}][${g}]`;
      resolve(md5(strEnc));
    });
  }
  function getAnswer(_t, _q, _o) {
    _t = _t+"";
    _q = _q+"";
    _o = _o+"";
    if (setting.tikuAdapter.use) {
      return new Promise((resolve, reject) => {
        tikuAdapter(_t, _q, _o).then((data) => {
          if (data.length == 0) {
            reject(data);
          } else {
            resolve(data);
          }
        });
      });
    } else if (_GM_getValue("lemtkpro")) {
      logger("ğŸˆè¯·æ³¨æ„ï¼šæ‚¨æ­£åœ¨ä½¿ç”¨é«˜çº§æœç´¢åŠŸèƒ½ã€‚", "#CC33FF");
      return new Promise((resolve, reject) => {
        advancedSearch(_t, _q, _o).then((data) => {
          data = data.replace("===", "#");
          resolve(data);
        }).catch((data) => {
          reject(data);
        });
      });
    } else {
      let tkurl = atob(_host) + "/api/v1/cx";
      return new Promise((resolve, reject) => {
        let _u = getCk("_uid") || getCk("UID");
        _GM_xmlhttpRequest({
          method: "POST",
          url: tkurl,
          headers: {
            "Content-type": "application/json",
            "Authorization": "Bearer " + setting.token
          },
          data: JSON.stringify({
            "v": _GM_info["script"]["version"],
            "question": _q,
            "type": _t,
            "options": _o,
            "uid": _u,
          }),
          timeout: setting.time,
          onload: function (xhr) {
            if (xhr.status == 200) {
              let obj = JSON.parse(xhr.responseText) || {};
              if (obj.code == 1e3) {
                let _answer = /^http/.test(obj.data.answer) ? '<img src="' + obj.data.answer + '">' : obj.data.answer;
                logger("é¢˜ç›®:" + _q + "<br />---->ç­”æ¡ˆ:" + _answer, "purple");
                _answer = _answer.replace("===", "#");
                resolve(_answer);
              } else if (obj.code == 1003) {
                normalSearch(_t, _q, _o).then((data) => {
                  resolve(data);
                }).catch((data) => {
                  reject(data);
                });
              } else {
                logger(obj.msg, "red");
                setting.sub = 0;
                reject({ "c": 0 });
              }
            } else {
              normalSearch(_t, _q, _o).then((data) => {
                resolve(data);
              }).catch((data) => {
                reject(data);
              });
            }
          },
          ontimeout: function () {
            normalSearch(_t, _q, _o).then((data) => {
              resolve(data);
            }).catch((data) => {
              reject(data);
            });
          }
        });
      });
    }
  }
  function advancedSearch(_t, _q, _o) {
    let tkurl = atob(_host) + "/api/v1/mcx";
    return new Promise((resolve, reject) => {
      let _u = getCk("_uid") || getCk("UID");
      _GM_xmlhttpRequest({
        method: "POST",
        url: tkurl,
        headers: {
          "Content-type": "application/json",
          "Authorization": "Bearer " + setting.token
        },
        data: JSON.stringify({
          "v": _GM_info["script"]["version"],
          "question": _q,
          "type": _t,
          "options": _o,
          "uid": _u
        }),
        timeout: setting.time,
        onload: function (xhr) {
          if (xhr.status == 200) {
            let obj = JSON.parse(xhr.responseText) || {};
            if (obj.code == 1e3) {
              let _answer = /^http/.test(obj.data.answer) ? '<img src="' + obj.data.answer + '">' : obj.data.answer;
              logger("é¢˜ç›®:" + _q + "<br />---->ç­”æ¡ˆ:" + _answer, "purple");
              resolve(_answer);
            } else if (obj.code == 5e3 || obj.code == 5001) {
              logger(obj.msg, "red");
              setting.sub = 0;
              reject({ "c": 0 });
            } else if (obj.code == 1003) {
              logger("é¢˜ç›®:" + _q + "<br />---->æš‚æ— ç­”æ¡ˆ", "red");
              setting.sub = 0;
              reject({ "c": 0 });
            } else {
              logger(obj.msg, "red");
              setting.sub = 0;
              reject({ "c": 0 });
            }
          } else if (xhr.status == 403) {
            logger("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•", "red");
            reject({ "c": 403 });
          } else if (xhr.status == 500) {
            logger("é¢˜åº“ç¨‹åºå¼‚å¸¸,è¯·è¿‡ä¸€ä¼šå†è¯•", "red");
            reject({ "c": 500 });
          } else if (xhr.status == 444) {
            logger("IPå¼‚å¸¸ï¼Œå·²è¢«æ‹‰å…¥æœåŠ¡å™¨é»‘åå•ï¼Œè¯·è¿‡å‡ ä¸ªå°æ—¶å†è¯•", "red");
            reject({ "c": 444 });
          } else if (xhr.status == 400) {
            let obj = JSON.parse(xhr.responseText) || {};
            logger(obj.msg, "red");
            reject({ "c": 400 });
          } else {
            logger("é¢˜åº“å¼‚å¸¸,å¯èƒ½è¢«æ¶æ„æ”»å‡»äº†...è¯·ç­‰å¾…æ¢å¤", "red");
            reject({ "c": 555 });
          }
        },
        ontimeout: function () {
          logger("é¢˜åº“å¼‚å¸¸,å¯èƒ½è¢«æ¶æ„æ”»å‡»äº†...è¯·ç­‰å¾…æ¢å¤", "red");
          reject({ "c": 666 });
        }
      });
    });
  }
  function normalSearch(_t, _q, _o) {
    let _fHost = "aHR0cHM6Ly9jeC5pY29kZWYuY29t";
    return new Promise((resolve, reject) => {
      getCk("_uid") || getCk("UID");
      _GM_xmlhttpRequest({
        method: "POST",
        url: atob(_fHost) + "/wyn-nb?v=4",
        headers: {
          "Content-type": "application/x-www-form-urlencoded"
        },
        data: "question=" + encodeURIComponent(_q),
        timeout: setting.time,
        onload: function (xhr) {
          if (xhr.status == 200) {
            let obj2 = JSON.parse(xhr.responseText) || {};
            if (obj2.code == 1 && obj2.data) {
              let _answer = /^http/.test(obj2.data) ? '<img src="' + obj2.data + '">' : obj2.data;
              logger("é¢˜ç›®:" + _q + "<br />---->ç­”æ¡ˆ:" + _answer, "purple");
              uploadAnswer([{ "question": _q, "type": _t, "answer": obj2.data }], 1);
              _answer = _answer.replace("===", "#");
              resolve(_answer);
            } else {
              logger("é¢˜ç›®:" + _q + "<br />---->æš‚æ— ç­”æ¡ˆ,è¯•è¯•é«˜çº§æœç´¢å§", "red");
              setting.sub = 0;
              reject({ "c": 0 });
            }
          } else if (xhr.status == 403) {
            logger("è¯·æ±‚è¿‡äºé¢‘ç¹,è¯·ç¨åå†è¯•,æˆ–è€…è¯•è¯•é«˜çº§æœç´¢å§", "red");
            reject({ "c": 403 });
          } else if (xhr.status == 500) {
            logger("é¢˜åº“ç¨‹åºå¼‚å¸¸,è¯·è¿‡ä¸€ä¼šå†è¯•,æˆ–è€…è¯•è¯•é«˜çº§æœç´¢å§", "red");
            reject({ "c": 500 });
          } else if (xhr.status == 444) {
            logger("IPå¼‚å¸¸ï¼Œå·²è¢«æ‹‰å…¥æœåŠ¡å™¨é»‘åå•ï¼Œè¯·è¿‡å‡ ä¸ªå°æ—¶å†è¯•,æˆ–è€…è¯•è¯•é«˜çº§æœç´¢å§", "red");
            reject({ "c": 444 });
          } else if (xhr.status == 400) {
            var obj = $.parseJSON(xhr.responseText) || {};
            logger(obj.msg, "red");
            reject({ "c": 400 });
          } else {
            logger("é¢˜åº“å¼‚å¸¸,å¯èƒ½è¢«æ¶æ„æ”»å‡»äº†...è¯·ç­‰å¾…æ¢å¤,æˆ–è€…è¯•è¯•é«˜çº§æœç´¢å§", "red");
            reject({ "c": 555 });
          }
        },
        ontimeout: function () {
          logger("é¢˜åº“å¼‚å¸¸,å¯èƒ½è¢«æ¶æ„æ”»å‡»äº†...è¯·ç­‰å¾…æ¢å¤,æˆ–è€…è¯•è¯•é«˜çº§æœç´¢å§", "red");
          reject({ "c": 666 });
        }
      });
    });
  }
  function doWork(index, doms, dom) {
    $frame_c = $(dom).contents();
    let $CyHtml = $frame_c.find(".CeYan");
    let TiMuList = $CyHtml.find(".TiMu");
    $subBtn = $frame_c.find(".ZY_sub").find(".btnSubmit");
    $saveBtn = $frame_c.find(".ZY_sub").find(".btnSave");
    startDoWork(index, doms, 0, TiMuList);
  }
  function startDoWork(index, doms, c, TiMuList) {
    if (c == TiMuList.length) {
      if (setting.sub) {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå‡†å¤‡è‡ªåŠ¨æäº¤ã€‚", "green");
        setTimeout(() => {
          $subBtn.click();
          setTimeout(() => {
            let $recof = $frame_c.find(".maskDiv .popDiv .popBottom a#popok");
            $recof[0].click();
            logger("æäº¤æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
            _mlist.splice(0, 1);
            _domList.splice(0, 1);
            setTimeout(() => {
              startDoCyWork(index + 1, doms);
            }, 3e3);
          }, 5e3);
        }, 3e3);
      } else if (setting.force) {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå­˜åœ¨æ— ç­”æ¡ˆé¢˜ç›®,ç”±äºç”¨æˆ·è®¾ç½®äº†å¼ºåˆ¶æäº¤ï¼Œå‡†å¤‡è‡ªåŠ¨æäº¤ã€‚", "red");
        setTimeout(() => {
          $subBtn.click();
          setTimeout(() => {
            let $recof = $frame_c.find(".maskDiv .popDiv .popBottom a#popok");
            $recof[0].click();
            logger("æäº¤æˆåŠŸï¼Œå‡†å¤‡åˆ‡æ¢ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚", "green");
            _mlist.splice(0, 1);
            _domList.splice(0, 1);
            setTimeout(() => {
              startDoCyWork(index + 1, doms);
            }, 3e3);
          }, 3e3);
        }, 5e3);
      } else {
        logger("æµ‹éªŒå¤„ç†å®Œæˆï¼Œå­˜åœ¨æ— ç­”æ¡ˆé¢˜ç›®æˆ–è€…ç”¨æˆ·è®¾ç½®ä¸æäº¤ã€‚", "red");
      }
      return;
    }
    let questionFull = $(TiMuList[c]).find(".Zy_TItle.clearfix > div").html();
    questionFull = tidyQuestion(questionFull).replace("/<span.*?>.*?</span>/", "");
    let _question = tidyQuestion(questionFull);
    let _TimuType = { å•é€‰é¢˜: 0, å¤šé€‰é¢˜: 1, å¡«ç©ºé¢˜: 2, åˆ¤æ–­é¢˜: 3, ç®€ç­”é¢˜: 4 }[questionFull.match(/^ã€(.*?)ã€‘|$/)[1]];
    let _a = [];
    let _answerTmpArr, _options;
    switch (_TimuType) {
      case 0:
        // single
        _answerTmpArr = $(TiMuList[c]).find(".Zy_ulTop li").find("a");
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()));
        });
        _options = _a.join("#");
        getAnswer(_TimuType, _question, _options).then((agrs) => {
          let _i = _a.findIndex((item) => item == agrs);
          if (_i == -1) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡", "red");
            setting.sub = 0;
          } else {
            $(_answerTmpArr[_i]).parent().click();
          }
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        });
        break;
      case 1:
        // multiple
        _answerTmpArr = $(TiMuList[c]).find(".Zy_ulTop li").find("a");
        _answerTmpArr.each(function () {
          let answerText = tidyStr($(this).text()).replace(/[ABCD]/g, '').trim();
          _a.push(answerText);
        });
        _options = _a.join("|");
        _a = [];
        getAnswer(_TimuType, _question, _options).then((agrs) => {
          $.each(_answerTmpArr, (i, t) => {
            if (agrs.indexOf(tidyStr($(t).html())) != -1) {
              $(_answerTmpArr[i]).parent().click();
              _a.push(["A", "B", "C", "D", "E", "F", "G"][i]);
            }
          });
          if (_a.length <= 0) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡", "red");
            setting.sub = 0;
          }
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        });
        break;
      case 2:
        // fill
        _options = "";
        let _textareaList = $(TiMuList[c]).find(".Zy_ulTk .XztiHover1");
        getAnswer(_TimuType, _question, _options).then((agrs) => {
          let _answerList = agrs.split("#");
          $.each(_textareaList, (i, t) => {
            setTimeout(() => {
              $(t).find("#ueditor_" + i).contents().find(".view p").html(_answerList[i]);
              $(t).find("textarea").html("<p>" + _answerList[i] + "</p>");
            }, 300);
          });
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        });
        break;
      case 3:
        // judge
        _options = "å¯¹|é”™";
        _answerTmpArr = $(TiMuList[c]).find(".Zy_ulTop li").find("a");
        let _true = "æ­£ç¡®|æ˜¯|å¯¹|âˆš|T|ri";
        $.each(_answerTmpArr, (i, t) => {
          _a.push(tidyStr($(t).html()));
        });
        getAnswer(_TimuType, _question, _options).then((agrs) => {
          agrs = _true.indexOf(agrs) != -1 ? "å¯¹" : "é”™";
          let _i = _a.findIndex((item) => item == agrs);
          if (_i == -1) {
            logger("æœªåŒ¹é…åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè·³è¿‡", "red");
            setting.sub = 0;
          } else {
            $(_answerTmpArr[_i]).parent().click();
          }
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        });
        break;
      case 4:
        // short
        _options = "";
        let _textareaLista = $(TiMuList[c]).find(".Zy_ulTk .XztiHover1");
        getAnswer(_TimuType, _question, _options).then((agrs) => {
          if (agrs == "æš‚æ— ç­”æ¡ˆ") {
            setting.sub = 0;
          }
          let _answerList = agrs.split("#");
          $.each(_textareaLista, (i, t) => {
            setTimeout(() => {
              $(t).find("#ueditor_" + i).contents().find(".view p").html(_answerList[i]);
              $(t).find("textarea").html("<p>" + _answerList[i] + "</p>");
            }, 300);
          });
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        }).catch((agrs) => {
          setTimeout(() => {
            startDoWork(index, doms, c + 1, TiMuList);
          }, setting.time);
        });
        break;
      default:
        logger("æœªçŸ¥é¢˜å‹ï¼Œè·³è¿‡", "red");
        setTimeout(() => {
          startDoWork(index, doms, c + 1, TiMuList);
        }, setting.time);
    }
  }
  function uploadAnswer(a, t) {
    a.forEach((item) => {
      item.type = item.type + "";
    });
    return new Promise((resolve, reject) => {
      _GM_xmlhttpRequest({
        url: atob(_host) + "/api/v1/upload",
        data: JSON.stringify({
          "v": _GM_info["script"]["version"],
          "data": a,
          "uid": "13f2f52f434d44d6e595088b8f5a4baf"
        }),
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        onload: function (xhr) {
          try {
            if (t == 1) {
              resolve();
            } else {
              let res = JSON.parse(xhr.responseText);
              if (res["code"] == 1e3) {
                logger("Upload Success.", "green");
              } else {
                logger("Upload Error. Next Part.", "red");
              }
              resolve();
            }
          } catch {
            let res = xhr.responseText;
            if (res.indexOf("é˜²ç«å¢™") != -1) {
              logger("Upload Error. Please contact the author.", "red");
            } else {
              logger("Upload Unknow Error. Please contact the author.", "red");
            }
            resolve();
          }
        }
      });
    });
  }
  function switchMission() {
    _mlist.splice(0, 1);
    _domList.splice(0, 1);
    setTimeout(missonStart, 5e3);
  }
  function tidyStr(s) {
    if (s) {
      let str = s.replace(/<(?!img).*?>/g, "").replace(/^ã€.*?ã€‘\s*/, "").replace(/\s*ï¼ˆ\d+\.\d+åˆ†ï¼‰$/, "").trim().replace(/&nbsp;/g, "").replace("javascript:void(0);", "").replace(new RegExp("&nbsp;", "gm"), "").replace(/^\s+/, "").replace(/\s+$/, "");
      return str;
    } else {
      return null;
    }
  }
  function tidyQuestion(s) {
    if (s) {
      let str = s.replace(/<(?!img).*?>/g, "").replace(/^ã€.*?ã€‘\s*/, "").replace(/\s*ï¼ˆ\d+\.\d+åˆ†ï¼‰$/, "").replace(/^\d+[\.ã€]/, "").trim().replace(/&nbsp;/g, "").replace("javascript:void(0);", "").replace(new RegExp("&nbsp;", "gm"), "").replace(/^\s+/, "").replace(/\s+$/, "");
      return str;
    } else {
      return null;
    }
  }
  function decryptFont() {
    var $tip = $("style:contains(font-cxsecret)");
    if (!$tip.length)
      return;
    var font = $tip.text().match(/base64,([\w\W]+?)'/)[1];
    font = Typr.parse(base64ToUint8Array(font))[0];
    var table = JSON.parse(GM_getResourceText("Table"));
    var match = {};
    for (var i = 19968; i < 40870; i++) {
      $tip = Typr.U.codeToGlyph(font, i);
      if (!$tip)
        continue;
      $tip = Typr.U.glyphToPath(font, $tip);
      $tip = md5(JSON.stringify($tip)).slice(24);
      match[i] = table[$tip];
    }
    $(".font-cxsecret").html(function (index, html) {
      $.each(match, function (key, value) {
        key = String.fromCharCode(key);
        key = new RegExp(key, "g");
        value = String.fromCharCode(value);
        html = html.replace(key, value);
      });
      return html;
    }).removeClass("font-cxsecret");
  }
  function base64ToUint8Array(base64) {
    var data = window.atob(base64);
    var buffer = new Uint8Array(data.length);
    for (var i = 0; i < data.length; ++i) {
      buffer[i] = data.charCodeAt(i);
    }
    return buffer;
  }
  console.log("%cåˆ«å‡è£…åŠªåŠ›ï¼Œç»“å±€ä¸ä¼šé™ªä½ æ¼”æˆï¼", "color: #E4B8D5");
  