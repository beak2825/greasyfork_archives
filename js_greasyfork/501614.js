// ==UserScript==
// @name         JLPT Dashboard for WaniKani
// @namespace    jlpt-dashboard-wanikani
// @version      1.0.2
// @description  Adds a JLPT dashboard to the WaniKani userpage for kanji progression tracking and forecasting
// @author       afdoner
// @match        https://www.wanikani.com/users/*
// @license      MIT
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/501614/JLPT%20Dashboard%20for%20WaniKani.user.js
// @updateURL https://update.greasyfork.org/scripts/501614/JLPT%20Dashboard%20for%20WaniKani.meta.js
// ==/UserScript==
/* globals jQuery, $, waitForKeyElements */

// This script is built upon the great work from Robin Findley (https://greasyfork.org/en/users/5859-robin-findley), author of WaniKani Open Framework
// Maps generated from https://www.wkstats.com/charts/jlpt, https://www.wkstats.com/charts/joyo, https://www.wkstats.com/charts/frequency, https://www.wkstats.com/charts/reading. Props to them!
const jlptMap = [{"Level":"1","N5":"18.99%","N4":"1.81%","N3":"0.00%","N2":"0.00%","N1":"0.00%"},{"Level":"2","N5":"44.30%","N4":"6.63%","N3":"0.54%","N2":"0.82%","N1":"0.16%"},{"Level":"3","N5":"56.96%","N4":"13.86%","N3":"1.63%","N2":"1.36%","N1":"0.24%"},{"Level":"4","N5":"68.35%","N4":"21.69%","N3":"3.81%","N2":"3.81%","N1":"0.24%"},{"Level":"5","N5":"78.48%","N4":"33.13%","N3":"5.99%","N2":"5.45%","N1":"0.32%"},{"Level":"6","N5":"87.34%","N4":"43.98%","N3":"9.26%","N2":"6.27%","N1":"0.41%"},{"Level":"7","N5":"91.14%","N4":"51.81%","N3":"12.53%","N2":"7.36%","N1":"0.49%"},{"Level":"8","N5":"94.94%","N4":"58.43%","N3":"16.35%","N2":"8.17%","N1":"0.49%"},{"Level":"9","N5":"94.94%","N4":"67.47%","N3":"21.53%","N2":"8.45%","N1":"0.65%"},{"Level":"10","N5":"98.73%","N4":"77.11%","N3":"25.34%","N2":"9.81%","N1":"0.65%"},{"Level":"11","N5":"98.73%","N4":"80.72%","N3":"31.34%","N2":"11.99%","N1":"0.81%"},{"Level":"12","N5":"98.73%","N4":"86.14%","N3":"35.42%","N2":"15.26%","N1":"1.06%"},{"Level":"13","N5":"98.73%","N4":"90.36%","N3":"38.96%","N2":"17.44%","N1":"1.70%"},{"Level":"14","N5":"98.73%","N4":"90.36%","N3":"42.23%","N2":"20.16%","N1":"2.11%"},{"Level":"15","N5":"98.73%","N4":"95.18%","N3":"46.05%","N2":"23.43%","N1":"2.35%"},{"Level":"16","N5":"100.00%","N4":"97.59%","N3":"50.68%","N2":"24.80%","N1":"2.76%"},{"Level":"17","N5":"100.00%","N4":"98.19%","N3":"55.59%","N2":"27.52%","N1":"3.33%"},{"Level":"18","N5":"100.00%","N4":"98.80%","N3":"58.86%","N2":"29.70%","N1":"3.73%"},{"Level":"19","N5":"100.00%","N4":"98.80%","N3":"61.58%","N2":"33.79%","N1":"4.38%"},{"Level":"20","N5":"100.00%","N4":"98.80%","N3":"66.21%","N2":"35.69%","N1":"5.03%"},{"Level":"21","N5":"100.00%","N4":"98.80%","N3":"70.03%","N2":"37.33%","N1":"5.93%"},{"Level":"22","N5":"100.00%","N4":"98.80%","N3":"72.48%","N2":"38.96%","N1":"7.14%"},{"Level":"23","N5":"100.00%","N4":"98.80%","N3":"75.48%","N2":"41.14%","N1":"8.12%"},{"Level":"24","N5":"100.00%","N4":"99.40%","N3":"76.29%","N2":"46.59%","N1":"8.69%"},{"Level":"25","N5":"100.00%","N4":"99.40%","N3":"79.56%","N2":"48.77%","N1":"9.74%"},{"Level":"26","N5":"100.00%","N4":"99.40%","N3":"79.84%","N2":"52.59%","N1":"11.20%"},{"Level":"27","N5":"100.00%","N4":"100.00%","N3":"83.11%","N2":"53.95%","N1":"12.34%"},{"Level":"28","N5":"100.00%","N4":"100.00%","N3":"84.74%","N2":"56.95%","N1":"13.80%"},{"Level":"29","N5":"100.00%","N4":"100.00%","N3":"86.38%","N2":"58.86%","N1":"15.42%"},{"Level":"30","N5":"100.00%","N4":"100.00%","N3":"89.10%","N2":"60.76%","N1":"16.40%"},{"Level":"31","N5":"100.00%","N4":"100.00%","N3":"90.74%","N2":"64.03%","N1":"17.86%"},{"Level":"32","N5":"100.00%","N4":"100.00%","N3":"92.37%","N2":"67.03%","N1":"19.24%"},{"Level":"33","N5":"100.00%","N4":"100.00%","N3":"93.46%","N2":"70.30%","N1":"20.45%"},{"Level":"34","N5":"100.00%","N4":"100.00%","N3":"94.55%","N2":"72.21%","N1":"22.08%"},{"Level":"35","N5":"100.00%","N4":"100.00%","N3":"95.91%","N2":"74.11%","N1":"23.30%"},{"Level":"36","N5":"100.00%","N4":"100.00%","N3":"96.46%","N2":"77.38%","N1":"24.76%"},{"Level":"37","N5":"100.00%","N4":"100.00%","N3":"97.00%","N2":"79.56%","N1":"26.54%"},{"Level":"38","N5":"100.00%","N4":"100.00%","N3":"97.55%","N2":"80.93%","N1":"28.49%"},{"Level":"39","N5":"100.00%","N4":"100.00%","N3":"97.82%","N2":"82.02%","N1":"30.68%"},{"Level":"40","N5":"100.00%","N4":"100.00%","N3":"98.09%","N2":"83.38%","N1":"32.79%"},{"Level":"41","N5":"100.00%","N4":"100.00%","N3":"98.09%","N2":"84.74%","N1":"34.33%"},{"Level":"42","N5":"100.00%","N4":"100.00%","N3":"98.37%","N2":"86.38%","N1":"36.44%"},{"Level":"43","N5":"100.00%","N4":"100.00%","N3":"98.37%","N2":"88.28%","N1":"38.47%"},{"Level":"44","N5":"100.00%","N4":"100.00%","N3":"98.64%","N2":"89.92%","N1":"40.10%"},{"Level":"45","N5":"100.00%","N4":"100.00%","N3":"98.91%","N2":"91.55%","N1":"42.21%"},{"Level":"46","N5":"100.00%","N4":"100.00%","N3":"99.18%","N2":"92.64%","N1":"44.48%"},{"Level":"47","N5":"100.00%","N4":"100.00%","N3":"99.18%","N2":"93.73%","N1":"46.67%"},{"Level":"48","N5":"100.00%","N4":"100.00%","N3":"99.18%","N2":"95.64%","N1":"48.78%"},{"Level":"49","N5":"100.00%","N4":"100.00%","N3":"99.18%","N2":"95.64%","N1":"51.46%"},{"Level":"50","N5":"100.00%","N4":"100.00%","N3":"99.46%","N2":"95.64%","N1":"53.73%"},{"Level":"51","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"55.19%"},{"Level":"52","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"57.95%"},{"Level":"53","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"60.55%"},{"Level":"54","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"63.15%"},{"Level":"55","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"65.75%"},{"Level":"56","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"68.43%"},{"Level":"57","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"71.02%"},{"Level":"58","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"73.70%"},{"Level":"59","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"76.54%"},{"Level":"60","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"79.06%"}];
const jlptCumMap = [{"Level":"1","N5":"18.99%","N4":"7.35%","N3":"2.94%","N2":"1.84%","N1":"0.81%"},{"Level":"2","N5":"44.30%","N4":"18.78%","N3":"7.84%","N2":"5.21%","N1":"2.40%"},{"Level":"3","N5":"56.96%","N4":"27.76%","N3":"12.09%","N2":"8.07%","N1":"3.71%"},{"Level":"4","N5":"68.35%","N4":"36.73%","N3":"16.99%","N2":"12.05%","N1":"5.47%"},{"Level":"5","N5":"78.48%","N4":"47.76%","N3":"22.71%","N2":"16.24%","N1":"7.37%"},{"Level":"6","N5":"87.34%","N4":"57.96%","N3":"28.76%","N2":"20.33%","N1":"9.23%"},{"Level":"7","N5":"91.14%","N4":"64.49%","N3":"33.33%","N2":"23.60%","N1":"10.72%"},{"Level":"8","N5":"94.94%","N4":"70.20%","N3":"37.91%","N2":"26.76%","N1":"12.12%"},{"Level":"9","N5":"94.94%","N4":"76.33%","N3":"43.46%","N2":"30.34%","N1":"13.79%"},{"Level":"10","N5":"98.73%","N4":"84.08%","N3":"48.86%","N2":"34.22%","N1":"15.51%"},{"Level":"11","N5":"98.73%","N4":"86.53%","N3":"53.43%","N2":"37.90%","N1":"17.23%"},{"Level":"12","N5":"98.73%","N4":"90.20%","N3":"57.35%","N2":"41.57%","N1":"19.00%"},{"Level":"13","N5":"98.73%","N4":"93.06%","N3":"60.62%","N2":"44.43%","N1":"20.62%"},{"Level":"14","N5":"98.73%","N4":"93.06%","N3":"62.58%","N2":"46.68%","N1":"21.85%"},{"Level":"15","N5":"98.73%","N4":"96.33%","N3":"66.18%","N2":"50.15%","N1":"23.52%"},{"Level":"16","N5":"100.00%","N4":"98.37%","N3":"69.77%","N2":"52.91%","N1":"24.97%"},{"Level":"17","N5":"100.00%","N4":"98.78%","N3":"72.88%","N2":"55.87%","N1":"26.59%"},{"Level":"18","N5":"100.00%","N4":"99.18%","N3":"75.00%","N2":"58.02%","N1":"27.77%"},{"Level":"19","N5":"100.00%","N4":"99.18%","N3":"76.63%","N2":"60.57%","N1":"29.26%"},{"Level":"20","N5":"100.00%","N4":"99.18%","N3":"79.41%","N2":"63.02%","N1":"30.71%"},{"Level":"21","N5":"100.00%","N4":"99.18%","N3":"81.70%","N2":"65.07%","N1":"32.11%"},{"Level":"22","N5":"100.00%","N4":"99.18%","N3":"83.17%","N2":"66.60%","N1":"33.47%"},{"Level":"23","N5":"100.00%","N4":"99.18%","N3":"84.97%","N2":"68.54%","N1":"34.87%"},{"Level":"24","N5":"100.00%","N4":"99.59%","N3":"85.62%","N2":"70.99%","N1":"36.27%"},{"Level":"25","N5":"100.00%","N4":"99.59%","N3":"87.58%","N2":"73.03%","N1":"37.77%"},{"Level":"26","N5":"100.00%","N4":"99.59%","N3":"87.75%","N2":"74.57%","N1":"39.26%"},{"Level":"27","N5":"100.00%","N4":"100.00%","N3":"89.87%","N2":"76.40%","N1":"40.71%"},{"Level":"28","N5":"100.00%","N4":"100.00%","N3":"90.85%","N2":"78.14%","N1":"42.29%"},{"Level":"29","N5":"100.00%","N4":"100.00%","N3":"91.83%","N2":"79.47%","N1":"43.78%"},{"Level":"30","N5":"100.00%","N4":"100.00%","N3":"93.46%","N2":"81.21%","N1":"45.09%"},{"Level":"31","N5":"100.00%","N4":"100.00%","N3":"94.44%","N2":"83.04%","N1":"46.72%"},{"Level":"32","N5":"100.00%","N4":"100.00%","N3":"95.42%","N2":"84.78%","N1":"48.26%"},{"Level":"33","N5":"100.00%","N4":"100.00%","N3":"96.08%","N2":"86.41%","N1":"49.66%"},{"Level":"34","N5":"100.00%","N4":"100.00%","N3":"96.73%","N2":"87.54%","N1":"51.06%"},{"Level":"35","N5":"100.00%","N4":"100.00%","N3":"97.55%","N2":"88.76%","N1":"52.28%"},{"Level":"36","N5":"100.00%","N4":"100.00%","N3":"97.88%","N2":"90.19%","N1":"53.73%"},{"Level":"37","N5":"100.00%","N4":"100.00%","N3":"98.20%","N2":"91.22%","N1":"55.18%"},{"Level":"38","N5":"100.00%","N4":"100.00%","N3":"98.53%","N2":"91.93%","N1":"56.58%"},{"Level":"39","N5":"100.00%","N4":"100.00%","N3":"98.69%","N2":"92.44%","N1":"58.03%"},{"Level":"40","N5":"100.00%","N4":"100.00%","N3":"98.86%","N2":"93.05%","N1":"59.48%"},{"Level":"41","N5":"100.00%","N4":"100.00%","N3":"98.86%","N2":"93.56%","N1":"60.56%"},{"Level":"42","N5":"100.00%","N4":"100.00%","N3":"99.02%","N2":"94.28%","N1":"62.05%"},{"Level":"43","N5":"100.00%","N4":"100.00%","N3":"99.02%","N2":"94.99%","N1":"63.50%"},{"Level":"44","N5":"100.00%","N4":"100.00%","N3":"99.18%","N2":"95.71%","N1":"64.72%"},{"Level":"45","N5":"100.00%","N4":"100.00%","N3":"99.35%","N2":"96.42%","N1":"66.21%"},{"Level":"46","N5":"100.00%","N4":"100.00%","N3":"99.51%","N2":"96.94%","N1":"67.71%"},{"Level":"47","N5":"100.00%","N4":"100.00%","N3":"99.51%","N2":"97.34%","N1":"69.11%"},{"Level":"48","N5":"100.00%","N4":"100.00%","N3":"99.51%","N2":"98.06%","N1":"70.60%"},{"Level":"49","N5":"100.00%","N4":"100.00%","N3":"99.51%","N2":"98.06%","N1":"72.09%"},{"Level":"50","N5":"100.00%","N4":"100.00%","N3":"99.67%","N2":"98.16%","N1":"73.41%"},{"Level":"51","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"75.03%"},{"Level":"52","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"76.57%"},{"Level":"53","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"78.02%"},{"Level":"54","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"79.47%"},{"Level":"55","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"80.91%"},{"Level":"56","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"82.41%"},{"Level":"57","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"83.85%"},{"Level":"58","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"85.35%"},{"Level":"59","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"86.93%"},{"Level":"60","N5":"100.00%","N4":"100.00%","N3":"100.00%","N2":"100.00%","N1":"88.33%"}];
const joyoMap = [{"Level":"1","G1":"21.25%","G2":"0.63%","G3":"0.00%","G4":"0.00%","G5":"0.00%","G6":"0.00%","S":"0.00%"},{"Level":"2","G1":"58.75%","G2":"2.50%","G3":"0.50%","G4":"0.00%","G5":"0.00%","G6":"0.00%","S":"0.09%"},{"Level":"3","G1":"60.00%","G2":"20.63%","G3":"0.50%","G4":"0.00%","G5":"0.00%","G6":"0.00%","S":"0.09%"},{"Level":"4","G1":"87.50%","G2":"20.63%","G3":"8.00%","G4":"0.50%","G5":"0.00%","G6":"0.55%","S":"0.09%"},{"Level":"5","G1":"97.50%","G2":"41.25%","G3":"8.50%","G4":"0.50%","G5":"0.00%","G6":"0.55%","S":"0.18%"},{"Level":"6","G1":"97.50%","G2":"58.13%","G3":"14.50%","G4":"0.50%","G5":"0.00%","G6":"1.66%","S":"0.18%"},{"Level":"7","G1":"98.75%","G2":"70.63%","G3":"15.00%","G4":"6.00%","G5":"0.00%","G6":"1.66%","S":"0.18%"},{"Level":"8","G1":"100.00%","G2":"80.00%","G3":"22.50%","G4":"6.00%","G5":"0.54%","G6":"1.66%","S":"0.18%"},{"Level":"9","G1":"100.00%","G2":"81.25%","G3":"37.50%","G4":"7.50%","G5":"1.62%","G6":"1.66%","S":"0.18%"},{"Level":"10","G1":"100.00%","G2":"88.13%","G3":"50.00%","G4":"8.50%","G5":"1.62%","G6":"1.66%","S":"0.18%"},{"Level":"11","G1":"100.00%","G2":"88.13%","G3":"58.00%","G4":"19.50%","G5":"1.62%","G6":"1.66%","S":"0.18%"},{"Level":"12","G1":"100.00%","G2":"89.38%","G3":"75.50%","G4":"19.50%","G5":"1.62%","G6":"2.21%","S":"0.27%"},{"Level":"13","G1":"100.00%","G2":"89.38%","G3":"83.00%","G4":"27.00%","G5":"3.24%","G6":"3.31%","S":"0.35%"},{"Level":"14","G1":"100.00%","G2":"89.38%","G3":"83.00%","G4":"37.00%","G5":"5.41%","G6":"3.87%","S":"0.62%"},{"Level":"15","G1":"100.00%","G2":"94.38%","G3":"85.50%","G4":"45.00%","G5":"7.57%","G6":"4.42%","S":"0.97%"},{"Level":"16","G1":"100.00%","G2":"97.50%","G3":"90.50%","G4":"48.50%","G5":"10.27%","G6":"6.08%","S":"1.24%"},{"Level":"17","G1":"100.00%","G2":"98.75%","G3":"92.00%","G4":"57.50%","G5":"12.43%","G6":"8.29%","S":"1.77%"},{"Level":"18","G1":"100.00%","G2":"100.00%","G3":"92.50%","G4":"61.50%","G5":"15.14%","G6":"11.60%","S":"2.39%"},{"Level":"19","G1":"100.00%","G2":"100.00%","G3":"93.00%","G4":"66.50%","G5":"20.54%","G6":"15.47%","S":"2.83%"},{"Level":"20","G1":"100.00%","G2":"100.00%","G3":"93.00%","G4":"69.50%","G5":"28.11%","G6":"17.68%","S":"3.63%"},{"Level":"21","G1":"100.00%","G2":"100.00%","G3":"93.50%","G4":"70.50%","G5":"39.46%","G6":"20.44%","S":"3.98%"},{"Level":"22","G1":"100.00%","G2":"100.00%","G3":"94.00%","G4":"73.50%","G5":"45.95%","G6":"23.76%","S":"4.69%"},{"Level":"23","G1":"100.00%","G2":"100.00%","G3":"94.00%","G4":"74.00%","G5":"52.43%","G6":"30.39%","S":"5.22%"},{"Level":"24","G1":"100.00%","G2":"100.00%","G3":"94.00%","G4":"77.00%","G5":"56.76%","G6":"34.81%","S":"6.02%"},{"Level":"25","G1":"100.00%","G2":"100.00%","G3":"94.00%","G4":"79.00%","G5":"61.08%","G6":"36.46%","S":"7.70%"},{"Level":"26","G1":"100.00%","G2":"100.00%","G3":"94.50%","G4":"80.00%","G5":"65.95%","G6":"40.88%","S":"8.85%"},{"Level":"27","G1":"100.00%","G2":"100.00%","G3":"94.50%","G4":"82.50%","G5":"68.65%","G6":"43.65%","S":"10.35%"},{"Level":"28","G1":"100.00%","G2":"100.00%","G3":"95.00%","G4":"85.50%","G5":"74.05%","G6":"46.41%","S":"11.42%"},{"Level":"29","G1":"100.00%","G2":"100.00%","G3":"95.50%","G4":"87.50%","G5":"75.14%","G6":"47.51%","S":"13.63%"},{"Level":"30","G1":"100.00%","G2":"100.00%","G3":"96.00%","G4":"88.50%","G5":"77.84%","G6":"50.28%","S":"15.31%"},{"Level":"31","G1":"100.00%","G2":"100.00%","G3":"96.00%","G4":"94.50%","G5":"81.08%","G6":"51.93%","S":"16.64%"},{"Level":"32","G1":"100.00%","G2":"100.00%","G3":"96.00%","G4":"94.50%","G5":"91.35%","G6":"58.56%","S":"16.90%"},{"Level":"33","G1":"100.00%","G2":"100.00%","G3":"96.00%","G4":"94.50%","G5":"91.35%","G6":"75.14%","S":"17.08%"},{"Level":"34","G1":"100.00%","G2":"100.00%","G3":"96.50%","G4":"94.50%","G5":"92.97%","G6":"85.64%","S":"18.05%"},{"Level":"35","G1":"100.00%","G2":"100.00%","G3":"97.50%","G4":"94.50%","G5":"95.68%","G6":"86.19%","S":"20.00%"},{"Level":"36","G1":"100.00%","G2":"100.00%","G3":"97.50%","G4":"94.50%","G5":"96.76%","G6":"87.85%","S":"22.48%"},{"Level":"37","G1":"100.00%","G2":"100.00%","G3":"98.00%","G4":"95.50%","G5":"96.76%","G6":"88.40%","S":"25.13%"},{"Level":"38","G1":"100.00%","G2":"100.00%","G3":"98.00%","G4":"95.50%","G5":"97.30%","G6":"88.95%","S":"27.96%"},{"Level":"39","G1":"100.00%","G2":"100.00%","G3":"98.00%","G4":"95.50%","G5":"97.84%","G6":"90.06%","S":"30.71%"},{"Level":"40","G1":"100.00%","G2":"100.00%","G3":"98.50%","G4":"96.00%","G5":"97.84%","G6":"90.61%","S":"33.54%"},{"Level":"41","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"97.00%","G5":"98.38%","G6":"93.37%","S":"35.31%"},{"Level":"42","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"97.00%","G5":"98.38%","G6":"93.37%","S":"38.32%"},{"Level":"43","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"98.00%","G5":"98.38%","G6":"94.48%","S":"40.88%"},{"Level":"44","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"98.50%","G5":"98.38%","G6":"95.03%","S":"43.54%"},{"Level":"45","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"98.50%","G5":"98.38%","G6":"95.03%","S":"46.55%"},{"Level":"46","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"98.50%","G5":"99.46%","G6":"95.03%","S":"49.38%"},{"Level":"47","G1":"100.00%","G2":"100.00%","G3":"99.50%","G4":"98.50%","G5":"99.46%","G6":"95.58%","S":"52.48%"},{"Level":"48","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.00%","G5":"99.46%","G6":"96.13%","S":"55.49%"},{"Level":"49","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.00%","G5":"99.46%","G6":"96.69%","S":"58.50%"},{"Level":"50","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.00%","G5":"99.46%","G6":"97.79%","S":"61.06%"},{"Level":"51","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.34%","S":"63.72%"},{"Level":"52","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.34%","S":"66.37%"},{"Level":"53","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.34%","S":"68.58%"},{"Level":"54","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.34%","S":"71.24%"},{"Level":"55","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.34%","S":"73.89%"},{"Level":"56","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.50%","G5":"100.00%","G6":"98.90%","S":"76.28%"},{"Level":"57","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"98.90%","S":"78.67%"},{"Level":"58","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.45%","S":"81.33%"},{"Level":"59","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.45%","S":"84.42%"},{"Level":"60","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.45%","S":"87.26%"}];
const joyoCumMap = [{"Level":"1","G1":"21.25%","G2":"7.50%","G3":"4.09%","G4":"2.81%","G5":"2.18%","G6":"1.79%","S":"0.84%"},{"Level":"2","G1":"58.75%","G2":"21.25%","G3":"11.82%","G4":"8.13%","G5":"6.30%","G6":"5.17%","S":"2.48%"},{"Level":"3","G1":"60.00%","G2":"33.75%","G3":"18.64%","G4":"12.81%","G5":"9.94%","G6":"8.15%","S":"3.89%"},{"Level":"4","G1":"87.50%","G2":"42.92%","G3":"27.05%","G4":"18.75%","G5":"14.55%","G6":"12.03%","S":"5.71%"},{"Level":"5","G1":"97.50%","G2":"60.00%","G3":"36.59%","G4":"25.31%","G5":"19.64%","G6":"16.20%","S":"7.72%"},{"Level":"6","G1":"97.50%","G2":"71.25%","G3":"45.45%","G4":"31.41%","G5":"24.36%","G6":"20.28%","S":"9.64%"},{"Level":"7","G1":"98.75%","G2":"80.00%","G3":"50.45%","G4":"36.56%","G5":"28.36%","G6":"23.56%","S":"11.19%"},{"Level":"8","G1":"100.00%","G2":"86.67%","G3":"57.50%","G4":"41.41%","G5":"32.24%","G6":"26.74%","S":"12.69%"},{"Level":"9","G1":"100.00%","G2":"87.50%","G3":"64.77%","G4":"46.88%","G5":"36.73%","G6":"30.42%","S":"14.42%"},{"Level":"10","G1":"100.00%","G2":"92.08%","G3":"72.95%","G4":"52.81%","G5":"41.33%","G6":"34.19%","S":"16.20%"},{"Level":"11","G1":"100.00%","G2":"92.08%","G3":"76.59%","G4":"58.75%","G5":"45.94%","G6":"37.97%","S":"17.98%"},{"Level":"12","G1":"100.00%","G2":"92.92%","G3":"85.00%","G4":"64.53%","G5":"50.42%","G6":"41.75%","S":"19.80%"},{"Level":"13","G1":"100.00%","G2":"92.92%","G3":"88.41%","G4":"69.22%","G5":"54.42%","G6":"45.23%","S":"21.49%"},{"Level":"14","G1":"100.00%","G2":"92.92%","G3":"88.41%","G4":"72.34%","G5":"57.33%","G6":"47.71%","S":"22.80%"},{"Level":"15","G1":"100.00%","G2":"96.25%","G3":"91.36%","G4":"76.88%","G5":"61.33%","G6":"51.09%","S":"24.58%"},{"Level":"16","G1":"100.00%","G2":"98.33%","G3":"94.77%","G4":"80.31%","G5":"64.61%","G6":"54.08%","S":"26.12%"},{"Level":"17","G1":"100.00%","G2":"99.17%","G3":"95.91%","G4":"83.91%","G5":"67.88%","G6":"57.16%","S":"27.86%"},{"Level":"18","G1":"100.00%","G2":"100.00%","G3":"96.59%","G4":"85.63%","G5":"69.82%","G6":"59.34%","S":"29.21%"},{"Level":"19","G1":"100.00%","G2":"100.00%","G3":"96.82%","G4":"87.34%","G5":"72.36%","G6":"62.13%","S":"30.76%"},{"Level":"20","G1":"100.00%","G2":"100.00%","G3":"96.82%","G4":"88.28%","G5":"74.79%","G6":"64.51%","S":"32.30%"},{"Level":"21","G1":"100.00%","G2":"100.00%","G3":"97.05%","G4":"88.75%","G5":"77.70%","G6":"67.40%","S":"33.85%"},{"Level":"22","G1":"100.00%","G2":"100.00%","G3":"97.27%","G4":"89.84%","G5":"80.00%","G6":"69.88%","S":"35.39%"},{"Level":"23","G1":"100.00%","G2":"100.00%","G3":"97.27%","G4":"90.00%","G5":"81.58%","G6":"72.37%","S":"36.84%"},{"Level":"24","G1":"100.00%","G2":"100.00%","G3":"97.27%","G4":"90.94%","G5":"83.27%","G6":"74.55%","S":"38.30%"},{"Level":"25","G1":"100.00%","G2":"100.00%","G3":"97.27%","G4":"91.56%","G5":"84.73%","G6":"76.04%","S":"39.89%"},{"Level":"26","G1":"100.00%","G2":"100.00%","G3":"97.50%","G4":"92.03%","G5":"86.18%","G6":"78.03%","S":"41.43%"},{"Level":"27","G1":"100.00%","G2":"100.00%","G3":"97.50%","G4":"92.81%","G5":"87.39%","G6":"79.52%","S":"42.93%"},{"Level":"28","G1":"100.00%","G2":"100.00%","G3":"97.73%","G4":"93.91%","G5":"89.45%","G6":"81.71%","S":"44.52%"},{"Level":"29","G1":"100.00%","G2":"100.00%","G3":"97.95%","G4":"94.69%","G5":"90.30%","G6":"82.60%","S":"46.11%"},{"Level":"30","G1":"100.00%","G2":"100.00%","G3":"98.18%","G4":"95.16%","G5":"91.27%","G6":"83.90%","S":"47.61%"},{"Level":"31","G1":"100.00%","G2":"100.00%","G3":"98.18%","G4":"97.03%","G5":"93.45%","G6":"85.98%","S":"49.30%"},{"Level":"32","G1":"100.00%","G2":"100.00%","G3":"98.18%","G4":"97.03%","G5":"95.76%","G6":"89.07%","S":"50.89%"},{"Level":"33","G1":"100.00%","G2":"100.00%","G3":"98.18%","G4":"97.03%","G5":"95.76%","G6":"92.05%","S":"52.39%"},{"Level":"34","G1":"100.00%","G2":"100.00%","G3":"98.41%","G4":"97.19%","G5":"96.24%","G6":"94.33%","S":"53.98%"},{"Level":"35","G1":"100.00%","G2":"100.00%","G3":"98.86%","G4":"97.50%","G5":"97.09%","G6":"95.13%","S":"55.38%"},{"Level":"36","G1":"100.00%","G2":"100.00%","G3":"98.86%","G4":"97.50%","G5":"97.33%","G6":"95.63%","S":"56.93%"},{"Level":"37","G1":"100.00%","G2":"100.00%","G3":"99.09%","G4":"97.97%","G5":"97.70%","G6":"96.02%","S":"58.52%"},{"Level":"38","G1":"100.00%","G2":"100.00%","G3":"99.09%","G4":"97.97%","G5":"97.82%","G6":"96.22%","S":"60.11%"},{"Level":"39","G1":"100.00%","G2":"100.00%","G3":"99.09%","G4":"97.97%","G5":"97.94%","G6":"96.52%","S":"61.70%"},{"Level":"40","G1":"100.00%","G2":"100.00%","G3":"99.32%","G4":"98.28%","G5":"98.18%","G6":"96.82%","S":"63.34%"},{"Level":"41","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"98.91%","G5":"98.79%","G6":"97.81%","S":"64.75%"},{"Level":"42","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"98.91%","G5":"98.79%","G6":"97.81%","S":"66.34%"},{"Level":"43","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"99.22%","G5":"99.03%","G6":"98.21%","S":"67.88%"},{"Level":"44","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"99.38%","G5":"99.15%","G6":"98.41%","S":"69.38%"},{"Level":"45","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"99.38%","G5":"99.15%","G6":"98.41%","S":"70.97%"},{"Level":"46","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"99.38%","G5":"99.39%","G6":"98.61%","S":"72.57%"},{"Level":"47","G1":"100.00%","G2":"100.00%","G3":"99.77%","G4":"99.38%","G5":"99.39%","G6":"98.71%","S":"74.25%"},{"Level":"48","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.69%","G5":"99.64%","G6":"99.01%","S":"75.98%"},{"Level":"49","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.69%","G5":"99.64%","G6":"99.11%","S":"77.62%"},{"Level":"50","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.69%","G5":"99.64%","G6":"99.30%","S":"79.07%"},{"Level":"51","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.60%","S":"80.62%"},{"Level":"52","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.60%","S":"82.02%"},{"Level":"53","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.60%","S":"83.19%"},{"Level":"54","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.60%","S":"84.60%"},{"Level":"55","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.60%","S":"86.00%"},{"Level":"56","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"99.84%","G5":"99.88%","G6":"99.70%","S":"87.31%"},{"Level":"57","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.80%","S":"88.62%"},{"Level":"58","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.90%","S":"90.07%"},{"Level":"59","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.90%","S":"91.71%"},{"Level":"60","G1":"100.00%","G2":"100.00%","G3":"100.00%","G4":"100.00%","G5":"100.00%","G6":"99.90%","S":"93.21%"}];
const freqMap = [{"Level":"1","F1":"3.60%","F2":"0.00%","F3":"0.00%","F4":"0.00%","F5":"0.00%"},{"Level":"2","F1":"8.00%","F2":"1.80%","F3":"0.60%","F4":"0.20%","F5":"0.00%"},{"Level":"3","F1":"12.00%","F2":"3.00%","F3":"1.40%","F4":"0.20%","F5":"0.00%"},{"Level":"4","F1":"16.80%","F2":"4.40%","F3":"2.60%","F4":"0.60%","F5":"0.00%"},{"Level":"5","F1":"21.80%","F2":"6.80%","F3":"3.40%","F4":"0.80%","F5":"0.00%"},{"Level":"6","F1":"27.80%","F2":"8.20%","F3":"4.00%","F4":"1.00%","F5":"0.00%"},{"Level":"7","F1":"31.60%","F2":"10.20%","F3":"4.80%","F4":"1.00%","F5":"0.00%"},{"Level":"8","F1":"36.60%","F2":"11.40%","F3":"5.00%","F4":"1.00%","F5":"0.00%"},{"Level":"9","F1":"42.40%","F2":"12.60%","F3":"5.40%","F4":"1.00%","F5":"0.00%"},{"Level":"10","F1":"47.60%","F2":"14.40%","F3":"6.00%","F4":"1.00%","F5":"0.00%"},{"Level":"11","F1":"52.20%","F2":"16.80%","F3":"6.60%","F4":"1.00%","F5":"0.00%"},{"Level":"12","F1":"55.60%","F2":"19.20%","F3":"8.60%","F4":"1.00%","F5":"0.00%"},{"Level":"13","F1":"58.60%","F2":"22.20%","F3":"9.60%","F4":"1.20%","F5":"0.00%"},{"Level":"14","F1":"61.20%","F2":"24.60%","F3":"10.20%","F4":"1.20%","F5":"0.20%"},{"Level":"15","F1":"64.00%","F2":"27.20%","F3":"12.20%","F4":"1.40%","F5":"0.20%"},{"Level":"16","F1":"66.80%","F2":"29.80%","F3":"13.20%","F4":"1.60%","F5":"0.20%"},{"Level":"17","F1":"69.60%","F2":"32.20%","F3":"15.00%","F4":"2.00%","F5":"0.20%"},{"Level":"18","F1":"70.80%","F2":"34.00%","F3":"16.60%","F4":"2.60%","F5":"0.80%"},{"Level":"19","F1":"73.00%","F2":"36.60%","F3":"17.40%","F4":"3.60%","F5":"0.80%"},{"Level":"20","F1":"75.60%","F2":"39.20%","F3":"18.40%","F4":"4.00%","F5":"0.80%"},{"Level":"21","F1":"81.00%","F2":"40.00%","F3":"18.60%","F4":"4.00%","F5":"0.80%"},{"Level":"22","F1":"85.60%","F2":"40.40%","F3":"19.60%","F4":"4.40%","F5":"1.00%"},{"Level":"23","F1":"89.40%","F2":"41.80%","F3":"20.20%","F4":"4.80%","F5":"1.20%"},{"Level":"24","F1":"93.00%","F2":"43.40%","F3":"21.20%","F4":"4.80%","F5":"1.20%"},{"Level":"25","F1":"95.40%","F2":"46.20%","F3":"22.60%","F4":"5.00%","F5":"1.20%"},{"Level":"26","F1":"96.20%","F2":"49.60%","F3":"23.80%","F4":"6.20%","F5":"1.20%"},{"Level":"27","F1":"97.00%","F2":"53.00%","F3":"25.40%","F4":"6.80%","F5":"1.20%"},{"Level":"28","F1":"97.60%","F2":"57.20%","F3":"26.60%","F4":"7.60%","F5":"1.40%"},{"Level":"29","F1":"98.40%","F2":"60.60%","F3":"28.80%","F4":"8.00%","F5":"1.40%"},{"Level":"30","F1":"98.40%","F2":"63.20%","F3":"31.20%","F4":"8.80%","F5":"2.00%"},{"Level":"31","F1":"98.60%","F2":"65.80%","F3":"34.40%","F4":"10.00%","F5":"2.00%"},{"Level":"32","F1":"99.00%","F2":"69.40%","F3":"36.80%","F4":"10.40%","F5":"2.00%"},{"Level":"33","F1":"99.20%","F2":"72.80%","F3":"38.60%","F4":"11.20%","F5":"2.40%"},{"Level":"34","F1":"99.20%","F2":"75.40%","F3":"41.00%","F4":"12.00%","F5":"3.20%"},{"Level":"35","F1":"99.20%","F2":"77.40%","F3":"43.00%","F4":"13.60%","F5":"3.80%"},{"Level":"36","F1":"99.40%","F2":"82.40%","F3":"43.80%","F4":"13.80%","F5":"4.20%"},{"Level":"37","F1":"99.40%","F2":"87.80%","F3":"44.60%","F4":"14.00%","F5":"4.60%"},{"Level":"38","F1":"99.40%","F2":"92.20%","F3":"46.00%","F4":"14.40%","F5":"5.00%"},{"Level":"39","F1":"99.40%","F2":"94.80%","F3":"49.40%","F4":"14.80%","F5":"5.40%"},{"Level":"40","F1":"99.40%","F2":"95.40%","F3":"54.80%","F4":"15.20%","F5":"6.00%"},{"Level":"41","F1":"99.40%","F2":"97.20%","F3":"57.20%","F4":"15.60%","F5":"7.40%"},{"Level":"42","F1":"99.40%","F2":"98.20%","F3":"62.20%","F4":"16.00%","F5":"7.80%"},{"Level":"43","F1":"99.40%","F2":"98.80%","F3":"67.20%","F4":"17.00%","F5":"7.80%"},{"Level":"44","F1":"99.40%","F2":"99.00%","F3":"69.40%","F4":"20.40%","F5":"8.40%"},{"Level":"45","F1":"99.60%","F2":"99.00%","F3":"71.80%","F4":"24.40%","F5":"9.00%"},{"Level":"46","F1":"99.80%","F2":"99.00%","F3":"73.80%","F4":"28.20%","F5":"10.40%"},{"Level":"47","F1":"100.00%","F2":"99.20%","F3":"74.40%","F4":"32.60%","F5":"11.80%"},{"Level":"48","F1":"100.00%","F2":"99.20%","F3":"77.80%","F4":"35.80%","F5":"12.40%"},{"Level":"49","F1":"100.00%","F2":"99.20%","F3":"81.20%","F4":"39.20%","F5":"12.60%"},{"Level":"50","F1":"100.00%","F2":"99.20%","F3":"83.20%","F4":"43.60%","F5":"12.80%"},{"Level":"51","F1":"100.00%","F2":"100.00%","F3":"84.80%","F4":"48.20%","F5":"13.00%"},{"Level":"52","F1":"100.00%","F2":"100.00%","F3":"89.80%","F4":"49.40%","F5":"13.60%"},{"Level":"53","F1":"100.00%","F2":"100.00%","F3":"94.40%","F4":"50.00%","F5":"15.00%"},{"Level":"54","F1":"100.00%","F2":"100.00%","F3":"95.40%","F4":"54.60%","F5":"15.80%"},{"Level":"55","F1":"100.00%","F2":"100.00%","F3":"96.00%","F4":"59.80%","F5":"16.80%"},{"Level":"56","F1":"100.00%","F2":"100.00%","F3":"96.60%","F4":"65.00%","F5":"17.80%"},{"Level":"57","F1":"100.00%","F2":"100.00%","F3":"96.60%","F4":"69.80%","F5":"19.20%"},{"Level":"58","F1":"100.00%","F2":"100.00%","F3":"96.60%","F4":"75.80%","F5":"19.80%"},{"Level":"59","F1":"100.00%","F2":"100.00%","F3":"97.00%","F4":"80.80%","F5":"21.40%"},{"Level":"60","F1":"100.00%","F2":"100.00%","F3":"97.00%","F4":"81.00%","F5":"27.80%"}];
const freqCumMap = [{"Level":"1","F1":"3.60%","F2":"1.80%","F3":"1.20%","F4":"0.90%","F5":"0.72%"},{"Level":"2","F1":"8.00%","F2":"4.90%","F3":"3.47%","F4":"2.65%","F5":"2.12%"},{"Level":"3","F1":"12.00%","F2":"7.50%","F3":"5.47%","F4":"4.15%","F5":"3.32%"},{"Level":"4","F1":"16.80%","F2":"10.60%","F3":"7.93%","F4":"6.10%","F5":"4.88%"},{"Level":"5","F1":"21.80%","F2":"14.30%","F3":"10.67%","F4":"8.20%","F5":"6.56%"},{"Level":"6","F1":"27.80%","F2":"18.00%","F3":"13.33%","F4":"10.25%","F5":"8.20%"},{"Level":"7","F1":"31.60%","F2":"20.90%","F3":"15.53%","F4":"11.90%","F5":"9.52%"},{"Level":"8","F1":"36.60%","F2":"24.00%","F3":"17.67%","F4":"13.50%","F5":"10.80%"},{"Level":"9","F1":"42.40%","F2":"27.50%","F3":"20.13%","F4":"15.35%","F5":"12.28%"},{"Level":"10","F1":"47.60%","F2":"31.00%","F3":"22.67%","F4":"17.25%","F5":"13.80%"},{"Level":"11","F1":"52.20%","F2":"34.50%","F3":"25.20%","F4":"19.15%","F5":"15.32%"},{"Level":"12","F1":"55.60%","F2":"37.40%","F3":"27.80%","F4":"21.10%","F5":"16.88%"},{"Level":"13","F1":"58.60%","F2":"40.40%","F3":"30.13%","F4":"22.90%","F5":"18.32%"},{"Level":"14","F1":"61.20%","F2":"42.90%","F3":"32.00%","F4":"24.30%","F5":"19.48%"},{"Level":"15","F1":"64.00%","F2":"45.60%","F3":"34.47%","F4":"26.20%","F5":"21.00%"},{"Level":"16","F1":"66.80%","F2":"48.30%","F3":"36.60%","F4":"27.85%","F5":"22.32%"},{"Level":"17","F1":"69.60%","F2":"50.90%","F3":"38.93%","F4":"29.70%","F5":"23.80%"},{"Level":"18","F1":"70.80%","F2":"52.40%","F3":"40.47%","F4":"31.00%","F5":"24.96%"},{"Level":"19","F1":"73.00%","F2":"54.80%","F3":"42.33%","F4":"32.65%","F5":"26.28%"},{"Level":"20","F1":"75.60%","F2":"57.40%","F3":"44.40%","F4":"34.30%","F5":"27.60%"},{"Level":"21","F1":"81.00%","F2":"60.50%","F3":"46.53%","F4":"35.90%","F5":"28.88%"},{"Level":"22","F1":"85.60%","F2":"63.00%","F3":"48.53%","F4":"37.50%","F5":"30.20%"},{"Level":"23","F1":"89.40%","F2":"65.60%","F3":"50.47%","F4":"39.05%","F5":"31.48%"},{"Level":"24","F1":"93.00%","F2":"68.20%","F3":"52.53%","F4":"40.60%","F5":"32.72%"},{"Level":"25","F1":"95.40%","F2":"70.80%","F3":"54.73%","F4":"42.30%","F5":"34.08%"},{"Level":"26","F1":"96.20%","F2":"72.90%","F3":"56.53%","F4":"43.95%","F5":"35.40%"},{"Level":"27","F1":"97.00%","F2":"75.00%","F3":"58.47%","F4":"45.55%","F5":"36.68%"},{"Level":"28","F1":"97.60%","F2":"77.40%","F3":"60.47%","F4":"47.25%","F5":"38.08%"},{"Level":"29","F1":"98.40%","F2":"79.50%","F3":"62.60%","F4":"48.95%","F5":"39.44%"},{"Level":"30","F1":"98.40%","F2":"80.80%","F3":"64.27%","F4":"50.40%","F5":"40.72%"},{"Level":"31","F1":"98.60%","F2":"82.20%","F3":"66.27%","F4":"52.20%","F5":"42.16%"},{"Level":"32","F1":"99.00%","F2":"84.20%","F3":"68.40%","F4":"53.90%","F5":"43.52%"},{"Level":"33","F1":"99.20%","F2":"86.00%","F3":"70.20%","F4":"55.45%","F5":"44.84%"},{"Level":"34","F1":"99.20%","F2":"87.30%","F3":"71.87%","F4":"56.90%","F5":"46.16%"},{"Level":"35","F1":"99.20%","F2":"88.30%","F3":"73.20%","F4":"58.30%","F5":"47.40%"},{"Level":"36","F1":"99.40%","F2":"90.90%","F3":"75.20%","F4":"59.85%","F5":"48.72%"},{"Level":"37","F1":"99.40%","F2":"93.60%","F3":"77.27%","F4":"61.45%","F5":"50.08%"},{"Level":"38","F1":"99.40%","F2":"95.80%","F3":"79.20%","F4":"63.00%","F5":"51.40%"},{"Level":"39","F1":"99.40%","F2":"97.10%","F3":"81.20%","F4":"64.60%","F5":"52.76%"},{"Level":"40","F1":"99.40%","F2":"97.40%","F3":"83.20%","F4":"66.20%","F5":"54.16%"},{"Level":"41","F1":"99.40%","F2":"98.30%","F3":"84.60%","F4":"67.35%","F5":"55.36%"},{"Level":"42","F1":"99.40%","F2":"98.80%","F3":"86.60%","F4":"68.95%","F5":"56.72%"},{"Level":"43","F1":"99.40%","F2":"99.10%","F3":"88.47%","F4":"70.60%","F5":"58.04%"},{"Level":"44","F1":"99.40%","F2":"99.20%","F3":"89.27%","F4":"72.05%","F5":"59.32%"},{"Level":"45","F1":"99.60%","F2":"99.30%","F3":"90.13%","F4":"73.70%","F5":"60.76%"},{"Level":"46","F1":"99.80%","F2":"99.40%","F3":"90.87%","F4":"75.20%","F5":"62.24%"},{"Level":"47","F1":"100.00%","F2":"99.60%","F3":"91.20%","F4":"76.55%","F5":"63.60%"},{"Level":"48","F1":"100.00%","F2":"99.60%","F3":"92.33%","F4":"78.20%","F5":"65.04%"},{"Level":"49","F1":"100.00%","F2":"99.60%","F3":"93.47%","F4":"79.90%","F5":"66.44%"},{"Level":"50","F1":"100.00%","F2":"99.60%","F3":"94.13%","F4":"81.50%","F5":"67.76%"},{"Level":"51","F1":"100.00%","F2":"100.00%","F3":"94.93%","F4":"83.25%","F5":"69.20%"},{"Level":"52","F1":"100.00%","F2":"100.00%","F3":"96.60%","F4":"84.80%","F5":"70.56%"},{"Level":"53","F1":"100.00%","F2":"100.00%","F3":"98.13%","F4":"86.10%","F5":"71.88%"},{"Level":"54","F1":"100.00%","F2":"100.00%","F3":"98.47%","F4":"87.50%","F5":"73.16%"},{"Level":"55","F1":"100.00%","F2":"100.00%","F3":"98.67%","F4":"88.95%","F5":"74.52%"},{"Level":"56","F1":"100.00%","F2":"100.00%","F3":"98.87%","F4":"90.40%","F5":"75.88%"},{"Level":"57","F1":"100.00%","F2":"100.00%","F3":"98.87%","F4":"91.60%","F5":"77.12%"},{"Level":"58","F1":"100.00%","F2":"100.00%","F3":"98.87%","F4":"93.10%","F5":"78.44%"},{"Level":"59","F1":"100.00%","F2":"100.00%","F3":"99.00%","F4":"94.45%","F5":"79.84%"},{"Level":"60","F1":"100.00%","F2":"100.00%","F3":"99.00%","F4":"94.50%","F5":"81.16%"}];
const readingMap = [{"Level":"1","aozo":"7.94%","nhk":"7.51%","news":"5.02%","twit":"5.49%","wiki":"4.89%"},{"Level":"2","aozo":"15.78%","nhk":"17.31%","news":"13.42%","twit":"13.50%","wiki":"13.87%"},{"Level":"3","aozo":"20.49%","nhk":"22.27%","news":"18.40%","twit":"19.16%","wiki":"17.89%"},{"Level":"4","aozo":"25.74%","nhk":"28.49%","news":"22.87%","twit":"24.00%","wiki":"24.59%"},{"Level":"5","aozo":"32.76%","nhk":"37.52%","news":"28.66%","twit":"31.10%","wiki":"30.77%"},{"Level":"6","aozo":"38.52%","nhk":"45.28%","news":"35.89%","twit":"38.20%","wiki":"36.81%"},{"Level":"7","aozo":"42.01%","nhk":"49.14%","news":"40.00%","twit":"42.06%","wiki":"40.47%"},{"Level":"8","aozo":"45.67%","nhk":"54.67%","news":"44.22%","twit":"45.88%","wiki":"44.89%"},{"Level":"9","aozo":"49.95%","nhk":"61.60%","news":"50.75%","twit":"50.89%","wiki":"50.42%"},{"Level":"10","aozo":"52.87%","nhk":"65.64%","news":"54.47%","twit":"54.69%","wiki":"53.93%"},{"Level":"11","aozo":"55.40%","nhk":"67.91%","news":"57.70%","twit":"57.60%","wiki":"57.47%"},{"Level":"12","aozo":"57.84%","nhk":"71.30%","news":"60.83%","twit":"60.92%","wiki":"60.70%"},{"Level":"13","aozo":"59.97%","nhk":"73.55%","news":"63.12%","twit":"63.61%","wiki":"62.96%"},{"Level":"14","aozo":"61.37%","nhk":"75.46%","news":"65.10%","twit":"65.04%","wiki":"64.56%"},{"Level":"15","aozo":"63.17%","nhk":"77.36%","news":"67.03%","twit":"67.59%","wiki":"66.87%"},{"Level":"16","aozo":"65.27%","nhk":"79.66%","news":"69.24%","twit":"72.63%","wiki":"69.27%"},{"Level":"17","aozo":"67.24%","nhk":"81.28%","news":"71.02%","twit":"74.44%","wiki":"70.85%"},{"Level":"18","aozo":"68.38%","nhk":"82.01%","news":"71.94%","twit":"75.67%","wiki":"71.71%"},{"Level":"19","aozo":"69.45%","nhk":"83.15%","news":"73.68%","twit":"76.64%","wiki":"73.27%"},{"Level":"20","aozo":"70.75%","nhk":"85.61%","news":"76.03%","twit":"77.90%","wiki":"74.87%"},{"Level":"21","aozo":"71.87%","nhk":"87.18%","news":"79.15%","twit":"79.12%","wiki":"77.02%"},{"Level":"22","aozo":"73.01%","nhk":"88.31%","news":"81.30%","twit":"80.71%","wiki":"78.51%"},{"Level":"23","aozo":"74.00%","nhk":"89.35%","news":"83.10%","twit":"82.13%","wiki":"80.22%"},{"Level":"24","aozo":"74.86%","nhk":"90.30%","news":"84.57%","twit":"82.98%","wiki":"81.36%"},{"Level":"25","aozo":"75.93%","nhk":"90.77%","news":"85.96%","twit":"83.85%","wiki":"82.34%"},{"Level":"26","aozo":"76.88%","nhk":"91.23%","news":"86.89%","twit":"84.52%","wiki":"83.21%"},{"Level":"27","aozo":"77.80%","nhk":"91.70%","news":"87.60%","twit":"85.75%","wiki":"83.82%"},{"Level":"28","aozo":"78.88%","nhk":"92.25%","news":"88.53%","twit":"86.79%","wiki":"84.94%"},{"Level":"29","aozo":"79.62%","nhk":"92.91%","news":"89.47%","twit":"87.39%","wiki":"85.76%"},{"Level":"30","aozo":"80.33%","nhk":"93.27%","news":"89.97%","twit":"88.13%","wiki":"86.59%"},{"Level":"31","aozo":"81.11%","nhk":"93.85%","news":"90.59%","twit":"88.79%","wiki":"87.64%"},{"Level":"32","aozo":"82.11%","nhk":"94.42%","news":"91.61%","twit":"89.62%","wiki":"88.40%"},{"Level":"33","aozo":"82.82%","nhk":"94.71%","news":"92.05%","twit":"90.06%","wiki":"89.00%"},{"Level":"34","aozo":"83.45%","nhk":"95.00%","news":"92.57%","twit":"90.63%","wiki":"89.49%"},{"Level":"35","aozo":"84.49%","nhk":"95.56%","news":"92.93%","twit":"91.30%","wiki":"89.96%"},{"Level":"36","aozo":"85.05%","nhk":"96.11%","news":"93.87%","twit":"91.94%","wiki":"91.23%"},{"Level":"37","aozo":"85.51%","nhk":"96.59%","news":"94.60%","twit":"92.53%","wiki":"92.04%"},{"Level":"38","aozo":"86.07%","nhk":"96.99%","news":"95.07%","twit":"92.99%","wiki":"92.58%"},{"Level":"39","aozo":"86.69%","nhk":"97.31%","news":"95.54%","twit":"93.50%","wiki":"93.19%"},{"Level":"40","aozo":"87.16%","nhk":"97.50%","news":"95.94%","twit":"93.89%","wiki":"93.58%"},{"Level":"41","aozo":"87.59%","nhk":"97.60%","news":"96.23%","twit":"94.16%","wiki":"93.98%"},{"Level":"42","aozo":"88.01%","nhk":"97.82%","news":"96.53%","twit":"94.47%","wiki":"94.26%"},{"Level":"43","aozo":"88.51%","nhk":"97.97%","news":"96.82%","twit":"94.85%","wiki":"94.60%"},{"Level":"44","aozo":"89.10%","nhk":"98.16%","news":"96.99%","twit":"95.66%","wiki":"94.93%"},{"Level":"45","aozo":"89.65%","nhk":"98.34%","news":"97.27%","twit":"96.27%","wiki":"95.38%"},{"Level":"46","aozo":"90.08%","nhk":"98.65%","news":"97.50%","twit":"96.55%","wiki":"95.67%"},{"Level":"47","aozo":"90.56%","nhk":"98.75%","news":"97.67%","twit":"96.78%","wiki":"95.90%"},{"Level":"48","aozo":"90.92%","nhk":"98.91%","news":"97.82%","twit":"97.04%","wiki":"96.10%"},{"Level":"49","aozo":"91.26%","nhk":"98.98%","news":"97.98%","twit":"97.23%","wiki":"96.35%"},{"Level":"50","aozo":"91.56%","nhk":"99.05%","news":"98.09%","twit":"97.39%","wiki":"96.57%"},{"Level":"51","aozo":"91.96%","nhk":"99.15%","news":"98.27%","twit":"97.65%","wiki":"96.90%"},{"Level":"52","aozo":"92.19%","nhk":"99.29%","news":"98.52%","twit":"97.90%","wiki":"97.15%"},{"Level":"53","aozo":"92.37%","nhk":"99.34%","news":"98.72%","twit":"98.01%","wiki":"97.35%"},{"Level":"54","aozo":"92.59%","nhk":"99.39%","news":"98.81%","twit":"98.11%","wiki":"97.51%"},{"Level":"55","aozo":"93.02%","nhk":"99.44%","news":"98.96%","twit":"98.27%","wiki":"97.74%"},{"Level":"56","aozo":"93.27%","nhk":"99.50%","news":"99.06%","twit":"98.40%","wiki":"97.89%"},{"Level":"57","aozo":"93.43%","nhk":"99.53%","news":"99.11%","twit":"98.48%","wiki":"98.00%"},{"Level":"58","aozo":"93.60%","nhk":"99.55%","news":"99.16%","twit":"98.54%","wiki":"98.11%"},{"Level":"59","aozo":"93.84%","nhk":"99.58%","news":"99.23%","twit":"98.61%","wiki":"98.24%"},{"Level":"60","aozo":"93.97%","nhk":"99.60%","news":"99.25%","twit":"98.65%","wiki":"98.29%"}];

const progressTemplate = {
    jlpt: { N1: { learned: 0, total: 1232 }, N2: { learned: 0, total: 367 }, N3: { learned: 0, total: 367 }, N4: { learned: 0, total: 166 }, N5: { learned: 0, total: 79 } },
    joyo: { G1: { learned: 0, total: 80 }, G2: { learned: 0, total: 160 }, G3: { learned: 0, total: 200 }, G4: { learned: 0, total: 200 }, G5: { learned: 0, total: 185 }, G6: { learned: 0, total: 181 }, S: { learned: 0, total: 1130 } },
    freq: { F1: { learned: 0, total: 500 }, F2: { learned: 0, total: 500 }, F3: { learned: 0, total: 500 }, F4: { learned: 0, total: 500 }, F5: { learned: 0, total: 500 } },
    read: { nhk: { learned: 0, total: 0 }, news: { learned: 0, total: 0 }, aozo: { learned: 0, total: 0 }, twit: { learned: 0, total: 0 }, wiki: { learned: 0, total: 0 } }
};

var wkof = window.wkof
if (!wkof) {
    var response = confirm('Wanikani: JLPT Dashboard requires WaniKani Open Framework.\n Click "OK" for installation instructions.',);
    if (response) {
        window.location.href = 'https://community.wanikani.com/t/instructions-installing-wanikani-open-framework/28549';
        return;
    }
} else {
    wkof.include('Menu,Settings');
    wkof.ready('Menu,Settings').then(loadSettings).then(installMenu);

    var userLevel;
    var userProgressRate = 0;
    var userProgressData;
    var progress = progressTemplate;

    wkof.include('Apiv2');
    wkof.ready('Apiv2').then(checkUser).then(getUserProgressData).then(calculatePercentages);
}

function checkUser() {
    if (!(window.location.href === wkof.user.profile_url)) {
        return Promise.reject(new Error("JLPT Dashboard only works for your personal userpage"));
    }
}

function loadSettings() {
    const defaults = { goal: '75%', forecast: true, hide: false, joyoHide: false, lists: {1: true, 2: false, 3: false, 4: false}, cumulative: {jlpt: false, joyo: false, freq: true}};
    wkof.Settings.load('jlpt_dashboard', defaults);
}

function installMenu() {
    var config = {
        name: 'jlpt_dashboard_settings',
        submenu: 'Settings',
        title: 'JLPT Dashboard',
        on_click: openSettings,
    };
    wkof.Menu.insert_script_link(config);
}

function getUserProgressData() {
    return wkof.Apiv2.fetch_endpoint('/level_progressions').then(data => {
        userProgressData = data.data;
        userLevel = userProgressData[userProgressData.length - 1].data.level;
        for (let date in userProgressData) {
            if (userProgressData[date].data.passed_at) {
                userProgressRate += Math.floor((new Date(userProgressData[date].data.passed_at).getTime() - new Date(userProgressData[date].data.started_at).getTime()) / (1000 * 3600 * 24));
            }
        }
        userProgressRate = userProgressRate / userProgressData.length;
    });
}

function openSettings(items) {
    var config = {
        script_id: 'jlpt_dashboard',
        title: 'JLPT Dashboard',
        content: {
            goal: {
                type: 'input',
                label: 'Kanji % goal for each category',
                default: '75%',
            },
            forecast: {
                type: 'checkbox',
                label: 'Forecast kanji % goal completion',
                default: true,
            },
            hide: {
                type: 'checkbox',
                label: 'Hide completed categories',
                default: false,
            },
            joyoHide: {
                type: 'checkbox',
                label: 'Hide Jōyō diplomas',
                default: false,
            },
            lists: {
                type: 'list',
                label: 'Displayed kanji lists',
                multi: true,
                size: 4,
                default: {1: true, 2: false, 3: false, 4: false},
                content: {
                    1: 'JLPT',
                    2: 'Jōyō',
                    3: 'Frequently Used',
                    4: 'Reading',
                },
            },
            cumulative: {
                type: 'list',
                label: 'Cumulative (i.e. N4 = N4 + N5)',
                multi: true,
                size: 3,
                default: {jlpt: false, joyo: false, freq: true},
                content: {
                    jlpt: 'JLPT',
                    joyo: 'Jōyō',
                    freq: 'Frequently Used',
                },
            },
        },
        on_save: () => {
            progress = progressTemplate;
            calculatePercentages();
        },
    }
    const dialog = new wkof.Settings(config);
    dialog.open();
}

function calculatePercentages() {
    const percentages = {
        jlpt: { N1: {}, N2: {}, N3: {}, N4: {}, N5: {} },
        joyo: { G1: {}, G2: {}, G3: {}, G4: {}, G5: {}, G6: {}, S: {} },
        freq: { F1: {}, F2: {}, F3: {}, F4: {}, F5: {} },
        read: { nhk: {}, news: {}, aozo: {}, twit: {}, wiki: {} },
    };

    for (const key in percentages) {
        const isCum = wkof.settings.jlpt_dashboard.cumulative[key];
        const cumulative = [0, 0];
        for (let level in percentages[key]) {
            level = key == 'jlpt' ? "N" + (6 - level.charAt(1)) : level;
            const percent = getPercentage(level, key).slice(0, -1);
            const { total } = progress[key][level];
            cumulative[1] += total;
            const learned = Math.round(percent / 100 * (isCum ? cumulative[1] : total));
            percentages[key][level] = {
                percent,
                learned,
                total: isCum ? cumulative[1] : total
            };
        }
    }
    return updateDashboard(percentages);
}

function getMap(type) {
    const mapLookup = {
        "jlpt": wkof.settings.jlpt_dashboard.cumulative.jlpt ? jlptCumMap : jlptMap,
        "joyo": wkof.settings.jlpt_dashboard.cumulative.joyo ? joyoCumMap : joyoMap,
        "jōyō": wkof.settings.jlpt_dashboard.cumulative.joyo ? joyoCumMap : joyoMap,
        "freq": wkof.settings.jlpt_dashboard.cumulative.freq ? freqCumMap : freqMap,
        "read": readingMap,
    };
    return mapLookup[type.toLowerCase().substring(0, 4)] || null;
}

function getPercentage(level, type) {
    const levelObject = getMap(type).find((item) => item.Level === userLevel.toString());
    return levelObject ? levelObject[level] : null;
}

function getLevel(percent, type, level) {
    const map = getMap(type);
    const levelData = map.find((item) => Number(item[level].slice(0, -1)) >= Number(percent.slice(0, -1)));
    return levelData ? levelData.Level : map[map.length - 1][level];
}

function formatDate(date) {
    const year = date.getFullYear();
    let month = date.getMonth() + 1;
    if (month < 10) {
        month = '0' + month;
    }
    let day = date.getDate();
    if (day < 10) {
        day = '0' + day;
    }
    return `${month}-${day}-${year}`
}

function createHeader(title, node) {
    const header = document.createElement('div');
    header.innerHTML = `<h3 style="margin: 1.75em 0em; text-align: center;"><span style="padding:5px 15px;
 background-color:#c8c8c8;
 color:#eee;
 letter-spacing:0;
 text-shadow:0 1px 0 rgba(0,0,0,0.2);
 -webkit-border-radius:50px;
 -moz-border-radius:50px;
 border-radius:50px;
 -webkit-box-shadow:inset 0 5px 5px rgba(0,0,0,0.1),0 1px 0 rgba(255,255,255,0.9);
 -moz-box-shadow:inset 0 5px 5px rgba(0,0,0,0.1),0 1px 0 rgba(255,255,255,0.9);
 box-shadow:inset 0 5px 5px rgba(0,0,0,0.1),0 1px 0 rgba(255,255,255,0.9)">
    ${title}
</span></h3>`;
    node.append(header);
}

function getSectionHeader(header, level = '') {
    const headerMappings = {
        'Jōyō': {
            'G1': '1st Grade ',
            'G2': '2nd Grade ',
            'G3': '3rd Grade ',
            'G4': '4th Grade ',
            'G5': '5th Grade ',
            'G6': '6th Grade ',
            'S': 'Secondary School ',
        },
        'Frequency': {
            'F1': 'Top 500 ',
            'F2': 'Top 1000 ',
            'F3': 'Top 1500 ',
            'F4': 'Top 2000 ',
            'F5': 'Top 2500 ',
        },
        'Reading': {
            'aozo': 'Aozora Books ',
            'news': 'Online News ',
            'nhk': 'NHK News Easy ',
            'twit': 'Twitter ',
            'wiki': 'Wikipedia ',
        },
    };

    if (headerMappings[header] && headerMappings[header][level]) {
        return headerMappings[header][level];
    }

    return level;
}

function addMedals(header, medals, goal) {
    const joyo = header === 'Jōyō';
    const medalsContainer = $('.public-profile__user-info-title');
    const medalContainer = $('<span id="medalContainer" style="position: absolute; margin-left: 0.65em;"></span>');

    if (!$("#medalContainer").length > 0) {
        medalContainer.appendTo(medalsContainer);
    }

    function findLevel(level) {
        const progress = userProgressData.find(data => data.data.level == level);
        return progress ? formatDate(new Date(progress.data.started_at)) : null;
    }

    function getImage(num) {
        const images = [
            "https://i.ibb.co/NVpf0tJ/medal11.png",
            "https://i.ibb.co/Tghtt4Q/medal12.png",
            "https://i.ibb.co/JQH4rtR/medal13.png",
            "https://i.ibb.co/f9mWRQF/medal14.png",
            "https://i.ibb.co/cJsDzvV/medal15.png"
        ];
        return images[num] || null;
    }

    function getJoyoImage(num) {
        const images = [
            "https://i.ibb.co/0FhTmkX/pink.webp",
            "https://i.ibb.co/0FhTmkX/pink.webp",
            "https://i.ibb.co/KqGqYCv/purple.webp",
            "https://i.ibb.co/KqGqYCv/purple.webp",
            "https://i.ibb.co/HxPJdBz/blue.webp",
            "https://i.ibb.co/wMFwCFC/lblue.webp",
            "https://i.ibb.co/7gFCK33/gold.webp"
        ];
        return images[num] || null;
    }

    const style = `
    <style id="jlpt_dashboard">
      ${Array.from(Array(7), (_, k) => `
        div.title${k + 1} {
          display: none;
          position: absolute;
          text-align: center;
          width: 16em;
          background-color: black;
          border-radius: 0.5em;
          color: white;
        }
        div.title${k + 1}:hover, img.wrapper${k + 1}:hover + div {
          display: block;
          margin-top: -4em;
          margin-left: ${-6.6 + k * 1.4}em;
        }

  /* hotfix ugly injects many times i cba it works ok */

  .chart {
    color: #808080;
  }

  .bar {
    height: 20px;
    background-color: var(--color-progress-chart-bar);
    background-image: var(--color-progress-chart-bar-gradient);
    text-align: right;
    color: #fff;
  }

  .progress {
    height: 20px;
    background-color: var(--color-progress-chart-bar-background);
    box-shadow: inset 0 1px 2px rgba(0,0,0,.1);
  }

  .pull-right.total {
  float: right;
  }

      `).join("")}
    </style>`;
    $('head').append(style);

    for (let k = 0; k < medals.length; k++) {
        const level = joyo ? getSectionHeader('Jōyō', medals[k].level) : medals[k].level;
        const goalLevel = medals[k].goalLevel;
        const marginLeftStyle = joyo ? 'margin-left: 0.1em' : k !== 0 ? 'margin-left: -0.45em' : null;

        const imgNode = $('<img>').attr({
            class: `wrapper${k + 1}`,
            width: joyo ? '21' : '26',
            height: joyo ? '18' : '26',
            src: joyo ? getJoyoImage(k) : getImage(k),
            style: marginLeftStyle
        });
        $("#medalContainer").append(imgNode);

        const levelInfo = findLevel(goalLevel);
        const divNode = $('<div>', {
            class: `title${k + 1}`,
            html: `${level} ${goal}% achieved on ${levelInfo}`,
            style: joyo ? k === 6 ? `margin-left: 7.2em; width: 22.5em;` : `margin-left: ${($("#medalContainer img").length - 6.6) * 1.55}em; width: 19em;` : null
        });
        $("#medalContainer").append(divNode);
    }
}

function updateDashboard(data) {
    $('#jlptDashboard').remove();
    $("#medalContainer").remove();

    const lists = wkof.settings.jlpt_dashboard.lists;
    let goal = wkof.settings.jlpt_dashboard.goal;
    if (/\b(?<!\.)(?!0+(?:\.0+)?%)(?:\d|[1-9]\d|100)(?:(?<!100)\.\d+)?%/g.test(goal)) {
        goal = goal.replace('%', '');
    } else {
        goal = 75;
    }

    const distributionContainer = $('.public-profile__vocabulary-progress');
    const dashboardNode = document.createElement('div');
    dashboardNode.id = 'jlptDashboard';
    distributionContainer.append(dashboardNode);

    const displayLevelData = (header, levelData) => {
        const containerNode = document.createElement('div');
        containerNode.id = header.toLowerCase() + 'Container';
        dashboardNode.append(containerNode);
        createHeader(header, containerNode);

        let medals = [];
        let levels = Object.keys(levelData);
        header === 'JLPT' ? levels = levels.reverse() : null;
        if (header === 'Reading') {
            levels = levels.sort();
            [levels[1], levels[2]] = [levels[2], levels[1]];
        }

        for (const level of levels) {
            const kanjiPercent = levelData[level].percent;
            const kanjiLearned = levelData[level].learned;
            const kanjiTotal = levelData[level].total;
            const goalLevel = getLevel(goal + "%", header, level);
            let goalComplete = Number(kanjiPercent) >= Number(goal);
            if ((level === 'N1' && Number(kanjiPercent) >= 79) || (level === 'G6' && Number(kanjiPercent) >= 99 || (level === 'S' && Number(kanjiPercent) >= 87))) {
                goalComplete = true;
            }
            let text = "";

            if (goalComplete) {
                if (header === 'JLPT' || header === 'Jōyō' && !wkof.settings.jlpt_dashboard.joyoHide) {
                    medals.push({level, goalLevel});
                }
                if (wkof.settings.jlpt_dashboard.hide) {
                    continue;
                }
            }

            if (!goalComplete && wkof.settings.jlpt_dashboard.forecast) {
                if (Number(goalLevel)) {
                    const timeRequired = (goalLevel - Number((userLevel))) * userProgressRate;
                    text = "Reach " + goal + "% at level " + goalLevel + " in about " + Math.ceil(timeRequired) + " days on " + formatDate(new Date(new Date().setDate(new Date().getDate() + Math.ceil(timeRequired)))) + " — ";
                } else {
                    const timeRequired = (60 - Number((userLevel))) * userProgressRate;
                    text = "WaniKani will bring you to " + goalLevel + " by completing level 60 in about " + Math.ceil(timeRequired) + " days on " + formatDate(new Date(new Date().setDate(new Date().getDate() + Math.ceil(timeRequired)))) + " — ";
                }
            }

            const node = document.createElement('div');
            node.innerHTML = `
        <h3>${getSectionHeader(header, level)} ${header === 'Reading' ? '~ Kanji Familiarity' : 'Progression — ' + kanjiLearned + '漢字'}</h3>
        <div class="chart">
          <div class="progress">
            <div class="bar" style="width: ${kanjiPercent}%;
            ${goalComplete ? `
            background-color:#ffd700;
            background-image:-moz-linear-gradient(top, #ffd700, #F1E5AC);
            background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#ffd700), to(#F1E5AC));
            background-image:-webkit-linear-gradient(top, #ffd700, #F1E5AC);
            background-image:-o-linear-gradient(top, #ffd700, #F1E5AC);
            background-image:linear-gradient(to bottom, #ffd700, #F1E5AC);');
            ` : ''}">
              <span style="font-size:inherit;vertical-align:middle;"><b>${kanjiPercent}%</b></span>
            </div>
          </div>${header === 'Reading' ? '0%' : '0'}<span" class="pull-right total">${text}${header === 'Reading' ? '100%' : kanjiTotal}</span>
        </div>
      `;
            containerNode.append(node);
        }
        medals.length ? addMedals(header, medals, goal) : null;
    };

    if (lists[1]) {
        displayLevelData('JLPT', data.jlpt);
        if ($("#jlptContainer div").length === 1) {
            $("#jlptContainer").remove();
        }
    }
    if (lists[2]) {
        displayLevelData('Jōyō', data.joyo);
        if ($("#jōyōContainer div").length === 1) {
            $("#jōyōContainer").remove();
        }
    }
    if (lists[3]) {
        displayLevelData('Frequency', data.freq);
        if ($("#frequencyContainer div").length === 1) {
            $("#frequencyContainer").remove();
        }
    }
    if (lists[4]) {
        displayLevelData('Reading', data.read);
        if ($("#readingContainer div").length === 1) {
            $("#readingContainer").remove();
        }
    }
}
