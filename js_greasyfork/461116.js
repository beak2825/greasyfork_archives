// ==UserScript==
// @name B站视频总结
// @namespace chatgpt
// @license MIT
// @version 1.2.5
// @description 在视频旁边生成一个小窗口，显示视频内容的梗概。
// @match https://www.bilibili.com/video/*
// @grant GM_xmlhttpRequest
// @connect *
// @connect b.jimmylv.cn
// @require https://cdn.jsdelivr.net/npm/marked@2.1.3
// @downloadURL https://update.greasyfork.org/scripts/461170/B%E7%AB%99%E8%A7%86%E9%A2%91%E6%80%BB%E7%BB%93.user.js
// @updateURL https://update.greasyfork.org/scripts/461170/B%E7%AB%99%E8%A7%86%E9%A2%91%E6%80%BB%E7%BB%93.meta.js
// ==/UserScript==

// ！！！！！！！！！！！！！！！！！！！！！

// 1. 刚发现网页有变，深色模式/夜间模式有地方失效了。重新适配了下，更新完脚本记得刷新网页。
// 2. 下次出问题/有什么需要的功能， github 或 greasyfork 给我留个言，或者QQ联系我都行 1243738449 。

// ！！！！！！！！！！！！！！！！！！！！！

(function () {
  "use strict";
  let darkMode = localStorage.getItem("darkMode") === "true" || false; 
  let fixedMode = localStorage.getItem("fixedMode") === "true" || false; 
  const button = document.createElement("button");
  button.setAttribute("id", "button");
  button.title = '快捷键 Z 与按钮等效';
  button.innerHTML = darkMode
    ? '<svg t="1677926168943" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6698" width="22" height="22" style="transform: translateY(1.5px)"><path d="M477.090909 162.909091V116.363636c0-18.618182 16.290909-34.909091 34.909091-34.909091s34.909091 16.290909 34.909091 34.909091v46.545455c0 18.618182-16.290909 34.909091-34.909091 34.909091s-34.909091-16.290909-34.909091-34.909091zM256 283.927273c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872728l-32.581818-32.581818c-13.963636-16.290909-37.236364-16.290909-51.2-2.327272s-13.963636 34.909091 0 48.872727l32.581818 34.909091z m-69.818182 169.890909H139.636364c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m69.818182 239.709091l-32.581818 32.581818c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872727s-37.236364-11.636364-51.2 0z m349.090909 86.109091h-186.181818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.90909h186.181818c18.618182 0 34.909091-16.290909 34.909091-34.90909s-16.290909-34.909091-34.909091-34.909091z m-46.545454 93.090909h-93.09091c-18.618182 0-34.909091 16.290909-34.90909 34.909091s16.290909 34.909091 34.90909 34.909091h93.09091c18.618182 0 34.909091-16.290909 34.90909-34.909091s-16.290909-34.909091-34.90909-34.909091z m209.454545-179.2c-13.963636-13.963636-34.909091-13.963636-48.872727 0s-13.963636 34.909091 0 48.872727l32.581818 32.581818c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872727L768 693.527273z m116.363636-239.709091h-46.545454c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m-141.963636-160.581818c9.309091 0 18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872728s-34.909091-13.963636-48.872727 0L716.8 232.727273c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 9.309091 16.290909 11.636364 25.6 11.636364zM512 232.727273c-141.963636 0-256 114.036364-256 256s114.036364 256 256 256 256-114.036364 256-256-114.036364-256-256-256z" fill="#e6e6e6" p-id="6699"></path></svg>'
    : '<svg t="1677926168943" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6698" width="22" height="22" style="transform: translateY(1.5px)"><path d="M477.090909 162.909091V116.363636c0-18.618182 16.290909-34.909091 34.909091-34.909091s34.909091 16.290909 34.909091 34.909091v46.545455c0 18.618182-16.290909 34.909091-34.909091 34.909091s-34.909091-16.290909-34.909091-34.909091zM256 283.927273c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872728l-32.581818-32.581818c-13.963636-16.290909-37.236364-16.290909-51.2-2.327272s-13.963636 34.909091 0 48.872727l32.581818 34.909091z m-69.818182 169.890909H139.636364c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m69.818182 239.709091l-32.581818 32.581818c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872727s-37.236364-11.636364-51.2 0z m349.090909 86.109091h-186.181818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.90909h186.181818c18.618182 0 34.909091-16.290909 34.909091-34.90909s-16.290909-34.909091-34.909091-34.909091z m-46.545454 93.090909h-93.09091c-18.618182 0-34.909091 16.290909-34.90909 34.909091s16.290909 34.909091 34.90909 34.909091h93.09091c18.618182 0 34.909091-16.290909 34.90909-34.909091s-16.290909-34.909091-34.90909-34.909091z m209.454545-179.2c-13.963636-13.963636-34.909091-13.963636-48.872727 0s-13.963636 34.909091 0 48.872727l32.581818 32.581818c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872727L768 693.527273z m116.363636-239.709091h-46.545454c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m-141.963636-160.581818c9.309091 0 18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872728s-34.909091-13.963636-48.872727 0L716.8 232.727273c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 9.309091 16.290909 11.636364 25.6 11.636364zM512 232.727273c-141.963636 0-256 114.036364-256 256s114.036364 256 256 256 256-114.036364 256-256-114.036364-256-256-256z" fill="#707070" p-id="6699"></path></svg>';
  button.style.width = "40px";
  button.style.height = "40px";
  button.style.borderRadius = "50%";
  button.style.position = "fixed";
  button.style.bottom = "auto";
  button.style.top = "50%";
  button.style.transform = "translate(0, -50%)";
  button.style.right = "5px";
  button.style.zIndex = "9998";
  button.style.background = darkMode ? "#111" : "#FFFFFF"; 
  button.style.border = "none";
  button.style.cursor = "pointer";
  button.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";
  button.style.transition = "0.3s";
  button.style.opacity = "0.9";
  button.addEventListener("mouseover", () => {
    button.style.opacity = "0.7";
  });
  button.addEventListener("mouseout", () => {
    button.style.opacity = "0.9";
  });
  document.body.appendChild(button);

  const modeButton = document.createElement("button");
  modeButton.setAttribute("id", "modeButton");
  modeButton.title = '深/浅色模式';
  modeButton.innerHTML = darkMode
    ? (modeButton.innerHTML =
        '<svg t="1677925762871" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20150" width="16" height="16" style="transform: translateY(1.5px)"><path d="M399.61 49.951C399.61 22.353 377.257 0 349.659 0 274.607 0 0 209.845 0 499.512 0 789.18 234.82 1024 524.488 1024 814.155 1024 1024 747.47 1024 674.341c0-27.598-22.353-49.95-49.951-49.95s-301.181 67.683-472.014-103.15C331.202 350.408 399.61 77.549 399.61 49.951z" p-id="20151" data-spm-anchor-id="a313x.7781069.0.i59" class="selected" fill="#e6e6e6"></path></svg>')
    : '<svg t="1677925762871" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20150" width="16" height="16" style="transform: translateY(1.5px)"><path d="M399.61 49.951C399.61 22.353 377.257 0 349.659 0 274.607 0 0 209.845 0 499.512 0 789.18 234.82 1024 524.488 1024 814.155 1024 1024 747.47 1024 674.341c0-27.598-22.353-49.95-49.951-49.95s-301.181 67.683-472.014-103.15C331.202 350.408 399.61 77.549 399.61 49.951z" p-id="20151" data-spm-anchor-id="a313x.7781069.0.i59" class="selected" fill="#707070"></path></svg>';
  modeButton.style.width = "40px";
  modeButton.style.height = "40px";
  modeButton.style.borderRadius = "50%";
  modeButton.style.position = "fixed";
  modeButton.style.bottom = "auto";
  modeButton.style.top = "50%";
  modeButton.style.transform = "translate(110%, -180%)";
  modeButton.style.transition = "transform 0.3s ease-out";
  modeButton.style.right = "5px";
  modeButton.style.zIndex = "9098";
  modeButton.style.background = darkMode ? "#111" : "#FFFFFF";
  modeButton.style.border = "none";
  modeButton.style.cursor = "pointer";
  modeButton.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";
  modeButton.style.opacity = "0.9";
  modeButton.addEventListener("mouseover", () => {
    modeButton.style.opacity = "0.7";
  });
  modeButton.addEventListener("mouseout", () => {
    modeButton.style.opacity = "0.9";
  });
  document.body.appendChild(modeButton);

  const fixButton = document.createElement("button");
  fixButton.setAttribute("id", "fixButton");
  fixButton.title = '锁定后, 单击页面空白处 小窗不会消失';
  if (darkMode) {
    fixButton.innerHTML = fixedMode
      ? '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#E6E6E6"></path></svg>'
      : '<svg t="1677926529299" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#E6E6E6"></path></svg>';
  } else {
    fixButton.innerHTML = fixedMode
      ? '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#707070"></path></svg>'
      : '<svg t="1677926529299" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#707070"></path></svg>';
  }
  fixButton.style.width = "40px";
  fixButton.style.height = "40px";
  fixButton.style.borderRadius = "50%";
  fixButton.style.position = "fixed";
  fixButton.style.bottom = "auto";
  fixButton.style.top = "50%";
  fixButton.style.transform = "translate(110%, 75%)";
  fixButton.style.transition = "transform 0.3s ease-out";
  fixButton.style.right = "5px";
  fixButton.style.zIndex = "9998";
  fixButton.style.background = darkMode ? "#111" : "#FFFFFF";
  fixButton.style.border = "none";
  fixButton.style.cursor = "pointer";
  fixButton.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";
  fixButton.style.opacity = "0.9";
  fixButton.addEventListener("mouseover", () => {
    fixButton.style.opacity = "0.7";
  });
  fixButton.addEventListener("mouseout", () => {
    fixButton.style.opacity = "0.9";
  });
  document.body.appendChild(fixButton);

  const sidebar = document.createElement("div");
  sidebar.addEventListener("click", (event) => {
    event.stopPropagation();
  });
  sidebar.style.position = "fixed";
  sidebar.style.top = "50%";
  sidebar.style.transform = "translateY(-50%)";
  sidebar.style.right = "-100%";
  sidebar.style.width = "29%";
  sidebar.style.height = "auto";
  sidebar.style.maxHeight = "calc(100vh - 40px)";
  sidebar.style.backgroundColor = darkMode
    ? "rgba(0, 0, 0, 0.8)"
    : "rgba(255,255,255, 0.9)"; 
  sidebar.style.webkitBackdropFilter = "blur(8px)";
  sidebar.style.backdropFilter = "blur(8px)";
  sidebar.style.borderRadius = "10px";
  sidebar.style.boxShadow = "0 2px 15px rgba(0, 0, 0, 0.1)";
  sidebar.style.zIndex = "9999";
  sidebar.style.transition = "right 0.3s ease-out";
  sidebar.style.paddingTop = "30px";
  sidebar.style.paddingBottom = "15px";
  sidebar.style.paddingLeft = "35px";
  sidebar.style.paddingRight = "25px";
  sidebar.style.justifyContent = "center";
  sidebar.style.display = "flex";
  sidebar.style.alignItems = "center";
  sidebar.style.flexDirection = "column";
  sidebar.style.overflow = "auto";
  sidebar.style.boxSizing = "border-box";
  sidebar.style.fontSize = "15px";
  sidebar.style.color = darkMode ? "#FFF" : "#222"; 

  function showSidebar() {
    sidebar.style.right = "60px";
    modeButton.style.transform = "translate(0, -180%)";
    fixButton.style.transform = "translate(0, 75%)";
  }

  function hideSidebar() {
    sidebar.style.right = "-100%";
    modeButton.style.transform = "translate(110%, -180%)";
    fixButton.style.transform = "translate(110%, 75%)";
  }

  const videoId = /\/video\/(BV\w+)/.exec(window.location.href)[1];

  GM_xmlhttpRequest({
    method: "POST",
    url: "https://b.jimmylv.cn/api/summarize",
    headers: {
      "Content-Type": "application/json",
    },
    data: JSON.stringify({
      bvId: videoId,
      apiKey: "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",
    }),
    onload: function (response) {
      if (response.responseText === "No subtitle in the video") {
        hideSidebar();
      } else {
        sidebar.innerHTML = marked(JSON.parse(response.responseText));
        showSidebar();
        sidebar.querySelectorAll("li").forEach((li) => {
          li.style.marginBottom = "18px";
        });
      }
    },
  });

  document.body.appendChild(sidebar);

  button.addEventListener("click", () => {
    if (sidebar.style.right === "-100%") {
      showSidebar();
    } else {
      hideSidebar();
    }
  });

  function savedarkMode() {
    localStorage.setItem("darkMode", darkMode);
  }

  modeButton.addEventListener("click", (event) => {
    event.preventDefault();
    darkMode = !darkMode;
    if (!darkMode) {
      button.style.background = "#FFFFFF";
      sidebar.style.backgroundColor = "rgba(255, 255, 255, 0.9)";
      sidebar.style.color = "#222";
      modeButton.style.background = "#FFFFFF";
      fixButton.style.background = "#FFFFFF";
      button.innerHTML =
        '<svg t="1677926168943" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6698" width="22" height="22" style="transform: translateY(1.5px)"><path d="M477.090909 162.909091V116.363636c0-18.618182 16.290909-34.909091 34.909091-34.909091s34.909091 16.290909 34.909091 34.909091v46.545455c0 18.618182-16.290909 34.909091-34.909091 34.909091s-34.909091-16.290909-34.909091-34.909091zM256 283.927273c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872728l-32.581818-32.581818c-13.963636-16.290909-37.236364-16.290909-51.2-2.327272s-13.963636 34.909091 0 48.872727l32.581818 34.909091z m-69.818182 169.890909H139.636364c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m69.818182 239.709091l-32.581818 32.581818c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872727s-37.236364-11.636364-51.2 0z m349.090909 86.109091h-186.181818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.90909h186.181818c18.618182 0 34.909091-16.290909 34.909091-34.90909s-16.290909-34.909091-34.909091-34.909091z m-46.545454 93.090909h-93.09091c-18.618182 0-34.909091 16.290909-34.90909 34.909091s16.290909 34.909091 34.90909 34.909091h93.09091c18.618182 0 34.909091-16.290909 34.90909-34.909091s-16.290909-34.909091-34.90909-34.909091z m209.454545-179.2c-13.963636-13.963636-34.909091-13.963636-48.872727 0s-13.963636 34.909091 0 48.872727l32.581818 32.581818c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872727L768 693.527273z m116.363636-239.709091h-46.545454c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m-141.963636-160.581818c9.309091 0 18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872728s-34.909091-13.963636-48.872727 0L716.8 232.727273c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 9.309091 16.290909 11.636364 25.6 11.636364zM512 232.727273c-141.963636 0-256 114.036364-256 256s114.036364 256 256 256 256-114.036364 256-256-114.036364-256-256-256z" fill="#707070" p-id="6699"></path></svg>';
      modeButton.innerHTML =
        '<svg t="1677925762871" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20150" width="16" height="16" style="transform: translateY(1.5px)"><path d="M399.61 49.951C399.61 22.353 377.257 0 349.659 0 274.607 0 0 209.845 0 499.512 0 789.18 234.82 1024 524.488 1024 814.155 1024 1024 747.47 1024 674.341c0-27.598-22.353-49.95-49.951-49.95s-301.181 67.683-472.014-103.15C331.202 350.408 399.61 77.549 399.61 49.951z" p-id="20151" data-spm-anchor-id="a313x.7781069.0.i59" class="selected" fill="#707070"></path></svg>';
      fixButton.innerHTML = fixedMode
        ? '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#707070"></path></svg>'
        : '<svg t="1677926529299" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#707070"></path></svg>';
    } else {
      button.style.background = "#111";
      sidebar.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
      sidebar.style.color = "#FFF";
      modeButton.style.background = "#111";
      fixButton.style.background = "#111";
      button.innerHTML =
        '<svg t="1677926168943" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6698" width="22" height="22" style="transform: translateY(1.5px)"><path d="M477.090909 162.909091V116.363636c0-18.618182 16.290909-34.909091 34.909091-34.909091s34.909091 16.290909 34.909091 34.909091v46.545455c0 18.618182-16.290909 34.909091-34.909091 34.909091s-34.909091-16.290909-34.909091-34.909091zM256 283.927273c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872728l-32.581818-32.581818c-13.963636-16.290909-37.236364-16.290909-51.2-2.327272s-13.963636 34.909091 0 48.872727l32.581818 34.909091z m-69.818182 169.890909H139.636364c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m69.818182 239.709091l-32.581818 32.581818c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872727s-37.236364-11.636364-51.2 0z m349.090909 86.109091h-186.181818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.90909h186.181818c18.618182 0 34.909091-16.290909 34.909091-34.90909s-16.290909-34.909091-34.909091-34.909091z m-46.545454 93.090909h-93.09091c-18.618182 0-34.909091 16.290909-34.90909 34.909091s16.290909 34.909091 34.90909 34.909091h93.09091c18.618182 0 34.909091-16.290909 34.90909-34.909091s-16.290909-34.909091-34.90909-34.909091z m209.454545-179.2c-13.963636-13.963636-34.909091-13.963636-48.872727 0s-13.963636 34.909091 0 48.872727l32.581818 32.581818c6.981818 6.981818 16.290909 9.309091 25.6 9.309091s18.618182-2.327273 25.6-9.309091c13.963636-13.963636 13.963636-34.909091 0-48.872727L768 693.527273z m116.363636-239.709091h-46.545454c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h46.545454c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z m-141.963636-160.581818c9.309091 0 18.618182-2.327273 25.6-9.309091l32.581818-32.581818c13.963636-13.963636 13.963636-34.909091 0-48.872728s-34.909091-13.963636-48.872727 0L716.8 232.727273c-13.963636 13.963636-13.963636 34.909091 0 48.872727 6.981818 9.309091 16.290909 11.636364 25.6 11.636364zM512 232.727273c-141.963636 0-256 114.036364-256 256s114.036364 256 256 256 256-114.036364 256-256-114.036364-256-256-256z" fill="#e6e6e6" p-id="6699"></path></svg>';
      modeButton.innerHTML =
        '<svg t="1677925762871" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20150" width="16" height="16" style="transform: translateY(1.5px)"><path d="M399.61 49.951C399.61 22.353 377.257 0 349.659 0 274.607 0 0 209.845 0 499.512 0 789.18 234.82 1024 524.488 1024 814.155 1024 1024 747.47 1024 674.341c0-27.598-22.353-49.95-49.951-49.95s-301.181 67.683-472.014-103.15C331.202 350.408 399.61 77.549 399.61 49.951z" p-id="20151" data-spm-anchor-id="a313x.7781069.0.i59" class="selected" fill="#e6e6e6"></path></svg>';
      fixButton.innerHTML = fixedMode
        ? '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#e6e6e6"></path></svg>'
        : '<svg t="1677926529299" class="icon"style="pointer-events:none;"  viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#e6e6e6"></path></svg>';
    }
    savedarkMode();
  });
  document.addEventListener("keydown", (event) => {
    if (
      event.code === "KeyZ" &&
      !event.ctrlKey &&
      !event.shiftKey &&
      !event.altKey &&
      !event.metaKey
    ) {
      const activeElement = document.activeElement;
      const tagName = activeElement.tagName.toLowerCase();
      const isContentEditable = activeElement.contentEditable === "true";
      if (tagName !== "input" && tagName !== "textarea" && !isContentEditable) {
        if (sidebar.style.right === "-100%") {
          showSidebar();
        } else {
          hideSidebar();
        }
      }
    }
  });

  function saveFixedMode() {
    localStorage.setItem("fixedMode", fixedMode);
  }

  fixButton.addEventListener("click", () => {
    event.preventDefault();
    fixedMode = !fixedMode;
    if (fixedMode) {
      fixButton.innerHTML = darkMode
        ? '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#e6e6e6"></path></svg>'
        : '<svg t="1677926530729" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1482" width="18" height="18" style="transform: translateY(1.5px)"><path d="M385.150849 385.662338l-128.895105 0 0-150.377622q0-49.102897 19.436563-91.556444t53.706294-74.677323 80.815185-50.637363 101.786214-18.413586q49.102897 0 94.625375 18.413586t80.815185 50.637363 56.263736 74.677323 20.971029 91.556444l0 150.377622-123.78022 0 0-121.734266q0-64.447552-35.804196-99.74026t-97.182817-35.292707q-55.240759 0-88.999001 35.292707t-33.758242 99.74026l0 121.734266zM826.053946 447.040959q27.62038 0 47.568432 19.948052t19.948052 47.568432l0 317.122877q0 27.62038-9.718282 51.66034t-26.597403 41.942058-39.896104 28.131868-50.637363 10.22977l-516.603397 0q-27.62038 0-50.125874-10.22977t-38.361638-27.108891-24.551449-39.384615-8.695305-48.07992l0-324.283716q0-27.62038 19.436563-47.568432t47.056943-19.948052l61.378621 0 128.895105 0 255.744256 0 123.78022 0 61.378621 0z" p-id="1483" fill="#707070"></path></svg>';
    } else {
      fixButton.innerHTML = darkMode
        ? '<svg t="1677926529299" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#e6e6e6"></path></svg>'
        : '<svg t="1677926529299" class="icon" style="pointer-events:none;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9150" width="17" height="17" style="transform: translateY(1.5px)"><path d="M768.25422 0q48.810328 0 94.061569 18.303873t80.333664 50.33565 56.436941 74.740814 21.354518 91.519364l0 150.49851-123.042701 0 0-122.025819q0-64.063555-36.099305-99.654419t-97.112214-35.590864q-54.911619 0-88.468719 35.590864t-33.5571 99.654419l0 124.059583-128.12711 0 0-152.532274q0-48.810328 19.320755-91.519364t53.386296-74.740814 80.333664-50.33565 101.179742-18.303873zM766.220457 693.513406l0 87.451837 0 47.793446q0 27.455809-9.660377 51.860973t-26.438928 41.692155-39.658391 27.455809-50.33565 10.168818l-514.542205 0q-27.455809 0-49.82721-9.660377t-38.641509-26.438928-24.913605-39.14995-8.643496-47.793446l0-323.368421q0-28.472691 19.829196-47.793446t46.268123-19.320755l629.449851 0q28.472691 0 47.793446 19.320755t19.320755 47.793446l0 179.988083z" p-id="9151" fill="#707070"></path></svg>';
    }
    saveFixedMode();
  });

  document.addEventListener("click", (event) => {
    const target = event.target;
    if (target !== sidebar && target !== button && target !== modeButton && target !== fixButton && !fixedMode) {
      hideSidebar();
    }
  });
})();
