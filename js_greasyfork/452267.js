// ==UserScript==
// @name   ‰∏çÂ≠¶‰π†‰Ωï‰ª•Âº∫ÂõΩ
// @namespace   https://greasyfork.org/zh-CN/users/714887-%E7%A8%8B%E9%B9%8F233
// @version   20220930
// @icon   data:image/jpeg;base64,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
// @homepage  https://cpddd.tk/
// @description  `Â≠¶‰π†Âº∫ÂõΩ` ËØªÊñáÁ´†,ÁúãËßÜÈ¢ëÔºåÂÅö‰π†È¢ò„ÄÇ
// @author  Á®ãÈπè
// @match   https://www.xuexi.cn/*
// @match   https://pc.xuexi.cn/points/exam-practice.html
// @match   https://pc.xuexi.cn/points/exam-weekly-detail.html?id=*
// @match   https://pc.xuexi.cn/points/exam-paper-detail.html?id=*
// @require   https://cdn.jsdelivr.net/npm/blueimp-md5@2.9.0
// @original-script https://github.com/Xu22Web/tech-study-js
// @original-author Xu22Web
// @license MIT
// @run-at   document-start
// @grant   GM_addStyle
// @grant   GM_setValue
// @grant   GM_getValue
// @grant   GM_deleteValue
// @grant   GM_openInTab
// @downloadURL https://update.greasyfork.org/scripts/452267/%E4%B8%8D%E5%AD%A6%E4%B9%A0%E4%BD%95%E4%BB%A5%E5%BC%BA%E5%9B%BD.user.js
// @updateURL https://update.greasyfork.org/scripts/452267/%E4%B8%8D%E5%AD%A6%E4%B9%A0%E4%BD%95%E4%BB%A5%E5%BC%BA%E5%9B%BD.meta.js
// ==/UserScript==
/***
 *                    _ooOoo_
 *                   o8888888o
 *                   88" . "88
 *                   (| -_- |)
 *                    O\ = /O
 *                ____/`---'\____
 *              .   ' \\| |// `.
 *               / \\||| : |||// \
 *             / _||||| -:- |||||- \
 *               | | \\\ - /// | |
 *             | \_| ''\---/'' | |
 *              \ .-\__ `-` ___/-. /
 *           ___`. .' /--.--\ `. . __
 *        ."" '< `.___\_<|>_/___.' >'"".
 *       | | : `- \`.;`\ _ /`;.`/ - ` : | |
 *         \ \ `-. \_ __\ /__ _/ .-` / /
 * ======`-.____`-.___\_____/___.-`____.-'======
 *                    `=---='
 *
 * .............................................
 *üôè‰ΩõÁ•ñ‰øù‰Ωë  Ê∞∏Êó†BUG  Âà∑ËØæ‰∏çË¢´Êäì  ÊåÇÁßëÊØî‰∏çÊåÇÊüØÂçóüôè
 */
/**
 * @description urlÈÖçÁΩÆ
 */
const URL_CONFIG = {
    // ‰∏ªÈ°µ
    home: /^https\:\/\/www\.xuexi\.cn(\/(index\.html)?)?$/,
    // ÊØèÊó•Á≠îÈ¢òÈ°µÈù¢
    examPractice: 'https://pc.xuexi.cn/points/exam-practice.html',
    // ÊØèÂë®Á≠îÈ¢òÈ°µÈù¢
    examWeekly: 'https://pc.xuexi.cn/points/exam-weekly-detail.html',
    // ‰∏ìÈ°πÁªÉ‰π†È°µÈù¢
    examPaper: 'https://pc.xuexi.cn/points/exam-paper-detail.html',
    // ÁôªÂΩïÁïåÈù¢
    login: 'https://login.xuexi.cn/login/xuexiWeb?appid=dingoankubyrfkttorhpou&goto=https%3A%2F%2Foa.xuexi.cn&type=1&state=ffdea2ded23f45ab%2FKQreTlDFe1Id3B7BVdaaYcTMp6lsTBB%2Fs3gGevuMKfvpbABDEl9ymG3bbOgtpSN&check_login=https%3A%2F%2Fpc-api.xuexi.cn',
};


/**
 * @description apiÈÖçÁΩÆ
 */
const API_CONFIG = {
    // Áî®Êà∑‰ø°ÊÅØ
    userInfo: 'https://pc-api.xuexi.cn/open/api/user/info',
    // ÊÄªÂàÜ
    totalScore: 'https://pc-api.xuexi.cn/open/api/score/get',
    // ÂΩìÂ§©ÂàÜÊï∞
    todayScore: 'https://pc-api.xuexi.cn/open/api/score/today/query',
    // ‰ªªÂä°ÂàóË°®
    taskList: 'https://pc-proxy-api.xuexi.cn/api/score/days/listScoreProgress?sence=score&deviceType=2',
    // Êñ∞ÈóªÊï∞ÊçÆ
    todayNews: [
        'https://www.xuexi.cn/lgdata/1jscb6pu1n2.json',
        'https://www.xuexi.cn/lgdata/1ap1igfgdn2.json',
        'https://www.xuexi.cn/lgdata/35il6fpn0ohq.json',
    ],
    // ËßÜÈ¢ëÊï∞ÊçÆ
    todayVideos: [
        'https://www.xuexi.cn/lgdata/525pi8vcj24p.json',
        'https://www.xuexi.cn/lgdata/11vku6vt6rgom.json',
        'https://www.xuexi.cn/lgdata/2qfjjjrprmdh.json',
        'https://www.xuexi.cn/lgdata/3o3ufqgl8rsn.json',
        'https://www.xuexi.cn/lgdata/591ht3bc22pi.json',
    ],
    // ÊØèÂë®Á≠îÈ¢òÂàóË°®
    weeklyList: 'https://pc-proxy-api.xuexi.cn/api/exam/service/practice/pc/weekly/more',
    // ‰∏ìÈ°πÁªÉ‰π†ÂàóË°®
    paperList: 'https://pc-proxy-api.xuexi.cn/api/exam/service/paper/pc/list',
    // ÊñáÊú¨ÊúçÂä°Âô®‰øùÂ≠òÁ≠îÊ°à
    answerSave: 'https://a6.qikekeji.com/txt/data/save',
    // ÊñáÊú¨ÊúçÂä°Âô®Ëé∑ÂèñÁ≠îÊ°à
    answerSearch: 'https://api.answer.uu988.xyz:4545/answer/search',
};


/**
 * @description Ëé∑Âèñcookie
 * @param name
 * @returns
 */
function getCookie(name) {
    // Ëé∑ÂèñÂΩìÂâçÊâÄÊúâcookie
    const strCookies = document.cookie;
    // Êà™ÂèñÂèòÊàêcookieÊï∞ÁªÑ
    const cookieText = strCookies.split(';');
    // Âæ™ÁéØÊØè‰∏™cookie
    for (const i in cookieText) {
        // Â∞ÜcookieÊà™ÂèñÊàê‰∏§ÈÉ®ÂàÜ
        const item = cookieText[i].split('=');
        // Âà§Êñ≠cookieÁöÑname ÊòØÂê¶Áõ∏Á≠â
        if (item[0].trim() === name) {
            return item[1].trim();
        }
    }
    return null;
}
/**
 * @description Èò≤Êäñ
 * @param callback
 * @param delay
 * @returns
 */
function debounce(callback, delay) {
    let timer = -1;
    return function (...args) {
        if (timer !== -1) {
            clearTimeout(timer);
        }
        timer = setTimeout(() => {
            callback.apply(this, args);
        }, delay);
    };
}
/**
 * @description ÈÄâÊã©Âô®
 * @param selector
 * @returns
 */
function $$(selector) {
    return Array.from(document.querySelectorAll(selector));
}
/**
 * @description ÂÖ≥Èó≠Â≠êÁ™óÂè£
 */
function closeWin() {
    try {
        window.opener = window;
        const win = window.open('', '_self');
        win?.close();
        top?.close();
    }
    catch (e) { }
}
/**
 * @description Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
 * @param newPage
 * @returns
 */
function waitingClose(newPage) {
    return new Promise((resolve) => {
        const doing = setInterval(() => {
            if (newPage.closed) {
                clearInterval(doing); // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                resolve('done');
            }
        }, 500);
    });
}
/**
 * @description Á≠âÂæÖÊó∂Èó¥
 * @param time
 * @returns
 */
function waitingTime(time) {
    if (!Number.isInteger(time)) {
        time = 500;
    }
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve('done');
        }, time);
    });
}
/**
 * @description Âà§Êñ≠ÊòØÂê¶‰∏∫ÁßªÂä®Á´Ø
 * @returns
 */
function hasMobile() {
    let isMobile = false;
    if (navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
        console.log('ÁßªÂä®Á´Ø');
        isMobile = true;
    }
    if (document.body.clientWidth < 800) {
        console.log('Â∞èÂ∞∫ÂØ∏ËÆæÂ§áÁ´Ø');
        isMobile = true;
    }
    return isMobile;
}
/**
 * @description Â∞Ü GET ËØ∑Ê±ÇÂèÇÊï∞ÊèíÂÖ• URL
 * @param url
 * @param params
 * @returns
 */
function stringfyParamsURL(url, params) {
    // ÂèÇÊï∞Âêç
    const keys = Object.keys(params);
    // ÂèÇÊï∞ÂêçÂ≠òÂú®
    if (keys.length) {
        // ÂÆåÊï¥ÈìæÊé•
        const fullURL = `${url}?${keys
            .filter((key) => key.length)
            .map((key) => `${key}=${params[key]}`)
            .join('&')}`;
        return fullURL;
    }
    return url;
}
/**
 * @description ÂàõÂª∫ÂÖÉÁ¥†ËäÇÁÇπ
 * @param eleName
 * @param props
 * @param attrs
 * @param children
 * @returns
 */
function creatElementNode(eleName, props, attrs, children) {
    // ÂÖÉÁ¥†
    let ele;
    // Ê†ºÂºèÂåñÂÖÉÁ¥†Âêç
    const formatEleName = eleName.toLowerCase();
    // ÈúÄË¶ÅÂëΩÂêçÁ©∫Èó¥ÁöÑsvgÂÖÉÁ¥†
    const specficSVGElement = [
        'svg',
        'use',
        'circle',
        'rect',
        'line',
        'marker',
        'linearGradient',
        'g',
        'path',
    ];
    // ÈúÄË¶ÅÂëΩÂêçÁ©∫Èó¥ÁöÑhtmlÂÖÉÁ¥†
    const specficHTMLElement = 'html';
    if (formatEleName === specficHTMLElement) {
        // htmlÂÖÉÁ¥†ÂëΩÂêçÁ©∫Èó¥
        const ns = 'http://www.w3.org/1999/xhtml';
        // ÂàõÂª∫ÊôÆÈÄöÂÖÉÁ¥†
        ele = document.createElementNS(ns, formatEleName);
    }
    else if (specficSVGElement.includes(formatEleName)) {
        // svgÂÖÉÁ¥†ÂëΩÂêçÁ©∫Èó¥
        const ns = 'http://www.w3.org/2000/svg';
        // ÂàõÂª∫ÊôÆÈÄöÂÖÉÁ¥†
        ele = document.createElementNS(ns, formatEleName);
    }
    else {
        // ÂàõÂª∫ÊôÆÈÄöÂÖÉÁ¥†
        ele = document.createElement(formatEleName);
    }
    // propsÂ±ûÊÄßËÆæÁΩÆ
    for (const key in props) {
        if (props[key] instanceof Object) {
            for (const subkey in props[key]) {
                ele[key][subkey] = props[key][subkey];
            }
        }
        else {
            ele[key] = props[key];
        }
    }
    // attrsÂ±ûÊÄßËÆæÁΩÆ
    for (const key in attrs) {
        // Â±ûÊÄßÂÄº
        const value = attrs[key];
        // Â§ÑÁêÜÂÆåÁöÑkey
        const formatKey = key.toLowerCase();
        // xlinkÂëΩÂêçÁ©∫Èó¥
        if (formatKey.startsWith('xlink:')) {
            // xlinkÂ±ûÊÄßÂëΩÂêçÁ©∫Èó¥
            const attrNS = 'http://www.w3.org/1999/xlink';
            if (value) {
                ele.setAttributeNS(attrNS, key, value);
            }
            else {
                ele.removeAttributeNS(attrNS, key);
            }
        }
        else if (formatKey.startsWith('on')) {
            // ‰∫ã‰ª∂ÁõëÂê¨
            const [, eventType] = key.toLowerCase().split('on');
            // ‰∫ã‰ª∂Á±ªÂûã
            if (eventType) {
                // ÂõûË∞ÉÂáΩÊï∞
                if (value instanceof Function) {
                    ele.addEventListener(eventType, value);
                    // ÂõûË∞ÉÂáΩÊï∞Êï∞ÁªÑ
                }
                else if (value instanceof Array) {
                    for (const i in value) {
                        // ÂõûË∞ÉÂáΩÊï∞
                        if (value[i] instanceof Function) {
                            ele.addEventListener(eventType, value[i]);
                        }
                    }
                }
            }
        }
        else {
            // ÁâπÊÆäÂ±ûÊÄß
            const specificAttrs = ['checked', 'selected', 'disabled', 'enabled'];
            if (specificAttrs.includes(key) && value) {
                ele.setAttribute(key, '');
            }
            else {
                if (value) {
                    ele.setAttribute(key, value);
                }
                else {
                    ele.removeAttribute(key);
                }
            }
        }
    }
    // Â≠êËäÇÁÇπ
    if (children) {
        if (children instanceof Array) {
            if (children.length === 1) {
                ele.append(children[0]);
            }
            else {
                // ÊñáÊ°£Á¢éÁâá
                const fragment = document.createDocumentFragment();
                for (const i in children) {
                    fragment.append(children[i]);
                }
                ele.append(fragment);
            }
        }
        else {
            ele.append(children);
        }
    }
    return ele;
}
/**
 * @description ÂàõÂª∫ÊñáÂ≠óËäÇÁÇπ
 * @param text
 * @returns
 */
function createTextNode(...text) {
    if (text && text.length === 1) {
        return document.createTextNode(text[0]);
    }
    const fragment = document.createDocumentFragment();
    for (const i in text) {
        const textEle = document.createTextNode(text[i]);
        fragment.append(textEle);
    }
    return fragment;
}


const css = ':root {\n  --themeColor: #fa3333;\n  --scale: 1;\n  font-size: calc(10px * var(--scale));\n}\n.icon {\n  width: 1em;\n  height: 1em;\n  vertical-align: -0.15em;\n  fill: currentColor;\n  overflow: hidden;\n}\n.egg_btn {\n  transition: 0.5s;\n  outline: none;\n  border: none;\n  padding: 1.2rem 2rem;\n  border-radius: 1.2rem;\n  cursor: pointer;\n  font-size: 1.8rem;\n  font-weight: bold;\n  text-align: center;\n  color: rgb(255, 255, 255);\n  background: #666777;\n}\n.egg_btn.manual {\n  background: #e3484b;\n}\n.egg_setting_box {\n  position: fixed;\n  top: 7rem;\n  left: 1rem;\n  padding: 1.2rem 2rem;\n  border-radius: 1rem;\n  background: #fff;\n  box-shadow: 0 0 0.4rem 0.1rem #ccc;\n  transition: 80ms ease-out;\n  z-index: 99999;\n}\n.egg_setting_box hr {\n  height: 0.1rem;\n  border: none;\n  background: #eee;\n}\n.egg_setting_item {\n  margin-top: 0.5rem;\n  min-height: 3rem;\n  min-width: 20rem;\n  font-size: 1.6rem;\n  display: flex;\n  justify-items: center;\n  justify-content: space-between;\n}\n.egg_info {\n  flex-direction: column;\n}\n.egg_userinfo {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.egg_login_status {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.egg_login_status button {\n  outline: none;\n  padding: 0.4rem 0.8rem;\n  background: #ccc;\n  font-size: 1.4rem;\n  border: none;\n  border-radius: 1rem;\n  color: white;\n  cursor: pointer;\n}\n.egg_login_status.active {\n  flex-grow: 1;\n}\n.egg_login_status.active button {\n  background: var(--themeColor);\n  padding: 0.8rem 2.4rem;\n}\n.egg_userinfo .egg_user {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0.5rem 0;\n}\n.egg_userinfo .egg_user .egg_sub_nickname,\n.egg_userinfo .egg_user .egg_avatar_img {\n  height: 5rem;\n  width: 5rem;\n  border-radius: 50%;\n  background: var(--themeColor);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  font-size: 2rem;\n  color: white;\n}\n.egg_userinfo .egg_user .egg_name {\n  padding-left: 0.5rem;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  max-width: 10rem;\n}\n.egg_scoreinfo {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 0.8rem;\n}\n.egg_scoreinfo .egg_totalscore,\n.egg_scoreinfo .egg_todayscore {\n  font-size: 1.2rem;\n}\n.egg_scoreinfo span {\n  color: var(--themeColor);\n  padding-left: 0.4rem;\n  font-weight: bold;\n}\n.egg_setting_item label {\n  flex-grow: 1;\n}\n.egg_progress {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0;\n}\n.egg_progress .egg_track {\n  background: #ccc;\n  height: 0.5rem;\n  border-radius: 1rem;\n  flex: 1 1 auto;\n  overflow: hidden;\n  box-shadow: -0.1rem 0.1rem 0.1rem -0.1rem #999 inset,\n    0.1rem 0.1rem 0.1rem -0.1rem #999 inset;\n}\n.egg_progress .egg_track .egg_bar {\n  height: 0.5rem;\n  background: var(--themeColor);\n  border-radius: 1rem;\n  width: 0;\n  transition: width 0.5s;\n}\n.egg_progress .egg_percent {\n  font-size: 1.2rem;\n  padding-left: 0.5rem;\n  width: 3.5rem;\n}\ninput[type=\'checkbox\'].egg_setting_switch {\n  cursor: pointer;\n  margin: 0;\n  outline: 0;\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  position: relative;\n  width: 4.2rem;\n  height: 2.2rem;\n  background: #ccc;\n  border-radius: 5rem;\n  transition: background 0.3s;\n  --border-padding: 0.5rem;\n  box-shadow: -0.1rem 0 0.1rem -0.1rem #999 inset,\n    0.1rem 0 0.1rem -0.1rem #999 inset;\n}\ninput[type=\'checkbox\'].egg_setting_switch::after {\n  content: \'\';\n  display: inline-block;\n  width: 1.4rem;\n  height: 1.4rem;\n  border-radius: 50%;\n  background: #fff;\n  box-shadow: 0 0 0.2rem #999;\n  transition: 0.4s;\n  position: absolute;\n  top: calc(50% - (1.4rem / 2));\n  position: absolute;\n  left: var(--border-padding);\n}\ninput[type=\'checkbox\'].egg_setting_switch:checked {\n  background: var(--themeColor);\n}\ninput[type=\'checkbox\'].egg_setting_switch:checked::after {\n  left: calc(100% - var(--border-padding) - 1.4rem);\n}\n.egg_start_btn {\n  justify-content: center;\n}\n.egg_study_btn {\n  outline: none;\n  background: var(--themeColor);\n  padding: 0.8rem 2.4rem;\n  font-size: 1.4rem;\n  border: none;\n  border-radius: 1rem;\n  color: white;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.egg_study_btn:hover {\n  opacity: 0.8;\n}\n@keyframes fade {\n  from {\n    opacity: 0.8;\n  }\n  to {\n    opacity: 0.4;\n    background: #ccc;\n  }\n}\n.egg_study_btn.loading {\n  animation: fade 2s ease infinite alternate;\n}\n.egg_study_btn.disabled {\n  background: #ccc;\n}\n.egg_tip {\n  position: fixed;\n  bottom: 2rem;\n  left: 2rem;\n  padding: 1.2rem 1.4rem;\n  border: none;\n  border-radius: 1rem;\n  background: #222222;\n  color: #ffffff;\n  font-size: 1.4rem;\n  font-weight: bold;\n  transition: all 0.8s ease;\n  opacity: 0;\n  transform: scale(0.9) translateY(10px);\n}\n.egg_tip.active {\n  opacity: 1;\n  transform: scale(1) translateY(0);\n}\n.egg_frame {\n  position: relative;\n  box-sizing: border-box;\n  margin: 0 auto;\n}\n.egg_frame.active {\n  padding: 4px;\n  width: 21.8rem;\n  height: 21.8rem;\n  overflow: hidden;\n}\n.egg_frame .egg_frame_login {\n  position: absolute;\n  left: -6.9rem;\n  top: -2.6rem;\n}\n.egg_frame iframe {\n  width: 284px;\n  height: 241px;\n  border: none;\n  transform: scale(var(--scale));\n  transform-origin: top left;\n}\n';
// ÂµåÂÖ•Ê†∑Âºè
GM_addStyle(css);
/* Config¬∑ÈÖçÁΩÆ */
// ÊØèÂë®Á≠îÈ¢òÂºÄÂêØÈÄÜÂ∫èÁ≠îÈ¢ò: false: È°∫Â∫èÁ≠îÈ¢ò; true: ÈÄÜÂ∫èÁ≠îÈ¢ò
const examWeeklyReverse = true;
// ‰∏ìÈ°πÁ≠îÈ¢òÂºÄÂêØÈÄÜÂ∫èÁ≠îÈ¢ò: false: È°∫Â∫èÁ≠îÈ¢ò; true: ÈÄÜÂ∫èÁ≠îÈ¢ò
const examPaperReverse = true;
//  Á≠îÈ¢òËØ∑Ê±ÇÈÄüÁéáÈôêÂà∂
const ratelimitms = 1000;
// ÂçïÊ¨°ÊúÄÂ§ßÊñ∞ÈóªÊï∞
const maxNewsNum = 6;
// ÂçïÊ¨°ÊúÄÂ§ßËßÜÈ¢ëÊï∞
const maxVideoNum = 6;
/* Config End¬∑ÈÖçÁΩÆÁªìÊùü */
/* Tools¬∑Â∑•ÂÖ∑ÂáΩÊï∞  */
// ÊöÇÂÅúÈîÅ
function pauseLock(callback) {
    return new Promise((resolve) => {
        if (pause) {
            const doing = setInterval(() => {
                if (!pause) {
                    // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                    clearInterval(doing);
                    console.log('Á≠îÈ¢òÁ≠âÂæÖÁªìÊùüÔºÅ');
                    if (callback && callback instanceof Function) {
                        callback('done');
                    }
                    resolve('done');
                    return;
                }
                if (callback && callback instanceof Function) {
                    callback('pending');
                }
                console.log('Á≠îÈ¢òÁ≠âÂæÖ...');
            }, 500);
            return;
        }
        resolve('done');
    });
}
// ÊöÇÂÅúÂ≠¶‰π†ÈîÅ
function pauseStudyLock(callback) {
    return new Promise((resolve) => {
        if (pauseStudy) {
            const doing = setInterval(() => {
                if (!pauseStudy) {
                    // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                    clearInterval(doing);
                    console.log('Â≠¶‰π†Á≠âÂæÖÁªìÊùüÔºÅ');
                    if (callback && callback instanceof Function) {
                        callback('done');
                    }
                    resolve('done');
                    return;
                }
                if (callback && callback instanceof Function) {
                    callback('pending');
                }
                console.log('Â≠¶‰π†Á≠âÂæÖ...');
            }, 500);
            return;
        }
        resolve('done');
    });
}
/* Tools End¬∑Â∑•ÂÖ∑ÂáΩÊï∞ÁªìÊùü */
/* APIËØ∑Ê±ÇÂáΩÊï∞ */
// Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
async function getUserInfo() {
    try {
        const res = await fetch(API_CONFIG.userInfo, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const { data } = await res.json();
            return data;
        }
    }
    catch (err) { }
}
// Ëé∑ÂèñÊÄªÁßØÂàÜ
async function getTotalScore() {
    try {
        const res = await fetch(API_CONFIG.totalScore, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const { data } = await res.json();
            // ÊÄªÂàÜ
            const { score } = data;
            return score;
        }
    }
    catch (err) { }
}
// Ëé∑ÂèñÂΩìÂ§©ÊÄªÁßØÂàÜ
async function getTodayScore() {
    try {
        const res = await fetch(API_CONFIG.todayScore, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const { data } = await res.json();
            // ÂΩìÂ§©ÊÄªÂàÜ
            const { score } = data;
            return score;
        }
    }
    catch (err) { }
}
// Ëé∑Âèñ‰ªªÂä°ÂàóË°®
async function getTaskList() {
    try {
        const res = await fetch(API_CONFIG.taskList, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const { data } = await res.json();
            // ËøõÂ∫¶ÂíåÂΩìÂ§©ÊÄªÂàÜ
            const { taskProgress } = data;
            return taskProgress;
        }
    }
    catch (err) { }
}
// Ëé∑ÂèñÊñ∞ÈóªÊï∞ÊçÆ
async function getTodayNews() {
    // ÈöèÊú∫
    const randNum = ~~(Math.random() * API_CONFIG.todayNews.length);
    try {
        // Ëé∑ÂèñÈáçË¶ÅÊñ∞Èóª
        const res = await fetch(API_CONFIG.todayNews[randNum], {
            method: 'GET',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const data = await res.json();
            return data;
        }
    }
    catch (err) { }
}
// Ëé∑ÂèñËßÜÈ¢ëÊï∞ÊçÆ
async function getTodayVideos() {
    // ÈöèÊú∫
    const randNum = ~~(Math.random() * API_CONFIG.todayVideos.length);
    try {
        // Ëé∑ÂèñÈáçË¶ÅÊñ∞Èóª
        const res = await fetch(API_CONFIG.todayVideos[randNum], {
            method: 'GET',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const data = await res.json();
            return data;
        }
    }
    catch (err) { }
}
// ‰∏ìÈ°πÁªÉ‰π†Êï∞ÊçÆ
async function getExamPaper(pageNo) {
    // ÈìæÊé•
    const url = `${API_CONFIG.paperList}?pageSize=50&pageNo=${pageNo}`;
    try {
        // Ëé∑Âèñ‰∏ìÈ°πÁªÉ‰π†
        const res = await fetch(url, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const data = await res.json();
            const paperJson = decodeURIComponent(escape(window.atob(data.data_str.replace(/-/g, '+').replace(/_/g, '/'))));
            // JSONÊ†ºÂºèÂåñ
            const paper = JSON.parse(paperJson);
            return paper;
        }
    }
    catch (err) {
        return [];
    }
    return [];
}
// ÊØèÂë®Á≠îÈ¢òÊï∞ÊçÆ
async function getExamWeekly(pageNo) {
    // ÈìæÊé•
    const url = `${API_CONFIG.weeklyList}?pageSize=50&pageNo=${pageNo}`;
    try {
        // Ëé∑ÂèñÊØèÂë®Á≠îÈ¢ò
        const res = await fetch(url, {
            method: 'GET',
            credentials: 'include',
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const data = await res.json();
            const paperJson = decodeURIComponent(escape(window.atob(data.data_str.replace(/-/g, '+').replace(/_/g, '/'))));
            // JSONÊ†ºÂºèÂåñ
            const paper = JSON.parse(paperJson);
            return paper;
        }
    }
    catch (err) {
        return [];
    }
    return [];
}
// Ëé∑ÂèñÁ≠îÊ°à
async function getAnswer(question) {
    console.log('Ëé∑ÂèñÁΩëÁªúÁ≠îÊ°à');
    // Êï∞ÊçÆ
    const data = {
        question,
    };
    try {
        // ËØ∑Ê±Ç
        const res = await fetch(API_CONFIG.answerSearch, {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });
        // ËØ∑Ê±ÇÊàêÂäü
        if (res.ok) {
            const data = await res.json();
            // Áä∂ÊÄÅ
            const { errno } = data;
            if (errno !== -1) {
                // Á≠îÊ°à
                const { answers } = data.data;
                console.log('answers', answers);
                return answers;
            }
        }
    }
    catch (error) { }
    return [];
}
// ‰øùÂ≠òÁ≠îÊ°à
async function saveAnswer(key, value) {
    // ÂÜÖÂÆπ
    const content = JSON.stringify([{ title: key, content: value }]);
    // Êï∞ÊçÆ
    const data = {
        txt_name: key,
        txt_content: content,
        password: '',
        v_id: '',
    };
    // ËØ∑Ê±Ç‰Ωì
    const body = Object.keys(data)
        .map((key) => {
        return `${encodeURIComponent(key)}=${encodeURIComponent(data[key])}`;
    })
        .join('&');
    // ËØ∑Ê±Ç
    const res = await fetch(API_CONFIG.answerSave, {
        method: 'POST',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            Accept: 'application/json',
        },
        body,
    });
    // ËØ∑Ê±ÇÊàêÂäü
    if (res.ok) {
        try {
            const data = await res.json();
            return data;
        }
        catch (err) {
            return null;
        }
    }
    return null;
}
/* APIËØ∑Ê±ÇÂáΩÊï∞ÁªìÊùü */
/* ÂèòÈáè */
// ‰ªªÂä°ËøõÂ∫¶
const tasks = [];
// Ëé∑Âèñ URL
const { href } = window.location;
// ËÆæÁΩÆ
let settings = [true, true, true, true, true, false, false];
// Â∑≤ÁªèÂºÄÂßã
let started = false;
// ÊòØÂê¶ÊöÇÂÅúÁ≠îÈ¢ò
let pause = false;
// ÊòØÂê¶ÊöÇÂÅúÂ≠¶‰π†
let pauseStudy = false;
// ÂàùÂßãÂåñÁôªÂΩïÁä∂ÊÄÅ
let login = !!getCookie('token');
// Áî®Êà∑‰ø°ÊÅØ
let userInfo;
// Êñ∞Èóª
let news = [];
// ËßÜÈ¢ë
let videos = [];
// load
window.addEventListener('load', () => {
    console.log('Âä†ËΩΩËÑöÊú¨');
    // ‰∏ªÈ°µ
    if (URL_CONFIG.home.test(href)) {
        console.log('ËøõÂÖ•‰∏ªÈ°µÈù¢ÔºÅ');
        let ready = setInterval(() => {
            if ($$('.text-wrap')[0]) {
                // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                clearInterval(ready);
                // ËÆæÁΩÆÂ≠ó‰Ωì
                initFontSize();
                // ÂàùÂßãÂåñËÆæÁΩÆ
                initSetting();
                // Ê∏≤ÊüìËèúÂçï
                renderMenu();
            }
        }, 800);
    }
    else if (typeof GM_getValue('readingUrl') === 'string' &&
        href === GM_getValue('readingUrl')) {
        // ÂàùÂßãÂåñËÆæÁΩÆ
        initSetting();
        reading(0);
    }
    else if (typeof GM_getValue('watchingUrl') === 'string' &&
        href === GM_getValue('watchingUrl')) {
        // ÂàùÂßãÂåñËÆæÁΩÆ
        initSetting();
        let randNum = 0;
        const checkVideoPlayingInterval = setInterval(() => {
            let temp = getVideoTag();
            if (temp.video) {
                if (!temp.video.muted) {
                    temp.video.muted = true;
                }
                if (temp.video.paused) {
                    console.log('Ê≠£Âú®Â∞ùËØïÊí≠ÊîæËßÜÈ¢ë');
                    if (randNum === 0) {
                        // Â∞ùËØï‰ΩøÁî®jsÁöÑÊñπÂºèÊí≠Êîæ
                        try {
                            temp.video.play(); // Â∞ùËØï‰ΩøÁî®jsÁöÑÊñπÂºèÊí≠Êîæ
                        }
                        catch (e) { }
                        randNum++;
                    }
                    else {
                        try {
                            temp.pauseButton?.click(); // Â∞ùËØïÁÇπÂáªÊí≠ÊîæÊåâÈíÆÊí≠Êîæ
                        }
                        catch (e) { }
                        randNum--;
                    }
                }
                else {
                    console.log('ÊàêÂäüÊí≠Êîæ');
                    clearInterval(checkVideoPlayingInterval);
                    reading(1);
                }
            }
            else {
                console.log('Á≠âÂæÖÂä†ËΩΩ');
            }
        }, 800);
    }
    else if (href.includes(URL_CONFIG.examPaper) ||
        href.includes(URL_CONFIG.examPractice) ||
        href.includes(URL_CONFIG.examWeekly)) {
        console.log('ËøõÂÖ•Á≠îÈ¢òÈ°µÈù¢ÔºÅ');
        // Á≠îÈ¢òÈ°µÈù¢
        const ready = setInterval(() => {
            if ($$('.title')[0]) {
                clearInterval(ready); // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                // ÂàõÂª∫‚ÄúÊâãÂä®Á≠îÈ¢ò‚ÄùÊåâÈíÆ
                createManualButton();
                // ÂºÄÂßãÁ≠îÈ¢ò
                doingExam();
            }
        }, 500);
    }
    else {
        console.log('Ê≠§È°µÈù¢‰∏çÊîØÊåÅÂä†ËΩΩÂ≠¶‰π†ËÑöÊú¨ÔºÅ');
    }
});
// Ëé∑ÂèñvideoÊ†áÁ≠æ
function getVideoTag() {
    let iframe = $$('iframe')[0];
    let video;
    let pauseButton;
    var u = navigator.userAgent;
    if (u.indexOf('Mac') > -1) {
        // Mac
        if (iframe && iframe.innerHTML) {
            // Â¶ÇÊûúÊúâiframe,ËØ¥ÊòéÂ§ñÈù¢ÁöÑvideoÊ†áÁ≠æÊòØÂÅáÁöÑ
            video = iframe.contentWindow?.document.getElementsByTagName('video')[0];
            pauseButton = (iframe.contentWindow?.document.getElementsByClassName('prism-play-btn')[0]);
        }
        else {
            // Âê¶ÂàôËøô‰∏™videoÊ†áÁ≠æÊòØÁúüÁöÑ
            video = $$('video')[0];
            pauseButton = $$('.prism-play-btn')[0];
        }
        return {
            video: video,
            pauseButton: pauseButton,
        };
    }
    else {
        if (iframe) {
            // Â¶ÇÊûúÊúâiframe,ËØ¥ÊòéÂ§ñÈù¢ÁöÑvideoÊ†áÁ≠æÊòØÂÅáÁöÑ
            video = (iframe.contentWindow?.document.getElementsByTagName('video')[0]);
            pauseButton = (iframe.contentWindow?.document.getElementsByClassName('prism-play-btn')[0]);
        }
        else {
            // Âê¶ÂàôËøô‰∏™videoÊ†áÁ≠æÊòØÁúüÁöÑ
            video = $$('video')[0];
            pauseButton = $$('.prism-play-btn')[0];
        }
        return {
            video: video,
            pauseButton: pauseButton,
        };
    }
}
// ËØªÊñ∞ÈóªÊàñËÄÖÁúãËßÜÈ¢ë
// type:0‰∏∫Êñ∞ÈóªÔºå1‰∏∫ËßÜÈ¢ë
async function reading(type) {
    // ÁúãÊñáÁ´†ÊàñËÄÖËßÜÈ¢ë
    let time = 1;
    if (type === 0) {
        // 80-100ÁßíÂêéÂÖ≥Èó≠È°µÈù¢ÔºåÁúãÊñáÁ´†
        time = ~~(Math.random() * 20 + 80) + 1;
    }
    if (type === 1) {
        // 100-150ÁßíÂêéÂÖ≥Èó≠È°µÈù¢ÔºåÁúãËßÜÈ¢ë
        time = ~~(Math.random() * 50 + 100) + 1;
    }
    let firstTime = time - 2;
    let secendTime = 12;
    // ÊªöÂä®ÈïøÂ∫¶
    const scrollLength = document.body.scrollHeight / 2;
    await createTip('Ë∑ùÁ¶ªÂÖ≥Èó≠È°µÈù¢ËøòÂâ©', time, (time) => {
        if (time === firstTime) {
            window.scrollTo(0, 394);
        }
        if (time === secendTime) {
            window.scrollTo(0, scrollLength / 3);
        }
        if (time === 0) {
            if (type === 0) {
                GM_setValue('readingUrl', null);
            }
            else {
                GM_setValue('watchingUrl', null);
            }
            // ÂÖ≥Èó≠Á™óÂè£
            closeWin();
        }
    });
    // ÂÖ≥Èó≠ÊñáÁ´†ÊàñËßÜÈ¢ëÈ°µÈù¢
}
// ÂàõÂª∫Â≠¶‰π†ÊèêÁ§∫
async function createTip(text, delay, callback) {
    return new Promise((resolve) => {
        // ÊèêÁ§∫
        let tipInfo = creatElementNode('div', undefined, {
            id: 'studyTip',
            class: 'egg_tip',
        });
        // ÊèíÂÖ•ËäÇÁÇπ
        document.body.append(tipInfo);
        // Êìç‰Ωú
        const operate = {
            destroy() {
                if (tipInfo) {
                    // ÈöêËóè
                    operate.hide();
                    tipInfo.remove();
                    tipInfo = null;
                }
            },
            hide() {
                if (tipInfo) {
                    tipInfo.classList.remove('active');
                }
            },
            show() {
                if (tipInfo) {
                    tipInfo.classList.add('active');
                }
            },
        };
        tipInfo.append(text ? text : '');
        if (delay && delay >= 0) {
            // ÂÄíËÆ°Êó∂
            const countdown = creatElementNode('span', {
                innerText: ` ${delay} s`,
            }, {
                class: 'egg_countdown',
            });
            tipInfo.appendChild(countdown);
            operate.show();
            // ÂÆöÊó∂
            const timer = setInterval(() => {
                countdown.innerText = ` ${delay} s`;
                if (typeof delay === 'number' && callback) {
                    callback(delay, operate);
                }
                // ÂÄíËÆ°Êó∂ÁªìÊùü
                if (!delay) {
                    // Ê∏ÖÈô§ËÆ°Êó∂Âô®
                    clearInterval(timer);
                    // ÈöêËóè
                    operate.hide();
                    resolve(operate);
                    return;
                }
                delay--;
            }, 1000);
            return;
        }
        operate.show();
        resolve(operate);
    });
}
// Ëé∑ÂèñÊñ∞ÈóªÂàóË°®
function getNews() {
    return new Promise(async (resolve) => {
        // ÈúÄË¶ÅÂ≠¶‰π†ÁöÑÊñ∞ÈóªÊï∞Èáè
        const need = tasks[0].need < maxNewsNum ? tasks[0].need : maxNewsNum;
        console.log(`ËøòÈúÄË¶ÅÁúã ${need} ‰∏™Êñ∞Èóª`);
        // Ëé∑ÂèñÈáçË¶ÅÊñ∞Èóª
        const data = await getTodayNews();
        if (data && data.length) {
            // Êï∞ÈáèË°•Ë∂≥ÈúÄË¶ÅÊï∞Èáè
            while (news.length < need) {
                // Èöè‰æøÂèñ
                const randomIndex = ~~(Math.random() * data.length);
                // Êñ∞Èóª
                const item = data[randomIndex];
                // ÊòØÂê¶Â≠òÂú®Êñ∞Èóª
                if (item.dataValid && item.type === 'tuwen') {
                    news.push(item);
                }
            }
        }
        else {
            news = [];
        }
        resolve('done');
    });
}
// Ëé∑ÂèñËßÜÈ¢ëÂàóË°®
function getVideos() {
    return new Promise(async (resolve) => {
        // ÈúÄË¶ÅÂ≠¶‰π†ÁöÑËßÜÈ¢ëÊï∞Èáè
        const need = tasks[1].need < maxVideoNum ? tasks[1].need : maxVideoNum;
        console.log(`ËøòÈúÄË¶ÅÁúã ${need} ‰∏™ËßÜÈ¢ë`);
        // Ëé∑ÂèñÈáçË¶ÅËßÜÈ¢ë
        const data = await getTodayVideos();
        if (data && data.length) {
            // Êï∞ÈáèË°•Ë∂≥ÈúÄË¶ÅÊï∞Èáè
            while (videos.length < need) {
                // Èöè‰æøÂèñ
                const randomIndex = ~~(Math.random() * data.length);
                // ËßÜÈ¢ë
                const item = data[randomIndex];
                // ÊòØÂê¶Â≠òÂú®ËßÜÈ¢ë
                if (item.dataValid &&
                    (item.type === 'shipin' || item.type === 'juji')) {
                    videos.push(item);
                }
            }
        }
        else {
            videos = [];
        }
        resolve('done');
    });
}
// ÈòÖËØªÊñáÁ´†
async function readNews() {
    await getNews();
    for (const i in news) {
        // ÊöÇÂÅú
        await pauseStudyLock();
        // ÈìæÊé•
        GM_setValue('readingUrl', news[i].url);
        console.log('Ê≠£Âú®ÁúãÁ¨¨' + (Number(i) + 1) + '‰∏™Êñ∞Èóª');
        // Êñ∞È°µÈù¢
        const newPage = GM_openInTab(news[i].url, {
            active: true,
            insert: true,
            setParent: true,
        });
        // Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
        await waitingClose(newPage);
        // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
        await waitingTime(500);
        // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
        await refreshMenu();
        // ‰ªªÂä°ÂÆåÊàêË∑≥Âá∫Âæ™ÁéØ
        if (settings[0] && tasks[0].status) {
            break;
        }
    }
    // ‰ªªÂä°ÂÆåÊàêÁä∂ÂÜµ
    if (settings[0] && !tasks[0].status) {
        console.log('‰ªªÂä°Êú™ÂÆåÊàêÔºåÁªßÁª≠ÁúãÊñ∞ÈóªÔºÅ');
        await readNews();
    }
}
// ÁúãÂ≠¶‰π†ËßÜÈ¢ë
async function watchVideo() {
    // Ëé∑ÂèñËßÜÈ¢ë
    await getVideos();
    // ËßÇÁúãËßÜÈ¢ë
    for (const i in videos) {
        // ÊöÇÂÅú
        await pauseStudyLock();
        // ÈìæÊé•
        GM_setValue('watchingUrl', videos[i].url);
        console.log('Ê≠£Âú®ËßÇÁúãÁ¨¨' + (Number(i) + 1) + '‰∏™ËßÜÈ¢ë');
        // È°µÈù¢
        const newPage = GM_openInTab(videos[i].url, {
            active: true,
            insert: true,
            setParent: true,
        });
        // Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
        await waitingClose(newPage);
        // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
        await waitingTime(500);
        // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
        await refreshMenu();
        // ‰ªªÂä°ÂÆåÊàêË∑≥Âá∫Âæ™ÁéØ
        if (settings[1] && tasks[1].status) {
            break;
        }
    }
    // ‰ªªÂä°ÂÆåÊàêÁä∂ÂÜµ
    if (settings[1] && !tasks[1].status) {
        console.log('‰ªªÂä°Êú™ÂÆåÊàêÔºåÁªßÁª≠ÁúãËßÜÈ¢ëÔºÅ');
        await watchVideo();
    }
}
// ÂÅöÊØèÊó•Á≠îÈ¢ò
async function doExamPractice() {
    // ÊöÇÂÅú
    await pauseStudyLock();
    console.log('Ê≠£Âú®ÂÆåÊàêÊØèÊó•Á≠îÈ¢ò');
    // Êñ∞È°µÈù¢
    const newPage = GM_openInTab(URL_CONFIG.examPractice, {
        active: true,
        insert: true,
        setParent: true,
    });
    // Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
    await waitingClose(newPage);
    // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
    await waitingTime(500);
    // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
    await refreshMenu();
    // ‰ªªÂä°ÂÆåÊàêÁä∂ÂÜµ
    if (settings[2] && !tasks[2].status) {
        console.log('‰ªªÂä°Êú™ÂÆåÊàêÔºåÁªßÁª≠ÂÆåÊàêÊØèÊó•Á≠îÈ¢òÔºÅ');
        await doExamPractice();
    }
}
// ÂÅöÊØèÂë®Á≠îÈ¢ò
async function doExamWeekly() {
    // id
    const examWeeklyId = await findExamWeekly();
    if (examWeeklyId) {
        // ÊöÇÂÅú
        await pauseStudyLock();
        console.log('Ê≠£Âú®ÂÅöÊØèÂë®Á≠îÈ¢ò...');
        // Êñ∞È°µÈù¢
        const newPage = GM_openInTab(`${URL_CONFIG.examWeekly}?id=${examWeeklyId}`, { active: true, insert: true, setParent: true });
        // Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
        await waitingClose(newPage);
        // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
        await waitingTime(500);
        // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
        await refreshMenu();
        // ‰ªªÂä°ÂÆåÊàêÁä∂ÂÜµ
        if (!tasks[3].status) {
            console.log('‰ªªÂä°Êú™ÂÆåÊàêÔºåÁªßÁª≠ÂÆåÊàêÊØèÂë®Á≠îÈ¢òÔºÅ');
            return await doExamWeekly();
        }
        return true;
    }
    return false;
}
// ÂÅö‰∏ìÈ°πÁªÉ‰π†
async function doExamPaper() {
    // id
    const examPaperId = await findExamPaper();
    if (examPaperId) {
        // ÊöÇÂÅú
        await pauseStudyLock();
        console.log('Ê≠£Âú®ÂÅö‰∏ìÈ°πÁªÉ‰π†...');
        // Êñ∞È°µÈù¢
        const newPage = GM_openInTab(`${URL_CONFIG.examPaper}?id=${examPaperId}`, {
            active: true,
            insert: true,
            setParent: true,
        });
        // Á≠âÂæÖÁ™óÂè£ÂÖ≥Èó≠
        await waitingClose(newPage);
        // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
        await waitingTime(500);
        // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
        await refreshMenu();
        // ‰ªªÂä°ÂÆåÊàêÁä∂ÂÜµ
        if (!tasks[4].status) {
            console.log('‰ªªÂä°Êú™ÂÆåÊàêÔºåÁªßÁª≠‰∏ìÈ°πÁªÉ‰π†ÔºÅ');
            return await doExamPaper();
        }
        return true;
    }
    return false;
}
// ÂàùÂßãÂåñÊØèÂë®Á≠îÈ¢òÊÄªÈ°µÊï∞Â±ûÊÄß
async function InitExam(type) {
    if (type === 0) {
        // ÈªòËÆ§‰ªéÁ¨¨‰∏ÄÈ°µËé∑ÂèñÂÖ®ÈÉ®È°µÂ±ûÊÄß
        var data = await getExamWeekly(1);
        if (data) {
            return data.totalPageCount;
        }
    }
    if (type === 1) {
        var data = await getExamPaper(1); // ÈªòËÆ§‰ªéÁ¨¨‰∏ÄÈ°µËé∑ÂèñÂÖ®ÈÉ®È°µÂ±ûÊÄß
        if (data) {
            return data.totalPageCount;
        }
    }
    await waitingTime(ratelimitms);
}
// Êü•ËØ¢ÊØèÂë®Á≠îÈ¢òÂàóË°®ÁúãÁúãËøòÊúâÊ≤°ÊúâÊ≤°ÂÅöËøáÁöÑÔºåÊúâÂàôËøîÂõûid
async function findExamWeekly() {
    console.log('ÂàùÂßãÂåñÊØèÂë®Á≠îÈ¢ò');
    // Ëé∑ÂèñÊÄªÈ°µÊï∞
    const total = await InitExam(0);
    // ÂΩìÂâçÈ°µÊï∞
    let current = examPaperReverse ? total : 1;
    console.log('ÊØèÂë®Á≠îÈ¢ò,ÂºÄÂêØÈÄÜÂ∫èÊ®°Âºè,‰ªéÊúÄÊó©ÁöÑÈ¢òÁõÆÂºÄÂßãÁ≠îÈ¢ò');
    console.log('Ê≠£Âú®ÂØªÊâæÊú™ÂÆåÊàêÁöÑÊØèÂë®Á≠îÈ¢ò...');
    while (current <= total && current) {
        // ËØ∑Ê±ÇÊï∞ÊçÆ
        const data = await getExamWeekly(current);
        if (data) {
            // ÈÄÜÂ∫è
            if (examWeeklyReverse) {
                // Ëã•ÂºÄÂêØÈÄÜÂ∫èÁ≠îÈ¢ò, ÂàôÂèçËΩ¨ÂàóË°®
                data.list.reverse();
            }
            for (const i in data.list) {
                // Ëé∑ÂèñÊØèÂë®ÁöÑÊµãËØïÂàóË°®
                const examWeeks = data.list[i].practices;
                // Ëã•ÂºÄÂêØÈÄÜÂ∫è, ÂàôÂèçËΩ¨ÊØèÂë®ÁöÑÊµãËØïÂàóË°®
                if (examWeeklyReverse) {
                    examWeeks.reverse();
                }
                for (const j in examWeeks) {
                    // ÈÅçÂéÜÊü•ËØ¢ÊúâÊ≤°ÊúâÊ≤°ÂÅöËøáÁöÑ
                    if (examWeeks[j].status !== 2) {
                        // statusÔºö 1‰∏∫"ÂºÄÂßãÁ≠îÈ¢ò" , 2‰∏∫"ÈáçÊñ∞Á≠îÈ¢ò"
                        return examWeeks[j].id;
                    }
                }
            }
            // Â¢ûÂä†È°µÁ†Å
            current += examWeeklyReverse ? -1 : 1;
            // Á≠âÂæÖ
            await waitingTime(ratelimitms);
        }
        else {
            break;
        }
    }
}
// Êü•ËØ¢‰∏ìÈ°πÁªÉ‰π†ÂàóË°®ÁúãÁúãËøòÊúâÊ≤°ÊúâÊ≤°ÂÅöËøáÁöÑÔºåÊúâÂàôËøîÂõûid
async function findExamPaper() {
    console.log('ÂàùÂßãÂåñ‰∏ìÈ°πÁªÉ‰π†');
    // Ëé∑ÂèñÊÄªÈ°µÊï∞
    const total = await InitExam(0);
    // ÂΩìÂâçÈ°µÊï∞
    let current = examPaperReverse ? total : 1;
    console.log('‰∏ìÈ°πÁªÉ‰π†,ÂºÄÂêØÈÄÜÂ∫èÊ®°Âºè,‰ªéÊúÄÊó©ÁöÑÈ¢òÁõÆÂºÄÂßãÁ≠îÈ¢ò');
    console.log('Ê≠£Âú®ÂØªÊâæÊú™ÂÆåÊàêÁöÑ‰∏ìÈ°πÁªÉ‰π†...');
    while (current <= total && current) {
        // ËØ∑Ê±ÇÊï∞ÊçÆ
        const data = await getExamPaper(current);
        if (data) {
            // Ëé∑Âèñ‰∏ìÈ°πÁªÉ‰π†ÁöÑÂàóË°®
            const examPapers = data.list;
            if (examPaperReverse) {
                // Ëã•ÂºÄÂêØÈÄÜÂ∫èÁ≠îÈ¢ò, ÂàôÂèçËΩ¨‰∏ìÈ°πÁªÉ‰π†ÂàóË°®
                examPapers.reverse();
            }
            for (const i in examPapers) {
                // ÈÅçÂéÜÊü•ËØ¢ÊúâÊ≤°ÊúâÊ≤°ÂÅöËøáÁöÑ
                if (examPapers[i].status !== 2) {
                    // statusÔºö 1‰∏∫"ÂºÄÂßãÁ≠îÈ¢ò" , 2‰∏∫"ÈáçÊñ∞Á≠îÈ¢ò"
                    return examPapers[i].id;
                }
            }
            // Â¢ûÂä†È°µÁ†Å (Ëã•ÂºÄÂêØÈÄÜÂ∫èÁøªÈ°µ, ÂàôÂáèÂ∞ëÈ°µÁ†Å)
            current += examPaperReverse ? -1 : 1;
            // Á≠âÂæÖ
            await waitingTime(ratelimitms);
        }
        else {
            break;
        }
    }
}
// Ëé∑ÂèñÁ≠îÈ¢òÊåâÈíÆ
function getNextButton() {
    return new Promise((resolve) => {
        const timer = setInterval(() => {
            // Á≠îÈ¢òÊåâÈíÆ
            const nextAll = $$('.ant-btn').filter((next) => next.innerText);
            if (nextAll.length) {
                clearInterval(timer); // ÂÅúÊ≠¢ÂÆöÊó∂Âô®
                if (nextAll.length === 2) {
                    resolve(nextAll[1]);
                    return;
                }
                resolve(nextAll[0]);
            }
        }, 500);
    });
}
// ÊöÇÂÅúÁ≠îÈ¢ò
async function pauseExam() {
    // ÊåâÈíÆ
    const manualButton = $$('#manualButton')[0];
    if (manualButton) {
        console.log('Ëá™Âä®Á≠îÈ¢òÂ§±Ë¥•ÔºåÂàáÊç¢‰∏∫ÊâãÂä®');
        pause = true;
        manualButton.innerText = 'ÂºÄÂêØËá™Âä®Á≠îÈ¢ò';
        manualButton.classList.add('manual');
        createTip('Â∑≤ÊöÇÂÅúÔºåËØ∑Á≠îÈ¢òÂêéÊâãÂä®ÂºÄÂêØËá™Âä®Á≠îÈ¢ò! ', 10);
        // ÊöÇÂÅú
        await pauseLock();
    }
}
// Á≠âÂæÖÈ™åËØÅ
function waitVerify() {
    return new Promise((resolve) => {
        // ÊªëÂä®È™åËØÅ
        const mask = $$('#nc_mask')[0];
        if (mask && getComputedStyle(mask).display !== 'none') {
            // ÂÆöÊó∂Âô®
            const timer = setInterval(() => {
                // ÊªëÂä®È™åËØÅ
                const mask = $$('#nc_mask')[0];
                if (!mask || getComputedStyle(mask).display === 'none') {
                    console.log('Â≠¶‰π†Á≠âÂæÖÁªìÊùüÔºÅ');
                    clearInterval(timer);
                    resolve(true);
                }
                console.log('Á≠âÂæÖÊªëÂä®È™åËØÅ...');
            }, 100);
            return;
        }
        resolve(true);
    });
}
// Â§ÑÁêÜÈÄâÈ°π
function handleChoiceBtn(answers) {
    // ÈÄâÈ°πÊåâÈíÆ
    const allBtns = $$('.q-answer');
    // Á≠îÊ°àÂ≠òÂú®
    if (answers.length && allBtns.length) {
        // ‰ΩúÁ≠î
        return answers.every((answer) => {
            // Á≠îÊ°àÂ≠òÂú®
            if (answer && answer.length) {
                // ÂåÖÂê´Á≠îÊ°àÊúÄÁü≠ÈïøÂ∫¶ÈÄâÈ°π
                let minLengthChoice;
                // ÈÅçÂéÜ
                allBtns.forEach((choice) => {
                    // ÈÄâÈ°πÊñáÊú¨
                    const choiceText = choice.innerText.trim();
                    // Êó†Á¨¶Âè∑ÈÄâÈ°πÊñáÊú¨
                    const unsignedChoiceText = choiceText.replaceAll(/[„ÄÅÔºå,„ÄÇ ]/g, '');
                    // Êó†Á¨¶Âè∑Á≠îÊ°à
                    const unsignedAnswer = answer.replaceAll(/[„ÄÅÔºå,„ÄÇ ]/g, '');
                    // ÂåÖÂê´Á≠îÊ°à
                    if (choiceText === answer ||
                        choiceText.includes(answer) ||
                        answer.includes(choiceText) ||
                        unsignedChoiceText.includes(unsignedAnswer)) {
                        // ÊúÄÂ∞èÈïøÂ∫¶ÈÄâÈ°πÊúâÂÄº
                        if (minLengthChoice) {
                            // ÊúÄÁü≠ÈïøÂ∫¶ÈÄâÈ°π‰∏éÂΩìÂâçÈÄâÈ°πÊØîËæÉÈïøÂ∫¶
                            if (minLengthChoice.innerText.length > choiceText.length) {
                                minLengthChoice = choice;
                            }
                        }
                        else {
                            // ÊúÄÂ∞èÈïøÂ∫¶ÈÄâÈ°πËµãÂÄº
                            minLengthChoice = choice;
                        }
                    }
                });
                // Â≠òÂú®ÈÄâÈ°π
                if (minLengthChoice) {
                    // ÈÄâÊã©
                    if (!minLengthChoice.classList.contains('chosen')) {
                        minLengthChoice.click();
                    }
                    return true;
                }
            }
            return false;
        });
    }
    return false;
}
// ÈöèÊú∫Â§ÑÁêÜÈÄâÈ°π
function handleChoiceBtnRand(answers) {
    // ÈÄâÈ°πÊåâÈíÆ
    const allBtns = $$('.q-answer');
    // ÊåâÈíÆÂ≠òÂú®
    if (allBtns.length) {
        const index = ~~(Math.random() * allBtns.length);
        const randBtn = allBtns[index];
        // ÈÄâÊã©
        if (!randBtn.classList.contains('chosen')) {
            randBtn.click();
        }
    }
}
// Â§ÑÁêÜÂ°´Á©∫
const handleBlankInput = (answers) => {
    // ÊâÄÊúâÂ°´Á©∫
    const blanks = $$('.blank');
    // Á≠îÊ°àÂ≠òÂú®
    if (blanks.length && answers.length) {
        // Â°´Á©∫Êï∞ÈáèÂíåÁ≠îÊ°àÊï∞Èáè‰∏ÄËá¥
        if (answers.length === blanks.length) {
            return answers.every((answer, i) => {
                // Á≠îÊ°àÂ≠òÂú®
                if (answer && answer.length) {
                    // ËæìÂÖ•‰∫ã‰ª∂
                    const inputEvent = new Event('input', {
                        bubbles: true,
                    });
                    // ËÆæÁΩÆÁ≠îÊ°à
                    blanks[i].setAttribute('value', answer);
                    // Ëß¶ÂèëËæìÂÖ•input
                    blanks[i].dispatchEvent(inputEvent);
                    return true;
                }
                return false;
            });
        }
        // Â°´Á©∫Êï∞Èáè‰∏∫1ÂíåÊèêÁ§∫Êï∞ÈáèÂ§ß‰∫é1
        if (blanks.length === 1 && answers.length > 1) {
            // Áõ¥Êé•Â∞ÜÊâÄÊúâÁ≠îÊ°àÊï¥ÂêàÂ°´ËøõÂéª
            const answer = answers.join('');
            // Á≠îÊ°àÂ≠òÂú®
            if (answer && answer.length) {
                // ËæìÂÖ•‰∫ã‰ª∂
                const inputEvent = new Event('input', {
                    bubbles: true,
                });
                // ËÆæÁΩÆÁ≠îÊ°à
                blanks[0].setAttribute('value', answer);
                // Ëß¶ÂèëËæìÂÖ•input
                blanks[0].dispatchEvent(inputEvent);
                return true;
            }
        }
    }
    return false;
};
// Á≠îÈ¢òËøáÁ®ã(Êï¥Âêà)
async function doingExam() {
    // ‰∏ã‰∏Ä‰∏™ÊåâÈíÆ
    let nextButton;
    // ‰øùÂ≠òÁ≠îÊ°à
    let shouldSaveAnswer = false;
    while (true) {
        // ÂÖàÁ≠âÁ≠âÂÜçÂºÄÂßãÂÅöÈ¢ò
        await waitingTime(2500);
        // ÊöÇÂÅú
        await pauseLock();
        // Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÊåâÈíÆ
        nextButton = await getNextButton();
        // ÁªìÊùü
        const finish = ['ÂÜçÁªÉ‰∏ÄÊ¨°', 'ÂÜçÊù•‰∏ÄÁªÑ', 'Êü•ÁúãËß£Êûê'];
        if (finish.includes(nextButton.innerText)) {
            break;
        }
        // ÁÇπÂáªÊèêÁ§∫
        $$('.tips')[0]?.click();
        // ÊâÄÊúâÊèêÁ§∫
        const allTips = $$('font[color=red]');
        // Á≠îÊ°à
        const answers = allTips.map((tip) => tip.innerText.trim());
        // Ëé∑ÂèñÈ¢òÁõÆÁöÑÊñáÊú¨ÂÜÖÂÆπ
        const question = $$('.q-body')[0].innerText;
        // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
        await waitingTime(500);
        // ÈÄâÈ°πÊåâÈíÆ
        const allBtns = $$('.q-answer');
        // ÊâÄÊúâÂ°´Á©∫
        const blanks = $$('input[type=text][class=blank]');
        // ÈóÆÈ¢òÁ±ªÂûã
        const questionType = ($$('.q-header')[0].innerText.substring(0, 3));
        // È¢òÂûãÂàÜÁ±ª‰ΩúÁ≠î
        switch (questionType) {
            case 'Â°´Á©∫È¢ò': {
                // Ê†πÊçÆÊèêÁ§∫‰ΩúÁ≠î
                if (answers.length) {
                    const res = handleBlankInput(answers);
                    // ÊàêÂäü
                    if (res) {
                        break;
                    }
                }
                // Â∞ùËØïÈ¢òÂ∫ìËé∑Âèñ
                const answersNetwork = await getAnswer(question);
                // Ê†πÊçÆÈ¢òÂ∫ì‰ΩúÁ≠î
                if (answersNetwork.length) {
                    const res = handleBlankInput(answersNetwork);
                    // ÊàêÂäü
                    if (res) {
                        break;
                    }
                }
                // ÊöÇÂÅúÁ≠îÈ¢ò
                await pauseExam();
                // Êèê‰∫§Á≠îÊ°à
                shouldSaveAnswer = true;
                break;
            }
            case 'Â§öÈÄâÈ¢ò': {
                // Ê†πÊçÆÊèêÁ§∫‰ΩúÁ≠î
                if (answers.length) {
                    // ÈÄâÈ°πÊñáÊú¨
                    const choicesText = allBtns.map((btn) => btn.innerText);
                    // ÈÄâÈ°πÂÜÖÂÆπ
                    const choicesContent = choicesText
                        .map((choiceText) => choiceText.split(/[A-Z]./)[1].trim())
                        .join('');
                    // Á©∫Ê†º
                    const blanks = question.match(/ÔºàÔºâ/g);
                    // Â°´Á©∫Êï∞Èáè„ÄÅÈÄâÈ°πÊï∞Èáè„ÄÅÁ≠îÊ°àÊï∞ÈáèÁõ∏Âêå | ÈÄâÈ°πÂÖ®ÊñáÁ≠â‰∫éÁ≠îÊ°àÂÖ®Êñá
                    if (allBtns.length === blanks.length ||
                        question === choicesContent ||
                        allBtns.length === 2) {
                        // ÂÖ®ÈÄâ
                        allBtns.forEach((choice) => {
                            if (!choice.classList.contains('chosen')) {
                                choice.click();
                            }
                        });
                        break;
                    }
                    // ÈÄâÈ°πÊï∞ÈáèÂ§ß‰∫éÁ≠â‰∫éÁ≠îÊ°à
                    if (allBtns.length >= answers.length) {
                        const res = handleChoiceBtn(answers);
                        // ÊàêÂäü
                        if (res) {
                            break;
                        }
                    }
                }
                // Â∞ùËØïÈ¢òÂ∫ìËé∑Âèñ
                const answersNetwork = await getAnswer(question);
                // Á≠îÊ°àÂ≠òÂú®
                if (answersNetwork.length) {
                    const res = handleChoiceBtn(answersNetwork);
                    // ÊàêÂäü
                    if (res) {
                        break;
                    }
                }
                // ÊöÇÂÅúÁ≠îÈ¢ò
                await pauseExam();
                // Êèê‰∫§Á≠îÊ°à
                shouldSaveAnswer = true;
                break;
            }
            case 'ÂçïÈÄâÈ¢ò': {
                // Ê†πÊçÆÊèêÁ§∫‰ΩúÁ≠î
                if (answers.length) {
                    // ÊèêÁ§∫‰∏∫1
                    if (answers.length === 1) {
                        const res = handleChoiceBtn(answers);
                        // ÊàêÂäü
                        if (res) {
                            break;
                        }
                    }
                    else {
                        // ÂèØËÉΩÁöÑÂàÜÈöîÁ¨¶
                        const seperator = [
                            '',
                            ' ',
                            'Ôºå',
                            ';',
                            ',',
                            '„ÄÅ',
                            '-',
                            '|',
                            '+',
                            '/',
                        ];
                        // ÂèØËÉΩÁöÑÁ≠îÊ°à
                        const answersLike = seperator.map((s) => answers.join(s));
                        // Á≠îÊ°àÂ≠òÂú®
                        if (answersLike.every((answer) => answer.length)) {
                            // ÂèØËÉΩÁ≠îÊ°àÊòØÂê¶Ê≠£Á°Æ
                            const res = answersLike.some((answer) => {
                                // Â∞ùËØïÊü•ÊâæÁÇπÂáª
                                return handleChoiceBtn([answer]);
                            });
                            if (res) {
                                break;
                            }
                        }
                    }
                }
                // Â∞ùËØïÈ¢òÂ∫ìËé∑Âèñ
                const answersNetwork = await getAnswer(question);
                // Â≠òÂú®Á≠îÊ°à
                if (answersNetwork.length) {
                    // ÂçïÁ≠îÊ°àÂçïÈÄâÈ°π
                    if (answersNetwork.length === 1) {
                        // Â∞ùËØïÊü•ÊâæÁÇπÂáª
                        const res = handleChoiceBtn(answersNetwork);
                        if (res) {
                            break;
                        }
                    }
                    else {
                        // Â§öÁ≠îÊ°àÂçïÈÄâÈ°π ÈÄâÈ°πÊÑèÂ§ñÊãÜÂàÜ
                        // ÂèØËÉΩÂàÜÈöîÁ¨¶
                        const seperator = ['', ' '];
                        // ÂèØËÉΩÁ≠îÊ°à
                        const answersLike = seperator.map((s) => answers.join(s));
                        // Á≠îÊ°àÂ≠òÂú®
                        if (answersLike.every((answer) => answer.length)) {
                            // ÂèØËÉΩÁ≠îÊ°àÊòØÂê¶Ê≠£Á°Æ
                            const res = answersLike.some((answer) => {
                                // Â∞ùËØïÊü•ÊâæÁÇπÂáª
                                return handleChoiceBtn([answer]);
                            });
                            if (res) {
                                break;
                            }
                        }
                    }
                }
                // ÊöÇÂÅúÁ≠îÈ¢ò
                await pauseExam();
                // Êèê‰∫§Á≠îÊ°à
                shouldSaveAnswer = true;
                break;
            }
        }
        // Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÊåâÈíÆ
        nextButton = await getNextButton();
        // Á°ÆËÆ§
        if (nextButton.innerText === 'Á°Æ ÂÆö') {
            // ÈúÄË¶ÅÊèê‰∫§Á≠îÊ°à
            if (shouldSaveAnswer) {
                // Ëé∑Âèñkey
                const key = getKey(question);
                // Á≠îÊ°à
                const answers = [];
                if (questionType === 'Â°´Á©∫È¢ò') {
                    blanks.forEach((blank) => {
                        answers.push(blank.value);
                    });
                }
                if (questionType === 'ÂçïÈÄâÈ¢ò' || questionType === 'Â§öÈÄâÈ¢ò') {
                    allBtns.forEach((choice) => {
                        if (choice.classList.contains('chosen')) {
                            // Â∏¶Â≠óÊØçÁöÑÈÄâÈ°π
                            const answerTemp = choice.innerText;
                            // ‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠ÊãøÂá∫Á≠îÊ°à
                            const [, answer] = answerTemp.split('. ');
                            if (answer && answer.length) {
                                answers.push(answer);
                            }
                        }
                    });
                }
                // Á≠îÊ°à
                const answer = answers.join(';');
                // Â≠òÂú®Á≠îÊ°à
                if (answer.length) {
                    // Á≠îÊ°à
                    console.log(`‰∏ä‰º†‰∫ÜÊâãÂ∑•Á≠îÊ°à\nkey:${key},Á≠îÊ°à:${answer}`);
                    await saveAnswer(key, answer);
                }
            }
            // Á°ÆËÆ§
            nextButton.click();
            // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
            await waitingTime(1000);
            // Á≠îÊ°àËß£Êûê
            const answerBox = $$('.answer')[0];
            // Á≠îÈ¢òÈîôËØØ
            if (answerBox) {
                // Ëé∑Âèñkey
                const key = getKey(question);
                const answerTemp = answerBox.innerText;
                // ‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠ÊãøÂá∫Á≠îÊ°à
                const [, answer] = answerTemp.split('Ôºö');
                if (answer && answer.length) {
                    answer.replaceAll(' ', ';');
                    console.log(`‰∏ä‰º†‰∫ÜÈîôÈ¢òÁ≠îÊ°à key:${key} answer:${answer}`);
                    await saveAnswer(key, answer);
                }
                // ÊØèÂë®„ÄÅ‰∏ìÈ°πÊöÇÂÅú
                if (href.includes(URL_CONFIG.examWeekly) ||
                    href.includes(URL_CONFIG.examPaper)) {
                    // ÊöÇÂÅúÁ≠îÈ¢ò
                    await pauseExam();
                }
            }
            // ÊªëÂä®È™åËØÅ
            await waitVerify();
        }
        // Ëé∑ÂèñÊåâÈíÆ
        nextButton = await getNextButton();
        if (nextButton.innerText === '‰∏ã‰∏ÄÈ¢ò' ||
            nextButton.innerText === 'ÂÆå Êàê' ||
            nextButton.innerText === '‰∫§ Âç∑') {
            // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥
            await waitingTime(1500);
            // ‰∏ã‰∏ÄÈ¢ò
            nextButton.click();
        }
    }
    closeWin();
}
// Ëé∑ÂèñÂÖ≥ÈîÆÂ≠ó
function getKey(content) {
    // Â§ñÈÉ®ÂºïÁî®md5Âä†ÂØÜ
    const key = md5(content);
    console.log(`Ëé∑Âèñ key:${key}`);
    return key;
}
// ÂàùÂßãÂåñÈÖçÁΩÆ
function initSetting() {
    try {
        let settingTemp = JSON.parse(GM_getValue('studySetting'));
        if (settingTemp) {
            settings = settingTemp;
        }
        else {
            settings = [true, true, true, true, true, false, false];
        }
    }
    catch (e) {
        // Ê≤°ÊúâÂàôÁõ¥Êé•ÂàùÂßãÂåñ
        settings = [true, true, true, true, true, false, false];
    }
}
// ÂàùÂßãÂåñÈÖçÁΩÆ
function initFontSize() {
    // ÁßªÂä®Á´Ø
    const moblie = hasMobile();
    if (moblie) {
        // Áº©ÊîæÊØî‰æã
        const scale = ~~(window.innerWidth / window.outerWidth) || 1;
        document.documentElement.style.setProperty('--scale', String(scale));
        window.addEventListener('resize', () => {
            // Áº©ÊîæÊØî‰æã
            const scale = ~~(window.innerWidth / window.outerWidth) || 1;
            document.documentElement.style.setProperty('--scale', String(scale));
        });
    }
}
// ÂàõÂª∫‚ÄúÊâãÂä®Á≠îÈ¢ò‚ÄùÊåâÈíÆ
function createManualButton() {
    const title = $$('.title')[0];
    // ÊåâÈíÆ
    const manualButton = creatElementNode('button', { innerText: 'ÂÖ≥Èó≠Ëá™Âä®Á≠îÈ¢ò' }, {
        id: 'manualButton',
        class: 'egg_btn',
        type: 'button',
        onclick: clickManualButton,
    });
    // ÊèíÂÖ•ËäÇÁÇπ
    title.parentNode.insertBefore(manualButton, title.nextSibling);
}
// ÁÇπÂáªÊâãÂä®Â≠¶‰π†ÊåâÈíÆ
function clickManualButton() {
    const manualButton = $$('#manualButton')[0];
    pause = !pause;
    if (pause) {
        manualButton.innerText = 'ÂºÄÂêØËá™Âä®Á≠îÈ¢ò';
        manualButton.classList.add('manual');
    }
    else {
        manualButton.innerText = 'ÂÖ≥Èó≠Ëá™Âä®Á≠îÈ¢ò';
        manualButton.classList.remove('manual');
    }
}
// Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
async function loadUserInfo() {
    const egg_userinfo = $$('.egg_userinfo')[0];
    egg_userinfo.innerHTML = '';
    // ÁôªÂΩïÁä∂ÊÄÅ
    const loginStatus = creatElementNode('div', undefined, {
        class: 'egg_login_status',
    });
    if (login) {
        // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
        userInfo = await getUserInfo();
        if (userInfo) {
            const { avatarMediaUrl, nick } = userInfo;
            const avatarItems = [];
            if (avatarMediaUrl) {
                // ÂõæÁâá
                const img = creatElementNode('img', undefined, {
                    src: avatarMediaUrl,
                    class: 'egg_avatar_img',
                });
                avatarItems.push(img);
            }
            else {
                // ÊñáÂ≠ó
                const subNickName = creatElementNode('div', { innerText: nick.substring(1, 3) }, { class: 'egg_sub_nickname' });
                avatarItems.push(subNickName);
            }
            // Â§¥ÂÉè
            const avatar = creatElementNode('div', undefined, { class: 'egg_avatar' }, avatarItems);
            // ÊòµÁß∞
            const nickName = creatElementNode('div', { innerText: nick }, { class: 'egg_name' });
            // ÂÖ≥‰∫éÁî®Êà∑
            const user = creatElementNode('div', undefined, { class: 'egg_user' }, [
                avatar,
                nickName,
            ]);
            egg_userinfo.append(user);
        }
        // ÈÄÄÂá∫ÊåâÈíÆ
        const logoutBtn = creatElementNode('button', { innerText: 'ÈÄÄÂá∫' }, {
            type: 'button',
            onclick() {
                const logged = $$("a[class='logged-link']")[0];
                logged.click();
            },
        });
        loginStatus.classList.remove('active');
        loginStatus.append(logoutBtn);
    }
    else {
        // ÁôªÂΩïÊåâÈíÆ
        const loginBtn = creatElementNode('button', { innerText: 'ËØ∑ÂÖàÁôªÂΩï' }, {
            type: 'button',
            onclick() {
                loginWindow();
            },
        });
        loginStatus.classList.add('active');
        loginBtn.addEventListener('click', () => {
            loginWindow();
        });
        loginStatus.append(loginBtn);
    }
    egg_userinfo.append(loginStatus);
}
// Âä†ËΩΩÂàÜÊï∞
async function loadScoreInfo() {
    if (login) {
        // Ëé∑ÂèñÊÄªÂàÜ
        const totalScore = await getTotalScore();
        // Ëé∑ÂèñÂΩìÂ§©ÊÄªÂàÜ
        const todayScore = await getTodayScore();
        // Êõ¥Êñ∞ÂàÜÊï∞
        const totalScoreSpan = $$('.egg_scoreinfo .egg_totalscore span')[0];
        const todayScoreSpan = $$('.egg_scoreinfo .egg_todayscore span')[0];
        totalScoreSpan.innerText = totalScore;
        todayScoreSpan.innerText = todayScore;
    }
}
// Âä†ËΩΩ‰ªªÂä°ÂàóË°®
async function loadTaskList() {
    // ÂéüÂßã‰ªªÂä°ËøõÂ∫¶
    const taskProgress = await getTaskList();
    if (taskProgress) {
        // ÊñáÁ´†
        const { currentScore: artCur, dayMaxScore: artMax } = taskProgress[0];
        tasks[0] = {
            currentScore: artCur,
            dayMaxScore: artMax,
            status: false,
            need: artMax - artCur,
        };
        // ËßÜÈ¢ë
        const { currentScore: videoCur1, dayMaxScore: videoMax1 } = taskProgress[1];
        const { currentScore: videoCur2, dayMaxScore: videoMax2 } = taskProgress[3];
        tasks[1] = {
            currentScore: videoCur1 + videoCur2,
            dayMaxScore: videoMax1 + videoMax2,
            status: false,
            need: videoMax1 + videoMax2 - (videoCur1 + videoCur2),
        };
        // ÊØèÊó•Á≠îÈ¢ò
        const { currentScore: dayCur, dayMaxScore: dayMax } = taskProgress[6];
        tasks[2] = {
            currentScore: dayCur,
            dayMaxScore: dayMax,
            status: false,
            need: dayMax - dayCur,
        };
        // ÊØèÂë®Á≠îÈ¢ò
        const { currentScore: weekCur, dayMaxScore: weekMax } = taskProgress[2];
        tasks[3] = {
            currentScore: weekCur,
            dayMaxScore: weekMax,
            status: false,
            need: weekMax - weekCur,
        };
        // ‰∏ìÈ°πÁªÉ‰π†
        const { currentScore: exerCur, dayMaxScore: exerMax } = taskProgress[5];
        tasks[4] = {
            currentScore: exerCur,
            dayMaxScore: exerMax,
            status: false,
            need: exerMax - exerCur,
        };
        // Êõ¥Êñ∞Êï∞ÊçÆ
        for (const i in tasks) {
            const { currentScore, dayMaxScore } = tasks[i];
            // ËøõÂ∫¶
            let rate = (100 * currentScore) / dayMaxScore;
            // ‰øÆÂ§ç‰∏ìÈ°πÁªÉ‰π†ÊàêÁªÑÂÅöÂÆå,ËøõÂ∫¶Êù°ÊòæÁ§∫ÂºÇÂ∏∏
            if (dayMaxScore <= currentScore) {
                rate = 100;
            }
            if (rate === 100) {
                tasks[i].status = true;
            }
            if (rate > 0) {
                // ËÆæÁΩÆËøõÂ∫¶Êù°
                setProgress(Number(i), Number(rate.toFixed(2)));
            }
        }
    }
}
// Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
async function refreshMenu() {
    // Âä†ËΩΩÂàÜÊï∞‰ø°ÊÅØ
    await loadScoreInfo();
    // Âä†ËΩΩ‰ªªÂä°ÂàóË°®
    await loadTaskList();
}
// Ê∏≤ÊüìËèúÂçï
async function renderMenu() {
    // ËÆæÁΩÆÈ°π
    const settingItems = [];
    // Áî®Êà∑‰ø°ÊÅØ
    const userinfo = creatElementNode('div', undefined, {
        class: 'egg_userinfo',
    });
    // ÊÄªÂàÜ
    const totalScoreSpan = creatElementNode('span', { innerText: 0 });
    const totalScoreDiv = creatElementNode('div', { innerHTML: 'ÊÄªÁßØÂàÜ' }, { class: 'egg_totalscore' }, totalScoreSpan);
    // ÂΩìÂ§©ÊÄªÂàÜ
    const todayScoreSpan = creatElementNode('span', { innerText: 0 });
    const todayScoreDiv = creatElementNode('div', { innerHTML: 'ÂΩìÂ§©ÁßØÂàÜ' }, { class: 'egg_todayscore' }, todayScoreSpan);
    // ÂàÜÊï∞‰ø°ÊÅØ
    const scoreinfo = creatElementNode('div', undefined, { class: 'egg_scoreinfo' }, [totalScoreDiv, todayScoreDiv]);
    // ‰ø°ÊÅØ
    const info = creatElementNode('div', undefined, { class: 'egg_setting_item egg_info' }, [userinfo, scoreinfo]);
    settingItems.push(info);
    // ‰ªªÂä°Ê†áÁ≠æ
    const settingTaskLabels = [
        'ÊñáÁ´†ÈÄâËØª',
        'ËßÜÂê¨Â≠¶‰π†',
        'ÊØèÊó•Á≠îÈ¢ò',
        'ÊØèÂë®Á≠îÈ¢ò',
        '‰∏ìÈ°πÁªÉ‰π†',
    ];
    // ÂàÜÂâ≤Á∫ø
    settingItems.push(creatElementNode('hr'));
    for (const i in settingTaskLabels) {
        // ËøõÂ∫¶Êù°
        const bar = creatElementNode('div', undefined, { class: 'egg_bar' });
        // ËΩ®ÈÅì
        const track = creatElementNode('div', undefined, { class: 'egg_track' }, bar);
        // ÁôæÂàÜÊØîÁ¨¶Âè∑
        const percentSymbol = creatElementNode('span', { innerText: '%' }, { class: 'egg_percentsymbol' });
        // Êï∞ÂÄº
        const percent = creatElementNode('div', { innerText: '0' }, { class: 'egg_percent' }, percentSymbol);
        // ËøõÂ∫¶
        const progress = creatElementNode('div', undefined, { class: 'egg_progress' }, [track, percent]);
        // Ê†áÁ≠æ
        const label = creatElementNode('label', {
            innerText: settingTaskLabels[i],
        }, undefined, progress);
        // Â§ÑÁêÜËÆæÁΩÆÈÄâÈ°πÂèòÂåñ
        const handleCheckChange = debounce(async (checked) => {
            if (settings[i] !== checked) {
                // ÂàõÂª∫ÊèêÁ§∫
                const { destroy } = await createTip(`${settingTaskLabels[i]}Â∑≤${checked ? 'ÊâìÂºÄ' : 'ÂÖ≥Èó≠'}`, 2);
                // ÈîÄÊØÅ
                destroy();
                settings[i] = checked;
                // ËøêË°åÊó∂ÊòØÂê¶Ë¶ÅÈöêËóè
                GM_setValue('studySetting', JSON.stringify(settings));
            }
        }, 500);
        // ÈÄâÈ°π
        const input = creatElementNode('input', undefined, {
            title: settingTaskLabels[i],
            class: 'egg_setting_switch',
            type: 'checkbox',
            checked: settings[i] ? 'checked' : '',
            onchange(e) {
                const { checked } = e.target;
                handleCheckChange(checked);
            },
        });
        // ËÆæÁΩÆÈ°π
        const item = creatElementNode('div', undefined, { class: 'egg_setting_item' }, [label, input]);
        settingItems.push(item);
    }
    // ÂàÜÂâ≤Á∫ø
    settingItems.push(creatElementNode('hr'));
    // ËÆæÁΩÆÊ†áÁ≠æ
    const settingLabel = ['ËøêË°åÈöêËóè', 'Ëá™Âä®ÂºÄÂßã'];
    for (const i in settingLabel) {
        // Ê†áÁ≠æ
        const label = creatElementNode('label', {
            innerText: settingLabel[i],
        });
        // ÂΩìÂâçÂ∫èÂè∑
        const currentIndex = Number(i) + settingTaskLabels.length;
        // Â§ÑÁêÜËÆæÁΩÆÈÄâÈ°πÂèòÂåñ
        const handleCheckChange = debounce(async (checked) => {
            if (settings[currentIndex] !== checked) {
                settings[currentIndex] = checked;
                // ËÆæÁΩÆ
                GM_setValue('studySetting', JSON.stringify(settings));
                // ÂàõÂª∫ÊèêÁ§∫
                const { destroy } = await createTip(`${settingLabel[i]}Â∑≤${checked ? 'ÊâìÂºÄ' : 'ÂÖ≥Èó≠'}ÔºÅ`, 2);
                // ÈîÄÊØÅ
                destroy();
            }
        }, 300);
        // ÈÄâÈ°π
        const input = creatElementNode('input', undefined, {
            title: settingLabel[i],
            class: 'egg_setting_switch',
            type: 'checkbox',
            checked: settings[currentIndex] ? 'checked' : '',
            onchange: (e) => {
                const { checked } = e.target;
                handleCheckChange(checked);
            },
        });
        // ËÆæÁΩÆÈ°π
        const item = creatElementNode('div', undefined, { class: 'egg_setting_item' }, [label, input]);
        settingItems.push(item);
    }
    // Á™óÂè£È°π
    const login_frame = creatElementNode('div', undefined, {
        class: 'egg_frame_login',
    });
    // Á™óÂè£È°π
    const frame = creatElementNode('div', undefined, { class: 'egg_frame' }, [
        login_frame,
    ]);
    settingItems.push(frame);
    // ËÆæÁΩÆ
    const settingBox = creatElementNode('div', undefined, { class: 'egg_setting_box' }, settingItems);
    // ËèúÂçï
    const menu = creatElementNode('div', undefined, {
        id: 'settingData',
        class: `egg_menu${hasMobile() ? ' mobile' : ''}`,
    }, settingBox);
    // Ê†πÂÆπÂô®
    const base = creatElementNode('div', undefined, undefined, menu);
    // ÊèíÂÖ•ËäÇÁÇπ
    document.body.append(base);
    // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
    await loadUserInfo();
    console.log('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ');
    // Âä†ËΩΩÂàÜÊï∞‰ø°ÊÅØ
    await loadScoreInfo();
    console.log('Âä†ËΩΩÂàÜÊï∞‰ø°ÊÅØ');
    // Âä†ËΩΩ‰ªªÂä°ÂàóË°®
    await loadTaskList();
    console.log('Âä†ËΩΩ‰ªªÂä°ÂàóË°®');
    // Ê∏≤ÊüìÂºÄÂßãÊåâÈíÆ
    if (login) {
        // ÂºÄÂßãÂ≠¶‰π†ÊåâÈíÆ
        const startButton = creatElementNode('button', { innerText: 'ÂºÄÂßãÂ≠¶‰π†' }, {
            id: 'startButton',
            class: 'egg_study_btn',
            type: 'button',
            onclick: start,
        });
        // ËÆæÁΩÆÈ°π
        const item = creatElementNode('div', undefined, { class: 'egg_setting_item egg_start_btn' }, startButton);
        settingBox.append(item);
        // ÂÆåÊàê‰ªªÂä°
        if (tasks.every((task) => task.status)) {
            finishTask();
        }
    }
    // Ëá™Âä®Á≠îÈ¢ò
    if (login && settings[6]) {
        await createTip('Âç≥Â∞ÜÂºÄÂßãËá™Âä®Á≠îÈ¢ò', 5);
        // ÂÜçÊ¨°Êü•ÁúãÊòØÂê¶ÂºÄÂêØ
        if (settings[6] && !started) {
            createTip('ÂºÄÂßãËá™Âä®Á≠îÈ¢ò', 2);
            start();
        }
        else {
            createTip('Â∑≤ÂèñÊ∂àËá™Âä®Á≠îÈ¢òÔºÅ', 2);
        }
    }
}
// ÊòØÂê¶ÊòæÁ§∫ÁõÆÂΩï
function showMenu(isShow = true) {
    // ËèúÂçï
    const menu = $$('.egg_menu')[0];
    menu.style.display = isShow ? 'block' : 'none';
}
// ÁôªÂΩïÁä∂ÊÄÅ
function loginStatus() {
    return new Promise((resolve) => {
        const timer = setInterval(() => {
            // Ëé∑Âèñtoken
            if (getCookie('token')) {
                clearInterval(timer);
                resolve(true);
            }
        }, 100);
    });
}
// ÁôªÂΩïÁ™óÂè£
async function loginWindow() {
    // egg_frame_login
    const frame_login = $$('.egg_frame_login')[0];
    // ÈÖçÁΩÆ
    const frame = $$('.egg_frame')[0];
    if (frame_login) {
        let iframe = frame_login.querySelector('iframe');
        if (!iframe) {
            iframe = creatElementNode('iframe');
            frame_login.append(iframe);
        }
        frame.classList.add('active');
        // ÁôªÂΩïÈ°µÈù¢
        iframe.src = URL_CONFIG.login;
        // Âà∑Êñ∞
        const timer = window.setInterval(() => {
            console.log('ÁôªÂΩïÂà∑Êñ∞');
            // ÁôªÂΩïÂà∑Êñ∞
            iframe.src = URL_CONFIG.login;
        }, 100000);
        // ÁôªÂΩïÁä∂ÊÄÅ
        const res = await loginStatus();
        if (res) {
            // ÁôªÂΩïÊàêÂäü
            window.clearInterval(timer);
            console.log('ÁôªÂΩïÊàêÂäüÔºÅ');
            window.location.reload();
            return;
        }
        return;
    }
}
// Â≠¶‰π†
async function study() {
    console.log('ÂºÄÂßãÂ≠¶‰π†');
    // ÊöÇÂÅú
    await pauseStudyLock();
    // ‰ªªÂä°
    if (tasks.length) {
        // Ê£ÄÊü•Êñ∞Èóª
        if (settings[0] && !tasks[0].status) {
            console.log('‰ªªÂä°‰∏ÄÔºöÁúãÊñ∞Èóª');
            // ÊöÇÂÅú
            await pauseStudyLock();
            // ÁúãÊñ∞Èóª
            await readNews();
        }
        if (settings[1] && !tasks[1].status) {
            console.log('‰ªªÂä°‰∫åÔºöÁúãËßÜÈ¢ë');
            // ÊöÇÂÅú
            await pauseStudyLock();
            // ÁúãËßÜÈ¢ë
            await watchVideo();
        }
        // Ê£ÄÊü•ÊØèÊó•Á≠îÈ¢ò
        if (settings[2] && !tasks[2].status) {
            console.log('‰ªªÂä°‰∏âÔºöÂÅöÊØèÊó•Á≠îÈ¢ò');
            // ÊöÇÂÅú
            await pauseStudyLock();
            // ÂÅöÊØèÊó•Á≠îÈ¢ò
            await doExamPractice();
        }
        // Ê£ÄÊü•ÊØèÂë®Á≠îÈ¢ò
        if (settings[3] && !tasks[3].status) {
            console.log('‰ªªÂä°ÂõõÔºöÂÅöÊØèÂë®Á≠îÈ¢ò');
            // ÊöÇÂÅú
            await pauseStudyLock();
            // ÂÅöÊØèÂë®Á≠îÈ¢ò
            const res = await doExamWeekly();
            // Êó†È¢òÂèØÂÅö
            if (!res) {
                // Â¶ÇÊûúÊòØÂÖ®ÈÉΩÂÆåÊàê‰∫ÜÔºåÂ∑≤ÁªèÊ≤°ÊúâËÉΩÂÅöÁöÑ‰∫Ü
                tasks[3].status = true;
                // ËøõÂ∫¶Êù°ÂØπË±°
                const taskProgressList = $$('.egg_progress');
                // ËøõÂ∫¶Êù°
                const bar = taskProgressList[3].querySelector('.egg_bar');
                // ÁôæÂàÜÊØî
                const percent = taskProgressList[3].querySelector('.egg_percent');
                // ÈïøÂ∫¶
                bar.style.width = `100%`;
                // ÊñáÂ≠ó
                percent.innerText = `100%`;
            }
        }
    }
    // Ê£ÄÊü•‰∏ìÈ°πÁªÉ‰π†
    if (settings[4] && !tasks[4].status) {
        console.log('‰ªªÂä°‰∫îÔºöÂÅö‰∏ìÈ°πÁªÉ‰π†');
        // ÊöÇÂÅú
        await pauseStudyLock();
        // ÂÅö‰∏ìÈ°πÁªÉ‰π†
        const res = await doExamPaper();
        // Êó†È¢òÂèØÂÅö
        if (!res) {
            // Â¶ÇÊûúÊòØÂÖ®ÈÉΩÂÆåÊàê‰∫ÜÔºåÂ∑≤ÁªèÊ≤°ÊúâËÉΩÂÅöÁöÑ‰∫Ü
            tasks[4].status = true;
            // ËøõÂ∫¶Êù°ÂØπË±°
            const taskProgressList = $$('.egg_progress');
            // ËøõÂ∫¶Êù°
            const bar = taskProgressList[4].querySelector('.egg_bar');
            // ÁôæÂàÜÊØî
            const percent = taskProgressList[4].querySelector('.egg_percent');
            // ÈïøÂ∫¶
            bar.style.width = `100%`;
            // ÊñáÂ≠ó
            percent.innerText = `100%`;
        }
    }
}
// ËÆæÁΩÆËøõÂ∫¶Êù°
function setProgress(index, progress) {
    // ËøõÂ∫¶Êù°ÂØπË±°
    const taskProgressList = $$('.egg_progress');
    // ËøõÂ∫¶Êù°
    const bar = taskProgressList[index].querySelector('.egg_bar');
    // ÁôæÂàÜÊØî
    const percent = taskProgressList[index].querySelector('.egg_percent');
    // ÈïøÂ∫¶
    bar.style.width = `${progress}%`;
    // ÊñáÂ≠ó
    percent.innerText = `${progress}%`;
}
// ÊöÇÂÅú‰ªªÂä°
function pauseTask() {
    // ÂºÄÂßãÊåâÈíÆ
    const startButton = $$('#startButton')[0];
    pauseStudy = true;
    startButton.innerText = 'ÁªßÁª≠Â≠¶‰π†';
    startButton.classList.remove('loading');
    startButton.removeEventListener('click', pauseTask);
    startButton.addEventListener('click', continueTask);
}
// ÁªßÁª≠‰ªªÂä°
function continueTask() {
    // ÂºÄÂßãÊåâÈíÆ
    const startButton = $$('#startButton')[0];
    pauseStudy = false;
    startButton.innerText = 'Ê≠£Âú®Â≠¶‰π†ÔºåÁÇπÂáªÊöÇÂÅú';
    startButton.classList.add('loading');
    startButton.removeEventListener('click', continueTask);
    startButton.addEventListener('click', pauseTask);
}
// ÂÆåÊàê‰ªªÂä°
function finishTask() {
    // ÂºÄÂßãÊåâÈíÆ
    const startButton = $$('#startButton')[0];
    startButton.innerText = 'Â∑≤ÂÆåÊàê';
    startButton.classList.remove('loading');
    startButton.classList.add('disabled');
    startButton.setAttribute('disabled', '');
}
// ÂºÄÂßã
async function start() {
    // ‰øùÂ≠òÈÖçÁΩÆ
    console.log('ÂàùÂßãÂåñ...');
    console.log('Ê£ÄÊü•ÊòØÂê¶ÁôªÂΩï...');
    if (login) {
        started = true;
        // ÂºÄÂßãÊåâÈíÆ
        const startButton = $$('#startButton')[0];
        startButton.innerText = 'Ê≠£Âú®Â≠¶‰π†ÔºåÁÇπÂáªÊöÇÂÅú';
        startButton.classList.add('loading');
        startButton.removeEventListener('click', start);
        // ÁÇπÂáªÊöÇÂÅú
        startButton.addEventListener('click', pauseTask);
        // ÈöêËóèËèúÂçï
        if (settings[5]) {
            showMenu(false);
        }
        // Êü•ËØ¢‰ªäÂ§©ËøòÊúâ‰ªÄ‰πà‰ªªÂä°Ê≤°ÂÅöÂÆå
        console.log('Ê£ÄÊü•‰ªäÂ§©ËøòÊúâ‰ªÄ‰πà‰ªªÂä°Ê≤°ÂÅöÂÆå');
        // ‰ªªÂä°
        if (tasks.length) {
            // Â≠¶‰π†
            await study();
            // Êú™ÂÆåÊàê
            if (!tasks.every((task) => task.status)) {
                await study();
            }
            // Âà∑Êñ∞ËèúÂçïÊï∞ÊçÆ
            await refreshMenu();
            finishTask();
            console.log('Â∑≤ÂÆåÊàê');
        }
        if (settings[5]) {
            showMenu();
        }
    }
    else {
        // ÊèêÈÜíÁôªÂΩï
        alert('ËØ∑ÂÖàÁôªÂΩï');
        console.log('ÁôªÂΩï‰∏≠...');
        // ÁôªÂΩïÁ™óÂè£
        await loginWindow();
    }
}

