// ==UserScript==
// @name         e-catalog messages
// @license MIT
// @namespace    http://tampermonkey.net/
// @version      0.18
// @description  Close external product tabs
// @author       e-c
// @include      https://electro.md/*
// @include      https://hamster.md/*
// @include      https://accent.md/*
// @include      https://alo.md/*
// @include      https://extratel.md/*
// @include      https://smarti.md/*
// @include      https://kub.md/*
// @include      https://gorilla.md/*
// @include      https://www.netmarket.md/*
// @include      https://clic.md/*
// @include      https://unicom.md/*
// @include      https://www.texet.md/*
// @include      https://gig.md/*
// @include      https://www.cactus.md/*
// @include      https://casashop.md/*
// @include      https://meserias.md/*
// @include      https://xiaomistore.md/*
// @include      https://costel.md/*
// @include      https://24mag.md/*
// @include      https://www.gsmshop.md/*
// @include      https://itunexx.md/*
// @include      https://grandshop.md/*
// @include      https://nanoteh.md/*
// @include      https://uno.md/*
// @include      https://eshop.moldcell.md/*
// @include      https://eshop.orange.md/*
// @include      http://bestdeal.md/*
// @include      https://eshop.md/*
// @include      http://www.dostavka.md/*
// @include      https://www.fantastic.md*
// @include      https://www.fantastic.md/*
// @include      https://www.fantastic.md/*
// @include      https://doxyterra.md/*
// @include      https://maxmart.md/*
// @include      http://www.desire.md/*
// @include      https://www.desire.md/*
// @include      https://www.zap.md/*
// @include      https://www.pandashop.md/*
// @include      https://smadshop.md/*
// @include      https://maximum.md/*
// @include      https://master-lux.md/*
// @include      https://andromeda.md/*
// @include      https://chasov.md/*
// @include      https://arcticaservice.md/*
// @include      https://h-t.md/*
// @include      https://www.metroterm.md/*
// @include      https://magicshop.md/*
// @include      https://watt.md/*
// @include      https://kamoto.md/*
// @include      https://prime-pc.md/*
// @include      https://yaki.md/*
// @include      https://unitools.md/*
// @include      https://flexmag.md/*
// @include      http://wildmart.md/*
// @include      https://is.md/*
// @include      https://makeup.md/*
// @include      https://climatec.md/*
// @include      https://bestbuy.md/*
// @include      https://smart-climat.md/*
// @include      https://remington.md/*
// @include      http://www.bilgicom.md/*
// @include      https://4elements.md/*
// @include      https://cazan.md/*
// @include      http://automarket.md/*
// @include      https://idvr.md/*
// @include      https://electromotor.md/*
// @include      https://electrolux.com.md/*
// @include      https://autoshina.md/*
// @include      https://gipfel.md/*
// @include      https://stilis.md/*
// @include      https://bigshop.md/*
// @include      https://tehnoconduct.md/*
// @include      https://www.verix.md/*
// @include      https://nanu.md/*
// @include      https://supraten.md/*
// @include      http://www.all4office.md/*
// @include      https://monacu.md/*
// @include      https://instalatii.md/*
// @include      https://pigeon.md/*
// @include      https://rebor.md/*
// @include      http://www.euroterm.md/*
// @include      https://mobileexpert.md/*
// @include      https://ergoform.md/*
// @include      https://mamico.md/*
// @include      https://tehnoinstrument.md/*
// @include      https://garmin.md/*
// @include      https://www.kazane.md/*
// @include      https://euroelitstal.md/*
// @include      https://ogogo.md/*
// @include      https://papirus.md/*
// @include      https://geek.md/*
// @include      https://automall.md/*
// @include      http://emall.md/*
// @include      https://cap-cap.md/*
// @include      https://hikoki.md/*
// @include      https://costel.md/*
// @include      https://agropiese.md/*
// @include      https://www.baby-boom.md/*
// @include      https://dicon.md/*
// @include      https://catollux.md/*
// @include      https://simplex.md/*
// @include      https://www.moldclima.md/*
// @include      https://www.bomba.md/*
// @include      http://www.aiea.md/*
// @include      https://printeq.md/*
// @include      https://mvc.md/*
// @include      https://agroteh.md/*
// @include      https://sad.md/*
// @include      https://cablu.md/*
// @include      https://volta.md/*
// @include      https://mcs.md/*
// @include      https://tina.md/*
// @include      https://altavista.md/*
// @include      https://savor.md/*
// @include      https://instrumente.md/*
// @include      https://integramarket.md/*
// @include      https://lumeainstrumentelor.md/*
// @include      https://www.artmobila.md/*
// @include      https://ascara.md/*
// @include      https://www.nitro.md/*
// @include      https://rozetka.md/*
// @include      https://viral.md/*
// @include      https://trivent.md/*
// @include      https://www.printerra.md/*
// @include      https://premiumstore.md/*
// @include      https://optim.md/*
// @include      https://teplomall.md/*
// @include      http://baieplus.md/*
// @include      https://atehno.md/*
// @include      https://zanussi.com.md/*
// @include      https://aircomfort.md/*
// @include      https://damicom.md/*
// @include      http://www.inksystem.md/*
// @include      https://www.pride.md/*
// @include      https://zumarket.md/*
// @include      https://karchershop.md/*
// @include      http://daikin-shop.md/*
// @include      https://limon.md/*
// @include      https://altep.md/*
// @include      http://avemdetoate.md/*
// @include      https://fabrikhome.md/*
// @include      https://gefest.md/*
// @include      https://jara.md/*
// @include      https://amber.md/*
// @include      https://muncitorul.md/*
// @include      https://mediamusic.md/*
// @include      https://termoformat.md/*
// @include      https://promstore.md/*
// @include      https://tehnoterm.md/*
// @include      https://shoptools.md/*
// @include      http://leoshop.md/*
// @include      https://www.termostar.md/*
// @include      https://xstyle.md/*
// @include      https://nord-line.md/*
// @include      https://econstruct.md/*
// @include      https://shopit.md/*
// @include      https://termalex.md/*
// @include      https://www.foxmart.md/*
// @include      https://teploplus.md/*
// @include      https://robertino.md/*
// @include      https://www.cauciucuri.md/*
// @include      https://daikin.com.md/*
// @include      https://imperia.md/*
// @include      https://electroplus.md/*
// @include      https://refurb.md/*
// @include      https://uniplast.md/*
// @include      https://casamea.md/*
// @include      http://proglobus.md/*
// @include      https://gtm.md/*
// @include      https://comp.md/*
// @include      https://eurosanteh.md/*
// @include      https://mastertool.md/*
// @include      https://termoplus.md/*
// @include      https://termo.md/*
// @include      https://term.md/*
// @include      https://tehnoline.md/*
// @include      https://santehmarket.md/*
// @include      https://robinet.md/*
// @include      https://printer.md/*
// @include      https://magstore.md/*
// @include      https://megabait.md/*
// @include      https://toybox.md/*
// @include      https://f24.md/*
// @include      https://neocomputer.md/*
// @include      https://flexmag.md/*
// @include      https://www.s-comp.md/*
// @include      https://matrix.md/*
// @include      http://mgh.md/*
// @include      https://tshop.md/*
// @include      https://zummer.md/*
// @include      https://computers.md/*
// @include      http://tehnomag.md/*
// @include      http://iremax.md/*
// @include      https://nonstop.md/*
// @include      https://casacurata.md/*
// @include      https://tisam.md/*
// @include      https://teplokom.md/*
// @include      https://www.practic.md/*
// @include      https://xstore.md/*
// @include      http://www.impreso.md/*
// @include      https://elcora.md/*
// @include      https://darwin.md/*
// @include      https://byone.md/*
// @include      https://deliver.md/*
// @include      https://exterior.md/*
// @include      https://electron.md/*
// @include      https://expertsecurity.md/*
// @include      https://www.musicshop.md/*
// @include      https://livrez.md/*
// @include      https://www.technodom.md/*
// @include      https://kazinst.md/*
// @include      https://overlock.md/*

// @include      https://www.oneshop.md/*
// @include      https://melon.md/*
// @include      https://relaxe.md/*
// @include      https://damalio.md/*
// @include      https://centrale.md/*
// @include      https://www.telemarket.md/*
// @include      https://power-tools.md/*
// @include      https://ultra.md/*
// @include      https://lamashop.md/*
// @include      https://gamestop.md/*
// @include      https://termocontrol.md/*
// @include      https://www.eldorado.ru/*
// @include      https://www.eldorado.ru/*
// @include      https://www.compari.ro/*
// @include      https://www.emag.ro/*
// @include      https://www.mvideo.ru/*
// @include      https://enter.online/*
// @include      https://www.smart.md/*
// @include      https://www.magico.md/*
// @include      https://zummer.md/*
// @include      https://computers.md/*
// @include      https://fotomax.md/*
// @include      https://termotrade.md/*

// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/481898/e-catalog%20messages.user.js
// @updateURL https://update.greasyfork.org/scripts/481898/e-catalog%20messages.meta.js
// ==/UserScript==
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

	// window.addEventListener('message', event => {
	//     // IMPORTANT: check the origin of the data!
	//     if (event.origin.startsWith('https://e-catalog.md')) {
	//         // The data was sent from your site.
	//         // Data sent with postMessage is stored in event.data:
 //            event.source.postMessage(location.href, event.origin);
	//     } else {
	//         // The data was NOT sent from your site!
	//         // Be careful! Do not use it. This else branch is
	//         // here just for clarity, you usually shouldn't need it.
	//         return;
	//     }
	// });

	window.addEventListener('message', event => {
	    // IMPORTANT: check the origin of the data!
	    if (event.origin.startsWith('https://e-catalog.md') || event.origin.startsWith('http://ecatalog.loc')) {
	        // The data was sent from your site.
	        // Data sent with postMessage is stored in event.data:
	        // console.log(event.data);
	        // alert(event.data);
	        copyToClipboard(event.data);
	        event.source.postMessage(location.href, event.origin);
            // NEW place search in input
	    } else {
	        // The data was NOT sent from your site!
	        // Be careful! Do not use it. This else branch is
	        // here just for clarity, you usually shouldn't need it.
	        return;
	    }
	});

	document.body.addEventListener("keydown", function(e){
	    if (e.keyCode === 83 && e.altKey) {
			window.opener.postMessage("alt+s", "*");
	    }
	});

    const copyToClipboard = str => {
	    const el = document.createElement('textarea');
	    el.value = str;
	    el.setAttribute('readonly', '');
	    el.style.position = 'absolute';
	    el.style.left = '-9999px';
	    document.body.appendChild(el);
	    el.select();
	    document.execCommand('copy');
	    document.body.removeChild(el);
	};

})();