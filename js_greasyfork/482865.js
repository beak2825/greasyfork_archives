// ==UserScript==
// @name         CSDN、知乎、简书浏览体验优化脚本
// @namespace    https://github.com/liehuoe/tampermonkey_script
// @version      0.3.8
// @author       liehuoe
// @description  为了查资料时拥有最好的阅读体验，致力于优化所有博客网站的无关元素
// @license      GPLv3
// @match        https://*.zhihu.com/*
// @match        https://*.csdn.net/*
// @match        https://*.jianshu.com/*
// @match        https://*.juejin.cn/*
// @match        https://*.51cto.com/*
// @match        http://*.360doc.com/*
// @match        https://*.bilibili.com/*
// @match        https://*.segmentfault.com/*
// @icon         data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNzAxNDAzMDEwODAzIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijg1NTgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiI+PHBhdGggZD0iTTMyIDY0TDk2IDB2MTAyNGwtNjQtNjRoOTI2LjQ3NmwtNjQgNjRWMGw2NCA2NEgzMnpNOTU4LjQ3NiAwdjEwMjRIMzJWMGg5MjYuNDc2eiIgcC1pZD0iODU1OSIgZmlsbD0iI2Q0MjM3YSI+PC9wYXRoPjxwYXRoIGQ9Ik0xNzguMjg2IDIxMC4yODZsNjQtNjR2MjkyLjU3MWwtNjQtNjRIODEyLjE5bC02NCA2NFYxNDYuMjg2bDY0IDY0SDE3OC4yODZ6IG02MzMuOTA0LTY0djI5Mi41NzFIMTc4LjI4NlYxNDYuMjg2SDgxMi4xOXpNMTc4LjI4NiA3NDYuNjY3bDY0LTY0djE5NS4wNDdsLTY0LTY0SDgxMi4xOWwtNjQgNjRWNjgyLjY2N2w2NCA2NEgxNzguMjg2eiBtNjMzLjkwNC02NHYxOTUuMDQ3SDE3OC4yODZWNjgyLjY2N0g4MTIuMTl6TTc4Ny44MSA1OTIuNzYyYzE3LjY3MyAwIDMyLTE0LjMyNyAzMi0zMiAwLTE3LjY3My0xNC4zMjctMzItMzItMzJIMjAyLjY2N2MtMTcuNjczIDAtMzIgMTQuMzI3LTMyIDMyIDAgMTcuNjczIDE0LjMyNyAzMiAzMiAzMkg3ODcuODF6IiBwLWlkPSI4NTYwIiBmaWxsPSIjZDQyMzdhIj48L3BhdGg+PC9zdmc+
// @run-at       document-start
// @grant        GM_addStyle
// @grant        unsafeWindow
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_getValue
// @grant        GM_setValue
// @downloadURL https://update.greasyfork.org/scripts/482865/CSDN%E3%80%81%E7%9F%A5%E4%B9%8E%E3%80%81%E7%AE%80%E4%B9%A6%E6%B5%8F%E8%A7%88%E4%BD%93%E9%AA%8C%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC.user.js
// @updateURL https://update.greasyfork.org/scripts/482865/CSDN%E3%80%81%E7%9F%A5%E4%B9%8E%E3%80%81%E7%AE%80%E4%B9%A6%E6%B5%8F%E8%A7%88%E4%BD%93%E9%AA%8C%E4%BC%98%E5%8C%96%E8%84%9A%E6%9C%AC.meta.js
// ==/UserScript==

(()=>{function d(t,e){window.addEventListener("load",t,{once:!0,capture:e})}function c(t,e){e||(e=document.body);let o=new MutationObserver(i=>i.forEach(t));return o.observe(e,{childList:!0,subtree:!0}),o}function r(t){let e=t();if(!e)return;let o=c(()=>{e.parentElement||(e=t())},e.parentElement);d(()=>o.disconnect())}function y(t){t.parentNode.replaceChild(t.cloneNode(!0),t)}var n=!1;function f(){n=GM_getValue("autoWidthDisabled");let e=GM_registerMenuCommand(`${n?"\u{1F532}":"\u2705"}\u5BBD\u5C4F\u5904\u7406`,()=>{GM_setValue("autoWidthDisabled",!n),GM_unregisterMenuCommand(e),f(),location.reload()})}f();var a={global:S,home:G,video:w,zhuanlan:x,tardis_zm:b,question:v,topic:L};function S(){document.addEventListener("scroll",e=>e.stopPropagation(),!0);let t=[GM_addStyle(".Modal-wrapper{display:none !important}"),GM_addStyle("html{overflow:auto !important; margin-right: 0 !important}")];d(()=>{let e=0,o=setInterval(()=>{let i=document.querySelector(".signFlowModal>.Modal-closeButton");i?(e++,i.click()):e=0,e===0&&(t.forEach(l=>l?.remove()),clearInterval(o))},1e3)}),GM_addStyle('div[style*="margin-top: 16px"][style*="position: fixed"]{display:none !important}'),GM_addStyle('div[style*="transform-origin: center bottom"][style*="margin-top: -6px"]{display:none !important}'),d(()=>{c(e=>{let o="link.zhihu.com/?target=";[...e.target.querySelectorAll(`a.external[href*="${o}"]`),...e.target.querySelectorAll(`a.LinkCard[href*="${o}"]`)].forEach(i=>{i.href=decodeURIComponent(i.href.slice(i.href.indexOf(o)+o.length))})})}),n||GM_addStyle('div[tabindex="0"]:has(.Modal-content){width:calc(100vw - 150px)}')}function G(){n||(GM_addStyle(".Topstory-container{width:auto !important}"),GM_addStyle(".Topstory-mainColumn{flex:1 !important}"))}function w(){n||GM_addStyle(".ZVideo{max-width:unset !important}")}function x(){GM_addStyle(".PageHeader.is-shown{display:none !important}"),GM_addStyle(".Sticky.is-fixed{position:sticky !important}"),GM_addStyle(".RichContent-actions.is-fixed{display:none !important}"),n||(GM_addStyle(".Post-Row-Content-right{display:none !important}"),GM_addStyle(".Post-Row-Content{width:auto !important;}"),GM_addStyle(".Post-Row-Content-left{width:100% !important;}"))}function b(){GM_addStyle(".sgui-header{display:none !important}"),GM_addStyle(".Container{margin-top: 0 !important}"),n||(GM_addStyle(".Container{max-width:unset !important}"),GM_addStyle(".Container>.Question-main img{width:auto !important}"))}function v(){n||(GM_addStyle(".Question-main{width: auto !important;max-width: 100%;}"),GM_addStyle(".Question-main > .ListShortcut{flex:1 !important; min-width:0 !important; display: flex;}"),GM_addStyle(".Question-mainColumn{flex: 1 !important; min-width:0 !important; margin-right:10px !important}"),GM_addStyle(".Question-mainColumn img{width:auto !important}"),GM_addStyle(".AuthorInfo{max-width: none !important;}")),GM_addStyle(".AppBanner{display: none !important;}"),GM_addStyle(".Question-mainColumnLogin{display: none !important;}"),GM_addStyle(".AppHeader.is-fixed{display:none !important}"),GM_addStyle(".RichContent-actions.is-fixed{display:none !important}"),document.addEventListener("copy",t=>t.stopPropagation(),!0)}function L(){n||GM_addStyle("#root .App-main > div:has(#TopicMain){max-width: calc(100% - 20px) !important;}")}var h={blog:E};function E(){document.addEventListener("scroll",t=>t.stopPropagation(),!0),r(()=>{let t;return t=GM_addStyle("footer + div{display:none !important;}"),GM_addStyle("aside > section + div{display:none !important;}"),n||(GM_addStyle('div[role="main"]{width:auto !important;}'),GM_addStyle('div[role="main"] > div:first-child{flex:1 !important;width:0 !important;}')),GM_addStyle('div[role="main"] > div:first-child > section:first-child ~ section{display:none !important;}'),t})}var s={blog:k,article:C};function k(){GM_addStyle(".recommend-video{display:none !important;}"),GM_addStyle(".action-aside-left{display:none !important;}"),GM_addStyle("aside.minmenu{display:none !important;}"),document.addEventListener("copy",t=>t.stopPropagation(),!0),document.addEventListener("keydown",t=>t.stopPropagation(),!0),n||(GM_addStyle("#page_center{width: calc(100% - 20px);display: flex;}"),GM_addStyle("#page_center>.detail-content-left{flex: 1;margin-right: 10px;}"))}function C(){GM_addStyle(".left-window{display: none;}"),GM_addStyle(".article-right{display: none;}"),GM_addStyle(".suspension-pendant_r{display: none;}"),GM_addStyle(".components-common-suspension{display: none !important;}"),n||(GM_addStyle(".article{width: calc(100% - 20px) !important;}"),GM_addStyle(".article>.article-left{width: 100% !important;}"))}var _={blog:P};function P(){GM_addStyle(".doc360article_content{width:fit-content !important;padding:0 !important;}"),document.addEventListener("scroll",t=>t.stopPropagation(),!0),GM_addStyle(".doc360article_content>.a_right{display:none !important;}"),GM_addStyle("#goTop2{display:none !important;}"),GM_addStyle(".floatqrcode{display:none !important;}"),GM_addStyle("#divyoulikeadtitle{display:none !important;}"),GM_addStyle("#contextmenudivmouseup{display:none !important;}"),GM_addStyle(".atfixednav{display:none !important;}"),document.addEventListener("copy",t=>t.stopPropagation(),!0),document.addEventListener("contextmenu",t=>t.stopPropagation(),!0),document.addEventListener("keydown",t=>t.stopPropagation(),!0),n||(GM_addStyle(".doc360article_content>.a_left{width:100% !important;}"),GM_addStyle(".doc360article_content>.a_left>#bgchange{width:100% !important;padding:18px 20px 0 !important;box-sizing:border-box !important;}"),GM_addStyle("#articlecontent>table{width:100% !important;}"),d(()=>{document.getElementById("articlecontent").querySelectorAll('*[style*="max-width:"]').forEach(e=>{e.style.maxWidth="unset"})}))}var u={blog:q,blog_new:A};function q(){GM_addStyle(".login-panel-popover{display:none !important;}"),GM_addStyle(".fixed-top-header{display:none !important;}"),GM_addStyle(".fixed-header{position:unset !important;}"),document.addEventListener("scroll",t=>t.stopPropagation(),!0),n||(GM_addStyle(".article-detail{width:calc(100% - 90px) !important;margin-right:80px !important;}"),GM_addStyle(".right-side-bar{margin-left:0 !important;right:10px !important;}"),GM_addStyle("#article-content{padding:0 !important;}"))}function A(){GM_addStyle(".login-panel-popover{display:none !important;}"),GM_addStyle(".fixed-author-header{display:none !important;}"),GM_addStyle(".fixed-header{position:unset !important;}"),document.addEventListener("scroll",t=>t.stopPropagation(),!0),n||(GM_addStyle(".opus-detail{width:calc(100% - 90px) !important;margin:0 10px !important;}"),GM_addStyle(".right-sidebar-wrap{margin-left:0 !important;right:10px !important;}"))}var g={blog:W};function W(){GM_addStyle(".article-suspended-panel{display:none !important;}"),GM_addStyle(".article-catalog ~ div{display:none !important;}"),GM_addStyle(".article-catalog .catalog-body{max-height:unset !important;}"),GM_addStyle(".bottom-login-guide{display:none !important;}"),GM_addStyle("*:has(~ .to-top-btn){display:none !important;}"),GM_addStyle(".global-float-banner{display:none !important;}"),GM_addStyle(".post-bottom-right{display:none !important;}"),GM_addStyle(".recommended-area{display:none !important;}"),n||(GM_addStyle(".main-container{max-width:unset !important;width:calc(100% - 30px) !important;}"),GM_addStyle(".main-area{width:calc(100% - 25rem - 20px) !important;}")),document.addEventListener("copy",t=>t.stopPropagation(),!0),d(()=>{let t=document.getElementById("article-root");if(!t)return;let e=["link.juejin.cn?target=","link.juejin.cn/?target="];e.map(o=>t.querySelectorAll(`a[href*="${o}"]`)).reduce((o,i)=>[...o,...i],[]).forEach(o=>{for(let i of e){let l=o.href.indexOf(i);if(l!==-1){o.href=decodeURIComponent(o.href.slice(l+i.length));break}}})})}var p={global:z,blog:j,wenku:D};function z(){GM_addStyle(".csdn-toolbar-creative-mp{display:none !important}"),GM_addStyle(".csdn-side-toolbar{display:none !important}")}function j(){GM_addStyle("#csdn-toolbar-profile-nologin{display:none !important}"),GM_addStyle(".hide-article-box{padding-top:0 !important;margin-top:30px !important}"),GM_addStyle("#article_content{height:auto !important}"),GM_addStyle(".main_father .blog_container_aside{display:none !important}"),GM_addStyle("#csdn-toolbar{position:relative !important}"),GM_addStyle(".main_father #toolBarBox .left-toolbox{position:relative !important;left:0 !important; width:100% !important}"),GM_addStyle(".main_father #rightAside{display:none !important}"),GM_addStyle(".main_father #rightAsideConcision{display:block !important;margin-left:10px !important;}"),GM_addStyle(".main_father{height:auto !important}"),GM_addStyle(".main_father #rightAsideConcision{height:auto !important}"),GM_addStyle(".main_father #rightAsideConcision #recommend-right-concision{position:sticky !important;top:10px !important;}"),GM_addStyle("#groupfileConcision > .groupfile-div1{max-height:calc(100vh - 66px) !important}"),n?GM_addStyle(".main_father #mainBox{width:auto !important;margin-right:0 !important;}"):(GM_addStyle(".main_father #mainBox{flex:1 !important; width:0 !important; margin-right:0 !important;}"),GM_addStyle(".main_father #mainBox > main{width:100% !important}")),GM_addStyle(".tool-active-list{display:none !important}"),GM_addStyle("#tool-share{display:none !important}"),GM_addStyle(".passport-login-tip-container{display:none !important}"),document.addEventListener("scroll",e=>{document.getElementById("recommend-right-concision")||e.stopPropagation()},!0);let t=GM_addStyle(".passport-login-container{display:none !important;}");d(()=>{setTimeout(()=>{t.remove();let e=document.querySelector(".passport-login-container");e&&e.remove()},1e3)}),GM_addStyle("#content_views pre code{user-select:text !important}"),GM_addStyle("#content_views pre{user-select:text !important}"),GM_addStyle("#content_views{user-select:text !important}"),GM_addStyle("#articleSearchTip{display:none !important}"),document.addEventListener("copy",e=>e.stopPropagation(),!0),d(()=>{y(document.querySelector("#content_views")),document.querySelectorAll('#article_content a:not([href*="csdn.net"])').forEach(e=>{e.addEventListener("mouseover",o=>o.stopPropagation(),!0),e.addEventListener("click",o=>o.stopPropagation(),!0),e.target||(e.target="_blank")})},!0)}function D(){GM_addStyle(".article-box > .cont{max-height:unset !important}"),GM_addStyle(".article-box > .cont > .open {display:none !important}"),GM_addStyle(".layout-right {display:none !important}"),n||GM_addStyle(".layout-center {width:100% !important}")}var m={global:B,wenda:I,blog:R};function B(){document.addEventListener("scroll",t=>t.stopPropagation(),!0)}function I(){r(()=>{let t;return t=GM_addStyle("#sf-header{position:relative !important;}"),n||(GM_addStyle("#question-wrap{max-width:unset !important;}"),GM_addStyle("#questionMain .functional-area-left{display:none !important;}"),GM_addStyle("#questionMain+.right-side{display:none !important;}")),t})}function R(){r(()=>{let t;return n||(t=GM_addStyle(".article-wrap{max-width:unset !important;}"),GM_addStyle(".article-wrap .row>div:has(.article.article-content ){flex:1;}"),GM_addStyle(".article-wrap .row>div:has(>.functional-area-left){display:none !important;}"),GM_addStyle(".article-wrap .row>div:has(.article.article-content )+div:not(:has(#article-nav-list)){display:none !important;}"),GM_addStyle("#__next>.container:has(+footer){max-width:100% !important;}"),GM_addStyle("#__next>.container:has(+footer)>.row>.mx-auto{flex:1 !important;}")),t})}var Q={com:{zhihu:{func:a.global,zhuanlan:{func:a.zhuanlan},www:{leaf:a.home,follow:{leaf:a.home},hot:{leaf:a.home},zvideo:{leaf:a.home,func:a.video},question:{func:a.question},tardis:{zm:{func:a.tardis_zm},bd:{func:a.tardis_zm}},topic:{func:a.topic},column:{func:a.zhuanlan}}},jianshu:{www:{p:{func:h.blog}}},"51cto":{blog:{func:s.blog},www:{article:{func:s.article}}},"360doc":{www:{content:{func:_.blog}}},bilibili:{www:{read:{func:u.blog},opus:{func:u.blog_new}}},segmentfault:{func:m.global,q:{func:m.wenda},a:{func:m.blog}}},cn:{juejin:{post:{func:g.blog}}},net:{csdn:{func:p.global,blog:{func:p.blog},wenku:{func:p.wenku}}}};function M(t,e){let o=t[e[0]];e=e.slice(1);let i=!0;return o&&(e.length===0?o.leaf&&(i=o.leaf()!==!1):i=M(o,e)!==!1),i&&t.func&&(i=t.func()!==!1),i}var T=unsafeWindow.location.pathname.split("/").slice(1),$=unsafeWindow.location.hostname.split(".");M(Q,[...$.reverse(),...T].filter(t=>t));})();
