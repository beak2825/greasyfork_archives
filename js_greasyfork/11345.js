// ==UserScript==
// @name                WME Polygon Kota SOLOK
// @namespace           
// @description         Polygons Kota Solok, Sumatra Barat di WME layer
// @include             https://www.waze.com/editor/*
// @include             https://www.waze.com/*/editor/*
// @include             https://editor-beta.waze.com/*
// @version             1.4.6
// @grant               none
// @copyright           2015 hardian_n(4)- ci2212 (6)
// @downloadURL https://update.greasyfork.org/scripts/11345/WME%20Polygon%20Kota%20SOLOK.user.js
// @updateURL https://update.greasyfork.org/scripts/11345/WME%20Polygon%20Kota%20SOLOK.meta.js
// ==/UserScript==


//---------------------------------------------------------------------------------------
function bootstrap_MapOverlay()
{
  var bGreasemonkeyServiceDefined = false;

  try {
    bGreasemonkeyServiceDefined = (typeof Components.interfaces.gmIGreasemonkeyService === "object");
  }
  catch (err) { /* Ignore */ }

  if (typeof unsafeWindow === "undefined" || ! bGreasemonkeyServiceDefined) {
    unsafeWindow    = ( function () {
      var dummyElem = document.createElement('p');
      dummyElem.setAttribute('onclick', 'return window;');
      return dummyElem.onclick();
    }) ();
  }

    /* begin running the code! */
    setTimeout(InitMapOverlay, 1000);
}

function AddMapPoligon(mapLayer,kabPoints,kabColor,kabNumber){
    
    var mro_Map = unsafeWindow.Waze.map;
    var mro_OL = unsafeWindow.OpenLayers;
    var mapGroupLabel = '' + kabNumber;
    var mapName = 'mapGroup' + kabNumber;
    
    var style = {
        strokeColor: kabColor,
        strokeOpacity: '.8',
        strokeWidth: 3,
        fillColor: kabColor,
        fillOpacity: 0.15,
        label: mapGroupLabel,
        labelOutlineColor: "black",
        labelOutlineWidth: 3,
        fontSize: 14,
        fontColor: kabColor,
        fontOpacity: '.85',
        fontWeight: "bold"  
    };
    
    var attributes = {
        name: mapName,
        number: kabNumber
    };
    
    var pnt= [];
    for(i=0;i<kabPoints.length;i++){
        convPoint = new OpenLayers.Geometry.Point(kabPoints[i].lon,kabPoints[i].lat).transform(new OpenLayers.Projection("EPSG:4326"), mro_Map.getProjectionObject());
        pnt.push(convPoint);
    }
		       
    var ring = new mro_OL.Geometry.LinearRing(pnt);
    var polygon = new mro_OL.Geometry.Polygon([ring]);
    
    var feature = new mro_OL.Feature.Vector(polygon,attributes,style);
    mapLayer.addFeatures([feature]);

}

function CurrentMapLocation(kab_mapLayer){
    var mro_Map = unsafeWindow.Waze.map;

    for(i=0;i<kab_mapLayer.features.length;i++){
        var kabMapCenter = mro_Map.getCenter();
        var mapCenterPoint = new OpenLayers.Geometry.Point(kabMapCenter.lon,kabMapCenter.lat);
        var mpCenterCheck = kab_mapLayer.features[i].geometry.components[0].containsPoint(mapCenterPoint);
        //console.log('MapRaid: ' + kab_mapLayer.features[i].attributes.number + ': ' + mpCenterCheck);
        if(mpCenterCheck === true){
        	var mapLocationLabel = ('.WazeControlLocationInfo').text();
    		setTimeout(function(){$('.WazeControlLocationInfo').text(mapLocationLabel)},200);
        }
    }
}

function InitMapOverlay(){

    var mro_Map = unsafeWindow.Waze.map;
    var mro_OL = unsafeWindow.OpenLayers;

    if (mro_Map === null) return;
    if (mro_OL === null) return;

    var mro_mapLayers = mro_Map.getLayersBy("uniqueName","__MapkabGroups");
        
    var kab_mapLayer = new mro_OL.Layer.Vector("Polygon Kota SOLOK", {
        displayInLayerSwitcher: true,
        uniqueName: "__MapkabGroups"
    });
        
    I18n.translations.en.layers.name["__MapkabGroups"] = "Polygon Kota PADANG PANJANG";
    mro_Map.addLayer(kab_mapLayer);
    kab_mapLayer.setVisibility(true);
    
var solok = [{lon:'100.669849',lat:'-0.788124'},{lon:'100.670287',lat:'-0.788006'},{lon:'100.670414',lat:'-0.788454'},{lon:'100.672193',lat:'-0.790083'},{lon:'100.672497',lat:'-0.790389'},{lon:'100.672884',lat:'-0.790092'},{lon:'100.673013',lat:'-0.790268'},{lon:'100.673114',lat:'-0.790592'},{lon:'100.673307',lat:'-0.790657'},{lon:'100.673538',lat:'-0.790805'},{lon:'100.673575',lat:'-0.791046'},{lon:'100.673731',lat:'-0.791278'},{lon:'100.673777',lat:'-0.791491'},{lon:'100.674091',lat:'-0.79189'},{lon:'100.674082',lat:'-0.791992'},{lon:'100.673787',lat:'-0.792298'},{lon:'100.673741',lat:'-0.792474'},{lon:'100.67387',lat:'-0.792548'},{lon:'100.674625',lat:'-0.792112'},{lon:'100.674993',lat:'-0.792158'},{lon:'100.675224',lat:'-0.792204'},{lon:'100.675611',lat:'-0.792556'},{lon:'100.675776',lat:'-0.792927'},{lon:'100.675975',lat:'-0.793202'},{lon:'100.675998',lat:'-0.793233'},{lon:'100.67632',lat:'-0.793363'},{lon:'100.676734',lat:'-0.79339'},{lon:'100.676827',lat:'-0.79352'},{lon:'100.676882',lat:'-0.793705'},{lon:'100.676753',lat:'-0.794104'},{lon:'100.676836',lat:'-0.794373'},{lon:'100.676799',lat:'-0.794586'},{lon:'100.677057',lat:'-0.79453'},{lon:'100.677251',lat:'-0.794614'},{lon:'100.677414',lat:'-0.794847'},{lon:'100.678062',lat:'-0.795767'},{lon:'100.678209',lat:'-0.795976'},{lon:'100.678172',lat:'-0.796226'},{lon:'100.678181',lat:'-0.796338'},{lon:'100.678264',lat:'-0.79643'},{lon:'100.678246',lat:'-0.796542'},{lon:'100.678145',lat:'-0.796607'},{lon:'100.677647',lat:'-0.796635'},{lon:'100.677472',lat:'-0.796718'},{lon:'100.677482',lat:'-0.796959'},{lon:'100.677961',lat:'-0.797682'},{lon:'100.677832',lat:'-0.798099'},{lon:'100.677924',lat:'-0.798572'},{lon:'100.678081',lat:'-0.79885'},{lon:'100.678137',lat:'-0.799147'},{lon:'100.678155',lat:'-0.799536'},{lon:'100.678045',lat:'-0.799888'},{lon:'100.678515',lat:'-0.80012'},{lon:'100.678588',lat:'-0.800194'},{lon:'100.678616',lat:'-0.800732'},{lon:'100.678671',lat:'-0.800917'},{lon:'100.678681',lat:'-0.801575'},{lon:'100.678552',lat:'-0.80165'},{lon:'100.67857',lat:'-0.801872'},{lon:'100.67881',lat:'-0.802113'},{lon:'100.679068',lat:'-0.802808'},{lon:'100.679188',lat:'-0.803392'},{lon:'100.679446',lat:'-0.803716'},{lon:'100.679492',lat:'-0.804124'},{lon:'100.6794',lat:'-0.804301'},{lon:'100.67894',lat:'-0.804421'},{lon:'100.678807',lat:'-0.804616'},{lon:'100.678434',lat:'-0.805163'},{lon:'100.679097',lat:'-0.806071'},{lon:'100.679005',lat:'-0.806192'},{lon:'100.677955',lat:'-0.806804'},{lon:'100.677817',lat:'-0.806814'},{lon:'100.677486',lat:'-0.806758'},{lon:'100.677265',lat:'-0.806971'},{lon:'100.676906',lat:'-0.807036'},{lon:'100.676547',lat:'-0.807157'},{lon:'100.676298',lat:'-0.807305'},{lon:'100.676007',lat:'-0.807431'},{lon:'100.675267',lat:'-0.807751'},{lon:'100.675147',lat:'-0.808214'},{lon:'100.675055',lat:'-0.808354'},{lon:'100.674613',lat:'-0.808029'},{lon:'100.672836',lat:'-0.808512'},{lon:'100.671519',lat:'-0.809338'},{lon:'100.669466',lat:'-0.810089'},{lon:'100.668876',lat:'-0.810377'},{lon:'100.667578',lat:'-0.810748'},{lon:'100.667177',lat:'-0.810781'},{lon:'100.667161',lat:'-0.810782'},{lon:'100.66717',lat:'-0.810795'},{lon:'100.666523',lat:'-0.810879'},{lon:'100.666251',lat:'-0.810914'},{lon:'100.665897',lat:'-0.810416'},{lon:'100.665331',lat:'-0.810037'},{lon:'100.663846',lat:'-0.810156'},{lon:'100.662337',lat:'-0.809279'},{lon:'100.661678',lat:'-0.80954'},{lon:'100.661159',lat:'-0.809232'},{lon:'100.660765',lat:'-0.808796'},{lon:'100.660428',lat:'-0.808212'},{lon:'100.660041',lat:'-0.807809'},{lon:'100.659875',lat:'-0.807642'},{lon:'100.659316',lat:'-0.8074'},{lon:'100.659194',lat:'-0.807079'},{lon:'100.659045',lat:'-0.807187'},{lon:'100.658497',lat:'-0.806444'},{lon:'100.657999',lat:'-0.805983'},{lon:'100.657068',lat:'-0.806064'},{lon:'100.656559',lat:'-0.806293'},{lon:'100.656349',lat:'-0.806387'},{lon:'100.654841',lat:'-0.807502'},{lon:'100.653828',lat:'-0.80774'},{lon:'100.653433',lat:'-0.807645'},{lon:'100.653168',lat:'-0.807408'},{lon:'100.652624',lat:'-0.806678'},{lon:'100.652248',lat:'-0.806578'},{lon:'100.652036',lat:'-0.806246'},{lon:'100.651282',lat:'-0.806484'},{lon:'100.650433',lat:'-0.80646'},{lon:'100.648924',lat:'-0.805441'},{lon:'100.647179',lat:'-0.804397'},{lon:'100.644139',lat:'-0.804351'},{lon:'100.642583',lat:'-0.804565'},{lon:'100.641641',lat:'-0.805016'},{lon:'100.641428',lat:'-0.804566'},{lon:'100.641593',lat:'-0.804115'},{lon:'100.641436',lat:'-0.80355'},{lon:'100.641429',lat:'-0.803551'},{lon:'100.641345',lat:'-0.803339'},{lon:'100.64131',lat:'-0.803044'},{lon:'100.641205',lat:'-0.80272'},{lon:'100.641184',lat:'-0.802565'},{lon:'100.641379',lat:'-0.802121'},{lon:'100.641371',lat:'-0.802065'},{lon:'100.641267',lat:'-0.801347'},{lon:'100.641449',lat:'-0.800994'},{lon:'100.642106',lat:'-0.800871'},{lon:'100.642239',lat:'-0.800846'},{lon:'100.642288',lat:'-0.80067'},{lon:'100.64212',lat:'-0.8001'},{lon:'100.642148',lat:'-0.799846'},{lon:'100.642309',lat:'-0.79986'},{lon:'100.642393',lat:'-0.800093'},{lon:'100.642624',lat:'-0.800353'},{lon:'100.642813',lat:'-0.800191'},{lon:'100.64296',lat:'-0.799958'},{lon:'100.642826',lat:'-0.799571'},{lon:'100.642441',lat:'-0.799029'},{lon:'100.642106',lat:'-0.798725'},{lon:'100.642078',lat:'-0.798698'},{lon:'100.642049',lat:'-0.798114'},{lon:'100.642106',lat:'-0.798102'},{lon:'100.642182',lat:'-0.798086'},{lon:'100.642504',lat:'-0.798128'},{lon:'100.642721',lat:'-0.797966'},{lon:'100.64277',lat:'-0.797818'},{lon:'100.642693',lat:'-0.797649'},{lon:'100.642708',lat:'-0.797283'},{lon:'100.642106',lat:'-0.797024'},{lon:'100.64029',lat:'-0.796241'},{lon:'100.638368',lat:'-0.796242'},{lon:'100.63615',lat:'-0.795201'},{lon:'100.630827',lat:'-0.797138'},{lon:'100.627722',lat:'-0.798479'},{lon:'100.625357',lat:'-0.799522'},{lon:'100.623434',lat:'-0.797885'},{lon:'100.622103',lat:'-0.798035'},{lon:'100.620921',lat:'-0.799673'},{lon:'100.613233',lat:'-0.80176'},{lon:'100.612087',lat:'-0.802065'},{lon:'100.592533',lat:'-0.807275'},{lon:'100.585289',lat:'-0.810404'},{lon:'100.582677',lat:'-0.811351'},{lon:'100.581592',lat:'-0.811745'},{lon:'100.570651',lat:'-0.815024'},{lon:'100.563941',lat:'-0.817922'},{lon:'100.561337',lat:'-0.819047'},{lon:'100.560479',lat:'-0.818961'},{lon:'100.5569',lat:'-0.818602'},{lon:'100.549949',lat:'-0.816074'},{lon:'100.544773',lat:'-0.814885'},{lon:'100.54137',lat:'-0.809081'},{lon:'100.541813',lat:'-0.806997'},{lon:'100.544178',lat:'-0.804466'},{lon:'100.548761',lat:'-0.802827'},{lon:'100.553914',lat:'-0.802688'},{lon:'100.553938',lat:'-0.802675'},{lon:'100.553938',lat:'-0.802675'},{lon:'100.553938',lat:'-0.802675'},{lon:'100.554971',lat:'-0.802065'},{lon:'100.558224',lat:'-0.800144'},{lon:'100.562953',lat:'-0.791955'},{lon:'100.565023',lat:'-0.79121'},{lon:'100.566206',lat:'-0.791507'},{lon:'100.566206',lat:'-0.792698'},{lon:'100.564581',lat:'-0.795824'},{lon:'100.562955',lat:'-0.797314'},{lon:'100.563104',lat:'-0.798951'},{lon:'100.564435',lat:'-0.799695'},{lon:'100.566504',lat:'-0.797908'},{lon:'100.566504',lat:'-0.796866'},{lon:'100.568278',lat:'-0.795674'},{lon:'100.5702',lat:'-0.794483'},{lon:'100.570199',lat:'-0.792101'},{lon:'100.569015',lat:'-0.789422'},{lon:'100.569754',lat:'-0.787933'},{lon:'100.570788',lat:'-0.786742'},{lon:'100.597109',lat:'-0.785095'},{lon:'100.605979',lat:'-0.780626'},{lon:'100.609672',lat:'-0.77214'},{lon:'100.621798',lat:'-0.77273'},{lon:'100.623488',lat:'-0.771924'},{lon:'100.624607',lat:'-0.77139'},{lon:'100.625641',lat:'-0.769603'},{lon:'100.626898',lat:'-0.770292'},{lon:'100.626935',lat:'-0.769268'},{lon:'100.628184',lat:'-0.768311'},{lon:'100.628877',lat:'-0.767709'},{lon:'100.630084',lat:'-0.766322'},{lon:'100.631877',lat:'-0.765386'},{lon:'100.632644',lat:'-0.764709'},{lon:'100.632281',lat:'-0.764293'},{lon:'100.632987',lat:'-0.763516'},{lon:'100.633053',lat:'-0.763203'},{lon:'100.632864',lat:'-0.76252'},{lon:'100.632949',lat:'-0.762208'},{lon:'100.633259',lat:'-0.761876'},{lon:'100.633419',lat:'-0.761449'},{lon:'100.63389',lat:'-0.761193'},{lon:'100.633994',lat:'-0.76107'},{lon:'100.634586',lat:'-0.759354'},{lon:'100.63516',lat:'-0.758576'},{lon:'100.635471',lat:'-0.757969'},{lon:'100.635923',lat:'-0.757666'},{lon:'100.63629',lat:'-0.757021'},{lon:'100.63644',lat:'-0.756613'},{lon:'100.636676',lat:'-0.756433'},{lon:'100.636789',lat:'-0.756158'},{lon:'100.63691',lat:'-0.75448'},{lon:'100.637249',lat:'-0.754025'},{lon:'100.639659',lat:'-0.752726'},{lon:'100.639951',lat:'-0.752252'},{lon:'100.640064',lat:'-0.751512'},{lon:'100.639837',lat:'-0.749853'},{lon:'100.640063',lat:'-0.749313'},{lon:'100.640063',lat:'-0.748953'},{lon:'100.64075',lat:'-0.748478'},{lon:'100.641023',lat:'-0.747796'},{lon:'100.641437',lat:'-0.74754'},{lon:'100.641569',lat:'-0.747341'},{lon:'100.641607',lat:'-0.746848'},{lon:'100.64187',lat:'-0.746241'},{lon:'100.641898',lat:'-0.745966'},{lon:'100.642106',lat:'-0.745654'},{lon:'100.642303',lat:'-0.745359'},{lon:'100.642305',lat:'-0.745361'},{lon:'100.642305',lat:'-0.745361'},{lon:'100.642306',lat:'-0.745359'},{lon:'100.642875',lat:'-0.744519'},{lon:'100.642883',lat:'-0.744507'},{lon:'100.642927',lat:'-0.744499'},{lon:'100.652394',lat:'-0.742853'},{lon:'100.652394',lat:'-0.742853'},{lon:'100.659564',lat:'-0.741606'},{lon:'100.659729',lat:'-0.741577'},{lon:'100.659729',lat:'-0.741577'},{lon:'100.660923',lat:'-0.741355'},{lon:'100.664679',lat:'-0.740654'},{lon:'100.668727',lat:'-0.739899'},{lon:'100.670343',lat:'-0.739598'},{lon:'100.675089',lat:'-0.738712'},{lon:'100.680534',lat:'-0.739452'},{lon:'100.684835',lat:'-0.741647'},{lon:'100.686847',lat:'-0.74311'},{lon:'100.687901',lat:'-0.743877'},{lon:'100.688536',lat:'-0.745601'},{lon:'100.688799',lat:'-0.746314'},{lon:'100.688876',lat:'-0.746524'},{lon:'100.688876',lat:'-0.746524'},{lon:'100.688536',lat:'-0.748941'},{lon:'100.688066',lat:'-0.752283'},{lon:'100.687401',lat:'-0.752908'},{lon:'100.687181',lat:'-0.753859'},{lon:'100.687149',lat:'-0.753998'},{lon:'100.687082',lat:'-0.754287'},{lon:'100.686759',lat:'-0.755683'},{lon:'100.686734',lat:'-0.757164'},{lon:'100.686555',lat:'-0.757983'},{lon:'100.686743',lat:'-0.758491'},{lon:'100.686786',lat:'-0.759369'},{lon:'100.686761',lat:'-0.759464'},{lon:'100.686863',lat:'-0.759567'},{lon:'100.686822',lat:'-0.759679'},{lon:'100.686812',lat:'-0.759695'},{lon:'100.68647',lat:'-0.760024'},{lon:'100.686034',lat:'-0.760343'},{lon:'100.685735',lat:'-0.760653'},{lon:'100.68576',lat:'-0.760877'},{lon:'100.685983',lat:'-0.761135'},{lon:'100.686188',lat:'-0.761307'},{lon:'100.686351',lat:'-0.761651'},{lon:'100.686531',lat:'-0.761832'},{lon:'100.686591',lat:'-0.762004'},{lon:'100.686505',lat:'-0.762228'},{lon:'100.68648',lat:'-0.762444'},{lon:'100.686326',lat:'-0.762599'},{lon:'100.685385',lat:'-0.762625'},{lon:'100.685179',lat:'-0.762504'},{lon:'100.685111',lat:'-0.762194'},{lon:'100.685011',lat:'-0.762114'},{lon:'100.684931',lat:'-0.762048'},{lon:'100.684461',lat:'-0.762892'},{lon:'100.684213',lat:'-0.762944'},{lon:'100.683956',lat:'-0.762901'},{lon:'100.683366',lat:'-0.763117'},{lon:'100.682647',lat:'-0.763582'},{lon:'100.68062',lat:'-0.764728'},{lon:'100.67956',lat:'-0.765917'},{lon:'100.679278',lat:'-0.766408'},{lon:'100.678183',lat:'-0.767235'},{lon:'100.677326',lat:'-0.767618'},{lon:'100.676677',lat:'-0.767908'},{lon:'100.675035',lat:'-0.767969'},{lon:'100.674521',lat:'-0.767952'},{lon:'100.67452',lat:'-0.767956'},{lon:'100.6737',lat:'-0.767728'},{lon:'100.673702',lat:'-0.767734'},{lon:'100.673209',lat:'-0.768092'},{lon:'100.672635',lat:'-0.768878'},{lon:'100.672649',lat:'-0.769966'},{lon:'100.672868',lat:'-0.7706'},{lon:'100.673402',lat:'-0.771536'},{lon:'100.673402',lat:'-0.772142'},{lon:'100.673539',lat:'-0.772955'},{lon:'100.673499',lat:'-0.774263'},{lon:'100.673198',lat:'-0.77531'},{lon:'100.672993',lat:'-0.776371'},{lon:'100.672953',lat:'-0.778148'},{lon:'100.672543',lat:'-0.778906'},{lon:'100.673036',lat:'-0.780476'},{lon:'100.672954',lat:'-0.780862'},{lon:'100.672639',lat:'-0.781151'},{lon:'100.67238',lat:'-0.781661'},{lon:'100.672024',lat:'-0.781909'},{lon:'100.671928',lat:'-0.782198'},{lon:'100.671559',lat:'-0.782584'},{lon:'100.671203',lat:'-0.782543'},{lon:'100.670629',lat:'-0.782778'},{lon:'100.670738',lat:'-0.783025'},{lon:'100.670848',lat:'-0.783328'},{lon:'100.670862',lat:'-0.783866'},{lon:'100.670711',lat:'-0.783976'},{lon:'100.670602',lat:'-0.783756'},{lon:'100.670273',lat:'-0.783728'},{lon:'100.670178',lat:'-0.784114'},{lon:'100.670424',lat:'-0.784871'},{lon:'100.670397',lat:'-0.785271'},{lon:'100.670548',lat:'-0.785505'},{lon:'100.670575',lat:'-0.78607'},{lon:'100.670425',lat:'-0.786221'},{lon:'100.669969',lat:'-0.786342'},{lon:'100.670188',lat:'-0.786494'},{lon:'100.67021',lat:'-0.786791'},{lon:'100.670463',lat:'-0.787323'},{lon:'100.670421',lat:'-0.787685'},{lon:'100.669703',lat:'-0.787812'},{lon:'100.669849',lat:'-0.788124'}];
AddMapPoligon(kab_mapLayer,solok,'#DF0101','Kota SOLOK');


    setTimeout(function(){CurrentMapLocation(kab_mapLayer)},3000);
    mro_Map.events.register("moveend", Waze.map, function(){CurrentMapLocation(kab_mapLayer)});
    mro_Map.events.register("zoomend", Waze.map, function(){CurrentMapLocation(kab_mapLayer)});
        
}

bootstrap_MapOverlay();