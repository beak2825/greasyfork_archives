// ==UserScript==
// @name         âœŒå­¦å­¦ä¹ é€š|æ™ºæ…§æ ‘|å›½å¼€|æ™ºæ…§èŒæ•™|é’ä¹¦å­¦å ‚|åœ¨çº¿100åˆ†|è€ƒæ•™è‚²äº‘è¯¾å ‚|å­¦èµ·plus|å†èµ·èˆª|èžå­¦|Uæ ¡å›­ç­‰ç­‰|å„ç±»ç»§ç»­æ•™è‚²é€šç”¨è§†é¢‘å‡æ”¯æŒè§†é¢‘åŠ é€ŸæœåŠ¡|æŒ‡å®šå€é€ŸâœŒðŸ‘ˆðŸ¥‡
// @namespace    white996_1
// @version      1.1.1
// @description  ã€è¶…æ˜Ÿå­¦ä¹ é€šã€‘ã€æ™ºæ…§æ ‘ã€‘ã€å›½å®¶æ™ºæ…§ä¸­å°å­¦ã€‘ã€uæ ¡å›­ã€‘ã€å›½å®¶å¼€æ”¾å¤§å­¦ã€‘[åœ¨çº¿100åˆ†]ã€è‡ªè€ƒæ•™è‚²äº‘è¯¾å ‚ã€‘ã€èŒæ•™äº‘ç³»åˆ—ã€‘ã€é›¨è¯¾å ‚ç³»åˆ—ã€‘ã€è®¯ç½‘ã€‘ã€æœæ˜Žåœ¨çº¿ã€‘ã€éº¦èƒ½ç½‘ã€‘ã€èžå­¦APPã€‘ã€æŠ€èƒ½äº‘ã€‘ã€168ç½‘æ ¡ã€‘ã€è‹±åŽå­¦å ‚ç³»åˆ—éƒ½å¯ã€‘ã€ç»§ç»­æ•™è‚²ç±»ã€‘ã€æŸ æª¬æ–‡æ‰ã€‘ã€äº¿å­¦å®äº‘ã€‘ã€ä¼˜è¯¾å­¦å ‚ã€‘ã€æ¸…åŽç¤¾ã€‘ã€å®‰å¾½ç»§ç»­æ•™è‚²ã€‘ ã€ä¸Šæµ·å¼€æ”¾å¤§å­¦ã€‘ã€å­¦åŽ†é‚¦ã€‘ã€å…°å·žç»§æ•™ã€‘ã€ç»§æ•™åœ¨çº¿ã€‘ã€æ€é’®æ•™è‚²ã€‘ã€æ˜¥é£Žé›¨æ•™è‚²ã€‘ã€é¾™çŸ¥ç½‘ã€‘ã€é‡åº†é«˜æ ¡ã€‘ã€æ–°é”¦å’Œã€‘ã€ä¸­å›½çŸ³æ²¹å¤§å­¦ã€‘ã€å°šå­¦è¯¾å ‚ã€‘ã€æ–°äº¬äººã€‘ã€ç™¾é€šå­¦å ‚ã€‘ã€ç‚¹å¢¨äº‘ã€‘ã€åšå­¦ã€‘ã€è”å¤§ã€‘ã€è¯¾ç¨‹ä¼´ä¾£ã€‘ã€å‡ºå¤´ç§‘æŠ€ã€‘ã€è‰¯å¸ˆåœ¨çº¿ã€‘ã€ä¸­å›½å¤§å­¦ã€‘ã€åœ¨æµ™å­¦ã€‘ã€æ£‰èŠ±ç³–ã€‘ã€æœæ˜Žåœ¨çº¿ã€‘ã€å­¦ä¹ å…¬ç¤¾ã€‘ã€æ²³å—å®—æ•™ã€‘ã€welearnéšè¡Œè¯¾å ‚ã€‘ã€ç¿å­¦ã€‘ã€å…°å·žç»§æ•™ã€‘ã€æ–‡é¼Žã€‘ã€ç»Žé€šäº‘ã€‘ã€æ± é¦†ã€‘ã€utalkã€‘ã€168ç½‘æ ¡ã€‘ã€æˆ‘å­¦ä¹ ã€‘ã€FIFè‹±è¯­ã€‘ã€ç™¾ä¸‡æ‰©æ‹›ã€‘ã€å’Œå­¦åœ¨çº¿ã€‘ã€äººå«æ…•è¯¾ã€‘ã€ç»Žé€šäº‘ã€‘ã€å†èµ·èˆªã€‘ã€iå­¦ã€‘ã€æ…•äº«ã€‘ã€é«˜æ ¡é‚¦ã€‘ã€å¥½ç­–ã€‘ã€ä¼˜å­¦é™¢ã€‘ ã€å­¦èµ·Plusã€‘ã€é’ä¹¦å­¦å ‚ã€‘ã€å«å¼˜æ…•è¯¾ã€‘ã€å¾®çŸ¥åº“ã€‘ã€å­¦å ‚åœ¨çº¿ã€‘ä½¿ç”¨å‰è¯·åŠ¡å¿…æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…æ¨¡å¼ï¼ŒæŒ‰F2åŽå³å¯æ‰§è¡Œï¼Œä½¿ç”¨å‰ä¸€å®šè¦çœ‹è„šæœ¬ä½¿ç”¨è¯´æ˜Ž|ä½œè€…ï¼šwhite996_1
// @author       white996_1
// @run-at       document-end
// @match        *://*/*
// @grant        GM_registerMenuCommand
// @license      MIT
// @downloadURL https://update.greasyfork.org/scripts/528612/%E2%9C%8C%E5%AD%A6%E5%AD%A6%E4%B9%A0%E9%80%9A%7C%E6%99%BA%E6%85%A7%E6%A0%91%7C%E5%9B%BD%E5%BC%80%7C%E6%99%BA%E6%85%A7%E8%81%8C%E6%95%99%7C%E9%9D%92%E4%B9%A6%E5%AD%A6%E5%A0%82%7C%E5%9C%A8%E7%BA%BF100%E5%88%86%7C%E8%80%83%E6%95%99%E8%82%B2%E4%BA%91%E8%AF%BE%E5%A0%82%7C%E5%AD%A6%E8%B5%B7plus%7C%E5%86%8D%E8%B5%B7%E8%88%AA%7C%E8%9E%8D%E5%AD%A6%7CU%E6%A0%A1%E5%9B%AD%E7%AD%89%E7%AD%89%7C%E5%90%84%E7%B1%BB%E7%BB%A7%E7%BB%AD%E6%95%99%E8%82%B2%E9%80%9A%E7%94%A8%E8%A7%86%E9%A2%91%E5%9D%87%E6%94%AF%E6%8C%81%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1%7C%E6%8C%87%E5%AE%9A%E5%80%8D%E9%80%9F%E2%9C%8C%F0%9F%91%88%F0%9F%A5%87.user.js
// @updateURL https://update.greasyfork.org/scripts/528612/%E2%9C%8C%E5%AD%A6%E5%AD%A6%E4%B9%A0%E9%80%9A%7C%E6%99%BA%E6%85%A7%E6%A0%91%7C%E5%9B%BD%E5%BC%80%7C%E6%99%BA%E6%85%A7%E8%81%8C%E6%95%99%7C%E9%9D%92%E4%B9%A6%E5%AD%A6%E5%A0%82%7C%E5%9C%A8%E7%BA%BF100%E5%88%86%7C%E8%80%83%E6%95%99%E8%82%B2%E4%BA%91%E8%AF%BE%E5%A0%82%7C%E5%AD%A6%E8%B5%B7plus%7C%E5%86%8D%E8%B5%B7%E8%88%AA%7C%E8%9E%8D%E5%AD%A6%7CU%E6%A0%A1%E5%9B%AD%E7%AD%89%E7%AD%89%7C%E5%90%84%E7%B1%BB%E7%BB%A7%E7%BB%AD%E6%95%99%E8%82%B2%E9%80%9A%E7%94%A8%E8%A7%86%E9%A2%91%E5%9D%87%E6%94%AF%E6%8C%81%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F%E6%9C%8D%E5%8A%A1%7C%E6%8C%87%E5%AE%9A%E5%80%8D%E9%80%9F%E2%9C%8C%F0%9F%91%88%F0%9F%A5%87.meta.js
// ==/UserScript==

(function() {
    'use strict';

    const selectors = {
        bilibili: 'bwp-video',
        douyin: '.xg-video-container video',
        other: 'ä¸Šé¢ä¸¤ä¸ªæ— ç”¨ï¼Œå¿½ç•¥å°±è¡Œ'
    };

    function registerMenu() {
        try {
            GM_registerMenuCommand("å‡é€Ÿ/åŠ é€Ÿ", () => {
                const rate = prompt("è¯·è¾“å…¥æ‚¨çš„é€ŸçŽ‡(0-16)", "2.0");
                if (isValidRate(rate)) {
                    setPlaybackRate(rate);
                } else {
                    alert("æ— æ•ˆæ•°å€¼");
                }
            }, "rate");
        } catch (error) {
            console.error("æ³¨å†Œèœå•å‘½ä»¤å¤±è´¥:", error);
        }
    }

    function isValidRate(rate) {
        return !isNaN(rate) && rate >= 0 && rate <= 16;
    }

    function onKeyDown(event) {
        if (event.key === 'F2' || event.keyCode === 113) {
            event.preventDefault();
            promptForRate();
        }
    }

    function promptForRate() {
        const rate = prompt("è¯·è¾“å…¥æ‚¨çš„é€ŸçŽ‡(0-16)", "2.0");
        if (isValidRate(rate)) {
            setPlaybackRate(rate);
        } else {
            alert("æ— æ•ˆæ•°å€¼");
        }
    }

    function setPlaybackRate(rate) {
        let video = findVideoElement();
        if (video) {
            video.playbackRate = parseFloat(rate);
        } else {
            console.error("æœªæ‰¾åˆ°è§†é¢‘å…ƒç´ ");
        }
    }

    function findVideoElement() {
        let video = null;
        Object.keys(selectors).forEach((key) => {
            if (location.host.replace(/\./g, "").includes(key)) {
                video = document.querySelector(selectors[key]);
            }
        });

        return video || document.querySelector('video');
    }

    registerMenu();
    document.addEventListener('keydown', onKeyDown);

})();
