// ==UserScript==
// @name         SQL-Quick-Click
// @namespace    http://tampermonkey.net/
// @version      2.4
// @description  Double-Click SQL Generator
// @include      *://*/*
// @grant        none
// @license MIT
// @downloadURL https://update.greasyfork.org/scripts/517097/SQL-Quick-Click.user.js
// @updateURL https://update.greasyfork.org/scripts/517097/SQL-Quick-Click.meta.js
// ==/UserScript==

(function(){'use strict';let notificationDiv;function createNotificationDiv(selectedText,event){let sqlAsc=`SELECT * FROM ${selectedText} ORDER BY id ASC;`;let sqlDesc=`SELECT * FROM ${selectedText} ORDER BY id DESC;`;let sqlTableStructure=`SHOW CREATE TABLE ${selectedText};`;let sqlIndexes=`SHOW INDEX FROM ${selectedText};`;notificationDiv=document.createElement('div');notificationDiv.style.position='fixed';notificationDiv.style.backgroundColor='#FFFFFF';notificationDiv.style.color='#333';notificationDiv.style.padding='15px';notificationDiv.style.border='1px solid #ccc';notificationDiv.style.borderRadius='8px';notificationDiv.style.fontSize='11px';notificationDiv.style.zIndex='1000';notificationDiv.style.boxShadow='0px 4px 12px rgba(0, 0, 0, 0.2)';notificationDiv.style.maxWidth='350px';notificationDiv.style.wordWrap='break-word';notificationDiv.innerHTML=`<div style="font-weight: bold; margin-bottom: 10px;">点击sql复制</div><div style="margin-bottom: 8px;"><span>id升序：</span><div style="background-color: #f8f8f8; color: #333; padding: 10px; border-radius: 5px; cursor: pointer;"data-sql="${sqlAsc}"><code>${sqlAsc}</code></div></div><div style="margin-bottom: 8px;"><span>id降序：</span><div style="background-color: #f8f8f8; color: #333; padding: 10px; border-radius: 5px; cursor: pointer;"data-sql="${sqlDesc}"><code>${sqlDesc}</code></div></div><div style="margin-bottom: 8px;"><span>表结构：</span><div style="background-color: #f8f8f8; color: #333; padding: 10px; border-radius: 5px; cursor: pointer;"data-sql="${sqlTableStructure}"><code>${sqlTableStructure}</code></div></div><div><span>查看索引：</span><div style="background-color: #f8f8f8; color: #333; padding: 10px; border-radius: 5px; cursor: pointer;"data-sql="${sqlIndexes}"><code>${sqlIndexes}</code></div></div><p id="copyMessage"style="color: green; font-size: 12px; display: none; margin-top: 5px;">已复制到剪贴板！</p>`;notificationDiv.style.left=`${event.pageX}px`;notificationDiv.style.top=`${event.pageY+20}px`;document.body.appendChild(notificationDiv);const rect=notificationDiv.getBoundingClientRect();const overflowBottom=rect.bottom>window.innerHeight;const overflowTop=rect.top<0;if(overflowBottom){notificationDiv.style.top=`${event.pageY-rect.height-20}px`}else if(overflowTop){notificationDiv.style.top=`20px`}if(rect.right>window.innerWidth){notificationDiv.style.left=`${window.innerWidth-rect.width-20}px`}notificationDiv.querySelectorAll('[data-sql]').forEach(div=>{div.addEventListener('click',function(){const sqlText=div.getAttribute('data-sql');navigator.clipboard.writeText(sqlText).then(()=>{showCopyMessage()})})});notificationDiv.id='sql-notification'}function showCopyMessage(){const copyMessage=document.getElementById('copyMessage');if(copyMessage){copyMessage.style.display='block';setTimeout(()=>{copyMessage.style.display='none'},1500)}}document.addEventListener('mousedown',function(event){if(notificationDiv&&!notificationDiv.contains(event.target)){notificationDiv.remove();notificationDiv=null}});document.addEventListener('dblclick',function(event){if(event.target.classList.contains('tree-node__label')&&event.target.classList.contains('tree-node__label--active')){let selectedText=event.target.innerText.trim();if(selectedText){if(notificationDiv){notificationDiv.remove()}createNotificationDiv(selectedText,event)}}})})();