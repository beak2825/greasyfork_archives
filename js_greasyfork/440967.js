// ==UserScript==
// @name The-West Calc
// @version 2.7.3
// @description The-West Battle Calc, Notepad, Battle stats, Duel Calc, Duel List, Craft List, Job List, Wardrobe, Tombola Analyser
// @author timzatko, TomRobert
// @homepageURL http://tw-calc.net
// @include	https://*.the-west.*/game.php*
// @include	https://*.the-west.com.*/game.php*
// @include	http*://*.the-west.*.*/game.php*
// @include	https://*.tw.innogames.*/game.php*
// @exclude https://classic.the-west.net*
// @grant none
// @namespace https://greasyfork.org/users/5723
// @downloadURL https://update.greasyfork.org/scripts/440967/The-West%20Calc.user.js
// @updateURL https://update.greasyfork.org/scripts/440967/The-West%20Calc.meta.js
// ==/UserScript==

var TWCalcJS=function(){(function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,r){return r={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?r.path:t)}},e(r,r.exports),r.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var check$1=function(e){return e&&e.Math==Math&&e},global_1$1=check$1("object"==typeof globalThis&&globalThis)||check$1("object"==typeof window&&window)||check$1("object"==typeof self&&self)||check$1("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),fails$2=function(e){try{return!!e()}catch(e){return!0}},fails$1=fails$2,functionBindNative$1=!fails$1((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND=functionBindNative$1,FunctionPrototype$5=Function.prototype,apply$1=FunctionPrototype$5.apply,call$5=FunctionPrototype$5.call,functionApply="object"==typeof Reflect&&Reflect.apply||(NATIVE_BIND?call$5.bind(apply$1):function(){return call$5.apply(apply$1,arguments)}),FunctionPrototype$4=Function.prototype,call$4=FunctionPrototype$4.call,uncurryThisWithBind$1=NATIVE_BIND&&FunctionPrototype$4.bind.bind(call$4,call$4),functionUncurryThisRaw$1=function(e){return NATIVE_BIND?uncurryThisWithBind$1(e):function(){return call$4.apply(e,arguments)}},uncurryThisRaw=functionUncurryThisRaw$1,toString$7=uncurryThisRaw({}.toString),stringSlice$2=uncurryThisRaw("".slice),classofRaw$1=function(e){return stringSlice$2(toString$7(e),8,-1)},classof$3=classofRaw$1,functionUncurryThis$1=function(e){if("Function"===classof$3(e))return uncurryThisRaw(e)},documentAll$5="object"==typeof document&&document.all,IS_HTMLDDA$1=void 0===documentAll$5&&void 0!==documentAll$5,documentAll_1$1={all:documentAll$5,IS_HTMLDDA:IS_HTMLDDA$1},$documentAll=documentAll_1$1,documentAll$4=$documentAll.all,isCallable$2=$documentAll.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$4}:function(e){return"function"==typeof e},descriptors$1=!fails$1((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),call$3=Function.prototype.call,functionCall$1=NATIVE_BIND?call$3.bind(call$3):function(){return call$3.apply(call$3,arguments)},$propertyIsEnumerable$2={}.propertyIsEnumerable,getOwnPropertyDescriptor$5=Object.getOwnPropertyDescriptor,NASHORN_BUG$1=getOwnPropertyDescriptor$5&&!$propertyIsEnumerable$2.call({1:2},1),f$d=NASHORN_BUG$1?function(e){var t=getOwnPropertyDescriptor$5(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$2,objectPropertyIsEnumerable$1={f:f$d},createPropertyDescriptor$2=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},uncurryThis=functionUncurryThis$1,$Object$9=Object,split$1=uncurryThis("".split),indexedObject$1=fails$1((function(){return!$Object$9("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$3(e)?split$1(e,""):$Object$9(e)}:$Object$9,isNullOrUndefined$2=function(e){return null==e},isNullOrUndefined$1=isNullOrUndefined$2,$TypeError$s=TypeError,requireObjectCoercible$2=function(e){if(isNullOrUndefined$1(e))throw $TypeError$s("Can't call method on "+e);return e},IndexedObject=indexedObject$1,requireObjectCoercible$1=requireObjectCoercible$2,toIndexedObject$2=function(e){return IndexedObject(requireObjectCoercible$1(e))},isCallable$1=isCallable$2,documentAll$3=$documentAll.all,isObject$2=$documentAll.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:isCallable$1(e)||e===documentAll$3}:function(e){return"object"==typeof e?null!==e:isCallable$1(e)},path$1={},path=path$1,global$1=global_1$1,aFunction$1=function(e){return isCallable$1(e)?e:void 0},getBuiltIn$2=function(e,t){return arguments.length<2?aFunction$1(path[e])||aFunction$1(global$1[e]):path[e]&&path[e][t]||global$1[e]&&global$1[e][t]},objectIsPrototypeOf$1=uncurryThis({}.isPrototypeOf),getBuiltIn$1=getBuiltIn$2,engineUserAgent$1=getBuiltIn$1("navigator","userAgent")||"",userAgent=engineUserAgent$1,process$5=global$1.process,Deno$2=global$1.Deno,versions$1=process$5&&process$5.versions||Deno$2&&Deno$2.version,v8$1=versions$1&&versions$1.v8,match$1,version$1;v8$1&&(match$1=v8$1.split("."),version$1=match$1[0]>0&&match$1[0]<4?1:+(match$1[0]+match$1[1])),!version$1&&userAgent&&(match$1=userAgent.match(/Edge\/(\d+)/),(!match$1||match$1[1]>=74)&&(match$1=userAgent.match(/Chrome\/(\d+)/),match$1&&(version$1=+match$1[1])));var engineV8Version$1=version$1,CHROME_VERSION=engineV8Version$1,symbolConstructorDetection$1=!!Object.getOwnPropertySymbols&&!fails$1((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&CHROME_VERSION&&CHROME_VERSION<41})),NATIVE_SYMBOL=symbolConstructorDetection$1,useSymbolAsUid$1=NATIVE_SYMBOL&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,isPrototypeOf=objectIsPrototypeOf$1,USE_SYMBOL_AS_UID=useSymbolAsUid$1,$Object$8=Object,isSymbol$2=USE_SYMBOL_AS_UID?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn$1("Symbol");return isCallable$1(t)&&isPrototypeOf(t.prototype,$Object$8(e))},$String$6=String,tryToString$2=function(e){try{return $String$6(e)}catch(e){return"Object"}},tryToString$1=tryToString$2,$TypeError$r=TypeError,aCallable$2=function(e){if(isCallable$1(e))return e;throw $TypeError$r(tryToString$1(e)+" is not a function")},aCallable$1=aCallable$2,getMethod$2=function(e,t){var r=e[t];return isNullOrUndefined$1(r)?void 0:aCallable$1(r)},call$2=functionCall$1,isObject$1=isObject$2,$TypeError$q=TypeError,ordinaryToPrimitive$2=function(e,t){var r,n;if("string"===t&&isCallable$1(r=e.toString)&&!isObject$1(n=call$2(r,e)))return n;if(isCallable$1(r=e.valueOf)&&!isObject$1(n=call$2(r,e)))return n;if("string"!==t&&isCallable$1(r=e.toString)&&!isObject$1(n=call$2(r,e)))return n;throw $TypeError$q("Can't convert object to primitive value")},isPure=!0,defineProperty$6=Object.defineProperty,defineGlobalProperty$2=function(e,t){try{defineProperty$6(global$1,e,{value:t,configurable:!0,writable:!0})}catch(r){global$1[e]=t}return t},defineGlobalProperty$1=defineGlobalProperty$2,SHARED$1="__core-js_shared__",store$4=global$1[SHARED$1]||defineGlobalProperty$1(SHARED$1,{}),sharedStore$1=store$4,IS_PURE=isPure,store$3=sharedStore$1,shared$2=createCommonjsModule((function(e){(e.exports=function(e,t){return store$3[e]||(store$3[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:IS_PURE?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),$Object$7=Object,toObject$2=function(e){return $Object$7(requireObjectCoercible$1(e))},toObject$1=toObject$2,hasOwnProperty$1=uncurryThis({}.hasOwnProperty),hasOwnProperty_1$1=Object.hasOwn||function(e,t){return hasOwnProperty$1(toObject$1(e),t)},id$1=0,postfix$1=Math.random(),toString$6=uncurryThis(1..toString),uid$2=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$6(++id$1+postfix$1,36)},shared$1=shared$2,hasOwn=hasOwnProperty_1$1,uid$1=uid$2,WellKnownSymbolsStore$1=shared$1("wks"),Symbol$2=global$1.Symbol,symbolFor$1=Symbol$2&&Symbol$2.for,createWellKnownSymbol$1=USE_SYMBOL_AS_UID?Symbol$2:Symbol$2&&Symbol$2.withoutSetter||uid$1,wellKnownSymbol$2=function(e){if(!hasOwn(WellKnownSymbolsStore$1,e)||!NATIVE_SYMBOL&&"string"!=typeof WellKnownSymbolsStore$1[e]){var t="Symbol."+e;NATIVE_SYMBOL&&hasOwn(Symbol$2,e)?WellKnownSymbolsStore$1[e]=Symbol$2[e]:WellKnownSymbolsStore$1[e]=USE_SYMBOL_AS_UID&&symbolFor$1?symbolFor$1(t):createWellKnownSymbol$1(t)}return WellKnownSymbolsStore$1[e]},isSymbol$1=isSymbol$2,getMethod$1=getMethod$2,ordinaryToPrimitive$1=ordinaryToPrimitive$2,wellKnownSymbol$1=wellKnownSymbol$2,$TypeError$p=TypeError,TO_PRIMITIVE$1=wellKnownSymbol$1("toPrimitive"),toPrimitive$2=function(e,t){if(!isObject$1(e)||isSymbol$1(e))return e;var r,n=getMethod$1(e,TO_PRIMITIVE$1);if(n){if(void 0===t&&(t="default"),r=call$2(n,e,t),!isObject$1(r)||isSymbol$1(r))return r;throw $TypeError$p("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive$1(e,t)},toPrimitive$1=toPrimitive$2,toPropertyKey$2=function(e){var t=toPrimitive$1(e,"string");return isSymbol$1(t)?t:t+""},document$4=global$1.document,EXISTS$3=isObject$1(document$4)&&isObject$1(document$4.createElement),documentCreateElement$1=function(e){return EXISTS$3?document$4.createElement(e):{}},DESCRIPTORS=descriptors$1,createElement=documentCreateElement$1,ie8DomDefine$1=!DESCRIPTORS&&!fails$1((function(){return 7!=Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a})),require$$0$B=objectPropertyIsEnumerable$1,createPropertyDescriptor$1=createPropertyDescriptor$2,toIndexedObject$1=toIndexedObject$2,toPropertyKey$1=toPropertyKey$2,IE8_DOM_DEFINE=ie8DomDefine$1,$getOwnPropertyDescriptor$3=Object.getOwnPropertyDescriptor,f$c=DESCRIPTORS?$getOwnPropertyDescriptor$3:function(e,t){if(e=toIndexedObject$1(e),t=toPropertyKey$1(t),IE8_DOM_DEFINE)try{return $getOwnPropertyDescriptor$3(e,t)}catch(e){}if(hasOwn(e,t))return createPropertyDescriptor$1(!call$2(require$$0$B.f,e,t),e[t])},objectGetOwnPropertyDescriptor$1={f:f$c},replacement$1=/#|\.prototype\./,isForced$2=function(e,t){var r=data$1[normalize$1(e)];return r==POLYFILL$1||r!=NATIVE$1&&(isCallable$1(t)?fails$1(t):!!t)},normalize$1=isForced$2.normalize=function(e){return String(e).replace(replacement$1,".").toLowerCase()},data$1=isForced$2.data={},NATIVE$1=isForced$2.NATIVE="N",POLYFILL$1=isForced$2.POLYFILL="P",isForced_1$1=isForced$2,bind$8=uncurryThis(uncurryThis.bind),functionBindContext$1=function(e,t){return aCallable$1(e),void 0===t?e:NATIVE_BIND?bind$8(e,t):function(){return e.apply(t,arguments)}},v8PrototypeDefineBug$1=DESCRIPTORS&&fails$1((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),$String$5=String,$TypeError$o=TypeError,anObject$2=function(e){if(isObject$1(e))return e;throw $TypeError$o($String$5(e)+" is not an object")},V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug$1,anObject$1=anObject$2,$TypeError$n=TypeError,$defineProperty$1=Object.defineProperty,$getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor,ENUMERABLE$1="enumerable",CONFIGURABLE$3="configurable",WRITABLE$1="writable",f$b=DESCRIPTORS?V8_PROTOTYPE_DEFINE_BUG?function(e,t,r){if(anObject$1(e),t=toPropertyKey$1(t),anObject$1(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE$1 in r&&!r[WRITABLE$1]){var n=$getOwnPropertyDescriptor$2(e,t);n&&n[WRITABLE$1]&&(e[t]=r.value,r={configurable:CONFIGURABLE$3 in r?r[CONFIGURABLE$3]:n[CONFIGURABLE$3],enumerable:ENUMERABLE$1 in r?r[ENUMERABLE$1]:n[ENUMERABLE$1],writable:!1})}return $defineProperty$1(e,t,r)}:$defineProperty$1:function(e,t,r){if(anObject$1(e),t=toPropertyKey$1(t),anObject$1(r),IE8_DOM_DEFINE)try{return $defineProperty$1(e,t,r)}catch(e){}if("get"in r||"set"in r)throw $TypeError$n("Accessors not supported");return"value"in r&&(e[t]=r.value),e},objectDefineProperty$1={f:f$b},definePropertyModule=objectDefineProperty$1,createNonEnumerableProperty$2=DESCRIPTORS?function(e,t,r){return definePropertyModule.f(e,t,createPropertyDescriptor$1(1,r))}:function(e,t,r){return e[t]=r,e},apply=functionApply,require$$0$A=objectGetOwnPropertyDescriptor$1,isForced$1=isForced_1$1,bind$7=functionBindContext$1,createNonEnumerableProperty$1=createNonEnumerableProperty$2,getOwnPropertyDescriptor$4=require$$0$A.f,wrapConstructor=function(e){var t=function(r,n,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,o)}return apply(e,this,arguments)};return t.prototype=e.prototype,t},_export$1=function(e,t){var r,n,o,i,a,s,l,c,u=e.target,d=e.global,g=e.stat,p=e.proto,h=d?global$1:g?global$1[u]:(global$1[u]||{}).prototype,f=d?path:path[u]||createNonEnumerableProperty$1(path,u,{})[u],y=f.prototype;for(o in t)r=!isForced$1(d?o:u+(g?".":"#")+o,e.forced)&&h&&hasOwn(h,o),a=f[o],r&&(s=e.dontCallGetSet?(c=getOwnPropertyDescriptor$4(h,o))&&c.value:h[o]),i=r&&s?s:t[o],r&&typeof a==typeof i||(l=e.bind&&r?bind$7(i,global$1):e.wrap&&r?wrapConstructor(i):p&&isCallable$1(i)?uncurryThis(i):i,(e.sham||i&&i.sham||a&&a.sham)&&createNonEnumerableProperty$1(l,"sham",!0),createNonEnumerableProperty$1(f,o,l),p&&(hasOwn(path,n=u+"Prototype")||createNonEnumerableProperty$1(path,n,{}),createNonEnumerableProperty$1(path[n],o,i),e.real&&y&&!y[o]&&createNonEnumerableProperty$1(y,o,i)))},arraySlice$2=uncurryThis([].slice),$TypeError$m=TypeError,validateArgumentsLength$1=function(e,t){if(e<t)throw $TypeError$m("Not enough arguments");return e},arraySlice$1=arraySlice$2,validateArgumentsLength=validateArgumentsLength$1,MSIE=/MSIE .\./.test(userAgent),Function$2=global$1.Function,wrap=function(e){return MSIE?function(t,r){var n=validateArgumentsLength(arguments.length,1)>2,o=isCallable$1(t)?t:Function$2(t),i=n?arraySlice$1(arguments,2):void 0;return e(n?function(){apply(o,this,i)}:o,r)}:e},schedulersFix={setTimeout:wrap(global$1.setTimeout),setInterval:wrap(global$1.setInterval)},$$1=_export$1,require$$0$z=schedulersFix,setInterval$2=require$$0$z.setInterval;$$1({global:!0,bind:!0,forced:global$1.setInterval!==setInterval$2},{setInterval:setInterval$2});var setTimeout$3=require$$0$z.setTimeout;$$1({global:!0,bind:!0,forced:global$1.setTimeout!==setTimeout$3},{setTimeout:setTimeout$3});var setInterval$1=path.setInterval,require$$0$y=setInterval$1,setInterval=require$$0$y,ceil$1=Math.ceil,floor$3=Math.floor,mathTrunc$1=Math.trunc||function(e){var t=+e;return(t>0?floor$3:ceil$1)(t)},trunc=mathTrunc$1,toIntegerOrInfinity$2=function(e){var t=+e;return t!=t||0===t?0:trunc(t)},toIntegerOrInfinity$1=toIntegerOrInfinity$2,max$4=Math.max,min$4=Math.min,toAbsoluteIndex$2=function(e,t){var r=toIntegerOrInfinity$1(e);return r<0?max$4(r+t,0):min$4(r,t)},min$3=Math.min,toLength$2=function(e){return e>0?min$3(toIntegerOrInfinity$1(e),9007199254740991):0},toLength$1=toLength$2,lengthOfArrayLike$2=function(e){return toLength$1(e.length)},toAbsoluteIndex$1=toAbsoluteIndex$2,lengthOfArrayLike$1=lengthOfArrayLike$2,createMethod$6=function(e){return function(t,r,n){var o,i=toIndexedObject$1(t),a=lengthOfArrayLike$1(i),s=toAbsoluteIndex$1(n,a);if(e&&r!=r){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===r)return e||s||0;return!e&&-1}},arrayIncludes$1={includes:createMethod$6(!0),indexOf:createMethod$6(!1)},arrayMethodIsStrict$1=function(e,t){var r=[][e];return!!r&&fails$1((function(){r.call(null,t||function(){return 1},1)}))},require$$0$x=arrayIncludes$1,arrayMethodIsStrict=arrayMethodIsStrict$1,$indexOf=require$$0$x.indexOf,nativeIndexOf=uncurryThis([].indexOf),NEGATIVE_ZERO=!!nativeIndexOf&&1/nativeIndexOf([1],1,-0)<0,STRICT_METHOD$4=arrayMethodIsStrict("indexOf");$$1({target:"Array",proto:!0,forced:NEGATIVE_ZERO||!STRICT_METHOD$4},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NEGATIVE_ZERO?nativeIndexOf(this,e,t)||0:$indexOf(this,e,t)}});var entryVirtual$1=function(e){return path[e+"Prototype"]},entryVirtual=entryVirtual$1,indexOf$5=entryVirtual("Array").indexOf,method$e=indexOf$5,ArrayPrototype$d=Array.prototype,indexOf$4=function(e){var t=e.indexOf;return e===ArrayPrototype$d||isPrototypeOf(ArrayPrototype$d,e)&&t===ArrayPrototype$d.indexOf?method$e:t},parent$n=indexOf$4,indexOf$3=parent$n,require$$0$w=indexOf$3,indexOf$2=require$$0$w,check=function(e){return e&&e.Math==Math&&e},global_1=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),fails=function(e){try{return!!e()}catch(e){return!0}},descriptors=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),functionBindNative=!fails((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),call$1=Function.prototype.call,functionCall=functionBindNative?call$1.bind(call$1):function(){return call$1.apply(call$1,arguments)},$propertyIsEnumerable$1={}.propertyIsEnumerable,getOwnPropertyDescriptor$3=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$3&&!$propertyIsEnumerable$1.call({1:2},1),f$a=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$3(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$1,objectPropertyIsEnumerable={f:f$a},createPropertyDescriptor=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},FunctionPrototype$3=Function.prototype,call=FunctionPrototype$3.call,uncurryThisWithBind=functionBindNative&&FunctionPrototype$3.bind.bind(call,call),functionUncurryThisRaw=function(e){return functionBindNative?uncurryThisWithBind(e):function(){return call.apply(e,arguments)}},toString$5=functionUncurryThisRaw({}.toString),stringSlice$1=functionUncurryThisRaw("".slice),classofRaw=function(e){return stringSlice$1(toString$5(e),8,-1)},functionUncurryThis=function(e){if("Function"===classofRaw(e))return functionUncurryThisRaw(e)},$Object$6=Object,split=functionUncurryThis("".split),indexedObject=fails((function(){return!$Object$6("z").propertyIsEnumerable(0)}))?function(e){return"String"==classofRaw(e)?split(e,""):$Object$6(e)}:$Object$6,isNullOrUndefined=function(e){return null==e},$TypeError$l=TypeError,requireObjectCoercible=function(e){if(isNullOrUndefined(e))throw $TypeError$l("Can't call method on "+e);return e},toIndexedObject=function(e){return indexedObject(requireObjectCoercible(e))},documentAll$2="object"==typeof document&&document.all,IS_HTMLDDA=void 0===documentAll$2&&void 0!==documentAll$2,documentAll_1={all:documentAll$2,IS_HTMLDDA:IS_HTMLDDA},documentAll$1=documentAll_1.all,isCallable=documentAll_1.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$1}:function(e){return"function"==typeof e},documentAll=documentAll_1.all,isObject=documentAll_1.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:isCallable(e)||e===documentAll}:function(e){return"object"==typeof e?null!==e:isCallable(e)},aFunction=function(e){return isCallable(e)?e:void 0},getBuiltIn=function(e,t){return arguments.length<2?aFunction(global_1[e]):global_1[e]&&global_1[e][t]},objectIsPrototypeOf=functionUncurryThis({}.isPrototypeOf),engineUserAgent=getBuiltIn("navigator","userAgent")||"",process$4=global_1.process,Deno$1=global_1.Deno,versions=process$4&&process$4.versions||Deno$1&&Deno$1.version,v8=versions&&versions.v8,match,version;v8&&(match=v8.split("."),version=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version&&engineUserAgent&&(match=engineUserAgent.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=engineUserAgent.match(/Chrome\/(\d+)/),match&&(version=+match[1])));var engineV8Version=version,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&engineV8Version&&engineV8Version<41})),useSymbolAsUid=symbolConstructorDetection&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,$Object$5=Object,isSymbol=useSymbolAsUid?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn("Symbol");return isCallable(t)&&objectIsPrototypeOf(t.prototype,$Object$5(e))},$String$4=String,tryToString=function(e){try{return $String$4(e)}catch(e){return"Object"}},$TypeError$k=TypeError,aCallable=function(e){if(isCallable(e))return e;throw $TypeError$k(tryToString(e)+" is not a function")},getMethod=function(e,t){var r=e[t];return isNullOrUndefined(r)?void 0:aCallable(r)},$TypeError$j=TypeError,ordinaryToPrimitive=function(e,t){var r,n;if("string"===t&&isCallable(r=e.toString)&&!isObject(n=functionCall(r,e)))return n;if(isCallable(r=e.valueOf)&&!isObject(n=functionCall(r,e)))return n;if("string"!==t&&isCallable(r=e.toString)&&!isObject(n=functionCall(r,e)))return n;throw $TypeError$j("Can't convert object to primitive value")},defineProperty$5=Object.defineProperty,defineGlobalProperty=function(e,t){try{defineProperty$5(global_1,e,{value:t,configurable:!0,writable:!0})}catch(r){global_1[e]=t}return t},SHARED="__core-js_shared__",store$2=global_1[SHARED]||defineGlobalProperty(SHARED,{}),sharedStore=store$2,shared=createCommonjsModule((function(e){(e.exports=function(e,t){return sharedStore[e]||(sharedStore[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),$Object$4=Object,toObject=function(e){return $Object$4(requireObjectCoercible(e))},hasOwnProperty=functionUncurryThis({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty(toObject(e),t)},id=0,postfix=Math.random(),toString$4=functionUncurryThis(1..toString),uid=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$4(++id+postfix,36)},WellKnownSymbolsStore=shared("wks"),Symbol$1=global_1.Symbol,symbolFor=Symbol$1&&Symbol$1.for,createWellKnownSymbol=useSymbolAsUid?Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid,wellKnownSymbol=function(e){if(!hasOwnProperty_1(WellKnownSymbolsStore,e)||!symbolConstructorDetection&&"string"!=typeof WellKnownSymbolsStore[e]){var t="Symbol."+e;symbolConstructorDetection&&hasOwnProperty_1(Symbol$1,e)?WellKnownSymbolsStore[e]=Symbol$1[e]:WellKnownSymbolsStore[e]=useSymbolAsUid&&symbolFor?symbolFor(t):createWellKnownSymbol(t)}return WellKnownSymbolsStore[e]},$TypeError$i=TypeError,TO_PRIMITIVE=wellKnownSymbol("toPrimitive"),toPrimitive=function(e,t){if(!isObject(e)||isSymbol(e))return e;var r,n=getMethod(e,TO_PRIMITIVE);if(n){if(void 0===t&&(t="default"),r=functionCall(n,e,t),!isObject(r)||isSymbol(r))return r;throw $TypeError$i("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPropertyKey=function(e){var t=toPrimitive(e,"string");return isSymbol(t)?t:t+""},document$3=global_1.document,EXISTS$2=isObject(document$3)&&isObject(document$3.createElement),documentCreateElement=function(e){return EXISTS$2?document$3.createElement(e):{}},ie8DomDefine=!descriptors&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,f$9=descriptors?$getOwnPropertyDescriptor$1:function(e,t){if(e=toIndexedObject(e),t=toPropertyKey(t),ie8DomDefine)try{return $getOwnPropertyDescriptor$1(e,t)}catch(e){}if(hasOwnProperty_1(e,t))return createPropertyDescriptor(!functionCall(objectPropertyIsEnumerable.f,e,t),e[t])},objectGetOwnPropertyDescriptor={f:f$9},v8PrototypeDefineBug=descriptors&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),$String$3=String,$TypeError$h=TypeError,anObject=function(e){if(isObject(e))return e;throw $TypeError$h($String$3(e)+" is not an object")},$TypeError$g=TypeError,$defineProperty=Object.defineProperty,$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$2="configurable",WRITABLE="writable",f$8=descriptors?v8PrototypeDefineBug?function(e,t,r){if(anObject(e),t=toPropertyKey(t),anObject(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE in r&&!r[WRITABLE]){var n=$getOwnPropertyDescriptor(e,t);n&&n[WRITABLE]&&(e[t]=r.value,r={configurable:CONFIGURABLE$2 in r?r[CONFIGURABLE$2]:n[CONFIGURABLE$2],enumerable:ENUMERABLE in r?r[ENUMERABLE]:n[ENUMERABLE],writable:!1})}return $defineProperty(e,t,r)}:$defineProperty:function(e,t,r){if(anObject(e),t=toPropertyKey(t),anObject(r),ie8DomDefine)try{return $defineProperty(e,t,r)}catch(e){}if("get"in r||"set"in r)throw $TypeError$g("Accessors not supported");return"value"in r&&(e[t]=r.value),e},objectDefineProperty={f:f$8},createNonEnumerableProperty=descriptors?function(e,t,r){return objectDefineProperty.f(e,t,createPropertyDescriptor(1,r))}:function(e,t,r){return e[t]=r,e},FunctionPrototype$2=Function.prototype,getDescriptor$1=descriptors&&Object.getOwnPropertyDescriptor,EXISTS$1=hasOwnProperty_1(FunctionPrototype$2,"name"),PROPER$1=EXISTS$1&&"something"===function(){}.name,CONFIGURABLE$1=EXISTS$1&&(!descriptors||descriptors&&getDescriptor$1(FunctionPrototype$2,"name").configurable),functionName$1={EXISTS:EXISTS$1,PROPER:PROPER$1,CONFIGURABLE:CONFIGURABLE$1},functionToString$1=functionUncurryThis(Function.toString);isCallable(sharedStore.inspectSource)||(sharedStore.inspectSource=function(e){return functionToString$1(e)});var inspectSource$2=sharedStore.inspectSource,WeakMap$4=global_1.WeakMap,weakMapBasicDetection$1=isCallable(WeakMap$4)&&/native code/.test(String(WeakMap$4)),keys$1=shared("keys"),sharedKey$2=function(e){return keys$1[e]||(keys$1[e]=uid(e))},hiddenKeys$4={},OBJECT_ALREADY_INITIALIZED$1="Object already initialized",TypeError$3=global_1.TypeError,WeakMap$3=global_1.WeakMap,set$2,get$1,has$1,enforce$1=function(e){return has$1(e)?get$1(e):set$2(e,{})},getterFor$1=function(e){return function(t){var r;if(!isObject(t)||(r=get$1(t)).type!==e)throw TypeError$3("Incompatible receiver, "+e+" required");return r}};if(weakMapBasicDetection$1||sharedStore.state){var store$1=sharedStore.state||(sharedStore.state=new WeakMap$3);store$1.get=store$1.get,store$1.has=store$1.has,store$1.set=store$1.set,set$2=function(e,t){if(store$1.has(e))throw TypeError$3(OBJECT_ALREADY_INITIALIZED$1);return t.facade=e,store$1.set(e,t),t},get$1=function(e){return store$1.get(e)||{}},has$1=function(e){return store$1.has(e)}}else{var STATE$1=sharedKey$2("state");hiddenKeys$4[STATE$1]=!0,set$2=function(e,t){if(hasOwnProperty_1(e,STATE$1))throw TypeError$3(OBJECT_ALREADY_INITIALIZED$1);return t.facade=e,createNonEnumerableProperty(e,STATE$1,t),t},get$1=function(e){return hasOwnProperty_1(e,STATE$1)?e[STATE$1]:{}},has$1=function(e){return hasOwnProperty_1(e,STATE$1)}}var internalState$1={set:set$2,get:get$1,has:has$1,enforce:enforce$1,getterFor:getterFor$1},makeBuiltIn_1=createCommonjsModule((function(e){var t=functionName$1.CONFIGURABLE,r=internalState$1.enforce,n=internalState$1.get,o=Object.defineProperty,i=descriptors&&!fails((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),s=e.exports=function(e,n,s){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),s&&s.getter&&(n="get "+n),s&&s.setter&&(n="set "+n),(!hasOwnProperty_1(e,"name")||t&&e.name!==n)&&(descriptors?o(e,"name",{value:n,configurable:!0}):e.name=n),i&&s&&hasOwnProperty_1(s,"arity")&&e.length!==s.arity&&o(e,"length",{value:s.arity});try{s&&hasOwnProperty_1(s,"constructor")&&s.constructor?descriptors&&o(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var l=r(e);return hasOwnProperty_1(l,"source")||(l.source=a.join("string"==typeof n?n:"")),e};Function.prototype.toString=s((function(){return isCallable(this)&&n(this).source||inspectSource$2(this)}),"toString")})),defineBuiltIn$2=function(e,t,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:t;if(isCallable(r)&&makeBuiltIn_1(r,i,n),n.global)o?e[t]=r:defineGlobalProperty(t,r);else{try{n.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=r:objectDefineProperty.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},ceil=Math.ceil,floor$2=Math.floor,mathTrunc=Math.trunc||function(e){var t=+e;return(t>0?floor$2:ceil)(t)},toIntegerOrInfinity=function(e){var t=+e;return t!=t||0===t?0:mathTrunc(t)},max$3=Math.max,min$2=Math.min,toAbsoluteIndex=function(e,t){var r=toIntegerOrInfinity(e);return r<0?max$3(r+t,0):min$2(r,t)},min$1=Math.min,toLength=function(e){return e>0?min$1(toIntegerOrInfinity(e),9007199254740991):0},lengthOfArrayLike=function(e){return toLength(e.length)},createMethod$5=function(e){return function(t,r,n){var o,i=toIndexedObject(t),a=lengthOfArrayLike(i),s=toAbsoluteIndex(n,a);if(e&&r!=r){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===r)return e||s||0;return!e&&-1}},arrayIncludes={includes:createMethod$5(!0),indexOf:createMethod$5(!1)},indexOf$1=arrayIncludes.indexOf,push$5=functionUncurryThis([].push),objectKeysInternal$1=function(e,t){var r,n=toIndexedObject(e),o=0,i=[];for(r in n)!hasOwnProperty_1(hiddenKeys$4,r)&&hasOwnProperty_1(n,r)&&push$5(i,r);for(;t.length>o;)hasOwnProperty_1(n,r=t[o++])&&(~indexOf$1(i,r)||push$5(i,r));return i},enumBugKeys$2=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hiddenKeys$3=enumBugKeys$2.concat("length","prototype"),f$7=Object.getOwnPropertyNames||function(e){return objectKeysInternal$1(e,hiddenKeys$3)},objectGetOwnPropertyNames$1={f:f$7},f$6=Object.getOwnPropertySymbols,objectGetOwnPropertySymbols$1={f:f$6},concat$3=functionUncurryThis([].concat),ownKeys$2=getBuiltIn("Reflect","ownKeys")||function(e){var t=objectGetOwnPropertyNames$1.f(anObject(e)),r=objectGetOwnPropertySymbols$1.f;return r?concat$3(t,r(e)):t},copyConstructorProperties$2=function(e,t,r){for(var n=ownKeys$2(t),o=objectDefineProperty.f,i=objectGetOwnPropertyDescriptor.f,a=0;a<n.length;a++){var s=n[a];hasOwnProperty_1(e,s)||r&&hasOwnProperty_1(r,s)||o(e,s,i(t,s))}},replacement=/#|\.prototype\./,isForced=function(e,t){var r=data[normalize(e)];return r==POLYFILL||r!=NATIVE&&(isCallable(t)?fails(t):!!t)},normalize=isForced.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P",isForced_1=isForced,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,_export=function(e,t){var r,n,o,i,a,s=e.target,l=e.global,c=e.stat;if(r=l?global_1:c?global_1[s]||defineGlobalProperty(s,{}):(global_1[s]||{}).prototype)for(n in t){if(i=t[n],o=e.dontCallGetSet?(a=getOwnPropertyDescriptor$2(r,n))&&a.value:r[n],!isForced_1(l?n:s+(c?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;copyConstructorProperties$2(i,o)}(e.sham||o&&o.sham)&&createNonEnumerableProperty(i,"sham",!0),defineBuiltIn$2(r,n,i,e)}},createProperty$2=function(e,t,r){var n=toPropertyKey(t);n in e?objectDefineProperty.f(e,n,createPropertyDescriptor(0,r)):e[n]=r},$Array$3=Array,max$2=Math.max,arraySliceSimple$1=function(e,t,r){for(var n=lengthOfArrayLike(e),o=toAbsoluteIndex(t,n),i=toAbsoluteIndex(void 0===r?n:r,n),a=$Array$3(max$2(i-o,0)),s=0;o<i;o++,s++)createProperty$2(a,s,e[o]);return a.length=s,a},$getOwnPropertyNames=objectGetOwnPropertyNames$1.f,windowNames="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(e){try{return $getOwnPropertyNames(e)}catch(e){return arraySliceSimple$1(windowNames)}},f$5=function(e){return windowNames&&"Window"==classofRaw(e)?getWindowNames(e):$getOwnPropertyNames(toIndexedObject(e))},objectGetOwnPropertyNamesExternal={f:f$5},arrayBufferNonExtensible=fails((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),$isExtensible=Object.isExtensible,FAILS_ON_PRIMITIVES=fails((function(){$isExtensible(1)})),objectIsExtensible=FAILS_ON_PRIMITIVES||arrayBufferNonExtensible?function(e){return!!isObject(e)&&((!arrayBufferNonExtensible||"ArrayBuffer"!=classofRaw(e))&&(!$isExtensible||$isExtensible(e)))}:$isExtensible,freezing=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),internalMetadata=createCommonjsModule((function(e){var t=objectDefineProperty.f,r=!1,n=uid("meta"),o=0,i=function(e){t(e,n,{value:{objectID:"O"+o++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},r=!0;var e=objectGetOwnPropertyNames$1.f,t=functionUncurryThis([].splice),o={};o[n]=1,e(o).length&&(objectGetOwnPropertyNames$1.f=function(r){for(var o=e(r),i=0,a=o.length;i<a;i++)if(o[i]===n){t(o,i,1);break}return o},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:objectGetOwnPropertyNamesExternal.f}))},fastKey:function(e,t){if(!isObject(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!hasOwnProperty_1(e,n)){if(!objectIsExtensible(e))return"F";if(!t)return"E";i(e)}return e[n].objectID},getWeakData:function(e,t){if(!hasOwnProperty_1(e,n)){if(!objectIsExtensible(e))return!0;if(!t)return!1;i(e)}return e[n].weakData},onFreeze:function(e){return freezing&&r&&objectIsExtensible(e)&&!hasOwnProperty_1(e,n)&&i(e),e}};hiddenKeys$4[n]=!0})),bind$6=functionUncurryThis(functionUncurryThis.bind),functionBindContext=function(e,t){return aCallable(e),void 0===t?e:functionBindNative?bind$6(e,t):function(){return e.apply(t,arguments)}},iterators$1={},ITERATOR$9=wellKnownSymbol("iterator"),ArrayPrototype$c=Array.prototype,isArrayIteratorMethod$2=function(e){return void 0!==e&&(iterators$1.Array===e||ArrayPrototype$c[ITERATOR$9]===e)},TO_STRING_TAG$7=wellKnownSymbol("toStringTag"),test$3={};test$3[TO_STRING_TAG$7]="z";var toStringTagSupport$1="[object z]"===String(test$3),TO_STRING_TAG$6=wellKnownSymbol("toStringTag"),$Object$3=Object,CORRECT_ARGUMENTS$1="Arguments"==classofRaw(function(){return arguments}()),tryGet$1=function(e,t){try{return e[t]}catch(e){}},classof$2=toStringTagSupport$1?classofRaw:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet$1(t=$Object$3(e),TO_STRING_TAG$6))?r:CORRECT_ARGUMENTS$1?classofRaw(t):"Object"==(n=classofRaw(t))&&isCallable(t.callee)?"Arguments":n},ITERATOR$8=wellKnownSymbol("iterator"),getIteratorMethod$2=function(e){if(!isNullOrUndefined(e))return getMethod(e,ITERATOR$8)||getMethod(e,"@@iterator")||iterators$1[classof$2(e)]},$TypeError$f=TypeError,getIterator$2=function(e,t){var r=arguments.length<2?getIteratorMethod$2(e):t;if(aCallable(r))return anObject(functionCall(r,e));throw $TypeError$f(tryToString(e)+" is not iterable")},iteratorClose$2=function(e,t,r){var n,o;anObject(e);try{if(!(n=getMethod(e,"return"))){if("throw"===t)throw r;return r}n=functionCall(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw r;if(o)throw n;return anObject(n),r},$TypeError$e=TypeError,Result$1=function(e,t){this.stopped=e,this.result=t},ResultPrototype$1=Result$1.prototype,iterate$2=function(e,t,r){var n,o,i,a,s,l,c,u=r&&r.that,d=!(!r||!r.AS_ENTRIES),g=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),f=functionBindContext(t,u),y=function(e){return n&&iteratorClose$2(n,"normal",e),new Result$1(!0,e)},$=function(e){return d?(anObject(e),h?f(e[0],e[1],y):f(e[0],e[1])):h?f(e,y):f(e)};if(g)n=e.iterator;else if(p)n=e;else{if(!(o=getIteratorMethod$2(e)))throw $TypeError$e(tryToString(e)+" is not iterable");if(isArrayIteratorMethod$2(o)){for(i=0,a=lengthOfArrayLike(e);a>i;i++)if((s=$(e[i]))&&objectIsPrototypeOf(ResultPrototype$1,s))return s;return new Result$1(!1)}n=getIterator$2(e,o)}for(l=g?e.next:n.next;!(c=functionCall(l,n)).done;){try{s=$(c.value)}catch(e){iteratorClose$2(n,"throw",e)}if("object"==typeof s&&s&&objectIsPrototypeOf(ResultPrototype$1,s))return s}return new Result$1(!1)},$TypeError$d=TypeError,anInstance$2=function(e,t){if(objectIsPrototypeOf(t,e))return e;throw $TypeError$d("Incorrect invocation")},ITERATOR$7=wellKnownSymbol("iterator"),SAFE_CLOSING$1=!1;try{var called$1=0,iteratorWithReturn$1={next:function(){return{done:!!called$1++}},return:function(){SAFE_CLOSING$1=!0}};iteratorWithReturn$1[ITERATOR$7]=function(){return this},Array.from(iteratorWithReturn$1,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration$2=function(e,t){if(!t&&!SAFE_CLOSING$1)return!1;var r=!1;try{var n={};n[ITERATOR$7]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},defineProperty$4=objectDefineProperty.f,TO_STRING_TAG$5=wellKnownSymbol("toStringTag"),setToStringTag$2=function(e,t,r){e&&!r&&(e=e.prototype),e&&!hasOwnProperty_1(e,TO_STRING_TAG$5)&&defineProperty$4(e,TO_STRING_TAG$5,{configurable:!0,value:t})},$String$2=String,$TypeError$c=TypeError,aPossiblePrototype$2=function(e){if("object"==typeof e||isCallable(e))return e;throw $TypeError$c("Can't set "+$String$2(e)+" as a prototype")},objectSetPrototypeOf$1=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=functionUncurryThis(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return anObject(r),aPossiblePrototype$2(n),t?e(r,n):r.__proto__=n,r}}():void 0),inheritIfRequired=function(e,t,r){var n,o;return objectSetPrototypeOf$1&&isCallable(n=t.constructor)&&n!==r&&isObject(o=n.prototype)&&o!==r.prototype&&objectSetPrototypeOf$1(e,o),e},collection=function(e,t,r){var n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),i=n?"set":"add",a=global_1[e],s=a&&a.prototype,l=a,c={},u=function(e){var t=functionUncurryThis(s[e]);defineBuiltIn$2(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(o&&!isObject(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return o&&!isObject(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!isObject(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(isForced_1(e,!isCallable(a)||!(o||s.forEach&&!fails((function(){(new a).entries().next()})))))l=r.getConstructor(t,e,n,i),internalMetadata.enable();else if(isForced_1(e,!0)){var d=new l,g=d[i](o?{}:-0,1)!=d,p=fails((function(){d.has(1)})),h=checkCorrectnessOfIteration$2((function(e){new a(e)})),f=!o&&fails((function(){for(var e=new a,t=5;t--;)e[i](t,t);return!e.has(-0)}));h||((l=t((function(e,t){anInstance$2(e,s);var r=inheritIfRequired(new a,e,l);return isNullOrUndefined(t)||iterate$2(t,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=s,s.constructor=l),(p||f)&&(u("delete"),u("has"),n&&u("get")),(f||g)&&u(i),o&&s.clear&&delete s.clear}return c[e]=l,_export({global:!0,constructor:!0,forced:l!=a},c),setToStringTag$2(l,e),o||r.setStrong(l,e,n),l},objectKeys$2=Object.keys||function(e){return objectKeysInternal$1(e,enumBugKeys$2)},f$4=descriptors&&!v8PrototypeDefineBug?Object.defineProperties:function(e,t){anObject(e);for(var r,n=toIndexedObject(t),o=objectKeys$2(t),i=o.length,a=0;i>a;)objectDefineProperty.f(e,r=o[a++],n[r]);return e},objectDefineProperties$1={f:f$4},html$2=getBuiltIn("document","documentElement"),GT$1=">",LT$1="<",PROTOTYPE$1="prototype",SCRIPT$1="script",IE_PROTO$3=sharedKey$2("IE_PROTO"),EmptyConstructor$1=function(){},scriptTag$1=function(e){return LT$1+SCRIPT$1+GT$1+e+LT$1+"/"+SCRIPT$1+GT$1},NullProtoObjectViaActiveX$1=function(e){e.write(scriptTag$1("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame$1=function(){var e,t=documentCreateElement("iframe"),r="java"+SCRIPT$1+":";return t.style.display="none",html$2.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(scriptTag$1("document.F=Object")),e.close(),e.F},activeXDocument$1,NullProtoObject$1=function(){try{activeXDocument$1=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject$1="undefined"!=typeof document?document.domain&&activeXDocument$1?NullProtoObjectViaActiveX$1(activeXDocument$1):NullProtoObjectViaIFrame$1():NullProtoObjectViaActiveX$1(activeXDocument$1);for(var e=enumBugKeys$2.length;e--;)delete NullProtoObject$1[PROTOTYPE$1][enumBugKeys$2[e]];return NullProtoObject$1()};hiddenKeys$4[IE_PROTO$3]=!0;var objectCreate$1=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor$1[PROTOTYPE$1]=anObject(e),r=new EmptyConstructor$1,EmptyConstructor$1[PROTOTYPE$1]=null,r[IE_PROTO$3]=e):r=NullProtoObject$1(),void 0===t?r:objectDefineProperties$1.f(r,t)},defineBuiltIns=function(e,t,r){for(var n in t)defineBuiltIn$2(e,n,t[n],r);return e},correctPrototypeGetter$1=!fails((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),IE_PROTO$2=sharedKey$2("IE_PROTO"),$Object$2=Object,ObjectPrototype$1=$Object$2.prototype,objectGetPrototypeOf$1=correctPrototypeGetter$1?$Object$2.getPrototypeOf:function(e){var t=toObject(e);if(hasOwnProperty_1(t,IE_PROTO$2))return t[IE_PROTO$2];var r=t.constructor;return isCallable(r)&&t instanceof r?r.prototype:t instanceof $Object$2?ObjectPrototype$1:null},ITERATOR$6=wellKnownSymbol("iterator"),BUGGY_SAFARI_ITERATORS$3=!1,IteratorPrototype$5,PrototypeOfArrayIteratorPrototype$1,arrayIterator$1;[].keys&&(arrayIterator$1=[].keys(),"next"in arrayIterator$1?(PrototypeOfArrayIteratorPrototype$1=objectGetPrototypeOf$1(objectGetPrototypeOf$1(arrayIterator$1)),PrototypeOfArrayIteratorPrototype$1!==Object.prototype&&(IteratorPrototype$5=PrototypeOfArrayIteratorPrototype$1)):BUGGY_SAFARI_ITERATORS$3=!0);var NEW_ITERATOR_PROTOTYPE$1=!isObject(IteratorPrototype$5)||fails((function(){var e={};return IteratorPrototype$5[ITERATOR$6].call(e)!==e}));NEW_ITERATOR_PROTOTYPE$1&&(IteratorPrototype$5={}),isCallable(IteratorPrototype$5[ITERATOR$6])||defineBuiltIn$2(IteratorPrototype$5,ITERATOR$6,(function(){return this}));var iteratorsCore$1={IteratorPrototype:IteratorPrototype$5,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$3},IteratorPrototype$4=iteratorsCore$1.IteratorPrototype,returnThis$3=function(){return this},iteratorCreateConstructor$1=function(e,t,r,n){var o=t+" Iterator";return e.prototype=objectCreate$1(IteratorPrototype$4,{next:createPropertyDescriptor(+!n,r)}),setToStringTag$2(e,o,!1),iterators$1[o]=returnThis$3,e},PROPER_FUNCTION_NAME$2=functionName$1.PROPER,CONFIGURABLE_FUNCTION_NAME$1=functionName$1.CONFIGURABLE,IteratorPrototype$3=iteratorsCore$1.IteratorPrototype,BUGGY_SAFARI_ITERATORS$2=iteratorsCore$1.BUGGY_SAFARI_ITERATORS,ITERATOR$5=wellKnownSymbol("iterator"),KEYS$1="keys",VALUES$1="values",ENTRIES$1="entries",returnThis$2=function(){return this},iteratorDefine$1=function(e,t,r,n,o,i,a){iteratorCreateConstructor$1(r,t,n);var s,l,c,u=function(e){if(e===o&&f)return f;if(!BUGGY_SAFARI_ITERATORS$2&&e in p)return p[e];switch(e){case KEYS$1:case VALUES$1:case ENTRIES$1:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",g=!1,p=e.prototype,h=p[ITERATOR$5]||p["@@iterator"]||o&&p[o],f=!BUGGY_SAFARI_ITERATORS$2&&h||u(o),y="Array"==t&&p.entries||h;if(y&&(s=objectGetPrototypeOf$1(y.call(new e)))!==Object.prototype&&s.next&&(objectGetPrototypeOf$1(s)!==IteratorPrototype$3&&(objectSetPrototypeOf$1?objectSetPrototypeOf$1(s,IteratorPrototype$3):isCallable(s[ITERATOR$5])||defineBuiltIn$2(s,ITERATOR$5,returnThis$2)),setToStringTag$2(s,d,!0)),PROPER_FUNCTION_NAME$2&&o==VALUES$1&&h&&h.name!==VALUES$1&&(CONFIGURABLE_FUNCTION_NAME$1?createNonEnumerableProperty(p,"name",VALUES$1):(g=!0,f=function(){return functionCall(h,this)})),o)if(l={values:u(VALUES$1),keys:i?f:u(KEYS$1),entries:u(ENTRIES$1)},a)for(c in l)(BUGGY_SAFARI_ITERATORS$2||g||!(c in p))&&defineBuiltIn$2(p,c,l[c]);else _export({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS$2||g},l);return p[ITERATOR$5]!==f&&defineBuiltIn$2(p,ITERATOR$5,f,{name:o}),iterators$1[t]=f,l},createIterResultObject$2=function(e,t){return{value:e,done:t}},SPECIES$6=wellKnownSymbol("species"),setSpecies$2=function(e){var t=getBuiltIn(e),r=objectDefineProperty.f;descriptors&&t&&!t[SPECIES$6]&&r(t,SPECIES$6,{configurable:!0,get:function(){return this}})},defineProperty$3=objectDefineProperty.f,fastKey=internalMetadata.fastKey,setInternalState$3=internalState$1.set,internalStateGetterFor=internalState$1.getterFor,collectionStrong={getConstructor:function(e,t,r,n){var o=e((function(e,o){anInstance$2(e,i),setInternalState$3(e,{type:t,index:objectCreate$1(null),first:void 0,last:void 0,size:0}),descriptors||(e.size=0),isNullOrUndefined(o)||iterate$2(o,e[n],{that:e,AS_ENTRIES:r})})),i=o.prototype,a=internalStateGetterFor(t),s=function(e,t,r){var n,o,i=a(e),s=l(e,t);return s?s.value=r:(i.last=s={index:o=fastKey(t,!0),key:t,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),descriptors?i.size++:e.size++,"F"!==o&&(i.index[o]=s)),e},l=function(e,t){var r,n=a(e),o=fastKey(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return defineBuiltIns(i,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,descriptors?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=l(t,e);if(n){var o=n.next,i=n.previous;delete r.index[n.index],n.removed=!0,i&&(i.next=o),o&&(o.previous=i),r.first==n&&(r.first=o),r.last==n&&(r.last=i),descriptors?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=functionBindContext(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!l(this,e)}}),defineBuiltIns(i,r?{get:function(e){var t=l(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),descriptors&&defineProperty$3(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(e,t,r){var n=t+" Iterator",o=internalStateGetterFor(t),i=internalStateGetterFor(n);iteratorDefine$1(e,t,(function(e,t){setInternalState$3(this,{type:n,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?createIterResultObject$2("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,createIterResultObject$2(void 0,!0))}),r?"entries":"values",!r,!0),setSpecies$2(t)}};collection("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong);var noop$1=function(){},empty$1=[],construct$2=getBuiltIn("Reflect","construct"),constructorRegExp$1=/^\s*(?:class|function)\b/,exec$2=functionUncurryThis(constructorRegExp$1.exec),INCORRECT_TO_STRING$1=!constructorRegExp$1.exec(noop$1),isConstructorModern$1=function(e){if(!isCallable(e))return!1;try{return construct$2(noop$1,empty$1,e),!0}catch(e){return!1}},isConstructorLegacy$1=function(e){if(!isCallable(e))return!1;switch(classof$2(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING$1||!!exec$2(constructorRegExp$1,inspectSource$2(e))}catch(e){return!0}};isConstructorLegacy$1.sham=!0;var isConstructor$2=!construct$2||fails((function(){var e;return isConstructorModern$1(isConstructorModern$1.call)||!isConstructorModern$1(Object)||!isConstructorModern$1((function(){e=!0}))||e}))?isConstructorLegacy$1:isConstructorModern$1,$TypeError$b=TypeError,aConstructor$2=function(e){if(isConstructor$2(e))return e;throw $TypeError$b(tryToString(e)+" is not a constructor")},SPECIES$5=wellKnownSymbol("species"),speciesConstructor$2=function(e,t){var r,n=anObject(e).constructor;return void 0===n||isNullOrUndefined(r=anObject(n)[SPECIES$5])?t:aConstructor$2(r)},getSetIterator=function(e){return functionCall(Set.prototype.values,e)};_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=anObject(this),r=getSetIterator(t),n=functionBindContext(e,arguments.length>1?arguments[1]:void 0),o=new(speciesConstructor$2(t,getBuiltIn("Set"))),i=aCallable(o.add);return iterate$2(r,(function(e){functionCall(i,o,n(e,e,t))}),{IS_ITERATOR:!0}),o}});var entryUnbind=function(e,t){return functionUncurryThis(global_1[e].prototype[t])},Reflect$1;entryUnbind("Set","map"),function(e){!function(t){var r="object"==typeof commonjsGlobal?commonjsGlobal:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=o(e);function o(e,t){return function(r,n){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0===r.Reflect?r.Reflect=e:n=o(r.Reflect,n),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!i&&!a,l={create:i?function(){return ne(Object.create(null))}:a?function(){return ne({__proto__:null})}:function(){return ne({})},has:s?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:s?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),u="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=u||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,g=u||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,p=new(u||"function"!=typeof WeakMap?re():WeakMap);function h(e,t,r,n){if(j(r)){if(!G(e))throw new TypeError;if(!J(t))throw new TypeError;return A(e,t)}if(!G(e))throw new TypeError;if(!B(t))throw new TypeError;if(!B(n)&&!j(n)&&!M(n))throw new TypeError;return M(n)&&(n=void 0),E(e,t,r=V(r),n)}function f(e,t){function r(r,n){if(!B(r))throw new TypeError;if(!j(n)&&!H(n))throw new TypeError;R(e,t,r,n)}return r}function y(e,t,r,n){if(!B(r))throw new TypeError;return j(n)||(n=V(n)),R(e,t,r,n)}function $(e,t,r){if(!B(t))throw new TypeError;return j(r)||(r=V(r)),C(e,t,r)}function m(e,t,r){if(!B(t))throw new TypeError;return j(r)||(r=V(r)),I(e,t,r)}function w(e,t,r){if(!B(t))throw new TypeError;return j(r)||(r=V(r)),O(e,t,r)}function b(e,t,r){if(!B(t))throw new TypeError;return j(r)||(r=V(r)),P(e,t,r)}function v(e,t){if(!B(e))throw new TypeError;return j(t)||(t=V(t)),x(e,t)}function _(e,t){if(!B(e))throw new TypeError;return j(t)||(t=V(t)),k(e,t)}function T(e,t,r){if(!B(t))throw new TypeError;j(r)||(r=V(r));var n=S(t,r,!1);if(j(n))return!1;if(!n.delete(e))return!1;if(n.size>0)return!0;var o=p.get(t);return o.delete(r),o.size>0||p.delete(t),!0}function A(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!j(n)&&!M(n)){if(!J(n))throw new TypeError;t=n}}return t}function E(e,t,r,n){for(var o=e.length-1;o>=0;--o){var i=(0,e[o])(t,r,n);if(!j(i)&&!M(i)){if(!B(i))throw new TypeError;n=i}}return n}function S(e,t,r){var n=p.get(e);if(j(n)){if(!r)return;n=new d,p.set(e,n)}var o=n.get(t);if(j(o)){if(!r)return;o=new d,n.set(t,o)}return o}function C(e,t,r){if(I(e,t,r))return!0;var n=Z(t);return!M(n)&&C(e,n,r)}function I(e,t,r){var n=S(t,r,!1);return!j(n)&&F(n.has(e))}function O(e,t,r){if(I(e,t,r))return P(e,t,r);var n=Z(t);return M(n)?void 0:O(e,n,r)}function P(e,t,r){var n=S(t,r,!1);if(!j(n))return n.get(e)}function R(e,t,r,n){S(r,n,!0).set(e,t)}function x(e,t){var r=k(e,t),n=Z(e);if(null===n)return r;var o=x(n,t);if(o.length<=0)return r;if(r.length<=0)return o;for(var i=new g,a=[],s=0,l=r;s<l.length;s++){var c=l[s];i.has(c)||(i.add(c),a.push(c))}for(var u=0,d=o;u<d.length;u++){c=d[u];i.has(c)||(i.add(c),a.push(c))}return a}function k(e,t){var r=[],n=S(e,t,!1);if(j(n))return r;for(var o=Q(n.keys()),i=0;;){var a=z(o);if(!a)return r.length=i,r;var s=Y(a);try{r[i]=s}catch(e){try{X(o)}finally{throw e}}i++}}function N(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function j(e){return void 0===e}function M(e){return null===e}function D(e){return"symbol"==typeof e}function B(e){return"object"==typeof e?null!==e:"function"==typeof e}function L(e,t){switch(N(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",o=q(e,n);if(void 0!==o){var i=o.call(e,r);if(B(i))throw new TypeError;return i}return W(e,"default"===r?"number":r)}function W(e,t){if("string"===t){var r=e.toString;if(K(r))if(!B(o=r.call(e)))return o;if(K(n=e.valueOf))if(!B(o=n.call(e)))return o}else{var n;if(K(n=e.valueOf))if(!B(o=n.call(e)))return o;var o,i=e.toString;if(K(i))if(!B(o=i.call(e)))return o}throw new TypeError}function F(e){return!!e}function U(e){return""+e}function V(e){var t=L(e,3);return D(t)?t:U(t)}function G(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function K(e){return"function"==typeof e}function J(e){return"function"==typeof e}function H(e){switch(N(e)){case 3:case 4:return!0;default:return!1}}function q(e,t){var r=e[t];if(null!=r){if(!K(r))throw new TypeError;return r}}function Q(e){var t=q(e,o);if(!K(t))throw new TypeError;var r=t.call(e);if(!B(r))throw new TypeError;return r}function Y(e){return e.value}function z(e){var t=e.next();return!t.done&&t}function X(e){var t=e.return;t&&t.call(e)}function Z(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var o=n.constructor;return"function"!=typeof o||o===e?t:o}function ee(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,o=r+1;o<n;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function i(e,t){return t}function a(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}()}function re(){var e=16,r=l.create(),n=o();return function(){function e(){this._key=o()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=o()},e}();function o(){var e;do{e="@@WeakMap@@"+c()}while(l.has(r,e));return r[e]=!0,e}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:l.create()})}return e[n]}function a(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function s(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}function c(){var t=s(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",n=0;n<e;++n){var o=t[n];4!==n&&6!==n&&8!==n||(r+="-"),o<16&&(r+="0"),r+=o.toString(16).toLowerCase()}return r}}function ne(e){return e.__=void 0,delete e.__,e}e("decorate",h),e("metadata",f),e("defineMetadata",y),e("hasMetadata",$),e("hasOwnMetadata",m),e("getMetadata",w),e("getOwnMetadata",b),e("getMetadataKeys",v),e("getOwnMetadataKeys",_),e("deleteMetadata",T)}(n)}()}(Reflect$1||(Reflect$1={})),createCommonjsModule((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n=d;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw i;return P()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=E(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var l=u(e,t,r);if("normal"===l.type){if(n=r.done?h:g,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=h,r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",g="suspendedYield",p="executing",h="completed",f={};function y(){}function $(){}function m(){}var w={};l(w,i,(function(){return this}));var b=Object.getPrototypeOf,v=b&&b(b(O([])));v&&v!==r&&n.call(v,i)&&(w=v);var _=m.prototype=y.prototype=Object.create(w);function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,i,a,s){var l=u(e[o],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function E(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var o=u(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,f;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function O(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return $.prototype=m,l(_,"constructor",m),l(m,"constructor",$),$.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===$||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},T(A.prototype),l(A.prototype,a,(function(){return this})),e.AsyncIterator=A,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new A(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(_),l(_,s,"Generator"),l(_,i,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}));var $Function=Function,concat$2=uncurryThis([].concat),join=uncurryThis([].join),factories={},construct$1=function(e,t,r){if(!hasOwn(factories,t)){for(var n=[],o=0;o<t;o++)n[o]="a["+o+"]";factories[t]=$Function("C,a","return new C("+join(n,",")+")")}return factories[t](e,r)},functionBind=NATIVE_BIND?$Function.bind:function(e){var t=aCallable$1(this),r=t.prototype,n=arraySlice$1(arguments,1),o=function(){var r=concat$2(n,arraySlice$1(arguments));return this instanceof o?construct$1(t,r.length,r):t.apply(e,r)};return isObject$1(r)&&(o.prototype=r),o},bind$5=functionBind;$$1({target:"Function",proto:!0,forced:Function.bind!==bind$5},{bind:bind$5});var bind$4=entryVirtual("Function").bind,method$d=bind$4,FunctionPrototype$1=Function.prototype,bind$3=function(e){var t=e.bind;return e===FunctionPrototype$1||isPrototypeOf(FunctionPrototype$1,e)&&t===FunctionPrototype$1.bind?method$d:t},parent$m=bind$3,bind$2=parent$m,require$$0$v=bind$2,bind$1=require$$0$v;function __decorate(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function __param(e,t){return function(r,n){t(r,n,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var $Date=Date,thisTimeValue=uncurryThis($Date.prototype.getTime);$$1({target:"Date",stat:!0},{now:function(){return thisTimeValue(new $Date)}});var now$2=path.Date.now,parent$l=now$2,now$1=parent$l,require$$0$u=now$1,now=require$$0$u,TO_STRING_TAG$4=wellKnownSymbol$1("toStringTag"),test$2={};test$2[TO_STRING_TAG$4]="z";var toStringTagSupport="[object z]"===String(test$2),TO_STRING_TAG_SUPPORT=toStringTagSupport,TO_STRING_TAG$3=wellKnownSymbol$1("toStringTag"),$Object$1=Object,CORRECT_ARGUMENTS="Arguments"==classof$3(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}},classof$1=TO_STRING_TAG_SUPPORT?classof$3:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=$Object$1(e),TO_STRING_TAG$3))?r:CORRECT_ARGUMENTS?classof$3(t):"Object"==(n=classof$3(t))&&isCallable$1(t.callee)?"Arguments":n},classof=classof$1,$String$1=String,toString_1=function(e){if("Symbol"===classof(e))throw TypeError("Cannot convert a Symbol value to a string");return $String$1(e)},toString$3=toString_1,charAt$2=uncurryThis("".charAt),charCodeAt$1=uncurryThis("".charCodeAt),stringSlice=uncurryThis("".slice),createMethod$4=function(e){return function(t,r){var n,o,i=toString$3(requireObjectCoercible$1(t)),a=toIntegerOrInfinity$1(r),s=i.length;return a<0||a>=s?e?"":void 0:(n=charCodeAt$1(i,a))<55296||n>56319||a+1===s||(o=charCodeAt$1(i,a+1))<56320||o>57343?e?charAt$2(i,a):n:e?stringSlice(i,a,a+2):o-56320+(n-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$4(!1),charAt:createMethod$4(!0)},WeakMap$2=global$1.WeakMap,weakMapBasicDetection=isCallable$1(WeakMap$2)&&/native code/.test(String(WeakMap$2)),keys=shared$1("keys"),sharedKey$1=function(e){return keys[e]||(keys[e]=uid$1(e))},hiddenKeys$2={},NATIVE_WEAK_MAP=weakMapBasicDetection,sharedKey=sharedKey$1,hiddenKeys$1=hiddenKeys$2,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$2=global$1.TypeError,WeakMap$1=global$1.WeakMap,set$1,get,has,enforce=function(e){return has(e)?get(e):set$1(e,{})},getterFor=function(e){return function(t){var r;if(!isObject$1(t)||(r=get(t)).type!==e)throw TypeError$2("Incompatible receiver, "+e+" required");return r}};if(NATIVE_WEAK_MAP||store$3.state){var store=store$3.state||(store$3.state=new WeakMap$1);store.get=store.get,store.has=store.has,store.set=store.set,set$1=function(e,t){if(store.has(e))throw TypeError$2(OBJECT_ALREADY_INITIALIZED);return t.facade=e,store.set(e,t),t},get=function(e){return store.get(e)||{}},has=function(e){return store.has(e)}}else{var STATE=sharedKey("state");hiddenKeys$1[STATE]=!0,set$1=function(e,t){if(hasOwn(e,STATE))throw TypeError$2(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$1(e,STATE,t),t},get=function(e){return hasOwn(e,STATE)?e[STATE]:{}},has=function(e){return hasOwn(e,STATE)}}var internalState={set:set$1,get:get,has:has,enforce:enforce,getterFor:getterFor},FunctionPrototype=Function.prototype,getDescriptor=DESCRIPTORS&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn(FunctionPrototype,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS||DESCRIPTORS&&getDescriptor(FunctionPrototype,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},indexOf=require$$0$x.indexOf,push$4=uncurryThis([].push),objectKeysInternal=function(e,t){var r,n=toIndexedObject$1(e),o=0,i=[];for(r in n)!hasOwn(hiddenKeys$1,r)&&hasOwn(n,r)&&push$4(i,r);for(;t.length>o;)hasOwn(n,r=t[o++])&&(~indexOf(i,r)||push$4(i,r));return i},enumBugKeys$1=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys=objectKeysInternal,enumBugKeys=enumBugKeys$1,objectKeys$1=Object.keys||function(e){return internalObjectKeys(e,enumBugKeys)},objectKeys=objectKeys$1,f$3=DESCRIPTORS&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function(e,t){anObject$1(e);for(var r,n=toIndexedObject$1(t),o=objectKeys(t),i=o.length,a=0;i>a;)definePropertyModule.f(e,r=o[a++],n[r]);return e},objectDefineProperties={f:f$3},html$1=getBuiltIn$1("document","documentElement"),definePropertiesModule=objectDefineProperties,html=html$1,GT=">",LT="<",PROTOTYPE="prototype",SCRIPT="script",IE_PROTO$1=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return LT+SCRIPT+GT+e+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=createElement("iframe"),r="java"+SCRIPT+":";return t.style.display="none",html.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},activeXDocument,NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var e=enumBugKeys.length;e--;)delete NullProtoObject[PROTOTYPE][enumBugKeys[e]];return NullProtoObject()};hiddenKeys$1[IE_PROTO$1]=!0;var objectCreate=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor[PROTOTYPE]=anObject$1(e),r=new EmptyConstructor,EmptyConstructor[PROTOTYPE]=null,r[IE_PROTO$1]=e):r=NullProtoObject(),void 0===t?r:definePropertiesModule.f(r,t)},correctPrototypeGetter=!fails$1((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,IE_PROTO=sharedKey("IE_PROTO"),$Object=Object,ObjectPrototype=$Object.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER?$Object.getPrototypeOf:function(e){var t=toObject$1(e);if(hasOwn(t,IE_PROTO))return t[IE_PROTO];var r=t.constructor;return isCallable$1(r)&&t instanceof r?r.prototype:t instanceof $Object?ObjectPrototype:null},defineBuiltIn$1=function(e,t,r,n){return n&&n.enumerable?e[t]=r:createNonEnumerableProperty$1(e,t,r),e},create=objectCreate,getPrototypeOf=objectGetPrototypeOf,defineBuiltIn=defineBuiltIn$1,ITERATOR$4=wellKnownSymbol$1("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf(getPrototypeOf(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=!isObject$1(IteratorPrototype$2)||fails$1((function(){var e={};return IteratorPrototype$2[ITERATOR$4].call(e)!==e}));NEW_ITERATOR_PROTOTYPE?IteratorPrototype$2={}:IS_PURE&&(IteratorPrototype$2=create(IteratorPrototype$2)),isCallable$1(IteratorPrototype$2[ITERATOR$4])||defineBuiltIn(IteratorPrototype$2,ITERATOR$4,(function(){return this}));var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},objectToString=TO_STRING_TAG_SUPPORT?{}.toString:function(){return"[object "+classof(this)+"]"},toString$2=objectToString,defineProperty$2=definePropertyModule.f,TO_STRING_TAG$2=wellKnownSymbol$1("toStringTag"),setToStringTag$1=function(e,t,r,n){if(e){var o=r?e:e.prototype;hasOwn(o,TO_STRING_TAG$2)||defineProperty$2(o,TO_STRING_TAG$2,{configurable:!0,value:t}),n&&!TO_STRING_TAG_SUPPORT&&createNonEnumerableProperty$1(o,"toString",toString$2)}},iterators={},IteratorsCore=iteratorsCore,setToStringTag=setToStringTag$1,Iterators=iterators,IteratorPrototype$1=IteratorsCore.IteratorPrototype,returnThis$1=function(){return this},iteratorCreateConstructor=function(e,t,r,n){var o=t+" Iterator";return e.prototype=create(IteratorPrototype$1,{next:createPropertyDescriptor$1(+!n,r)}),setToStringTag(e,o,!1,!0),Iterators[o]=returnThis$1,e},$String=String,$TypeError$a=TypeError,aPossiblePrototype$1=function(e){if("object"==typeof e||isCallable$1(e))return e;throw $TypeError$a("Can't set "+$String(e)+" as a prototype")},aPossiblePrototype=aPossiblePrototype$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=uncurryThis(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return anObject$1(r),aPossiblePrototype(n),t?e(r,n):r.__proto__=n,r}}():void 0),require$$0$t=functionName,createIteratorConstructor=iteratorCreateConstructor,setPrototypeOf=objectSetPrototypeOf,PROPER_FUNCTION_NAME$1=require$$0$t.PROPER,CONFIGURABLE_FUNCTION_NAME=require$$0$t.CONFIGURABLE,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$3=wellKnownSymbol$1("iterator"),KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},iteratorDefine=function(e,t,r,n,o,i,a){createIteratorConstructor(r,t,n);var s,l,c,u=function(e){if(e===o&&f)return f;if(!BUGGY_SAFARI_ITERATORS&&e in p)return p[e];switch(e){case KEYS:case VALUES:case ENTRIES:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",g=!1,p=e.prototype,h=p[ITERATOR$3]||p["@@iterator"]||o&&p[o],f=!BUGGY_SAFARI_ITERATORS&&h||u(o),y="Array"==t&&p.entries||h;if(y&&(s=getPrototypeOf(y.call(new e)))!==Object.prototype&&s.next&&(IS_PURE||getPrototypeOf(s)===IteratorPrototype||(setPrototypeOf?setPrototypeOf(s,IteratorPrototype):isCallable$1(s[ITERATOR$3])||defineBuiltIn(s,ITERATOR$3,returnThis)),setToStringTag(s,d,!0,!0),IS_PURE&&(Iterators[d]=returnThis)),PROPER_FUNCTION_NAME$1&&o==VALUES&&h&&h.name!==VALUES&&(!IS_PURE&&CONFIGURABLE_FUNCTION_NAME?createNonEnumerableProperty$1(p,"name",VALUES):(g=!0,f=function(){return call$2(h,this)})),o)if(l={values:u(VALUES),keys:i?f:u(KEYS),entries:u(ENTRIES)},a)for(c in l)(BUGGY_SAFARI_ITERATORS||g||!(c in p))&&defineBuiltIn(p,c,l[c]);else $$1({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||g},l);return IS_PURE&&!a||p[ITERATOR$3]===f||defineBuiltIn(p,ITERATOR$3,f,{name:o}),Iterators[t]=f,l},createIterResultObject$1=function(e,t){return{value:e,done:t}},require$$0$s=stringMultibyte,InternalStateModule=internalState,defineIterator=iteratorDefine,createIterResultObject=createIterResultObject$1,charAt$1=require$$0$s.charAt,STRING_ITERATOR="String Iterator",setInternalState$2=InternalStateModule.set,getInternalState$1=InternalStateModule.getterFor(STRING_ITERATOR);defineIterator(String,"String",(function(e){setInternalState$2(this,{type:STRING_ITERATOR,string:toString$3(e),index:0})}),(function(){var e,t=getInternalState$1(this),r=t.string,n=t.index;return n>=r.length?createIterResultObject(void 0,!0):(e=charAt$1(r,n),t.index+=e.length,createIterResultObject(e,!1))}));var iteratorClose$1=function(e,t,r){var n,o;anObject$1(e);try{if(!(n=getMethod$1(e,"return"))){if("throw"===t)throw r;return r}n=call$2(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw r;if(o)throw n;return anObject$1(n),r},iteratorClose=iteratorClose$1,callWithSafeIterationClosing$1=function(e,t,r,n){try{return n?t(anObject$1(r)[0],r[1]):t(r)}catch(t){iteratorClose(e,"throw",t)}},ITERATOR$2=wellKnownSymbol$1("iterator"),ArrayPrototype$b=Array.prototype,isArrayIteratorMethod$1=function(e){return void 0!==e&&(Iterators.Array===e||ArrayPrototype$b[ITERATOR$2]===e)},functionToString=uncurryThis(Function.toString);isCallable$1(store$3.inspectSource)||(store$3.inspectSource=function(e){return functionToString(e)});var inspectSource$1=store$3.inspectSource,inspectSource=inspectSource$1,noop=function(){},empty=[],construct=getBuiltIn$1("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec$1=uncurryThis(constructorRegExp.exec),INCORRECT_TO_STRING=!constructorRegExp.exec(noop),isConstructorModern=function(e){if(!isCallable$1(e))return!1;try{return construct(noop,empty,e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!isCallable$1(e))return!1;switch(classof(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING||!!exec$1(constructorRegExp,inspectSource(e))}catch(e){return!0}};isConstructorLegacy.sham=!0;var isConstructor$1=!construct||fails$1((function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){e=!0}))||e}))?isConstructorLegacy:isConstructorModern,createProperty$1=function(e,t,r){var n=toPropertyKey$1(t);n in e?definePropertyModule.f(e,n,createPropertyDescriptor$1(0,r)):e[n]=r},ITERATOR$1=wellKnownSymbol$1("iterator"),getIteratorMethod$1=function(e){if(!isNullOrUndefined$1(e))return getMethod$1(e,ITERATOR$1)||getMethod$1(e,"@@iterator")||Iterators[classof(e)]},getIteratorMethod=getIteratorMethod$1,$TypeError$9=TypeError,getIterator$1=function(e,t){var r=arguments.length<2?getIteratorMethod(e):t;if(aCallable$1(r))return anObject$1(call$2(r,e));throw $TypeError$9(tryToString$1(e)+" is not iterable")},callWithSafeIterationClosing=callWithSafeIterationClosing$1,isArrayIteratorMethod=isArrayIteratorMethod$1,isConstructor=isConstructor$1,createProperty=createProperty$1,getIterator=getIterator$1,$Array$2=Array,arrayFrom=function(e){var t=toObject$1(e),r=isConstructor(this),n=arguments.length,o=n>1?arguments[1]:void 0,i=void 0!==o;i&&(o=bind$7(o,n>2?arguments[2]:void 0));var a,s,l,c,u,d,g=getIteratorMethod(t),p=0;if(!g||this===$Array$2&&isArrayIteratorMethod(g))for(a=lengthOfArrayLike$1(t),s=r?new this(a):$Array$2(a);a>p;p++)d=i?o(t[p],p):t[p],createProperty(s,p,d);else for(u=(c=getIterator(t,g)).next,s=r?new this:[];!(l=call$2(u,c)).done;p++)d=i?callWithSafeIterationClosing(c,o,[l.value,p],!0):l.value,createProperty(s,p,d);return s.length=p,s},ITERATOR=wellKnownSymbol$1("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration$1=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var r=!1;try{var n={};n[ITERATOR]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},from=arrayFrom,checkCorrectnessOfIteration=checkCorrectnessOfIteration$1,INCORRECT_ITERATION=!checkCorrectnessOfIteration((function(e){Array.from(e)}));$$1({target:"Array",stat:!0,forced:INCORRECT_ITERATION},{from:from});var from_1$2=path.Array.from,parent$k=from_1$2,from_1$1=parent$k,require$$0$r=from_1$1,from_1=require$$0$r,isArray$4=Array.isArray||function(e){return"Array"==classof$3(e)},isArray$3=isArray$4,$stringify=getBuiltIn$1("JSON","stringify"),exec=uncurryThis(/./.exec),charAt=uncurryThis("".charAt),charCodeAt=uncurryThis("".charCodeAt),replace$2=uncurryThis("".replace),numberToString=uncurryThis(1..toString),tester=/[\uD800-\uDFFF]/g,low=/^[\uD800-\uDBFF]$/,hi=/^[\uDC00-\uDFFF]$/,WRONG_SYMBOLS_CONVERSION=!NATIVE_SYMBOL||fails$1((function(){var e=getBuiltIn$1("Symbol")();return"[null]"!=$stringify([e])||"{}"!=$stringify({a:e})||"{}"!=$stringify(Object(e))})),ILL_FORMED_UNICODE=fails$1((function(){return'"\\udf06\\ud834"'!==$stringify("\udf06\ud834")||'"\\udead"'!==$stringify("\udead")})),stringifyWithSymbolsFix=function(e,t){var r=arraySlice$1(arguments),n=t;if((isObject$1(t)||void 0!==e)&&!isSymbol$1(e))return isArray$3(t)||(t=function(e,t){if(isCallable$1(n)&&(t=call$2(n,this,e,t)),!isSymbol$1(t))return t}),r[1]=t,apply($stringify,null,r)},fixIllFormed=function(e,t,r){var n=charAt(r,t-1),o=charAt(r,t+1);return exec(low,e)&&!exec(hi,o)||exec(hi,e)&&!exec(low,n)?"\\u"+numberToString(charCodeAt(e,0),16):e};$stringify&&$$1({target:"JSON",stat:!0,arity:3,forced:WRONG_SYMBOLS_CONVERSION||ILL_FORMED_UNICODE},{stringify:function(e,t,r){var n=arraySlice$1(arguments),o=apply(WRONG_SYMBOLS_CONVERSION?stringifyWithSymbolsFix:$stringify,null,n);return ILL_FORMED_UNICODE&&"string"==typeof o?replace$2(o,tester,fixIllFormed):o}}),path.JSON||(path.JSON={stringify:JSON.stringify});var stringify$2=function(e,t,r){return apply(path.JSON.stringify,null,arguments)},parent$j=stringify$2,stringify$1=parent$j,require$$0$q=stringify$1,stringify=require$$0$q;function CatchErrors(e){let t,r;return"string"==typeof e?t=e:void 0!==e&&({component:t,callback:r}=e),function(e,n,o){const i=o.value;return o.value=function(){try{return bind$1(i).call(i,this,...from_1(arguments))()}catch(e){const n=asErrorObject(e);if(this.errorTracker.track(n,t),void 0!==r)try{r(this)}catch(e){const r=t?`${t}.errorCallback`:"errorCallback";this.errorTracker.track(asErrorObject(e),r)}}},o}}function asErrorObject(e){if(e instanceof Error)return e;if("object"==typeof e)try{return new Error(stringify(e))}catch(e){}return new Error(String(e).toString())}const ENV="prod";var Lifecycle;!function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(Lifecycle||(Lifecycle={}));var Lifecycle$1=Lifecycle,extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},extendStatics(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function __awaiter(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))}function __generator(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var INJECTION_TOKEN_METADATA_KEY="injectionTokens";function getParamInfo(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],r=Reflect.getOwnMetadata(INJECTION_TOKEN_METADATA_KEY,e)||{};return Object.keys(r).forEach((function(e){t[+e]=r[e]})),t}function defineInjectionTokenMetadata(e,t){return function(r,n,o){var i=Reflect.getOwnMetadata(INJECTION_TOKEN_METADATA_KEY,r)||{};i[o]=t?{token:e,transform:t.transformToken,transformArgs:t.args||[]}:e,Reflect.defineMetadata(INJECTION_TOKEN_METADATA_KEY,i,r)}}function isClassProvider(e){return!!e.useClass}function isFactoryProvider(e){return!!e.useFactory}var DelayedConstructor=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,r=this,n=!1;return new Proxy({},this.createHandler((function(){return n||(t=e(r.wrap()),n=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(r){t[r]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[0]=e();var o=Reflect[r];return o.apply(void 0,__spread(t))}})),t},e}();function isNormalToken(e){return"string"==typeof e||"symbol"==typeof e}function isTokenDescriptor(e){return"object"==typeof e&&"token"in e&&"multiple"in e}function isTransformDescriptor(e){return"object"==typeof e&&"token"in e&&"transform"in e}function isConstructorToken(e){return"function"==typeof e||e instanceof DelayedConstructor}function isTokenProvider(e){return!!e.useToken}function isValueProvider(e){return null!=e.useValue}function isProvider(e){return isClassProvider(e)||isValueProvider(e)||isTokenProvider(e)||isFactoryProvider(e)}var RegistryBase=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),Registry=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(RegistryBase),ResolutionContext=function(){this.scopedResolutions=new Map};function formatDependency(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}function composeErrorMessage(e,t,r){return void 0===r&&(r="    "),__spread([e],t.message.split("\n").map((function(e){return r+e}))).join("\n")}function formatErrorCtor(e,t,r){var n=__read(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return composeErrorMessage("Cannot inject the dependency "+formatDependency(void 0===n?null:n,t)+' of "'+e.name+'" constructor. Reason:',r)}function isDisposable(e){return"function"==typeof e.dispose&&!(e.dispose.length>0)}var PreResolutionInterceptors=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(RegistryBase),PostResolutionInterceptors=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(RegistryBase),Interceptors=function(){this.preResolution=new PreResolutionInterceptors,this.postResolution=new PostResolutionInterceptors},typeInfo=new Map,InternalDependencyContainer=function(){function e(e){this.parent=e,this._registry=new Registry,this.interceptors=new Interceptors,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,r){var n;if(void 0===r&&(r={lifecycle:Lifecycle$1.Transient}),this.ensureNotDisposed(),isTokenProvider(n=isProvider(t)?t:{useClass:t}))for(var o=[e],i=n;null!=i;){var a=i.useToken;if(o.includes(a))throw new Error("Token registration cycle detected! "+__spread(o,[a]).join(" -> "));o.push(a);var s=this._registry.get(a);i=s&&isTokenProvider(s.provider)?s.provider:null}if((r.lifecycle===Lifecycle$1.Singleton||r.lifecycle==Lifecycle$1.ContainerScoped||r.lifecycle==Lifecycle$1.ResolutionScoped)&&(isValueProvider(n)||isFactoryProvider(n)))throw new Error('Cannot use lifecycle "'+Lifecycle$1[r.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:n,options:r}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),isNormalToken(e)){if(isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:Lifecycle$1.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Lifecycle$1.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var r=e;return t&&!isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:Lifecycle$1.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new ResolutionContext),this.ensureNotDisposed();var r=this.getRegistration(e);if(!r&&isNormalToken(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),r){var n=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,n,"Single"),n}if(isConstructorToken(e)){n=this.construct(e,t);return this.executePostResolutionInterceptor(e,n,"Single"),n}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var r,n;if(this.interceptors.preResolution.has(e)){var o=[];try{for(var i=__values(this.interceptors.preResolution.getAll(e)),a=i.next();!a.done;a=i.next()){var s=a.value;"Once"!=s.options.frequency&&o.push(s),s.callback(e,t)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.interceptors.preResolution.setAll(e,o)}},e.prototype.executePostResolutionInterceptor=function(e,t,r){var n,o;if(this.interceptors.postResolution.has(e)){var i=[];try{for(var a=__values(this.interceptors.postResolution.getAll(e)),s=a.next();!s.done;s=a.next()){var l=s.value;"Once"!=l.options.frequency&&i.push(l),l.callback(e,t,r)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}this.interceptors.postResolution.setAll(e,i)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Lifecycle$1.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var r,n=e.options.lifecycle===Lifecycle$1.Singleton,o=e.options.lifecycle===Lifecycle$1.ContainerScoped,i=n||o;return r=isValueProvider(e.provider)?e.provider.useValue:isTokenProvider(e.provider)?i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):isClassProvider(e.provider)?i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):isFactoryProvider(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===Lifecycle$1.ResolutionScoped&&t.scopedResolutions.set(e,r),r},e.prototype.resolveAll=function(e,t){var r=this;void 0===t&&(t=new ResolutionContext),this.ensureNotDisposed();var n=this.getAllRegistrations(e);if(!n&&isNormalToken(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),n){var o=n.map((function(e){return r.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,o,"All"),o}var i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var r=__values(this._registry.entries()),n=r.next();!n.done;n=r.next()){var o=__read(n.value,2),i=o[0],a=o[1];this._registry.setAll(i,a.filter((function(e){return!isValueProvider(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,r;this.ensureNotDisposed();var n=new e(this);try{for(var o=__values(this._registry.entries()),i=o.next();!i.done;i=o.next()){var a=__read(i.value,2),s=a[0],l=a[1];l.some((function(e){return e.options.lifecycle===Lifecycle$1.ContainerScoped}))&&n._registry.setAll(s,l.map((function(e){return e.options.lifecycle===Lifecycle$1.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},e.prototype.beforeResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:r})},e.prototype.afterResolution=function(e,t,r){void 0===r&&(r={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:r})},e.prototype.dispose=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach((function(t){var r=t.dispose();r&&e.push(r)})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var r=this;if(e instanceof DelayedConstructor)return e.createProxy((function(e){return r.resolve(e,t)}));var n=function(){var n=typeInfo.get(e);if(!n||0===n.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=n.map(r.resolveParams(t,e));return new(e.bind.apply(e,__spread([void 0],o)))}();return isDisposable(n)&&this.disposables.add(n),n},e.prototype.resolveParams=function(e,t){var r=this;return function(n,o){var i,a,s;try{return isTokenDescriptor(n)?isTransformDescriptor(n)?n.multiple?(i=r.resolve(n.transform)).transform.apply(i,__spread([r.resolveAll(n.token)],n.transformArgs)):(a=r.resolve(n.transform)).transform.apply(a,__spread([r.resolve(n.token,e)],n.transformArgs)):n.multiple?r.resolveAll(n.token):r.resolve(n.token,e):isTransformDescriptor(n)?(s=r.resolve(n.transform,e)).transform.apply(s,__spread([r.resolve(n.token,e)],n.transformArgs)):r.resolve(n,e)}catch(e){throw new Error(formatErrorCtor(t,o,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),instance=new InternalDependencyContainer;function inject$1(e){return defineInjectionTokenMetadata(e)}function injectable(){return function(e){typeInfo.set(e,getParamInfo(e))}}function registry(e){return void 0===e&&(e=[]),function(t){return e.forEach((function(e){var t=e.token,r=e.options,n=__rest(e,["token","options"]);return instance.register(t,n,r)})),t}}function singleton(){return function(e){injectable()(e),instance.registerSingleton(e)}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");let Config=class{scriptName="The-West Calc";scriptShortName="tw-calc";updateUrl="https://tw-calc.net/script/TW-Calc.user.js";githubUrl="https://github.com/The-West-Scripts/TW-Calc-Script";discordUrl="https://discord.gg/vhNSGhvkwk";version="2.7.3";author="timzatko";contributors="TomRobert".split(", ");website="https://tw-calc.net";showUntranslated=!1;logPrefix="TW-Calc";birthday={enabled:!1,date:"2012/12/16"};donations=!1;cdn="//westzz.innogamescdn.com/";languages=["sk_SK","cs_CZ","es_ES","pt_BR","pl_PL","sv_SE","hu_HU","ro_RO","tr_TR","nn_NO","it_IT","de_DE","nl_NL","ru_RU","el_GR","fr_FR"];env=ENV};Config=__decorate([singleton()],Config);var SPECIES$4=wellKnownSymbol$1("species"),$Array$1=Array,arraySpeciesConstructor$1=function(e){var t;return isArray$3(e)&&(t=e.constructor,(isConstructor(t)&&(t===$Array$1||isArray$3(t.prototype))||isObject$1(t)&&null===(t=t[SPECIES$4]))&&(t=void 0)),void 0===t?$Array$1:t},arraySpeciesConstructor=arraySpeciesConstructor$1,arraySpeciesCreate$1=function(e,t){return new(arraySpeciesConstructor(e))(0===t?0:t)},arraySpeciesCreate=arraySpeciesCreate$1,push$3=uncurryThis([].push),createMethod$3=function(e){var t=1==e,r=2==e,n=3==e,o=4==e,i=6==e,a=7==e,s=5==e||i;return function(l,c,u,d){for(var g,p,h=toObject$1(l),f=IndexedObject(h),y=bind$7(c,u),$=lengthOfArrayLike$1(f),m=0,w=d||arraySpeciesCreate,b=t?w(l,$):r||a?w(l,0):void 0;$>m;m++)if((s||m in f)&&(p=y(g=f[m],m,h),e))if(t)b[m]=p;else if(p)switch(e){case 3:return!0;case 5:return g;case 6:return m;case 2:push$3(b,g)}else switch(e){case 4:return!1;case 7:push$3(b,g)}return i?-1:n||o?o:b}},arrayIteration={forEach:createMethod$3(0),map:createMethod$3(1),filter:createMethod$3(2),some:createMethod$3(3),every:createMethod$3(4),find:createMethod$3(5),findIndex:createMethod$3(6),filterReject:createMethod$3(7)},SPECIES$3=wellKnownSymbol$1("species"),arrayMethodHasSpeciesSupport$1=function(e){return CHROME_VERSION>=51||!fails$1((function(){var t=[];return(t.constructor={})[SPECIES$3]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},require$$0$p=arrayIteration,arrayMethodHasSpeciesSupport=arrayMethodHasSpeciesSupport$1,$map=require$$0$p.map,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport("map");$$1({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2},{map:function(e){return $map(this,e,arguments.length>1?arguments[1]:void 0)}});var map$3=entryVirtual("Array").map,method$c=map$3,ArrayPrototype$a=Array.prototype,map$2=function(e){var t=e.map;return e===ArrayPrototype$a||isPrototypeOf(ArrayPrototype$a,e)&&t===ArrayPrototype$a.map?method$c:t},parent$i=map$2,map$1=parent$i,require$$0$o=map$1,map=require$$0$o,nativeReverse=uncurryThis([].reverse),test$1=[1,2];$$1({target:"Array",proto:!0,forced:String(test$1)===String(test$1.reverse())},{reverse:function(){return isArray$3(this)&&(this.length=this.length),nativeReverse(this)}});var reverse$3=entryVirtual("Array").reverse,method$b=reverse$3,ArrayPrototype$9=Array.prototype,reverse$2=function(e){var t=e.reverse;return e===ArrayPrototype$9||isPrototypeOf(ArrayPrototype$9,e)&&t===ArrayPrototype$9.reverse?method$b:t},parent$h=reverse$2,reverse$1=parent$h,require$$0$n=reverse$1,reverse=require$$0$n,f$2=Object.getOwnPropertySymbols,objectGetOwnPropertySymbols={f:f$2},getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,$assign=Object.assign,defineProperty$1=Object.defineProperty,concat$1=uncurryThis([].concat),objectAssign=!$assign||fails$1((function(){if(DESCRIPTORS&&1!==$assign({b:1},$assign(defineProperty$1({},"a",{enumerable:!0,get:function(){defineProperty$1(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=$assign({},e)[r]||objectKeys($assign({},t)).join("")!=n}))?function(e,t){for(var r=toObject$1(e),n=arguments.length,o=1,i=getOwnPropertySymbolsModule.f,a=require$$0$B.f;n>o;)for(var s,l=IndexedObject(arguments[o++]),c=i?concat$1(objectKeys(l),i(l)):objectKeys(l),u=c.length,d=0;u>d;)s=c[d++],DESCRIPTORS&&!call$2(a,l,s)||(r[s]=l[s]);return r}:$assign,assign$3=objectAssign;$$1({target:"Object",stat:!0,arity:2,forced:Object.assign!==assign$3},{assign:assign$3});var assign$2=path.Object.assign,parent$g=assign$2,assign$1=parent$g,require$$0$m=assign$1,assign=require$$0$m,$propertyIsEnumerable=require$$0$B.f,propertyIsEnumerable=uncurryThis($propertyIsEnumerable),push$2=uncurryThis([].push),createMethod$2=function(e){return function(t){for(var r,n=toIndexedObject$1(t),o=objectKeys(n),i=o.length,a=0,s=[];i>a;)r=o[a++],DESCRIPTORS&&!propertyIsEnumerable(n,r)||push$2(s,e?[r,n[r]]:n[r]);return s}},objectToArray={entries:createMethod$2(!0),values:createMethod$2(!1)},require$$0$l=objectToArray,$values=require$$0$l.values;$$1({target:"Object",stat:!0},{values:function(e){return $values(e)}});var values$3=path.Object.values,parent$f=values$3,values$2=parent$f,require$$0$k=values$2,values$1=require$$0$k,addToUnscopables$1=function(){},addToUnscopables=addToUnscopables$1,defineProperty=definePropertyModule.f,ARRAY_ITERATOR="Array Iterator",setInternalState$1=InternalStateModule.set,getInternalState=InternalStateModule.getterFor(ARRAY_ITERATOR);defineIterator(Array,"Array",(function(e,t){setInternalState$1(this,{type:ARRAY_ITERATOR,target:toIndexedObject$1(e),index:0,kind:t})}),(function(){var e=getInternalState(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,createIterResultObject(void 0,!0)):createIterResultObject("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values");var values=Iterators.Arguments=Iterators.Array;if(addToUnscopables(),addToUnscopables(),addToUnscopables(),!IS_PURE&&DESCRIPTORS&&"values"!==values.name)try{defineProperty(values,"name",{value:"values"})}catch(e){}var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},DOMIterables$1=domIterables,TO_STRING_TAG$1=wellKnownSymbol$1("toStringTag");for(var COLLECTION_NAME in DOMIterables$1){var Collection=global$1[COLLECTION_NAME],CollectionPrototype=Collection&&Collection.prototype;CollectionPrototype&&classof(CollectionPrototype)!==TO_STRING_TAG$1&&createNonEnumerableProperty$1(CollectionPrototype,TO_STRING_TAG$1,COLLECTION_NAME),Iterators[COLLECTION_NAME]=Iterators.Array}var $forEach=require$$0$p.forEach,STRICT_METHOD$3=arrayMethodIsStrict("forEach"),arrayForEach=STRICT_METHOD$3?[].forEach:function(e){return $forEach(this,e,arguments.length>1?arguments[1]:void 0)},forEach$4=arrayForEach;$$1({target:"Array",proto:!0,forced:[].forEach!=forEach$4},{forEach:forEach$4});var forEach$3=entryVirtual("Array").forEach,parent$e=forEach$3,forEach$2=parent$e,method$a=forEach$2,ArrayPrototype$8=Array.prototype,DOMIterables={DOMTokenList:!0,NodeList:!0},forEach$1=function(e){var t=e.forEach;return e===ArrayPrototype$8||isPrototypeOf(ArrayPrototype$8,e)&&t===ArrayPrototype$8.forEach||hasOwn(DOMIterables,classof(e))?method$a:t},require$$0$j=forEach$1,forEach=require$$0$j,setTimeout$2=path.setTimeout,require$$0$i=setTimeout$2,setTimeout$1=require$$0$i;const defaultOptions={reloadable:!1,size:null,content:{marginLeft:12,marginBottom:12,marginTop:12,marginRight:12}};class TW2Window{id;errorTracker;window;language;logger;$;options;views={};win;constructor(e,t,r,n,o,i){this.id=e,this.errorTracker=t,this.window=r,this.language=n,this.logger=o,this.options=assign({},defaultOptions,i),this.$=r.$}get tw2win(){if(!this.win)throw new Error("Window manipulation before initialization!");return this.win}open(e){this.logger.log(`open window "${this.id}"...`,this.options,this.views);const t=[];this.options.reloadable||t.push("noreload");const r=getTitle(this.language,this.options.title)||"";if(this.win=this.window.wman.open(this.id,r,t.join(" ")).setMiniTitle(r),this.options.size){const{width:e,height:t}=this.options.size;this.win.setSize(e,t)}const n=values$1(this.views);forEach(n).call(n,(e=>{const t=getTitle(this.language,e.title)||"",{marginLeft:r,marginRight:n,marginTop:o,marginBottom:i}=this.options.content;this.tw2win.addTab(t,e.key.toString(),(()=>this.setTab(e.key,"tabSwitch"))).appendToContentPane(this.window.$(`<div id="tab_${e.key}" style="display: none; overflow: hidden; margin: ${o}px ${r}px ${i}px ${n}px"></div>`))})),this.win.addEventListener("WINDOW_DESTROY",(()=>{forEach(n).call(n,(e=>{this.errorTracker.execute((()=>{e.destroy&&(null==e||e.destroy())}))}))})),e&&e.tab?this.setTab(e.tab,"windowOpen",e.tabInitOptions):n.length&&this.setTab(n[0].key,"windowOpen"),e&&e.position&&this.move(e.position)}move(e){$(".tw2gui_window.tw2gui_win2."+this.id).css("left",e.x).css("top",e.y)}setOptions(e){assign(this.options,e)}getMainDiv(){return this.$(`.${this.id}`)}setTab(e,t,r){const n=this.views[e];if(this.logger.log(`set tab = ${e}`,e,n,r),void 0===n)throw new Error(`Tab "${e}" does not exist!`);if(n.loader){this.getWindow().showLoader();const o="tabSwitch"===t?50:500;this.tw2win.activateTab(e.toString()),setTimeout$1((()=>{this.showTab(e,n,(()=>{this.getWindow().hideLoader()}),r)}),o)}else this.showTab(e,n,(()=>{}),r)}addView(e){this.views[e.key]=e}getWindow(){if(!this.win)throw new Error("Window object does not exist!");return this.win}getTabMainDiv(e){return this.$(`.tw2gui_window_content_pane > #tab_${e}`,this.getMainDiv())}showTab(e,t,r,n){this.tw2win.activateTab(e.toString());const o=this.errorTracker.execute((()=>t.getMainDiv()));this.getTabMainDiv(t.key).empty().append(o||""),$("div.tw2gui_window_content_pane > *",this.getMainDiv()).each((function(){$(this).hide()})),this.errorTracker.execute((()=>{"function"==typeof t.init&&t.init({loadCallback:r,options:n})})),$(`div.tw2gui_window_content_pane > #tab_${e}`,this.getMainDiv()).fadeIn()}}function getTitle(e,t){return"object"!=typeof t?t:e?e.getTranslation(t.translation):"undefined"}__decorate([CatchErrors("TW2Window.open"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],TW2Window.prototype,"open",null),__decorate([CatchErrors("TW2Window.moveTo"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],TW2Window.prototype,"move",null),__decorate([CatchErrors("TW2Window.setOptions"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],TW2Window.prototype,"setOptions",null),__decorate([CatchErrors("TW2Window.getMainDiv"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],TW2Window.prototype,"getMainDiv",null),__decorate([CatchErrors("TW2Window.setTab"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,String,Object]),__metadata("design:returntype",void 0)],TW2Window.prototype,"setTab",null);class ErrorLogWindow extends TW2Window{constructor(e,t,r){super("TWCalcErrorLog",t,e,null,r,{title:"TW-Calc ErrorLog"})}show(e){var t;super.open();const r=this.window.$("<div></div>"),n=new this.window.west.gui.Textarea;n.setHeight(355),n.setWidth(675),n.setReadonly(),n.setContent(map(t=reverse(e).call(e)).call(t,(e=>{const t=[e.name];return e.message.length&&t.push(e.message),e.stack&&e.stack.length&&t.push(e.stack),t.join("| ")})).join("\n")),r.append(n.getMainDiv()),this.tw2win.appendToContentPane(r)}}class ErrorWindow extends TW2Window{config;constructor(e,t,r,n){super("TWCalcError",t,e,null,r,{title:"TW-Calc Error",size:{width:400,height:360}}),this.config=n}show(e,t){super.open();const{$:r}=this.window,n=this.window.$("<div></div>");if(n.append(r('<p>The error below occurred during TW-Calc execution. <b>You can let us now on our <a href="'+this.config.discordUrl+'" target="_blank">Discord</a> server.</b></p><br /><hr><br />')),t&&n.append(r(`<h2>${t}</h2>`)),n.append(r(`<p><b>${e.name}</b>: ${e.message}</p>`)),e.stack&&e.stack.length){const t=new this.window.west.gui.Textarea;t.setHeight(150),t.setWidth(325),t.setReadonly(),t.setContent(`<p>${e.stack}</p>`),n.append(t.getMainDiv())}this.tw2win.appendToContentPane(n)}}class InvisibleError extends Error{fromError;constructor(e){super(e.message),this.fromError=e}get stack(){return this.fromError.stack}static of(e){return new InvisibleError(e)}}const storagePrefix="TWCalc";let Storage=class{localStorage;constructor(e){this.localStorage=e}getString(e,t){return this.getValue(e,t,toString$1)}getNumber(e,t){return this.getValue(e,t,Number)}getObject(e,t){return this.getValue(e,t,JSON.parse)}setString(e,t){this.addItem(e,t)}setObject(e,t){this.addItem(e,stringify(t))}setNumber(e,t){this.addItem(e,t.toString())}has(e){return null!==this.getItem(e)}remove(e){this.localStorage.removeItem(getKey(e))}getItem(e){return this.localStorage.getItem(getKey(e))}addItem(e,t){this.localStorage.setItem(getKey(e),t)}getValue(e,t,r){const n=this.getItem(e);if(null!==n)return r(n);if(void 0!==t)return t;throw new Error(`Storage value for key "${e}" does not exist!`)}};function getKey(e){return`${storagePrefix}_${e}`}function toString$1(e){return e.toString()}var StorageKey;Storage=__decorate([injectable(),__param(0,inject$1("localStorage")),__metadata("design:paramtypes",[Object])],Storage),function(e){e.debug="DEBUG",e.languagePack="LANGUAGE_PACK",e.languagePackLastUpdate="LANGUAGE_PACK_LAST_UPDATE",e.languagePackReset="LANGUAGE_PACK_RESET",e.settings="Settings",e.birthday="Birthday",e.jobList="jobList",e.tombola="Tombola",e.battleCalc="BattleCalc",e.alarmClock="AlarmClock",e.notepad="notepad",e.wardrobe="Wardrobe",e.ownCalc="OwnCalc"}(StorageKey||(StorageKey={}));let Logger=class{window;config;storage;constructor(e,t,r){this.window=e,this.config=t,this.storage=r}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.print("error",t)}log(){if(this.canShowLogs()){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.print("log",t)}}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.print("warn",t)}debug(){if(this.canShowLogs()){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.print("debug",t)}}canShowLogs(){return"prod"!==this.config.env||this.isDebugEnabled()}isDebugEnabled(){return!!this.storage.has(StorageKey.debug)||!!this.window.location.href.match(/tw-calc--debug=true/)}print(e,t){"string"==typeof t[0]?t[0]=`${this.getMessagePrefix()} ${t[0]}`:t.unshift(this.getMessagePrefix()),this.window.console[e](...t)}getMessagePrefix(){const e=(new Date).toUTCString();return`${this.config.logPrefix} [${e}]`}};var ErrorTracker_1;Logger=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,Storage])],Logger);let ErrorTracker=ErrorTracker_1=class{window;onGoingEntryFunction;logger;config;log=[];errorWindow;errorLogWindow;constructor(e,t,r,n){this.window=e,this.onGoingEntryFunction=t,this.logger=r,this.config=n,this.errorWindow=new ErrorWindow(e,this,r,this.config),this.errorLogWindow=new ErrorLogWindow(e,this,r)}static isErrorNoficationVisible(e){return!(e instanceof InvisibleError)}track(e,t){this.logger.debug("tracking error...",e),this.log.push(e),this.logger.error(e),ErrorTracker_1.isErrorNoficationVisible(e)&&this.window.WestUi.NotiBar.add(this.onGoingEntryFunction(this.window,(()=>{this.errorWindow.show(e,t)}))),this.window.$.get(this.config.website+"/service/send-error",{errorCode:t?`${t} | ${toString(e)}`:toString(e),name:this.window.Character.name,id:this.window.Character.playerId,server:this.window.Game.gameURL,locale:this.window.Game.locale,WestCalcVersion:this.config.version,GameVersion:this.window.Game.version},(function(){}),"jsonp")}catchErrors(e){const t=this;return function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t.execute((()=>e.apply(this,n)))}}execute(e){try{return e()}catch(e){const t=asErrorObject(e);return void this.track(t)}}open(){this.errorLogWindow.show(this.log)}};function toString(e){return`${e.toString()}\n${e.stack}`.substr(0,1024)}function onGoingEntry(e,t){const r=new e.OnGoingEntry;return r.init("",t),r.setTooltip("TW-Calc Error"),r.setImageClass("hint"),r}ErrorTracker=ErrorTracker_1=__decorate([singleton(),registry([{token:"onGoingEntry",useValue:onGoingEntry}]),__param(0,inject$1("window")),__param(1,inject$1("onGoingEntry")),__metadata("design:paramtypes",[Object,Object,Logger,Config])],ErrorTracker);var en_us={lang_0:"No",lang_1:"Yes",lang_2:"with premium",lang_3:"Settings",lang_4:"Skills",lang_5:"Leadership",lang_6:"Hiding",lang_7:"Stamina",lang_8:"Dodging",lang_9:"Aiming",lang_14:"Attack",lang_15:"Defence",lang_18:"Position on map",lang_20:"The tower of your character",lang_21:"Ground",lang_22:"Tower - level",lang_27:"Calculate",lang_28:"Health",lang_29:"Health points",lang_30:"Level",lang_31:"Fort-battle attack",lang_32:"Character",lang_33:"Fort-battle defence",lang_34:"Other",lang_35:"Delete",lang_36:"Save",lang_37:"Set time",lang_38:"Greenhorn",lang_39:"Dueller",lang_40:"Adventurer",lang_41:"Soldier",lang_42:"Worker",lang_43:"Player name",lang_44:"Game world",lang_45:"Player level",lang_46:"Character class",lang_49:"Health",lang_50:"Attack",lang_51:"Defense",lang_52:"Game world",lang_61:"Health",lang_62:"Alarm clock settings",lang_63:"Calculate the highest and lowest duelling level you are able to duel",lang_64:"Calculate the amount of experiences gained from a duel",lang_66:"Your duelling level",lang_67:"Calculate",lang_68:"Highest possible duelling level",lang_69:"Lowest possible duelling level",lang_70:"Duelling level of your opponent",lang_71:"Duel motivation",lang_72:"How to write a date? Example:",lang_77:"for The-West Calc is a new version available, please click ok to update the Userscript",lang_78:"TW-Calc Update needed",lang_79:"Current version",lang_80:"Later",lang_81:"Your note",lang_82:"Time",lang_83:"TW-Calc Alarm clock",lang_86:"Victory: You gain",lang_87:"experience and",lang_88:"Successfully saved",lang_89:"Your notes has been successfully deleted",lang_90:"Alarm Clock not set (BAD SYNTAX)",lang_91:"Alarm clock set",lang_92:"Cancel",lang_93:"TW-Calc Alarm clock - settings",lang_94:"Alarm clock",lang_95:"Enter URL address of your sound. For example: https://tw-calc.net/script/budik.mp3",lang_96:"Alarm clock set",lang_97:"Melody of alarm clock: Alarm1, Alarm2",lang_98:"Health points",lang_100:"Full energy in",lang_101:"hours and",lang_102:"minutes",lang_103:"Experience points",lang_104:"Full health in",lang_105:"Transfer fee",lang_106:"Transfer fee",lang_107:"Transfer amount",lang_108:"Add bank fees calculator (during transfer) to the bank window",lang_109:"Add energy&health refill calculators",lang_110:"duel experience.",lang_111:"New version",lang_112:"Whats new",lang_113:"Edit",lang_114:"Duelling level",lang_115:"Duleable",lang_116:"Distance",lang_117:"Center map",lang_118:"Town",lang_122:"Note",lang_123:"Really?",lang_124:"Actually empty",lang_140:"Resistance",lang_141:"Damage",lang_143:"Loading",lang_146:"All your saved jobs will be removed. Are you sure you want to do it?",lang_147:"Close (Saved automatically)",lang_148:"Reset jobs",lang_149:"Reset",lang_150:"Add or remove Jobs",lang_151:"Search for job",lang_152:"Job list",lang_153:"Replace native craft window in the menu by Westcalc craft window",lang_154:"Open duel window",lang_157:"Name",lang_159:"Importing...",lang_160:"Own skills",lang_161:"New equipment",lang_162:"Close",lang_163:"Add",lang_164:"Current clothing will be added as new equipment.",lang_165:"Successfull",lang_166:"Name...",lang_167:"Job",lang_169:"Show configuration of this set",lang_170:"Wardrobe",lang_171:"Remove this set",lang_172:"Create",lang_173:"Tombola analyser",lang_174:"Travelling fair",lang_175:"Add wardrobe to the game",lang_176:"Hide unavailable materials",lang_177:"Craft",lang_178:"Toggle all recipes",lang_179:"Field cook",lang_180:"Tonic peddler",lang_181:"Blacksmith",lang_182:"Master Saddler",lang_183:"Crafting",lang_184:"Add Westcalc icon to the right menu",lang_185:"Position of Job bar",lang_186:"Top",lang_187:"Bottom",lang_188:"In right panel",lang_189:"Hide",lang_190:"without premium",lang_191:"Position of duel panel",lang_192:"Show the crafting product",lang_193:"Setting Traps",lang_194:"Valentine's Day",lang_195:"Easter",lang_196:"Independence Day",lang_197:"Octoberfest",lang_198:"Day of the Dead",lang_199:"Defeat: You lose",lang_200:"Energy",lang_201:"Weapon damage",lang_202:"Cloth bonus",lang_203:"Wall - level",lang_204:"Accept the quest to see the quest giver",lang_205:"Show quest giver on map",lang_206:"Show the quest on TW-Calc.net",lang_207:"Wear all",lang_208:"Create or select set from the menu",lang_209:"Learn",lang_210:"Notepad",lang_211:"Import",lang_212:"My Character",lang_213:"Tombola",lang_214:"Battle Calc",lang_215:"Duel Calc",lang_216:"Settings",lang_217:"BB Code",lang_218:"Refresh the page to apply changes.",lang_219:"No shop with this item found",lang_220:"Search...",lang_221:"No tombola spins were tacked so far",lang_222:"There are no unlocked jobs for this product!",lang_223:"Flag",lang_224:"Flag ring",lang_225:"Import / Export local TW-Calc settings"};const fetchTimeout=4e3;let Language=class{window;config;storage;logger;errorTracker;languagePack;cb;constructor(e,t,r,n,o){this.window=e,this.config=t,this.storage=r,this.logger=n,this.errorTracker=o}init(e){if(this.logger.log("initializing language service..."),this.cb=e,!this.storage.has(StorageKey.languagePackLastUpdate)||!this.storage.has(StorageKey.languagePack))return void this.fetch();const t=new Date(this.storage.getString(StorageKey.languagePackLastUpdate)),r=new Date;if(Math.ceil(Math.abs(r.getTime()-t.getTime())/864e5)>5)return this.logger.log("language pack is too old"),void this.fetch();this.logger.log("using language pack from storage");try{this.use(this.storage.getObject(StorageKey.languagePack))}catch(e){this.logger.error("error while loading a language pack, using en_us...",e),this.use(en_us)}}getTranslation(e){const t=this.languagePack;return t&&t[`lang_${e}`]?t[`lang_${e}`]:this.config.showUntranslated?"untranslated":en_us[`lang_${e}`]||"undefined"}getTranslator(){const e=this.languagePack;return e&&e.translator?e.translator:this.config.author}loadPack(e){if(this.languagePack)return this.logger.warn("not overwriting language pack since it is already loaded");this.logger.log("loading and storing language pack...",e),this.storage.setObject(StorageKey.languagePack,e);const t=new Date,r=`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`;this.storage.setString(StorageKey.languagePackLastUpdate,r),this.use(e)}use(e){if(this.languagePack)return;this.languagePack=e;const t=this.cb;if(!t)throw new Error("callback is not defined, was init method called?");setTimeout$1((()=>t()))}fetch(){this.logger.log("fetching language pack from the server...");const e=this.getAvailableLocale();this.window.$.ajax({url:this.config.website+"/service/get-script-language-pack?lang="+e+"&"+(new Date).toDateString()+"&"+this.config.version,dataType:"jsonp",timeout:fetchTimeout}),setTimeout$1((()=>this.use(en_us)),fetchTimeout)}getAvailableLocale(){var e;return-1!==indexOf$2(e=this.config.languages).call(e,this.window.Game.locale)?this.window.Game.locale:"en_US"}};Language=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,Storage,Logger,ErrorTracker])],Language);let AlarmClock=class{window;storage;language;config;logger;errorTracker;constructor(e,t,r,n,o,i){this.window=e,this.storage=t,this.language=r,this.config=n,this.logger=o,this.errorTracker=i}init(){this.window.setInterval((()=>{if(!this.storage.has(StorageKey.alarmClock))return;const e=this.storage.getObject(StorageKey.alarmClock),t=this.getDate(e.date,e.time),r=t+6e4,n=now();n>=t&&n<=r&&(this.logger.log(`show alarm clock (now: ${n}; start: ${t}; end: ${r})'`),this.showAlarmClockDialog(e))}),1e3)}getDate(e,t){return Date.parse(e+" "+t)}showAlarmClockDialog(e){this.storage.remove(StorageKey.alarmClock);new this.window.west.gui.Dialog(this.language.getTranslation(83),'<div><embed src="'+this.config.website+'/public/alarm/1.mp3" autostart="true" width="0" height="0"><span><b>'+this.language.getTranslation(82)+"</b></span>: <span><b>"+e.date+" "+e.time+"</b></span><br /><span><b>"+this.language.getTranslation(81)+":</b></span><br /><div>"+e.caption.replace(/\n/g,"<br />")+"</div></div>",this.window.west.gui.Dialog.SYS_WARNING).addButton("Ok").show()}};__decorate([CatchErrors("AlarmClock.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],AlarmClock.prototype,"init",null),AlarmClock=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Storage,Language,Config,Logger,ErrorTracker])],AlarmClock);let BattleCalc=class{window;config;errorTracker;constructor(e,t,r){this.window=e,this.config=t,this.errorTracker=r}init(){this.window.$.getScript(this.config.website+"/js/battle-calculator-core.js")}isAvailable(){return isAvailable(this.window)}getInstance(){const e=this.window;if(!isAvailable(e))throw new Error("Battle calc core is not loaded yet!");return e.BattleCalc}};function isAvailable(e){return e.hasOwnProperty("BattleCalc")&&void 0!==e.BattleCalc}__decorate([CatchErrors("BattleCalc.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],BattleCalc.prototype,"init",null),BattleCalc=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,ErrorTracker])],BattleCalc);let Birthday=class{window;config;storage;logger;errorTracker;date;constructor(e,t,r,n,o){this.window=e,this.config=t,this.storage=r,this.logger=n,this.errorTracker=o,this.date=new Date(t.birthday.date)}init(){this.config.birthday.enabled&&(this.isSeen()||this.isBirthdayToday()&&(this.logger.log("it's TW-Calc birthday today!"),this.showBirthdayDialog()))}isSeen(){return this.storage.has(StorageKey.birthday)&&this.storage.getNumber(StorageKey.birthday)===(new Date).getFullYear()}isBirthdayToday(){const e=new Date;return e.getMonth()===this.date.getMonth()&&e.getDate()===this.date.getDate()}showBirthdayDialog(){const e=(new Date).getFullYear(),t=e-this.date.getFullYear();(new this.window.west.gui.Dialog).setTitle(`It's TW-Calc ${t}th birthday!`).setText(`<div style="display: flex; flex-direction: column; padding: 8px; align-items: center">\n                    <div style="padding: 8px">\n                        <img alt="" src="${this.config.cdn}/images/items/yield/5_year_cake.png?1">\n                    </div>\n                    <div style="padding: 8px; font-size: 16px; text-align: center">\n                        <div>\n                            Thank you for using this script and visiting our website!</br>\n                            If you like our webpage, please donate for server costs and further development, we'll be very grateful to you. We are funding everything from our own resources. All your donations will be appreciated and used in best way possible to ensure future development of our page and script.\n                        </div>\n                        <div style="margin: 24px; font-size: 28px; font-weight: bold; font-family: Georgia, 'Times New Roman';">Thank you!</div>\n                        <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="LRG4X3PGMYHZY"><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"></form>\n                    </div>\n                </div>`).addButton("Visit Website",(()=>{this.storage.setNumber(StorageKey.birthday,e),this.window.open(this.config.website)})).addButton("Close",(()=>{this.storage.setNumber(StorageKey.birthday,e)})).show()}};__decorate([CatchErrors("Birthday.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Birthday.prototype,"init",null),Birthday=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,Storage,Logger,ErrorTracker])],Birthday);let Chests=class Chests{window;logger;config;errorTracker;constructor(e,t,r,n){this.window=e,this.logger=t,this.config=r,this.errorTracker=n}init(){const toolkit=this.window.ItemUse.doItOrigin?"doItOrigin":"doIt",originalFn=this.window.ItemUse[toolkit];if(void 0===originalFn)return;let newStr;try{const str=originalFn.toString(),pos=indexOf$2(str).call(str,"EventHandler.signal('item_used'"),body=str.substr(0,pos)+"TW_Calc.trackChest(itemId,res);"+str.substr(pos);this.logger.log("patching the chest handler...",body),newStr="ItemUse.doIt = "+body,eval(newStr)}catch(e){const t=e;throw this.logger.error("error while patching the chest handler",newStr),this.window.ItemUse[toolkit]=originalFn,t.message=`${t.message}\n\n${newStr}`,InvisibleError.of(t)}}trackChest(e,t){var r;this.logger.log("tracking chest...",e,t);const{Game:n,$:o}=this.window;if(!t.msg||!t.msg.effects)return this.logger.log("not tracking chest because there are no effect in response object");forEach(r=t.msg.effects).call(r,(t=>{if("lottery"==t.type||"content"==t.type){var r;const i=this.config.website+"/service/chest-export",a={chest:e,count:1,content:{},version:n.version};forEach(r=t.items||[]).call(r,(e=>{a.content[e.item_id]=e.count})),this.logger.log("sending a request to "+i+" with data",a),o.get(i,a,(()=>{this.logger.log("chest successfully tracked")}),"jsonp")}}))}};__decorate([CatchErrors("Chests.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],Chests.prototype,"init",null),__decorate([CatchErrors("Chests.trackChest"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Object]),__metadata("design:returntype",void 0)],Chests.prototype,"trackChest",null),Chests=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,Config,ErrorTracker])],Chests);var $filter=require$$0$p.filter,HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport("filter");$$1({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{filter:function(e){return $filter(this,e,arguments.length>1?arguments[1]:void 0)}});var filter$3=entryVirtual("Array").filter,method$9=filter$3,ArrayPrototype$7=Array.prototype,filter$2=function(e){var t=e.filter;return e===ArrayPrototype$7||isPrototypeOf(ArrayPrototype$7,e)&&t===ArrayPrototype$7.filter?method$9:t},parent$d=filter$2,filter$1=parent$d,require$$0$h=filter$1,filter=require$$0$h;const craftTranslations={1:179,2:180,3:181,4:182};let CraftService=class{window;logger;errorTracker;lastRecipeCraftTimestamp={};learnedRecipes={};onBagChangeCallbacks=[];maxProfessionSkillValue=0;constructor(e,t,r){this.window=e,this.logger=t,this.errorTracker=r}get maxProfessionSkill(){return this.maxProfessionSkillValue}update(e){const{$:t,Character:r}=this.window;t.get("game.php",{window:"crafting"},(t=>{if(t.error)return this.logger.error(t.error);const n=t.recipes_content;if(void 0!==n)for(let e=0;e<n.length;e++){const t=n[e];this.lastRecipeCraftTimestamp[t.item_id]=t.last_craft,this.learnedRecipes[t.item_id]=!0}r.setProfessionSkill(t.profession_skill),this.maxProfessionSkillValue=t.profession_maxskill,e&&e()}))}isRecipeLearned(e){return this.learnedRecipes.hasOwnProperty(e)&&this.learnedRecipes[e]}setLearnedRecipe(e){this.learnedRecipes[e]=!0,this.lastRecipeCraftTimestamp[e]=null}getLastCraft(e){const t=this.lastRecipeCraftTimestamp;return t&&t.hasOwnProperty(e)?t[e]:null}init(){const{ItemManager:e}=this.window;patchBagUpdateChanges(this.window,(e=>{var t;forEach(t=this.onBagChangeCallbacks).call(t,(t=>t(e)))})),this.update(),this.onBagChange((t=>{forEach(t).call(t,(t=>{"recipe"===e.get(t.item_id).type&&t.count>0&&(this.learnedRecipes[t.item_id]=!0)}))}))}isProfession(e){const{Character:t}=this.window;return t.professionId===e}onBagChange(e){return this.onBagChangeCallbacks.push(e),()=>{var t;this.onBagChangeCallbacks=filter(t=this.onBagChangeCallbacks).call(t,(t=>t!==e))}}};function patchBagUpdateChanges(e,t){const r=e.Bag.updateChanges;e.Bag.updateChanges=function(e,n){r.apply(this,[e,n]),t(e)}}__decorate([CatchErrors("CraftService.update"),__metadata("design:type",Function),__metadata("design:paramtypes",[Function]),__metadata("design:returntype",void 0)],CraftService.prototype,"update",null),CraftService=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,ErrorTracker])],CraftService);var $TypeError$8=TypeError,deletePropertyOrThrow$1=function(e,t){if(!delete e[t])throw $TypeError$8("Cannot delete property "+tryToString$1(t)+" of "+tryToString$1(e))},$Array=Array,max$1=Math.max,arraySliceSimple=function(e,t,r){for(var n=lengthOfArrayLike$1(e),o=toAbsoluteIndex$1(t,n),i=toAbsoluteIndex$1(void 0===r?n:r,n),a=$Array(max$1(i-o,0)),s=0;o<i;o++,s++)createProperty(a,s,e[o]);return a.length=s,a},arraySlice=arraySliceSimple,floor$1=Math.floor,mergeSort=function(e,t){var r=e.length,n=floor$1(r/2);return r<8?insertionSort(e,t):merge(e,mergeSort(arraySlice(e,0,n),t),mergeSort(arraySlice(e,n),t),t)},insertionSort=function(e,t){for(var r,n,o=e.length,i=1;i<o;){for(n=i,r=e[i];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==i++&&(e[n]=r)}return e},merge=function(e,t,r,n){for(var o=t.length,i=r.length,a=0,s=0;a<o||s<i;)e[a+s]=a<o&&s<i?n(t[a],r[s])<=0?t[a++]:r[s++]:a<o?t[a++]:r[s++];return e},arraySort=mergeSort,firefox=userAgent.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],engineIsIeOrEdge=/MSIE|Trident/.test(userAgent),webkit=userAgent.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],deletePropertyOrThrow=deletePropertyOrThrow$1,internalSort=arraySort,FF=engineFfVersion,IE_OR_EDGE=engineIsIeOrEdge,WEBKIT=engineWebkitVersion,test=[],nativeSort=uncurryThis(test.sort),push$1=uncurryThis(test.push),FAILS_ON_UNDEFINED=fails$1((function(){test.sort(void 0)})),FAILS_ON_NULL=fails$1((function(){test.sort(null)})),STRICT_METHOD$2=arrayMethodIsStrict("sort"),STABLE_SORT=!fails$1((function(){if(CHROME_VERSION)return CHROME_VERSION<70;if(!(FF&&FF>3)){if(IE_OR_EDGE)return!0;if(WEBKIT)return WEBKIT<603;var e,t,r,n,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)test.push({k:t+n,v:r})}for(test.sort((function(e,t){return t.v-e.v})),n=0;n<test.length;n++)t=test[n].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}})),FORCED=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD$2||!STABLE_SORT,getSortCompare=function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:toString$3(t)>toString$3(r)?1:-1}};$$1({target:"Array",proto:!0,forced:FORCED},{sort:function(e){void 0!==e&&aCallable$1(e);var t=toObject$1(this);if(STABLE_SORT)return void 0===e?nativeSort(t):nativeSort(t,e);var r,n,o=[],i=lengthOfArrayLike$1(t);for(n=0;n<i;n++)n in t&&push$1(o,t[n]);for(internalSort(o,getSortCompare(e)),r=lengthOfArrayLike$1(o),n=0;n<r;)t[n]=o[n++];for(;n<i;)deletePropertyOrThrow(t,n++);return t}});var sort$3=entryVirtual("Array").sort,method$8=sort$3,ArrayPrototype$6=Array.prototype,sort$2=function(e){var t=e.sort;return e===ArrayPrototype$6||isPrototypeOf(ArrayPrototype$6,e)&&t===ArrayPrototype$6.sort?method$8:t},parent$c=sort$2,sort$1=parent$c,require$$0$g=sort$1,sort=require$$0$g,$find=require$$0$p.find,FIND="find",SKIPS_HOLES$1=!0;FIND in[]&&Array(1)[FIND]((function(){SKIPS_HOLES$1=!1})),$$1({target:"Array",proto:!0,forced:SKIPS_HOLES$1},{find:function(e){return $find(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables();var find$3=entryVirtual("Array").find,method$7=find$3,ArrayPrototype$5=Array.prototype,find$2=function(e){var t=e.find;return e===ArrayPrototype$5||isPrototypeOf(ArrayPrototype$5,e)&&t===ArrayPrototype$5.find?method$7:t},parent$b=find$2,find$1=parent$b,require$$0$f=find$1,find=require$$0$f;function zip(e,t,r){if(e.length!==t.length)throw new Error("Cannot zip two arrays of different length!");for(let n=0;n<e.length;n++)r(e[n],t[n])}class Recipe{recipeId;craftService;window;language;logger;onStartCraft;item;container;title;content;craftAmount;craft;collapse;difficulty;recipeName;resources;craftingItem;unsubscribe;constructor(e,t,r,n,o,i){this.recipeId=e,this.craftService=t,this.window=r,this.language=n,this.logger=o,this.onStartCraft=i;const{$:a,ItemManager:s,Crafting:l,tw2widget:c}=this.window;this.item=s.get(e),this.window.Crafting.recipes[e]=this.item,this.resources=this.getResources(),this.craftingItem=new c.CraftingItem(s.get(this.item.craftitem)),this.container=a('<div data-recipe-craft-item-id="'+this.item.craftitem+'"></div>'),this.title=a('<div class="recipe_title" data-name="'+this.item.name+'" data-recipe-id="" style="display: inline-block; text-align: left;"></div>'),this.collapse=a('<div class="recipe_collapse">+</div>'),this.collapse.on("click",(()=>this.setCollapsedToggle())),this.difficulty=a('<div class="recipe_difficult hasMousePopup"></div>'),this.recipeName=a('<div class="recipe_name" style="width: 235px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">'+this.name.split(":").pop()+"</div>"),this.recipeName.on("click",(()=>this.setCollapsedToggle()));const u=a('<div class="recipe_title_inner"></div>');u.append(this.collapse),u.append(this.difficulty),u.append(this.recipeName),u.append(a('<div class="recipe_colors" style="margin-top: 3px; color: white; font-size: 12px; font-family: monospace; ">|&nbsp;<span style="color: rgb(196, 163, 103">'+this.item.min_level+'</span>/<span style="color: rgb(88, 185, 88)">'+this.getMidLevel()+'</span>/<span style="color: rgb(85, 205, 221)">'+this.item.max_level+"</span>").attr("title",l.description)),this.craftAmount=a('<div class="recipe_craft_amount"></div>'),this.craft=a('<div data-id="'+e+'" class="recipe_craft" style="color: white"></div>'),this.title.append(u).append(this.craftAmount).append(this.craft),this.content=a('<div class="recipe_content" style="margin-left: auto; margin-right: auto; display: none"></div>'),this.container.append(this.title).append(this.content),this.unsubscribe=this.craftService.onBagChange((()=>this.initMainDiv()))}get name(){return this.item.name}static of(e,t,r,n,o,i){return new Recipe(e,t,r,n,o,i)}destroy(){this.unsubscribe()}isCraftable(){return this.isLearned()&&this.getMaxCraftable()>0&&this.isNotUnderCooldown()}isNotUnderCooldown(){return null===this.craftService.getLastCraft(this.recipeId)}getMaxCraftable(){const{maxCount:e}=this.window.Crafting.checkRequirementsForRecipe(this.recipeId);return this.isWithCooldown()?Math.min(1,e):e}isDependent(){const{dependent:e}=this.window.Crafting.checkRequirementsForRecipe(this.recipeId);return e>0}isWithCooldown(){return!!this.item.blocktime}getDifficulty(){return this.isLearned()?this.window.Crafting.getRecipeColor(this.item):null}getName(){return this.item.name}isLearned(){return this.isMyProfession()&&this.craftService.isRecipeLearned(this.recipeId)}isLearnable(){if(!this.isMyProfession()||this.isLearned())return!1;const{Bag:e}=this.window;if(!e.items_by_id.hasOwnProperty(this.recipeId))return!1;const{ItemManager:t,Character:r}=this.window;return t.get(this.recipeId).min_level<=(r.professionSkill||0)}setCollapsed(e){e?(this.content.slideDown(250),this.collapse.text("-")):(this.content.slideUp(250),this.collapse.text("+"))}setCollapsedToggle(){this.setCollapsed("+"===this.collapse.text())}setVisible(e){e?this.container.show():this.container.hide()}getOffsetTop(){return this.title[0].offsetTop}getMainDiv(){var e;const{$:t,ItemPopup:r}=this.window,n=t('<div class="recipe_craftitem"></div>'),o=t('<div class="recipe_resources" style="overflow-x: auto; overflow-y: hidden; display: flex;"></div>');forEach(e=this.resources.widgets).call(e,(e=>{addMinimapLink(e,this.window),o.append(e.getMainDiv())})),n.append(this.craftingItem.getMainDiv()),this.isMyProfession()||this.craft.empty();const i=new r(this.item);return this.recipeName.attr("title",i.getXHTML()),this.content.append(o).append(n),this.initMainDiv(),this.container}initMainDiv(){this.logger.log("reloading main div of recipe...",this);const{ItemUse:e,Bag:t,Crafting:r,$:n}=this.window,o=this.getMaxCraftable(),i=this.isCraftable();this.difficulty.removeClass("middle hard easy");const a=this.getDifficulty();a&&this.difficulty.addClass(a).attr("title",r.description);const s=this.getPlusMinusField(i,o);if(this.craftAmount.empty().append(s.getMainDiv()),this.craft.empty(),i){const e=this.isDependent(),t=n('<a class="'+(e?"crafting_dependent":"crafting_independent")+'">'+this.language.getTranslation(177)+"</a>");t.on("click",(()=>this.onStartCraft(this,s.getValue()))),underline(t),e&&!this.window.Premium.hasBonus("automation")&&this.craft.append('<img src="/images/premium/automation.png" alt="premium_automation">'),this.craft.append(t)}else{const t=this.craftService.getLastCraft(this.recipeId);if(null!==t)this.craft.append('<span style="crafting_independent">'+t.formatDurationBuffWay()+"</span>");else if(this.isLearnable()){const t=n("<span>"+this.language.getTranslation(209)+"</span>");t.on("click",(()=>{e.use(this.recipeId,(()=>this.setIsLearned()),"recipe")})),underline(t),this.craft.append(t)}}const{widgets:l,items:c}=this.resources;zip(l,c,((e,r)=>e.setRequired(t.getItemCount(r.item.item_id),r.count))),this.craftingItem.setCount(t.getItemCount(this.craftingItem.obj.item_id)),this.recipeName.css("color",this.isLearned()?"white":"gray")}getMidLevel(){return this.item.skillcolor?this.item.max_level:this.item.min_level+Math.round((this.item.max_level-this.item.min_level)/2)}getMinLevel(){return this.item.min_level}getMaxLevel(){return this.item.max_level}getResources(){var e;const{ItemManager:t,tw2widget:r}=this.window,n=map(e=this.item.resources||[]).call(e,(e=>{let{item:r,count:n}=e;return"number"==typeof r?{item:t.get(r),count:n}:{item:r,count:n}}));return{items:n,widgets:map(n).call(n,(e=>new r.CraftingItem(e.item).setRequired(0,e.count)))}}setIsLearned(){this.logger.log("a recipe was learned",this),this.craftService.setLearnedRecipe(this.recipeId),this.initMainDiv()}isMyProfession(){return this.craftService.isProfession(this.item.profession_id)}getPlusMinusField(e,t){const{west:r}=this.window,n=e?1:t,o=e?1:t,i=new r.gui.Plusminusfield("TWCalc_Craft_"+this.recipeId,n,o,t,0,(e=>callbackPlusminusButton(this.window,e)),(e=>callbackPlusminusButton(this.window,e)),((e,t,r)=>callbackWheel(this.window,t,r)));return i.setEnabled(e),i.divMain.on("mouseover",(()=>i.divMain.attr("title",`Max: ${i.getMax()}`))),i}}function callbackPlusminusButton(e,t){const r=e.$(t.currentTarget).hasClass("butPlus")?1:-1;return callbackWheel(e,r,t.data.obj)}function callbackWheel(e,t,r){if(!r.enabled)return!1;const n=r.getValue()+t;return!(n>r.getMax()||n<r.getMin())&&(r.setValue(n),e.$("span.displayValue",r.getMainDiv()).text(r.getValue()),!0)}function addMinimapLink(e,t){const{$:r,Quest:n}=t,o=r('<div style="width: 16px; right: 7px; bottom: 10px; position: absolute"></div>'),i=r(n.getMinimapLink({id:e.obj.item_id,type:"inventory_changed"})).css({display:"block",width:"16px",position:"relative",opacity:"1",left:"4px"});e.getMainDiv().append(o.append(i))}function underline(e){e.on("mouseover",(()=>e.css("text-decoration","underline"))).on("mouseout",(()=>e.css("text-decoration","none")))}const recipes={1:[2e7,20001e3,20002e3,20083e3,20084e3,20085e3,20086e3,20003e3,20004e3,52031e3,52515e3,52522e3,53342e3,53346e3,20005e3,20006e3,20007e3,52875e3,20008e3,20009e3,2001e4,20011e3,20012e3,20013e3,20014e3,20015e3,20016e3,20017e3,20116e3,20018e3,20134e3,20019e3,20096e3,2012e4,20124e3,20097e3,20098e3,20135e3,20099e3,201e5,20136e3,51622e3,51617e3,51621e3,51619e3,5162e4,51618e3,52524e3,53942e3],2:[2002e4,20021e3,20022e3,20081e3,20087e3,20088e3,20089e3,20023e3,20024e3,52032e3,52514e3,52521e3,53343e3,53347e3,20025e3,20026e3,20027e3,52876e3,20028e3,20029e3,2003e4,20031e3,20032e3,20033e3,20034e3,20035e3,20036e3,20037e3,20119e3,20038e3,20123e3,20128e3,20039e3,20101e3,20127e3,20102e3,20103e3,20129e3,20104e3,20105e3,2013e4,5164e4,51635e3,51639e3,51637e3,51638e3,51636e3,52523e3,53945e3],3:[2004e4,20041e3,20042e3,20082e3,2009e4,20091e3,20092e3,20043e3,20044e3,52034e3,52517e3,52519e3,53344e3,53348e3,20045e3,20046e3,20047e3,52878e3,20048e3,20049e3,2005e4,20051e3,20052e3,20053e3,20054e3,20055e3,20056e3,20057e3,20118e3,20058e3,20122e3,20131e3,20059e3,20111e3,20126e3,20112e3,20113e3,20132e3,20114e3,20115e3,20133e3,51634e3,51629e3,51633e3,51631e3,51632e3,5163e4,52526e3,53943e3],4:[2006e4,20061e3,20062e3,2008e4,20093e3,20094e3,20095e3,20063e3,20064e3,52033e3,52516e3,5252e4,53345e3,53349e3,20065e3,20066e3,20067e3,52877e3,20068e3,20069e3,2007e4,20071e3,20072e3,20073e3,20074e3,20075e3,20076e3,20077e3,20117e3,20078e3,20121e3,20137e3,20079e3,20106e3,20125e3,20107e3,20108e3,20138e3,20109e3,2011e4,20139e3,51628e3,51623e3,51627e3,51625e3,51626e3,51624e3,52525e3,53944e3]},twCalcIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAZCAMAAABEio12AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAMAUExURQ4BAFtKL2pSN0IqEDcjDTQgDDAdBxQCACcSABsSCmVMNVc3IA8DAEw+MRcMBmBJMSEYDychGUUoFh0KAHNcP0EvHwoAAFpKOFVBJVRCKHxlUYhwV081GzAlGzghFB4VDGBHIy0XA1A3J3hQJ41oQlxJKCYfFYx3ZSwcDm9FJIBXMHlQH6B7VopoPE1BOj0qE1pFJ5RmKhoSC083H2ZNPHZcOZt3TpRmRWRSQV1OMVlKMFZEJzEiBlNDKUU1LW1XPZZ8bIhWNigXD5l0RHlYMXNILYRjOqp7RZh/YYVtU6iGXZRlNI1eLT4cA3BNMraEUGA+FJV3X5RlPYlcOWBMLEg4HmtbRGJFI0gyHYVTNW1ROZd0TKCNZaaTa2dBGlAsEpFzW4x2XnlVO3RHJl1HKF1INKJ+V3piQYJdN////000FR8GABoGAPn18kgxF/X08i8bBNHJwTIdCPPx8DYcAyELAR4UCkYgAlQ7HjQcDsm1omJPNDkeE9rV0FQ0FdrOwx0OA2NKLFAuFlQ6IywTBCITBUcmCy0XCTAWAquek0kwIT8nEXJHJSYYDHNnWmJBIlw7ITokCycTBEkpEunm49/TyOTb1KGVh11DKl9ILl5IJ3ZSLjsoGZGDdjwiG6+SejQiFDoeBVk/Jlg2HVAzJScKAC8bDkgqGhMAAIRrT19IOVA7NIdwW8rBtmU9G2lOMGtKIkwrDeTh4HJCG7uUdJhjNNTLxINPKryvpWhELLCZhZtyTUQdBKGFZeDX0Laqn9TNyHhdRFQoGkEqHm9JNIxdLY11XlU1Gp6MgXxVL2A8Gd3Y1GA4HaWZjtLGunpKJntHHsO7tGY4FcKvm4JZL2QvCkweBqyYipJdPX1jSNPPzDkpFbixrNG+qNnRy1lDM21VR5WJg7CAUYd2aXlwaFw2E72hiXhjTmpMKlVGN8bBvJdoPYRZPXFTPL+SZK6ln4JtYPLs5urbz8qslXBPItC9r5R5aL+1rYhdSqCLdm1CIquDaV4lCujg1mVJJMWpjVXPAa8AAADcdFJOU+v+/v7s/uvs7P6vr/2v/uz+/a/rr/7rr8j+r6+t/q/rr+z+r6/s66/9r3jO6+uvyO2v6/3+66qvr+3tr8jtr6/rr6+vocivyNnr68jI7a+v6uui68jI7aLtyOvr6evZ6/2h6+v49fbr9v/////////////////////////////////////+///////////////////////////+///////////////////////////+//////////////////////////////////////////////////////////5vmyxZAAAEkElEQVQYGQXBeUxTBwAH4N+7etGbtlBKLUWq6ISJaBSELVwuLioaJJku02k8NhPMnDrFzSsSnZubV7Y5/9hkW7LFIwuTaSaSaQaoEfFEDqEFKi09aOn5aPvat+8j5ha0x4qmABfMtigASGaP5GEIKblbGmZVplHTOEwP5QBQRgzKEAJRTT8MKwC4AQAAdIGYMJZe4NEH2MK/AR3SIm6YbYUcG9FSHJHtJiScgAQSYD5lEme2nW8433AhBeDnlo5NOedWxY8fEOi1dd8Ta7UXPrrmPjKRic3E2/cPNQENyJgGRC7g4raML4Qpkltzc+CERcyOCQo90UAGPDoxbBl24HgDJXI5Lkrnx+O+9bl3Pg5tyK45uaQqqzmjpIOt9JE9E2x4eJ75QSPpWmwN5Ne1LE3sUlKE+HDaEACM9CT6Vl5tH2qeqLp/7+IroXdtj9IDAGmdSVmfpNVjcfS6rcVDLBmNvLydD2xNY5rgfUsMTPachuazRq2iAq8PA7qzlRtxJWch8Gb5cxTUlNaTSpzFAPBrueoScMgB/LIXkNo3q4jfNWIdgHOtXoD/D2gOA+W3HQ9IAuAAAP65wKAXiH4LzOS2PwM4+V8AqmcTQOdzIN4PuCmTlYR+OzQAHnECCaYh0GAa8NE/wmSk4QFgN82n4QZdgBeA1MwsI/lxWk4BtVPM01IAy1cDqLZeAU8lvOsAAFS3GoBsNYBT3lGOIkH8EGSBaLFzZArAyywA7uiO+TOQSfykBXTZY5l7AJT2ALhsgHOMlAFZ0kIUOIzTz49iN/31Qmxm8mj/mHWymAnshKVbnRxYiVpdfCfq1z0UVJOUZYIvTB2seTTNcUQH02l2eRgJTTtMo0Rxt0/6FDaf/JaBGre0VnsrpIzCNGSnEnSDLjc/N2n0p8tkNb0WubbsxtJJVYB/3RRbEvMxkuI2tSiaoFldbDDZTlwNPiaVYYWzX2TVuJJCp/OuGB5Ph6RDJIkO61pxI35EVRHUIPk5kkY4bWmhLuEsPSVi25bPsAfjqgWd7zPWfdpwUXeECR5951loxUSlSOvYGim71bjIF5ujfKPtyfKldfkbSD935IPuqhzp+ha4J8iTV0qaU/uleRifzdTz439W7Tk45xSCxv5+o+vYMdVtaqiPJpUKfzv6XfwIdt+kAQcB429Tz87OUsr/GMxGtK/0FE7ubwckOlzbVTEswWOSiNytg33l4nv4Bgs4lCqwYseyInrVFIylr6Hu6tqHfYgCl9yIns4tsT9ZRPIp/6395GWDLafy+Is10X9HN353gFhE3FFMmu1f5rT4txzKea+W38UNt+4c9BMvk4lGQh3ZImE18AK8BKyYLenSesWAcvB6o/GRQj5mjNvkc/pQ+wA+kZE24H6K1gabsyMhAoD0k3TBRrSEwcvS3pUG8npF7Bnl3qYTX8n++RBzeeIYwVvrUWYgNjkHHJkQxoTSXtNkRO/MgFCKHrpG22/AdUUIKYAkUzDMQxsHWu9YE6Diene05AUdId18KEuVmkeIBWqXuoziHLSv6BVJasl0pKhyNafMnmkxR9QC/n+f2e8W3vECWAAAAABJRU5ErkJggg==";class CraftView{profession;craftService;window;logger;language;errorTracker;noResults;collapseAll;progressBar;search;scrollpane;filters={craftableOnly:!1,difficulty:null,search:""};recipes;constructor(e,t,r,n,o,i){var a,s;this.profession=e,this.craftService=t,this.window=r,this.logger=n,this.language=o,this.errorTracker=i;const{west:l,Character:c,$:u}=this.window;this.logger.log("initializing craft view..."),this.progressBar=(new l.gui.Progressbar).setValue(c.professionSkill||0),this.search=(new l.gui.Textfield).setPlaceholder(this.language.getTranslation(220)),this.search.addKeyUpListener((()=>{this.filters.search=this.search.getValue(),this.apply()})),this.scrollpane=new l.gui.Scrollpane,this.recipes=map(a=recipes[this.profession]).call(a,(e=>Recipe.of(e,this.craftService,this.window,this.language,this.logger,((e,t)=>this.startCraft(e,t))))),sort(s=this.recipes).call(s,(function(e,t){let r=e.getMinLevel()-t.getMinLevel();return 0!=r?r:(r=e.getMidLevel()-t.getMidLevel(),0!=r?r:e.getMaxLevel()-t.getMaxLevel())})),this.noResults=u('<div style="margin: 8px; text-align: center; font-weight: bold;"><p>No results</p></divs>'),this.noResults.hide(),this.collapseAll=this.getCollapseAllDiv()}static of(e,t,r,n,o,i){return new CraftView(e,t,r,n,o,i)}destroy(){var e;this.logger.log("destroying craft view..."),forEach(e=this.recipes).call(e,(e=>e.destroy()))}getFiltersDiv(){const{Crafting:e,$:t,west:r}=this.window,n=e.description.split("<br />"),o=t('<div style="align-items: center; display: flex; flex-direction: row;"></div>'),i=new r.gui.Checkbox("").setValue(!0).setTooltip(this.language.getTranslation(176)).setSelected(!1);i.setCallback((()=>{this.filters.craftableOnly=i.isSelected(),this.apply()})),o.append(i.getMainDiv()),o.append("&nbsp;|&nbsp;");const a=[null,"hard","medium","easy"];return forEach(a).call(a,((e,t)=>{const i=new r.gui.Checkbox("","TWCalc_CraftFilter").setValue(e).setSelected(null===e).setRadiobutton().setTooltip(t?n[t-1]:"All");i.setCallback((()=>{this.filters.difficulty=i.getValue(),this.apply()})),o.append(i.getMainDiv())})),o}show(e){this.logger.log(`showing recipe id = ${e}`);const t=this.getRecipe(e),r=(this.scrollpane.clipPane[0].clientHeight-30)/this.scrollpane.contentPane[0].clientHeight*t.getOffsetTop();this.scrollpane.scrollTo(0,r,!0),t.setCollapsed(!0)}apply(){var e;this.logger.log("apply craft filter...",this.filters);const t=this.filters;let r=0;forEach(e=this.recipes).call(e,(e=>{const n=(null===t.difficulty||t.difficulty===e.getDifficulty())&&(!t.craftableOnly||e.isCraftable())&&(!t.search.length||-1!==e.getName().toLowerCase().search(t.search.toLowerCase()));n&&r++,e.setVisible(n)})),r?(this.collapseAll.show(),this.noResults.hide()):(this.collapseAll.hide(),this.noResults.show()),this.scrollpane.scrollToTop()}getMainDiv(){const{$:e,west:t}=this.window,r=e(`<div id="TWCalcCraft_${this.profession}"></div>`),n=new t.gui.Groupframe,o=e('<div style="display: flex; justify-content: space-between; flex-direction: row; align-items: center;"></div>');if(this.progressBar.setMaxValue(this.craftService.maxProfessionSkill),this.search.setWidth(this.isMyProfession()?200:624),o.append(this.search.getMainDiv()),this.isMyProfession()){const e=this.progressBar.getMainDiv().css("width",300);o.append(e)}this.isMyProfession()&&o.append(this.getFiltersDiv()),n.appendToContentPane(o),r.append(n.getMainDiv()),this.scrollpane.appendContent(this.collapseAll),this.scrollpane.appendContent(this.getRecipes()),this.scrollpane.appendContent(this.noResults);const i=e(this.scrollpane.getMainDiv()).css({height:293,"text-align":"center"});return r.append(i),r.append(e('<a href="//tw-calc.net/craft/'+this.profession+'" target="_blank" title="Show this profession on tw-calc.net"><div style="background-position: 0 0; background-image: url('+twCalcIcon+'); width: 25px; height: 25px; position: absolute; bottom: 0; left: 5px"></div></a>')),r}startCraft(e,t){this.logger.log(`start craft recipe id ${e.recipeId} (amount = ${t})`);const{Ajax:r,Character:n,MessageError:o,EventHandler:i,MessageSuccess:a}=this.window,s=e=>{var t;n.setProfessionSkill(e.msg.profession_skill),n.updateDailyTask("crafts",e.msg.count),i.signal("inventory_changed"),this.progressBar.setValue(n.professionSkill||0),forEach(t=this.recipes).call(t,(e=>e.initMainDiv())),a(e.msg.msg).show()};r.remoteCall("crafting","start_craft",{recipe_id:e.recipeId,amount:t},(t=>{t.error?o(t.msg).show():e.isWithCooldown()?this.craftService.update((()=>s(t))):s(t)}))}getRecipes(){var e;const{$:t}=this.window,r=t("<div></div>");return forEach(e=this.recipes).call(e,(e=>r.append(e.getMainDiv()))),r}getRecipe(e){var t;const r=find(t=this.recipes).call(t,(t=>t.recipeId===e));if(!r)throw new Error(`recipe (id = ${e}) not found`);return r}getCollapseAllDiv(){const{$:e}=this.window,t=e('<div id="recipe_title_" class="recipe_title" style="display: inline-block; text-align: left;"></div>'),r=e('<div class="recipe_title_inner"></div>'),n=e('<div class="recipe_collapse">+</div>');return r.append('<div id="recipe_difficult_" class="recipe_difficult"></div>'),r.append('<div id="recipe_name" class="recipe_name">'+this.language.getTranslation(178)+"</div>"),e(t).on("click",(()=>{var e;const t="+"===n.text();forEach(e=this.recipes).call(e,(e=>e.setCollapsed(t))),n.text(t?"-":"+")})),t.append(n).append(r)}isMyProfession(){return this.craftService.isProfession(this.profession)}}__decorate([CatchErrors("CraftView.destroy"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],CraftView.prototype,"destroy",null),__decorate([CatchErrors("CraftView.getFiltersDiv"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],CraftView.prototype,"getFiltersDiv",null);let CraftViewFactory=class{window;logger;craftService;language;errorTracker;constructor(e,t,r,n,o){this.window=e,this.logger=t,this.craftService=r,this.language=n,this.errorTracker=o}getWindowView(e,t){let r;return this.logger.log("get window view of craft profession...",e),{key:e,title:t,loader:!0,init:e=>{let{loadCallback:t,options:n}=e;if(!r||void 0===n)return t();setTimeout$1((()=>{this.errorTracker.execute((()=>{r.show(n.showRecipe.id)}))}),250),t()},destroy:()=>{r&&r.destroy()},getMainDiv:()=>(r=CraftView.of(e,this.craftService,this.window,this.logger,this.language,this.errorTracker),this.window["a"+e]=r,r.getMainDiv())}}};CraftViewFactory=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,CraftService,Language,ErrorTracker])],CraftViewFactory);class CraftWindow extends TW2Window{window;craftViewFactory;craftService;errorTracker;constructor(e,t,r,n,o,i){super("TWCalcCraft",i,e,t,r,{title:{type:"translation",translation:183}}),this.window=e,this.craftViewFactory=n,this.craftService=o,this.errorTracker=i;for(let e=1;e<=4;e++)this.addView(this.craftViewFactory.getWindowView(e,{type:"translation",translation:craftTranslations[e]}))}open(e){super.open(e),this.craftService.update()}}__decorate([CatchErrors("CraftWindow.open"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],CraftWindow.prototype,"open",null);let Craft=class{window;language;logger;craftService;craftViewFactory;errorTracker;craftWindow;productRecipe;constructor(e,t,r,n,o,i){this.window=e,this.language=t,this.logger=r,this.craftService=n,this.craftViewFactory=o,this.errorTracker=i,this.craftWindow=new CraftWindow(e,this.language,this.logger,this.craftViewFactory,this.craftService,this.errorTracker)}init(){this.craftService.init()}open(){this.craftWindow.open({tab:this.getCurrentProfession()})}openCraftRecipeWindow(e){const{MessageError:t,ItemManager:r}=this.window;this.logger.log(`show recipe for productId = ${e}`);const n=this.getRecipeForProduct(e);if(n){const t=r.get(n).profession_id;this.logger.log(`there is a profession (id = ${t}) with recipe (id = ${n}) for the product (id = ${e})`),this.craftWindow.open({tab:t,tabInitOptions:{showRecipe:{id:n}}})}else t("There is no recipe for this product!").show()}getCurrentProfession(){return this.window.Character.professionId||0}getRecipeForProduct(e){if(!this.productRecipe){var t;const e=this.productRecipe={};forEach(t=values$1(recipes)).call(t,(t=>{forEach(t).call(t,(t=>{const r=this.window.ItemManager.get(t).craftitem;e[r]=t}))}))}const r=this.productRecipe[e];return r||null}};var DuelBarPosition,SettingBoolean,SettingNumber;__decorate([CatchErrors("Craft.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Craft.prototype,"init",null),__decorate([CatchErrors("Craft.open"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Craft.prototype,"open",null),__decorate([CatchErrors("Craft.openCraftRecipeWindow"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],Craft.prototype,"openCraftRecipeWindow",null),Craft=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Language,Logger,CraftService,CraftViewFactory,ErrorTracker])],Craft),function(e){e[e.up=1]="up",e[e.down=2]="down",e[e.hidden=4]="hidden"}(DuelBarPosition||(DuelBarPosition={})),function(e){e.Wardrobe="Wardrobe",e.MenuCraftButton="MenuCraftButton",e.TransferFeeCalc="TransferFeeCalc",e.XpHpEnergyCalc="XpHpEnergyCalc",e.WestCalc="WestCalc"}(SettingBoolean||(SettingBoolean={})),function(e){e.NearestJobsBar="NearestJobsBar",e.DuelBar="DuelBar"}(SettingNumber||(SettingNumber={}));let Settings=class{language;storage;logger;window;defaults={[SettingBoolean.Wardrobe]:!0,[SettingBoolean.MenuCraftButton]:!0,[SettingBoolean.TransferFeeCalc]:!0,[SettingBoolean.XpHpEnergyCalc]:!0,[SettingBoolean.WestCalc]:!0,[SettingNumber.NearestJobsBar]:1,[SettingNumber.DuelBar]:1};constructor(e,t,r,n){this.language=e,this.storage=t,this.logger=r,this.window=n}save(e){const t={};forEach(e).call(e,(e=>{t[e.name]=getValue(e)})),this.logger.log("saving settings...",t),this.storage.setObject(StorageKey.settings,t),this.window.MessageSuccess(this.language.getTranslation(88)).show()}get(e){if(this.storage.has(StorageKey.settings)){const t=this.storage.getObject(StorageKey.settings)[e];if(void 0!==t)return t}return this.defaults[e]}};function getValue(e){return isBooleanSetting(e)?e.controller.isSelected():isNumberSetting(e)?e.controller.getValue():void 0}function isBooleanSetting(e){return"checkbox"===e.behaviour.type}function isNumberSetting(e){return"combobox"===e.behaviour.type}function WaitUntil(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;return function(o,i,a){const s=a.value;let l,c=0;a.value=function(){c=now(),l=n.setInterval((()=>{if(satisfies(bind$1(e).call(e,this)))return n.clearInterval(l),bind$1(s).call(s,this,...from_1(arguments))();r&&r>0&&now()-c>r&&(this.logger.warn("wait until timeout exceeded"),n.clearInterval(l))}),t)}}}function satisfies(e){try{return e()}catch(e){return!1}}Settings=__decorate([singleton(),__param(3,inject$1("window")),__metadata("design:paramtypes",[Language,Storage,Logger,Object])],Settings);var $entries=require$$0$l.entries;$$1({target:"Object",stat:!0},{entries:function(e){return $entries(e)}});var entries$2=path.Object.entries,parent$a=entries$2,entries$1=parent$a,require$$0$e=entries$1,entries=require$$0$e,floor=Math.floor,isIntegralNumber$1=Number.isInteger||function(e){return!isObject$1(e)&&isFinite(e)&&floor(e)===e},isIntegralNumber=isIntegralNumber$1;$$1({target:"Number",stat:!0},{isInteger:isIntegralNumber});var isInteger$2=path.Number.isInteger,parent$9=isInteger$2,isInteger$1=parent$9,require$$0$d=isInteger$1,isInteger=require$$0$d,globalIsFinite=global$1.isFinite,numberIsFinite$1=Number.isFinite||function(e){return"number"==typeof e&&globalIsFinite(e)},numberIsFinite=numberIsFinite$1;$$1({target:"Number",stat:!0},{isFinite:numberIsFinite});var _isFinite$2=path.Number.isFinite,parent$8=_isFinite$2,_isFinite$1=parent$8,require$$0$c=_isFinite$1,_isFinite=require$$0$c,WestCalcWindowTab;!function(e){e.Settings="settings",e.Notepad="notepad",e.Import="import",e.BattleCalc="battle-calc",e.DuelCalc="duel-calc",e.Tombola="tombola",e.Character="character"}(WestCalcWindowTab||(WestCalcWindowTab={}));const numericInputOptionsDefaults={label:void 0,inputWidth:100,labelWidth:180,isIntegerOnly:!0};let BattleCalcView=class{window;language;storage;config;battleCalc;logger;errorTracker;key=WestCalcWindowTab.BattleCalc;title={type:"translation",translation:214};constructor(e,t,r,n,o,i,a){this.window=e,this.language=t,this.storage=r,this.config=n,this.battleCalc=o,this.logger=i,this.errorTracker=a}calculate(){if(!this.window.$("#BattleCalc").length)return;const{charClass:e,premium:t,level:r,health:n,leadership:o,pitfall:i,hide:a,dodge:s,aim:l,mapPosition:c,charTower:u,damageBonus:d,dodgeBonus:g,resistanceBonus:p,hitBonus:h,weaponMax:f,weaponMin:y}=this.getCachedInput(),$={charClass:e,premium:t,level:r,skills:{health:n,leadership:o,pitfall:i,hide:a,dodge:s,aim:l},mapPosition:c,charTower:u,damage:[y,f],bonus:{attack:h,defense:g,resistance:p,damage:d}};this.logger.log("calculating battle calc based on input...",$);const m=this.battleCalc.getInstance().coreCalc($,!1);this.logger.log("battle calc calculation finished",m);const w="#TW_Calc_BattleCalc_";this.window.$(w+"AttackHit").text(m.attack.hit),this.window.$(w+"AttackDodge").text(m.attack.dodge),this.window.$(w+"DefenseHit").text(m.defense.hit),this.window.$(w+"DefenseDodge").text(m.defense.dodge),this.window.$(w+"HealthOutput").text(m.health+" HP"),this.window.$(w+"AttackResistance").text(m.attack.resistance),this.window.$(w+"AttackResistanceBonus").text(`(+${m.attack.resistance_bonus})`),this.window.$(w+"DefenseResistance").text(m.defense.resistance),this.window.$(w+"DefenseResistanceBonus").text(`(+${m.defense.resistance_bonus})`),this.window.$(w+"DamageOutput").text(m.damage)}getCachedInput(){const e={health:0,dodge:0,hide:0,aim:0,pitfall:0,leadership:0,weaponMin:50,weaponMax:110,level:1,charClass:"greenhorn",mapPosition:0,premium:!1,charTower:!1,hitBonus:0,dodgeBonus:0,resistanceBonus:0,damageBonus:0};return this.storage.has(StorageKey.battleCalc)?assign(e,this.storage.getObject(StorageKey.battleCalc)):e}init(){this.calculate()}getMainDiv(){var e,t,r;if(!this.battleCalc.isAvailable())return $("<div>Battle calc core script is not loaded, try refreshing the game.</div>");const{west:n}=this.window,o=$("<div></div>"),i=(new n.gui.Groupframe).appendToContentPane('<div style="font-weight: bold; font-size: large;">'+this.language.getTranslation(4)+"</div>"),a={health:this.language.getTranslation(29),dodge:this.language.getTranslation(8),hide:this.language.getTranslation(6),aim:this.language.getTranslation(9),pitfall:this.language.getTranslation(193),leadership:this.language.getTranslation(5)};forEach(e=entries(a)).call(e,(e=>{let[t,r]=e;i.appendToContentPane($("<div></div>").append(this.getNumericInput(t,{label:r})))}));const s=(new n.gui.Groupframe).appendToContentPane('<div style="font-weight: bold; font-size: large;">'+this.language.getTranslation(32)+"</div>");s.appendToContentPane($("<div></div>").append(this.getNumericInput("level",{label:this.language.getTranslation(30)}))),s.appendToContentPane($("<div></div>").append(this.getNumericInput("weaponMin",{label:this.language.getTranslation(201),inputWidth:50,labelWidth:140})).append("&nbsp;-&nbsp;").append(this.getNumericInput("weaponMax",{inputWidth:50}))),s.appendToContentPane('<div style="font-weight: bold;">'+this.language.getTranslation(32)+"</div>");const l=new n.gui.Combobox("TWCalc_Character").setWidth(100);l.addListener(this.onInputChange("charClass",(()=>l.getValue()))),s.appendToContentPane(l.addItem("greenhorn",this.language.getTranslation(38)).addItem("soldier",this.language.getTranslation(41)).addItem("worker",this.language.getTranslation(42)).addItem("duelist",this.language.getTranslation(39)).addItem("adventurer",this.language.getTranslation(40)).select(this.getCachedInputValue("charClass")).getMainDiv()),s.appendToContentPane('<div style="font-weight: bold;">'+this.language.getTranslation(18)+"</div>");const c=new n.gui.Combobox("TWCalc_Place").setWidth(100);c.addListener(this.onInputChange("mapPosition",(()=>c.getValue()))),s.appendToContentPane(c.addItem(0,this.language.getTranslation(21)).addItem(1e4,this.language.getTranslation(223)).addItem(10001,this.language.getTranslation(224)).addItem(100,this.language.getTranslation(22)+" 0").addItem(1,this.language.getTranslation(22)+" 1").addItem(2,this.language.getTranslation(22)+" 2").addItem(3,this.language.getTranslation(22)+" 3").addItem(4,this.language.getTranslation(22)+" 4").addItem(5,this.language.getTranslation(22)+" 5").addItem(1e3,this.language.getTranslation(203)+" 0").addItem(11,this.language.getTranslation(203)+" 1").addItem(12,this.language.getTranslation(203)+" 2").addItem(13,this.language.getTranslation(203)+" 3").addItem(14,this.language.getTranslation(203)+" 4").addItem(15,this.language.getTranslation(203)+" 5").select(this.getCachedInputValue("mapPosition")).getMainDiv());const u={premium:this.language.getTranslation(2),charTower:this.language.getTranslation(20)},d=$("<div></div>");forEach(t=entries(u)).call(t,(e=>{let[t,r]=e;const o=new n.gui.Checkbox(r).setId(t).setSelected(this.getCachedInputValue(t));o.setCallback(this.onInputChange(t,(()=>o.isSelected()))),$(d).append($('<div style="margin: 2px 0"></div>').append(o.getMainDiv()))})),s.appendToContentPane(d);const g=(new n.gui.Groupframe).appendToContentPane('<div style="font-weight: bold; font-size: large;">'+this.language.getTranslation(202)+"</div>"),p={hitBonus:this.language.getTranslation(14),dodgeBonus:this.language.getTranslation(51),resistanceBonus:this.language.getTranslation(140),damageBonus:this.language.getTranslation(141)};forEach(r=entries(p)).call(r,(e=>{let[t,r]=e;g.appendToContentPane($("<div></div>").append(this.getNumericInput(t,{label:r,isIntegerOnly:!1})))})),o.append(i.getMainDiv()).append(s.getMainDiv()).append(g.getMainDiv());const h=(new n.gui.Groupframe).appendToContentPane('<div style="font-weight: bold; font-size: 18px; color: darkred; margin: 6px 0">'+this.language.getTranslation(31)+'</div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(14)+'</div><div><span style="display: inline-block; width: 24px; text-align: center"><img alt="attacker_primary" src="'+this.config.cdn+'/images/fort/battle/attacker_primary.png"></span><span id="TW_Calc_BattleCalc_AttackHit">0</span></div></div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(51)+'</div><div><span style="display: inline-block; width: 24px; text-align: center"><img alt="defender_secondary" src="'+this.config.cdn+'/images/fort/battle/defender_secondary.png"></span><span id="TW_Calc_BattleCalc_AttackDodge">0</span></div></div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(140)+'</div><div><span style="display: inline-block; width: 24px; text-align: center"><img alt="resistance" src="'+this.config.cdn+'/images/fort/battle/resistance.png"></span></span><span id="TW_Calc_BattleCalc_AttackResistance">0</span> <span id="TW_Calc_BattleCalc_AttackResistanceBonus">0</span></div></div><div style="font-weight: bold; font-size: 18px; color: darkblue; margin: 6px 0">'+this.language.getTranslation(33)+'</div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(14)+'</div><div><span style="display: inline-block; width: 24px; text-align: center"><img alt="attacker_primary" src="'+this.config.cdn+'/images/fort/battle/attacker_primary.png"></span><span id="TW_Calc_BattleCalc_DefenseHit">0</span></div></div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(51)+'</div><div><span style="display: inline-block; width: 24px; text-align: center"><img alt="defender_secondary" src="'+this.config.cdn+'/images/fort/battle/defender_secondary.png"></span><span id="TW_Calc_BattleCalc_DefenseDodge">0</span></div></div><div style="margin: 2px 0"><div style="font-weight: bold;">'+this.language.getTranslation(140)+'</div><div><span style="display: inline-block; text-align: center; width: 24px;"><img alt="resistance" src="'+this.config.cdn+'/images/fort/battle/resistance.png"></span></span><span id="TW_Calc_BattleCalc_DefenseResistance">0</span> <span id="TW_Calc_BattleCalc_DefenseResistanceBonus">0</span></div></div><div style="margin-top: 12px"><div style="margin: 2px 0"><div style="font-size: 13px; font-weight: bold">'+this.language.getTranslation(28)+':&nbsp;<span id="TW_Calc_BattleCalc_HealthOutput">0</span></div></div><div style="margin: 2px 0"><div style="font-size: 13px; font-weight: bold">'+this.language.getTranslation(141)+':&nbsp;<span id="TW_Calc_BattleCalc_DamageOutput">0</span></div></div></div>'),f=$('<div id="BattleCalc"></div>');return f.append($('<div style="width: 350px; height: 355px; position: absolute; top: 10px; left: 0"></div>').append((new n.gui.Scrollpane).appendContent(o).getMainDiv())).append($('<div style="width: 340px; height: 355px; position: absolute; top: 10px; right: 5px"></div>').append((new n.gui.Scrollpane).appendContent(h.getMainDiv()).getMainDiv())),f}getNumericInput(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:numericInputOptionsDefaults;const r=new this.window.west.gui.Textfield,n=assign({...numericInputOptionsDefaults},t);return void 0!==n.label&&r.setLabel('<span style="display: inline-block; font-weight: bold; width: '+n.labelWidth+'px;">'+n.label+"</span>"),n.isIntegerOnly&&r.onlyNumeric(),r.setWidth(n.inputWidth).setValue(this.getCachedInputValue(e)).addKeyUpListener(this.onInputChange(e,(()=>{const e=Number(r.getValue().replace(/,/,"."));return n.isIntegerOnly&&!isInteger(e)||!_isFinite(e)?0:e}))).getMainDiv()}onInputChange(e,t){return()=>{this.errorTracker.execute((()=>{this.setCachedInputValue(e,t()),this.calculate()}))}}getCachedInputValue(e){const t=this.getCachedInput();if(!t)throw new Error;if(!(e in t))throw new Error(`key "${e}" does not exist on battle calc view input!`);return t[e]}setCachedInputValue(e,t){const r=this.getCachedInput();if(!(e in r))throw new Error(`key "${e}" does not exist on battle calc view input!`);r[e]=t,this.storage.setObject(StorageKey.battleCalc,r)}};__decorate([CatchErrors("BattleCalcView.calculate"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],BattleCalcView.prototype,"calculate",null),__decorate([CatchErrors("BattleCalcView.getCachedInput"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],BattleCalcView.prototype,"getCachedInput",null),BattleCalcView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Language,Storage,Config,BattleCalc,Logger,ErrorTracker])],BattleCalcView);let CharacterView=class{window;config;language;battleCalc;key=WestCalcWindowTab.Character;title={type:"translation",translation:212};constructor(e,t,r,n){this.window=e,this.config=t,this.language=r,this.battleCalc=n}init(){const{Character:e,Premium:t,CharacterSkills:r}=this.window,n=this.window.$("#BattleCalcCharacterView");if(!n.length)return;const o={charClass:e.charClass,premium:t.hasBonus("character"),level:e.level,skills:{health:r.skills.health.getPointsWithBonus(),leadership:r.skills.leadership.getPointsWithBonus(),pitfall:r.skills.pitfall.getPointsWithBonus(),hide:r.skills.hide.getPointsWithBonus(),dodge:r.skills.dodge.getPointsWithBonus(),aim:r.skills.aim.getPointsWithBonus()},mapPosition:0,charTower:!1,damage:[0,0],bonus:{attack:0,defense:0,resistance:0,damage:0}},i=this.battleCalc.getInstance().coreCalc(o,!0);this.window.$("#data-attack-hit",n).text(i.attack.hit),this.window.$("#data-attack-dodge",n).text(i.attack.dodge),this.window.$("#data-attack-resistance",n).text(i.attack.resistance),this.window.$("#data-attack-resistance-bonus").text(`(+${i.attack.resistance_bonus})`),this.window.$("#data-defense-hit",n).text(i.defense.hit),this.window.$("#data-defense-dodge",n).text(i.defense.dodge),this.window.$("#data-defense-resistance",n).text(i.defense.resistance),this.window.$("#data-defense-resistance-bonus").text(`(+${i.defense.resistance_bonus})`),this.window.$("#data-health",n).text(i.health),this.window.$("#data-damage",n).text(i.damage)}getMainDiv(){if(!this.battleCalc.isAvailable())return $("<div>Battle calc core script is not loaded, try refreshing the game.</div>");const e=$('<div id="BattleCalcCharacterView"></div>'),t=["health","dodge","hide","aim","pitfall","leadership"],r=new this.window.west.gui.Groupframe;for(let e=0;e<t.length;e++){const n=t[e],o=this.window.CharacterSkills.skills[n].name,i=this.window.CharacterSkills.skills[n].getPointsWithBonus();r.appendToContentPane(`<div style="display: inline-block; width: 88px; height: 60px;">\n                <img class="skillicon" src="${this.config.cdn}/images/window/skills/skillicon_${n}.png" title="${o}" alt="${o}" />\n                <div class="tw2gui_plusminus">\n                    <span class="displayValueBonus text_green unselectable" style="display: inline-block; width: 56px;">${i}</span>                 \n                </div>\n            </div>`)}e.append($('<div style="margin-top: 10px; text-align: center"></div>').append(r.getMainDiv()));const n=new this.window.west.gui.Groupframe;return n.appendToContentPane($('<table style="width: 100%; height: 180px; font-size: 16px"><tr><td style="width: 33%"><div style="margin: 6px 0; font-weight: bold; font-size: 18px; color: darkred;">'+this.language.getTranslation(31)+'</div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(14)+'</div><div id="data-attack-hit"></div></div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(51)+'</div><div id="data-attack-dodge"></div></div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(140)+'</div><div><span id="data-attack-resistance"></span> <span id="data-attack-resistance-bonus"></span></div></div></td><td style="width: 33%"><div style="margin: 6px 0; font-weight: bold; font-size: 18px; color: darkblue;">'+this.language.getTranslation(33)+'</div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(14)+'</div><div id="data-defense-hit"></div></div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(51)+'</div><div id="data-defense-dodge"></div></div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(140)+'</div><div><span id="data-defense-resistance"></span> <span id="data-defense-resistance-bonus"></span></div></div></td><td style="width: 33%"><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(28)+': </div><span><span id="data-health"></span> HP</span></div><div style="margin: 4px 0"><div style="font-weight: bold; margin: 2px 0; font-size: 15px">'+this.language.getTranslation(141)+': </div><span id="data-damage"></span></div></td></tr></table>')),e.append(n.getMainDiv()),e}};CharacterView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,Language,BattleCalc])],CharacterView);let DuelCalcView=class{window;language;key=WestCalcWindowTab.DuelCalc;title={type:"translation",translation:215};constructor(e,t){this.window=e,this.language=t}init(){this.calcMaxDuelLevel(),this.calcExperience()}getMainDiv(){const e=$("<div></div>");return e.append(this.getMaxDuelLevelCalculatorContent()),e.append(this.getMotivationCalculatorContent()),e}calcMaxDuelLevel=()=>{};calcExperience=()=>{};getMaxDuelLevelCalculatorContent(){const e=this.window.$(`<div><div><h4>${this.language.getTranslation(63)}</h4></div></div>`),t=$('<span style="font-weight: bold"></span>'),r=$('<span style="font-weight: bold"></span>'),n=(new this.window.west.gui.Textfield).setId("TWCalc_DuelLevel").setWidth(100).setLabel(this.language.getTranslation(66)).setValue(this.window.Character.duelLevel.toString());return this.calcMaxDuelLevel=getMaxDuelLevelFunction(n,r,t),n.addKeyUpListener(this.calcMaxDuelLevel),e.append(n.getMainDiv()),e.append($(`<div><span>${this.language.getTranslation(69)}:&nbsp;</span></div>`).append(t)),e.append($(`<div><span>${this.language.getTranslation(68)}:&nbsp;</span></div>`).append(r)),(new this.window.west.gui.Groupframe).appendToContentPane(e).getMainDiv()}getMotivationCalculatorContent(){const e=this.window.$(`<div><div><h4>${this.language.getTranslation(64)}</h4></div></div>`),t=(new this.window.west.gui.Textfield).setId("TWCalc_DuelLevel1").setWidth(100).setLabel(this.language.getTranslation(66)).onlyNumeric().setValue(this.window.Character.duelLevel.toString()),r=(new this.window.west.gui.Textfield).setId("TWCalc_DuelLevel2").setWidth(100).setLabel(this.language.getTranslation(70)).onlyNumeric().setValue(this.window.Character.duelLevel+10),n=this.window.Character.duelMotivation,o=(new this.window.west.gui.Textfield).setId("TWCalc_DuelLevelMotivation").setWidth(100).setLabel(`<img alt="motivation" src="images/job/motivation.png"> ${this.language.getTranslation(71)}`).onlyNumeric().setValue(n?100*n:100),i=$('<div style="margin-top: 16px"></div>');this.calcExperience=getDuelExperienceFunction(t,r,o,i,this.language);const a=(new this.window.west.gui.Button).setCaption(this.language.getTranslation(67)).click(this.calcExperience).getMainDiv();return e.append($("<div></div>").append(t.getMainDiv())),e.append($("<div></div>").append(r.getMainDiv())),e.append($("<div></div>").append(o.getMainDiv())),e.append($("<div></div>").append(a)),e.append($("<div></div>").append(i)),(new this.window.west.gui.Groupframe).appendToContentPane(e).getMainDiv()}};function getMaxDuelLevelFunction(e,t,r){return function(){const n=Number(e.getValue());t.html(Math.floor(1.4*n).toString()),r.html(Math.ceil(n/1.4).toString())}}function getDuelExperienceFunction(e,t,r,n,o){return function(){const i=Number(e.getValue()),a=Number(t.getValue()),s=Number(r.getValue())/100*(7*a-5*i+5),l=3*Math.round(s),c=Math.round(s/3),u=`<div>${o.getTranslation(86)} <b>${l}</b> ${o.getTranslation(87)} <b>${Math.round(s)}</b> ${o.getTranslation(110)}</div><div>${o.getTranslation(199)} <b>${c}<b> ${o.getTranslation(110)}</div>`;n.html(u)}}DuelCalcView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Language])],DuelCalcView);let Importer=class{config;constructor(e){this.config=e}start(){$.getScript(this.config.website+"/doImport.js")}};Importer=__decorate([singleton(),__metadata("design:paramtypes",[Config])],Importer);let ImporterView=class{window;importer;key=WestCalcWindowTab.Import;title={type:"translation",translation:211};constructor(e,t){this.window=e,this.importer=t}init(){this.importer.start()}getMainDiv(){return this.window.$('<div id="TW_Calc_Importer"></div>')}};ImporterView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Importer])],ImporterView);let NotepadView=class{window;language;config;storage;logger;alarmClock;errorTracker;key=WestCalcWindowTab.Notepad;title={type:"translation",translation:210};constructor(e,t,r,n,o,i,a){this.window=e,this.language=t,this.config=r,this.storage=n,this.logger=o,this.alarmClock=i,this.errorTracker=a}clearNotes(e){new this.window.west.gui.Dialog(this.language.getTranslation(123),this.language.getTranslation(123)).addButton("Ok",(()=>{this.storage.remove(StorageKey.notepad),e.setContent(""),this.window.MessageSuccess(this.language.getTranslation(89)).show()})).addButton("Cancel").show()}saveNotes(e){this.storage.setString(StorageKey.notepad,e.getContent()),this.window.MessageSuccess(this.language.getTranslation(88)).show()}setAlarmClock(e,t){const{west:r,MessageSuccess:n,MessageError:o}=this.window,i=(new r.gui.Textarea).setWidth(480).setHeight(120),a=e.getValue(),s=t.getValue();return a.length?s.length?this.alarmClock.getDate(a,s)<=now()-6e4?o("You cannot set alarm clock with past date!").show():void new r.gui.Dialog(this.language.getTranslation(93),i.getMainDiv()).addButton("Ok",(()=>{const e={date:a,time:s,caption:i.getContent()};this.storage.setObject(StorageKey.alarmClock,e),this.logger.log("alarm clock set ",e),n(this.language.getTranslation(96)).show()})).addButton(this.language.getTranslation(92)).show():o("You must set a time for alarm clock!").show():o("You must set a date for alarm clock!").show()}getMainDiv(){const{west:e,$:t}=this.window,r=(new e.gui.Textarea).setWidth(655).setHeight(280).setContent(this.storage.getString(StorageKey.notepad,"")),n=t("<div></div>"),o=t("<div></div>");n.append((new e.gui.Button).setCaption(this.language.getTranslation(36)).click((()=>this.saveNotes(r))).getMainDiv()),n.append((new e.gui.Button).setCaption(this.language.getTranslation(35)).click((()=>this.clearNotes(r))).getMainDiv());const i=this.storage.getObject(StorageKey.alarmClock,{date:"",time:"",caption:""}),a=(new e.gui.Textfield).setValue(i.date).setLabel('<img src="'+this.config.cdn+'/images/icons/clock.png" width="20" height="20" alt="Alarm clock" />'),s=(new e.gui.Textfield).setValue(i.time);o.append(changeInput(a.getMainDiv(),"date")),o.append(changeInput(s.getMainDiv(),"time")),o.append((new e.gui.Button).setCaption(this.language.getTranslation(37)).click((()=>this.setAlarmClock(a,s))).getMainDiv());const l=t('<div style="display: flex; flex-direction: row; justify-content: space-between; margin: 5px"></div>');return l.append(n),l.append(o),t("<div></div>").append(l).append(r.getMainDiv())}};function changeInput(e,t){return find(e).call(e,"input").attr("type",t),e}__decorate([CatchErrors("NotepadView.clearNotes"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],NotepadView.prototype,"clearNotes",null),__decorate([CatchErrors("NotepadView.saveNotes"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],NotepadView.prototype,"saveNotes",null),__decorate([CatchErrors("NotepadView.setAlarmClock"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],NotepadView.prototype,"setAlarmClock",null),NotepadView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Language,Config,Storage,Logger,AlarmClock,ErrorTracker])],NotepadView),$$1({target:"Array",stat:!0},{isArray:isArray$3});var isArray$2=path.Array.isArray,parent$7=isArray$2,isArray$1=parent$7,require$$0$b=isArray$1,isArray=require$$0$b,$includes=require$$0$x.includes,BROKEN_ON_SPARSE=fails$1((function(){return!Array(1).includes()}));$$1({target:"Array",proto:!0,forced:BROKEN_ON_SPARSE},{includes:function(e){return $includes(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables();var includes$4=entryVirtual("Array").includes,MATCH$1=wellKnownSymbol$1("match"),isRegexp=function(e){var t;return isObject$1(e)&&(void 0!==(t=e[MATCH$1])?!!t:"RegExp"==classof$3(e))},isRegExp=isRegexp,$TypeError$7=TypeError,notARegexp=function(e){if(isRegExp(e))throw $TypeError$7("The method doesn't accept regular expressions");return e},MATCH=wellKnownSymbol$1("match"),correctIsRegexpLogic=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[MATCH]=!1,"/./"[e](t)}catch(e){}}return!1},notARegExp=notARegexp,correctIsRegExpLogic=correctIsRegexpLogic,stringIndexOf=uncurryThis("".indexOf);$$1({target:"String",proto:!0,forced:!correctIsRegExpLogic("includes")},{includes:function(e){return!!~stringIndexOf(toString$3(requireObjectCoercible$1(this)),toString$3(notARegExp(e)),arguments.length>1?arguments[1]:void 0)}});var includes$3=entryVirtual("String").includes,arrayMethod=includes$4,stringMethod=includes$3,ArrayPrototype$4=Array.prototype,StringPrototype$1=String.prototype,includes$2=function(e){var t=e.includes;return e===ArrayPrototype$4||isPrototypeOf(ArrayPrototype$4,e)&&t===ArrayPrototype$4.includes?arrayMethod:"string"==typeof e||e===StringPrototype$1||isPrototypeOf(StringPrototype$1,e)&&t===StringPrototype$1.includes?stringMethod:t},parent$6=includes$2,includes$1=parent$6,require$$0$a=includes$1,includes=require$$0$a;let LocalSettingsExporter=class{window;storage;logger;exportable=[StorageKey.alarmClock,StorageKey.battleCalc,StorageKey.ownCalc,StorageKey.jobList,StorageKey.notepad,StorageKey.settings,StorageKey.tombola,StorageKey.wardrobe];constructor(e,t,r){this.window=e,this.storage=t,this.logger=r}setSettings(e){try{this.setSerializedSettings(e)}catch(e){return this.logger.error(e),this.window.MessageError("Unable to deserialize settings!").show(),!1}return!0}setSerializedSettings(e){const t=JSON.parse(e);if(!isArray(t))throw new Error("Array expected!");let r=t.length;for(const e of t){if("object"!=typeof e){this.logger.warn("Object expected!");continue}const t=e.key,n=e.value;this.isValidKey(t)?(this.storage.setString(t,n),r--):this.logger.warn("Invalid key!",e)}r?this.window.MessageHint(`Unable to import some settings! (${r})`).show():this.window.MessageSuccess("Successful!").show()}getSerializedExportableSettings(){return stringify(this.getExportableSettings())}getExportableSettings(){var e,t;return map(e=filter(t=this.exportable).call(t,(e=>this.storage.has(e)))).call(e,(e=>({key:e,value:this.storage.getString(e)})))}isValidKey(e){var t;return"string"==typeof e&&includes(t=values$1(StorageKey)).call(t,e)}};LocalSettingsExporter=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Storage,Logger])],LocalSettingsExporter);class LocalSettingsExporterWindow extends TW2Window{window;errorTracker;localSettingsExporter;constructor(e,t,r,n,o){super("TWCalcSettingImporter",n,e,t,r,{title:{type:"translation",translation:225}}),this.window=e,this.errorTracker=n,this.localSettingsExporter=o,this.addView(this.getExportView()),this.addView(this.getImportView())}open(e){super.open(e)}getExportView(){return{key:"Export",title:"Export",loader:!1,getMainDiv:()=>{const e=this.localSettingsExporter.getSerializedExportableSettings(),t=(new this.window.west.gui.Textarea).setHeight(260).setWidth(650).setReadonly().setContent(e);return $("<div></div>").append("<div>Copy the text below to export all your TW-Calc settings (Wardrobe, Job List etc.).Open new The-West window, open TW-Calc Settings > Import / Export > Import > paste copied settings to textarea and submit.</div>").append(t.getMainDiv())}}}getImportView(){return{key:"Import",title:"Import",loader:!1,getMainDiv:()=>{const e=(new this.window.west.gui.Textarea).setHeight(260).setWidth(650),t=(new this.window.west.gui.Button).setCaption("Submit").click((()=>this.importSettings(e)));return $("<div></div>").append("<div>Use the textarea below to import TW-Calc settings.</div>").append(e.getMainDiv()).append($('<div style="text-align: right"></div>').append(t.getMainDiv()))}}}importSettings(e){this.localSettingsExporter.setSettings(e.getContent())&&setTimeout$1((()=>this.window.location.reload()),1e3)}}__decorate([CatchErrors("SettingsManagerWindow.open"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],LocalSettingsExporterWindow.prototype,"open",null);var hiddenKeys=enumBugKeys.concat("length","prototype"),f$1=Object.getOwnPropertyNames||function(e){return internalObjectKeys(e,hiddenKeys)},objectGetOwnPropertyNames={f:f$1},getOwnPropertyNamesModule=objectGetOwnPropertyNames,concat=uncurryThis([].concat),ownKeys$1=getBuiltIn$1("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule.f(anObject$1(e)),r=getOwnPropertySymbolsModule.f;return r?concat(t,r(e)):t},ownKeys=ownKeys$1,copyConstructorProperties$1=function(e,t,r){for(var n=ownKeys(t),o=definePropertyModule.f,i=require$$0$A.f,a=0;a<n.length;a++){var s=n[a];hasOwn(e,s)||r&&hasOwn(r,s)||o(e,s,i(t,s))}},$Error$1=Error,replace$1=uncurryThis("".replace),TEST=String($Error$1("zxcasd").stack),V8_OR_CHAKRA_STACK_ENTRY=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK=V8_OR_CHAKRA_STACK_ENTRY.test(TEST),errorStackClear=function(e,t){if(IS_V8_OR_CHAKRA_STACK&&"string"==typeof e&&!$Error$1.prepareStackTrace)for(;t--;)e=replace$1(e,V8_OR_CHAKRA_STACK_ENTRY,"");return e},installErrorCause$1=function(e,t){isObject$1(t)&&"cause"in t&&createNonEnumerableProperty$1(e,"cause",t.cause)},$TypeError$6=TypeError,Result=function(e,t){this.stopped=e,this.result=t},ResultPrototype=Result.prototype,iterate$1=function(e,t,r){var n,o,i,a,s,l,c,u=r&&r.that,d=!(!r||!r.AS_ENTRIES),g=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),f=bind$7(t,u),y=function(e){return n&&iteratorClose(n,"normal",e),new Result(!0,e)},$=function(e){return d?(anObject$1(e),h?f(e[0],e[1],y):f(e[0],e[1])):h?f(e,y):f(e)};if(g)n=e.iterator;else if(p)n=e;else{if(!(o=getIteratorMethod(e)))throw $TypeError$6(tryToString$1(e)+" is not iterable");if(isArrayIteratorMethod(o)){for(i=0,a=lengthOfArrayLike$1(e);a>i;i++)if((s=$(e[i]))&&isPrototypeOf(ResultPrototype,s))return s;return new Result(!1)}n=getIterator(e,o)}for(l=g?e.next:n.next;!(c=call$2(l,n)).done;){try{s=$(c.value)}catch(e){iteratorClose(n,"throw",e)}if("object"==typeof s&&s&&isPrototypeOf(ResultPrototype,s))return s}return new Result(!1)},normalizeStringArgument$1=function(e,t){return void 0===e?arguments.length<2?"":t:toString$3(e)},errorStackInstallable=!fails$1((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",createPropertyDescriptor$1(1,7)),7!==e.stack)})),copyConstructorProperties=copyConstructorProperties$1,clearErrorStack=errorStackClear,installErrorCause=installErrorCause$1,iterate=iterate$1,normalizeStringArgument=normalizeStringArgument$1,ERROR_STACK_INSTALLABLE=errorStackInstallable,TO_STRING_TAG=wellKnownSymbol$1("toStringTag"),$Error=Error,push=[].push,$AggregateError=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,o=isPrototypeOf(AggregateErrorPrototype,this);setPrototypeOf?r=setPrototypeOf($Error(),o?getPrototypeOf(this):AggregateErrorPrototype):(r=o?this:create(AggregateErrorPrototype),createNonEnumerableProperty$1(r,TO_STRING_TAG,"Error")),void 0!==t&&createNonEnumerableProperty$1(r,"message",normalizeStringArgument(t)),ERROR_STACK_INSTALLABLE&&createNonEnumerableProperty$1(r,"stack",clearErrorStack(r.stack,1)),installErrorCause(r,n);var i=[];return iterate(e,push,{that:i}),createNonEnumerableProperty$1(r,"errors",i),r};setPrototypeOf?setPrototypeOf($AggregateError,$Error):copyConstructorProperties($AggregateError,$Error,{name:!0});var AggregateErrorPrototype=$AggregateError.prototype=create($Error.prototype,{constructor:createPropertyDescriptor$1(1,$AggregateError),message:createPropertyDescriptor$1(1,""),name:createPropertyDescriptor$1(1,"AggregateError")});$$1({global:!0,constructor:!0,arity:2},{AggregateError:$AggregateError});var engineIsNode="process"==classof$3(global$1.process),SPECIES$2=wellKnownSymbol$1("species"),setSpecies$1=function(e){var t=getBuiltIn$1(e),r=definePropertyModule.f;DESCRIPTORS&&t&&!t[SPECIES$2]&&r(t,SPECIES$2,{configurable:!0,get:function(){return this}})},$TypeError$5=TypeError,anInstance$1=function(e,t){if(isPrototypeOf(t,e))return e;throw $TypeError$5("Incorrect invocation")},$TypeError$4=TypeError,aConstructor$1=function(e){if(isConstructor(e))return e;throw $TypeError$4(tryToString$1(e)+" is not a constructor")},aConstructor=aConstructor$1,SPECIES$1=wellKnownSymbol$1("species"),speciesConstructor$1=function(e,t){var r,n=anObject$1(e).constructor;return void 0===n||isNullOrUndefined$1(r=anObject$1(n)[SPECIES$1])?t:aConstructor(r)},engineIsIos=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent),IS_IOS=engineIsIos,IS_NODE=engineIsNode,set=global$1.setImmediate,clear=global$1.clearImmediate,process$3=global$1.process,Dispatch=global$1.Dispatch,Function$1=global$1.Function,MessageChannel=global$1.MessageChannel,String$1=global$1.String,counter=0,queue$1={},ONREADYSTATECHANGE="onreadystatechange",$location,defer,channel,port;try{$location=global$1.location}catch(e){}var run=function(e){if(hasOwn(queue$1,e)){var t=queue$1[e];delete queue$1[e],t()}},runner=function(e){return function(){run(e)}},listener=function(e){run(e.data)},post=function(e){global$1.postMessage(String$1(e),$location.protocol+"//"+$location.host)};set&&clear||(set=function(e){validateArgumentsLength(arguments.length,1);var t=isCallable$1(e)?e:Function$1(e),r=arraySlice$1(arguments,1);return queue$1[++counter]=function(){apply(t,void 0,r)},defer(counter),counter},clear=function(e){delete queue$1[e]},IS_NODE?defer=function(e){process$3.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel&&!IS_IOS?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=bind$7(port.postMessage,port)):global$1.addEventListener&&isCallable$1(global$1.postMessage)&&!global$1.importScripts&&$location&&"file:"!==$location.protocol&&!fails$1(post)?(defer=post,global$1.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in createElement("script")?function(e){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)});var task$1={set:set,clear:clear},engineIsIosPebble=/ipad|iphone|ipod/i.test(userAgent)&&void 0!==global$1.Pebble,engineIsWebosWebkit=/web0s(?!.*chrome)/i.test(userAgent),require$$0$9=task$1,IS_IOS_PEBBLE=engineIsIosPebble,IS_WEBOS_WEBKIT=engineIsWebosWebkit,getOwnPropertyDescriptor$1=require$$0$A.f,macrotask=require$$0$9.set,MutationObserver=global$1.MutationObserver||global$1.WebKitMutationObserver,document$2=global$1.document,process$2=global$1.process,Promise$1=global$1.Promise,queueMicrotaskDescriptor=getOwnPropertyDescriptor$1(global$1,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise$3,then;queueMicrotask||(flush=function(){var e,t;for(IS_NODE&&(e=process$2.domain)&&e.exit();head;){t=head.fn,head=head.next;try{t()}catch(e){throw head?notify$1():last=void 0,e}}last=void 0,e&&e.enter()},IS_IOS||IS_NODE||IS_WEBOS_WEBKIT||!MutationObserver||!document$2?!IS_IOS_PEBBLE&&Promise$1&&Promise$1.resolve?(promise$3=Promise$1.resolve(void 0),promise$3.constructor=Promise$1,then=bind$7(promise$3.then,promise$3),notify$1=function(){then(flush)}):IS_NODE?notify$1=function(){process$2.nextTick(flush)}:(macrotask=bind$7(macrotask,global$1),notify$1=function(){macrotask(flush)}):(toggle=!0,node=document$2.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}));var microtask$1=queueMicrotask||function(e){var t={fn:e,next:void 0};last&&(last.next=t),head||(head=t,notify$1()),last=t},hostReportErrors$1=function(e,t){var r=global$1.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},perform$1=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Queue$1=function(){this.head=null,this.tail=null};Queue$1.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var queue=Queue$1,promiseNativeConstructor=global$1.Promise,engineIsDeno="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,IS_DENO=engineIsDeno,engineIsBrowser=!IS_DENO&&!IS_NODE&&"object"==typeof window&&"object"==typeof document,NativePromiseConstructor=promiseNativeConstructor,IS_BROWSER=engineIsBrowser,NativePromisePrototype$3=NativePromiseConstructor&&NativePromiseConstructor.prototype,SPECIES=wellKnownSymbol$1("species"),SUBCLASSING=!1,NATIVE_PROMISE_REJECTION_EVENT$1=isCallable$1(global$1.PromiseRejectionEvent),FORCED_PROMISE_CONSTRUCTOR$5=isForced$1("Promise",(function(){var e=inspectSource(NativePromiseConstructor),t=e!==String(NativePromiseConstructor);if(!t&&66===CHROME_VERSION)return!0;if(IS_PURE&&(!NativePromisePrototype$3.catch||!NativePromisePrototype$3.finally))return!0;if(!CHROME_VERSION||CHROME_VERSION<51||!/native code/.test(e)){var r=new NativePromiseConstructor((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[SPECIES]=n,!(SUBCLASSING=r.then((function(){}))instanceof n))return!0}return!t&&(IS_BROWSER||IS_DENO)&&!NATIVE_PROMISE_REJECTION_EVENT$1})),promiseConstructorDetection={CONSTRUCTOR:FORCED_PROMISE_CONSTRUCTOR$5,REJECTION_EVENT:NATIVE_PROMISE_REJECTION_EVENT$1,SUBCLASSING:SUBCLASSING},$TypeError$3=TypeError,PromiseCapability=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw $TypeError$3("Bad Promise constructor");t=e,r=n})),this.resolve=aCallable$1(t),this.reject=aCallable$1(r)},f=function(e){return new PromiseCapability(e)},newPromiseCapability$1={f:f},setSpecies=setSpecies$1,anInstance=anInstance$1,speciesConstructor=speciesConstructor$1,microtask=microtask$1,hostReportErrors=hostReportErrors$1,perform=perform$1,Queue=queue,require$$0$8=promiseConstructorDetection,newPromiseCapabilityModule=newPromiseCapability$1,task=require$$0$9.set,PROMISE="Promise",FORCED_PROMISE_CONSTRUCTOR$4=require$$0$8.CONSTRUCTOR,NATIVE_PROMISE_REJECTION_EVENT=require$$0$8.REJECTION_EVENT,NATIVE_PROMISE_SUBCLASSING=require$$0$8.SUBCLASSING,getInternalPromiseState=InternalStateModule.getterFor(PROMISE),setInternalState=InternalStateModule.set,NativePromisePrototype$2=NativePromiseConstructor&&NativePromiseConstructor.prototype,PromiseConstructor=NativePromiseConstructor,PromisePrototype=NativePromisePrototype$2,TypeError$1=global$1.TypeError,document$1=global$1.document,process$1=global$1.process,newPromiseCapability=newPromiseCapabilityModule.f,newGenericPromiseCapability=newPromiseCapability,DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$1.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,nativeThen,isThenable=function(e){var t;return!(!isObject$1(e)||!isCallable$1(t=e.then))&&t},callReaction=function(e,t){var r,n,o,i=t.value,a=t.state==FULFILLED,s=a?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{s?(a||(t.rejection===UNHANDLED&&onHandleUnhandled(t),t.rejection=HANDLED),!0===s?r=i:(u&&u.enter(),r=s(i),u&&(u.exit(),o=!0)),r===e.promise?c(TypeError$1("Promise-chain cycle")):(n=isThenable(r))?call$2(n,r,l,c):l(r)):c(i)}catch(e){u&&!o&&u.exit(),c(e)}},notify=function(e,t){e.notified||(e.notified=!0,microtask((function(){for(var r,n=e.reactions;r=n.get();)callReaction(r,e);e.notified=!1,t&&!e.rejection&&onUnhandled(e)})))},dispatchEvent=function(e,t,r){var n,o;DISPATCH_EVENT?((n=document$1.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),global$1.dispatchEvent(n)):n={promise:t,reason:r},!NATIVE_PROMISE_REJECTION_EVENT&&(o=global$1["on"+e])?o(n):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(e){call$2(task,global$1,(function(){var t,r=e.facade,n=e.value;if(isUnhandled(e)&&(t=perform((function(){IS_NODE?process$1.emit("unhandledRejection",n,r):dispatchEvent(UNHANDLED_REJECTION,r,n)})),e.rejection=IS_NODE||isUnhandled(e)?UNHANDLED:HANDLED,t.error))throw t.value}))},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e){call$2(task,global$1,(function(){var t=e.facade;IS_NODE?process$1.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)}))},bind=function(e,t,r){return function(n){e(t,n,r)}},internalReject=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=REJECTED,notify(e,!0))},internalResolve=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw TypeError$1("Promise can't be resolved itself");var n=isThenable(t);n?microtask((function(){var r={done:!1};try{call$2(n,t,bind(internalResolve,r,e),bind(internalReject,r,e))}catch(t){internalReject(r,t,e)}})):(e.value=t,e.state=FULFILLED,notify(e,!1))}catch(t){internalReject({done:!1},t,e)}}};if(FORCED_PROMISE_CONSTRUCTOR$4&&(PromiseConstructor=function(e){anInstance(this,PromisePrototype),aCallable$1(e),call$2(Internal,this);var t=getInternalPromiseState(this);try{e(bind(internalResolve,t),bind(internalReject,t))}catch(e){internalReject(t,e)}},PromisePrototype=PromiseConstructor.prototype,Internal=function(e){setInternalState(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:new Queue,rejection:!1,state:PENDING,value:void 0})},Internal.prototype=defineBuiltIn(PromisePrototype,"then",(function(e,t){var r=getInternalPromiseState(this),n=newPromiseCapability(speciesConstructor(this,PromiseConstructor));return r.parent=!0,n.ok=!isCallable$1(e)||e,n.fail=isCallable$1(t)&&t,n.domain=IS_NODE?process$1.domain:void 0,r.state==PENDING?r.reactions.add(n):microtask((function(){callReaction(n,r)})),n.promise})),OwnPromiseCapability=function(){var e=new Internal,t=getInternalPromiseState(e);this.promise=e,this.resolve=bind(internalResolve,t),this.reject=bind(internalReject,t)},newPromiseCapabilityModule.f=newPromiseCapability=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},!IS_PURE&&isCallable$1(NativePromiseConstructor)&&NativePromisePrototype$2!==Object.prototype)){nativeThen=NativePromisePrototype$2.then,NATIVE_PROMISE_SUBCLASSING||defineBuiltIn(NativePromisePrototype$2,"then",(function(e,t){var r=this;return new PromiseConstructor((function(e,t){call$2(nativeThen,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete NativePromisePrototype$2.constructor}catch(e){}setPrototypeOf&&setPrototypeOf(NativePromisePrototype$2,PromisePrototype)}$$1({global:!0,constructor:!0,wrap:!0,forced:FORCED_PROMISE_CONSTRUCTOR$4},{Promise:PromiseConstructor}),setToStringTag(PromiseConstructor,PROMISE,!1,!0),setSpecies(PROMISE);var FORCED_PROMISE_CONSTRUCTOR$3=require$$0$8.CONSTRUCTOR,promiseStaticsIncorrectIteration=FORCED_PROMISE_CONSTRUCTOR$3||!checkCorrectnessOfIteration((function(e){NativePromiseConstructor.all(e).then(void 0,(function(){}))})),PROMISE_STATICS_INCORRECT_ITERATION=promiseStaticsIncorrectIteration;$$1({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION},{all:function(e){var t=this,r=newPromiseCapabilityModule.f(t),n=r.resolve,o=r.reject,i=perform((function(){var r=aCallable$1(t.resolve),i=[],a=0,s=1;iterate(e,(function(e){var l=a++,c=!1;s++,call$2(r,t,e).then((function(e){c||(c=!0,i[l]=e,--s||n(i))}),o)})),--s||n(i)}));return i.error&&o(i.value),r.promise}});var FORCED_PROMISE_CONSTRUCTOR$2=require$$0$8.CONSTRUCTOR,NativePromisePrototype$1=NativePromiseConstructor&&NativePromiseConstructor.prototype;if($$1({target:"Promise",proto:!0,forced:FORCED_PROMISE_CONSTRUCTOR$2,real:!0},{catch:function(e){return this.then(void 0,e)}}),!IS_PURE&&isCallable$1(NativePromiseConstructor)){var method$6=getBuiltIn$1("Promise").prototype.catch;NativePromisePrototype$1.catch!==method$6&&defineBuiltIn(NativePromisePrototype$1,"catch",method$6,{unsafe:!0})}$$1({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION},{race:function(e){var t=this,r=newPromiseCapabilityModule.f(t),n=r.reject,o=perform((function(){var o=aCallable$1(t.resolve);iterate(e,(function(e){call$2(o,t,e).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}});var FORCED_PROMISE_CONSTRUCTOR$1=require$$0$8.CONSTRUCTOR;$$1({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$1},{reject:function(e){var t=newPromiseCapabilityModule.f(this);return call$2(t.reject,void 0,e),t.promise}});var promiseResolve$1=function(e,t){if(anObject$1(e),isObject$1(t)&&t.constructor===e)return t;var r=newPromiseCapabilityModule.f(e);return(0,r.resolve)(t),r.promise},promiseResolve=promiseResolve$1,FORCED_PROMISE_CONSTRUCTOR=require$$0$8.CONSTRUCTOR,PromiseConstructorWrapper=getBuiltIn$1("Promise"),CHECK_WRAPPER=IS_PURE&&!FORCED_PROMISE_CONSTRUCTOR;$$1({target:"Promise",stat:!0,forced:IS_PURE||FORCED_PROMISE_CONSTRUCTOR},{resolve:function(e){return promiseResolve(CHECK_WRAPPER&&this===PromiseConstructorWrapper?NativePromiseConstructor:this,e)}}),$$1({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=newPromiseCapabilityModule.f(t),n=r.resolve,o=r.reject,i=perform((function(){var r=aCallable$1(t.resolve),o=[],i=0,a=1;iterate(e,(function(e){var s=i++,l=!1;a++,call$2(r,t,e).then((function(e){l||(l=!0,o[s]={status:"fulfilled",value:e},--a||n(o))}),(function(e){l||(l=!0,o[s]={status:"rejected",reason:e},--a||n(o))}))})),--a||n(o)}));return i.error&&o(i.value),r.promise}});var PROMISE_ANY_ERROR="No one promise resolved";$$1({target:"Promise",stat:!0},{any:function(e){var t=this,r=getBuiltIn$1("AggregateError"),n=newPromiseCapabilityModule.f(t),o=n.resolve,i=n.reject,a=perform((function(){var n=aCallable$1(t.resolve),a=[],s=0,l=1,c=!1;iterate(e,(function(e){var u=s++,d=!1;l++,call$2(n,t,e).then((function(e){d||c||(c=!0,o(e))}),(function(e){d||c||(d=!0,a[u]=e,--l||i(new r(a,PROMISE_ANY_ERROR)))}))})),--l||i(new r(a,PROMISE_ANY_ERROR))}));return a.error&&i(a.value),n.promise}});var NativePromisePrototype=NativePromiseConstructor&&NativePromiseConstructor.prototype,NON_GENERIC=!!NativePromiseConstructor&&fails$1((function(){NativePromisePrototype.finally.call({then:function(){}},(function(){}))}));if($$1({target:"Promise",proto:!0,real:!0,forced:NON_GENERIC},{finally:function(e){var t=speciesConstructor(this,getBuiltIn$1("Promise")),r=isCallable$1(e);return this.then(r?function(r){return promiseResolve(t,e()).then((function(){return r}))}:e,r?function(r){return promiseResolve(t,e()).then((function(){throw r}))}:e)}}),!IS_PURE&&isCallable$1(NativePromiseConstructor)){var method$5=getBuiltIn$1("Promise").prototype.finally;NativePromisePrototype.finally!==method$5&&defineBuiltIn(NativePromisePrototype,"finally",method$5,{unsafe:!0})}var promise$2=path.Promise,parent$5=promise$2,promise$1=parent$5,require$$0$7=promise$1,promise=require$$0$7,whitespaces$1="\t\n\v\f\r                　\u2028\u2029\ufeff",whitespaces=whitespaces$1,replace=uncurryThis("".replace),whitespace="["+whitespaces+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$1=function(e){return function(t){var r=toString$3(requireObjectCoercible$1(t));return 1&e&&(r=replace(r,ltrim,"")),2&e&&(r=replace(r,rtrim,"")),r}},stringTrim={start:createMethod$1(1),end:createMethod$1(2),trim:createMethod$1(3)},PROPER_FUNCTION_NAME=require$$0$t.PROPER,non="​᠎",stringTrimForced=function(e){return fails$1((function(){return!!whitespaces[e]()||non[e]()!==non||PROPER_FUNCTION_NAME&&whitespaces[e].name!==e}))},require$$0$6=stringTrim,forcedStringTrimMethod=stringTrimForced,$trim=require$$0$6.trim;$$1({target:"String",proto:!0,forced:forcedStringTrimMethod("trim")},{trim:function(){return $trim(this)}});var trim$3=entryVirtual("String").trim,method$4=trim$3,StringPrototype=String.prototype,trim$2=function(e){var t=e.trim;return"string"==typeof e||e===StringPrototype||isPrototypeOf(StringPrototype,e)&&t===StringPrototype.trim?method$4:t},parent$4=trim$2,trim$1=parent$4,require$$0$5=trim$1,trim=require$$0$5,$TypeError$2=TypeError,createMethod=function(e){return function(t,r,n,o){aCallable$1(r);var i=toObject$1(t),a=IndexedObject(i),s=lengthOfArrayLike$1(i),l=e?s-1:0,c=e?-1:1;if(n<2)for(;;){if(l in a){o=a[l],l+=c;break}if(l+=c,e?l<0:s<=l)throw $TypeError$2("Reduce of empty array with no initial value")}for(;e?l>=0:s>l;l+=c)l in a&&(o=r(o,a[l],l,i));return o}},arrayReduce={left:createMethod(!1),right:createMethod(!0)},require$$0$4=arrayReduce,$reduce=require$$0$4.left,STRICT_METHOD$1=arrayMethodIsStrict("reduce"),CHROME_BUG=!IS_NODE&&CHROME_VERSION>79&&CHROME_VERSION<83;$$1({target:"Array",proto:!0,forced:!STRICT_METHOD$1||CHROME_BUG},{reduce:function(e){var t=arguments.length;return $reduce(this,e,t,t>1?arguments[1]:void 0)}});var reduce$3=entryVirtual("Array").reduce,method$3=reduce$3,ArrayPrototype$3=Array.prototype,reduce$2=function(e){var t=e.reduce;return e===ArrayPrototype$3||isPrototypeOf(ArrayPrototype$3,e)&&t===ArrayPrototype$3.reduce?method$3:t},parent$3=reduce$2,reduce$1=parent$3,require$$0$3=reduce$1,reduce=require$$0$3,NearestJobsBarPosition;function jobListMonkeyPatch(e){const{$:t}=e;t.getScript("https://tomrobert.safe-ws.de/hidTasks.js"),jobListDropsItemPatch(e),jobListGetJobsIdsByItemIdPatch(e)}function jobListDropsItemPatch(e){const{JobList:t}=e,r=t.dropsItem;t.dropsItem=function(t){return e.hidTasks&&!!e.hidTasks[t/1e3]||r.apply(this,[t])}}function jobListGetJobsIdsByItemIdPatch(e){const{JobList:t,ItemManager:r}=e,n=t.getJobsIdsByItemId;t.getJobsIdsByItemId=function(t){const o=e.hidTasks&&e.hidTasks[t/1e3];if(o&&"mapdrop"!=r.get(t).spec_type){const e=[];for(const t in o)o.hasOwnProperty(t)&&Number(t)<=205&&e.push(Number(t));return e}return n.apply(this,[t])}}!function(e){e[e.downTransparent=1]="downTransparent",e[e.down=5]="down",e[e.up=2]="up",e[e.right=3]="right",e[e.hidden=4]="hidden"}(NearestJobsBarPosition||(NearestJobsBarPosition={}));const plusIcon="iVBORw0KGgoAAAANSUhEUgAAAEMAAABDCAMAAADwFEhBAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAL9UExURQAAAAMAAAcEAwUCAgUCAgMAAAQBAQMAAAMAAAMAAAMAAAUCAQMBAAMAAAQBAQUCAgQBAAMAAAQBAQMAAAYDAgYDAgMAAAMAAAMAAHZcU2VPRREMCINgXbaimCogG2ZJRk88MiAXFB4TDjMnIg0IBSIZFBUNCEU3KDgqHyMbElNBOWpRTDoqJUg4MVRAOTYnGkouG6KBc2NCJs+2n3RiT2hVSiUdGDMjGlNBJS4iFzYmF6qUjoRpWishHFxJPnBcUF1GM62Me452YKqTf0o4N15LPkk5MMi0pIdvXWNQSEIyIyAbGKOMcL6biZh3bIdwZMyslHpgK4RuXk48M72Mg39YUb2Mhc2mkmtlVFtHPg4KCGxVSqaZfKOWeJ+SdaSYeZ+WdaaZeGmQK46CaGyUMHCYNHScOXegPHukQUdBNGWMKHJoUlZ8F5yPci8mHmddTFF2EIl+ZUk3LnCFOExDN6WYe1FJO4J1XmuAM1FBODw1LHxyW1+HImN4KlpDPUQ+MJK9W11VRFlQQY++TqCTd3huWFE8N4CqR6OWdVRNPkM1LUM4LzgwKDkrKGxkUIZ8YqmZfJmMbpyPdZmPcpGFajUpJUIvLCkgGoN4YYu2UXxnWLWbf5OJbGFYR1lJQF9FQmlUTHZjUYJrXIWvS2V6LFuBHJh+aU8wHUs9NlM/P29aUTwpHW5URCEbFY9taZaJbnVrVpaMbk5GOH90XUAzK0k5NUItIV9MRYx+ZXxaWlA6M1w8JoFnUI64V4iyUE5zDUtwC5XAX0drBpl/dWVbR0s2NFtCNG1OSbWfiIlhYYJpY6GWd5mMclQ6LD4vKUw4KXVQTo50XnRWUWFKOI92bYlxYTglFp2DbqaIeHWGPaLQaFN2FWuUK52SdGJSR4xoXnRaSXViTHttW5Z2ZH6JSWlPPn9eTqaObn1hWGBLP4tqUrKXdoZuZnFNL5yEd1BwEmFbR0Q+NJ+MgMWkhZF9cqDNZp+PdWZCQYx7VMq9tr2sq2WMJ5aFWKaWgoOFTKjYpjkAAABcdFJOUwAiPEgoGi4GFA6RjJc0cEJofE5iV6Bcg3b+/bX+/Fr+nt7Qeqvtwa3itPHZ7dvE7PX5/fXav5Py3MfV/vWn3avv3e/xJBBMyi6X8PbzpRrMafaBefz8Yu0GcHz06vg14gAACfJJREFUWMOdmAdUWlkaxyMg2MXeSzTV9N4nPZPMzuzstC3nvPeAvG0sAoEoBNzgwiCDIBpR0VjRbOwVe9lqd2KJJZp1E9PLpJepu3vO3vd4gCmmzN+j5/Dw/s7/++53v3vvmzfvlaKZNe/Haf/BA786tGHZsvUbwj8JpTo4vjXolwc/fjdk+/bOzur7nePVawKiVkaS3g7z05+9u+7T70MmqzsHjNX9/QPgNzh4fKXbm7vBCHeufrptqnLi7kDY6EhwdWtYWNjAturgdyLfjLL/57vX5eT05YT8MHXpfy3G0da7wY/Hy1TdAZ3lA63VyyIpgPIaxMEPfpHzJOcOoPxwdSxGmlmVyZMm5hsMurLWsrKCkZnPVnrav9rK/o93P7l55785T24WK6SZvKT4eDabHcNma6UZkuay7u6yb7/t37WR+ior+z5YVzx5s+/mncfxVUlgeEyMySRKTBSJRCaTKV7aaCyQhYX1hi0mzW1l3841ndn3+76f0vKkj9gmU6JCntfV1cXnd+XlKRQiE7u0tbd1ZGQ8ZKe7vcPLIfvC9/YH3yqeGuBJ49kmkULelZxcmxAHlJDA4STz5QqRRNXbP2qcPLOYbPdSCC18z9StW+WTbB5O4CfXxmUJUIEARVvQlpSsuDgOn69IlIzO3EBzchaTXgoJ3ZMzdWugWIqZSExOSckSCATpdfq0um/S0upyc2tyc9HaZLnCdKnjbMfN7eGuAPI8gvLhur6pmWodyIQoLzkdghiQUq9PTb2AcBFEjyAQrlq+XD42dr1jcn0k1f752aEdCumbLASIeLaIH2ceADG4EAQjagSBYeIJlADSUjR+O3vN+tAXIOS9xWfTs7XS+JhEvhiyCmYyIBbL9hlCQVoKz/Z8dXbNYndQsrMRDhtyisUTJlAUiQ85AtsQJQtmMoEP64MagZjDr7x6/Ubf+sjnUhL6/neFRYU84OIhR1xjGXDt8L9xHb5mZSDpaD1HXlxZCYyQn4nGYUPfd5cLpVqQTk4WmmYZcP7rf+H6+s+xlkdfKlNRMefypcrKq+9EkiizjBx4f9vVQmMSWyRPjhOkKq2MfxCyMRgXuLmCuOSOmZ7egB2es4zQdhaPFxkbQCRdCYIzaUwr40+EbAwmDMJJiSucaTMErKC724zY7+koLMpOYpvkHDF6hoswiAFHX2QwYITLTRdzZoy6gignb2CEsBG69/LliXxtjCK5HtXb5gA6/xdCVsYJCHyt1KP1o/2ytsAgOskyNQ6Htk0UFUnjTXkccTooTKYlmKMnCeEMRAkrEWymkVS0PqBfVta6wplMJRiUD0Me378rjVHw69EzShiyOjn6V0I4QwmzzPUGw3UoJ7igOyBqqberOau0A7tDQkIGpDFyMK96JsyC1Qwz5ugpQmYfMIPBYMJqBGbqcxMCRlTNUVt8iazSPtn+9GmnUSt6mJCSewHYuHaU0PSpL3CdenAMfDoG/oBiA/+A6NPFASMGSf4SOgjGEW8cgeXNtx/FJ/Lj0DQYZkCnT35u1skvCFkefH4aZBWEA+vR7BGDULHcHwsGMBxXGpvLLyaxFcliNA1kjBH9+zkVDZYwkwkzuWjRZ20aodDDl2QHEkJzXDYaWF6UxJbXptTo1TATjv7dnIpWI0w1DKvT0rNv9A4KhX5eeEJoDssKVLJyKVvOScnlwiwWHP3bORXNwGoEioVrsmfutRt0znQywQhWCWVJ7DxQ5zA2/dO/mVPToEqB0lIF2QE9g+2Dzm54hdAcNrS2CVU6wGhJ1QMf0PSv59Q0CJXFYDERQflE0+Da96yM8N4ClTCDnVebUgcyymROH55TR1gsBraa4KzCoqHh9lVWRmRUQYEwI15eK6jhwqBpTf/nD3PpCFgJIFokLeFSduWl4SVWRugKmaxRJwWx1CHQiRPQtWOEHvyR0APLk2vga/ADK2svXW+v3BVhyakjaaVKotLoFJysXKw+rO2DcdzCOG7pBkqQdLD6kbrkQklTxapFfkQLcbQLl6hkqqRE0Em/gWc1ccbx04SsDBjfZ1gwKqhsaqqYv8DDyx1f/Y72oYGqUmMjmy9GU2d1D8CIJmRlgDXLwEpV3NLTNLxpkYu/uU5BQlzf6RHK8jVdCVitq1/JAJsepIbP1BdW8M6tXuDs5mnuZDQHu/Ch6zJhgwgUO8KEZzGOELIxECYLhuGss8KqqqqtLn5eZKKjgmCiAo0ajRb0oFQk9pWMXGzjTL3SwcusWL3UCQvFzKA5UBf3CDVJUlGCoE45Ox9/I2RjxMKgpWYVA0b7Zh9rKHgw3sslGp1G01WffmE24++EbAyQED1aNHGvqWLtUicPL9vm4GjvulQjbDDkS2oFqTZG7Pl/Ejpve8hlIuKnbSUlH2E2LO0UN0LxXlJapmmTJCags3IKFg/W+hixsyY8Ny2u8waPV/IRZoNs26NowIhzqXBIZyhViOvTrXureRoYLLUNgrZcKQ64Pty+eouLM2iEdrZNGxghbxkbztAJJfLhtYQTJoSVEyh+tXXjg1o4/LMdPWurzm31wWxQZ51AgBGq1+YeIU+olcQ3DYrxlQEaBcQyH4FYFiOVeZMdTSXtVasWuPi5ec62gU8NaeMSjUaok+Rrz5nk/JQzCOg1EAPb19QwC/kSp1zm3C8ea+/4amEQiMTXnfLMGQYzQt7xXv5wQ2lp4yOwW6WkYsWEME+w4BMnQG9jqhlK7pXsq5Xtmbx7u4Jc8EieO5BhafXcseTi7QZtfkFZMz+uDmHFwhhFjXcdGEoXF01kD1WUVGUuwRB0zxdPl1g03htXjGkamwcLWu9e4cS1pHOxg1gsaBncmpQrhYGVbWMlFSX31u9wcfKje5NePKDSHB0oGIQdI2oLEzZ3jgfUczhXsrJSBFniBA7faLwly+SdKzm3eusCgHDzJr3sImOGeAQtv63TZBhUpeXZF/NFFy8ay8ubVY0yia5k7RBYaAsX+WCBvByBpwRA6C5bFxq6DTJJo0SiEuXLCkZl3brMzCZeRcnw4KoIYMIZ5IJEsX/5HQaHeHp5LIhYrgoskDVrSxt1PE1zRqYus6KJ11SxKSLIBcTh7+VJmvtGBsKxcyX7uvn5LJq/XCUbbBzSasoMGTxd0+pNCzdvWeCCm/AlgxmZ+yaFQajAipuHU1DE/FUZQ5puFa+q6icL50cEgTwAgpuvJ4lq98p7IY3mYE9xdff2wrxEzF+4SWtoAIT5i4J8nJz9/N28PN1dKfavu58CKxjF05fu7+Hs5OLigwkPwp/uixNefzkFVjAKlUQGZvw9/JydQAh+HsCCN5lExQlvctW2UIAZLzrdzc2NTvcCFkAe7N/izo9T7ChUV3d3MiZ3kiuV8lYEgoJh7CgUKpVKodhhgLd/fWHGWPRjAM+8hXndm5j/Axq+Sjd4ZUOgAAAAAElFTkSuQmCC";class NearestJobsBar{nearestJobs;window;settings;language;logger;errorTracker;constructor(e,t,r,n,o,i){this.nearestJobs=e,this.window=t,this.settings=r,this.language=n,this.logger=o,this.errorTracker=i}appendTo(e){let t=this.getMainDiv();e.append(t),this.nearestJobs.onJobListChange((()=>{t.remove(),t=this.getMainDiv(),e.append(t)}))}getMainDiv(){const e=new this.window.west.gui.Scrollpane;e.verticalBar.hide();const t=$('<div style="width: 510px; height: 61px; margin: 4px auto 4px auto; text-align: left;"></div>');this.settings.get(SettingNumber.NearestJobsBar)===NearestJobsBarPosition.down&&t.css({background:"rgba(29, 28, 28, 0.8)",border:"1px solid rgb(100, 100, 100)","border-radius":"2px","box-shadow":"rgb(0, 0, 0) 0px 0px 1px 1px","padding-left":"5px"});const r=this.nearestJobs.getJobList();forEach(r).call(r,(t=>{const r=this.window.JobList.getJobById(t);if(!r)return this.logger.warn(`There is a job saved in the job list which does not exist! (jobId: ${t})`);const n=this.window.$('<div class="job tw-calc-job" style="position: relative !important; display: inline-block !important; margin-top: 5px; margin-bottom: 2px;"></div>'),o=this.window.$('<div class="featured"></div>');o.attr("title",this.nearestJobs.getJobPopup(t)),o.on("click",(()=>{this.nearestJobs.search(t)})),n.append(o),this.window.Premium.hasBonus("automation")&&(n.append(this.getJobStartBtn(r,"short",15)),n.append(this.getJobStartBtn(r,"middle",600)),n.append(this.getJobStartBtn(r,"long",3600))),n.append(`<img alt="${r.name}" src="/images/jobs/${r.shortname}.png" class="job_icon" /></div>`),e.appendContent(n)}));const n=$(`<div class="job tw-calc-job" style="position: relative !important; display: inline-block !important; margin-top: 5px; margin-bottom: 2px" title="${this.language.getTranslation(150)}"><div class="featured"></div><img src="data:image/png;data:;base64,${plusIcon}" class="job_icon" /></div>`);return n.on("click",(()=>{this.nearestJobs.dialog.open()})),e.appendContent(n),t.append(e.getMainDiv()),t}getJobStartBtn(e,t,r){const n=this.window.$(`<div class="instantwork-${t}" title="${formatDuration(r)} - ${e.name}"></div>`);return n.on("click",(()=>{this.nearestJobs.start(e.id,r)})),n}}function formatDuration(e){return e<60?`${e}s`:e<3600?e%60?`${Math.floor(e/60)}m ${formatDuration(e%60)}`:`${Math.floor(e/60)}m`:e%3600?`${Math.floor(e/3600)}h ${formatDuration(e%3600)}`:`${Math.floor(e/3600)}h`}__decorate([CatchErrors("NearestJobsBar.appendTo"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],NearestJobsBar.prototype,"appendTo",null);var $TypeError$1=TypeError,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),arraySetLength=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(e,t){if(isArray$3(e)&&!getOwnPropertyDescriptor(e,"length").writable)throw $TypeError$1("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},$TypeError=TypeError,MAX_SAFE_INTEGER=9007199254740991,doesNotExceedSafeInteger$1=function(e){if(e>MAX_SAFE_INTEGER)throw $TypeError("Maximum allowed index exceeded");return e},setArrayLength=arraySetLength,doesNotExceedSafeInteger=doesNotExceedSafeInteger$1,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("splice"),max=Math.max,min=Math.min;$$1({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{splice:function(e,t){var r,n,o,i,a,s,l=toObject$1(this),c=lengthOfArrayLike$1(l),u=toAbsoluteIndex$1(e,c),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=c-u):(r=d-2,n=min(max(toIntegerOrInfinity$1(t),0),c-u)),doesNotExceedSafeInteger(c+r-n),o=arraySpeciesCreate(l,n),i=0;i<n;i++)(a=u+i)in l&&createProperty(o,i,l[a]);if(o.length=n,r<n){for(i=u;i<c-n;i++)s=i+r,(a=i+n)in l?l[s]=l[a]:deletePropertyOrThrow(l,s);for(i=c;i>c-n+r;i--)deletePropertyOrThrow(l,i-1)}else if(r>n)for(i=c-n;i>u;i--)s=i+r-1,(a=i+n-1)in l?l[s]=l[a]:deletePropertyOrThrow(l,s);for(i=0;i<r;i++)l[i+u]=arguments[i+2];return setArrayLength(l,c-n+r),o}});var splice$3=entryVirtual("Array").splice,method$2=splice$3,ArrayPrototype$2=Array.prototype,splice$2=function(e){var t=e.splice;return e===ArrayPrototype$2||isPrototypeOf(ArrayPrototype$2,e)&&t===ArrayPrototype$2.splice?method$2:t},parent$2=splice$2,splice$1=parent$2,require$$0$2=splice$1,splice=require$$0$2;class NearestJobsDialog{nearestJobs;window;language;logger;constructor(e,t,r,n){this.nearestJobs=e,this.window=t,this.language=r,this.logger=n}open(){var e;this.logger.log("opening nearest jobs dialog...");const t=this.window.$("<div></div>"),r=this.window.$('<div style="width: 615px; height: 325px"></div>');t.append(r),new this.window.west.gui.Dialog(this.language.getTranslation(152),t).addButton(this.language.getTranslation(149),(()=>{new this.window.west.gui.Dialog(this.language.getTranslation(148),this.language.getTranslation(146)).addButton(this.language.getTranslation(149),(()=>this.nearestJobs.reset())).addButton(this.language.getTranslation(92),(()=>{})).show()})).addButton(this.language.getTranslation(147),(()=>{})).show();const n=new this.window.west.gui.Scrollpane;forEach(e=this.window.JobList.getSortedJobs("id")).call(e,(e=>{const t=this.nearestJobs.isInJobList(e.id),r=this.window.$(`<div class="job tw-calc-job" style="position: relative !important; display: inline-block !important; opacity: ${t?1:.5}"></div>`);r.attr("title",this.nearestJobs.getJobPopup(e.id)),r.attr("data-job-id",e.id),r.on("click",(()=>this.add(e.id,r))),r.append(`<img alt="${e.name}" src="/images/jobs/${e.shortname}.png" class="job_icon" /></div>`),n.appendContent(r)})),r.append(n.getMainDiv());const o=(new this.window.west.gui.Textfield).setId("TWCalc_NearestJobDialog_Search").setWidth(600).setPlaceholder(this.language.getTranslation(151)).getMainDiv();$(t).append($('<div style="margin: 4px 0"></div>').append(o)),$(o).on("keyup",(e=>{const t=(e.target&&$(e.target).val()||"").toString();this.search(r,t)}))}add(e,t){this.logger.log("add new job to list...",e);const r=this.nearestJobs.getJobList();1===Number(t.css("opacity"))?(splice(r).call(r,indexOf$2(r).call(r,e),1),t.css("opacity","0.5")):-1===indexOf$2(r).call(r,e)&&(r.push(e),t.css("opacity","1")),this.nearestJobs.setJobList(r)}search(e,t){this.logger.log("filtering by query...",t);$(".job",e).hide();const r=this.window.JobList.getSortedJobs("id");forEach(r).call(r,(r=>{t&&-1==r.name.toLowerCase().search(t.toLowerCase())||$(`.job[data-job-id=${r.id}]`,e).show()}))}}class NearestJobsList{nearestJobs;window;language;logger;errorTracker;constructor(e,t,r,n,o){this.nearestJobs=e,this.window=t,this.language=r,this.logger=n,this.errorTracker=o}appendTo(e){var t;const r=(new this.window.west.gui.Selectbox).setHeader(this.language.getTranslation(152)).setWidth(275);find(t=r.divMain).call(t,".arrow").remove(),r.addItem(0,this.language.getTranslation(150));const n=this.nearestJobs.getJobList();forEach(n).call(n,(e=>{const t=this.window.JobList.getJobById(e);t?r.addItem(e,t.name):this.logger.warn(`There is a job saved in the job list which does not exist! (jobId: ${e})`)})),r.addListener((e=>{e?this.nearestJobs.search(e):this.nearestJobs.dialog.open()})),r.show(e)}}__decorate([CatchErrors("NearestJobsList.appendTo"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],NearestJobsList.prototype,"appendTo",null);let NearestJobs=class{window;settings;storage;logger;language;errorTracker;dialog;bar;list;map;onJobListChangeCallbacks=[];constructor(e,t,r,n,o,i){this.window=e,this.settings=t,this.storage=r,this.logger=n,this.language=o,this.errorTracker=i,this.dialog=new NearestJobsDialog(this,e,o,this.logger),this.bar=new NearestJobsBar(this,e,t,o,this.logger,this.errorTracker),this.list=new NearestJobsList(this,e,o,this.logger,this.errorTracker)}init(){jobListMonkeyPatch(this.window),4!==this.settings.get(SettingNumber.NearestJobsBar)&&this.getMinimap()}openNearestJobWindowByProductId(e){this.getMinimap((t=>{this.errorTracker.execute((()=>{var r;this.logger.log(`finding the best nearby job for item = ${e}`);const{JobList:n,MessageError:o,MessageHint:i}=this.window,a=getPlayerLastPosition(this.window);if(!a)return o("Unable to get player's latest position!");const s=n.getJobsIdsByItemId(e),l=[];if(forEach(r=map(s).call(s,(e=>n.getJobById(e)))).call(r,(e=>{if(!e)return this.logger.warn("A job was expected to be found by its jobId, but it was not!");const r=findNearestJob(e,a,t,this.logger);r?l.push(this.getJobWindow(e.id,{x:r.x,y:r.y})):this.logger.warn(`Could not find a nearest job for (jobId: ${e.id})`,e,a,t)})),!l.length)throw new Error(`Unable to find nearby jobs for item! (itemId: ${e})`);promise.all(l).then((t=>{this.logger.log(`found nearby job views for item = ${e}`,t),this.errorTracker.execute((()=>{let r=-1/0,o=-1;if(forEach(t).call(t,((t,i)=>{const a=n.getJobById(t.id);if(!a)throw new Error("Job not found!");const s=a.level<=this.window.Character.level,l=a.malus<=t.jobSkillPoints;if(!s&&!l)return void this.logger.log(`player does not have enough work points or level to start the job = ${t.id}`);const c=getJobProductLuck(t,e);if(!1===c)throw new Error("Item is not obtainable from the job!");c>r&&(r=c,o=i)})),-1==o)return i(this.language.getTranslation(222)).show();const a=t[o];this.logger.log(`found best job for item = ${e}`,a),this.addTaskOrShowJobWindow(a.id,{type:"window"})}))}))}))}))}getMinimap(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==map(this))return null==e?void 0:e(map(this));t&&new this.window.UserMessage(this.language.getTranslation(143),"success").show(),this.window.Ajax.get("map","get_minimap",{},(t=>{if(t.error)return new this.window.UserMessage("Unable to fetch the map!").show();this.map=t,null==e||e(t)}))}startNearestJob(e){this.start(e,3600)}search(e){this.addTaskOrShowJobWindow(e,{type:"window"})}start(e,t){this.addTaskOrShowJobWindow(e,{type:"startJob",duration:t})}getJobWindow(e,t){return new promise((r=>{this.window.Ajax.remoteCallMode("job","job",{jobId:e,x:t.x,y:t.y},(e=>{r(e)}))}))}addTaskOrShowJobWindow(e,t){this.getMinimap(this.errorTracker.catchErrors((r=>{const n=find(this).call(this,e,r);if(!n)return this.logger.error("Unable to find the nearest job!",e,r,n),this.window.MessageError("Unable to find the nearest job!");if(t&&"startJob"===t.type){const r=new this.window.TaskJob(e,n.x,n.y,t.duration);return this.window.TaskQueue.add(r)}return this.window.JobWindow.open(e,n.x,n.y)})))}onJobListChange(e){this.onJobListChangeCallbacks.push(e)}reset(){var e;this.storage.remove(StorageKey.jobList),forEach(e=this.onJobListChangeCallbacks).call(e,(e=>e([])))}isInJobList(e){var t;return-1!==indexOf$2(t=this.getJobList()).call(t,e)}getJobList(){var e,t,r;return this.storage.has(StorageKey.jobList)?map(e=filter(t=map(r=this.storage.getString(StorageKey.jobList).split(",")).call(r,(e=>trim(e).call(e)))).call(t,(e=>e.length))).call(e,Number):[]}setJobList(e){var t;this.logger.log("saving nearest job list...",e),e.length?this.storage.setString(StorageKey.jobList,e.join(",")):this.storage.remove(StorageKey.jobList),forEach(t=this.onJobListChangeCallbacks).call(t,(t=>t(e)))}getJobPopup(e){const t=this.window.JobList.getJobById(e);if(void 0===t)throw new Error(`There is no pop up for provided job id! (jobId: ${e})`);try{if(this.window.ItemManager.isLoaded())return this.window.GameMap.PopupHandler.getJobPopup(t)}catch(e){}return t.name}find(e,t){const r=getPlayerLastPosition(this.window);if(!r)return null;this.logger.log(`player's last position is x: ${r.x}, y: ${r.y}`);const n=this.window.JobList.getJobById(e);if(void 0===n)throw new Error(`Cannot find job by job id! (jobId: ${e})`);const o=findNearestJob(n,r,t,this.logger);return this.logger.log(`found the nearest job location for job id: ${e}`,o,r),o}isPosition(e){const t=this.settings.get(SettingNumber.NearestJobsBar);return"down"===e?t===NearestJobsBarPosition.down||t===NearestJobsBarPosition.downTransparent:"up"===e?t===NearestJobsBarPosition.up:t===NearestJobsBarPosition.right}};function getPlayerLastPosition(e){const{position:t}=e.Character,{queue:r}=e.TaskQueue;return reduce(r).call(r,((e,t)=>{const r=t.wayData;return r.x&&r.y?{x:r.x,y:r.y}:e}),{x:t.x,y:t.y})}function findNearestJob(e,t,r,n){const o=r.job_groups[e.groupid];if(!o)return null;const i=[];n.log(`found the job group for the job (jobId: ${e.id})`,o);for(let e=0;e<o.length;e++){const r=o[e][0]-t.x,n=o[e][1]-t.y,a=Math.sqrt(r*r+n*n);i.push({distance:a,x:o[e][0],y:o[e][1]})}if(sort(i).call(i,((e,t)=>e.distance>t.distance?1:-1)),n.log("jobs were sorted by distance",i),!i.length)throw new Error(`There are no jobs in this job group! (groupId: ${e.groupid}, jobId: ${e.id})`);return i[0]}function getJobProductLuck(e,t){var r;if(!e.durations.length)return!1;const n=e.durations[e.durations.length-1],o=find(r=n.items).call(r,(e=>e.itemid===t));return!!o&&o.prop+o.probBonus}__decorate([CatchErrors("NearestJobs.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],NearestJobs.prototype,"init",null),__decorate([CatchErrors("NearestJobs.openNearestJobWindowByProductId"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],NearestJobs.prototype,"openNearestJobWindowByProductId",null),__decorate([CatchErrors("NearestJobs.getMinimap"),__metadata("design:type",Function),__metadata("design:paramtypes",[Function,Object]),__metadata("design:returntype",void 0)],NearestJobs.prototype,"getMinimap",null),__decorate([CatchErrors("NearestJobs.startNearestJob"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],NearestJobs.prototype,"startNearestJob",null),NearestJobs=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Settings,Storage,Logger,Language,ErrorTracker])],NearestJobs);let SettingsView=class{window;language;settings;nearestJobs;errorTracker;config;key=WestCalcWindowTab.Settings;title={type:"translation",translation:216};settingsImporterWindow;constructor(e,t,r,n,o,i,a,s){this.window=e,this.language=t,this.settings=r,this.nearestJobs=n,this.errorTracker=o,this.config=i,this.settingsImporterWindow=new LocalSettingsExporterWindow(e,t,a,o,s)}getMainDiv(){const{west:e,$:t}=this.window,r=[],n=this.getOptions(),o=t("<div></div>");if(!n)throw new Error("Setting component was not initialized!");return forEach(n).call(n,(n=>{if(isBooleanSetting(n)){const{translation:i,name:a}=n,s=new e.gui.Checkbox(i).setId(`TWCalc_${a}`).setSelected(this.settings.get(a)).setCallback((()=>{this.settings.save(r)}));r.push({...n,controller:s}),o.append(t(`<div style="margin: 3px 0" id="TWCalc_Setting_${a}"></div>`).append(s.getMainDiv()))}else if(isNumberSetting(n)){var i;const{behaviour:a,translation:s,name:l}=n,c=new e.gui.Combobox(`TWCalc_${l}`);forEach(i=a.options).call(i,(e=>{c.addItem(e.value,e.translation)})),c.select(this.settings.get(l)),c.addListener((()=>{this.settings.save(r)})),r.push({...n,controller:c});const u=t(`<div style="margin: 2px 0" id="TWCalc_Settings_${l}"></div>`);u.append(`<span>${s}&nbsp;&nbsp;</span>`),u.append(c.getMainDiv()),o.append(u)}})),t(o).append(`<p style="text-align: right; margin-bottom: 5px">${this.language.getTranslation(218)}<b> (F5)</b></p>`).append("<hr>").append("</br>").append((new e.gui.Button).setCaption(this.language.getTranslation(152)).click((()=>this.nearestJobs.dialog.open())).getMainDiv()).append((new e.gui.Button).setCaption(this.language.getTranslation(225)).click((()=>this.settingsImporterWindow.open())).getMainDiv()).append((new e.gui.Button).setCaption("Error Log").click((()=>this.errorTracker.open())).getMainDiv()).append(`</br><div style="margin-top: 8px;">Translated by <b>${this.language.getTranslator()}</b>.&nbsp;Thanks for the translation! Version: <b>v${this.config.version}</b></div>`),o}getOptions(){return[{name:SettingBoolean.Wardrobe,translation:this.language.getTranslation(175),behaviour:{type:"checkbox"}},{name:SettingBoolean.MenuCraftButton,translation:this.language.getTranslation(153),behaviour:{type:"checkbox"}},{name:SettingBoolean.TransferFeeCalc,translation:this.language.getTranslation(108),behaviour:{type:"checkbox"}},{name:SettingBoolean.XpHpEnergyCalc,translation:this.language.getTranslation(109),behaviour:{type:"checkbox"}},{name:SettingBoolean.WestCalc,translation:this.language.getTranslation(184),behaviour:{type:"checkbox"}},{name:SettingNumber.NearestJobsBar,translation:this.language.getTranslation(185),behaviour:{type:"combobox",options:[{value:NearestJobsBarPosition.downTransparent,translation:`${this.language.getTranslation(187)} (transparent)`},{value:NearestJobsBarPosition.down,translation:this.language.getTranslation(187)},{value:NearestJobsBarPosition.up,translation:this.language.getTranslation(186)},{value:NearestJobsBarPosition.right,translation:this.language.getTranslation(188)},{value:NearestJobsBarPosition.hidden,translation:this.language.getTranslation(189)}]}},{name:SettingNumber.DuelBar,translation:this.language.getTranslation(191),behaviour:{type:"combobox",options:[{value:DuelBarPosition.up,translation:this.language.getTranslation(186)},{value:DuelBarPosition.down,translation:this.language.getTranslation(187)},{value:DuelBarPosition.hidden,translation:this.language.getTranslation(189)}]}}]}};SettingsView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Language,Settings,NearestJobs,ErrorTracker,Config,Logger,LocalSettingsExporter])],SettingsView);var $findIndex=require$$0$p.findIndex,FIND_INDEX="findIndex",SKIPS_HOLES=!0;FIND_INDEX in[]&&Array(1)[FIND_INDEX]((function(){SKIPS_HOLES=!1})),$$1({target:"Array",proto:!0,forced:SKIPS_HOLES},{findIndex:function(e){return $findIndex(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables();var findIndex$3=entryVirtual("Array").findIndex,method$1=findIndex$3,ArrayPrototype$1=Array.prototype,findIndex$2=function(e){var t=e.findIndex;return e===ArrayPrototype$1||isPrototypeOf(ArrayPrototype$1,e)&&t===ArrayPrototype$1.findIndex?method$1:t},parent$1=findIndex$2,findIndex$1=parent$1,require$$0$1=findIndex$1,findIndex=require$$0$1;function wofPatch(e,t){wofWheelofFortunePatch(e,t),wofDotdCardgameWindowPatch(e,t)}function wofWheelofFortunePatch(e,t){const{west:r}=e;when(e,(()=>r.wof.WheelofFortune.prototype.process),(()=>{const e=r.wof.WheelofFortune.prototype.process;r.wof.WheelofFortune.prototype.process=function(r,n,o,i,a,s){const l=this.id;e.call(this,r,n,(function(e){t(r,l,n,e),o.call(this,e)}),i,a,s)}}))}function wofDotdCardgameWindowPatch(e,t){const{west:r}=e;when(e,(()=>r.wof.WofDotdCardgameWindow.requestData),(()=>{const e=r.wof.WofDotdCardgameWindow.requestData;r.wof.WofDotdCardgameWindow.requestData=function(r,n,o){const i=this.model.getWofId();e.apply(this,[r,n,function(e){t(r,i,n,e),"function"==typeof o&&o(e)}])}}))}function when(e,t,r){const n=setInterval((()=>{try{const e=t();clearInterval(n),r(e)}catch(e){}}),500)}const events=["Hearts","Easter","Independence","Octoberfest","DayOfDead"],translations={easter:195,independence:196,valentine:194,octoberfest:197,dotd:198,fair:174};let TombolaExporter=class{window;localStorage;storage;logger;config;language;errorTracker;tombolaInfo;callbackList=[];constructor(e,t,r,n,o,i,a){this.window=e,this.localStorage=t,this.storage=r,this.logger=n,this.config=o,this.language=i,this.errorTracker=a}init(){this.migrate(),wofPatch(this.window,((e,t,r,n)=>this.errorTracker.execute((()=>this.onWheelOfFortuneSpin({...r,action:e,wofid:t},n)))))}onWheelOfFortuneSpin(e,t){this.logger.log("new tombola spin",e,t);const r=this.getCurrentEvent(),n=e.wofid;if(1===n){if(!t.picked)throw new Error("Invalid tombola! (wofId = 1)");const e=1===t.payid;return this.save({tombolaId:n,prize:t.picked[0],category:t.picked[1]},e)}if(t.prize){const e=t.prize.itemId,r=!!this.window.west.wof.WofManager.wofs.heartswof.mode.free;return this.save({tombolaId:n,prize:e,category:0},r)}if(t&&t.cost&&t.stages){const r=t.stages.length-1,o=t.stages[r].rewards.item,i=Number(e.card||t.card);if("gamble"===e.action){const e=2==i?"Left_card":1==i?"Middle_card":"Right_card";return this.save({tombolaId:n,prize:o,category:r,level:e},!0)}if("bribe"===e.action||"change"===e.action){const e="After_bribe";return this.save({tombolaId:n,prize:o,category:r,level:e},!1)}e.action}else if(r)if(t&&!t.failed&&(t.itemId||t.outcome)){const r=t.itemEnhance||t.outcome&&t.outcome.itemEnhance,o=t.itemId||t.outcome&&t.outcome.itemId||0,i=t.construction_id||e.enhance;let a=0;switch(r){case 25:a=1;break;case 150:a=2;break;case 800:a=3}this.save({tombolaId:n,prize:o,category:a,level:i},!0)}else this.logger.warn("Unable to process WoF response!",t);else this.logger.warn("Unknown event type!",r)}getEventTranslation(e){return this.language.getTranslation(translations[e])}addTombolaInfo(e){var t;(this.tombolaInfo=e,this.callbackList.length)&&(forEach(t=this.callbackList).call(t,(t=>t(e))),this.callbackList=[])}getFromStorage(){return this.storage.getObject(StorageKey.tombola,{})}getTombolaInfo(e){if(this.tombolaInfo)return e(this.tombolaInfo);this.callbackList.push(e),this.logger.log("loading tombola list..."),this.window.$.get(this.config.website+"/service/tombola-list",(()=>{}),"jsonp")}save(e,t){this.logger.log("saving tombola...",e,{isFree:t}),this.exportSpin(e),this.addSpinToStorage(e,t)}getCurrentEvent(){const e=findIndex(events).call(events,(e=>this.window.Game.sesData.hasOwnProperty(e)));return e?events[e]:null}exportSpin(e){const{$:t}=this.window;t.get(this.config.website+"/service/tombola-export",e,(e=>{this.logger.log("tombola exported",e)}),"jsonp")}addSpinToStorage(e,t){const{category:r,prize:n,tombolaId:o}=e,i=this.getFromStorage();i.hasOwnProperty(o)||(i[o]={key:o,spins:{free:0,total:0},levels:{}}),i[o].spins.total++,t&&i[o].spins.free++,i[o].levels.hasOwnProperty(r)||(i[o].levels[r]={}),i[o].levels[r].hasOwnProperty(n)||(i[o].levels[r][n]=0),i[o].levels[r][n]++,this.storage.setObject(StorageKey.tombola,i)}migrate(){if(this.storage.has(StorageKey.tombola))return;this.logger.log("migrating from tombola v1...");const e={},t=this.localStorage;for(const r in t){if(!t.hasOwnProperty(r))continue;const n=r.match(/^TWCalc_Tombola_(\d+_\d+_\d+|\d+)$/);if(!n)continue;const o=n[1],i=parseKey(o);if(!i){this.logger.log(`could not parse tombola key ${o}...`);continue}let a,s;try{a=JSON.parse(t.getItem(r)||"[]")}catch(e){}if("number"!=typeof i)try{s=JSON.parse(t.getItem(`TWCalc_Tombola_Spins_${i.id}_${i.year}`)||"{}")}catch(e){}if(void 0===a||void 0===s){this.logger.log("invalid tombola data...",i,a,s);continue}const l={};forEach(a).call(a,((e,t)=>l[t]=e)),e[getId(i)]={key:i,spins:s,levels:l}}this.storage.setObject(StorageKey.tombola,e),this.logger.log("migration finished!",e)}};function getId(e){return"number"==typeof e?e:e.id}function parseKey(e){if(e.match(/^1$/))return 1;const t=e.match(/^(\d+)_(\d+)_(\d+)$/);return t?{id:Number(t[1]),year:Number(t[2]),type:events[Number(t[3])]}:void 0}var TombolaView_1;__decorate([CatchErrors("TombolaExporter.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],TombolaExporter.prototype,"init",null),__decorate([CatchErrors("TombolaExporter.onWheelOfFortuneSpin"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],TombolaExporter.prototype,"onWheelOfFortuneSpin",null),TombolaExporter=__decorate([singleton(),__param(0,inject$1("window")),__param(1,inject$1("localStorage")),__metadata("design:paramtypes",[Object,Object,Storage,Logger,Config,Language,ErrorTracker])],TombolaExporter);let TombolaView=TombolaView_1=class{window;logger;config;language;tombolaExporter;scrollpane;navigation;tombolaName;actions;constructor(e,t,r,n,o){this.window=e,this.logger=t,this.config=r,this.language=n,this.tombolaExporter=o;const{west:i,$:a}=this.window;this.actions=a("<div></div>"),this.tombolaName=a('<div style="font-size: 18px;"></div>'),this.navigation=a('<div style="display: flex; justify-content: space-between; align-items: center; margin: 6px 6px 12px 6px"></div>'),this.navigation.append(this.actions).append(this.tombolaName),this.scrollpane=new i.gui.Scrollpane}static of(e,t,r,n,o){return new TombolaView_1(e,t,r,n,o)}show(e){const{west:t,$:r}=this.window;this.tombolaExporter.getTombolaInfo((n=>{var o;this.actions.empty();const i=this.tombolaExporter.getFromStorage(),a=filter(o=values$1(n)).call(o,(e=>i.hasOwnProperty(e.id)));sort(a).call(a,((e,t)=>e.year||t.year?-1:Number(e.year)-Number(t.year)));const s=new t.gui.Combobox("TW_Calc_Tombola_list").addListener((e=>this.apply(n,e))).setWidth(250);if(forEach(a).call(a,(e=>{const t=getTombolaHeader(this.tombolaExporter,e);s.addItem(e.id,t)})),a.length){this.actions.append(s.getMainDiv());const e=a[a.length-1].id;s.select(e),this.apply(n,e)}else this.scrollpane.appendContent(r('<div style="text-align: center; padding: 24px; font-weight: bold">'+this.language.getTranslation(221)+"...</div>")),this.navigation.remove();e()}))}getMainDiv(){const{$:e}=this.window,t=e('<div style="height: 308px"></div>').append(this.scrollpane.getMainDiv());return e("<div></div>").append(this.navigation).append(t)}apply(e,t){const{$:r}=this.window,n=e[t],o=this.tombolaExporter.getFromStorage()[n.id];this.logger.log("showing tombola id = "+t,n);const i=r(`<a href="${this.config.website}/tombola/${n.tombolaId}" target="_blank">${getTombolaHeader(this.tombolaExporter,n)}</a>`);this.tombolaName.empty().append(i),this.scrollpane.getContentPane().empty(),this.scrollpane.appendContent(this.getContent(n,o)),this.scrollpane.scrollToTop()}getContent(e,t){var r;const{$:n}=this.window,o=n('<div style="overflow: auto;"></div>'),{spins:i,levels:a}=t;return"valentine"===e.type&&o.append('<span style="font-size: 15px; text-align: right; margin-left: 20px; font-weight: bold">'+i.free+" free "+pluralize(i.free,"spin")+" of "+i.total+" total "+pluralize(i.total,"spin")+"</span></h2>"),forEach(r=entries(a)).call(r,(e=>{let[t,r]=e;const n=getContainer(this.window,Number(t)),i=entries(r);i.length&&(forEach(i).call(i,(e=>{let[t,r]=e;return n.append(getItem(this.window,Number(t),r))})),o.append(n))})),o}};function getItem(e,t,r){const{ItemManager:n,tw2widget:o}=e,i=n.get(t);return new o.InventoryItem(i).setCount(r).setShowcompare(!1).getMainDiv()}function getContainer(e,t){let r="rgba(128, 128, 128, 0.4)";switch(t){case 1:r="rgba(0, 128, 0, 0.4)";break;case 2:r="rgba(0, 0, 255, 0.4)";break;case 3:r="rgba(255, 215, 0, 0.4)";break;case 4:r="rgba(255, 0, 0, 0.4)"}return e.$('<div style="background:'+r+'; float: left; width: 613px; margin: 10px; padding: 10px; border: 3px solid #a49e97; border-radius: 8px; box-shadow: 0 0 20px inset; opacity: 0.9; left: 0; right: 0; top: 0; bottom: 0;"></div>')}function pluralize(e,t){return 1==e?t:t+"s"}function getTombolaHeader(e,t){const r=e.getEventTranslation(t.type);return t.year?`${t.year} - ${r}`:r}TombolaView=TombolaView_1=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,Config,Language,TombolaExporter])],TombolaView);let TombolaViewFactory=class{window;logger;config;language;tombola;constructor(e,t,r,n,o){this.window=e,this.logger=t,this.config=r,this.language=n,this.tombola=o}getWindowView(){let e;return{key:WestCalcWindowTab.Tombola,title:{type:"translation",translation:213},loader:!0,init(t){let{loadCallback:r}=t;e.show(r)},getMainDiv:()=>(e=TombolaView.of(this.window,this.logger,this.config,this.language,this.tombola),e.getMainDiv())}}};TombolaViewFactory=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,Config,Language,TombolaExporter])],TombolaViewFactory);class WestCalcWindow extends TW2Window{constructor(e,t,r,n,o,i,a,s,l,c,u){super("TWCalcWindow",t,e,r,n,{title:"The-West Calc"}),this.addView(o),this.addView(i),this.addView(a),this.addView(s),this.addView(l),this.addView(c.getWindowView()),this.addView(u)}open(e){super.open(e)}openSettings(e){this.open({tab:WestCalcWindowTab.Settings}),e&&setTimeout$1((()=>{var t;find(t=this.getMainDiv()).call(t,"#TWCalc_Settings_"+e).css({"background-color":"rgb(255 255 0 / 0.5)","font-weight":"bold"})}))}}let WestCalc=class{window;constructor(e,t,r,n,o,i,a,s,l,c,u){this.window=new WestCalcWindow(e,t,r,n,o,i,a,s,l,c,u)}};WestCalc=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,ErrorTracker,Language,Logger,NotepadView,ImporterView,CharacterView,BattleCalcView,DuelCalcView,TombolaViewFactory,SettingsView])],WestCalc);let DuelBar=class{window;settings;language;westCalc;logger;errorTracker;updateInterval=1e3;lastPosition={x:-1,y:-1};onNearbyPlayersChangeCallbacks=[];nearbyPlayers=[];updateInProgress=!1;constructor(e,t,r,n,o,i){this.window=e,this.settings=t,this.language=r,this.westCalc=n,this.logger=o,this.errorTracker=i}init(){this.isEnabled()&&this.window.setInterval((()=>this.update()),this.updateInterval)}update(){this.lastPosition.x===this.window.Character.position.x||this.lastPosition.y===this.window.Character.position.y||this.updateInProgress||(this.logger.log("updating duel bar..."),this.updateInProgress=!0,this.loadNearbyPlayers(this.errorTracker.catchErrors((e=>{this.lastPosition.x=this.window.Character.position.x,this.lastPosition.y=this.window.Character.position.y,this.updateInProgress=!1,this.logger.log("duel bar updated",this.lastPosition,e)}))))}appendTo(e){let t;this.onNearbyPlayersChange((r=>{this.logger.log("nearby players list has changed",r),null!=t&&t.remove(),0!==r.length&&(t=this.getMainDiv(r),e.append(t))}))}isEnabled(){return this.settings.get(SettingNumber.DuelBar)!=DuelBarPosition.hidden}isPosition(e){const t=this.settings.get(SettingNumber.DuelBar);return"down"===e?t===DuelBarPosition.down:t===DuelBarPosition.up}getMainDiv(e){var t;const r=$('<div style="text-align: center; width: 620px; height: 88px; position: relative; margin: 4px 0 4px 0;"></div>');return forEach(e).call(e,(e=>{const t=this.window.GameMap.calcWayTime(this.window.Character.position,{x:e.character_x,y:e.character_y}),n="Duel "+e.player_name+" ("+t.formatDuration()+")",o=this.window.$(`\n                <div style="display: inline-block; margin-right: 5px; cursor:pointer; position:relative; float: left;">\n                    <div class="duel-bar-avatar">${e.avatar}</div>\n                    <div style="color: #F8C57C; top: 5px; position: absolute; text-align: center; width: 100%; font-weight: bold; text-shadow: 1px 1px 1px black; font-size: 11px;">\n                        ${e.duellevel}                    \n                    </div>\n                    <img alt="${n}" onclick="SaloonWindow.startDuel(${e.player_id})" title="${n}" style="position: absolute; bottom: -22px; left: 11px; width: 50px;" src="/images/window/duels/charclass_${e.class}.png">\n                    <div class="open_profile" title="${e.player_name}" onclick="PlayerProfileWindow.open(${e.player_id})" style="z-index: 3; width: 20px; height: 20px; display: none; cursor: pointer; position: absolute; left: -10px; top: 20px; background-image: url(/images/map/icons/instant-work-1.png);"></div>\n                </div>`);o.on("mouseover",(function(){var e;find(e=$(this)).call(e,".open_profile").show()})),o.on("mouseout",(function(){var e;find(e=$(this)).call(e,".open_profile").hide()})),find(o).call(o,".duel-bar-avatar").attr("title",n).on("click",(t=>{t.stopPropagation(),this.window.SaloonWindow.startDuel(e.player_id)})),find(o).call(o,".open_profile").on("mouseover",(function(){$(this).css({"background-image":"url(/images/map/icons/instant-work-1_hover.png)","margin-top":"-2px","margin-left":"-2px",width:"24px",height:"25px"})})).on("mouseout",(function(){$(this).css({"background-image":"url(/images/map/icons/instant-work-1.png)","margin-top":"0px","margin-left":"0px",width:"20px",height:"20px"})})),r.append(o)})),find(t=r.append(`<div class="tw2gui_window_buttons_close" style="position: absolute; right: -15px; top: 0;" title="${this.language.getTranslation(189)} Duel Bar"></div>`)).call(t,".tw2gui_window_buttons_close").on("click",(()=>{this.westCalc.window.openSettings(SettingNumber.DuelBar)})),r}onNearbyPlayersChange(e){e(this.nearbyPlayers),this.onNearbyPlayersChangeCallbacks.push(e)}loadNearbyPlayers(e){this.logger.log("loading nearby players..."),loadNearbyPlayers(this.errorTracker,this.window,8,this.errorTracker.catchErrors((t=>{var r;this.nearbyPlayers=t,forEach(r=this.onNearbyPlayersChangeCallbacks).call(r,(e=>e(t))),e(t)})))}};function loadNearbyPlayers(e,t,r,n){!function o(i,a){t.$.post("/game.php?window=duel&action=search_op&h="+t.Player.h,{page:a},e.catchErrors((e=>{const s=e.oplist.pclist;forEach(s).call(s,(e=>{i.length<r&&!find(i).call(i,(t=>t.player_id===e.player_id))&&i.push(e)})),i.length>=r||!s.length?(sortPlayersByDistance(t,i),n(i)):o(i,a+1)})),"json")}([],0)}function sortPlayersByDistance(e,t){sort(t).call(t,((t,r)=>e.GameMap.calcWayTime(e.Character.position,{x:t.character_x,y:t.character_y})-e.GameMap.calcWayTime(e.Character.position,{x:r.character_x,y:r.character_y})))}__decorate([WaitUntil((function(){const e=this.window.GameMap;return"object"==typeof e&&"function"==typeof e.calcWayTime})),CatchErrors("DuelBar.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],DuelBar.prototype,"init",null),__decorate([CatchErrors("DuelBar.update"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],DuelBar.prototype,"update",null),DuelBar=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Settings,Language,WestCalc,Logger,ErrorTracker])],DuelBar);let BankFeesCalculator=class{window;language;timeout;settings;logger;errorTracker;interval;constructor(e,t,r,n,o,i){this.window=e,this.language=t,this.timeout=r,this.settings=n,this.logger=o,this.errorTracker=i}inject(){const{BankWindow:e,format_money:t}=this.window;if("*"!==e.DOM){const r=Math.max(Number(this.window.$("#amount").val()),0),n=Math.round(r/100*e.Transfer.fee),o=Math.round(r-n),i=$("div.bank-transfer-info .tw2gui_groupframe_content_pane",e.DOM);Number(i.data("amount"))!==r&&(this.logger.log("updating transfer fees..."),i.data("amount",r),i.empty().append(this.language.getTranslation(105)+": "+e.Transfer.fee+'% <span style="font-size: 9px">('+this.language.getTranslation(106)+": - $"+t(n)+", "+this.language.getTranslation(107)+": $"+t(o)+")</span>"))}}init(){var e;this.settings.get(SettingBoolean.TransferFeeCalc)&&(this.logger.log("initializing transfer fees calculator..."),this.interval=this.window.setInterval(bind$1(e=this.inject).call(e,this),this.timeout))}};__decorate([CatchErrors({component:"BankFeesCalculator.inject",callback:e=>{e.window.clearInterval(e.interval)}}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],BankFeesCalculator.prototype,"inject",null),BankFeesCalculator=__decorate([singleton(),registry([{token:"timeout",useValue:1e3}]),__param(0,inject$1("window")),__param(2,inject$1("timeout")),__metadata("design:paramtypes",[Object,Language,Number,Settings,Logger,ErrorTracker])],BankFeesCalculator);const nearestJobsIcon="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBAQFBAYFBQYJBgUGCQsIBgYICwwKCgsKCgwQDAwMDAwMEAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/2wBDAQcHBw0MDRgQEBgUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wgARCAAaADIDAREAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAwQFAQYC/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB4jHZ5CYVM7ZcjmjS4Os9dJKYoq6aGNkdNLXLBhG4g8vVSdz4aTtU86ySdon5LeOn/8QAIRABAAICAAYDAAAAAAAAAAAAAwIEAAEFEBESEzMjMTL/2gAIAQEAAQUCZHko0eKJGcrpKm/kGmqRY2Ofdkpb2lYSonfuQsYja09cY61dtafPMGBYIbKW0Wctj44sUbTW5om51endDLfuPC91v9w++X//xAAeEQACAwABBQAAAAAAAAAAAAAAEQECIQMQUWFxwf/aAAgBAwEBPwGWOTfZsjRpvYgmBIengrRfRkSMcIwZNjDkKFSxXr//xAAdEQACAgMBAQEAAAAAAAAAAAAAAQIRECExEgNR/9oACAECAQE/AUka/ConCrOYaPWy7EtFjlZ5ZJCiVsp0UVj58JYjwef/xAAxEAAABAMEBwcFAAAAAAAAAAAAAQIRITEyAxIiQTNDUWFxkdE0QoGCscHwBBMUI+H/2gAIAQEABj8CVFkkbcgSrIjjTSQxqU6JpOHoFJyTDf4h7NHDIXV30mnKI79F+o585b5hRJJ8Z+oL6m2P980om39+Sn9y1w2u3dwFo0cRMfgQ/ItsBno07ePT3karUygbJV1Gk1L/ADoFrMnN1TTm8wZqxPz9xEjJTMDWuMSNrpxgLz3tge6pyyyFWquU5dQuiRTqkNX5hZ9nmE0U5+27YO55gns8xq9IP//EACUQAAIBBAICAgIDAAAAAAAAAAERIQAxQVFh8HGRgbEQocHR4f/aAAgBAQABPyFIuAgAEI05Zm82eBR3ITAA5F4BRnHFQSmuvMWJjIxLpkh6EuBAOV8FQxTkCGkTHiz1GaSuWYh9H97pNdb6+6k9rMudhvQpSo0EAjxEhljzdSAAVuaIWCZ5Uryy6PmQO7s1Ys5blZjpxL70GhsKcDQDPsi0hL/Ad/nS22sEYKBPPHsKhjkGRtLmhF3DJoH072VTXQ3YCqcB2Wr0hUBEEgNIWjGhjZjRgeTZLeNqViuX1jf0rsH1+qu7fNf1+/xzrmulm9Tsd+Kzx/v8H//aAAwDAQACAAMAAAAQMMKaHs76QLgMIs//xAAfEQADAAICAgMAAAAAAAAAAAAAAREhMRBBIFFhcfH/2gAIAQMBAT8QZyXZrUG8DwfIJsX9BH9lEKDzgcNCVQU74EcWBOmJkxCRPY2NDZHXwf/EAB4RAQACAgEFAAAAAAAAAAAAAAEAESExEEFhcYHx/9oACAECAQE/EARPpOlUEFy22oke5RB4GorAJiPmNW5TwZnajpArdQQm5YSpWLdMt4tI6d8g4//EACMQAQEAAwABAwQDAAAAAAAAAAERACExQRBxkVFhofDB0eH/2gAIAQEAAT8QnOx0YGngwAXlaEKGiOlMKZ/N0mkUsUAfFRlEG61uAUeKTrp09MDGIlGpxpj9I9CrUpHcvAgeRWDaU2wUdprgGQih+YKpMCdzCIu4iOlwM7MV2gBAlKq8MBqcJsHhpXXzlT/o394EOGVInRcZExJEYMraD8ZFh60KUbcSEpxxhqJEYFk64cmtiCIMAqdEhAeSfL0Awn+k+nc8vv8AfzHw782F+h9MH5fu7g/kft9D/9k=";var $some=require$$0$p.some,STRICT_METHOD=arrayMethodIsStrict("some");$$1({target:"Array",proto:!0,forced:!STRICT_METHOD},{some:function(e){return $some(this,e,arguments.length>1?arguments[1]:void 0)}});var some$3=entryVirtual("Array").some,method=some$3,ArrayPrototype=Array.prototype,some$2=function(e){var t=e.some;return e===ArrayPrototype||isPrototypeOf(ArrayPrototype,e)&&t===ArrayPrototype.some?method:t},parent=some$2,some$1=parent,require$$0=some$1,some=require$$0,WardrobeWindowTab;class WearableView{config;window;logger;language;errorTracker;container;content;caption;headerLeft;iconShowList;actions;wearable;constructor(e,t,r,n,o){this.config=e,this.window=t,this.logger=r,this.language=n,this.errorTracker=o;const{$:i}=this.window;this.content=this.window.$("<div></div>"),this.actions=i('<div style="display: flex; align-items: center; margin-left: -2px;"></div>'),this.caption=i("<div style=\"font-size: 16px; font-family: Georgia, 'Times New Roman', serif; text-shadow: 1px 1px 0 #FFCC66, 1px 1px 2px #000000; text-transform: capitalize;\"></div>");const a=i('<div style="\n                background: url(/images/tw2gui/iconset.png) repeat -48px 0px;\n                width: 16px;\n                height: 16px;\n                display: inline-block;\n                cursor: pointer;\n                margin-right: 8px;"></div>').attr("title",this.language.getTranslation(171)).on("click",(()=>this.remove()));this.iconShowList=i('<div style="\n                width: 24px;\n                height: 18px;\n                cursor: pointer;\n                background: url(/images/window/character/title_editbtn.jpg) no-repeat -2px -1px;\n                border: 1px solid;\n                margin: 0 2px;\n                display: inline-block"></div>').on("click",(e=>this.bindSelectBox(e)));const s=i('<div style="\n            background: url(/images/tw2gui/iconset.png) repeat -16px 80px;\n            width: 16px;\n            height: 16px;\n            display: inline-block;\n            cursor: pointer;\n            margin: 2px 4px;"></div>').attr("title",this.language.getTranslation(161)).on("click",(()=>this.add()));this.headerLeft=i('<div style="display: flex; flex-direction: row; justify-content: center; align-items: center;"></div>').append(a).append(this.actions).append(this.caption);const l=i('<div style="display: flex; flex-direction: row; justify-content: center; align-items: center;"></div>').append(s).append(this.iconShowList),c=i('<div style="display: flex; justify-content: space-between; height: 32px; align-items: center; margin: 0 6px;"></div>').append(this.headerLeft).append(l);this.container=i("<div></div>").append(c).append(this.content)}static of(e,t,r,n,o){return new WearableView(e,t,r,n,o)}add(){this.config.add((e=>this.show(e)))}remove(){if(void 0===this.wearable)throw new Error("No wearable is selected!");const{MessageSuccess:e}=this.window;this.config.remove(this.wearable.config.id),this.wearable=void 0,this.show(!1),e().show()}bindSelectBox(e){var t;const r=(new this.window.west.gui.Selectbox).setHeader(this.language.getTranslation(170)).setWidth(300);forEach(t=this.config.list()).call(t,(e=>{r.addItem(e.id,getViewName(e.name))})),r.addListener((e=>this.errorTracker.execute((()=>this.show(e))))),r.show(e)}wear(e,t){const{Bag:r,Wear:n,$:o,MessageError:i}=this.window;if(this.logger.log(`wearing item id = ${e}`,t),r.loaded){const i=r.getItemByItemId(e);void 0!==i&&n.carry(i),o(t).css("opacity","0.5")}else i("Loading...").show,r.loadItems(),this.logger.warn("bag is not loaded, cannot wear an item...")}getMainDiv(){return this.container}show(e){this.errorTracker.execute((()=>{var t,r;let n;if(this.actions.empty(),this.caption.empty(),"number"==typeof e&&(n=e),void 0===n){const t=this.config.list();if(t.length||this.iconShowList.hide(),!t.length||!e)return this.headerLeft.css("visibility","hidden"),void this.content.html('<div style="margin: 15px; text-align: center; font-weight: bold">'+this.language.getTranslation(208)+"</div>");n=t[0].id}const{tw2widget:o,ItemManager:i,$:a,west:s,Premium:l,MessageError:c}=this.window;this.logger.log(`show wearable, id = ${n}`),this.headerLeft.css("visibility","visible"),this.iconShowList.show();const u=this.config.show(n,this.actions);if(!u)return this.logger.error(`not found a wearable id = ${n}`),void c(`Wearable '${n}' not found!`).show();this.logger.log("wearable config",u);const d={config:u,itemsDOM:[]};this.caption.text(getViewName(u.name)),d.itemsDOM=map(t=u.items).call(t,(e=>{const t=new o.InventoryItem(i.get(e)).getMainDiv().css({float:"none",display:"inline-block"});return this.isWearing(e)&&a(t).css("opacity","0.5"),a(t).on("click",(()=>{this.wear(e,t)}))}));const g=a("<div></div>");forEach(r=d.itemsDOM).call(r,(e=>g.append(e)));const p=(new this.window.west.gui.Groupframe).appendToContentPane(g);if(l.hasBonus("automation")){this.logger.log("wear all button enabled");const e=(new s.gui.Button).setCaption(this.language.getTranslation(207)).click((()=>{this.errorTracker.execute((()=>{const e=d.config.items;for(let t=0;t<e.length;t++){const r=e[t],n=d.itemsDOM[t];this.wear(r,n)}}))}));p.appendToContentPane(a('<div style="display: block; margin: 4px 0; text-align: center"></div>').append(e.getMainDiv()))}else this.logger.log("wear all button disabled, no automation");this.wearable=d,this.content.empty().append(p.getMainDiv())}))}isWearing(e){var t;return some(t=values$1(this.window.Wear.wear)).call(t,(t=>t.obj.item_id===e))}}function getViewName(e){return e||"unnamed"}__decorate([CatchErrors("WearableView.add()"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],WearableView.prototype,"add",null),__decorate([CatchErrors("WearableView.remove()"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],WearableView.prototype,"remove",null),__decorate([CatchErrors("WearableView.bindSelectBox()"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],WearableView.prototype,"bindSelectBox",null),__decorate([CatchErrors("WearableView.wear"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Object]),__metadata("design:returntype",void 0)],WearableView.prototype,"wear",null),function(e){e[e.Wardrobe=0]="Wardrobe",e[e.OwnCalc=1]="OwnCalc"}(WardrobeWindowTab||(WardrobeWindowTab={}));let WearableViewFactory=class{window;logger;language;errorTracker;constructor(e,t,r,n){this.window=e,this.logger=t,this.language=r,this.errorTracker=n}getWindowView(e,t,r){let n;return{key:e,title:t,loader:!0,init(e){let{loadCallback:t}=e;n.show(!0),t()},getMainDiv:()=>(n=WearableView.of(r,this.window,this.logger,this.language,this.errorTracker),n.getMainDiv())}}};WearableViewFactory=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Logger,Language,ErrorTracker])],WearableViewFactory);let OwnCalcView=class{window;wardrobeViewFactory;storage;language;logger;errorTracker;constructor(e,t,r,n,o,i){this.window=e,this.wardrobeViewFactory=t,this.storage=r,this.language=n,this.logger=o,this.errorTracker=i,this.errorTracker.execute((()=>{if(this.storage.has(StorageKey.ownCalc)){const e=this.storage.getObject(StorageKey.ownCalc);if(isWearableV1(e)){const t=map(e).call(e,((e,t)=>{const{name:r,...n}=e;return{id:t,name:r,config:n}}));this.storage.setObject(StorageKey.ownCalc,t)}}}))}showAddOwnCalcDialog(e){var t;const{west:r,CharacterSkills:n}=this.window,o=getSkillsConfig(n),i=(new r.gui.Textfield).setWidth(440).setPlaceholder(this.language.getTranslation(157)),a=new r.gui.Dialog(this.language.getTranslation(172)).setWidth(462).setHeight(324).addButton(this.language.getTranslation(36),(()=>{const t=this.addOwnCalcWearable(i.getValue(),o);e(t.id)})).addButton(this.language.getTranslation(92)).show(),s=find(t=a.divMain).call(t,".tw2gui_dialog_content > .tw2gui_dialog_text");s.append(this.getSkillsFrame(o,!0)),s.append(i.getMainDiv())}showOwnCalcConfigDialog(e){var t;const{west:r}=this.window,n=new r.gui.Dialog(getViewName(e.name)).setWidth(462).setHeight(294).addButton(this.language.getTranslation(162)).show();find(t=n.divMain).call(t,".tw2gui_dialog_content > .tw2gui_dialog_text").append(this.getSkillsFrame(e.config,!1))}addOwnCalcWearable(e,t){const{MessageSuccess:r}=this.window,n={id:now(),name:e,config:t},o=this.getList();return o.push(n),this.storage.setObject(StorageKey.ownCalc,o),this.logger.log("set own calc to",o),r(this.language.getTranslation(165)).show(),n}getSkillsFrame(e,t){var r;const{$:n,west:o,CharacterSkills:i}=this.window,a=n('<div style="width: 432px; margin-left: auto; margin-right: auto; text-align: center;"></div>');return forEach(r=i.allSkillKeys).call(r,(r=>{const o=e[r],s=t?1/0:e[r],l=t?0:e[r],c=t=>{var o;const i=find(o=n(t.currentTarget).parent()).call(o,".displayValue");let a=e[r];n(t.currentTarget).hasClass("butPlus")?a=Math.min(s,a+1):n(t.currentTarget).hasClass("butMinus")&&(a=Math.max(0,a-1)),n(i).html(a.toString()),e[r]=a},u=i.getSkill(r).getSkillPMBox("TWCalc_Wardrobe_"+r,{},{id:"TWCalc_Wardrobe_"+r,min_value:l,start_value:o,max_value:s,extra_points:0,callbackPlus:e=>c(e),callbackMinus:e=>c(e)});a.append(u)})),(new o.gui.Groupframe).appendToContentPane(a).getMainDiv()}getBestItems(e){var t;const{west:r,Bag:n,Wear:o,ItemManager:i}=this.window,a=r.item.Calculator.getBestSet(e.config),s=a&&a.getItems()||[],l={};forEach(s).call(s,(e=>{l[i.get(e).type]=e}));const c=n.getItemsByItemIds(s),u={};for(let e=0;e<c.length;e++){const t=c[e],r=t.getType(),n=o.get(r);!n||n&&(n.getItemBaseId()!==t.getItemBaseId()||n.getItemLevel()<t.getItemLevel())?u[r]=t.getId():u[r]=n.getId()}return forEach(t=o.slots).call(t,(e=>{u.hasOwnProperty(e)||(o.wear.hasOwnProperty(e)?u[e]=o.wear[e].obj.item_id:l.hasOwnProperty(e)&&(u[e]=l[e]))})),values$1(u)}getTW2WindowView(){return this.wardrobeViewFactory.getWindowView(WardrobeWindowTab.OwnCalc,{type:"translation",translation:160},{add:e=>this.showAddOwnCalcDialog(e),list:()=>{var e;return map(e=this.getList()).call(e,(e=>{let{id:t,name:r}=e;return{id:t,name:r}}))},remove:e=>{var t;const r=filter(t=this.getList()).call(t,(t=>t.id!==e));this.setList(r)},show:(e,t)=>{const r=this.getList(),n=find(r).call(r,(t=>t.id===e));return n?(t.append($('<div style="background: url(/images/tw2gui/iconset.png) repeat -32px 80px;width: 16px;height: 16px;display: inline-block;cursor: pointer;margin-right: 8px"></div>').attr("title",this.language.getTranslation(169)).on("click",(()=>this.showOwnCalcConfigDialog(n)))),this.logger.log("show own calc wearable id = "+n.id,n),{id:e,name:n.name,items:this.getBestItems(n)}):null}})}setList(e){this.storage.setObject(StorageKey.ownCalc,e)}getList(){return this.storage.getObject(StorageKey.ownCalc,[])}};function isWearableV1(e){return isArray(e)&&e.length>0&&!e[0].hasOwnProperty("id")}function getSkillsConfig(e){var t;const r={};return forEach(t=e.allSkillKeys).call(t,(e=>{r[e]=0})),r}__decorate([CatchErrors("OwnCalcView.showAddOwnCalcDialog"),__metadata("design:type",Function),__metadata("design:paramtypes",[Function]),__metadata("design:returntype",void 0)],OwnCalcView.prototype,"showAddOwnCalcDialog",null),__decorate([CatchErrors("OwnCalcView.showOwnCalcConfigDialog"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],OwnCalcView.prototype,"showOwnCalcConfigDialog",null),__decorate([CatchErrors("OwnCalcView.addOwnCalcWearable"),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",Object)],OwnCalcView.prototype,"addOwnCalcWearable",null),__decorate([CatchErrors("OwnCalcView.getSkillsFrame"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Boolean]),__metadata("design:returntype",void 0)],OwnCalcView.prototype,"getSkillsFrame",null),__decorate([CatchErrors("OwnCalcView.getBestItems"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Array)],OwnCalcView.prototype,"getBestItems",null),OwnCalcView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,WearableViewFactory,Storage,Language,Logger,ErrorTracker])],OwnCalcView);let WardrobeView=class{window;wardrobeViewFactory;storage;language;logger;errorTracker;constructor(e,t,r,n,o,i){this.window=e,this.wardrobeViewFactory=t,this.storage=r,this.language=n,this.logger=o,this.errorTracker=i,this.errorTracker.execute((()=>{if(this.storage.has(StorageKey.wardrobe)){const e=this.storage.getObject(StorageKey.wardrobe);if(isArray(e)&&e.length>0&&isArray(e[0])){const t=map(e).call(e,((e,t)=>{const r=[];for(let t=0;t<e.length-1;t++)e[t]&&r.push(e[t]);return{id:t,items:r,name:e[e.length-1]}}));this.storage.setObject(StorageKey.wardrobe,t)}}}))}addWardrobeWearable(e){var t;const{Wear:r,MessageSuccess:n}=this.window,o=map(t=values$1(r.wear)).call(t,(e=>e.obj.item_id)),i={id:now(),name:e,items:o},a=this.getList();return a.push(i),this.storage.setObject(StorageKey.wardrobe,a),this.logger.log("set wardrobe to",a),n(this.language.getTranslation(165)).show(),i}getTW2WindowView(){return this.wardrobeViewFactory.getWindowView(WardrobeWindowTab.Wardrobe,{type:"translation",translation:170},{add:e=>{(new this.window.west.gui.TextInputDialog).setTitle(this.language.getTranslation(161)).setText(this.language.getTranslation(164)).setPlaceholder(this.language.getTranslation(166)).addButton(this.language.getTranslation(163),(t=>{const r=this.addWardrobeWearable(t);e(r.id)})).addButton(this.language.getTranslation(162)).show()},list:()=>{var e;return map(e=this.getList()).call(e,(e=>{let{id:t,name:r}=e;return{id:t,name:r}}))},remove:e=>{var t;const r=filter(t=this.getList()).call(t,(t=>t.id!==e));this.setList(r)},show:e=>{const t=this.getList(),r=find(t).call(t,(t=>t.id===e));return r?{id:e,name:r.name,items:r.items}:null}})}setList(e){this.storage.setObject(StorageKey.wardrobe,e)}getList(){return this.storage.getObject(StorageKey.wardrobe,[])}};__decorate([CatchErrors("WardrobeView.addWear"),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",Object)],WardrobeView.prototype,"addWardrobeWearable",null),WardrobeView=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,WearableViewFactory,Storage,Language,Logger,ErrorTracker])],WardrobeView);class WardrobeWindow extends TW2Window{constructor(e,t,r,n,o,i){super("TWCalcWardrobe",t,e,r,n,{title:{type:"translation",translation:170},size:{width:332,height:402},content:{marginTop:12,marginBottom:12,marginLeft:4,marginRight:4}}),this.addView(o.getTW2WindowView()),this.addView(i.getTW2WindowView())}}let Wardrobe=class{window;errorTracker;wardrobeWindow;constructor(e,t,r,n,o,i){this.window=e,this.errorTracker=t,this.wardrobeWindow=new WardrobeWindow(e,t,r,n,o,i)}open(){const{wman:e,Wear:t}=this.window,r=e.getById("wear");void 0===r?t.open():r.bringToTop(),setTimeout$1((()=>{const t=e.getById("inventory");void 0!==t&&t.destroy()})),this.wardrobeWindow.open({position:this.getWearWindowPosition()})}getWearWindowPosition(){const e=this.window.$(".tw2gui_window.tw2gui_win2."+this.window.Wear.window.id);return{x:Number(e.css("left").split("px")[0])+Number(e.css("width").split("px")[0]),y:Number(e.css("top").split("px")[0])}}};__decorate([CatchErrors("Wardrobe.open"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Wardrobe.prototype,"open",null),Wardrobe=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,ErrorTracker,Language,Logger,WardrobeView,OwnCalcView])],Wardrobe);const wardrobeIcon="data:image/png;data:;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBAQFBAYFBQYJBgUGCQsIBgYICwwKCgsKCgwQDAwMDAwMEAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/2wBDAQcHBw0MDRgQEBgUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wgARCAAaADIDAREAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAQQFAgMG/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB8VhsZeWVooyAGk0rmihNVse3LUUi3P1yeh8WBtiTrLn6GGk7VPOhJO0T8lvHT//EACIQAAICAQMEAwAAAAAAAAAAAAIDAQQAEhMhEBQVMyQxMv/aAAgBAQABBQJhWWO270RJ3QI+WwqcKDzVlRnyAtyLLbBlKGj5CLJyLXg1e8jFOBb+65tvSyIcsbUOmcZYWcagy37l4r3W/wBh99P/xAAoEQABAwIEBAcAAAAAAAAAAAAAAREhAqEDIkFREBKxwTFhgZHR4vD/2gAIAQMBAT8BV1MxJKiIpJOwgv29M0ftkNDUa/h5Nyv791MORxFPl+sXsOOg3azdWuOxBiFBSVFPH//EACURAAIABQMDBQAAAAAAAAAAAAABAhESIfAQMUEDUWEikaHR4f/aAAgBAgEBPwGyKocYqSckVITWkaEp25dk+zb3FuNenO4nL5+v0cLTlyrexSyJCXjMsQJok5CtnjGUvTp7EWkOw9f/xAAxEAABAgIHBQYHAAAAAAAAAAABAAIRMQMSISIyQYE0QkNRYTNxgsHR8AQkkaGx0uH/2gAIAQEABj8CcGyFkAIyW9oz+IOc59mRi1OZDDYOeqwkaKJrgahb+CviM/rLrNU0ItspLw8paSTXmnpi2INXnDLHmqIueXXXXnzxa/lEC0VxA6IfM0/L3fReXuqmkcRXylAZ2D2F2nBj79FSGsWm+IwMbc1EfEUn3Pmt6wQibZ9+XIRPei8m8CDhMZLaKSXX9kK9Z0LY9enIawjKAli4VTDl6p+CQnikuH4lR7PNNwYc/LpyW54k3Z5rh9ov/8QAJRABAAICAQQBBAMAAAAAAAAAAREhADFBUWGB8HGRscHhEKHR/9oACAEBAAE/IUlVE3g4m5b3ep4MCEDHEH2wT4WLw5KhJ1JeSISLkkIPlwxUmCK+M/wYGIBqd31Mh09b9frkaqzN5uHqG7W5w52Y1gXf0Mf/AHLLtu7xRao+DYAsa13ixwE5d9cXyzFUohvcqIufl+ge/niRRYBFbt1uYrxgd8ESQK7MWejXXCUzVEkN3ZbMMoRKbyoccgRHng6VeCESkJ+7DVPm1MaEhWolJSMGDHd+s7+jPYP1/Wbe3nP8/vx36d89Ld5PY98Zz2/3/g//2gAMAwEAAgADAAAAEDRH2Tok62DYDCLP/8QAHxEAAgMAAgIDAAAAAAAAAAAAAAERITFBURAggaHx/9oACAEDAQE/EBJdvoaW9G6HQkQJ/QWmQv5NFCsTaCzgkjJJ4fgobXYK1gSGx6vQFJojsaMGkcfR/8QAIBEBAAICAgEFAAAAAAAAAAAAAQARITEQYUFRcYHB4f/aAAgBAgEBPxArzHrm0xAWRTaVPCnzKa941jUZQqqPSYzFjIP46R50CHVHQxKBG1n3CmYsSpmyXuBC3i0jp3yDj//EACQQAQACAgAFBAMAAAAAAAAAAAEAESExEFFhcZFBocHwsdHh/9oACAEBAAE/EDXBqGkBrQBwfoDTsesSlAQBYswiBzIu6ogVs3gQPBYVAt9b+SHYmqYgya5mOCrUNWjmjCqSsUIxyfEhVaApTFylgzIFHKBMAwCA2AX82ekIJgrIVnwxCzAoJFdLQ/o37gpwqJQFhjSeShgglN5oW1EEdWr8k1yAJfESYGBiJV1JBaFAgVVX8UZ1g6L8IGE/AFSYT+k+G51dffqPDvehfQ9kHu+7cHyPt4H/2Q==";let XpHpEnergyCalculator=class{window;language;timeout;settings;logger;errorTracker;interval;constructor(e,t,r,n,o,i){this.window=e,this.language=t,this.timeout=r,this.settings=n,this.logger=o,this.errorTracker=i}inject(){const e=this.window.Character.getExperience4Level(),t=this.window.Character.getMaxExperience4Level(),r=e-t,n=this.window.$("#ui_experience_bar");isNaN(r)||Number(n.data("experience"))===e||(this.logger.log("updating xp indicator..."),n.data("experience",e),n.addMousePopup(this.language.getTranslation(103)+": "+e+" / "+t+" ("+r+")"));const o=this.window.Character.health,i=this.window.Character.maxHealth,a=(this.window.Character.maxHealth-o)/(this.window.Character.healthRegen*i),s=Math.floor(a),l=Math.floor(60*(a-s)),c=o-i,u=$("#ui_character_container > .health_bar");Number(u.data("health"))!==o&&(this.logger.log("updating health indicator..."),u.data("health",o),u.text(o+" / "+i+(c<0?" ("+c+")":"")).addMousePopup(this.language.getTranslation(98)+": "+o+" / "+i+(c<0?" ("+c+")</br>"+this.language.getTranslation(104)+" "+s+" "+this.language.getTranslation(101)+" "+l+" "+this.language.getTranslation(102):"")));const d=this.window.Character.energy,g=this.window.Character.maxEnergy,p=(g-d)/(this.window.Character.energyRegen*g),h=Math.floor(p),f=Math.floor(60*(p-h)),y=d-g,m=this.window.$("#ui_character_container > .energy_bar");Number(m.data("energy"))!==d&&(this.logger.log("updating energy indicator..."),m.data("energy",d),m.text(d+" / "+g+(y<0?" ("+y+")":"")).addMousePopup(this.language.getTranslation(200)+": "+d+" / "+g+(y<0?" ("+y+")</br>"+this.language.getTranslation(100)+": "+h+" "+this.language.getTranslation(101)+" "+f+" "+this.language.getTranslation(102):"")))}init(){var e;this.settings.get(SettingBoolean.XpHpEnergyCalc)&&(this.logger.log("initializing xp, hp and energy ui indicator..."),this.interval=this.window.setInterval(bind$1(e=this.inject).call(e,this),this.timeout))}};__decorate([CatchErrors({component:"XpHpEnergyCalc.inject",callback:e=>{e.window.clearInterval(e.interval)}}),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],XpHpEnergyCalculator.prototype,"inject",null),XpHpEnergyCalculator=__decorate([singleton(),registry([{token:"timeout",useValue:1e3}]),__param(0,inject$1("window")),__param(2,inject$1("timeout")),__metadata("design:paramtypes",[Object,Language,Number,Settings,Logger,ErrorTracker])],XpHpEnergyCalculator);let Gui=class{window;settings;westCalc;wardrobe;nearestJobs;duelBar;logger;language;craft;xpHpEnergyCalculator;bankFeesCalculator;errorTracker;uiMenuContainer;constructor(e,t,r,n,o,i,a,s,l,c,u,d){this.window=e,this.settings=t,this.westCalc=r,this.wardrobe=n,this.nearestJobs=o,this.duelBar=i,this.logger=a,this.language=s,this.craft=l,this.xpHpEnergyCalculator=c,this.bankFeesCalculator=u,this.errorTracker=d,this.uiMenuContainer=this.window.$('<div class="ui_menucontainer" id="TWCalc_Buttons"></div>')}init(){this.logger.log("initializing gui..."),this.initUiMenu(),this.initBottomBar(),this.initTopBar(),this.initCraftButton(),this.xpHpEnergyCalculator.init(),this.bankFeesCalculator.init()}initUiMenu(){if(this.settings.get(SettingBoolean.WestCalc)){const e=this.window.$(`<div class="menulink" title="The-West Calc" style="background-position: 0 0; background-image: url(${twCalcIcon});"></div>`).on("click",(()=>{this.westCalc.window.open()})).on("mouseover",rightMenuButtonLogicMouseOver(this.window.$)).on("mouseout",rightMenuButtonLogicMouseOut(this.window.$));this.uiMenuContainer.append(e)}if(this.settings.get(SettingNumber.NearestJobsBar)===NearestJobsBarPosition.right){const e=this.window.$(`<div class="menulink" title="${this.language.getTranslation(152)}" style="background-position: 0 0; background-image: url(${nearestJobsIcon});"></div>`).on("click",(e=>{this.nearestJobs.list.appendTo(e)})).on("mouseover",rightMenuButtonLogicMouseOver(this.window.$)).on("mouseout",rightMenuButtonLogicMouseOut(this.window.$));this.uiMenuContainer.append(e)}if(this.settings.get(SettingBoolean.Wardrobe)){const e=this.window.$(`<div class="menulink" title="${this.language.getTranslation(170)}" style="background-position: 0 0; background-image: url(${wardrobeIcon});"></div>`).on("click",(()=>{this.wardrobe.open()})).on("mouseover",rightMenuButtonLogicMouseOver(this.window.$)).on("mouseout",rightMenuButtonLogicMouseOut(this.window.$));this.uiMenuContainer.append(e)}this.window.$(this.uiMenuContainer).append('<div class="menucontainer_bottom"></div>'),this.window.$("#ui_menubar").append(this.uiMenuContainer)}initTopBar(){if(!(this.nearestJobs.isPosition("up")||this.duelBar.isPosition("up")))return;const{$:e}=this.window;setInterval((()=>{this.window.$(".first-purchase").remove()}),500);const t=e("div.custom_unit_counter").length?58:44,r=e(`<div id="TWCalc_TopBar" style="\n                    text-align: center;                      \n                    left: 50%;\n                    margin-top: 10px;\n                    max-width: 620px;\n                    position: absolute;\n                    top: ${t}px;\n                    z-index: 19;\n                    -webkit-transform: translateX(-50%);\n                    -moz-transform: translateX(-50%);\n                    -ms-transform: translateX(-50%);\n                    -o-transform: translateX(-50%);\n                    transform: translateX(-50%);"></div>`);if(this.window.$("#user-interface").append(r),this.nearestJobs.isPosition("up")){this.logger.log("add the nearest jobs bar up");const e=this.window.$("<div></div>");this.window.$(r).append(e),this.nearestJobs.bar.appendTo(e)}if(this.duelBar.isPosition("up")){this.logger.log("add duel bar up");const e=this.window.$("<div></div>");this.window.$(r).append(e),this.duelBar.appendTo(e)}}initBottomBar(){if(!(this.nearestJobs.isPosition("down")||this.duelBar.isPosition("down")))return;const e=$('<div id="TWCalc_BottomBar" style="\n                    left: 50%;\n                    -webkit-transform: translateX(-50%);\n                    -moz-transform: translateX(-50%);\n                    -ms-transform: translateX(-50%);\n                    -o-transform: translateX(-50%);\n                    transform: translateX(-50%);\n                    text-align: center;\n                    max-width: 620px;\n                    position: absolute;\n                    bottom: 97px;"></div>');if(this.window.$("#ui_bottombar").append(e),setInterval((()=>{this.window.$(e).stop(),this.window.$(e).animate({bottom:getBottomBarPositionY(this.window)},500)}),500),this.duelBar.isPosition("down")){this.logger.log("add duel bar up");const t=this.window.$("<div></div>");this.window.$(e).append(t),this.duelBar.appendTo(t)}if(this.nearestJobs.isPosition("down")){this.logger.log("add the nearest jobs bar down");const t=this.window.$("<div></div>");this.window.$(e).append(t),this.nearestJobs.bar.appendTo(t)}}initCraftButton(){const e=null!=this.window.Character.professionId;this.settings.get(SettingBoolean.MenuCraftButton)&&e&&this.window.$(".button.crafting.background").off("click").on("click",(()=>{this.craft.open()}))}};function getBottomBarPositionY(e){let t=(e.$("#ui_bottombar").height()||0)+5+14+(e.$(".friendsbar").height()||0);return"none"==$("#ui_windowdock").css("display")||""==$(".windowbar_frames").html()?t+=15:t+=47,t}function rightMenuButtonLogicMouseOver(e){return function(){e(this).css("background-position","-25px 0")}}function rightMenuButtonLogicMouseOut(e){return function(){e(this).css("background-position","0 0")}}__decorate([CatchErrors("Gui.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Gui.prototype,"init",null),__decorate([CatchErrors("Gui.initUiMenu"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Gui.prototype,"initUiMenu",null),__decorate([CatchErrors("Gui.initTopBar"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Gui.prototype,"initTopBar",null),__decorate([CatchErrors("Gui.initBottomBar"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Gui.prototype,"initBottomBar",null),__decorate([CatchErrors("Gui.initCraftButton"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Gui.prototype,"initCraftButton",null),Gui=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Settings,WestCalc,Wardrobe,NearestJobs,DuelBar,Logger,Language,Craft,XpHpEnergyCalculator,BankFeesCalculator,ErrorTracker])],Gui);const itemTypeToShopType={head:"tailor",body:"tailor",foot:"tailor",pants:"tailor",right_arm:"gunsmith",left_arm:"gunsmith",neck:"general",animal:"general",belt:"general"};function getItemShopType(e,t){const r=t.get(e);return!itemTypeToShopType.hasOwnProperty(r.type)||!r.traderlevel||r.traderlevel>30?null:itemTypeToShopType[r.type]}function questsMonkeyPatch(e,t,r){questsGetMinimapLinkPath(e,t),questRenderPatch(e,t,r)}function questsGetMinimapLinkPath(e,t){const{Quest:r,ItemManager:n,MinimapWindow:o}=e,i=r.getMinimapLink;r.getMinimapLink=function(r){let a="";const s=["inventory_changed","wear_changed"];if(r&&r.id&&indexOf$2(s).call(s,r.type)>-1){const i=n.get(r.id),s=!!getItemShopType(i.item_id,n);if("crafting"===i.spec_type)return'<span class="quest_craftlink" style="cursor: pointer;" title="'+t.getTranslation(192)+'" onclick="TW_Calc.openCraftRecipeWindow('+i.item_id+')"><img src="/images/items/yield/toolbox.png" alt="Toolbox" width="16"/></span>&nbsp;';"mapdrop"===i.spec_type?a+='<span class="tw2gui-iconset tw2gui-icon-hammer" style="display: inline-block; cursor: pointer; vertical-align: middle; margin-right: 2px;" onclick="TW_Calc.openNearestJobWindowByProductId('+i.item_id+')"></span>':s?a+='<span class="tw2gui-iconset tw2gui-icon-home" style="display: inline-block; cursor: pointer; vertical-align: middle; margin-right: 2px;" onclick="TW_Calc.openShopWindowByItemId('+i.item_id+')"></span>':e.hidTasks&&e.hidTasks[i.item_base_id]&&(a+=o.getQuicklink(r.id,"inventory_changed").replace("class='quest_mmaplink'","style='cursor: pointer;'"))}else{if(r&&"task-finish-walk"===r.type)return'<span class="quest_employerlink" style="cursor: pointer;" title=\''+t.getTranslation(205)+"' onclick=\"TW_Calc.findQuestEmployer("+r.value+')"><img src="/images/map/minimap/icons/miniicon_quests.png" alt="Quests"/></span>&nbsp;';r&&"task-finish-job"===r.type&&(a+='<span class="tw2gui-iconset tw2gui-icon-hammer" style="display: inline-block; cursor: pointer; vertical-align: middle; margin-right: 2px;" onclick="TW_Calc.startNearestJob('+r.id+', {})"></span>')}return a+i(r)}}function questRenderPatch(e,t,r){const{Quest:n}=e,o=n.render;n.render=function(){var e;o.apply(this,arguments),find(e=this.el).call(e,".quest_description_container .strong").append('<a class="quest_calclink" style="float: right;" title="'+t.getTranslation(206)+'" href="'+r.website+"/quests/quest/"+this.id+'" target="_blank"><img src="/images/items/yield/book_plain.png" alt="Show Quest" width="22"/></a>')}}let Quests=class{window;nearestJobs;language;config;logger;errorTracker;constructor(e,t,r,n,o,i){this.window=e,this.nearestJobs=t,this.language=r,this.config=n,this.logger=o,this.errorTracker=i}init(){questsMonkeyPatch(this.window,this.language,this.config)}findQuestEmployer(e){const{GameMap:t,UserMessage:r}=this.window;this.nearestJobs.getMinimap((n=>{const o=n.quest_locations[e];if(!o)return new r(this.language.getTranslation(204),"hint").show();t.center(o[0][0],o[0][1])}))}openShopWindowByItemId(e){const{$:t,GameMap:r,MessageSuccess:n,MessageError:o,ItemManager:i,Character:a,Trader:s}=this.window;this.nearestJobs.getMinimap((l=>{n(this.language.getTranslation(143)).show();const c=getTownsByDistance(l.towns,r,a),u=getItemShopType(e,i);if(!u)return o(this.language.getTranslation(219)).show();findItemShopRecursive(e,u,c,t,this.logger,(e=>{s.open(u,e.town_id,e.x,e.y)}),(()=>o(this.language.getTranslation(219)).show()))}))}};function getShop(e,t,r){return new promise(((n,o)=>{e.get("game.php?window=building_"+t+"&town_id="+r,(e=>{var t;if("error"in e)return o();n(map(t=e.trader_inv).call(t,(e=>e.item_id)))}))}))}function findItemShopRecursive(e,t,r,n,o,i,a){const s=r.shift();if(o.log("finding item in shops recursively",s,r),!s)return a();getShop(n,t,s.town_id).then((l=>{if(includes(l).call(l,e))return i(s);findItemShopRecursive(e,t,r,n,o,i,a)})).catch((()=>findItemShopRecursive(e,t,r,n,o,i,a)))}function getTownsByDistance(e,t,r){var n;const o=[],i=r.homeTown;if(forEach(n=values$1(e)).call(n,(e=>{e.member_count&&e.town_points>2e3&&e.town_id!=i.town_id&&o.push({town_id:e.town_id,x:e.x,y:e.y,distance:t.calcWayTime(r.position,e)})})),sort(o).call(o,((e,t)=>e.distance-t.distance)),i&&i.town_id){const{town_id:e,x:t,y:r}=i;o.unshift({town_id:e,x:t,y:r,distance:0})}return o}__decorate([CatchErrors("Quests.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Object)],Quests.prototype,"init",null),__decorate([CatchErrors("Quests.findQuestEmployer"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],Quests.prototype,"findQuestEmployer",null),__decorate([CatchErrors("Quests.openShopWindowByItemId"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],Quests.prototype,"openShopWindowByItemId",null),Quests=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,NearestJobs,Language,Config,Logger,ErrorTracker])],Quests);let Updater=class{window;config;logger;language;storage;errorTracker;constructor(e,t,r,n,o,i){this.window=e,this.config=t,this.logger=r,this.language=n,this.storage=o,this.errorTracker=i}init(){this.window.$.get(this.config.website+"/service/updater",{name:this.window.Character.name,id:this.window.Character.playerId,world:this.window.Game.gameURL,locale:this.window.Game.locale,TWCalc:this.config.version},(()=>{}),"jsonp")}callback(e){try{e.version!==this.config.version&&e.beta_version!=this.config.version&&this.showUpdaterWindow(e),this.storage.has(StorageKey.languagePackReset)&&this.storage.getNumber(StorageKey.languagePackReset)===Number(e.reset_language_pack)||(this.logger.log("language pack reset"),this.storage.remove(StorageKey.languagePackLastUpdate),this.storage.setString(StorageKey.languagePackReset,e.reset_language_pack))}catch(e){this.logger.error("Updater error. Your TW-Calc might be updated, check the latest version on the website!",e)}}showUpdaterWindow(e){const{west:t}=this.window,r=this.config.version;if(void 0!==t.gui.Dialog)new t.gui.Dialog(this.language.getTranslation(78),`<div class="txcenter">${this.language.getTranslation(77)}</div><div><br />${this.language.getTranslation(79)}: ${r}<br />${this.language.getTranslation(111)}: ${e.version}<br/></br><b>${this.language.getTranslation(112)}?</b></br>${e.news}</div>`,t.gui.Dialog.SYS_WARNING).addButton("Download",(()=>this.doUpdate())).addButton(this.language.getTranslation(80),(()=>{})).show();else{if(!confirm(this.language.getTranslation(77)+"\n\n"+this.language.getTranslation(79)+": "+this.config.version+"\n"+this.language.getTranslation(111)+": "+e.version))return;this.doUpdate()}}doUpdate(){const e=`${this.config.updateUrl}?t=${now()}`;this.logger.log(`opening update url... (${e})`),this.window.open(e)}};__decorate([CatchErrors("Updater.init"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Updater.prototype,"init",null),Updater=__decorate([singleton(),__param(0,inject$1("window")),__metadata("design:paramtypes",[Object,Config,Logger,Language,Storage,ErrorTracker])],Updater);let Initializer=class{language;config;importer;updater;settings;gui;westCalc;logger;birthday;nearestJobs;tombolaExporter;errorTracker;duelBar;battleCalc;alarmClock;chests;quests;craft;window;patch;constructor(e,t,r,n,o,i,a,s,l,c,u,d,g,p,h,f,y,$,m,w){this.language=e,this.config=t,this.importer=r,this.updater=n,this.settings=o,this.gui=i,this.westCalc=a,this.logger=s,this.birthday=l,this.nearestJobs=c,this.tombolaExporter=u,this.errorTracker=d,this.duelBar=g,this.battleCalc=p,this.alarmClock=h,this.chests=f,this.quests=y,this.craft=$,this.window=m,this.patch=w,this.errorTracker.execute((()=>{this.logger.log("initializing tw-calc..."),this.registerApi(),this.patch(this.window),this.language.init((()=>{this.gui.init(),this.updater.init(),this.birthday.init(),this.nearestJobs.init(),this.duelBar.init(),this.tombolaExporter.init(),this.battleCalc.init(),this.alarmClock.init(),this.chests.init(),this.quests.init(),this.craft.init()}))}))}registerApi(){const e=this.window.Game.version.toString(),{scriptShortName:t,scriptName:r,website:n,author:o,contributors:i,githubUrl:a,discordUrl:s}=this.config,l=`${o}, ${i.join(", ")}`,c=this.window.TheWestApi.register(t,r,"1.36",e,l,n),u=this.window.$("<div style=\"font-size: 20px; font-family: Georgia, 'Times New Roman', serif; text-align: center; margin: 15px; text-shadow: 1px 1px 0 #FFCC66, 1px 1px 2px #000000;\"></div>").append(`<div style="margin-bottom: 8px"><a href="${n}" target="_blank">${n}</a></div>`).append(`<div style="margin-bottom: 8px"><a href="${s}" target="_blank">Discord</a></div>`).append(`<div style="margin-bottom: 32px"><a href="${a}" target="_blank">GitHub</a></div>`).append(`<div><a href="javascript: TW_Calc._window.open({ tab: 'settings' }); void(0)">${this.language.getTranslation(3)}</a></div>`),d=this.window.$("<div></div>").append(u);this.config.donations&&d.append('<div style="font-size: 16px; text-align: center; margin-bottom: 15px">If you like our webpage and script, please donate for server costsand further development, we will be very grateful to you. We are funding everything from our own resources. All your donations will be appreciated and used in best way possible to ensure future development of this script.<div style="font-weight: bold; font-size: 20px; font-family: Georgia, \'Times New Roman\'; margin: 4px;">Thank you!</div></div>\n                <div style="text-align: center"><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="LRG4X3PGMYHZY"><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"><img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1"></form></div>'),c.setGui(d)}};function bootstrap(e){const t=e.resolve(Initializer),{importer:r,config:n,language:o,updater:i}=t;setUpdaterCallback(e,i);const{version:a,website:s}=n;return{version:a,website:s,doImport:()=>{r.start()},loadPack:e=>{o.loadPack(e)},trackChest:function(){return t.chests.trackChest(...arguments)},openCraftRecipeWindow:e=>t.craft.openCraftRecipeWindow(e),openNearestJobWindowByProductId:e=>t.nearestJobs.openNearestJobWindowByProductId(e),openShopWindowByItemId:e=>t.quests.openShopWindowByItemId(e),findQuestEmployer:e=>t.quests.findQuestEmployer(e),startNearestJob:e=>t.nearestJobs.startNearestJob(e),addTombolaInfo:e=>t.tombolaExporter.addTombolaInfo(e),_window:t.westCalc.window,_initializer:t}}function setUpdaterCallback(e,t){var r;e.resolve("window").TWCalc_updaterCallback=bind$1(r=t.callback).call(r,t)}function tw2patch(e){patchPlusminusField(e),patchCraftingUpdateResources(e)}function patchPlusminusField(e){e.west.gui.Plusminusfield.prototype.setEnabled=function(e){return this.enabled=e,this}}function patchCraftingUpdateResources(e){const t=e.Crafting.updateResources;e.Crafting.updateResources=function(){e.CharacterWindow.window&&t.call(e.Crafting)}}function inject(e,t,r){const n=setInterval((()=>{isGameReady(t)&&(clearInterval(n),t.TW_Calc=injectScript(e,r))}),250);return n}function isGameReady(e){return void 0!==e.$}function injectScript(e,t){const{href:r}=t;if((-1!=indexOf$2(r).call(r,".the-west.")||-1!=indexOf$2(r).call(r,".tw.innogames."))&&-1!=indexOf$2(r).call(r,"game.php"))return e(instance);throw new Error("TW-Calc must be loaded in the game!")}__decorate([CatchErrors("Initializer.registerApi"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],Initializer.prototype,"registerApi",null),Initializer=__decorate([singleton(),__param(18,inject$1("window")),__param(19,inject$1("tw2patch")),__metadata("design:paramtypes",[Language,Config,Importer,Updater,Settings,Gui,WestCalc,Logger,Birthday,NearestJobs,TombolaExporter,ErrorTracker,DuelBar,BattleCalc,AlarmClock,Chests,Quests,Craft,Object,Object])],Initializer),instance.register("window",{useValue:window}),instance.register("localStorage",{useValue:localStorage}),instance.register("tw2patch",{useValue:tw2patch}),inject(bootstrap,window,location)})()},TWCalcJSElement=document.createElement("script");TWCalcJSElement.setAttribute("type","text/javascript"),TWCalcJSElement.setAttribute("language","javascript"),TWCalcJSElement.setAttribute("id","TWCalc_js"),TWCalcJSElement.innerHTML="("+TWCalcJS.toString()+")()",document.getElementsByTagName("body")[0].appendChild(TWCalcJSElement);