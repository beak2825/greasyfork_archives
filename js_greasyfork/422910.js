// ==UserScript==
// @name         36记
// @namespace    http://tampermonkey.net/
// @version      0.5
// @description  36记，自动答题版
// @author       ddrrcc
// @match        https://ssxx.univs.cn/*
// @namespace    https://univs.yattaze.eu.org
// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js
// @require      https://cdn.jsdelivr.net/npm/ajax-hook@2.0.3/dist/ajaxhook.min.js
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/422910/36%E8%AE%B0.user.js
// @updateURL https://update.greasyfork.org/scripts/422910/36%E8%AE%B0.meta.js
// ==/UserScript==


(function(){const a={loop:!0,target:[4,5,6,7]};let b={},c={};var d,e,f,g="Bearer "+localStorage.getItem("token"),h=localStorage.getItem("currentActivityId");ah.proxy({onRequest:async(a,d)=>{if(-1<a.url.indexOf("/cgi-bin/race/answer/")){let d=JSON.parse(a.body);b[d.question_id]&&0<b[d.question_id].length&&(d.answer=b[d.question_id],c.answer=b[d.question_id],a.body=JSON.stringify(d))}d.next(a)},onError:()=>{alert("\u51FA\u73B0\u9519\u8BEF\uFF0C\u7F51\u7EDC\u95EE\u9898\uFF0C\u53EF\u80FD\u662F\u5927\u5B66\u751F\u5728\u7EBF\u7F51\u7AD9\u6302\u4E86"),location.reload()},onResponse:async(i,j)=>{if(-1<i.config.url.indexOf("/cgi-bin/"))try{let j=JSON.parse(i.response);if(-1<i.config.url.indexOf("/cgi-bin/race/beginning/")&&(e=j.mode_id),-1<i.config.url.indexOf("/cgi-bin/race/question/")){Math.random=()=>0,console.log(JSON.parse(i.response).data.options),f=JSON.parse(i.response).data.options,d=j.data.id,c=j.data;let a=[];axios.post("https://ssxx.univs.cn/cgi-bin/race/answer/",{activity_id:h,answer:[""],mode_id:e,question_id:d,way:"1"},{headers:{Authorization:g,Accept:"application/json, text/plain, */*","Content-type":"application/json;charset=UTF-8","Accept-Language":"zh-CN,zh;q=0.9"}}).then(c=>{a=c.data.data.correct_ids,console.log(c);let g=[];if(200==c.data.status_code){b[d]=a;for(let b=0;b<f.length;b++){for(let c=0;c<a.length;c++)f[b].id==a[c]&&(g.push(b),0<document.getElementsByClassName("el-checkbox__original").length?document.getElementsByClassName("el-checkbox__original")[b].click():0<document.getElementsByClassName("el-radio__original").length&&document.getElementsByClassName("el-radio__original")[b].click(),document.querySelector(".el-input__inner")&&!document.querySelector(".el-dialog__wrapper").style.display&&(document.querySelector(".el-input__inner").value="0000",document.querySelector(".el-input__inner").dispatchEvent(new Event("input")),document.querySelector(".common_btn2").click()),document.getElementsByClassName("exam_questions_cid").length&&0<document.getElementsByClassName("el-loading-mask").length&&"display: none;"==document.getElementsByClassName("el-loading-mask")[0].getAttribute("style")&&("20"==document.getElementsByClassName("exam_questions_cid")[0].innerText?(document.getElementsByClassName("question_btn ml5")[1].click(),setTimeout(()=>{document.getElementsByClassName("question_btn ml5")[0].click()},700)):document.getElementsByClassName("question_btn ml5").forEach(a=>{"display: none;"!=a.getAttribute("style")&&a.click()})));console.log(g)}}else b=[]})}else-1<i.config.url.indexOf("/cgi-bin/portal/race/mode")&&j.data.is_team&&null==a.team&&(a.team=confirm("\u68C0\u6D4B\u5230\u8D26\u53F7\u662F\u6709\u56E2\u961F\u6A21\u5F0F\u7684\uFF0C\u56E2\u4F53\u6A21\u5F0F\u8BF7\u6309\u786E\u8BA4(ok)\uFF0C\u4E2A\u4EBA\u6A21\u5F0F\u8BF7\u6309\u53D6\u6D88(cancel)"))}catch(a){console.error(a)}j.next(i)}}),setInterval(()=>{document.querySelector(".el-input__inner")&&!document.querySelector(".el-dialog__wrapper").style.display&&(document.querySelector(".el-input__inner").value="0000",document.querySelector(".el-input__inner").dispatchEvent(new Event("input")),document.querySelector(".common_btn2").click())},2e3),a.loop&&setInterval(()=>{6<document.getElementsByTagName("img").length&&document.getElementsByTagName("img")[a.target[+new Date%a.target.length]].click(),1==document.getElementsByClassName("card_mode").length&&"display: none;"!==document.getElementsByClassName("card_mode")[0].getAttribute("style")&&(a.team?document.getElementsByTagName("img")[3].click():document.getElementsByTagName("img")[2].click()),0<document.getElementsByClassName("result_back_btn").length&&document.getElementsByClassName("result_back_btn")[0].click()},2e3)})();


