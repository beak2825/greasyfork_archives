// ==UserScript==
// @name         Eliminations - JFK/Pain Member Hider
// @namespace    http://tampermonkey.net/
// @version      1.0.0
// @description  On competition team pages, hide rows for JFK & Pain members.
// @author       HuzGPT
// @match        https://www.torn.com/page.php?sid=competition*
// @run-at       document-idle
// @downloadURL https://update.greasyfork.org/scripts/558553/Eliminations%20-%20JFKPain%20Member%20Hider.user.js
// @updateURL https://update.greasyfork.org/scripts/558553/Eliminations%20-%20JFKPain%20Member%20Hider.meta.js
// ==/UserScript==

(function () {
    "use strict";

    const DEBUG = false;

    const STATIC_BLOCK_IDS = [220817, 226831, 247787, 375160, 465462, 1432316, 1597795, 1644001, 1672708, 1730561, 1846174, 1905086, 1931202, 1950896, 2080389, 2240841, 2387478, 2474268, 2493371, 2592963, 2625259, 2690367, 2701081, 2799052, 2830335, 2881009, 2893108, 2941854, 2944387, 2948158, 2959959, 2968847, 2982757, 3039102, 3063482, 3134190, 3207777, 3221506, 3222300, 3283753, 3304115, 3364959, 3375600, 3378387, 3386568, 3386852, 3387928, 3393413, 3403848, 3411977, 3421028, 3424668, 3435527, 3436777, 3463855, 3479017, 3486395, 3522884, 3531198, 3531300, 3552336, 3562106, 3613770, 3654521, 3689656, 3698524, 3700726, 3701952, 3705449, 3731837, 3768801, 3803913, 3814649, 3824868, 3833830, 3862528, 3875946, 3881974, 3883015, 3897780, 3904105, 3911314, 23995, 34977, 59922, 63384, 74835, 100814, 122268, 138635, 179706, 184337, 200267, 246888, 247674, 253041, 253934, 264054, 271021, 277624, 294501, 300581, 318855, 390615, 422033, 422147, 424998, 463500, 471591, 509465, 543148, 581165, 582943, 621230, 642144, 707073, 847571, 879721, 883184, 887159, 902374, 912780, 914212, 952212, 988807, 992219, 1015444, 1064389, 1172979, 1231929, 1333992, 1504872, 1531687, 1566046, 1568669, 1570125, 1609046, 1615339, 1676696, 1679929, 1725559, 1874738, 1876106, 1882661, 2014817, 2040116, 2087825, 2122284, 2127084, 2159813, 2161185, 2353997, 2354723, 2402410, 2427764, 2448500, 2527864, 2562311, 2586789, 2669087, 2687479, 2715671, 2903246, 2977792, 2986359, 3078393, 3300790, 3327658, 3375513, 3594306, 3608842, 3624230, 3653000, 776, 34013, 88497, 163981, 211088, 250698, 268095, 273777, 288536, 304168, 329437, 385128, 426126, 453063, 517092, 518466, 519163, 519738, 594063, 636513, 641520, 653876, 684633, 685661, 744625, 807411, 864830, 867628, 867659, 871862, 946292, 969050, 1049926, 1151936, 1310389, 1471367, 1520872, 1532723, 1574514, 1653406, 1741154, 1758760, 1762095, 1830596, 1891280, 1912669, 1961735, 1972571, 1977555, 2031080, 2083525, 2093719, 2113885, 2167045, 2170094, 2326497, 2404933, 2406675, 2454577, 2498520, 2505503, 2513891, 2524997, 2561502, 2562325, 2601761, 2602983, 2604114, 2620424, 2644825, 2684907, 2722961, 2754402, 2770945, 2778645, 2797833, 2846951, 2920379, 3003303, 3072429, 3097116, 3156980, 3244563, 3376863, 56264, 62172, 83384, 163806, 191408, 206028, 250755, 510893, 518314, 685083, 939429, 966287, 982521, 1163521, 1198956, 1407331, 1414758, 1476626, 1569639, 1577244, 1604292, 1644039, 1726603, 1988849, 2006719, 2032117, 2040908, 2046253, 2082637, 2179991, 2208439, 2222230, 2255978, 2291312, 2327067, 2383576, 2449786, 2479075, 2498164, 2503297, 2505242, 2561102, 2605846, 2608170, 2636677, 2637581, 2640068, 2644602, 2646210, 2688079, 2707082, 2769676, 2824730, 2857726, 2867920, 2956410, 2966361, 3114848, 3117055, 3131845, 3157525, 3158688, 3160944, 3215774, 3218273, 3221094, 3225502, 3236928, 3306634, 3377711, 3394709, 3443229, 3445243, 3472586, 3474556, 3474830, 3485409, 3526700, 3533524, 3594925, 3626651, 3633845, 3690195, 3691995, 3698462, 3727557, 3784438, 3847806, 3849544, 3865165, 7800, 15457, 44394, 66590, 67769, 83808, 90007, 102841, 105083, 109192, 117976, 120351, 122369, 136084, 163772, 166801, 202687, 241277, 258329, 279474, 313482, 317444, 328231, 329461, 349008, 382815, 387969, 429478, 446477, 461514, 469324, 478606, 487848, 493795, 544071, 581715, 604593, 606779, 631929, 634051, 673647, 692571, 692719, 693575, 887289, 899431, 914520, 952429, 959750, 979994, 1028930, 1052701, 1131108, 1145504, 1154234, 1260826, 1281130, 1293957, 1345615, 1378809, 1385862, 1407977, 1414266, 1445530, 1454137, 1455047, 1459431, 1465084, 1480425, 1518389, 1640970, 1690692, 1708715, 1722008, 1772814, 1778428, 1813796, 1849848, 1857138, 1890780, 1990607, 2003412, 2080958, 2083878, 2093257, 2102731, 2113132, 2151953, 2241319, 2369867, 2565380, 231580, 328029, 474849, 478555, 700846, 899415, 1040542, 1414939, 1639937, 1762616, 1973986, 2072751, 2165445, 2233406, 2282899, 2295682, 2299647, 2356216, 2440298, 2467562, 2480065, 2482076, 2536214, 2586998, 2637921, 2639289, 2639905, 2640498, 2711193, 2719787, 2738140, 2741746, 2769349, 2789760, 2811137, 2840742, 2868752, 2881245, 2902025, 2974994, 2990281, 3010615, 3102001, 3117664, 3149345, 3177056, 3188468, 3212187, 3213402, 3251888, 3305184, 3306557, 3364639, 3370416, 3370606, 3370624, 3379315, 3379364, 3380912, 3383923, 3384691, 3388981, 3393136, 3395781, 3396535, 3407716, 3453365, 3490911, 3492848, 3493798, 3563675, 3567080, 3569967, 3572617, 3592244, 3641942, 3645731, 3656481, 3675204, 3694167, 3707570, 3720890, 3743727, 3746361, 3748830, 3766838, 3820434, 3821642, 3843757, 3889386]
    let blockedIds = new Set(STATIC_BLOCK_IDS);

    let mo = null;
    let pendingScan = null;

    const log = (...args) => DEBUG && console.log("[JFK competition filter]", ...args);

    function fetchBlockedIds() {
        return Promise.resolve(blockedIds);
    }

    function extractXid(row) {
        const a = row.querySelector('a[href*="XID="]');
        if (!a) return null;
        const href = a.getAttribute("href") || "";
        const m = href.match(/XID=(\d+)/i);
        return m ? Number(m[1]) : null;
    }

    function hideBlockedRows() {
        // Target only the team grid rows; use the hashed class names if present to avoid nuking the container.
        const rows =
              document.querySelectorAll(".teamRow___R3ZLF, div[class*='teamRow']") ||
              [];
        if (!rows.length) return;
        let hidden = 0;
        rows.forEach((row) => {
            const xid = extractXid(row);
            if (!xid) return;
            if (blockedIds.has(xid)) {
                // Hide instead of removing to avoid the virtualized list collapsing
                row.style.display = "none";
                hidden += 1;
            }
        });
        if (hidden) log(`Hid ${hidden} blocked row(s).`);
    }

    async function scan() {
        await fetchBlockedIds();
        hideBlockedRows();
    }

    function scheduleScan() {
        if (pendingScan) cancelAnimationFrame(pendingScan);
        pendingScan = requestAnimationFrame(scan);
    }

    function startObserver() {
        if (mo) return;
        mo = new MutationObserver(scheduleScan);
        mo.observe(document.body, { childList: true, subtree: true });
    }

    function onRouteChange() {
        scheduleScan();
    }

    function boot() {
        startObserver();
        scheduleScan();
        window.addEventListener("hashchange", onRouteChange);
        window.addEventListener("popstate", onRouteChange);
    }

    if (document.readyState === "complete" || document.readyState === "interactive") {
        boot();
    } else {
        window.addEventListener("DOMContentLoaded", boot);
    }
})();

