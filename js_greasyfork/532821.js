// ==UserScript==
// @name        TurtleKit
// @namespace   Shariq Scripts
// @match       https://goto.netcompany.com/*
// @grant       none
// @version     1.10
// @author      Shariq Shahbaz (shsh@netcompany.com)
// @description Better TurtleKit
// @license MIT
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @grant          GM_addStyle
// @downloadURL https://update.greasyfork.org/scripts/532821/TurtleKit.user.js
// @updateURL https://update.greasyfork.org/scripts/532821/TurtleKit.meta.js
// ==/UserScript==
GM_addStyle(".turtle {font-size: 24px;animation: move 5s infinite linear alternate;}@keyframes move {to {transform: translate(80px,0);}}@media (prefers-reduced-motion: reduce) {.turtle {animation: none;}}");const modalStyles={cursor:"pointer",display:"none",position:"fixed",zIndex:"1000",left:"0",top:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",overflowY:"scroll",justifyContent:"center",alignItems:"center"},innerDivStyles={cursor:"default",display:"flex",alignItems:"center",justifyContent:"center",margin:"auto",width:"100%"},config={enableSensibleSpacing:GM_getValue("enableSensibleSpacing",!0),enableTurtleKit:GM_getValue("enableTurtleKit",!0),enableReplacePrimaryColors:GM_getValue("enableReplacePrimaryColors",!0),enableSensibleImages:GM_getValue("enableSensibleImages",!1),enableQuickAccess:GM_getValue("enableQuickAccess",!0),enableDeadkit:GM_getValue("enableDeadkit",!1)};function verifyDead(){return(window.performance.timing.responseEnd-window.performance.timing.requestStart)/1e3>15}function setSensibleSpacing(){const e=document.querySelectorAll("div[class*='External']");Array.from(e).forEach((e=>{e.style.borderBottom="2px dotted #b7b7b7",e.style.marginBottom="20px",e.style.paddingBottom="10px"}))}function setTurtleKit(){if(document.getElementsByClassName("turtle")){const e=document.querySelector("span[class*='brandingText']");e.style.display="flex",config.enableDeadkit&&verifyDead()?e.innerHTML="DeadKit‚Ñ¢<div style='margin-left: 4px;font-size: 24px;rotate: 180deg; transform: translateY(-10px)'>üê¢</div>":e.innerHTML="TurtleKit‚Ñ¢<div class='turtle'>üê¢</div>"}}function replacePrimaryColor(){document.documentElement.style.setProperty("--primary","oklch(29.3% 0.066 243.157)"),document.documentElement.style.setProperty("--primary-80","oklch(39.1% 0.09 240.876)"),config.enableDeadkit&&verifyDead()&&(document.documentElement.style.setProperty("--primary","#7f1d1d"),document.documentElement.style.setProperty("--primary-80","#991b1b"))}function createStyledElement(e,t,n={}){const a=document.createElement(e);return Object.assign(a.style,t),Object.entries(n).forEach((([e,t])=>{e.startsWith("on")?a[e]=t:a.setAttribute(e,t)})),a}function showImage(e){const t=document.getElementById("image_modal");document.getElementById("modal-image").src=e,t.style.display="flex",document.body.style.overflow="hidden"}function closeImageModal(){document.getElementById("modal-image");image_modal.style.display="none",document.body.style.overflow="auto"}function setSensibleImages(){if(document.querySelectorAll("div[class*='External'] img").forEach((e=>{"Netcompany - Reply Message"!==e.alt&&(e.style.border="2px solid #ccc",e.style.borderRadius="12px",e.style.margin="8px",e.style.cursor="pointer",e.onclick=()=>showImage(e.src))})),!document.getElementById("image_modal")){const e=createStyledElement("div",modalStyles,{id:"image_modal",onclick:()=>closeImageModal()}),t=createStyledElement("div",innerDivStyles,{}),n=createStyledElement("img",{},{id:"modal-image"});n.style.maxWidth="90vw",n.style.maxHeight="90vh",t.appendChild(n),e.appendChild(t),document.body.appendChild(e),closeImageModal()}}function setQuickAccess(){const e=new URL(window.location.href);if(!document.getElementById("turtlekit-quick-access")&&e.searchParams.has("ID")){const e=document.createElement("div");e.id="turtlekit-quick-access",e.style.position="absolute",e.style.background="#fff",e.style.boxShadow="4px 4px 8px rgba(0, 0, 0, 0.25)",e.style.left="50%",e.style.top="-45px",e.style.transform="translateY(0) translateX(-50%)",e.style.height="60px",e.style.display="flex",e.style.flexDirection="row",e.style.alignItems="center",e.style.justifyContent="space-between",e.style.gap="10px",e.style.zIndex="1000",e.style.padding="8px 20px",e.style.boxSizing="border-box",e.style.fontSize="24px",e.style.textAlign="center",e.style.borderBottom="3px solid var(--primary-80)",e.style.transition=".2s",e.addEventListener("mouseover",(function(){e.style.transform="translateY(45px) translateX(-50%)"})),e.addEventListener("mouseout",(function(){e.style.transform="translateY(0) translateX(-50%)"}));const t=document.getElementsByTagName("nobr");for(let n of t)if("Register time"===n.innerHTML||"Registrer tid"===n.innerHTML){const t=n.parentElement.cloneNode(!0);t.style.cssText="width: 100%; text-decoration: none; padding: 2px;",t.innerHTML="üïì",t.title="Register time",e.appendChild(t)}const n=window.location.href,a=n.indexOf("&"),l=(-1!==a?n.substring(0,a):n).replace("EditForm","DispForm"),i=document.createElement("a");i.href="",i.innerHTML="üîó",i.title="Copy case URL",i.style.cssText="width: 100%; text-decoration: none; padding: 2px;",i.onclick=e=>{e.preventDefault(),navigator.clipboard.writeText(l).then((()=>{console.log("URL copied to clipboard:",l)})).catch((e=>{console.error("Failed to copy URL:",e)}))},e.appendChild(i);const o=document.createElement("a");o.href=l,o.target="_blank",o.innerHTML="‚ÜóÔ∏è",o.title="Open in new tab",o.style.cssText="width: 100%; text-decoration: none; padding: 2px;",e.appendChild(o),document.body.appendChild(e)}}function applyFeatures(){config.enableSensibleSpacing&&setSensibleSpacing(),config.enableTurtleKit&&setTurtleKit(),config.enableReplacePrimaryColors&&replacePrimaryColor(),config.enableSensibleImages&&setSensibleImages(),config.enableQuickAccess&&setQuickAccess()}document.onreadystatechange=function(e){"complete"===document.readyState&&(GM_registerMenuCommand("Toggle Sensible Spacing",(function(){config.enableSensibleSpacing=!config.enableSensibleSpacing,GM_setValue("enableSensibleSpacing",config.enableSensibleSpacing),alert("Sensible Spacing is now "+(config.enableSensibleSpacing?"enabled":"disabled")+". Refresh the page to apply changes.")})),GM_registerMenuCommand("Toggle Turtle Kit",(function(){config.enableTurtleKit=!config.enableTurtleKit,GM_setValue("enableTurtleKit",config.enableTurtleKit),alert("Turtle Kit is now "+(config.enableTurtleKit?"enabled":"disabled")+". Refresh the page to apply changes.")})),GM_registerMenuCommand("Toggle Replace Primary Colors",(function(){config.enableReplacePrimaryColors=!config.enableReplacePrimaryColors,GM_setValue("enableReplacePrimaryColors",config.enableReplacePrimaryColors),alert("Replace Primary Colors is now "+(config.enableReplacePrimaryColors?"enabled":"disabled")+". Refresh the page to apply changes.")})),GM_registerMenuCommand("Toggle sensible images",(function(){config.enableSensibleImages=!config.enableSensibleImages,GM_setValue("enableSensibleImages",config.enableSensibleImages),alert("Sensible images is now "+(config.enableSensibleImages?"enabled":"disabled")+". Refresh the page to apply changes.")})),GM_registerMenuCommand("Toggle quick access",(function(){config.enableQuickAccess=!config.enableQuickAccess,GM_setValue("enableQuickAccess",config.enableQuickAccess),alert("Quick access is now "+(config.enableQuickAccess?"enabled":"disabled")+". Refresh the page to apply changes.")})),GM_registerMenuCommand("Toggle Deadkit",(function(){config.enableDeadkit=!config.enableDeadkit,GM_setValue("enableDeadkit",config.enableDeadkit),alert("Deadkit is now "+(config.enableDeadkit?"enabled":"disabled")+". Refresh the page to apply changes.")})),applyFeatures())};