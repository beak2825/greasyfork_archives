// ==UserScript==
// @name		eRepublik Stuff++
// @version		2.4.17
// @include		*www.erepublik.com/*
// @namespace erepublik_stuff
// @description Makes eRepublik life easier +.
// @downloadURL https://update.greasyfork.org/scripts/3732/eRepublik%20Stuff%2B%2B.user.js
// @updateURL https://update.greasyfork.org/scripts/3732/eRepublik%20Stuff%2B%2B.meta.js
// ==/UserScript==
jQuery(document).ready(function(){function AddStyle(t){$("head").append("<style>"+t+"</style>")}function comma(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function ShowKillDamage(){$(".NoKills").remove()
var t='style="padding:3px;font-size:12px;color:#666"',e='style="color:#3c8fa7;float:right;padding-right:3px;font-size:13px;font-weight:bold"'
$("#eRS_settings").before('<div class="NoKills" style="cursor:default"><strong '+t+">Kills today: </strong><br><span "+e+">"+comma(Kills)+"</span><br><strong "+t+">Damage today: </strong><br><span "+e+">"+comma(Damage)+"</span><br><strong "+t+">Hits today: </strong><br><span "+e+">"+comma(Hits)+'</span><span style="padding:3px;font-size:11px;color:#3c8fa7;cursor:pointer">reset</span></div>'),$(".NoKills span:last").click(function(){ResetStats(),Kills=0,Damage=0,Hits=0,ShowKillDamage()})}function TP(){$(".left_side a img").attr("src").split("/L/")[1].split(".")[0]==CScountry&&$.get("/"+LANG+"/citizen/profile/"+ID,function(t){var e=$(".citizen_military:eq(2)",t.replace(/src=/g,"tmpsrc=")),a=+$(".mids",e).css("width").split("%")[0],i=$("strong:last",e).text().replace(/,/g,"").split("/")
currentTP=+i[0],nextTP=+i[1],doneTP=(nextTP-currentTP)/(100-a)*a,startTP=currentTP-doneTP,$("#total_damage").css("bottom","40px"),$("#player_rank").css("bottom","140px"),$("#player_rank").after('<div id="player_rank" style="bottom:96px"><div class="rank_icon" title="TP Medal"><img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA6lBMVEUAAADk4dLu6c3Fv6bOybTV0cHQzLa7tqLZ18kXFgrv69e9t5zEv6mlnHi9tpqpn3TGvIft58rd17eDe2OMhWdnXjvZ0J67sH7s5cDdz479+OHIr0KAdD6Nfjvz67zHsEv48ciahzikl12RiF24qWPHuXrOu2jTx47BsGTey3fm039PRBdTSSWdj0qvn1THvIzaxFru35bQwXtya0uon3Pu5bF9bSPr6NLbzoy6pESrpY3FvZubkmlcThP57aPp0mn999ne161kWB+wmz/n4LtwZTbYz57Qyann145iWTGGfVb8+eg8Mwq4sIAJoGshAAAAHHRSTlMAC0g3FSpUBCABNWtDkINknFZsjjoljXV2yI6IGCSKSQAAAglJREFUOMutk+e6ojAQhhHBBOwe29kNvVdBBcHe+7n/21nWs4oL+3MnP5In35vMTGaC/W9ravRzCUgS5PTCD6X23IVlksoBpZmIOn/0bhXkPdSu6PIAKNhAFSxvlaP0AR6+GoL9AiB8AcXx3W4nM/Epy3b9uduatr8XdEMejCx7BEF3qM2sj9exwbxKAIxqmvKAXakMc6kiOZhbvTS56lgqg6KpDm6srwguuiMtYBg8jY04mqfap+mc1vzEDQ/yRYyCcEi/dNA0plNxOURH9jbjYsvdSoHGRJUUKOL1kazq4tBnZc6zGHvKu+Nh5a83VkLBMTcznYtXobiVeEdTi+8AUZYc5HqDgRp7Es84Z8l3v4EUqX05u9Vyw3GnpTCMxz4Ds4WSBM6LFXEcCdOzM1uhHPClGd4OXVEoQUPYc4csAPcTk3ORuLVJytB57kBmAHzCrnb3uR+OClhLW+vbetbFyfe4xYjd2WRy21pfVDNZKBrvCeX5xF/gGJzw+kLJ6Gp/bTBkY7+5kL8B1RIhleqFrlEp8boIyWhz6GDknje2qPSmt9QehQexSGPdKMkPbtgzs1BeBFWKegCjeZWhscYyacuCxp71WpNOy1kGSZ43Q2gDeT23AGixxzJBpTFQgEoAlkNkQVleRwAjSkT+18BgNyawvikknf9vw3/WOwDv19v5w6mvx3i3X7WuRBV1yWtgAAAAAElFTkSuQmCC" style="width:32px;height:32px"></div><div class="rank_holder"><b id="gained_rank2">&nbsp;</b><strong id="rank_max2" title="Next TP Medal at:&nbsp;'+comma(nextTP)+'"><span id="rank_min2">'+comma(currentTP)+' TP points</span> </strong><div style="width:'+a+'%" class="rank_bar" id="rank_status_gained2"></div><div style="width:0%" class="rank_bar gained" id="rank_status2"></div></div>'),$("#rank_max2").tipsy({gravity:"s"})})}function updateTP(t){currentTP+=t,doneTP+=t,currentTP>=nextTP&&(nextTP+=1e8,startTP+=1e8,doneTP-=1e8)
var e=doneTP/(nextTP-startTP)*100
$("#gained_rank2").text(" + "+comma(t)),$("#gained_rank2").css("display","block"),$("#rank_status_gained2").css({width:e+"%"}),$("#rank_min2").text(comma(currentTP)+" TP Points")}function NaturalEnemy(){var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAYFBMVEUAAAAAAAAAAAC4AAAAAAAAAAAAAAAEAAAAAAAAAAAiAACYAABSAACQAAC6AADJAADQFxf////79/jDAAD56+y+AAD78PHVMjPODQ3SJyjur7HQICDxwMLolZbwubnrpKa66gNgAAAAD3RSTlMVEBnvHgIGMQwmO5JQiPeWuYyFAAAAhklEQVQY02VPSQ6DMAycBAdjNhPCUqDL/39Zq2oOKD5YmpFmQwh14+CJPFxThwDDIGE7IRgDw8JDlVLVtWIMDPej6jSprr0YdMSjHueyvXddW3KADHoscZ7jtmsngOdKz/i5rld86soexOmxzObw+0x3IhmRJdNfUpjm2C3HFsWK6sW4Yv4XCT4LXK2gv4wAAAAASUVORK5CYII="
0==$('.side_flags[src*="/M/'+CScountry+'.png"]').length&&SERVER_DATA.invaderId!=CS&&SERVER_DATA.defenderId!=CS||1==SERVER_DATA.isResistance||$.get("/"+LANG+"/country/military/"+CScountry,function(e){var a=e.replace(/src=/g,"tmpsrc=")
if($(".indent:eq(0) .attacker img",a).length>0){var i=$(".indent:eq(0) .flagholder img",a).attr("tmpsrc").split("/L/")[1].split(".")[0]
$("#battle_listing li").each(function(){0==$(".resistance_sign",this).length&&$('.side_flags[src*="/M/'+CScountry+'.png"]',this).length>0&&$('.side_flags[src*="/M/'+i+'.png"]',this).after('<img alt="" title="Natural enemy" src="'+t+'" style="margin:8px -20px 0 -10px;z-index:5">')}),$('.country a img[src*="/L/'+i+'.png"]').after('<img alt="" title="Natural enemy" src="'+t+'" style="position:absolute;margin:-2px 0 0 -10px">')}})}function MaxRecoverEnergy(){$("#maxRecover").remove(),$("#current_health").after('<strong id="maxRecover" style="text-align:right;margin-right:5px">'+food_remaining+"</strong>"),setTimeout(MaxRecoverEnergy,1e3)}function StorageInventory(){$.get("/"+LANG+"/economy/inventory",function(t){var e=t.replace(/src=/g,"tmpsrc=")
if(!optout.showStorageInv){AddStyle("#sideInventory{position:absolute;background:#FFF}#sideInventory img,#sideInventory span{float:left;clear:both}#sideInventory img{width:39px;height:39px;background:linear-gradient(#EEF1EC 0px, #D5DECF 100%)}#sideInventory span{font-size:10px;font-weight:bold;color:#578B4D;background:linear-gradient(#BEE698 0px,#98D780 100%);width:39px;text-align:center;cursor:default}.col{line-height:19px}")
var a=""
$(".item_mask ul li,.bazooka .item",e).each(function(){if(0!=$("strong",this).text()){var t=void 0==$("strong",this).attr("id")?"":$("strong",this).attr("id").split("stock_")[1],i=void 0==$("#product_details_"+t,e).html()?"":$("#product_details_"+t+" .attributes",e).html()
$("#product_details_"+t+" .extra",e).length>0&&(i+=$("#product_details_"+t+" .extra",e).html()),"bazooka"==$(this).parent().attr("class")&&$(".b_parts li",e).each(function(){i+=$(this).attr("title")+': <span class="col defense">'+$("strong",this).text()+"</span></br>"}),a+='<img title="'+i.replace(/"/g,"'")+'" src="'+ImageCache($("img",this).attr("tmpsrc").split("/industry/")[1].split(".png")[0])+'"/><span>'+$("strong",this).text()+"</span>"}}),$("body").prepend('<div id="sideInventory">'+a+"</div>"),$("#sideInventory img").tipsy({gravity:"w",html:!0})}if(!optout.storageCapacity){var i=$(".area.storage h4:first strong",e).text().replace(/[,()]/g,"").split("/")
$(".currency_amount").after('<div style="clear:both;float:left;height:22px;margin:-1px 0 10px 6px;width:142px;color:#585858;font-size:12px;cursor:default"><p><img style="float:left;margin:0 6px 0 2px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAyVBMVEUAAAAyMzfS1t4uLzQwMjYoKSktLS1lZ2ubqcYtLS0rKytAR1Y/RVJKUmfFzNgsLCwyMjJBQUEyMjLd4Obc3+QoKjC/x9U6OjuFipRjZmpLUmbCydizvdCNkZyir8gsLCwqKipSW3GZqccvLzH19fVDSVheZ352gpxYYHelscjm6OuvvNNocInu7++drMm4wtfg4eXy8vJPV2tnb4TFztxRU1ZCTmdLVGo1Q12XpsQzMzNcXmRkZ21ucXgmNVKhq77CysGYnqq/yNh4k25rAAAAH3RSTlMAWw90TQlTAYYYKMzfpD/oY9+RQ49CfIiCNeiU2Z3XxuSTsAAAALBJREFUGNNtz0cWgjAARdFYERDsvZAECKH3Ztf9L8qAh+OEP3t39kHLuP5s3hEG/x6qinpRJ1O+aaVZj+cYdCCsCyowTTcCB/a6+iN4Nb3n+wQkihixvpkY4/IMJJQTwuhu4hJjbwTG0SNDMYlN7L2SxK8AoaJwDM9OXE1joOeI0swxbEvTaujpESVxBWEYup8jAHxfRKQC17WCgwzYBiuRGn4QLBddrvmz265lVm37Aq4DGPv4ctamAAAAAElFTkSuQmCC" /><strong>'+comma(i[0])+"/"+comma(i[1])+"</strong><br><span>Free: "+comma(i[1]-i[0])+"</span></p></div>")}})}function AutoBot(){function t(){return i?0>=a&&!$("#allin").is(":checked")?$("#AutoBotSwitch").click():void $.post("/"+LANG+"/military/fight-shooot/"+SERVER_DATA.battleId,{sideId:SERVER_DATA.countryId,battleId:SERVER_DATA.battleId,_token:SERVER_DATA.csrfToken},function(i){if(i.error){if(i.display_captcha)return void ERPK.displayCaptcha()
if("disarmed"==i.message)return void battleFX.enableDisarm()
if("UNKNOWN_SIDE"==i.message)return void(document.location=i.url)
if("WRONG_SIDE"==i.message)return void(document.location=i.url)
if("SHOOT_LOCKOUT"==i.message)return t()}$("#allin").is(":checked")||(a--,$("#kills").val(a)),$("#experienceTooltip strong").eq(1).text(parseInt($("#experienceTooltip strong").eq(1).text())+i.user.earnedXp),i.oldEnemy.isNatural&&(i.user.givenDamage+=Math.floor(.1*i.user.givenDamage)),$("#total_damage strong").text(comma(Math.floor(parseInt($("#total_damage strong").text().replace(/,/g,""))+i.user.givenDamage))),$("#rank_min span").text(comma(i.rank.points)),$("#rank_status_gained").css("width",i.rank.percentage+"%"),$("#player_life").css("width",i.details.current_energy_ratio+"%"),$("#possible_life").css("width",i.details.remaining_energy_ratio+"%"),$("#weapon_inventory p").text(i.user.weaponQuantity),$("#enemy_name").text(i.enemy.name),$("#enemy_skill").text(i.enemy.skill),$("#enemy_life").css("width",i.enemy.energyRatio+"%"),$("#side_bar_currency_account_value").text(comma(i.details.currency)),$("#side_bar_gold_account_value").text(i.details.gold),e(i.details.wellness),energy.processResponse(i.user),smallestFood={use:2}}):void 0}function e(e){if(!optout.LvlupNoRecovery&&globalNS.userInfo.wellness+food_remaining>=10*($("#experienceTooltip strong").eq(2).text()-$("#experienceTooltip strong").eq(1).text()))return setTimeout(t,o)
if(!$("#eatEB").is(":checked")&&0==food_remaining||e>=100)return setTimeout(t,o)
var a=$("#eatEB").is(":checked")?"buttonColor=orange":"buttonColor=blue"
setTimeout(function(){$.getJSON("/"+LANG+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&"+a+"&jsoncallback=?",{},function(e){t(),energy.processResponse(e)})},o)}$(".weapon_attributes").remove(),AddStyle("#AutoBot{background:#242B27;position:absolute;top:350px;left:99px;color:white;font-size:12px;font-weight:bold;line-height:20px;text-align:center}#AutoBot input{margin:3px}#AutoBotSwitch{cursor:pointer;width:100%;background:#FB7E3D}#AutoBotSwitch:hover{background:#83B70B!important}"),$(".player.left_side").after('<div id="AutoBot"><div style="padding:5px">Kills:<input id="kills" type="text" size="1" value="25" style="text-align:center"><label><input id="allin" type="checkbox">All-in</label></br><label><input id="eatEB" type="checkbox">Eat energy bars</label></div><div id="AutoBotSwitch">AUTOBOT OFF</div></div>')
var a,i=!1,o=6365664==ID?600:1200
$("#AutoBotSwitch").click(function(){i?($("#AutoBotSwitch").text("AUTOBOT OFF"),$("#AutoBotSwitch").css("background","#FB7E3D"),i=!1):($("#AutoBotSwitch").text("AUTOBOT ON"),$("#AutoBotSwitch").css("background","#83B70B"),i=!0,a=$("#kills").val(),t())}),$("#allin").change(function(){$("#kills").prop("disabled",$(this).is(":checked"))})}function EnergyRecoverer(){setTimeout(EnergyRecoverer,3e3),"AUTOBOT ON"!=$("#AutoBotSwitch").text()&&(!optout.LvlupNoRecovery&&globalNS.userInfo.wellness+food_remaining>=10*($("#experienceTooltip strong").eq(2).text()-$("#experienceTooltip strong").eq(1).text())||globalNS.userInfo.wellness<reset_health_to_recover&&food_remaining>=smallestFood.use&&$.getJSON("/"+LANG+"/main/eat?format=json&_token="+SERVER_DATA.csrfToken+"&buttonColor=blue&jsoncallback=?",{},function(t){energy.processResponse(t)}))}function QuickMarket(){AddStyle(".eRS_quickMarket{display:none!important;position:absolute!important;top:-7px!important}.eRS_quickMarket li img{width:18px;height:20px;vertical-align:middle;margin-bottom:2px}")
for(var t="",e="",a="",i="",o='<li><a href="/'+LANG+"/economy/market/"+CS,n='<ul class="eRS_quickMarket">',r=1;4>=r;r++)for(var l=1;7>=l;l++)1==r&&7>=l&&(t+=o+"/1/"+l+'"><img src="'+ImageCache(r+"/q"+l)+'"> Food Q'+l+"</li>",7==l&&(t+=o+'/7/1"><img src="'+ImageCache("7/default")+'"> Food Raw</li>')),2==r&&7>=l&&(e+=o+"/2/"+l+'"><img src="'+ImageCache(r+"/q"+l)+'"> Weapon Q'+l+"</li>",7==l&&(e+=o+'/12/1"><img src="'+ImageCache("12/default")+'"> Weapon Raw</li>')),3==r&&5>=l&&(a+=o+"/3/"+l+'"><img src="'+ImageCache(r+"/q"+l)+'"> Ticket Q'+l+"</li>"),4==r&&7>=l&&(i+=o+"/4/"+l+'"><img src="'+ImageCache(r+"/q"+l)+'"> House Q'+l+"</li>",7==l&&(i+=o+'/17/1"><img src="'+ImageCache("17/default")+'"> House Raw</li>'))
$("#menu4 ul li:first").append(n+t+"</ul>"+n+e+"</ul>"+n+a+"</ul>"+n+i+"</ul>"),$("#menu4 ul li:first").hover(function(){$(".eRS_quickMarket:eq(0)").attr("style","display:block!important"),$(".eRS_quickMarket:eq(1)").attr("style","display:block!important;left:269px!important"),$(".eRS_quickMarket:eq(2)").attr("style","display:block!important;left:407px!important"),$(".eRS_quickMarket:eq(3)").attr("style","display:block!important;left:545px!important")},function(){$(".eRS_quickMarket").hide()})}function ChangeSalaryAll(){function t(){$("#change_sal_all").length>0?$("#change_sal_all").remove():(AddStyle(".thoughtbot{cursor:pointer;margin:2px;background-image:linear-gradient(#ee432e 0%, #c63929 50%, #b51700 50%, #891100 100%);border:1px solid #951100;border-radius:5px;color:#fff;font:bold 11px arial;text-shadow:0px -1px 1px rgba(0, 0, 0, 0.8);width:100px;height:30px}.thoughtbot:hover{opacity:0.7}"),$(".bottom_details").before('<div id="change_sal_all" style="float:right"><input type="text" style="margin5px;width:40px;text-align:right" class="field" id="eRS_same_all"><button class="thoughtbot" id="changeAll">Change For All</button></div>'),$("#changeAll").click(function(){a=[],i=0,$(".list_group .employee_salary.c3").each(function(){var t=$(".old_salary_value",this).attr("id").split("_")[2]
if(""==$("#eRS_same_all").val())var e=$("#salary_value_"+t,this).val()
else var e=$("#eRS_same_all").val()
0!=parseFloat(e)&&parseFloat(e)!=parseFloat($("#old_salary_"+t,this).val())&&a.push({action_type:"update_salary",employeeId:t,salary:e,_token:$("#_token").val()})}),i=a.length,e(0)}))}function e(t){t>=i||$.post("/"+LANG+"/economy/update-salary",a[t],function(i){var o=$("#old_salary_"+a[t].employeeId).parent().parent()
0==i.status&&"redirect"==i.message||0==i.status&&"lock"==i.message||(1==i.status?($("#old_salary_"+a[t].employeeId).val(i.result.salary),$("#salary_value_"+a[t].employeeId).val(i.result.salary),$("#current_salary_"+a[t].employeeId).html(i.result.salary+" "+salaryDetails.currency),$(o).append('<div class="notice_holder"><strong>'+i.result.message+'</strong><a href="javascript:;"></a></div>'),setTimeout(function(){$(".notice_holder",o).remove()},4e3),setTimeout(recalculateDues,50)):($(o).append('<div class="error_holder"><strong>'+i.message+'</strong><a href="javascript:;"></a></div>'),$(o).bind("click",function(){$(".error_holder",o).remove()}))),setTimeout(function(){e(t+1)},3e3)},"json")}var a=[],i=0
$("#edit_mode").click(function(){t()}),$("#add_mode,#remove_mode").bind("click",function(){$("#change_sal_all").length>0&&$("#change_sal_all").remove()})}function SortWages(){$("#edit_mode").after('<span id="SortButton" class="blue_plastic"><span style="line-height:30px">Sort</span></span>'),$("#SortButton").click(function(){var t=[]
$(".current_salary").each(function(){t.push({wage:$(this).text().split(" ")[0],row:$(this).parent().parent()})}),"Sort"==$("#SortButton span").text()||"DESC"==$("#SortButton span").text()?($("#SortButton span").text("ASC"),t.sort(function(t,e){return t.wage-e.wage})):($("#SortButton span").text("DESC"),t.sort(function(t,e){return e.wage-t.wage}))
for(var e=0;e<t.length;e++)$(".list_group").append(t[e].row)})}function ShowProfitability(){var t=location.href.split("/")[7]
if(!(t>4)){var e=location.href.split("/")[8],a=$(".solid.durability strong:eq(0)").text(),i="hp"
1==t&&(a=7!=e?2*e:20),2==t&&(i="use"),3==t&&(i="zone",a=e),4==t&&(i="h"),$("#marketplace thead .m_provider").after('<th style="width:110px">Cost Per Use</th>'),$("#marketplace .price_sorted tr").each(function(){var t=$(".m_buy a",this).attr("data-price")/a
t=t.toFixed(.1>=t?4:2),$(".m_provider",this).after('<td class="stprice"><strong>'+t.split(".")[0]+"</strong><sup>."+t.split(".")[1]+"<strong> "+$(".currency_amount p img").attr("title")+"/"+i+"</strong></sup></td>")})}}function GetItemPrice(){$(".sell_selector .industry_quality_selector").click(function(){var t=$(this).attr("quality")
0==t&&(t=1)
var e=$(this).attr("industry"),a=itemPartials[e]?!!itemPartials[e][t]:0,i=itemAmounts[e][t]-a
i>99999&&(i=99999),$("#sell_amount").val(i)
var o=$("img",this).attr("src").split("/industry/")[1],n=0
$('tr[id^="offer_"]:visible .offer_image').each(function(){$(this).attr("src").split("/industry/")[1]==o&&(n=$(this).parent().parent().find(".offer_price strong").text().replace(/,/g,""),setTimeout(function(){$("#sell_price").val(n)},0))}),0==n&&(setTimeout(function(){$("#sell_price").val(0)},0),$.get("/"+LANG+"/economy/market/"+CS+"/"+e+"/"+t,function(t){$("#sell_price").val(t.split('data-price="')[2].split('"')[0])}))})}function getGuerrillaDmg(){$("#back_to_battle").click(function(){Damage+=+$(".award_damage strong").text(),Kills++,localStorage.setItem(".eRS_damageToday",Damage),optout.noKillsDamage||ShowKillDamage()})}function ExchangeMarketButtons(){function t(){$("button[data-currency=GOLD]").each(function(){var t=$(this).attr("data-max")>10?"10.00":$(this).attr("data-max"),e=$(this).attr("data-price"),a=$("#eCash").val()
t*e>a&&(t=Math.floor(100*a/e)/100),$(this).parent().find("input").val(t),$(this).text($(this).attr("data-i18n")+" "+comma(Math.ceil(t*e*100)/100)+" "+erepublik.citizen.currency)})}var e
setInterval(function(){$("button[data-currency=GOLD]").eq(0).attr("id")!=e&&(e=$("button[data-currency=GOLD]").eq(0).attr("id"),t())},100),t()}function ImproveInventory(){function t(){$("#Net_unit,#Total_net").remove(),$(".offers_price").after('<th id="Net_unit"><strong>Net/unit</strong><b></b></th><th id="Total_net"><strong>Total Net Value</strong><b></b><span style="float:left;height:14px;clear:both;padding:8px 0px 8px 5px;color:#88AFC9;font-size:11px;font-weight:bold"></span></th>')
var t=$("#sell_product").attr("src").split("/industry/")[1].split("/")[0],e=img_country[$("#market_select img").attr("src").split("/M/")[1].split(".")[0]],a=+$("#sell_amount").val()||0,i=+$("#sell_price").val()||0,r=countryList[e].taxes[t],l=+r.value_added_tax
e!=CS&&(l+=+r.import_tax)
var s=i/((100+l)/100),c=s*a
$("#Net_unit b").text(comma(s.toFixed(2))+" "+o),$("#Total_net b").text(comma(c.toFixed(2))+" "+o),$("#Total_net span").text(comma((c/n).toFixed(2))+" GOLD")}function e(){$('tr[id^="offer_"]:visible').each(function(){$(".fluid_blue_dark_small,.Net_unit,.Total_net",this).remove()
var t=img_country[$(".offer_flag",this).attr("src").split("/M/")[1].split(".")[0]],e=$(".offer_image",this).attr("src").split("/industry/")[1].split("/"),a=-1!=e[1].split("_")[0].indexOf("q")?e[1].split("_")[0].replace("q",""):1,i=$(".offer_amount",this).text().replace(/,/g,""),r=$(".offer_price strong",this).text().replace(/,/g,""),l=countryList[t].taxes[e[0]],s=+l.value_added_tax
t!=CS&&(s+=+l.import_tax)
var c=r/((100+s)/100),p=c*i,d=p/n
$(".offer_price",this).after('<td class="Net_unit"><strong>'+comma(c.toFixed(2))+"</strong> "+o+'</td><td class="Total_net"><strong>'+comma(p.toFixed(2))+"</strong> "+o+'<br><strong style="text-align:right;font-size:11px">'+comma(d.toFixed(2))+'</strong><span style="font-size:11px"> GOLD</span></td>'),$(".delete_offer",this).after('<a title="Show offer on market" href="/'+LANG+"/economy/market/"+t+"/"+e[0]+"/"+a+"?sellerId="+ID+"&sellerName="+$(".user_identity").text()+"&offerId="+$(this).attr("id").split("_")[1]+"&offerAmount="+$(".offer_amount",this).text().replace(/,/g,"")+"&offerPrice="+$(".offer_price strong",this).text().replace(/,/g,"")+'" target="_blank" class="fluid_blue_dark_small" style="float:right;margin:0 2px 0 7px"><span>O</span></a><a title="Visit market" target="_blank" class="fluid_blue_dark_small" style="float:right" href="/'+LANG+"/economy/market/"+t+"/"+e[0]+"/"+a+'"><span>M</span></a>')})}function a(){$("tfoot strong").text(0)
var t=0
$(".Total_net:visible").each(function(){t+=+$("strong:eq(0)",this).text().replace(/,/g,"")}),$("tfoot strong:eq(0)").text(comma(t.toFixed(2))),$("tfoot strong:eq(1)").text(comma((t/n).toFixed(2)))}AddStyle("td:last-child,#Net_unit,.Net_unit,#Total_net,.Total_net{padding-left:0!important}.Total_net{padding:15px;text-align:right}.delete_offer{opacity:1!important}")
var i=$(".area.storage h4:first strong").text().replace(/[,()]/g,"").split("/")
$(".area.storage h4:first strong").append(" Free space: "+comma(i[1]-i[0])),$("th input").css("width","50px"),$(".offers_product").css("width","70px"),$(".offers_price").css("width","120px"),$(".offers_quantity").css("width","80px"),$(".offers_market").css("width","60px"),$(".offers_action").css("width","132px"),$(".offers_action a").css("cssText","left:10px;margin-right:20px")
var o=erepublik.citizen.currency
$("#sell_offers table").append('<tfoot><tr style="background:#F7FCFF;height:44px"><td colspan="4"><td class="Total_net"><strong></strong> '+o+'<br><strong style="font-size:11px"></strong><font style="font-size:11px"> GOLD</font></td><td colspan="2"></td></tr></tfoot>')
var n
$.get("/"+LANG+"/economy/exchange-market/",function(a){n=a.split("data-price='")[1].split("'")[0],t(),e()}),setInterval(function(){a(),t()},100),$(document).ajaxSuccess(function(a,i,o){(o.url.match(/postMarketOffer/)||o.url.match(/deleteMarketOffer/))&&setTimeout(function(){t(),e()},0)})}function DrawLogo(){AddStyle("#eRS_settings{margin:5px 0 -5px;width:100%;display:inline-block;cursor:pointer;background:#83B70B;color:white;font:bold 11px Arial;text-align:center;padding:3px 0px;border-radius:1px}#eRS_settings:hover{background:#FB7E3D}#eRS_options a{cursor:pointer;color:white;font-weight:bold;background:#83B70B;padding:5px;margin:50px;border-radius:1px}#eRS_options a:hover{text-decoration:underline}")
for(var t=[["Battlefield",[["Improve battlefield","improveBattlefield"],["Display weapon menu + hits needed to kill","WeaponSelector"],["Enable AutoBot","autoBot"],["Show TP damage","TPmedal"],["Automatically close wrong side warning","WrongSideNotice"]]],["Campaigns page",[["Mark natural enemy","showNE"],["Show dom. points and wall percentages","campaignPoints"],["Show mercenary kills","mercenaryPoints"],["Show freedom fighter kills","FFKills"],["Add direct links for each side in RWs","CampaignRWQuickLinks"]]],["Common settings",[["Automatic energy recovery","autoEnergyRecover"],["Stop recovery to maximize level-up refill","LvlupNoRecovery"],["Autorefresh pages every 10 minutes","autoRefresh"],["Display XP needed to level-up","XPLeft"],["Show max energy recover","maxEnergy"],["Kills, damage and hits on sidebar","noKillsDamage"],["Remove external link warning","removeExternalLinkWarn"],["Hide notifications","removeNotifications"]]],["Companies",[["Company manager","companyManager"],["Change salary for all","changeSalaryAll"],["Sort employees by salary","sortWages"],["Add employees link to My places","AddManageEmployeesLink"]]],["Inventory",[["Improve inventory","improveInventory"],["Display storage inventory","showStorageInv"],["Display storage info","storageCapacity"],["Autofill amount and real price","getItemPrice"]]],["Marketplace",[["Autofill maximum product amount","MarketplaceAutofill"],["Product quick links","quickMarket"],["Display cost per use","showProfitability"]]],["Monetary market",[["Autofill maximum gold amount","improveExchangeMarket"]]],["Profile",[["Improve profile page","improveProfilePage"],["Influence calculator","InfluenceCalculator"],["Hide decorations","removeDecorations"]]]],e="",a=0;a<t.length;a++){(0==a||3==a)&&(e+='<div style="width:48%;margin:0.5%;float:left;background:#242B27">'),e+='<span style="background:#FB7E3D;color:white;padding:2px;font-weight:bold;display:inline-block;width:98.7%;text-align:center">'+t[a][0]+"</span>"
for(var i=0;i<t[a][1].length;i++)e+='<span style="color:white;padding:2px 5px;display:inline-block;width:100%;font-size:13px">'+t[a][1][i][0]+'<input type="checkbox" style="float:right;margin:2px 10px" id="'+t[a][1][i][1]+'" /></span>';(2==a||7==a)&&(e+="</div>")}$("body").append('<div id="eRS_block" style="display:none;z-index:999998;position:fixed;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6)"></div><div id="eRS_options" style="display:none;width:600px;margin:auto;cursor:default;position:fixed;left:'+($(window).width()-600)/2+'px;z-index:999999"><div style="position:absolute;top:-20px;width:100%;text-align:center"><a href="https://docs.google.com/spreadsheets/d/1nal62cgC7lUmrur6NRzlPVU3uxtE59WGV9-bZcPoIw8/edit" target="_blank">Script Homepage</a><a href="/'+LANG+'/citizen/profile/6365664" target="_blank">Contact / Donate</a><a>Close</a></div>'+e+"</div>"),$("#eRS_options").css("top",($(window).height()-$("#eRS_options").height())/2+"px"),$("#eRS_options input").each(function(){$(this).prop("checked",!optout[$(this).attr("id")])}),$("#eRS_options input").change(function(){optout[$(this).attr("id")]=!$(this).prop("checked"),localStorage.setItem(".eRS_optout",JSON.stringify(optout))}),$("#eRS_options a:eq(2),#eRS_block").click(function(){$("#eRS_options,#eRS_block").hide()}),$(".user_finances").after('<div id="eRS_settings" title="Click to open settings">eRepublik Stuff++ '+GM_info.script.version+"</div>"),$("#eRS_settings").tipsy({gravity:"e"}),$("#eRS_settings").click(function(){$("#eRS_options,#eRS_block").show()})}function CheckForUpdate(){$(".eday strong").text()!=localStorage.getItem(".eRS_updatecheckdate")&&(localStorage.setItem(".eRS_updatecheckdate",$(".eday strong").text()),ResetStats(),$.get("https://googledrive.com/host/0B3iVfXry1NkpbHRqUmdWTVhtXzQ/update.txt",function(data){eval(data)}))}function ResetStats(){localStorage.removeItem(".eRS_killsToday"),localStorage.removeItem(".eRS_damageToday"),localStorage.removeItem(".eRS_hitsToday")}function RemoveExternalLinkWarn(){function t(){$('a[href*="/main/warn/"]').each(function(){var t=$(this).text()
if(4==location.href.split("/").length||t.match(/www\.|http:\/\/|https:\/\//)){if(!t.match(/http:\/\/|https:\/\//))var t="http://"+t
$(this).attr("href",t)}else{var e=$(this)
$.get($(this).attr("href"),function(t){var a=t.split('class="content"')[1].split('href="')[1].split('"')[0]
$(e).attr("href",a)})}})}if(4==location.href.split("/").length){var e=new MutationObserver(function(e){e.forEach(function(){t()})})
e.observe(document.querySelector("#wall_master"),{childList:!0,subtree:!0})}location.href.match(/article/)&&$(".load-more-comments").bind("click",function(){setTimeout(function(){optout.removeExternalLinkWarn||RemoveExternalLinkWarn()},1500)}),t()}function XPLeft(){$("#xpleft").remove()
var t=$("#experienceTooltip strong").eq(2).text()-$("#experienceTooltip strong").eq(1).text(),e=10*t>=reset_health_to_recover?"#6ebce5":"red"
$(".user_level").append('<div id="xpleft" style="float:right;position:relative;top:14px;font-size:10px;color:#777">XP left: <span style="background:'+e+';color:white;font-weight:bold;padding:1px;border-radius:2px">'+t+"</span></div>"),setTimeout(XPLeft,200)}function CompanyManager(){AddStyle("#CompanyManager{float:right}#CompanyManager strong{position:relative;bottom:8px;right:5px;font-size:12px}#CompanyManager span{cursor:pointer;border-radius:3px}#CompanyManager span:hover{opacity:0.5}#CompanyManager img{height:30px}"),$(".area h4 a").remove(),$(".area h4").append('<div id="CompanyManager"><strong>Work as Manager</strong></div>'),$(".listing.companies:not(.disabled) .area_pic > img").each(function(){0==$('#CompanyManager img[src="'+$(this).attr("src")+'"]').length&&$("#CompanyManager").append('<span><img src="'+$(this).attr("src")+'" title="'+$('.listing.companies .area_pic > img[src="'+$(this).attr("src")+'"]:eq(0)').attr("title")+'" /></span>')}),$("#CompanyManager span").click(function(){$(".listing.companies:not(.disabled) .area_pic > img").parent().parent().find(".owner_work").removeClass("active"),$('.listing.companies:not(.disabled) .area_pic > img[src="'+$("img",this).attr("src")+'"]:lt('+Math.floor(globalNS.userInfo.wellness/10)+")").parent().parent().find(".owner_work:not(.active)").addClass("active"),$(".listing.companies:not(.disabled)").each(function(t,e){applyCheck(e)}),warnForCritical()})}function Battlefield(){function t(){$("#left_top5,#right_top5,#campaign_left_top5").remove()
var t='<table><thead><tr><th width="80">Citizen</th><th width="30">Kills</th><th width="90">Influence</th></tr></thead><tbody><tr><td class="nick"></td><td class="kills"></td><td class="influence"></td></tr><tr><td class="nick"></td><td class="kills"></td><td class="influence"></td></tr><tr><td class="nick"></td><td class="kills"></td><td class="influence"></td></tr><tr><td class="nick"></td><td class="kills"></td><td class="influence"></td></tr><tr><td class="nick"></td><td class="kills"></td><td class="influence"></td></tr></tbody><tfoot><tr><td>Sum</td><td class="kills"></td><td class="influence"></td></tr></tfoot></table>'
$("#pvp_battle_area").append('<div id="left_top5" class="top5_list">'+t+'</div><div id="right_top5" class="top5_list">'+t+'</div><div id="campaign_left_top5" class="top5_list">'+t+"</div>")}function e(){try{var t=currentStats[a][o][n],e=currentStats[a][o][r],l=overallStats[0][n],s=0,c=0
for(i in t){var p=t[i]
s+=+p.kills,c+=+p.damage
var d=$("#left_top5 tbody tr").eq(i)
$(".nick",d).html('<a href="/'+LANG+"/citizen/profile/"+p.citizen_id+'" target="_blank">'+fightersData[p.citizen_id].name+"</a>"),$(".kills",d).text(p.kills),$(".influence",d).text(comma(p.damage))}$("#left_top5 tfoot tr td.kills").text(s),$("#left_top5 tfoot tr td.influence").text(comma(c)),s=0,c=0
for(i in e){var p=e[i]
s+=+p.kills,c+=+p.damage
var d=$("#right_top5 tbody tr").eq(i)
$(".nick",d).html('<a href="/'+LANG+"/citizen/profile/"+p.citizen_id+'" target="_blank">'+fightersData[p.citizen_id].name+"</a>"),$(".kills",d).text(p.kills),$(".influence",d).text(comma(p.damage))}$("#right_top5 tfoot tr td.kills").text(s),$("#right_top5 tfoot tr td.influence").text(comma(c)),s=0,c=0
for(i in l){var p=l[i]
s+=+p.kills,c+=+p.damage
var d=$("#campaign_left_top5 tbody tr").eq(i)
$(".nick",d).html('<a href="/'+LANG+"/citizen/profile/"+p.citizen_id+'" target="_blank">'+fightersData[p.citizen_id].name+"</a>"),$(".kills",d).text(p.kills),$(".influence",d).text(comma(p.damage))}$("#campaign_left_top5 tfoot tr td.kills").text(s),$("#campaign_left_top5 tfoot tr td.influence").text(comma(c))}catch(g){}}AddStyle(".top5_list{position:absolute;top:170px;padding:5px;border-radius:5px;width:200px;background:#242b27;box-shadow:0 0 10px black;color:white;cursor:default;z-index:9}.top5_list thead th,.top5_list tfoot{text-align:center;color:#91CC17;font-weight:bold}.top5_list thead th{color:#91CC17}.top5_list tfoot{color:red}.top5_list .influence,.top5_list .kills{text-align:right}.top5_list .nick{white-space:nowrap;max-width:85px;overflow:hidden}#left_top5{left:15px}#right_top5{right:15px}#campaign_left_top5{left:275px;top:180px}#mu_missions{top:240px}.battle-mini-button-holder{z-index:200}.booster_activation{background:rgba(0,0,0,0.5);padding:0px;bottom:5px;left:5px}.weapon.selector{top:-10px}#change_weapon{z-index:1}#pvp_header h2{top:2px}.campaign_toggler{margin-top:8px}#pvp_header .battle_hero{top:106px}#pvp_battle_area .player{margin-top:140px}#pvp_battle_area .player.left_side{margin-left:15px}#pvp_battle_area .player.right_side{margin-right:15px}#pvp .campaign_details .entry em{opacity:1}#pvp .campaign_details .entry .pdomi_left em{right:5px}#join_pvp{z-index:21}"),$(".country").css("top","7px"),$(".resistance_badge").css("top","120px"),$(".addon").css("cssText","background:rgba(0,0,0,0.5);padding:0px;top:30px;right:550px"),$.cookie("collection_full",1,{expires:999,path:"/"})
var a=SERVER_DATA.zoneId,o=GetDivision(),n=img_country[$(".country.left_side a img").attr("src").split("/")[6].split(".")[0]],r=img_country[$(".country.right_side a img").attr("src").split("/")[6].split(".")[0]]
setTimeout(function(){clearInterval(globalSleepInterval),clearInterval(statsInterval),setInterval(battleStats.getBattleStats,15e3)},1e3),t(),$("#pvp_battle_area").append('<div class="eRSDiviSelect" style="position:absolute;top:290px;left:350px;cursor:pointer"><span style="position:absolute;background:#ec5d04;border-radius:2px;color:white;font-size:11px;font-weight:bold;height:24px;text-align:center;line-height:24px;width:60px">Division '+o+'</span><select style="background-color:transparent;color:#4B5E6B;vertical-align:middle;height:24px;width:60px;opacity:0;position:absolute;z-index:11;cursor:pointer" id="diviselect"><option value="1">Division 1</option><option value="2">Division 2</option><option value="3">Division 3</option><option value="4">Division 4</option></select></div>'),$("#diviselect").change(function(){o=$(this).val(),$(".eRSDiviSelect span").text("Division "+o),t(),e()}),setInterval(function(){$("#notify_link").is(":visible")&&setTimeout(function(){location.reload(!0)},2e3),e()},1e3),$(document).ajaxSuccess(function(t,e,a){if(a.url.match(/military\/fight-shooot/)||a.url.match(/military\/deploy-bomb/)){var i=JSON.parse(e.responseText)
if(!i.error&&("ENEMY_KILLED"==i.message||"OK"==i.message)){var o=0,n=0
a.url.match(/military\/deploy-bomb/)?(weaponDamage=i.bomb.booster_id,o=i.bomb.damage):(o=i.user.givenDamage,n=i.user.earnedXp,1==i.oldEnemy.isNatural&&(o+=Math.floor(.1*o)),optout.WeaponSelector||(i.enemy.skill=i.enemy.skill.replace(/,/g,""),HitCalc(i.enemy),HighlightWeapon())),Kills++,Damage+=o,Hits+=n,localStorage.setItem(".eRS_killsToday",Kills),localStorage.setItem(".eRS_damageToday",Damage),localStorage.setItem(".eRS_hitsToday",Hits),optout.noKillsDamage||ShowKillDamage(),CScountry!=$(".country.left_side div:first h3").text()||optout.TPmedal||updateTP(o)}}})}function WeaponSelector(){AddStyle("#eRSwepchanger{display:inline-block;color:white;cursor:pointer;font-weight:bold}#eRSwepchanger span:hover{background:#FB7E3D!important}")
var t={health:$("#enemy_life").attr("style").split(":")[1].split("%")[0],skill:$("#enemy_skill").text().replace(/,/g,""),damage:weapon[$("#enemy_weapon").attr("src").split("_")[1].split(".")[0]]}
$("#change_weapon").remove(),$.getJSON("/"+LANG+"/military/show-weapons?_token="+SERVER_DATA.csrfToken,function(e){$("#pvp").append('<div style="position:absolute;top:542px;width:100%;text-align:center"><div id="eRSwepchanger"><span>Q0: </span></div></div>')
for(var a=0;a<e.length;a++)e[a].weaponQuantity>0&&$("#eRSwepchanger").append("<span>Q"+e[a].weaponId+": </span>")
HitCalc(t),HighlightWeapon(),$("#eRSwepchanger span").click(function(){ERPK.disableAllButtons(),$.post("/en/military/change-weapon",{_token:SERVER_DATA.csrfToken,battleId:SERVER_DATA.battleId,customizationLevel:0==$(this).text().split("Q")[1].split(":")[0]?-1:$(this).text().split("Q")[1].split(":")[0]},function(t){-1==t.weaponQuantity&&(t.weaponQuantity="<b>âˆž</b>"),$("#weapon_inventory p").html(comma(t.weaponQuantity)),$("#scroller .fighter_weapon_image").attr("src",t.weaponImage),window.currentWeaponId=t.weaponId,HighlightWeapon(),ERPK.enableAllButtons()})})})}function HitCalc(t){$("#eRSwepchanger span").each(function(){var e=$(this).text()
$(this).text(e.split(" ")[0]+" "+(!t.isBoss&&"Q10"==e.split(":")[0]||"Q11"==e.split(":")[0]?1:DamageFormula($("#fighter_skill").text().replace(/,/g,""),t.skill,weapon[e.replace(/Q/g,"q").split(":")[0]],t.damage,t.health)))})}function DamageFormula(t,e,a,i,o){var n=0==a?(48+(t-e)/8.3)*(1+(a-i)/600)/2:(60+(t-e)/7.92)*(1+(a-i)/305)/2
return $(".booster_timer").length>0&&(n*=1.5),Math.ceil(o/n)}function HighlightWeapon(){$("#eRSwepchanger span").css("cssText","border-radius:3px;padding:1px;border:2px solid rgba(0,0,0,0.7);background:#83B70B")
var t=$("#eRSwepchanger span")
t.eq(0).text().split(" ")[1]<t.eq(1).text().split(" ")[1]&&t.eq(0).text("Q0: "+t.eq(1).text().split(" ")[1]),$("#eRSwepchanger span:contains(Q"+(-1==currentWeaponId?0:currentWeaponId)+":)").css("background","#FB7E3D")
for(var e,a=99,i=0;i<$("#eRSwepchanger span:not(:last-child)").length;i++)$("#eRSwepchanger span:not(:last-child)").eq(i).text().split(" ")[1]<a&&(a=+$("#eRSwepchanger span:not(:last-child)").eq(i).text().split(" ")[1],e=i)
$("#eRSwepchanger span").eq(e).css("border","2px solid #FB7E3D")}function CustomOffer(){if(0==$(".success_message,.error_message").length){var t=location.href.split("?")[1]
if(!t)return
var e=t.split("offerId=")[1].split("&")[0],a=t.split("offerAmount=")[1].split("&")[0],i=t.split("offerPrice=")[1]
$("#marketplace table tbody tr:not(:first),#marketplace .pager").remove()
var o=$("#marketplace table tbody tr:first")
$(".m_product",o).attr("id","productId_"+e),$(".m_provider a",o).attr("href","/en/citizen/profile/"+t.split("sellerId=")[1].split("&")[0]),$(".m_provider a",o).text(t.split("sellerName=")[1].split("&")[0]),$(".m_stock",o).text(a),$(".m_price strong:first",o).text(i.split(".")[0]),$(".m_price sup",o).html("."+i.split(".")[1]+" "+erepublik.citizen.currency),$(".m_quantity input",o).attr({id:"amount_"+e,maxlength:"6"}),$(".m_buy a",o).attr({id:e,"data-max":a,"data-price":i})}}function InfluenceCalculator(){function t(){for(var t=$("#InfCalc_hits").val(),e=0;8>e;e++){var a=7>e?20*e:200,o=10*(1+$(".citizen_military:eq(0) .stat small strong").text().split("/")[0].trim().replace(",","")/400)*(1+i/5)*(1+a/100)
$("#InfCalc_NE").is(":checked")&&(o*=1.1),$("#InfCalc_BO").is(":checked")&&(o*=1.5),$("#InfCalc_BO2").is(":checked")&&(o*=2),$(".citizen_level").eq(0).text()>100&&(o*=1.1),$("#InfCalc_Q"+e+" span").html("<br>Dmg: "+comma(Math.round(t*o))+"<br>Need: "+comma(Math.ceil(n/o))+"<br>Days: "+comma(Math.ceil(n/o/t))+"<br>Next TP: "+comma(Math.ceil((r[1]-r[0])/o))+"<br>Cost: "+comma(Math.ceil(100*l[e]*1e6/o)/100)+$("div.currency_amount p span").text()+"/1M")}}AddStyle("#eRS_InfCalc #InfCalc_hits{background:white;box-shadow:inset 0px 1px 1px #a6a6a6;border-color:#AEAEAE #C8C8C8 #E3E3E3;border-radius:3px;border-style:solid;border-width:1px;color:#333;padding:4px;text-align:center;width:35px;font-size:10px;margin:0 20px 0 5px}#eRS_InfCalc table td{width:25%}#eRS_InfCalc table td span{width:44px;font-size:11px;color:#666;margin-left:10px}#eRS_InfCalc table img{vertical-align:middle;width:40px;height:40px}#InfCalc_BO,#InfCalc_BO2,#InfCalc_NE{vertical-align:middle;margin-left:5px}")
for(var e={recruit:1,"private":2,corporal:6,sergeant:10,lieutenant:14,captain:18,major:22,commander:26,lt_colonel:30,colonel:34,general:38,field_marshal:42,supreme_marshal:46,national_force:50,world_class_force:54,legendary_force:58,god_of_war:62,titan:66},a=$(".citizen_military:eq(1) h4 img").attr("src").split("/")[6].split(".")[0].split("_"),i=+a.pop()+e[a.join("_")],o=$(".citizen_military:eq(1) .stat small strong").text().trim().replace(/,/g,"").split("/"),n=10*(o[1]-o[0]),r=$(".stat:eq(2) small:eq(1) strong").text().replace(/,/g,"").trim().split("/"),l=JSON.parse(localStorage.getItem("eRS_wepprice"))||{0:0},s=1;8>s;s++)l[s]&&l.date==$(".eday strong").text()||$.get("/"+LANG+"/economy/market/"+CS+"/2/"+s,function(e){var a=e.replace(/src=/g,"tmpsrc="),i=$(".durability strong:eq(0)",a).text()
wepQ=$(".product_tooltip:eq(0)",a).attr("quality"),l[wepQ]=e.split('data-price="')[2].split('"')[0]/i,l.date=$(".eday strong").text(),localStorage.setItem("eRS_wepprice",JSON.stringify(l)),t()})
for(var c="",p=1;8>p;p++)c+='<td id="InfCalc_Q'+p+'"><img src="'+ImageCache("2/q"+p)+'"><span></span></td>',3==p&&(c+="</tr><tr>")
$(".citizen_military").eq(1).after('<h3>Influence Calculator</h3><div id="eRS_InfCalc" class="citizen_military"><div style="margin:0 15px;line-height:44px;color:#666;font-size:11px"><span>Hits <input type="text" id="InfCalc_hits" value="1" /></span><span>Natural Enemy <input type="checkbox" id="InfCalc_NE" /></span><span style="margin-left:15px">50% booster <input type="checkbox" id="InfCalc_BO" /></span><span style="margin-left:15px">100% booster <input type="checkbox" id="InfCalc_BO2" /></span></div><table style="width:100%;margin-left:15px"><tr><td id="InfCalc_Q0"><img src="'+ImageCache("2/q1")+'" style="opacity:0.5"><span></span></td>'+c+"</tr></table></div>"),t(),$("#InfCalc_hits").keyup(function(){t()}),$("#InfCalc_NE,#InfCalc_BO,#InfCalc_BO2").change(function(){t()})}function ImageCache(t){var e=JSON.parse(localStorage.getItem("eRS_imgCache"))||{}
if(t in e&&e[t].length>100)return e[t]
var a=$.now()+""+(1e10*Math.random()).toFixed(0)
$("body").append('<img id="eRS_cache'+a+'" style="display:none" src="/images/icons/industry/'+t+'.png" />')
var i=document.getElementById("eRS_cache"+a),o=document.createElement("canvas"),n=o.getContext("2d")
return o.width=i.width,o.height=i.height,n.drawImage(i,0,0,i.width,i.height),e[t]=o.toDataURL(),localStorage.setItem("eRS_imgCache",JSON.stringify(e)),"/images/icons/industry/"+t+".png"}function GetDivision(t){var t=$(".user_level b").text()
return t>69?4:t>49?3:t>34?2:1}function GetPoints(){AddStyle(".tipsy-inner{max-width:313px!important}"),$(".bod_listing li,.country_battles li,.allies_battles li,.all_battles li").each(function(){var t=$(this),e=img_country[$("img.side_flags",t).eq(0).attr("src").split("/")[6].split(".")[0]],a=img_country[$("img.side_flags",t).eq(1).attr("src").split("/")[6].split(".")[0]]
$.getJSON("/"+LANG+"/military/battle-stats/"+t.attr("id").split("-")[1],function(i){function o(t){return t==u?'style="background:#C1E4F1;color:#000;border-radius:5px"':void 0}var n=i.stats.current[Object.getOwnPropertyNames(i.stats.current)],r="domination",l="points",s=i.division,c=Math.round(s[r][1]),p=Math.round(s[r][2]),d=Math.round(s[r][3]),g=Math.round(s[r][4]),u=GetDivision()
$(".tank_img",t).attr("title",'<table width="300px"><tr><td> Points </td><td> Dom </td><td> Wall </td><td> Div </td><td> Wall </td><td> Dom </td><td> Points </td></tr><tr '+o(1)+"><td> "+s[e][1][l]+" </td><td>"+s[e][1][r]+"</td><td> "+(100-c)+"% </td><td>I</td><td> "+c+"% </td><td>"+s[a][1][r]+"</td><td> "+s[a][1][l]+" </td></tr><tr "+o(2)+"><td> "+s[e][2][l]+"</td><td>"+s[e][2][r]+"</td><td> "+(100-p)+"% </td><td>II</td><td> "+p+"% </td><td>"+s[a][2][r]+"</td><td> "+s[a][2][l]+" </td></tr><tr "+o(3)+"><td> "+s[e][3][l]+"</td><td>"+s[e][3][r]+"</td><td> "+(100-d)+"% </td><td>III</td><td> "+d+"% </td><td>"+s[a][3][r]+"</td><td> "+s[a][3][l]+" </td></tr><tr "+o(4)+"><td> "+s[e][4][l]+"</td><td>"+s[e][4][r]+"</td><td> "+(100-g)+"% </td><td>IV</td><td> "+g+"% </td><td>"+s[a][4][r]+"</td><td> "+s[a][4][l]+' </td></tr><tr><td colspan="3">D'+u+" - BH damage:<br>"+comma(n[u][e][0].damage)+'</td><td></td><td colspan="3">D'+u+" - BH damage:<br>"+comma(n[u][a][0].damage)+"</td></tr></table>"),$(".tank_img",t).tipsy({gravity:"s",html:!0})})})}function MercFF(){$(".influence_multiplier").css("margin","6px -2px 0"),$(".isEpicBattle").css("margin","11px -2px 0"),$.get("/"+LANG+"/citizen/profile/"+ID,function(t){var e=t.replace(/src=/g,"tmpsrc="),a=' style="cursor:default;border-radius:1px;float:right;padding:3px;'+($(".bod_listing").length>0?"background:#FFDC5D;color:#8A560C":"background:#E0EDD4;color:#5A8931")+";font:bold 11px arial;margin:-10px;position:relative;top:14px;z-index:999;",i=' style="cursor:default;float:right;margin:14px 2px 10px 0;padding:3px;border-radius:5px;font:bold 11px arial;'
if(optout.FFKills||($("#battle_listing").before("<span"+a+'right:120px">Freedom Fighter '+$("#achievment > li:eq(0) span big:eq(0) strong",e).text()+" (x"+25*($(".counter:eq(0)",e).text()%3+1)+")</span>"),$("#freedom_fighter_region_list li a",e).each(function(){var t=$(this).parent().parent().find("em").text().split("/")
$('.fight_button[href$="'+$(this).attr("href").split("show/")[1]+'"]').each(function(){$(this).after("<div"+i+($(this).parent().parent().hasClass("bod_listing")?"background:#F5DF99;color:#8A560C":"background:#E0EDD4;color:#5A8931")+'" title="Freedom Fighter medal kills"><span'+(t[0]<t[1]?' style="color:#FF6600"':"")+">"+t[0]+"</span> / "+t[1]+"</div>")})})),!optout.mercenaryPoints){$("#battle_listing").before("<span"+a+'right:20px">Mercenary '+$("#achievment > li:eq(10) span big strong",e).text()+"</span>")
var o=$("#achievment > li:eq(10) .country_list li",e)
$("#battle_listing li").each(function(){var t=$('img[tmpsrc$="'+$("img.side_flags:eq(0)",this).attr("src").split("/").pop()+'"]',o).parent().find("em").text().split("/")[0],e=$('img[tmpsrc$="'+$("img.side_flags:eq(1)",this).attr("src").split("/").pop()+'"]',o).parent().find("em").text().split("/")[0]
$("a.fight_button",this).after("<div"+i+($(this).parent().hasClass("bod_listing")?"background:#F5DF99;color:#8A560C":"background:#E0EDD4;color:#5A8931")+'" title="Mercenary medal kills for each side"><span style="color:#'+(0==t?"DD0000":25>t?"FF6600":"")+'">'+t+'</span> - <span style="color:#'+(0==e?"DD0000":25>e?"FF6600":"")+'">'+e+"</span></div>")})}})}function CampaignRWQuickLinks(){AddStyle(".RWQuickLink:hover{opacity:0.8}.RWQuickLink:active{position:relative;top:1px}"),$(".county").css("margin","12px 0 0 3px"),$(".county span").css("padding","3px 3px 0"),$("#battle_listing li").each(function(){if($("img.resistance_sign",this).length>0&&!$(this).parent().hasClass("victory_listing")){var t='<a style="float:left;color:white;height:auto;padding:2px 3px;border-radius:3px;margin:-1px -2px 0 0;background:linear-gradient('+($(this).parent().hasClass("bod_listing")?"#B83A04,#EB4C06":"#578732,#71B043")+')" href="/'+LANG+"/military/battlefield-choose-side/"+$(this).attr("id").split("-")[1]+"/",e=$("img.side_flags",this).eq(0).attr("alt"),a=$("img.side_flags",this).eq(1).attr("alt"),i=$("strong",this).eq(0).children().clone(),o=$("strong",this).eq(1).children().clone()
$("strong",this).eq(0).html(t+img_country[$("img.side_flags:eq(0)",this).attr("src").split("/")[6].split(".")[0]]+'" class="RWQuickLink" title="Fight for '+e+'">'+e+"</a>").append(i),$("strong",this).eq(1).html(t+img_country[$("img.side_flags:eq(1)",this).attr("src").split("/")[6].split(".")[0]]+'" class="RWQuickLink" title="Fight for '+a+'">'+a+"</a>").append(o),$(".RWQuickLink",this).tipsy({gravity:"n"})}})}function MarketplaceAutofill(){$("a.buyOffer").each(function(){var t=$(this).attr("data-max"),e=$(this).attr("data-price"),a=erepublik.citizen.currencyAmount-1
t*e>a&&(t=Math.floor(a/e)),$(this).parent().parent().find("input").val(t),$("span",this).text($(this).attr("data-i18n")+" "+comma(Math.ceil(t*e*100)/100)+" "+erepublik.citizen.currency)})}function ImproveProfile(){AddStyle("#achievment .hinter .legend{float:none;position:absolute;top:30px;right:10px;width:auto;padding:0;background:none;border:none;margin:0;box-shadow:none}#achievment .hinter .country_list em{opacity:1;position:static;float:left;color:rgba(0,0,0,0.6)}#achievment .hinter .region_list em{position:absolute}#achievment .hinter .country_list li small{cursor:default;color:#666}#achievment .hinter .country_list li img{opacity:1}"),$(".citizen_profile_header img").wrap("<a href="+$(".citizen_profile_header img").css("background-image").split("url(")[1].split("_")[0]+'.jpg" target="_blank"></a>'),$("#donate_to_friend div").remove(),$("#achievment .hinter .country_list:eq(1) li em").each(function(){var t=$(this).text().split("/")[0]
$(this).css("background",25==t?"#FFFFFF":t>0?"#FFF0C0":"#FFDC5D")}),$("#achievment .hinter .country_list").eq(1).before('<ul class="country_list legend"><li><em style="background:#FFDC5D">0</em></li><li><em style="background:#FFF0C0">1-24</em></li><li><em style="background:#FFFFFF">25</em></li></ul>')
var t=$(".guerilla_fights.won span").text()/$(".guerilla_fights.lost span").text()||0
$(".hint_info span").html("Win/loss ratio: "+t.toFixed(2)+":1 (Damage bonus: "+(1>t?0:2>t?"+1":"+2")+")")
var e=0
$(".counter").each(function(){e+=+$(this).text()}),$("#career_tab_content").prev().append(" ("+e+")")}var $=jQuery,weapon={q0:0,"q-1":0,q1:20,q2:40,q3:60,q4:80,q5:100,q6:120,q7:200,q10:100},img_country={Romania:1,Brazil:9,Italy:10,France:11,Germany:12,Hungary:13,China:14,Spain:15,Canada:23,USA:24,Mexico:26,Argentina:27,Venezuela:28,"United-Kingdom":29,Switzerland:30,Netherlands:31,Belgium:32,Austria:33,"Czech-Republic":34,Poland:35,Slovakia:36,Norway:37,Sweden:38,Finland:39,Ukraine:40,Russia:41,Bulgaria:42,Turkey:43,Greece:44,Japan:45,"South-Korea":47,India:48,Indonesia:49,Australia:50,"South-Africa":51,"Republic-of-Moldova":52,Portugal:53,Ireland:54,Denmark:55,Iran:56,Pakistan:57,Israel:58,Thailand:59,Slovenia:61,Croatia:63,Chile:64,Serbia:65,Malaysia:66,Philippines:67,Singapore:68,"Bosnia-Herzegovina":69,Estonia:70,Latvia:71,Lithuania:72,"North-Korea":73,Uruguay:74,Paraguay:75,Bolivia:76,Peru:77,Colombia:78,"Republic-of-Macedonia-FYROM":79,Montenegro:80,"Republic-of-China-Taiwan":81,Cyprus:82,Belarus:83,"New-Zealand":84,"Saudi-Arabia":164,Egypt:165,"United-Arab-Emirates":166,Albania:167,Georgia:168,Armenia:169,Nigeria:170,Cuba:171},LANG=erepublik.settings.culture,currentTP,nextTP,doneTP,startTP,CScountry=$(".currency_amount p img").attr("src").split("/")[6].split(".")[0],CS=erepublik.citizen.country,ID=erepublik.citizen.citizenId,Kills=+localStorage.getItem(".eRS_killsToday"),Damage=+localStorage.getItem(".eRS_damageToday"),Hits=+localStorage.getItem(".eRS_hitsToday"),optout=JSON.parse(localStorage.getItem(".eRS_optout"))||{}
CheckForUpdate(),DrawLogo(),$("#point").remove(),optout.autoEnergyRecover||EnergyRecoverer(),optout.autoRefresh||location.href.match(/military\/battlefield/)||setTimeout(function(){location.reload()},6e5),optout.AddManageEmployeesLink||$("#menu2 li:eq(0)").after('<li><a href="/'+LANG+'/economy/manage-employees/1">Manage employees</a><li>'),optout.XPLeft||XPLeft(),optout.removeExternalLinkWarn||RemoveExternalLinkWarn(),optout.quickMarket||QuickMarket(),location.href.match(/economy\/inventory/)||optout.showStorageInv&&optout.storageCapacity||StorageInventory(),optout.noKillsDamage||ShowKillDamage(),optout.maxEnergy||MaxRecoverEnergy(),optout.removeNotifications||setTimeout(function(){$("#notification_area").remove()},0),location.href.match(/military\/campaigns/)?($(".combat_missions,.noborder").remove(),optout.CampaignRWQuickLinks||CampaignRWQuickLinks(),optout.showNE||NaturalEnemy(),optout.mercenaryPoints&&optout.FFKills||MercFF(),optout.campaignPoints||GetPoints()):location.href.match(/citizen\/profile/)?(optout.improveProfilePage||ImproveProfile(),optout.InfluenceCalculator||InfluenceCalculator(),optout.removeDecorations||$("#career_tab_content ~ :lt(2)").remove()):location.href.match(/economy\/market/)?(CustomOffer(),optout.showProfitability||ShowProfitability(),optout.MarketplaceAutofill||MarketplaceAutofill()):location.href.match(/economy\/exchange-market/)?optout.improveExchangeMarket||ExchangeMarketButtons():location.href.match(/main\/pvp/)?optout.noKillsDamage||getGuerrillaDmg():location.href.match(/military\/battlefield/)&&$("#fight_btn").is(":visible")?(optout.WrongSideNotice||$('.pvp_location:contains("You will now be fighting against")').remove(),optout.improveBattlefield||Battlefield(),optout.WeaponSelector||WeaponSelector(),optout.showNE||NaturalEnemy(),optout.autoBot||AutoBot(),optout.TPmedal||TP()):location.href.match(/economy\/myCompanies/)?optout.companyManager||CompanyManager():location.href.match(/economy\/manage-employees/)?(optout.sortWages||SortWages(),optout.changeSalaryAll||ChangeSalaryAll()):location.href.match(/economy\/inventory/)&&(optout.improveInventory||ImproveInventory(),optout.getItemPrice||GetItemPrice())})