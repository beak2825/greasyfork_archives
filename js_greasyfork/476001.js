// ==UserScript==
// @name         mt-work-enhancement
// @namespace    https://rachpt.cn/
// @version      2025.12.03.1137
// @author       rachpt
// @description  日常工作提效工具包
// @license      MIT
// @icon         https://s3plus.meituan.net/v1/mss_e2821d7f0cfe4ac1bf9202ecf9590e67/cdn-prod/file:1040877d/favicon-mt.ico
// @include      /^https?:\/\/yuntu\.(sankuai|keetapp)\.com\/.*$/
// @match        http://127.0.0.1:7070/*
// @match        http*://km.sankuai.com/*
// @match        http*://sre.sankuai.com/*
// @match        http*://iomp.sankuai.com/*
// @match        http*://*.mws.sankuai.com/*
// @match        http*://*.mws.keetapp.com/*
// @match        http*://rhino.sankuai.com/*
// @match        http*://rocket.sankuai.com/*
// @match        http*://timebird.sankuai.com/*
// @match        http*://auth.sankuai.com/add*
// @match        http*://*.inf.st.sankuai.com/*
// @match        http*://*.inf.dev.sankuai.com/*
// @match        http*://km.it.test.sankuai.com/*
// @match        http*://*.mws-test.sankuai.com/*
// @match        http*://nest.sankuai.com/preview
// @match        http*://sre.sre.test.sankuai.com/*
// @match        http*://calendar.sankuai.com/rooms
// @match        http*://auth.sankuai.com/res-query*
// @match        http*://auth.sankuai.com/auth-query*
// @match        http*://*.yuntu-manage.sankuai.com/*
// @match        http*://auth.sankuai.com/user/dynamic
// @match        http*://*.mws.cloud.test.sankuai.com/*
// @match        http*://nest.inf.test.sankuai.com/preview
// @match        http*://yuntu-manage.sankuai.com/datasource/default
// @exclude      *://yuntu.*showHeader=false*
// @exclude      *://yuntu.*openRefUrl=*
// @exclude      *://aiplayground.mws.sankuai.com*
// @connect      nest.inf.test.sankuai.com
// @connect      sre.sre.test.sankuai.com
// @connect      avatar.mws.sankuai.com
// @connect      domain.mws.sankuai.com
// @connect      rhino.mws.sankuai.com
// @connect      octo.mws.sankuai.com
// @connect      frigate.sankuai.com
// @connect      rocket.sankuai.com
// @connect      nocode.sankuai.com
// @connect      ssosv.sankuai.com
// @connect      yuntu.sankuai.com
// @connect      iomp.sankuai.com
// @connect      nest.sankuai.com
// @connect      octo.sankuai.com
// @connect      ccmp.sankuai.com
// @connect      mws.sankuai.com
// @connect      sre.sankuai.com
// @connect      km.sankuai.com
// @connect      sc.sankuai.com
// @connect      127.0.0.1
// @grant        GM_addStyle
// @grant        GM_getValue
// @grant        GM_notification
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setClipboard
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// @downloadURL https://update.greasyfork.org/scripts/476001/mt-work-enhancement.user.js
// @updateURL https://update.greasyfork.org/scripts/476001/mt-work-enhancement.meta.js
// ==/UserScript==

(e=>{if(typeof GM_addStyle=="function"){GM_addStyle(e);return}const n=document.createElement("style");n.textContent=e,document.head.append(n)})(' dialog#__km-enhancement-app *{box-sizing:border-box}dialog#__km-enhancement-app h1,dialog#__km-enhancement-app h2,dialog#__km-enhancement-app h3,dialog#__km-enhancement-app h4,dialog#__km-enhancement-app h5,dialog#__km-enhancement-app h6,dialog#__km-enhancement-app p{margin:0}dialog#__km-enhancement-app button{background:none;border:none;cursor:pointer;outline:none;padding:0}dialog#__km-enhancement-app .flex{display:flex}dialog#__km-enhancement-app .flex-col{display:flex;flex-direction:column}dialog#__km-enhancement-app .items-center{align-items:center}dialog#__km-enhancement-app .justify-center{justify-content:center}dialog#__km-enhancement-app .justify-between{justify-content:space-between}dialog#__km-enhancement-app .flex-1{flex:1}dialog#__km-enhancement-app .w-full{width:100%}dialog#__km-enhancement-app .h-full{height:100%}dialog#__km-enhancement-app .mt-1{margin-top:4px}dialog#__km-enhancement-app .mt-2{margin-top:8px}dialog#__km-enhancement-app .mt-3{margin-top:12px}dialog#__km-enhancement-app .mt-4{margin-top:16px}dialog#__km-enhancement-app .mb-1{margin-bottom:4px}dialog#__km-enhancement-app .mb-2{margin-bottom:8px}dialog#__km-enhancement-app .mb-3{margin-bottom:12px}dialog#__km-enhancement-app .mb-4{margin-bottom:16px}dialog#__km-enhancement-app .ml-1{margin-left:4px}dialog#__km-enhancement-app .ml-2{margin-left:8px}dialog#__km-enhancement-app .ml-3{margin-left:12px}dialog#__km-enhancement-app .ml-4{margin-left:16px}dialog#__km-enhancement-app .mr-1{margin-right:4px}dialog#__km-enhancement-app .mr-2{margin-right:8px}dialog#__km-enhancement-app .mr-3{margin-right:12px}dialog#__km-enhancement-app .mr-4{margin-right:16px}dialog#__km-enhancement-app .mx-auto{margin-left:auto;margin-right:auto}dialog#__km-enhancement-app .text-center{text-align:center}dialog#__km-enhancement-app .text-xs{font-size:10px}dialog#__km-enhancement-app .text-sm{font-size:12px}dialog#__km-enhancement-app .text-md{font-size:14px}dialog#__km-enhancement-app .text-lg{font-size:16px}dialog#__km-enhancement-app .text-xl{font-size:20px}dialog#__km-enhancement-app .text-2xl{font-size:24px}dialog#__km-enhancement-app .text-3xl{font-size:28px}dialog#__km-enhancement-app .font-bold{font-weight:700}dialog#__km-enhancement-app .font-medium{font-weight:500}dialog#__km-enhancement-app .text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}dialog#__km-enhancement-app .text-primary{-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(90deg,#2563eb,#9333ea);color:transparent}dialog#__km-enhancement-app .border{border:1px solid #e5e7eb}dialog#__km-enhancement-app .rounded-sm{border-radius:4px}dialog#__km-enhancement-app .rounded-md{border-radius:6px}dialog#__km-enhancement-app .rounded-lg{border-radius:8px}dialog#__km-enhancement-app .rounded-full{border-radius:9999px}dialog#__km-enhancement-app .shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}dialog#__km-enhancement-app .shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}dialog#__km-enhancement-app .shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}dialog#__km-enhancement-app .scrollbar-hide{scrollbar-width:none;-ms-overflow-style:none}dialog#__km-enhancement-app .scrollbar-hide::-webkit-scrollbar{display:none}dialog#__km-enhancement-app .app-container{display:flex;flex-direction:column;height:100%;overflow:hidden}dialog#__km-enhancement-app .header{align-items:center;display:flex;justify-content:space-between;margin-bottom:16px}dialog#__km-enhancement-app .title{-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(90deg,#2563eb,#9333ea);color:transparent;font-size:28px;font-weight:700}dialog#__km-enhancement-app .close-button{align-items:center;background-color:transparent;border:none;border-radius:50%;color:#000;cursor:pointer;display:flex;font-size:24px;justify-content:center;padding:0 12px}dialog#__km-enhancement-app .content-container{background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;flex:1;max-height:300px;min-height:300px;padding:12px}dialog#__km-enhancement-app .tab-nav-container{display:flex;flex-direction:column;margin-bottom:16px}dialog#__km-enhancement-app .tab-list{border-bottom:1px solid #e5e7eb;display:flex;min-width:500px;overflow-x:auto;padding-bottom:1px}dialog#__km-enhancement-app .tab-button{background:transparent;border:none;color:#6b7280;cursor:pointer;flex-shrink:0;font-weight:500;outline:none;padding:8px 16px;position:relative;text-align:center;transition:all .3s}dialog#__km-enhancement-app .tab-button:hover{color:#374151}dialog#__km-enhancement-app .tab-button.active{color:#2563eb;font-weight:600}dialog#__km-enhancement-app .tab-button-text{white-space:nowrap}dialog#__km-enhancement-app .tab-indicator{background-image:linear-gradient(to right,var(--tw-gradient-stops));border-radius:6px 6px 0 0;bottom:0;height:3px;left:0;position:absolute;transform:translateY(0);transition:all .3s;width:100%}dialog#__km-enhancement-app .indicator-blue{--tw-gradient-from:#3b82f6;--tw-gradient-to:#2563eb;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}dialog#__km-enhancement-app .indicator-indigo{--tw-gradient-from:#6366f1;--tw-gradient-to:#4f46e5;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}dialog#__km-enhancement-app .indicator-purple{--tw-gradient-from:#a855f7;--tw-gradient-to:#9333ea;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}dialog#__km-enhancement-app .indicator-pink{--tw-gradient-from:#ec4899;--tw-gradient-to:#db2777;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}dialog#__km-enhancement-app .indicator-red{--tw-gradient-from:#ef4444;--tw-gradient-to:#dc2626;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}dialog#__km-enhancement-app .tooltip-container{align-items:center;display:inline-flex;justify-content:center;position:relative;width:100%}dialog#__km-enhancement-app .tooltip-icon{align-items:center;background-color:var(--tooltip-bg-color,rgba(99,102,241,.8));border-radius:9999px;color:#fff;cursor:help;display:flex;font-size:10px;font-weight:700;height:16px;justify-content:center;position:absolute;right:-6px;top:-6px;width:16px;z-index:10}dialog#__km-enhancement-app .tooltip-icon:before{content:"?";font-family:Arial,sans-serif;font-size:11px}dialog#__km-enhancement-app .tooltip-icon:hover:after{background-color:rgba(17,24,39,.9);border-radius:4px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);color:#fff;content:attr(data-tooltip);font-size:12px;font-weight:400;left:var(--tooltip-x,50%);line-height:1.4;max-width:250px;padding:6px 10px;pointer-events:none;position:fixed;text-align:center;top:var(--tooltip-y,0);transform:translate(-50%,-100%);transition:opacity .2s ease;white-space:normal;width:-moz-max-content;width:max-content;z-index:1000}dialog#__km-enhancement-app .tooltip-icon:hover:before{content:"";height:0;left:var(--tooltip-arrow-x,50%);margin-left:-6px;position:fixed;top:var(--tooltip-arrow-y,0);transition:all .2s ease;width:0;z-index:1001}.scrollbar{overflow-y:scroll;padding-right:6px;scrollbar-color:#d1d5db transparent;scrollbar-width:thin}.scrollbarr::-webkit-scrollbar{width:3px}.scrollbar::-webkit-scrollbar-track{background:transparent}.scrollbar::-webkit-scrollbar-thumb{background-color:#d1d5db;border-radius:3px}dialog#__km-enhancement-app .tab-content{height:400px;max-width:min(900px,60vw);overflow-x:hidden;overflow-y:auto;overflow-y:scroll;padding:8px 6px 8px 8px;scrollbar-color:#d1d5db transparent;scrollbar-width:thin;width:100%;width:max(600px,60vw)}dialog#__km-enhancement-app .tab-contentr::-webkit-scrollbar{width:3px}dialog#__km-enhancement-app .tab-content::-webkit-scrollbar-track{background:transparent}dialog#__km-enhancement-app .tab-content::-webkit-scrollbar-thumb{background-color:#d1d5db;border-radius:3px}dialog#__km-enhancement-app .category-section{margin-bottom:24px}dialog#__km-enhancement-app .category-title{border-bottom:1px solid #e5e7eb;color:#374151;font-size:16px;font-weight:600;margin-bottom:16px;padding-bottom:8px}dialog#__km-enhancement-app .items-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}dialog#__km-enhancement-app .function-item{align-items:center;background-color:#fff;border:1px solid #e5e7eb;border-radius:6px;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);cursor:pointer;display:flex;flex-direction:column;height:100%;justify-content:center;padding:8px;position:relative;transition:all .2s;width:100%}dialog#__km-enhancement-app .function-item:hover{border-color:#2563eb;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);transform:translateY(-2px)}dialog#__km-enhancement-app .function-item.disabled{cursor:not-allowed;opacity:.6}dialog#__km-enhancement-app .function-item.disabled:hover{border-color:#d1d5db;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);transform:none}dialog#__km-enhancement-app .function-item.blue{border-left:4px solid #bfdbfe}dialog#__km-enhancement-app .function-item.indigo{border-left:4px solid #c7d2fe}dialog#__km-enhancement-app .function-item.purple{border-left:4px solid #e9d5ff}dialog#__km-enhancement-app .function-item.pink{border-left:4px solid #fbcfe8}dialog#__km-enhancement-app .function-item.red{border-left:4px solid #fecaca}dialog#__km-enhancement-app .function-item.setting{background-color:#f3e8ff;border-left:4px solid #e9d5ff}dialog#__km-enhancement-app .function-header{align-items:center;display:flex;justify-content:center;text-align:center;width:100%}dialog#__km-enhancement-app .function-title{align-items:center;color:#1f2937;display:flex;font-size:14px;font-weight:600;justify-content:center;text-align:center}dialog#__km-enhancement-app .status-badge{border-radius:9999px;font-size:10px;font-weight:500;margin-left:8px;padding:2px 8px}dialog#__km-enhancement-app .status-badge.beta{background-color:#dbeafe;color:#1e40af}dialog#__km-enhancement-app .status-badge.new{background-color:#f3e8ff;color:#6b21a8}dialog#__km-enhancement-app .setting-dialog{min-width:700px}dialog#__km-enhancement-app .setting-title{color:#1f2937;font-size:20px;font-weight:600;margin-bottom:8px}dialog#__km-enhancement-app .hist-content{align-items:center;display:grid;gap:8px;grid-template-columns:auto 1fr auto;margin-bottom:20px;max-height:280px;overflow-y:auto;padding-right:4px}dialog#__km-enhancement-app .hist-content::-webkit-scrollbar{width:3px}dialog#__km-enhancement-app .hist-content::-webkit-scrollbar-track{background:#f3f4f6;border-radius:3px}dialog#__km-enhancement-app .hist-content::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}dialog#__km-enhancement-app .hist-content::-webkit-scrollbar-thumb:hover{background:#9ca3af}dialog#__km-enhancement-app .setting-label{font-weight:500;justify-self:end;min-width:90px;text-align:right}dialog#__km-enhancement-app .setting-input{border:1px solid #d1d5db;border-radius:6px;height:24px;padding:4px 8px;transition:all .2s;width:100%}dialog#__km-enhancement-app .setting-input:focus{border-color:#2563eb;box-shadow:0 0 0 1px #2563eb;outline:none}dialog#__km-enhancement-app .del-btn{background-color:#ef4444;border-radius:4px;border-right:2px solid #ef4444;color:#fff;padding:0 8px;transition:all .2s}dialog#__km-enhancement-app .del-btn:hover{background-color:#fca5a5;border-color:#fca5a5}dialog#__km-enhancement-app .add-new{display:flex;margin:16px 8px 20px}dialog#__km-enhancement-app .add-new .setting-label:after{color:#ef4444;content:"*";margin-left:1px}dialog#__km-enhancement-app .setting-menu{display:flex;flex-direction:row-reverse;gap:16px;text-align:end}dialog#__km-enhancement-app .setting-menu button{border-radius:4px;font-weight:500;padding:4px 8px;transition:all .2s}dialog#__km-enhancement-app .menu-submit{background-color:#22c55e;border-color:#22c55e;color:#fff;cursor:pointer;font-weight:700;padding:0 8px}dialog#__km-enhancement-app .menu-submit:hover{background-color:#4ade80;border-color:#4ade80}dialog#__km-enhancement-app .menu-close{background-color:#2563eb;border-color:#2563eb;color:#fff;cursor:pointer;font-weight:700;padding:0 8px}dialog#__km-enhancement-app .menu-close:hover{background-color:#60a5fa;border-color:#60a5fa}dialog#__km-enhancement-app .setting-message{background-color:#ffedd5;border-radius:4px;color:#dc2626;font-size:12px;padding:4px 8px}dialog#__km-enhancement-app .progress-container{align-items:center;background-color:#fff;border-radius:6px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);display:flex;flex-direction:column;justify-content:center;min-width:400px;padding:16px}dialog#__km-enhancement-app .progress-message{color:#374151;font-size:16px;font-weight:500;margin-bottom:16px;text-align:center}dialog#__km-enhancement-app progress{-webkit-appearance:none;-moz-appearance:none;appearance:none;height:8px;width:100%}dialog#__km-enhancement-app progress::-webkit-progress-bar{background-color:#e5e7eb;border-radius:9999px}dialog#__km-enhancement-app progress::-webkit-progress-value{background-image:linear-gradient(90deg,#2563eb,#9333ea);border-radius:9999px}dialog#__km-enhancement-app progress::-moz-progress-bar{background-image:linear-gradient(90deg,#2563eb,#9333ea);border-radius:9999px}dialog#__km-enhancement-app *{box-sizing:border-box}dialog#__km-enhancement-app h1,dialog#__km-enhancement-app h2,dialog#__km-enhancement-app h3,dialog#__km-enhancement-app h4,dialog#__km-enhancement-app h5,dialog#__km-enhancement-app h6,dialog#__km-enhancement-app p{margin:0}dialog#__km-enhancement-app button{background:none;border:none;cursor:pointer;outline:none;padding:0}dialog#__km-enhancement-app .flex{display:flex}dialog#__km-enhancement-app .flex-col{display:flex;flex-direction:column}dialog#__km-enhancement-app .items-center{align-items:center}dialog#__km-enhancement-app .justify-center{justify-content:center}dialog#__km-enhancement-app .justify-between{justify-content:space-between}dialog#__km-enhancement-app .flex-1{flex:1}dialog#__km-enhancement-app .w-full{width:100%}dialog#__km-enhancement-app .h-full{height:100%}dialog#__km-enhancement-app .mt-1{margin-top:4px}dialog#__km-enhancement-app .mt-2{margin-top:8px}dialog#__km-enhancement-app .mt-3{margin-top:12px}dialog#__km-enhancement-app .mt-4{margin-top:16px}dialog#__km-enhancement-app .mb-1{margin-bottom:4px}dialog#__km-enhancement-app .mb-2{margin-bottom:8px}dialog#__km-enhancement-app .mb-3{margin-bottom:12px}dialog#__km-enhancement-app .mb-4{margin-bottom:16px}dialog#__km-enhancement-app .ml-1{margin-left:4px}dialog#__km-enhancement-app .ml-2{margin-left:8px}dialog#__km-enhancement-app .ml-3{margin-left:12px}dialog#__km-enhancement-app .ml-4{margin-left:16px}dialog#__km-enhancement-app .mr-1{margin-right:4px}dialog#__km-enhancement-app .mr-2{margin-right:8px}dialog#__km-enhancement-app .mr-3{margin-right:12px}dialog#__km-enhancement-app .mr-4{margin-right:16px}dialog#__km-enhancement-app .mx-auto{margin-left:auto;margin-right:auto}dialog#__km-enhancement-app .text-center{text-align:center}dialog#__km-enhancement-app .text-xs{font-size:10px}dialog#__km-enhancement-app .text-sm{font-size:12px}dialog#__km-enhancement-app .text-md{font-size:14px}dialog#__km-enhancement-app .text-lg{font-size:16px}dialog#__km-enhancement-app .text-xl{font-size:20px}dialog#__km-enhancement-app .text-2xl{font-size:24px}dialog#__km-enhancement-app .text-3xl{font-size:28px}dialog#__km-enhancement-app .font-bold{font-weight:700}dialog#__km-enhancement-app .font-medium{font-weight:500}dialog#__km-enhancement-app .text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}dialog#__km-enhancement-app .text-primary{-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(90deg,#2563eb,#9333ea);color:transparent}dialog#__km-enhancement-app .border{border:1px solid #e5e7eb}dialog#__km-enhancement-app .rounded-sm{border-radius:4px}dialog#__km-enhancement-app .rounded-md{border-radius:6px}dialog#__km-enhancement-app .rounded-lg{border-radius:8px}dialog#__km-enhancement-app .rounded-full{border-radius:9999px}dialog#__km-enhancement-app .shadow-sm{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}dialog#__km-enhancement-app .shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}dialog#__km-enhancement-app .shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}dialog#__km-enhancement-app .scrollbar-hide{scrollbar-width:none;-ms-overflow-style:none}dialog#__km-enhancement-app .scrollbar-hide::-webkit-scrollbar{display:none}dialog#__km-enhancement-app .app-container{display:flex;flex-direction:column;height:100%;overflow:hidden}dialog#__km-enhancement-app .header{justify-content:space-between;margin-bottom:16px}dialog#__km-enhancement-app .title{-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(90deg,#2563eb,#9333ea);color:transparent;font-size:28px;font-weight:700}dialog#__km-enhancement-app .close-button{border-radius:50%;color:#000}dialog#__km-enhancement-app .content-container{background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;flex:1;max-height:300px;min-height:300px;padding:12px}dialog#__km-enhancement-app .app{display:flex;flex-direction:column;height:100%;overflow:hidden;text-align:center;width:100%}dialog#__km-enhancement-app .close-button{align-items:center;background-color:transparent;border:none;border-radius:9999px;color:#1f2937;cursor:pointer;display:flex;font-size:24px;justify-content:center;padding:0 12px;transition:all .2s}dialog#__km-enhancement-app .close-button:hover{background-color:#f3f4f6;color:#111827}dialog#__km-enhancement-app .header{align-items:center;background-color:#4b5563;color:#fff;display:flex;flex-direction:column;font-size:calc(10px + 2vmin);justify-content:center;min-height:40vh;min-width:600px;width:60vw}dialog#__km-enhancement-app .app-title{-webkit-background-clip:text;background-clip:text;background-image:linear-gradient(90deg,#2563eb,#9d174d,#166534);color:transparent;font-size:28px;font-weight:700}dialog#__km-enhancement-app .app-header{align-items:center;display:flex;justify-content:space-between;margin-bottom:12px}dialog#__km-enhancement-app .header-title-container{display:flex;flex:1;justify-content:center}dialog#__km-enhancement-app .link{color:#f3e8ff}dialog#__km-enhancement-app .blank,dialog#__km-enhancement-app .button{border-radius:4px;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .blank{background-color:#e5e7eb;color:#374151}dialog#__km-enhancement-app .blank:hover{background-color:#d1d5db}dialog#__km-enhancement-app .success{background-color:#dcfce7;border-radius:4px;color:#166534;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .success:hover{background-color:#bbf7d0}dialog#__km-enhancement-app .error{background-color:#fee2e2;border-radius:4px;color:#991b1b;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .error:hover{background-color:#fecaca}dialog#__km-enhancement-app .loading{background-color:#fef9c3;border-radius:4px;color:#854d0e;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .loading:hover{background-color:#fef08a}dialog#__km-enhancement-app .promise{background-color:#dbeafe;border-radius:4px;color:#1e40af;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .promise:hover{background-color:#bfdbfe}dialog#__km-enhancement-app .promise-txt{min-width:185px;text-align:center}dialog#__km-enhancement-app .custom{background-color:#ffedd5;border-radius:4px;color:#c2410c;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .custom:hover{background-color:#fed7aa}dialog#__km-enhancement-app .timer{background-color:#fce7f3;border-radius:4px;color:#9d174d;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .timer:hover{background-color:#fbcfe8}dialog#__km-enhancement-app .close{background-color:#f3e8ff;border-radius:4px;color:#6b21a8;font-size:12px;font-weight:400;margin-bottom:4px;padding:0 8px 4px}dialog#__km-enhancement-app .close:hover{background-color:#e9d5ff}#app .ct-editor .ai-quick-view-container .ai-quick-view-box-body{-webkit-user-select:text;-moz-user-select:text;user-select:text}.oafe-drop-menu-menu-wrapper .menu-content-normal .ant-menu-item{padding:4px 8px!important}.ct-table-context-menu .ct-table-context-item{padding:4px 30px 8px 15px!important}dialog#__km-enhancement-app{border:none;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,.1);max-height:500px;overflow:hidden;padding:20px;text-align:center}dialog#__km-enhancement-app::backdrop{background-color:rgba(0,0,0,.5)}dialog#__km-enhancement-setting-app .backdrop{align-items:center;display:flex;flex-direction:column;inset:0;justify-content:center;overflow-x:hidden;overflow-y:auto;position:fixed;transition:opacity .3s ease-out;z-index:50}dialog#__km-enhancement-setting-app .backdrop .innerBackdrop{background-color:rgba(0,0,0,.75);inset:0;position:absolute;transition:colors .3s ease-out;z-index:0}dialog#__km-enhancement-setting-app .dialogRoot{background-color:#fff;border-radius:8px;color:#374151;height:auto;left:50%;max-height:400px;max-width:800px;min-height:150px;min-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:auto}dialog#__km-enhancement-setting-app .dialogRoot.dark{background-color:#1f2937;color:#9ca3af}dialog#__km-enhancement-setting-app .dialogRoot.dark .dialogHeader{background-color:#374151}dialog#__km-enhancement-setting-app .dialogRoot.dark .hrLine{border-color:#374151}dialog#__km-enhancement-setting-app .dialogHeader{align-items:center;background-color:#3b82f6;border-top-left-radius:8px;border-top-right-radius:8px;color:#fff;display:flex;font-weight:700;justify-content:space-between;padding:16px}dialog#__km-enhancement-setting-app .dialogHeader .headerTitle{flex:1;font-size:18px}dialog#__km-enhancement-setting-app .dialogHeader .btnGroup{display:flex;gap:8px;justify-content:space-between;margin-right:auto;min-width:80px}dialog#__km-enhancement-setting-app .dialogHeader .closeButton,dialog#__km-enhancement-setting-app .dialogHeader .saveButton{align-items:center;border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);color:#fff;cursor:pointer;display:flex;font-weight:600;height:28px;justify-content:center;min-width:48px;padding:8px 16px;text-align:center}dialog#__km-enhancement-setting-app .dialogHeader .closeButton:focus,dialog#__km-enhancement-setting-app .dialogHeader .saveButton:focus{box-shadow:0 0 0 2px rgba(0,0,0,.75);outline:none}dialog#__km-enhancement-setting-app .dialogHeader .saveButton{background-color:#10b981}dialog#__km-enhancement-setting-app .dialogHeader .saveButton:hover{background-color:#34d399}dialog#__km-enhancement-setting-app .dialogHeader .saveButton:focus{background-color:#047857;box-shadow:0 0 0 2px #6ee7b7}dialog#__km-enhancement-setting-app .dialogHeader .saveButton .saveIcon{height:16px;width:16px}dialog#__km-enhancement-setting-app .dialogHeader .closeButton{background-color:#ef4444}dialog#__km-enhancement-setting-app .dialogHeader .closeButton:hover{background-color:#f87171}dialog#__km-enhancement-setting-app .dialogHeader .closeButton:focus{background-color:#b91c1c;box-shadow:0 0 0 2px #fca5a5}dialog#__km-enhancement-setting-app .dialogMain{border-bottom-left-radius:8px;border-bottom-right-radius:8px;padding:16px}dialog#__km-enhancement-setting-app .dialogMain .hrLine{border-color:#e5e7eb;border-top-width:1px;margin-bottom:8px;margin-top:8px}dialog#__km-enhancement-setting-app .dialogMain .label{align-items:center;cursor:pointer;display:grid;gap:12px;grid-template-columns:auto 1fr;margin-left:16px;padding:4px 8px;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}dialog#__km-enhancement-setting-app .dialogMain .label:hover{background-color:#f1f5f9}dialog#__km-enhancement-setting-app .dialogMain .label .checkboxInput{accent-color:#ec4899;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:1px solid #4b5563;height:14px;width:14px}dialog#__km-enhancement-setting-app .dialogMain .label .checkboxInput:checked{-webkit-appearance:auto;-moz-appearance:auto;appearance:auto} ');

(function () {
  'use strict';

  var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;
  var pi=Object.defineProperty;var mi=(e,t,n)=>t in e?pi(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var D=(e,t,n)=>mi(e,typeof t!="symbol"?t+"":t,n);var xe=typeof GM_getValue<"u"?GM_getValue:void 0,er=typeof GM_notification<"u"?GM_notification:void 0,wr=typeof GM_openInTab<"u"?GM_openInTab:void 0,Yr=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,In=typeof GM_setClipboard<"u"?GM_setClipboard:void 0,Se=typeof GM_setValue<"u"?GM_setValue:void 0,hi=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,gi=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,X=typeof unsafeWindow<"u"?unsafeWindow:void 0,G=window;class yi{constructor(){D(this,"version",0);D(this,"offset",0);D(this,"tr",null);D(this,"el",null);D(this,"menu",null);D(this,"processResults",[]);D(this,"isSelected",false);D(this,"selectedText","");D(this,"cache",new Map);}getCachedValue(t,n){if(this.cache.has(t))return this.cache.get(t);const r=n();return this.cache.set(t,r),r}get cell(){return this.getCachedValue("cell",()=>{const t=this.el?.closest("table");if(!t)return null;const n=this.el?.closest("th");if(n&&t.contains(n))return n.pmViewDesc||null;const r=this.el?.closest("td");return r&&t.contains(r)&&r.pmViewDesc||null})}get cellIndex(){return this.getCachedValue("cellIndex",()=>{if(!this.cell)return  -1;const t=this.cell.parent.children.map(r=>r===this.cell).indexOf(true);if(!t)return 0;let n=0;for(const r of this.cell.parent.children.slice(0,t))n+=+(r.node.attrs.colspan||1);return n})}get table(){return this.getCachedValue("table",()=>this.el?.closest("tr")?.pmViewDesc?.parent||null)}step(t,n,r,o){this.tr?this.tr.replaceWith(t,n,r,o):this.tr=editorInst.view.state.tr.replaceWith(t,n,r,o);}commit(){this.tr&&editorInst.view.dispatch(this.tr),this.tr=null;}clear(){this.cache.clear(),this.commit(),this.menu&&(this.menu.hidden=true),this.processResults=[],this.isSelected=false,this.selectedText="",this.version=0,this.offset=0,this.menu=null,this.tr=null;}}const g=new yi;function Nn(e,t){if(!e)throw new Error("selector is required");const n=typeof e=="string"?(t||document).querySelector(e):e;if(!n)throw new Error("dom 节点未找到");const r=Object.keys(n).find(o=>o.startsWith("__reactInternalInstance$"));if(!r)throw new Error("reactInternalInstance 私有属性未找到");return n[r]}let rn=null;const Ln={title:"选择输出列",tips:"选择将结果输出到指定的现有列 (不包括删除、隐藏的列)，或创建新列 (默认)",type:"select",dynamicOptions:()=>{const e=R.getDataColumns();return [{value:"new",label:"创建新列（默认）",callback:()=>{rn=null;}},...e.map(n=>({value:n.id.toString(),label:n.name,callback:()=>{rn=n.id.toString();}}))]},defaultValue:"new"},bi=()=>rn,tn=()=>rn=null,Ua="上海_月浦",Ba="YP-M3",k={orgX1:false,orgX2:false,orgX3:false,orgX4:false,hostIdcName:Ua,hostBuilding:Ba,cell:null,region:null,selectedSpecs:["cpu","mem","disk"]},wi=e=>k.cell=e,yt=e=>k.region=e,nt=()=>{k.orgX1=false,k.orgX2=false,k.orgX3=false,k.orgX4=false,k.hostIdcName=Ua,k.hostBuilding=Ba,k.cell=null,k.region=null,k.selectedSpecs=["cpu","mem","disk"],tn();};class vi{constructor(){D(this,"type",null);D(this,"container",null);D(this,"model",null);D(this,"columnInfo_",null);D(this,"columns",[]);D(this,"menuContainer",null);D(this,"opColId",0);D(this,"colId",0);D(this,"rowId",0);}handleTypeJudge(t){const n=t.querySelector(".xtable-contextmenu");if(n?.children.length)return this.type="cell-edit",this.menuContainer=n,true;const r=t.querySelector(".xtable-pop-over");if(r?.querySelector(".xtable-menu-list")?.children.length){this.type="col-edit",this.menuContainer=r;const s=Nn(r)?.memoizedProps?.children?.props?.value;return s?(this.columnInfo_=s,this.opColId=s.id,this.colId=s.id,true):false}return this.type=null,this.menuContainer=null,false}handleModelInit(t){if(!t)return;const n=Nn(".xtable-edit-layer",t),r=Nn(".xtable-edit-layer>.xtable-pop-over",t);if(!n||!r)return;this.model=n.child.memoizedProps.canvasGrid.getModel();const{rowId:o=0,colId:a=r.child?.memoizedProps?.value.id}=r.child?.memoizedProps||{};if(this.rowId=o,a&&(this.colId=a,this.opColId=a),this.type==="cell-edit"){const s=r.child.memoizedProps?.viewId;this.model=__MICRO_APP_PROXY_WINDOW__.xtable.model.dataViews.find(i=>i.id===s),this.columnInfo_=this.model.columns.find(i=>i.id===a),o||console.warn("cell rowId is empty");}this.columns=this.model?.columns||[];}initStore(t){return !t||!this.handleTypeJudge(t)?false:(this.container=t,this.handleModelInit(t),true)}getDataColumns(t=true){return this.columns.filter(n=>!n.deleted&&!n.hidden&&(t?n.id!==this.columnInfo_?.id:true))}get opColumnType(){return this.columns.find(t=>t.id===this.opColId)?.columnType||1}get modelColumnNames(){return this.columns.map(t=>t.name)}get columnInfo(){return this.columnInfo_}get activeCellInfo(){return {rowId:this.rowId,colId:this.colId}}get actionType(){return this.type}get dataView(){if(!this.model)throw new Error("dataView: 视图未找到");return this.model}createTransaction(){if(!this.model)throw new Error("tr: 视图未找到");return this.model.beginTransaction()}hideMenu(){this.container?.dispatchEvent(new MouseEvent("mousedown",{cancelable:true,bubbles:true,button:0,buttons:1}));}clear(){setTimeout(()=>{this.container=null,this.menuContainer=null,this.columnInfo_=null,this.columns=[],this.opColId=0,this.rowId=0,this.colId=0,nt();},50);}}const R=new vi;let Ie=0;const ki=36,A={success(e,t=3e3,n="mtd"){if(n==="km")return Dt(e,t,"success");Ht(e,t,"success");},warning(e,t=5e3,n="mtd"){if(n==="km")return Dt(e,t,"warning");Ht(e,t,"warning");},info(e,t=5e3,n="mtd"){if(n==="km")return Dt(e,t,"info");Ht(e,t,"info");},error(e,t=1e4,n="mtd"){if(n==="km")return Dt(e,t,"error");Ht(e,t,"error");}};function Ht(e,t,n){const r=document.createElement("div");r.innerHTML=`<div class="mtd-message mtd-message-${n} mtd-message-closable" style="top:${vr(Ie)}px;z-index:9999;"><i class="mtd-message-icon mtdicon-${n}-circle"></i><div class="mtd-message-content"> ${e} </div></div>`;const o=document.createElement("i");o.className="mtd-message-close mtdicon mtdicon-close-thick",o.addEventListener("click",()=>{document.body.removeChild(r),Ie--,on();},{once:true}),r.firstChild.appendChild(o),document.body.appendChild(r),Ie++,t>0&&setTimeout(()=>{document.body.removeChild(r),Ie--,on();},t);}function Dt(e,t,n){const r=document.createElement("div");r.innerHTML=`<div class="ant-message-notice ct-toast" style="margin-top:${vr(Ie)}px;z-index:9999;position:fixed;top:30px;left:0;right:0"><div class="ant-message-notice-content"><div class="ant-message-custom-content ant-message-${n}" style="display:flex;line-height:16px;gap:6px;"><span role="img" aria-label="check-circle" class="anticon anticon-check-circle"><svg viewBox="64 64 896 896" focusable="false" data-icon="check-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"></path></svg></span><span class="">${e}<span></div></div></div>`;const o=document.createElement("i");o.className="ct-icon iconfont ct-icon-close-ct2 icon",o.style.fontSize="17px",o.style.color="rgb(0, 0, 0)",o.style.fontStyle="unset",o.style.marginLeft="12px",o.addEventListener("click",()=>{document.body.removeChild(r),Ie--,on();},{once:true}),r.querySelector(".ant-message-custom-content").appendChild(o),document.body.appendChild(r),Ie++,t>0&&setTimeout(()=>{document.body.removeChild(r),Ie--,on();},t);}function on(){document.querySelectorAll(".mtd-message").forEach((t,n)=>{t.style.top=`${vr(n)}px`;});}function vr(e){return e*ki+12*(e+1)}function kr(e=0){const n=g.table.children,r=[];for(let o=0;o<n.length;o++){const a=n[o].children;let s=o;for(let i=0;i<a.length;i++){const c=a[i].node,l=+(c.attrs.rowspan||1),u=+(c.attrs.colspan||1);i===0&&([s]=Qr(r,o,0));const[,d]=Qr(r,s,i);if((l>1||u>1)&&r.push({rowSpan:l,colSpan:u,_rowIdx:o,_colIdx:i,rowIdx:s,colIdx:d,effectRows:Jr(s,l),effectCols:Jr(d,u)}),e&&d>=e)break}}return ({rowIdx:o,targetCol:a})=>{if(!r.length)return a;const s=r.filter(l=>l._rowIdx===o),i=r.filter(l=>l.effectRows.includes(o)&&l._rowIdx!==o);let c=a;return s.length&&s.forEach(l=>{c-=l.colSpan-1;}),i.length&&i.forEach(l=>{const u=l.effectCols.filter(d=>d<=c);c-=u.length;}),c}}function Qr(e,t,n){return e.filter(o=>o.effectRows.includes(t)).forEach(o=>{const a=o.effectCols.filter(i=>i<=n).length,s=o.effectRows.filter(i=>i<=t).length;n+=a,t+=s;}),[t,n]}function Jr(e,t){return [...Array(t).keys()].map(n=>e+n)}function Fe(e){return R.columnInfo?.columnType===1&&e?.data?.length}function _i(e){return R.columnInfo?.columnType===4&&e?.data?.length}const Ci=()=>{const{origin:e,pathname:t}=location;return `${e}${t}`};async function S(e,t){if(!Fe(e))return;const n=[];for(const r of e.data){const o=r?.value?.trim();if(!o){n.push(r);continue}const a=await t(o);a&&n.push({type:"text",value:a});}n.length&&$e(e,n);}function $e(e,t){if(t===void 0)return;const{rId:n,cId:r}=e,o=R.createTransaction();try{switch(R.opColumnType){case 1:{R.dataView.setCellValueStep(n,r,t);break}case 2:{const[{value:a}]=t;String(Number(a))===a&&R.dataView.setCellValueStep(n,r,+a);break}default:{console.warn("暂不支持的单元格类型: ",R.columnInfo,t);break}}o?.commit();}finally{o?.close();}}function Zr(e){if(!e?.length||e?.length===1)return e;const t=[];for(let n=0;n<e.length;n++)t.push(e[n]),n<e.length-1&&t.push({type:"paragraph",value:" "});return t}function Le(e,t="paragraph"){return e.node?.type.name===t?[e]:e.children.length?e.children.map(n=>Le(n,t)).filter(Boolean).flat(1):null}function xi(){const e=document.querySelector(".pk-table-context-menu")||document.querySelector(".ct-table-context-menu");return e?e.className==="ct-table-context-menu"?1:2:0}function Si(e){if(!g.el)return null;const t=g.el.tagName.toLowerCase()==="td"?g.el:g.el.parentNode,n=t.cellIndex+e;if(n<0)return null;const r=t.parentNode.parentNode;if(!r)return null;const o=[],a=r.getElementsByTagName("tr")||[];for(const s of Array.from(a)){const i=_r(s.children,n,o);for(const c of Array.from(i?.getElementsByTagName("p")||[]))if(i?.tagName.toLowerCase()==="th")return g.version===1?{node:c,content:""}:g.version===2?{pmNode:c?.pmViewDesc,content:c.innerText}:null}return null}function $i(e){if(!g.cell)return null;const t=g.cellIndex+e,r=g.table?.children||[];if(!r.length||r[0].children.length<t)return null;let o=0;const a=kr(t);for(let s=0;s<r.length;s++){const i=r[s],c=a({targetCol:t,rowIdx:s}),l=i.children[c];if(!l){o++;continue}if(!(l.size<=4)&&l.node.textContent.trim())return  false}return o!==r.length}function Ei(e){if(!g.el)return null;const t=g.el.tagName.toLowerCase()==="td"?g.el:g.el.parentNode,n=t.cellIndex+e,r=t.parentNode.parentNode,o=[],a=r.getElementsByTagName("tr")||[];let s=0;for(const i of Array.from(a)){const c=_r(i.children,n,o);if(!c){s++;continue}if(c.innerText?.trim())return  false}return s!==a.length}function _r(e,t,n){for(let a=0;a<e.length;a++){const s=+(e[a].getAttribute("rowspan")||1),i=+(e[a].getAttribute("colspan")||1);if((s>1||i>1)&&n.push({rowSpan:s,colSpan:i,index:a,first:true}),a===t){const c=eo(n),l=a-c.offset;return c.mergeIdx.includes(t)?null:e[l]}}const r=eo(n),o=t-r.offset;return r.mergeIdx.includes(t)?null:e[o]}function Ai(){return g.version===1?false:!!document.querySelector('a.ct-node-view-dom[data-type="ct-mention"]')}function Fa(){try{return !!editorInst?.view?.editable}catch{return  false}}function Ti(){const{pathname:e}=location,t=e.match(/^\/(collabpage|page)\/(?<id>\d+)/);return t?.groups?.id?Number(t.groups.id):null}function eo(e){let t=0;const n=[];for(const r of e){const{rowSpan:o,colSpan:a,index:s,first:i}=r;o>=1&&(i?(r.first=false,t+=a-1):(t+=a,n.includes(s)||n.push(s)),r.rowSpan-=1);}return {mergeIdx:n,offset:t}}class I{constructor(t=1e3,n=2*60*60*1e3){D(this,"cache",new Map);D(this,"maxInactivityTime");D(this,"timerId");D(this,"lastAccessTime");D(this,"checkInterval");this.checkInterval=t,this.maxInactivityTime=n,this.lastAccessTime=Date.now(),this.startTimer();}startTimer(){this.timerId=setInterval(()=>{const t=Date.now(),n=[];this.cache.forEach((r,o)=>{r.expireAt<=t&&n.push(o);}),n.forEach(r=>this.cache.delete(r)),t-this.lastAccessTime>this.maxInactivityTime&&this.clear();},this.checkInterval);}set(t,n,r=2*60*60*1e3){const o=Date.now()+r;this.cache.set(t,{value:n,expireAt:o}),this.lastAccessTime=Date.now();}get(t){const n=this.cache.get(t);if(n)return this.lastAccessTime=Date.now(),n.value}getValues(){return Array.from(this.cache.values()).map(t=>t.value)}delete(t){this.cache.delete(t);}clear(){this.cache.clear(),this.lastAccessTime=Date.now();}stopTimer(){this.timerId&&(clearInterval(this.timerId),this.timerId=void 0);}}function ie(e){return new Promise(function(t){setTimeout(t,e);})}var Pi="__monkeyWindow-"+(()=>{try{return new URL((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('__entry.js', document.baseURI).href)).origin}catch{return location.origin}})(),ja=document[Pi]??window,Ii=ja.GM,Ni=ja.GM_xmlhttpRequest;function Li(e){var t;const n=new Headers,r=e.replace(/\r?\n[\t ]+/g," ");for(const o of r.split(/\r?\n/)){const a=o.split(":"),s=(t=a.shift())==null?void 0:t.trim();if(s){const i=a.join(":").trim();try{n.append(s,i);}catch(c){console.warn(`Response ${c.message}`);}}}return n}const to=async(e,t)=>{const n=Ni||Ii.xmlHttpRequest;if(typeof n!="function")throw new DOMException("GM_xmlhttpRequest or GM.xmlHttpRequest is not granted.","NotFoundError");const r=new Request(e,t);if(r.signal.aborted)throw new DOMException("Network request aborted.","AbortError");const o=await r.blob(),a=Object.fromEntries(r.headers);return new Headers(t?.headers).forEach((s,i)=>{a[i]=s;}),new Promise((s,i)=>{let c=false;const l=new Promise(u=>{const{abort:d}=n({method:r.method.toUpperCase(),url:r.url||location.href,headers:a,data:o.size?o:void 0,redirect:r.redirect,binary:true,nocache:r.cache==="no-store",revalidate:r.cache==="reload",timeout:3e5,responseType:n.RESPONSE_TYPE_STREAM??"blob",overrideMimeType:r.headers.get("Content-Type")??void 0,anonymous:r.credentials==="omit",onload:({response:f})=>{if(c){u(null);return}u(f);},async onreadystatechange({readyState:f,responseHeaders:p,status:m,statusText:w,finalUrl:v,response:b}){if(f===XMLHttpRequest.DONE)r.signal.removeEventListener("abort",d);else if(f!==XMLHttpRequest.HEADERS_RECEIVED)return;if(c){u(null);return}const C=Li(p),$=r.url!==v,O=new Response(b instanceof ReadableStream?b:await l,{headers:C,status:m,statusText:w});Object.defineProperties(O,{url:{value:v},type:{value:"basic"},...O.redirected!==$?{redirected:{value:$}}:{},...C.has("set-cookie")||C.has("set-cookie2")?{headers:{value:C}}:{}}),s(O),c=true;},onerror:({statusText:f,error:p})=>{i(new TypeError(f||p||"Network request failed.")),u(null);},ontimeout(){i(new TypeError("Network request timeout.")),u(null);},onabort(){i(new DOMException("Network request aborted.","AbortError")),u(null);}});r.signal.addEventListener("abort",d);});})};let no=(e,t)=>{console.error("Fetch Error:",e.message,t);};const Ri=e=>{try{const t=new URL(e.toString());return `${t.protocol}//${t.host}`}catch{return ""}},an=new Map,Va=30*1e3,Mi=()=>{const e=Date.now();for(const[t,n]of an.entries())e-n>Va&&an.delete(t);},Oi=async e=>{const t=Ri(e);if(!t)return;Mi();const n=Date.now(),r=an.get(t);if(r&&n-r<Va){console.log(`域名 ${t} 在 ${Math.round((n-r)/1e3)}s 前已打开过，跳过重复打开`);return}console.log(`检测到重定向，在后台打开域名: ${t}`),an.set(t,n);const o=wr(t,{active:false,insert:true,setParent:true});await new Promise(a=>setTimeout(a,2e3)),o?.close();};async function _(e,t={},n=3){let r=0,o;const a={...t,redirect:"manual"};for(;;)try{const s=await to(e,a);if(s.status===301||s.status===302||s.status===307||s.status===308){if(console.log(`检测到重定向状态码: ${s.status}`),await Oi(e),r++,r>=n){const d=new Rn(`重定向处理失败，状态码: ${s.status}`);throw no(d,e),d}await ie(200*r);const c={...t,redirect:"follow"},l=await to(e,c),u=await l.json();if(!l.ok){const{status:d,statusText:f}=l,p=`状态: ${f||d}, 内容: ${JSON.stringify(u)}`;throw new Rn(p)}return u}const i=await s.json();if(!s.ok){const{status:c,statusText:l}=s,u=`状态: ${l||c}, 内容: ${JSON.stringify(i)}`;throw new Rn(u)}return i}catch(s){if(o||(o=s),r++,r>=n)throw no(o||s,e),o||s;await ie(200*r);}}class Rn extends Error{constructor(t){super(t),this.name="FetchError";}}const ro=new I,oo=new I,At=new I,ee={misName:/^(?<mis>[a-z]+\d*|([a-z]+\.?){2,3})[/:](?<name>[\u4e00-\u9fa5]+)$/,nameMis:/^(?<name>[\u4e00-\u9fa5]+)[/:](?<mis>[a-z]+\d*|([a-z]+\.?){2,3})$/,misIdPtn:/^(?<mis>[a-z]+\d*|([a-z]+\.?){2,3})$/},Lt="https://km.sankuai.com";function _e(e){if(e=e.trim(),!e)return Promise.resolve(null);const t=oo.get(e);if(t)return Promise.resolve(t);const n=At.get(e);if(n)return Promise.resolve(n);const r=new URL(`${Lt}/api/users/neixin/search?input=${e}`);return _(r).then(({data:o})=>{const a=o?.users.filter(i=>i[e]),s=Bi(a);return oo.set(e,s),s}).catch(()=>null)}function tr(e){if(!e)return Promise.resolve(null);const t=At.getValues()?.find(a=>a?.empId===Number(e));if(t)return Promise.resolve(t);const n=`${Lt}/api/userInfo`,r={tenantId:"1",userEmpIdList:[e]},o={"content-type":"application/json"};return _(n,{method:"POST",body:JSON.stringify(r),headers:o}).then(async({data:a})=>{const s=a[e];if(!s)return null;const[i]=await Ga([e]),{orgNamePath:c,orgPath:l}=i||{};c&&(s.orgNamePath=c),l&&(s.orgPath=l);const u=Ka(s);return At.set(u.mis,u),u}).catch(()=>null)}function ao(e){if(!e.length)return Promise.resolve([]);const t=e.map(o=>At.get(o)).filter(Boolean),n=e.filter(o=>!t.find(a=>a.mis===o));if(!n.length)return Promise.resolve(t);const r=new URL(`${Lt}/api/users`);return r.searchParams.append("mis",n.join(",")),r.searchParams.append("tenantId","1"),_(r).then(async({data:o})=>{const a=Object.values(o||{}),s=a.map(l=>l.empId),i=await Ga(s);a.forEach(l=>{const u=i.find(d=>String(d.empId)===String(l.empId));u&&(l.orgNamePath=u.orgNamePath,l.orgPath=u.orgPath);});const c=a.map(Ka);return c.forEach(l=>{At.set(l.mis,l);}),t.concat(c)}).catch(()=>t)}async function qi(e){switch(e=e.trim(),true){case ee.misName.test(e):return e.match(ee.misName).groups;case ee.nameMis.test(e):return e.match(ee.nameMis).groups;case ee.misIdPtn.test(e):const t=await _e(e);return t?{name:t.name,mis:e}:null}return null}async function Hi(e){e=e.trim();let t="";switch(true){case ee.misName.test(e):t=e.match(ee.misName).groups?.mis||"";break;case ee.nameMis.test(e):t=e.match(ee.nameMis).groups?.mis||"";break;case ee.misIdPtn.test(e):t=e;break}return t&&await _e(t)||null}async function Di(e){switch(e=e.trim(),true){case ee.misName.test(e):{const t=e.match(ee.misName).groups;return await _e(t.mis)}case ee.nameMis.test(e):{const t=e.match(ee.nameMis).groups;return await _e(t.mis)}case ee.misIdPtn.test(e):return await _e(e)}return null}async function Ui(e){if(!e)return Promise.resolve(null);const t=ro.get(e);if(t)return Promise.resolve(t);const n=new URL(`${Lt}/api/org/orgNamePath`);return n.searchParams.append("orgNamePath",e),n.searchParams.append("status","1"),_(n).then(({data:r})=>{const o=r?.pop()||null;return ro.set(e,o),o})}async function Ga(e){if(!e||Array.isArray(e)&&!e.length)return [];Array.isArray(e)||(e=[e]);const t=`${Lt}/api/userOrgInfo`;return (await Xa(5,$d(e,20),async r=>{const o={userEmpIdList:r},a={"content-type":"application/json"},s=await _(t,{method:"POST",body:JSON.stringify(o),headers:a});if(!s.data)throw console.error("km getUserOrgInfo:error:",s),new Error("获取用户部门信息失败");const i=s.data||{};return Object.entries(i).map(([c,l])=>({empId:String(c),orgHeadEmpId:l.orgHeadEmpId||"",orgId:l.orgId||"",orgName:l.orgName||"",orgNamePath:l.orgNamePath||"",orgPath:l.orgPath||""}))})).flat()}function Bi(e){if(!e?.length)return null;const t=e.pop(),{account:n,empId:r,name:o,avatar:a,orgNamePath:s}=Object.values(t).pop();return {mis:n,name:o,avatar:a,empId:Number(r),orgNamePath:s}}function Ka(e){const{account:t,empId:n,name:r,avatar:o,orgNamePath:a,orgPath:s}=e,i=s?.split("-").map(Number);return {mis:t,name:r,avatar:o,empId:Number(n),orgPath:i,orgNamePath:a}}function Cr(e){const{indent:t=0,responsive:n=true,borderStyle:r="solid",borderWidth:o=1,borderColor:a="dddddd",nodes:s}=e;return editorInst.view.state.schema.nodes.table.create({indent:t,responsive:n,borderStyle:r,borderWidth:o,borderColor:a,nodeId:fe()},s)}function Me(e){const{nodes:t}=e;return editorInst.view.state.schema.nodes.table_row.create({nodeId:fe()},t)}function oe(e){const{content:t,colwidth:n=180,colspan:r=1,rowspan:o=1}=e;return editorInst.view.state.schema.nodes.table_cell.create({colspan:r,rowspan:o,colwidth:[n],verticalAlign:null,textAlign:null,bgColor:null,numCell:null,color:null,nodeId:fe()},Rt({content:t}))}function vn(e){const{content:t,colwidth:n=180,colspan:r=1,rowspan:o=1}=e;return editorInst.view.state.schema.nodes.table_header.create({colspan:r,rowspan:o,colwidth:[n],verticalAlign:null,textAlign:null,bgColor:null,numCell:null,color:null,nodeId:fe()},Rt({content:t}))}function Rt(e){const{contentNode:t,content:n,indent:r=0,align:o="left"}=e;return editorInst.view.state.schema.nodes.paragraph.create({align:o,indent:r,nodeId:fe()},t||(n?editorInst.view.state.schema.text(n.toString()):void 0))}function Fi(e){const{name:t,mis:n}=e;return editorInst.view.state.schema.nodes.mention.create({uid:n,name:t,nodeId:fe(),anchor:fe()})}function ji(e){const{contentNode:t,content:n,checked:r=false}=e;return editorInst.view.state.schema.nodes.task_list.create({indent:0,nodeId:fe()},editorInst.view.state.schema.nodes.task_item.create({checked:r,level:0,nodeId:fe()},t||Rt({content:n})))}function Vi(e){const{href:t,title:n,autoUpdate:r=false}=e;return editorInst.view.state.schema.nodes.link.create({href:t,title:n,autoUpdate:r,nodeId:fe()},editorInst.view.state.schema.text(n.toString()))}async function Gi(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){if(!Fe(o))return;const s=[];for(const i of o.data){if(i.type!=="text"){s.push(i);continue}const c=i.value;for(const l of c.split(/,|，|、/)){const u=l.trim();if(!u){s.push({type:"text",value:l});continue}const d=await Hi(u);if(!d){s.push({type:"text",value:l});continue}s.push({type:"mention",empId:d.empId,value:`@${d.name}`});}}$e(o,s);return}if(!n)return;const a=[];for(const s of n.split(/,|，|、/)){const i=s.trim();i&&a.push(qi(i));}await Promise.all(a).then(s=>s.filter(Boolean)).then(s=>{if(s?.length)switch(g.version){case 1:const i=s.map(d=>Ki(d.mis,d.name)).join("");i&&(t.innerHTML=i);return;case 2:const c=zi(s),{posBefore:l,posAfter:u}=r;g.step(l,u,c);return}});}function Ki(e,t){return `<a class="ct-mention" data-type="ct-mention" data-uid="${e}">@<b>${t}</b></a>`}function zi(e){return Rt({contentNode:e.map(t=>Fi(t))})}const za="https://yuntu.sankuai.com",Wi={"Content-Type":"application/x-www-form-urlencoded"};function Wa({widgetKey:e,dashKey:t,params:n}){const r=`${za}/api/proxy/widget/${e}/data`,o=new URLSearchParams({dashKey:t,widgetKey:e,index:"1",useCache:"true",useAssisted:"true",longTermCaching:"false",params:JSON.stringify(n)});return _(r,{headers:Wi,method:"POST",body:o}).then(({data:a})=>{const s=a?.resData?.data||[],i=s?.length?s[0]:[],c=s?.length?s.slice(1):[];return {header:i,rows:c}}).catch(()=>null)}function Xi(e,t){if(!t.length)return [];if(e.length!==t[0].length)throw new Error("云图数据数据长度不匹配");return t.map(n=>n.reduce((r,o,a)=>{const s=e[a];return r[s]=o,r},{}))}function Yi(e){const t=`${za}/api/common/getUserInfoFromXM`,n=JSON.stringify({userId:e});return _(t,{headers:{"Content-Type":"application/json"},method:"POST",body:n}).then(({code:r,...o})=>{if(r===200&&o[e]){const a=o[e],s=a.XMinfo[a.userId];return {misId:e,name:s.name,gender:s.gender,userId:Number(a.userId),avatar_url:s.avatar_url,big_avatar_url:s.big_avatar_url}}return null}).catch(()=>null)}async function Qi(e){const t=Ji(e),n=await Wa(t).catch(()=>null);if(!n)return null;const{rows:r,header:o}=n;if(!r.length)return null;const a=Xi(o,r)[0];return a||null}function Ji(e){return {widgetKey:"widget-847d7b5e-59ee-4951-8b60-3ba19c12d4d2",dashKey:"dashboard-6ec0147a-e008-42e7-b9e6-d234d2954234",params:{appKey:e}}}const Xa=async(e,t,n)=>{const r=[],o=new Set;for(const a of t){const s=Promise.resolve().then(()=>n(a,t));r.push(s),o.add(s);const i=()=>o.delete(s);s.then(i).catch(i),o.size>=e&&await Promise.race(o);}return Promise.all(r)},so=new I,io=new I,co=new I,lo=new I,uo=new I,fo=new I,po=new I,mo=new I,ho=new I,go=new I,yo=new I,bo=new I,wo=new I,vo=new I;new I;const U="https://avatar.mws.sankuai.com",kn="8J33MWtEC9YWFMgZaLgRCLtiWZaaIrzS",Ge=e=>e.map(t=>({label:t.value,value:Number(t.text.replace(/\D+/g,""))}));function Zi(e){const t=fo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${U}/bannerapi/plus/silent`);return n.searchParams.append("isStrict","false"),n.searchParams.append("appkey",e),n.searchParams.append("env","prod"),_(n,{headers:{"Auth-Token":kn,Operatorid:"km-plugin"}}).then(({data:r})=>(fo.set(e,r),r)).catch(()=>null)}function xr(e){const t=mo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${U}/bannerapi/services/exist`);return n.searchParams.append("appkey",e),n.searchParams.append("env","prod"),_(n,{headers:{"Auth-Token":kn,Operatorid:"km-plugin"}}).then(({data:r})=>{const o=!!r;return mo.set(e,o),o}).catch(()=>null)}function ec(e){const t=yo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${U}/bannerapi/portal/group/v2`);return n.searchParams.append("appkey",e),n.searchParams.append("env","prod"),_(n,{headers:{"Auth-Token":kn,Operatorid:"km-plugin"}}).then(async({data:r})=>{const o=await Promise.all(r.map(async a=>{const s=a.bindTrackingStrategyNum?await tc(a.groupId):[];return {cell:a.cell,name:a.name,quota:a.quota,tracking:a.bindTrackingStrategyNum,monitor:a.bindMonitorStrategyNum,timing:a.bindTimingStrategyNum,idcs:a.expectIdcs,trackingInfos:s}}));return yo.set(e,o),o})}async function tc(e){const t=new URL(`${U}/bannerapi/strategy/mapping/group/${e}/tracking`);return _(t,{headers:{"Auth-Token":kn,Operatorid:"km-plugin"}}).then(({data:n})=>n.map(({strategyWithRuleModel:r})=>({name:r.strategyName,metric:r.displayMetricName,upper:r.upperTargetValue,lower:r.lowerTargetValue,state:r.state==="ON"})))}function de(e){const t=so.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/appkey/${e}/detail`;return _(n).then(({data:r,code:o})=>(o!==0&&(r=null),so.set(e,r),r))}function nc(e){const t=uo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${U}/api/v2/ecs/flow/appkey/specification`);return n.searchParams.append("appkey",e),n.searchParams.append("env","prod"),_(n).then(({data:r,message:o})=>{r||console.error(`queryAppkeySpec [${e}] 异常: ${o}`);const{cpu:a,mem:s,disk:i}=r||{},c={cpu:a,mem:s,disk:i};return uo.set(e,c),c}).catch(r=>(console.error("queryAppkeySpec::",r?.message),null))}function rc(e){const t=io.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/appkey/${e}/utilization`;return _(n).then(({data:r})=>(io.set(e,r),r))}function oc(e){const t=po.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/capacity/${e}/summary`;return _(n).then(({data:r})=>(po.set(e,r),r))}function Sr(e){const t=ho.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/capacity/${e}`;return _(n).then(({data:r})=>(ho.set(e,r),r))}function Mt(e){const t=co.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/host/idc?appkey=${e}`;return _(n).then(({data:r})=>(co.set(e,r),r))}async function ac(e){const t=bo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${U}/api/v2/avatar/host/title`);return n.searchParams.append("appkey",e),n.searchParams.append("env","prod"),n.searchParams.append("requireNodeStatus","false"),_(n).then(({data:r})=>{const{cell:o,idcName:a,flavorName:s,kindName:i,originType:c,os:l}=r,u={cell:Ge(o),idcName:Ge(a),kindName:Ge(i),flavorName:Ge(s),originType:Ge(c),os:Ge(l)};return bo.set(e,u),u}).catch(()=>null)}async function Ya(e){const{appkey:t,cell:n="",idcName:r,poolType:o,kind:a}=e,s={appkey:t,page:1,set:n,env:"prod",pageSize:1,requireNodeStatus:false,...a?{_kind_name:a}:{},...r?{_idc_name:r}:{},...o?{_origin_type:o}:{}},i=`${U}/api/v2/avatar/host`;return _(i,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(({data:c})=>c?.totalCount).catch(()=>-1)}async function sc(e){const{appkey:t,cell:n,kind:r}=e,o=`${t}-${n}-${r}`,a=wo.get(o);if(a)return Promise.resolve(a);const s=await ac(t),i={};if(!s)return null;const c=s.idcName.map(l=>l.label);for(const l of s.originType){const u=l.label,d=await Xa(4,[...c],f=>Ya({appkey:t,cell:n,kind:r,idcName:f,poolType:u}));i[l.label]=c.reduce((f,p,m)=>(f[p]=d[m],f),{});}return wo.set(o,i),i}async function je(e){const{appkey:t,idcName:n,poolType:r,kind:o}=e,a=`${t}-${n}-${r}-${o}`,s=go.get(a);if(s)return Promise.resolve(s);const i={appkey:t,page:1,set:"",env:"prod",pageSize:1e3,requireNodeStatus:false,...o?{_kind_name:o}:{},...n?{_idc_name:n}:{},...r?{_origin_type:r}:{}},c=[],l=`${U}/api/v2/avatar/host`;for(;;)try{const u=await _(l,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json;charset=UTF-8"}});if(!u?.data?.items?.length||(c.push(...u.data.items),u.data.totalPage<=i.page))break;i.page++;}catch(u){throw console.error("请求Avatar失败:",u),u}return go.set(a,c),c}function Qa(e){if(e=e.trim(),!e)return Promise.resolve("");const t=lo.get(e);if(t)return Promise.resolve(t);const n=`${U}/api/v2/avatar/appkey/query?query=${e}`;return _(n).then(({data:r})=>{let o="";return r&&r.length>0&&(o=r[0].appkey||""),lo.set(e,o),o}).catch(r=>r?.message||"-")}function ic(e){e=e.filter(o=>Number(o)!==2);const t=e.join(","),n=vo.get(t);if(n)return Promise.resolve(n);const r=`${U}/api/v2/avatar/orgRoleAdmin/role?orgIds=${t}`;return _(r).then(({data:o})=>{const i={sre:o.opAdmins.map(c=>({mis:c.mis,name:c.name}))};return vo.set(t,i),i}).catch(()=>null)}function cc(e,t){const n=new URL(`${U}/api/v2/avatar/activity/appkey`);return n.searchParams.append("activityId",e.toString()),n.searchParams.append("businessId",t.toString()),n.searchParams.append("pageSize","500"),n.searchParams.append("page","1"),_(n).then(({data:r})=>r.items).catch(()=>[])}function lc(e){Array.isArray(e)&&(e=e.join(","));const t=`${U}/api/v1/cf/component/busyperiod/org/${e}`;return _(t).then(({data:n})=>n).catch(()=>[])}function uc(e){const t=`${U}/api/v1/cf/component/busyperiod/appkey/${e}`;return _(t).then(({data:n})=>n).catch(()=>[])}async function dc(e){let t=1;const n=[],o=(await Qi(e).catch(()=>null))?.rd_admin?.split(",")||null;for(;;){const a=new URL(`${U}/api/v2/avatar/workflow/flow`);a.searchParams.append("page",t.toString()),a.searchParams.append("tag","manualOperate"),a.searchParams.append("appkey",e),a.searchParams.append("pageSize","200"),a.searchParams.append("env","prod");const s=await _(a);if(!s.data?.items?.length)break;const i=s.data.items.filter(c=>!c.createUser.startsWith("__")).filter(c=>!c.createUser.startsWith("hulk")).filter(c=>o?o.includes(c.createUser):true).map(c=>({applyTime:c.applyTime.split(" ")[0],applyUser:c.applyUser}));if(n.push(...i),n.length>=50||s.data.totalPage>=t)break;t++;}return n}async function fc(e,t="flow_id="){let n=1;const r=[];for(;;){const o=new URL(`${U}/api/v2/avatar/workflow/flow`);o.searchParams.append("templateLabel","activity,host"),o.searchParams.append("page",n.toString()),o.searchParams.append("reason",String(t)),o.searchParams.append("appkey",e),o.searchParams.append("pageSize","100");const a=await _(o);if(!a.data?.items?.length)break;const s=a.data?.items;if(r.push(...s),r.length>=50||a.data.totalPage>=n)break;n++;}return r}async function pc(e,t,n="prod"){let r=1;const o=[];e:for(;;){const a=new URL(`${U}/api/v2/avatar/workflow/flow`);a.searchParams.append("templateName","reduced_service"),a.searchParams.append("page",r.toString()),a.searchParams.append("pageSize","100"),a.searchParams.append("appkey",e),a.searchParams.append("env",n);const s=await _(a);if(!s.data?.items?.length)break;const i=s.data.items.filter(c=>!c.createUser.startsWith("__")).filter(c=>!c.createUser.startsWith("hulk"));for(const c of i){if(c.applyTime<t)break e;o.push(c);}if(o.length>=50||s.data.totalPage>=r)break;r++;}return o}async function mc(e){const t=new URL(`${U}/api/v2/avatar/workflow/flow/display/host/${e}`);return t.searchParams.append("page","1"),t.searchParams.append("pageSize","500"),_(t).then(({data:n})=>n.items).catch(()=>[])}async function hc(e){const t=new URL(`${U}/api/v2/avatar/activity/appkey/tag`);return t.searchParams.append("page","1"),t.searchParams.append("pageSize","100"),t.searchParams.append("appkey",e),_(t).then(({data:n})=>n.items).catch(()=>[])}const Ja={ORG:"部门",GLOBAL:"系统",APPKEY:"服务",APPLICATION:"应用",APPKESCENE:"AppKey-Scene",APPKEYLITESET:"服务-LiteSet"},ko=new I,_o=new I,Za="https://ccmp.mws.sankuai.com";function es(e){e=e.trim();const t=ko.get("cache");if(t)return Promise.resolve(t.find(r=>r.name.includes(e))||null);const n=new URL(`${Za}/api/common/unit/list`);return _(n).then(({data:r})=>{const o=r.map(a=>({id:a.unitCode,name:a.unitName,type:a.type}));return ko.set("cache",o),o.find(a=>a.name.includes(e))||null}).catch(()=>null)}function ts(e){const t=_o.get(e.toString());if(t)return Promise.resolve(t);const n=new URL(`${Za}/api/authority/list`);return n.searchParams.append("rawId",`settlementunit:${e}`),_(n).then(async({data:r})=>{const o=r.members||[],a=o.filter(v=>v.role.some(b=>b.roleId==="524")).map(v=>v.mis),s=o.filter(v=>v.role.some(b=>b.roleId==="525")).map(v=>v.mis),i=o.filter(v=>v.role.some(b=>b.roleId==="521")).map(v=>v.mis),c=await ao(s),l=await ao(i),{orgPath:u,orgNamePath:d}=gc(c,l),p=(await ic(u))?.sre.map(v=>v.mis)||[],m=p.length>0&&p.length<a.length?p:a,w={orgNamePath:d,orgPath:u,sreList:a,sre:m};return _o.set(e.toString(),w),w}).catch(()=>null)}function Co(e){if(e.length===0)return {orgPath:[],orgNamePath:""};const t=e.map(i=>i.orgPath),n=e.filter(i=>!!i.orgNamePath).map(i=>i.orgNamePath.split("/")),r=t[0],o=n[0],a=r.filter((i,c)=>t.every(l=>l[c]===r[c])),s=o.filter((i,c)=>n.every(l=>l[c]===o[c]));return {orgPath:a,orgNamePath:s.join("/")}}function xo(e){if(e.length===0)return {orgPath:[],orgNamePath:""};const t={};e.forEach(a=>{for(let s=1;s<=a.orgPath.length;s++){const i=a.orgPath.slice(0,s).join(",");t[i]||(t[i]={count:0,depth:s}),t[i].count++;}});let n=[],r=0;Object.entries(t).forEach(([a,{count:s,depth:i}])=>{const c=s*i;(c>r||c===r&&i>n.length)&&(r=c,n=a.split(",").map(Number));});let o="";for(const a of e)if(a.orgPath.length>=n.length&&a.orgPath.slice(0,n.length).every((s,i)=>s===n[i])){o=(a?.orgNamePath||"").split("/").slice(0,n.length).join("/");break}return {orgPath:n,orgNamePath:o}}function gc(e,t){const n=Co(e),r=xo(e),o=n.orgPath.length>r.orgPath.length?n:r,a=Co(t),s=xo(t),i=a.orgPath.length>s.orgPath.length?a:s;return i.orgPath.length>o.orgPath.length?i:o}function y(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o&&n){const{rId:a,cId:s}=o;$e({rId:a,cId:s},[{type:"text",value:n}]);return}if(!(!n&&g.offset===0))switch(g.version){case 1:t.innerHTML=`<p>${n}</p>`;return;case 2:const{posAtStart:a,posAtEnd:s}=r,i=n===""?"-":n,c=editorInst.view.state.schema.text(i.toString());g.step(a,s,c);return}}async function yc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=await es(c);return l?(await ts(l.id))?.orgNamePath?.replace("美团/","")||"查询异常":(A.warning(`解析结算单元名称不合法(${c}), 示例: 到家事业群-外卖`,8e3,"km"),"")}}async function bc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=await es(c);return l?(await ts(l.id))?.sre.join("，")||"查询异常":(A.warning(`解析结算单元名称不合法(${c}), 示例: 到家事业群-外卖`,8e3,"km"),"")}}async function wc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){if(!Fe(o))return;const c=[],l=[];for(const u of o.data){if(u.type!=="mention"){i(l,c),c.push(u);continue}const d=await tr(u.empId);if(!d){l.push({type:"text",value:u.value});continue}l.push(`${d.name}/${d.mis}`);}i(l,c),$e(o,c);return}if(!n)return;if(r){const c=Le(r,"mention");if(!c?.length)return;const l=[];c.forEach(u=>{const d=u.node.attrs.name||"",f=u.node.attrs.uid||"";l.push(`${d}/${f}`);}),y({pmNode:r,content:l.join("，")});return}const a=t.querySelectorAll("a[data-type=ct-mention]");if(!a.length)return;const s=[];a.forEach(c=>{const l=c.textContent?.trim()||"",u=c.getAttribute("data-uid");s.push(`${l.replace("@","")}/${u}`);}),y({node:t,content:s.join("，")});function i(c,l){c.length&&(l.push({type:"text",value:c.join("、")}),c.length=0);}}async function vc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Qa(c)}}const So=new I,$o=new I,ns="https://rocket.sankuai.com";function kc(e){const t=So.get(e);if(t)return Promise.resolve(t);const n=new URL(`${ns}/api/v1/hosts`);return n.searchParams.set("q",`parent:${e}`),n.searchParams.set("limit","200"),_(n).then(({data:r})=>(So.set(e,r),r)).catch(()=>[])}function $r(e){if(!_c(e))return Promise.resolve(null);const t=$o.get(e);if(t)return Promise.resolve(t);const n=new URL(`${ns}/api/v1/hosts/${e}`);return _(n).then(({data:r})=>($o.set(e,r),r))}function _c(e){return e?/^(set-|vm-)?[\w]{2,4}-[-\w\d]{3,60}\d{2,4}$/i.test(e)||/^10(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/.test(e)||Cc(e):false}function Cc(e){return [".wj.sankuai.info",".sankuai.info",".sjz",".hj",".beta",".local",".mt",".jd",".yp"].some(n=>e.endsWith(n)&&/^(set-|vm-)?[\w]{2,4}-[-\w\d]{3,62}$/i.test(e.replace(n,"")))}async function xc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await $r(c).then(l=>l?.sn||"")}}async function Sc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=k.selectedSpecs;if(!l.length)return "";const u=await nc(c);if(!u)return "";if(l.length===1){const m=l[0];return String(u[m]||"")}const{cpu:d,mem:f,disk:p}=u;return [{key:"cpu",val:`${d}核`},{key:"mem",val:`${f}G`},{key:"disk",val:`${p}G`}].filter(m=>l.includes(m.key)).map(m=>m.val).join("/")}}async function $c(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){if(_i(o)){const c=[];for(const l of o.data){const u=await tr(l);c.push({type:"text",value:vt(u?.orgNamePath)});}$e(o,Zr(c));}if(!Fe(o))return;const i=[];for(const c of o.data){if(c.type!=="mention")continue;const l=await tr(c.empId);i.push({type:"text",value:vt(l?.orgNamePath)});}$e(o,Zr(i));return}if(!n)return;const a=await Ec(n);if(r){const i=Le(r,"mention");if(i?.length){const c=[];for(const l of Array.from(i)){const u=l.node.attrs.uid||"",d=await _e(u);c.push(vt(d?.orgNamePath));}y({pmNode:r,content:c.join("，")});return}if(a?.length){const c=Rt({content:a.join("，")}),{posBefore:l,posAfter:u}=r;g.step(l,u,c);return}return}if(!t)return;const s=t.querySelectorAll("a[data-type=ct-mention]");if(s.length){const i=[];for(const c of Array.from(s)){const l=c.getAttribute("data-uid"),u=await _e(l);i.push(vt(u?.orgNamePath));}y({node:t,content:i.join("，")});return}if(a?.length){y({node:t,content:a.join("，")});return}}async function Ec(e){const t=[];for(const n of e.split(/,|，|、/)){const r=n.trim();r&&t.push(Di(r));}return await Promise.all(t).then(n=>n.filter(Boolean).map(r=>vt(r?.orgNamePath)))}function vt(e){if(!e)return "-";const t=e.split("/"),n=k.orgX1?1:k.orgX2?2:k.orgX3?3:k.orgX4?4:1;return t.length<=n?e:t.slice(n).join("/")}async function Ac(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>Tc(l?.team?.orgName))}}function Tc(e){if(!e)return "";const t=e.split("/"),r=(k.orgX1?1:k.orgX2?2:k.orgX3?3:k.orgX4?4:1)-1;return t.length<=r?e:t.slice(r).join("/")}async function Pc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await $r(c).then(l=>l?.rackInfo||"")}}const Eo=new I,Ao=new I,rs="https://domain.mws.sankuai.com";function os(e){const t=Eo.get(e);if(t)return Promise.resolve(t);const n=`${rs}/api/entries/${e}`;return _(n).then(({entry:r})=>(Eo.set(e,r),r)).catch(()=>null)}function Ic(e){const t=Ao.get(e);if(t)return Promise.resolve(t);const n=new URL(`${rs}/api/dns/records`);return n.searchParams.append("fullname",e),n.searchParams.append("page_size","100"),n.searchParams.append("page","1"),_(n).then(({records:r})=>(Ao.set(e,r),r)).catch(()=>null)}async function Nc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Ic(c).then(l=>Lc(l))||""}}function Lc(e){return e?e.map(n=>{const r=n.line==="default"?"默认":n.line,o=n.enable?"启用":"禁用";return `${r} 线路 ${n.type} 记录值: ${n.value} TTL(${n.ttl}) [${o}]`}).join(`
`):""}async function Rc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.tree?.owt?.key||"")}}async function Mc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await os(c).then(l=>Oc(l))||""}}function Oc(e){if(!e)return "";const t=e?.org_path?.replace(/^公司\/美团\//,""),n=t.split("/"),o=(k.orgX1?1:k.orgX2?2:k.orgX3?3:k.orgX4?4:1)-1;return n.length<=o?t:n.slice(o).join("/")}async function qc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>{const u=l?.opAdmin;if(!u?.length)return "";const[d]=u;return `${d.name}/${d.loginName}`})}}const To="https://nocode.sankuai.com";async function Hc(e){return await _(`${To}/api/ai/chat/segment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hostname:To,stream:false,files:[],messages:e})})}const Dc={role:"system",content:[{type:"text",text:"依据用户输入的 json 字符串数组分析其中概率最大的项，其中 applyTime 越大，权重越高，applyUser出现次数越多，权重越高，仅输出权重最高的 applyUser 值, 不要输出其他内容",source:null}]},Po=new I;async function Uc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){if(!c?.trim())return "";const l=Po.get(c);if(l)return Promise.resolve(l);try{const u=await dc(c);if(!u.length)return "";const d=await Bc(u);return Po.set(c,d),d}catch(u){console.error(u);const d=u;return A.warning(`查询异常: ${c}， ${d.message}`,8e3,"km"),""}}}async function Bc(e){const t={role:"user",content:[{type:"text",text:JSON.stringify(e),source:null}]};return (await Hc([Dc,t])).data.toString()}const Fc=new I,nr=new I,Io=new I,No=new I,_n="https://sre.sankuai.com",jc="Token km.plugin.",Vc="270e8516d3fdf263261b214700a36290",Cn=jc+Vc;function Gc(e){if(e=e.trim(),!e)return Promise.resolve(null);const t=Fc.get(e);if(t)return Promise.resolve(t);const n=new URL(`${_n}/open/api/v1/appkey/meta/${e}`);return n.searchParams.set("fields","is_mlp_srv"),_(n,{headers:{Authorization:Cn}}).then(({data:r=null})=>(nr.set(e,r),r)).catch(()=>null)}function Kc(e){const t=nr.get(e);if(t)return Promise.resolve(t);const n=new URL(`${_n}/open/api/v1/appkey/meta/org/${e}`);return n.searchParams.set("fields","appkey,service_level"),n.searchParams.set("where","removed=0"),_(n,{headers:{Authorization:Cn}}).then(({data:r})=>(nr.set(e,r),r)).catch(()=>[])}function zc(e){const t=No.get(e);if(t)return Promise.resolve(t);const n=new URL(`${_n}/open/api/v1/buffalo/host/rack/${e}`);return _(n,{headers:{Authorization:Cn}}).then(({data:r,code:o})=>o!==200?[]:(No.set(e,r),r)).catch(()=>[])}function Wc(e){const t=Io.get(e);if(t)return Promise.resolve(t);const n=new URL(`${_n}/open/api/v1/buffalo/host/switch/${e}`);return _(n,{headers:{Authorization:Cn}}).then(({data:r,code:o})=>o!==200?[]:(Io.set(e,r),r)).catch(()=>[])}function Xc(e,t){e=e.replace(":7070",":8080");const n=new URL(`${e}/or/api/v3/report/task/${t}/result`);return _(n).then(({data:r,status:o,message:a})=>o===200?r:a?JSON.stringify({type:"doc",content:[{type:"title",attrs:{nodeId:"1"},content:[{type:"text",text:"空"}]},{type:"paragraph",attrs:{nodeId:"2",align:"center"},content:[{type:"text",marks:[{type:"strong"},{type:"font",attrs:{dataSize:24}},{type:"color",attrs:{color:"#FF4A47"}},{type:"backgroundcolor",attrs:{color:"#FFF9DE"}}],text:a}]}]}):null).catch(()=>null)}function Yc(){const e=new URL("http://127.0.0.1:8080/or/api/v3/test/tool/dev");return _(e).then(({data:t,status:n})=>{if(n===200)return t}).catch(()=>null)}async function Qc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Gc(c).then(l=>l?.is_mlp_srv===1?"是":l?.is_mlp_srv===2?"部分":"否")}}async function Jc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=await rc(c).then(u=>(u.util||0)*100);return `${Math.floor(l*1e3)/1e3}%`}}async function Zc(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.rank||"")}}async function el(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.billingUnitName||"")}}async function tl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.comment||"")}}async function nl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await $r(c).then(l=>l?.parent||"")}}async function rl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await os(c).then(l=>l?.owner)||""}}async function ol(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.admin?`${l.admin.name}/${l.admin.loginName}`:"")}}const Lo=new I,Ro=new I;new I;const Mo=new I,al="获取高峰期数据失败",sl={Legacy:"同地域优先",HuailaiLast:"怀来最低",BeijingLast:"北京最低",Standard:"同地优先，近地亲和",BeijingHuailaiBind:"北怀绑定"},as="https://octo.mws.sankuai.com",il="http://octo.sankuai.com";function cl(e){if(!e||!/^[-\w\d\.]{3,}$/.test(e))return Promise.resolve(false);const t=Ro.get(e);if(t)return Promise.resolve(t);const n=new URL(`${il}/api/service/v2/${e}/exist`);return _(n).then(({data:r})=>{const o=r===1;return Ro.set(e,o),o})}function ll(e){const t=Mo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${as}/prod/msgp/v1/gcStateless/getByAppKey`);return n.searchParams.append("appKey",e),_(n).then(({data:r})=>{let{gcConfig:o}=r||{};const{busyDesc:a}=r||{};return a===al&&(o=null),Mo.set(e,o),o}).catch(()=>null)}async function ul(e){if(!await cl(e))return Promise.resolve(null);const n=Lo.get(e);if(n)return Promise.resolve(n);const r=new URL(`${as}/api/octo/v2/service/${e}/group`);return r.searchParams.append("env","3"),_(r).then(({data:o})=>{const{items:a}=o,s=a.find(c=>c.status===1);let i="随机路由";return s?.regionPrefer.name?i=sl[s.regionPrefer.name]:s?.name&&(i=s.name),Lo.set(e,i),i}).catch(()=>null)}async function dl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await ll(c).then(l=>{if(!l)return "";const{active:u,plusBusyContinue:d,rhinoBusyDesc:f}=l;if(!u)return "未启用主动 GC";const p=f?`自定义高峰期【${f}}】`:"继承 Avatar高峰期";return d===1?`✔️允许高峰期GC：${p}`:`❌禁止高峰期GC：${p}`})}}const Oo=new I,qo=new I,Ho=new I,ss=Object.freeze({SINGLE_QPS_VM:"单机限流",CLUSTER_QPS_VM:"集群非精确限流",CLUSTER_QPS_V2:"集群精确限流2.0",CLUSTER_FREQUENCY_V2:"集群限频2.0",CLUSTER_QPS:"集群限流",SINGLE_VM_QPS:"单机限流",CLUSTER_QUOTA:"集群配额",CLUSTER_FREQUENCY:"集群限频",CENTER_CLUSTER_QPS:"集中限流"}),fl=Object.freeze({12:"接口限流",11:"服务限流",2:"自定义限流",3:"自定义限流"}),xn="https://octo.mws.sankuai.com";async function Er(e){const t=Ho.get(e);if(t)return Promise.resolve(t);try{const n=await pl(e),r=await ml(e),o=[];for(const a of r){const s={appkey:e,rhinoKey:n,cell:a,tag:"La:default"},i=await hl(s);i&&(i?.active&&(i.detail=await gl(s)),o.push(i));}return Ho.set(e,o),o}catch{return null}}function pl(e){const t=qo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${xn}/prod/msgp/v1/onelimiter/getLimitRhinoList`);return n.searchParams.append("appKey",e),_(n).then(({data:r})=>{const o=r.rhinoInfoList;let a="rhino-one-limiter";return o.find(s=>s.rhinoKey==="rhino-one-limiter")||(a=o[0]?.rhinoKey),qo.set(e,a),a}).catch(()=>"rhino-one-limiter")}function ml(e,t="La:default"){const n=Oo.get(e);if(n)return Promise.resolve(n);const r=new URL(`${xn}/prod/msgp/v1/onelimiter/getSetsInformation`);return r.searchParams.append("appKey",e),r.searchParams.append("grouptags",t),_(r).then(({data:o})=>(Oo.set(e,o),o)).catch(()=>["default_cell"])}function hl(e){const{appkey:t,tag:n="La:default",rhinoKey:r,cell:o="default_cell"}=e,a=new URL(`${xn}/prod/msgp/v1/onelimiter/main/get`);return a.searchParams.append("set",o),a.searchParams.append("appKey",t),a.searchParams.append("rhinoKey",r),a.searchParams.append("grouptags",n),_(a).then(({data:s})=>{const i=s.noSetConfig,c=JSON.parse(s.configJson),{debug:l,active:u,singleVmQps:d,strategyToSwitch:f,entranceVmQps:p,adaptiveVmPIDStrategy:m}=c,w=p?.active?`启用(${p?.threshold}/秒)`:"关闭",v=m?.active?`启用(CPU利用率>=${m?.threshold}%)`:"关闭",b=`单机入口总限流: ${w}`,C=`自适应限流: ${v}`,$=Object.keys(f).map(L=>({name:ss[L]||L,active:f[L]})),O=[];if(d){const{code:L,active:T,threshold:J}=d;O.push({key:"单机限流",threshold:J,code:L,active:T});}return {cell:o,appkey:t,rhinoKey:r,tag:n,inherit:i,debug:l,active:u,entrance:b,adaptive:C,strategySwitch:$,config:O,detail:[]}}).catch(()=>null)}async function gl(e){const{appkey:t,tag:n="La:default",rhinoKey:r,cell:o="default_cell"}=e,a=new URL(`${xn}/prod/msgp/v1/onelimiter/getEntrancesAndStrategies`);a.searchParams.append("grouptags",n),a.searchParams.append("rhinoKey",r),a.searchParams.append("types","12,11,2,3"),a.searchParams.append("appKey",t),a.searchParams.append("pageSize","100"),a.searchParams.append("pageNum","1"),a.searchParams.append("filter",""),a.searchParams.append("set",o);const{data:s}=await _(a);return yl(s)}function yl(e){const{total:t,active:n}=e,r=[];for(const o of n){const{entranceType:a,config:s}=o,{entrance:i,strategyList:c}=s,l=[];for(const u of c){const{alias:d,active:f,strategyEnum:p,threshold:m,totalThreshold:w}=u;f&&l.push({desc:d,strategy:p,strategyName:ss[p],threshold:p==="SINGLE_VM_QPS"?m:w});}l.length&&r.push({type:fl[a],entrance:i,strategyList:l});}return {total:t,entrance:r}}async function bl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Er(c).then(l=>wl(l))}}function wl(e){return e?e.length===1?Do(e[0].active,e[0].inherit):e.map(t=>`${t.cell}:${Do(t.active,t.inherit)}`).join("，"):"-"}function Do(e,t){return t?"继承中心":e?"开启✅":"关闭❌"}async function vl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>l?.name||"")}}async function kl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Er(c).then(l=>_l(l))}}function _l(e){return e?e.length===1?Uo(e[0].config,e[0].active,e[0].debug,e[0].inherit):e.map(t=>`${t.cell}:${Uo(t.config,t.active,t.debug,t.inherit)}`).join("，"):"-"}function Uo(e,t,n,r){return r?"继承中心":!t&&!n?"未开启":e.filter(o=>o.active).map(o=>`${o.key}[${o.threshold}]`).join("、")}async function Cl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Er(c).then(l=>xl(l))}}function xl(e){return e?e.length===1?Bo(e[0].debug,e[0].inherit):e.map(t=>`${t.cell}:${Bo(t.debug,t.inherit)}`).join("，"):"-"}function Bo(e,t){return t?"继承中心":e?"开启✅":"关闭❌"}function Fo(e=0){const t=new Date;return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]}async function Sl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=$l(c),u=await Wa(l).catch(()=>null);if(!u)return "无";const{rows:d}=u;if(!d.length)return "无";const[[,f,,p]]=d;return `${f}次, ${p}`}}function $l(e){return {widgetKey:"widget-db60a05c-7c6a-4152-ba0c-66be26bafc8e",dashKey:"dashboard-8e635e16-76e2-46f4-a2bb-53f12170bfd1",params:{appKey:e,endDate:Fo(),startDate:Fo(360),activityId18:"all-selected-yuntu",activityIdSG:"all-selected-yuntu",activityIdNormal:"all-selected-yuntu"}}}async function El(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await oc(c).then(l=>l.capacityLevel+"")}}async function Al(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await Sr(c).then(d=>d.capacityLevels)).filter(d=>!d.isCapacityStandard).map(d=>`${d.regionName}[${d.cellName}]:${d.migrationTips}`).join(` 
`)||"已达标"}}async function Tl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await Sr(c).then(d=>d.capacityLevels)).filter(d=>!d.isCapacityStandard).map(d=>`${d.regionName}[${d.cellName}]:${d.standardReason}`).join(` 
`)||"无"}}async function Pl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await de(c).then(l=>Il(l?.stateful))}}function Il(e){switch(e){case  true:return "有状态";case  false:return "无状态"}return "-"}async function Nl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await ul(c).then(l=>l||"")}}async function Ll(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){if(c=c.trim(),!/\d+([,_]\d+)*/.test(c))return A.warning("解析orgId失败",5e3,"km"),"";const l=await lc(c);return !l||!l.length?"":l.filter(u=>u.status==="ONLINE").filter(u=>u.actionType==="CLOSE").filter(u=>u.configType!=="GLOBAL").map(({display:u,configValue:d,configType:f,covered:p})=>`[${Ja[f]}${p?"强制":""}封禁] ${u} (${d})`).join("；")}}function Rl(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(!o)switch(g.version){case 1:t.outerHTML=`<a><ul class="ct-task-list"><li class="ct-task-li" data-type="task_item"><p>${n||"<br>"}</p></li></ul></a>`;return;case 2:const{posAtStart:a,posAtEnd:s,node:i}=r,c=ji({contentNode:i,content:n});g.step(a-1,s+1,c,true);return}}function Ml(e){const{node:t,pmNode:n,xtable:r}=e;if(!(!t&&!n)&&!r)switch(g.version){case 1:const o=t?.parentNode?.parentNode;o?.className==="ct-task-list"&&(o.outerHTML=`<a>${t.outerHTML}</a>`);return;case 2:const a=Ol(n);if(!a)return;const{posAtStart:s,posAtEnd:i,contentNode:c}=a;g.step(s-1,i+1,c);return}}function Ol(e){if(!e)return null;if(e?.parent?.node?.type.name==="task_item"){const n=e.parent.parent,{posAtStart:r,posAtEnd:o}=n;return {posAtStart:r,posAtEnd:o,contentNode:e.node}}if(e.node?.type.name!=="task_list")return null;const t=e.children?.[0]?.children?.[0];if(t&&t.node){const{posAtStart:n,posAtEnd:r}=e;return {contentNode:t.node,posAtStart:n,posAtEnd:r}}return null}async function ql(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){c=c.trim().replace(/\s+/g,"");const l=await uc(c);return !l||!l.length?"":l.filter(u=>u.status==="ONLINE").filter(u=>u.actionType==="CLOSE").filter(u=>u.configType!=="GLOBAL").map(({display:u,configValue:d,configType:f,covered:p})=>`[${Ja[f]}${p?"强制":""}封禁] ${u} (${d})`).join("；")}}const Hl=(e,t)=>e===t,ge=Symbol("solid-proxy"),rr=Symbol("solid-track"),sn={equals:Hl};let is=fs;const qe=1,cn=2,cs={owned:null,cleanups:null,context:null,owner:null};var K=null;let Mn=null,B=null,Z=null,Ce=null,Sn=0;function Ct(e,t){const n=B,r=K,o=e.length===0,a=t===void 0?r:t,s=o?cs:{owned:null,cleanups:null,context:a?a.context:null,owner:a},i=o?e:()=>e(()=>ce(()=>$n(s)));K=s,B=null;try{return pt(i,!0)}finally{B=n,K=r;}}function te(e,t){t=t?Object.assign({},sn,t):sn;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=o=>(typeof o=="function"&&(o=o(n.value)),ds(n,o));return [us.bind(n),r]}function q(e,t,n){const r=Tr(e,t,false,qe);Ot(r);}function ln(e,t,n){is=Vl;const r=Tr(e,t,false,qe);r.user=true,Ce?Ce.push(r):Ot(r);}function Y(e,t,n){n=n?Object.assign({},sn,n):sn;const r=Tr(e,t,true,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Ot(r),us.bind(r)}function Ul(e){return pt(e,false)}function ce(e){if(B===null)return e();const t=B;B=null;try{return e()}finally{B=t;}}function ls(e){ln(()=>ce(e));}function Ar(e){return K===null||(K.cleanups===null?K.cleanups=[e]:K.cleanups.push(e)),e}function or(){return B}function Bl(e){const t=Y(e),n=Y(()=>ar(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function us(){if(this.sources&&this.state)if(this.state===qe)Ot(this);else {const e=Z;Z=null,pt(()=>dn(this),false),Z=e;}if(B){const e=this.observers?this.observers.length:0;B.sources?(B.sources.push(this),B.sourceSlots.push(e)):(B.sources=[this],B.sourceSlots=[e]),this.observers?(this.observers.push(B),this.observerSlots.push(B.sources.length-1)):(this.observers=[B],this.observerSlots=[B.sources.length-1]);}return this.value}function ds(e,t,n){let r=e.value;return (!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&pt(()=>{for(let o=0;o<e.observers.length;o+=1){const a=e.observers[o],s=Mn&&Mn.running;s&&Mn.disposed.has(a),(s?!a.tState:!a.state)&&(a.pure?Z.push(a):Ce.push(a),a.observers&&ps(a)),s||(a.state=qe);}if(Z.length>1e6)throw Z=[],new Error},false)),t}function Ot(e){if(!e.fn)return;$n(e);const t=Sn;Fl(e,e.value,t);}function Fl(e,t,n){let r;const o=K,a=B;B=K=e;try{r=e.fn(t);}catch(s){return e.pure&&(e.state=qe,e.owned&&e.owned.forEach($n),e.owned=null),e.updatedAt=n+1,ms(s)}finally{B=a,K=o;}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?ds(e,r):e.value=r,e.updatedAt=n);}function Tr(e,t,n,r=qe,o){const a={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:K,context:K?K.context:null,pure:n};return K===null||K!==cs&&(K.owned?K.owned.push(a):K.owned=[a]),a}function un(e){if(e.state===0)return;if(e.state===cn)return dn(e);if(e.suspense&&ce(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Sn);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===qe)Ot(e);else if(e.state===cn){const r=Z;Z=null,pt(()=>dn(e,t[0]),false),Z=r;}}function pt(e,t){if(Z)return e();let n=false;t||(Z=[]),Ce?n=true:Ce=[],Sn++;try{const r=e();return jl(n),r}catch(r){n||(Ce=null),Z=null,ms(r);}}function jl(e){if(Z&&(fs(Z),Z=null),e)return;const t=Ce;Ce=null,t.length&&pt(()=>is(t),false);}function fs(e){for(let t=0;t<e.length;t++)un(e[t]);}function Vl(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:un(r);}for(t=0;t<n;t++)un(e[t]);}function dn(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const o=r.state;o===qe?r!==t&&(!r.updatedAt||r.updatedAt<Sn)&&un(r):o===cn&&dn(r,t);}}}function ps(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=cn,n.pure?Z.push(n):Ce.push(n),n.observers&&ps(n));}}function $n(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),o=n.observers;if(o&&o.length){const a=o.pop(),s=n.observerSlots.pop();r<o.length&&(a.sourceSlots[s]=r,o[r]=a,n.observerSlots[r]=s);}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)$n(e.owned[t]);e.owned=null;}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null;}e.state=0;}function Gl(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ms(e,t=K){throw Gl(e)}function ar(e){if(typeof e=="function"&&!e.length)return ar(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=ar(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r);}return t}return e}const Kl=Symbol("fallback");function jo(e){for(let t=0;t<e.length;t++)e[t]();}function zl(e,t,n={}){let r=[],o=[],a=[],s=0,i=t.length>1?[]:null;return Ar(()=>jo(a)),()=>{let c=e()||[],l,u;return c[rr],ce(()=>{let f=c.length,p,m,w,v,b,C,$,O,L;if(f===0)s!==0&&(jo(a),a=[],r=[],o=[],s=0,i&&(i=[])),n.fallback&&(r=[Kl],o[0]=Ct(T=>(a[0]=T,n.fallback())),s=1);else if(s===0){for(o=new Array(f),u=0;u<f;u++)r[u]=c[u],o[u]=Ct(d);s=f;}else {for(w=new Array(f),v=new Array(f),i&&(b=new Array(f)),C=0,$=Math.min(s,f);C<$&&r[C]===c[C];C++);for($=s-1,O=f-1;$>=C&&O>=C&&r[$]===c[O];$--,O--)w[O]=o[$],v[O]=a[$],i&&(b[O]=i[$]);for(p=new Map,m=new Array(O+1),u=O;u>=C;u--)L=c[u],l=p.get(L),m[u]=l===void 0?-1:l,p.set(L,u);for(l=C;l<=$;l++)L=r[l],u=p.get(L),u!==void 0&&u!==-1?(w[u]=o[l],v[u]=a[l],i&&(b[u]=i[l]),u=m[u],p.set(L,u)):a[l]();for(u=C;u<f;u++)u in w?(o[u]=w[u],a[u]=v[u],i&&(i[u]=b[u],i[u](u))):o[u]=Ct(d);o=o.slice(0,s=f),r=c.slice(0);}return o});function d(f){if(a[u]=f,i){const[p,m]=te(u);return i[u]=m,t(c[u],p)}return t(c[u])}}}function P(e,t){return ce(()=>e(t||{}))}function Ut(){return  true}const Wl={get(e,t,n){return t===ge?n:e.get(t)},has(e,t){return t===ge?true:e.has(t)},set:Ut,deleteProperty:Ut,getOwnPropertyDescriptor(e,t){return {configurable:true,enumerable:true,get(){return e.get(t)},set:Ut,deleteProperty:Ut}},ownKeys(e){return e.keys()}};function On(e){return (e=typeof e=="function"?e():e)?e:{}}function Xl(){for(let e=0,t=this.length;e<t;++e){const n=this[e]();if(n!==void 0)return n}}function Ne(...e){let t=false;for(let s=0;s<e.length;s++){const i=e[s];t=t||!!i&&ge in i,e[s]=typeof i=="function"?(t=true,Y(i)):i;}if(t)return new Proxy({get(s){for(let i=e.length-1;i>=0;i--){const c=On(e[i])[s];if(c!==void 0)return c}},has(s){for(let i=e.length-1;i>=0;i--)if(s in On(e[i]))return  true;return  false},keys(){const s=[];for(let i=0;i<e.length;i++)s.push(...Object.keys(On(e[i])));return [...new Set(s)]}},Wl);const n={},r=Object.create(null);for(let s=e.length-1;s>=0;s--){const i=e[s];if(!i)continue;const c=Object.getOwnPropertyNames(i);for(let l=c.length-1;l>=0;l--){const u=c[l];if(u==="__proto__"||u==="constructor")continue;const d=Object.getOwnPropertyDescriptor(i,u);if(!r[u])r[u]=d.get?{enumerable:true,configurable:true,get:Xl.bind(n[u]=[d.get.bind(i)])}:d.value!==void 0?d:void 0;else {const f=n[u];f&&(d.get?f.push(d.get.bind(i)):d.value!==void 0&&f.push(()=>d.value));}}}const o={},a=Object.keys(r);for(let s=a.length-1;s>=0;s--){const i=a[s],c=r[i];c&&c.get?Object.defineProperty(o,i,c):o[i]=c?c.value:void 0;}return o}const hs=e=>`Stale read from <${e}>.`;function Re(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Y(zl(()=>e.each,e.children,t||void 0))}function fn(e){const t=e.keyed,n=Y(()=>e.when,void 0,{equals:(r,o)=>t?r===o:!r==!o});return Y(()=>{const r=n();if(r){const o=e.children;return typeof o=="function"&&o.length>0?ce(()=>o(t?r:()=>{if(!ce(n))throw hs("Show");return e.when})):o}return e.fallback},void 0,void 0)}function Yl(e){let t=false;const n=(a,s)=>(t?a[1]===s[1]:!a[1]==!s[1])&&a[2]===s[2],r=Bl(()=>e.children),o=Y(()=>{let a=r();Array.isArray(a)||(a=[a]);for(let s=0;s<a.length;s++){const i=a[s].when;if(i)return t=!!a[s].keyed,[s,i,a[s]]}return [-1]},void 0,{equals:n});return Y(()=>{const[a,s,i]=o();if(a<0)return e.fallback;const c=i.children;return typeof c=="function"&&c.length>0?ce(()=>c(t?s:()=>{if(ce(o)[0]!==a)throw hs("Match");return i.when})):c},void 0,void 0)}function Bt(e){return e}const qn="__km-enhancement-app";let Ke=null;function He(){return Ke||(document.getElementById(qn)?document.getElementById(qn):(Ke=document.createElement("dialog"),Ke.setAttribute("id",qn),document.body.append(Ke),Ke))}const Pr="km_menu_custom_link",[Ql,Ir]=te(false),[Jl,Nr]=te(0),[Zl,Lr]=te(""),[eu,tu]=te(false),[Vo,nu]=te([]),ru=()=>Vo().length?Vo():xe(Pr,[]),ou=e=>{nu(e),Se(Pr,e);},sr={show:Ql,setShow:Ir,progress:Jl,setProgress:Nr,extraMsg:Zl,setExtraMsg:Lr},pn={showSetting:eu,setShowSetting:tu,settingRows:ru,setSettingRows:ou};function gs(){return xe(Pr,[])}function it(){Ir(true),Nr(0),Lr(""),He().showModal();}function ct(){Ir(false),He().close();}function lt(e,t){Nr(e),Lr(t);}const au="https://octo.mws.sankuai.com",Go="https://avatar.mws.sankuai.com",Ko=[{type:"link-as",url:e=>`${Go}/avatar-hulk-new/group-new?appkey=${e}&env=prod`},{type:"link-avatar",url:e=>`${Go}/#/service/detail/info?appkey=${e}&env=prod`},{type:"link-octo",url:e=>`${au}/service-provider-info?appkey=${e}&tab=service-provider-info`}];function su(e,t){const{node:n,content:r,pmNode:o,xtable:a}=e;let s=Ko.find(c=>c.type===t)?.url(r)||"",i=Ko.find(c=>c.type===t)?.url;if(!s){const c=gs();s=c.find(l=>`link-custom-${l.label}`===t)?.rule?.replace(/\${q}/g,r),i=l=>c.find(u=>`link-custom-${u.label}`===t)?.rule?.replace(/\${q}/g,l);}if(s){if(a){if(!Fe(a))return;$e(a,a.data.map(c=>c.type==="text"?{type:"link",value:c.value,link:i(c.value)}:c));return}switch(g.version){case 1:n.innerHTML=`<a href="${s}" target="_blank" rel="noopener" class="pk-link">${r}</a>`;return;case 2:const{posAtStart:c,posAtEnd:l}=o,u=Vi({title:r,href:s});g.step(c,l,u);return}}}function iu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){if(!Fe(o))return;$e(o,o.data.map(a=>a.type==="link"?{type:"text",value:a.value}:a));return}switch(g.version){case 1:t.innerHTML=`<a>${n}</a>`;return;case 2:Le(r,"link")?.forEach(s=>{if(s&&s.children.length>0){const i=s.children[0].node,{posBefore:c,posAfter:l}=s;g.step(c,l,i);}});return}}function cu(e){const{node:t,pmNode:n,xtable:r}=e;if(r){if(!Fe(r))return;$e(r,r.data.map(o=>o.type==="link"?{type:"text",value:o.link}:o));return}switch(g.version){case 1:{const a=t.querySelector("a")?.href;if(!a)return;t.innerHTML=`<a>${a}</a>`;return}case 2:Le(n,"link")?.forEach(a=>{if(a&&a.children.length>0){const s=a.node.attrs.href,{posBefore:i,posAfter:c}=a,l=editorInst.view.state.schema.text(s.toString());g.step(i,c,l);}});return}}async function lu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await je({appkey:c,idcName:k.hostIdcName})).filter(d=>d.iaasInfo.building===k.hostBuilding&&(k.cell!==null?d.cell===k.cell:true)).map(d=>d.name).join(", ")}}async function uu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await je({appkey:c,idcName:k.hostIdcName})).filter(d=>d.iaasInfo.building===k.hostBuilding&&(k.cell!==null?d.cell===k.cell:true)).length.toString()}}async function du(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const u=(await je({appkey:c,idcName:k.hostIdcName})).filter(p=>k.cell!==null?p.cell===k.cell:true),d=u.filter(p=>p.iaasInfo.building===k.hostBuilding);if(!d?.length)return "0";const f=d.length/u.length*100;return 0<f&&f<100?f.toFixed(1):f.toString()}}async function fu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await je({appkey:c,idcName:k.hostIdcName})).filter(d=>d.iaasInfo.building===k.hostBuilding&&(k.cell!==null?d.cell===k.cell:true)).reduce((d,f)=>d+f.cpu_count,0).toString()}}async function pu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await je({appkey:c,idcName:k.hostIdcName})).filter(d=>d.iaasInfo.building===k.hostBuilding&&(k.cell!==null?d.cell===k.cell:true)).reduce((d,f)=>d+f.mem_size,0).toString()}}async function mu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return (await je({appkey:c,idcName:k.hostIdcName})).filter(d=>d.iaasInfo.building===k.hostBuilding&&(k.cell!==null?d.cell===k.cell:true)).reduce((d,f)=>d+f.disk_size,0).toString()}}async function hu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const u=(await je({appkey:c,poolType:"紧急资源池"})).reduce((d,f)=>(d[f.ctime.split(" ")[0]]=(d[f.ctime.split(" ")[0]]||0)+1,d),{});return [...Object.entries(u)].map(([d,f])=>`${d} (${f})`).join(", ")}}let me=null;const gu={title:"地域选择",tips:"目前暂时仅支持 北京、上海、怀来、香港 地域",options:[{label:"全部",value:"-",callback:()=>me=null},{label:"北京",value:"beijing",callback:()=>me="beijing"},{label:"上海",value:"shanghai",callback:()=>me="shanghai"},{label:"怀来",value:"cnhl",callback:()=>me="cnhl"},{label:"香港",value:"cnhk",callback:()=>me="cnhk"}]},yu=()=>me==="beijing"?"北京-线上机器数":me==="shanghai"?"上海-线上机器数":me==="cnhl"?"怀来-线上机器数":me==="cnhk"?"香港-线上机器数":"线上部署地域详情",bu=()=>me;let En="all";const Rr=[{value:"all",label:"全部资源"},{value:"holiday",label:"活动资源池"},{value:"policy",label:"紧急资源池"},{value:"migration",label:"弹性资源池"}],wu={title:"自定义机器类型",tips:"目前暂时仅支持 全部、活动资源、紧急资源、弹性资源",options:Rr.map(e=>({...e,callback:()=>En=e.value}))},vu=()=>{const e=En;return e==="all"?"线上机器数":`${Rr.find(n=>n.value===e)?.label?.replace("资源","")||""}机器数`},ku=()=>{const e=En;return e==="all"?null:Rr.find(t=>t.value===e)?.label||""},_u=()=>["holiday","policy","migration"].includes(En);async function Cu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){if(_u()){const l=ku(),u=await Ya({appkey:c,poolType:l});return String(u)}return await Mt(c).then(l=>l.total.toString())}}async function xu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Mt(c).then(l=>l.idcTotal.toString())}}async function Su(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=await Mt(c);return new Set(l.idcList.map(d=>d.region)).size.toString()}}async function $u(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Mt(c).then(l=>Au(l))}}async function Eu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await Mt(c).then(l=>Tu(l))}}function Au(e){return !e.idcList||!e.idcList.length?"-":e.idcList.filter(n=>k.region!==null?n.region===k.region:true).map(n=>`${n.name}(${n.hostCount})`).join(", ")}function Tu(e){if(!e.idcList||!e.idcList.length)return "-";const t=e.idcList.reduce((r,o)=>({...r,[o.region]:(r[o.region]||0)+o.hostCount}),{}),n=bu();return n?`${t[n]||0}`:Object.keys(t).map(r=>`${r}(${t[r]})`).join(", ")}const zo=new I,Pu="https://frigate.sankuai.com";function Iu(e="waimai_ad,ad_pub"){const t=zo.get(e);if(t)return Promise.resolve(t);const n=new URL(`${Pu}/frigateapi/v1/autoscale/serviceConfigs/batch`);return n.searchParams.set("serviceGroupNames",e),_(n).then(({data:r})=>{const o=r.map(a=>({appkey:a.appkey,status:a.status}));return zo.set(e,o),o}).catch(()=>[])}async function Nu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await xr(c).then(l=>l?"✅已接入":"❌未接入")}}async function Lu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){const l=await Iu();console.log("🚀 ~ _query ~ appkeyLst:",l);const u=l.some(d=>d.appkey===c&&d.status===1);return console.log("🚀 ~ _query ~ content:",c),u?"✅已接入":l.some(d=>d.appkey===c&&d.status===2)?"⏸暂停":"❌未接入"}}async function Ru(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await xr(c).then(async l=>l?await Zi(c).then(u=>{const d=[];return u.enableScaleOut&&d.push("允许扩容✅"),u.enableScaleIn&&d.push("允许缩容"),u.manualControlSilent&&d.push("有手动控制静默期"),d.join("、")||"无"}):"❌未接入弹性")}}async function Mu(e){const{node:t,content:n,pmNode:r,xtable:o}=e;if(o){await S(o,i);return}if(!n)return;const a=await i(n);if(r)return y({...e,content:a});const s=t.closest("td")?.nextSibling;if(s)return y({...e,node:s,content:a});async function i(c){return await xr(c).then(async l=>{if(!l)return "❌未接入弹性";const u=await ec(c);return Ou(u)}).catch(l=>`异常: ${l.message}`)}}function Ou(e){return e.map(t=>{if(t.tracking){const n=t.trackingInfos.filter(r=>r.state).map(r=>`✅${r.name}[${r.metric}] (${r.lower} ~ ${r.upper})`).join("、");return `[${t.name}]:${n}, 监控:${t.monitor}, 定时:${t.timing}`}else {const n="🙁未配置目标追踪任务",r=t.monitor+t.timing===0?", ❌未配置策略":"";return `[${t.name}]:${n}, 监控:${t.monitor}, 定时:${t.timing}${r}`}}).join("；")}async function Tt(e,t){switch(t){case "query-appkey":return await vc(e);case "query-appkey-mlp":return await Qc(e);case "query-appkey-activity":return await Sl(e);case "query-hulk-parent":return await nl(e);case "query-host-sn":return await xc(e);case "query-org-busyperiod":return await Ll(e);case "query-appkey-busyperiod":return await ql(e);case "query-host-rack":return await Pc(e);case "add-banner-status":return await Nu(e);case "add-banner-status-ad":return await Lu(e);case "add-banner-plus":return await Ru(e);case "add-banner-tracking":return await Mu(e);case "add-owner":return await ol(e);case "add-sre":return await qc(e);case "add-org-path":return await Ac(e);case "add-util":return await Jc(e);case "add-capacity":return await El(e);case "add-capacity-desc":return await Tl(e);case "add-capacity-tip":return await Al(e);case "add-rank":return await Zc(e);case "add-unit":return await el(e);case "add-stateful":return await Pl(e);case "add-rpc-group":return await Nl(e);case "add-specification":return await Sc(e);case "add-appkey-owt":return await Rc(e);case "add-appkey-cn-name":return await vl(e);case "add-appkey-desc":return await tl(e);case "add-host-cnt":return await Cu(e);case "add-host-idc-cnt":return await xu(e);case "add-host-region-cnt":return await Su(e);case "add-host-idc-detail":return await $u(e);case "add-host-region-detail":return await Eu(e);case "add-host-building-detail":return await lu(e);case "add-host-building-percent":return await du(e);case "add-host-building-cnt":return await uu(e);case "add-host-building-cpu":return await fu(e);case "add-host-building-mem":return await pu(e);case "add-host-building-disk":return await mu(e);case "add-host-info-migration":return await hu(e);case "add-owner-domain":return await rl(e);case "add-org-path-domain":return await Mc(e);case "add-domain-dns":return await Nc(e);case "add-rhino-on":return await bl(e);case "add-rhino-debug":return await Cl(e);case "add-rhino-type":return await kl(e);case "add-rhino-gc":return await dl(e);case "add-unit-sre":return await bc(e);case "add-unit-org":return await yc(e);case "remove-link":return iu(e);case "extract-link-url":return cu(e);case "remove-mention":return await wc(e);case "mention-get-org":return await $c(e);case "add-task-node":return Rl(e);case "remove-task-node":return Ml(e);case "mention-user":return await Gi(e);case "ai-appkey-admin":return await Uc(e)}!e.content||Ad(e.content)||su(e,t);}async function x(e){if(g.version===1)return await Hu(e);if(g.version===2)return await qu(e);if(R.dataView)return await Du(e)}async function qu(e){g.offset=1;const t=g.table,n=$i(1),r=g.cellIndex+g.offset,o=kr(r+1);for(let a=t.children.length-1;a>=0;a--){const s=t.children[a],i=o({targetCol:g.cellIndex,rowIdx:a}),c=s.children[i],l=o({targetCol:r,rowIdx:a}),u=s.children[l];if(!c)continue;const d=c.node?.type.name==="table_header"?vn({content:e}):c.node;if(n){if(!u)continue;g.step(u.posBefore,u.posAfter,d);}else g.step(c.posAfter,c.posAfter,d);}g.commit(),await ie(100);}async function Hu(e){g.offset=1;let t=true;if(!Ei(1)&&g.version===2&&(t=editorInst.commands.table.addColumnBefore()),t&&e){await ie(100);const n=Si(1);n&&y({...n,content:e});}}async function Du(e){if(!e)throw new Error("多维表格列名不能为空");if(!R.dataView)throw new Error("未获取到 dataView");const t=bi();if(t){R.opColId=parseInt(t,10);return}const n=R.dataView.data.createId(),r=R.createTransaction();try{const o=R.modelColumnNames,a=Uu(e,o);R.dataView.addColumnStep({name:a,rawType:"string",columnType:1,id:n,config:{}}),r?.commit();}finally{r?.close();}await ie(200),R.opColId=n;}function Uu(e,t){if(!t.includes(e))return e;const n=new RegExp(`^${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}-\\d+$`),r=t.filter(a=>n.test(a));if(!r.length)return `${e}-1`;const o=Math.max(...r.map(a=>{const s=a.match(/-(\d+)$/);return s?parseInt(s[1],10):0}));return `${e}-${o+1}`}const Bu=[{value:"cpu",label:"CPU"},{value:"mem",label:"内存"},{value:"disk",label:"磁盘"}],Fu={title:"自定义服务推荐配置内容",tips:"控制输出格式, 单选则仅输出一个数值(无单位), 多选则输出 `${cpu}核/${mem}G/${disk}G` ",type:"checkbox",defaultChecked:()=>k.selectedSpecs,options:Bu.map(e=>({...e,callback:()=>{k.selectedSpecs.includes(e.value)?k.selectedSpecs=k.selectedSpecs.filter(n=>n!==e.value):k.selectedSpecs.push(e.value);}}))},ju=()=>{const e=k.selectedSpecs;let t="推荐配置";return e.length===1&&(e[0]==="cpu"&&(t+="CPU/核"),e[0]==="mem"&&(t+="内存/G"),e[0]==="disk"&&(t+="磁盘/GB")),t};async function Mr(e){switch(e){case "query-appkey":await x("Appkey");return;case "query-appkey-mlp":await x("MLP服务");return;case "query-appkey-activity":await x("活动报备Tag");return;case "query-hulk-parent":await x("宿主机");return;case "query-host-rack":await x("机柜号");return;case "query-host-sn":await x("SN号");return;case "query-org-busyperiod":await x("部门高峰期");return;case "query-appkey-busyperiod":await x("服务高峰期");return;case "add-banner-status":await x("弹性接入");return;case "add-banner-status-ad":await x("广告智能弹性");return;case "add-banner-plus":await x("Plus发布期间弹性");return;case "add-banner-tracking":await x("弹性目标追踪任务");return;case "add-owner":case "add-owner-domain":await x("Owner");return;case "add-sre":await x("SRE");return;case "add-org-path":case "add-org-path-domain":await x("开发团队");return;case "add-domain-dns":await x("域名解析");return;case "add-appkey-owt":await x("OWT");return;case "add-appkey-desc":await x("描述");return;case "add-appkey-cn-name":await x("服务中文名");return;case "add-unit-sre":await x("结算单元SRE");return;case "add-unit-org":await x("结算单元部门");return;case "mention-get-org":await x("部门");return;case "add-util":await x("上周利用率");return;case "add-capacity":await x("容灾等级");return;case "add-capacity-desc":await x("容灾不达标描述");return;case "add-capacity-tip":await x("容灾治理建议");return;case "add-rank":await x("服务等级");return;case "add-unit":await x("结算单元");return;case "add-stateful":await x("服务状态");return;case "add-rpc-group":await x("OCTO路由策略");return;case "add-host-cnt":await x(vu());return;case "add-host-idc-cnt":await x("线上机房数");return;case "add-host-region-cnt":await x("线上部署地域数");return;case "add-host-idc-detail":await x("线上部署机房详情");return;case "add-host-region-detail":await x(yu());return;case "add-host-building-detail":await x("机房楼栋部署机器");return;case "add-host-building-percent":await x("机房楼栋部署占比");return;case "add-host-building-cnt":await x("机房楼栋部署/台");return;case "add-host-building-cpu":await x("机房楼栋CPU/核");return;case "add-host-building-mem":await x("机房楼栋内存/GB");return;case "add-host-building-disk":await x("机房楼栋磁盘/GB");return;case "add-host-info-migration":await x("紧急资源详情");return;case "add-specification":await x(ju());return;case "add-rhino-on":await x("是否接入Rhino");return;case "add-rhino-debug":await x("Rhino限流Debug");return;case "add-rhino-type":await x("Rhino限流类型");return;case "add-rhino-gc":await x("OCTO主动GC");return;case "extract-link-url":await x("链接URL");return;case "ai-appkey-admin":await x("服务活跃负责人");return}}async function Vu(e){if(g.version!==2||!g.table)return;const{content:t}=e,{activityId:n,businessId:r}=Gu(t);if(!n||!r)return A.warning("解析链接失败",5e3,"km");const o=await cc(n,r);if(!o||!o.length)return A.warning(`未查询到数据: activityId=${n}, businessId=${r}`,8e3,"km");const a=[Me({nodes:[{content:"部门"},{content:"Appkey"},{content:"Set/LiteSet"},{content:"地域"},{content:"机房"},{content:"需求台"},{content:"需求核"},{content:"添加人"}].map(vn)})],s=o.length;o.forEach(({appkey:l,orgName:u,cell:d,regionName:f,applyCount:p,hostConfig:m,applyIdc:w,addUser:v},b)=>{a.push(Me({nodes:[{content:u},{content:l},{content:d},{content:f},{content:w||"-"},{content:p.toString()},{content:(p*m.cpu).toString()},{content:v}].map(oe)})),lt((100*b+1)/s,` (${b+1}/${s})`);});const i=Cr({nodes:a}),{posAfter:c}=g.table;g.step(c,c,i);}function Gu(e){const t=e.match(/(?:#\/source|v2\/operation)\/activity\/(?<activityId>\d+)\/business\/(?<businessId>\d+)\/\w+/);return {activityId:Number(t?.groups?.activityId),businessId:Number(t?.groups?.businessId)}}async function Ku(e){if(g.version!==2||!g.table)return;const{content:t}=e;let n=zu(t);if(!n)return A.warning("解析orgId失败",5e3,"km");n=n.replace(/,/g,"_");const r=await Kc(n);if(!r||!r.length)return A.warning(`未查询到数据: org=${n}`,8e3,"km");const o=[Me({nodes:vn({content:"Appkey"})})],a=r.length;r.forEach(({appkey:c},l)=>{o.push(Me({nodes:oe({content:c})})),lt((100*l+1)/a,` (${l+1}/${a})`);});const s=Cr({nodes:o}),{posAfter:i}=g.table;g.step(i,i,s);}function zu(e){const t=[/avatar\.mws\.sankuai\.com\/(?:#|v2)\/owt\/\w+\?ids=(?<orgId>\d+(?:,\d+)*)/,/\.sankuai\.com\/#\/operational\/diagnoseReport\/(?<orgId>\d+_\d+_\d+)/,/.*(?<orgId>\d{4,}(?:[-,_]*\d{4,})+).*/];for(const n of t){const r=e.match(n);if(r?.groups?.orgId)return r.groups.orgId}return ""}function Or(e){return ["query-org-appkey-list","query-menu","query-activity-resource-list"].includes(e)}async function ys(e,t){switch(t){case "query-org-appkey-list":it(),await Ku(e),ct();return;case "query-activity-resource-list":it(),await Vu(e),ct();return;case "query-menu":return He().showModal()}}async function Wu(e){if(g.version!==2||!g.table)return;const{content:t}=e,n=Xu(t);if(!n)return A.warning(`解析交换机不合法(${t}), 示例: TJ-HH-401-D14-H6850-A-INT`,8e3,"km");const r=await Wc(n);if(!r||!r.length)return A.warning(`未查询到数据: query=${n}`,8e3,"km");r.forEach(({name:o,env:a,switchInfo:s})=>{g.processResults.push(Me({nodes:[oe({content:s}),oe({content:o}),oe({content:a})]}));});}function Xu(e){return e.split("-").length<5?null:e.trim()}async function Yu(e){if(g.version!==2||!g.table)return;const{content:t}=e;if(!t)return;const n=await kc(t);if(!n||!n.length)return A.warning(`未查询到数据: query=${t}`,8e3,"km");n.forEach(({name:r,parent:o,cpuCount:a,memSize:s,cell:i})=>{g.processResults.push(Me({nodes:[oe({content:o}),oe({content:r}),oe({content:i}),oe({content:a+""}),oe({content:s+""})]}));});}async function Qu(e){if(g.version!==2||!g.table)return;const{content:t}=e,n=Ju(t);if(!n)return A.warning(`解析机柜/机架位不合法(${t}), 示例: HH-401-D-14-6`,8e3,"km");const r=await zc(n);if(!r||!r.length)return A.warning(`未查询到数据: query=${n}`,8e3,"km");r.forEach(({name:o,env:a,rackInfo:s})=>{g.processResults.push(Me({nodes:[oe({content:s}),oe({content:o}),oe({content:a})]}));});}function Ju(e){return e.split("-").length<1?null:e.trim()}function bs(e){return ["query-rack-host-list","query-parent-host-list","query-switch-host-list"].includes(e)}async function Zu(e,t){switch(t){case "query-parent-host-list":await Yu(e);return;case "query-switch-host-list":await Wu(e);return;case "query-rack-host-list":await Qu(e);return}}function ed(e){if(g.processResults.length)switch(e){case "query-parent-host-list":return Hn([{content:"宿主机"},{content:"机器"},{content:"cell"},{content:"CPU"},{content:"mem"}]);case "query-switch-host-list":return Hn([{content:"交换机"},{content:"物理机"},{content:"环境"}]);case "query-rack-host-list":return Hn([{content:"机柜/机架位"},{content:"物理机"},{content:"环境"}])}}function Hn(e){const t=e.map(a=>vn(a)),n=[Me({nodes:t}),...g.processResults],r=Cr({nodes:n}),{posAfter:o}=g.table;g.step(o,o,r);}async function td(e){if(!g.el||!g.cell||g.version!==2)return g.clear();const t=g.table,n=g.cell;if(Or(e)){const o={content:n.node.textContent||n.dom.innerText?.trim()||""};await ys(o,e),e!=="query-menu"&&g.clear();return}if(bs(e)){const r=t.children,o=r.length;let a=0;it();try{for(let s=0;s<o;s++){lt(100*a/o,` (${a}/${o})`);const i=r[s],c=(Le(i,"paragraph")||[]).reverse().map(l=>i.node?.type.name==="table_header"?Promise.resolve():new Promise(u=>{const d=l.node.textContent||l.dom.innerText?.trim()||"",f={pmNode:l,content:d};requestAnimationFrame(async()=>{await Zu(f,e),u();});}));await Promise.all(c),a++;}ed(e),A.success("操作成功",3e3,"km");}catch(s){const i=s;A.error(`操作失败: ${i.message}`,3e4,"km");}finally{ct(),g.clear();}return}try{if(await Mr(e),g.isSelected){const c=n.node.textContent||"";if(!g.selectedText||!c.includes(g.selectedText))return;for(const l of Le(n,"paragraph")||[]){const u=l.node.textContent||l.dom.innerText?.trim()||"";await Tt({pmNode:l,content:u},e);}return}const r=t.children,o=r.length;let a=0;it();const s=g.cellIndex+g.offset,i=kr(s);for(let c=r.length-1;c>=0;c--){const l=r[c],u=i({targetCol:s,rowIdx:c}),d=l.children[u];if(lt(100*a/o,` (${a}/${o})`),!d)continue;const f=(Le(d,"paragraph")||[]).reverse().map(p=>d.node?.type.name==="table_header"?Promise.resolve():new Promise(m=>{const w=p.node.textContent||p.dom.innerText?.trim()||"",v={pmNode:p,content:w};requestAnimationFrame(async()=>{await Tt(v,e),m();});}));await Promise.all(f),a++;}A.success("操作成功",3e3,"km");}catch(r){const o=r;A.error(`操作失败: ${o.message}`,3e4,"km");}finally{ct(),g.clear();}}async function nd(e){if(!g.el)return;await Mr(e);const t=g.el.tagName.toLowerCase()==="td"?g.el:g.el.parentNode,n=t.cellIndex,r=t.parentNode.parentNode;if(!r){g.clear();return}if(Or(e)){const a={content:t.innerText?.trim()||""};await ys(a,e),g.clear();return}try{it();const o=[],a=r.getElementsByTagName("tr")||[];if(g.isSelected){const c=t.innerText?.trim()||"";if(!g.selectedText||!c.includes(g.selectedText))return;for(const l of Array.from(t?.getElementsByTagName("p")||[])){const u=l.innerText||"";await Tt({node:l,content:u},e);}return}const s=a.length;let i=0;for(const c of Array.from(a)){const l=_r(c.children,n,o);lt(100*i/s,` (${i}/${s})`);const u=Array.from(l?.getElementsByTagName("p")||[]).map(d=>l?.tagName.toLowerCase()==="th"?Promise.resolve():new Promise(f=>{requestAnimationFrame(async()=>{const p=d.innerText||"";await Tt({node:d,content:p},e),f();});}));await Promise.all(u),i++;}A.success("操作成功",3e3,"km");}catch(o){const a=o;A.error(`操作失败: ${a.message}`,3e4,"km");}finally{ct(),g.clear();}}async function rd(e){if(!(!R.menuContainer||!R.dataView))try{if(Or(e)){A.error("暂不支持该类型操作",5e3,"km");return}if(bs(e)){A.error("暂不支持该类型操作",5e3,"km");return}const{colId:t}=R.activeCellInfo;await Mr(e);const n=R.dataView.getRowIds(),r=n.length;let o=0;it();for(const a of n){const s=R.dataView.getCellValue(a,t);if(!s)continue;const i=s?.[0]?.value||s?.[0]||s;await new Promise(c=>{const l={rId:a,cId:R.opColId,data:s};requestAnimationFrame(async()=>{await Tt({content:i,xtable:l},e),c();});}),lt(100*o/r,` (${o}/${r})`),o++;}A.success("操作成功",3e3,"km");}catch(t){const n=t;A.error(`操作失败: ${n.message}`,3e4,"km");}finally{ct(),R.clear(),g.clear();}}const od="https://mws.sankuai.com";function ad(){const e=new URL(`${od}/portal/webapi/user/getUserInfo`);return _(e).then(({ret:t})=>{const n=t?.mis?.account,r=t?.mis?.ssoId,o=t?.username;return {mis:n,name:o,uid:r}}).catch(()=>null)}async function sd(){let e=localStorage.getItem("userId")||null;if(e||(e=(await ad())?.mis||null),!e)return null;const t=await _e(e);if(!t)return null;const n={mis:t.mis,name:t.name,org:t.orgNamePath||"无部门"};return ws.setValue(n),n}const ws={__key__:"__user_info__",async getValue(){const e=xe(this.__key__);return e||sd()},setValue(e){e&&Se(this.__key__,e);}},ze={km:"c_op_enh_km",mws:"c_op_enh_mws",yuntu:"c_op_enh_yuntu",radar:"c_op_enh_mws_radar",avatar:"c_op_enh_mws_avatar",oceanus:"c_op_enh_mws_oceanus"};function id(){return X.LXAnalytics?X.LXAnalytics:function(t,n){return function(){return function(){}}}}class We{constructor(t){D(this,"commonValLab",{});D(this,"hasInit",false);D(this,"cid");this.cid=t,this.trickerValLabInit();}get options(){return {cid:this.cid,category:"op"}}get trackerBuilder(){return id()("getTracker","op")}get tracker(){return this.trackerBuilder("pageView",this.commonValLab,{},this.options)}async trickerValLabInit(){if(this.hasInit)return;const t=await ws.getValue(),n=String(t?.org||"unknown"),r=t?.mis?`${t?.name}/${t?.mis}`:"unknown",o=n.replace("美团/","").replace("核心本地商业/",""),a=o!==n?o:n,s="2025.12.03.1139";this.commonValLab={traceid:s,type:r,org:a,app_version:"2025.12.03.1139",status:"2025.12.03.1139"},this.hasInit=true;}async moduleView(t,n={}){await this.trickerValLabInit(),this.tracker?.("moduleView",t,{...this.commonValLab,...n||{}},this.options);}async moduleClick(t,n={}){await this.trickerValLabInit(),this.tracker?.("moduleClick",t,{...this.commonValLab,...n||{}},this.options);}}const M={km:new We(ze.km),mws:new We(ze.mws),yuntu:new We(ze.yuntu),radar:new We(ze.radar),avatar:new We(ze.avatar),oceanus:new We(ze.oceanus)},cd=["add-host-cnt","add-host-idc-cnt","add-host-region-cnt","add-host-idc-detail","add-host-region-detail","add-rank","add-unit","add-util","add-owner","add-stateful","add-org-path","add-capacity","add-capacity-desc","add-capacity-tip","add-specification","add-banner-status","add-banner-plus","add-banner-tracking","add-rpc-group","add-rhino-on","add-rhino-debug","add-rhino-type"],ld=["add-org-path-domain","add-owner-domain"],ud=["query-hulk-parent","query-host-rack","query-host-sn","query-appkey","query-appkey-mlp","query-org-appkey-list","query-parent-host-list","query-rack-host-list","query-switch-host-list","query-activity-resource-list"],dd=["remove-mention","mention-user"],fd=["remove-task-node","add-task-node"],pd=["remove-link","link-","extract-link-url"];function md(e){return cd.includes(e)?(M.km.moduleClick("b_op_km_appkey_mc"),true):false}function hd(e){return ld.includes(e)?(M.km.moduleClick("b_op_domain_mc"),true):false}function gd(e){return pd.includes(e)||e.startsWith("link-")?(e.startsWith("link-custom")?M.km.moduleClick("b_op_link_custom_mc"):M.km.moduleClick("b_op_link_mc"),true):false}function yd(e){return dd.includes(e)?(M.km.moduleClick("b_op_at_mc"),true):false}function bd(e){return fd.includes(e)?(M.km.moduleClick("b_op_task_mc"),true):false}function wd(e){return ud.includes(e)?(M.km.moduleClick("b_op_query_mc"),true):false}function vd(e){return hd(e)||md(e)||gd(e)||yd(e)||bd(e)||wd(e)||true}function h(e){return ()=>{if(vd(e),g.version===1)return nd(e);if(g.version===2)return td(e);if(R.menuContainer&&R.dataView)return rd(e)}}function vs(e){return ()=>{{M.km.moduleClick("b_op_link_mc"),pn.setShowSetting(true),He().showModal();return}}}function kd(){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 1024 1024"),t.setAttribute("version","1.1"),t.setAttribute("xmlns",e),t.setAttribute("p-id","1632"),t.setAttribute("width","16"),t.setAttribute("height","16");const n=document.createElementNS(e,"path");return n.setAttribute("d","M439.264 208a16 16 0 0 0-16 16v67.968a239.744 239.744 0 0 0-46.496 26.896l-58.912-34a16 16 0 0 0-21.856 5.856l-80 138.56a16 16 0 0 0 5.856 21.856l58.896 34a242.624 242.624 0 0 0 0 53.728l-58.88 34a16 16 0 0 0-6.72 20.176l0.848 1.68 80 138.56a16 16 0 0 0 21.856 5.856l58.912-34a239.744 239.744 0 0 0 46.496 26.88V800a16 16 0 0 0 16 16h160a16 16 0 0 0 16-16v-67.968a239.744 239.744 0 0 0 46.512-26.896l58.912 34a16 16 0 0 0 21.856-5.856l80-138.56a16 16 0 0 0-4.288-20.832l-1.568-1.024-58.896-34a242.624 242.624 0 0 0 0-53.728l58.88-34a16 16 0 0 0 6.72-20.176l-0.848-1.68-80-138.56a16 16 0 0 0-21.856-5.856l-58.912 34a239.744 239.744 0 0 0-46.496-26.88V224a16 16 0 0 0-16-16h-160z m32 48h96v67.376l28.8 12.576c13.152 5.76 25.632 12.976 37.184 21.52l25.28 18.688 58.448-33.728 48 83.136-58.368 33.68 3.472 31.2a194.624 194.624 0 0 1 0 43.104l-3.472 31.2 58.368 33.68-48 83.136-58.432-33.728-25.296 18.688c-11.552 8.544-24.032 15.76-37.184 21.52l-28.8 12.576V768h-96v-67.376l-28.784-12.576c-13.152-5.76-25.632-12.976-37.184-21.52l-25.28-18.688-58.448 33.728-48-83.136 58.368-33.68-3.472-31.2a194.624 194.624 0 0 1 0-43.104l3.472-31.2-58.368-33.68 48-83.136 58.432 33.728 25.296-18.688a191.744 191.744 0 0 1 37.184-21.52l28.8-12.576V256z m47.28 144a112 112 0 1 0 0 224 112 112 0 0 0 0-224z m0 48a64 64 0 1 1 0 128 64 64 0 0 1 0-128z"),n.setAttribute("fill","#5A626A"),t.appendChild(n),t}function ks(e){return ()=>(M.km.moduleClick("b_op_dx_group_mc"),g.version===1?A.error("仅支持学城2.0文档! ",8e3,"km"):Ai()?_d():A.warning("该页面无 @ 提醒内容, 如有 mis 号可批量转化保存后试!",8e3,"km"))}function _d(){const e=Ti();if(!e)return A.error("学城文档ID获取失败!",8e3,"km");const t=`https://sre.sankuai.com/#/tool/magic?tab=kmToolUserFilter&id=${e}`;window.open(t,"_blank"),g.clear();}const Cd=[{key:"km_sub_appkey_fill",desc:"服务信息填充",val:true,label:"服务右侧填充 ➜ 部门",callback:h("add-org-path"),subMenus:[{label:"服务Owner",callback:h("add-owner")},{label:"上周利用率",callback:h("add-util")},{label:"容灾等级",callback:h("add-capacity")},{label:"容灾不达标描述",callback:h("add-capacity-desc")},{label:"容灾治理建议",callback:h("add-capacity-tip")},{label:"服务等级",callback:h("add-rank")},{label:"服务状态",callback:h("add-stateful")},{label:"OCTO路由策略",callback:h("add-rpc-group")},{label:"Rhino限流状态",callback:h("add-rhino-on")},{label:"Rhino限流Debug",callback:h("add-rhino-debug")},{label:"Rhino限流类型",callback:h("add-rhino-type")},{label:"服务结算单元",callback:h("add-unit")},{label:"服务推荐配置",callback:h("add-specification")},{label:"线上部署机器数",callback:h("add-host-cnt")},{label:"线上部署机房数",callback:h("add-host-idc-cnt")},{label:"线上机Region数",callback:h("add-host-region-cnt")},{label:"部署机房详情",callback:h("add-host-idc-detail")},{label:"部署地域详情",callback:h("add-host-region-detail")},{label:"是否接入弹性",callback:h("add-banner-status")},{label:"Plus发布期间弹性",callback:h("add-banner-plus")},{label:"弹性目标追踪策略",callback:h("add-banner-tracking")},{label:"人员所属部门",callback:h("mention-get-org")},{label:"是否为MLP服务",callback:h("query-appkey-mlp")}]},{key:"km_sub_domain_fill",desc:"域名信息填充",val:true,label:"域名右侧填充 ➜ 部门",callback:h("add-org-path-domain"),subMenus:[{label:"域名Owner",callback:h("add-owner-domain")},{label:"域名解析",callback:h("add-domain-dns")}]},{key:"km_sub_at",desc:"学城批量转换内容功能",val:true,label:"转换内容 ➜ 批量@",callback:h("mention-user"),subMenus:[{label:"删除@",callback:h("remove-mention")},{label:"☑️ 添加任务",callback:h("add-task-node")},{label:"🔲 移除任务",callback:h("remove-task-node")},{label:"🥢 提取人员&拉群",callback:ks()}]},{key:"km_sub_link_avatar",desc:"学城批量转换链接功能",val:true,label:"转换链接 ➜ Avatar",callback:h("link-avatar"),subMenus:[{label:"删除链接",callback:h("remove-link")},{label:"提取链接URL",callback:h("extract-link-url")},{label:"+Octo链接",callback:h("link-octo")},{label:"+弹性链接",callback:h("link-as")},{label:"自定义设置",isSetting:true,callback:vs()}]},{key:"km_sub_query",desc:"学城批量查询功能",val:true,label:"全部功能菜单",callback:h("query-menu"),subMenus:[{label:"查询 Appkey",callback:h("query-appkey")},{label:"部门后端服务列表",callback:h("query-org-appkey-list")},{label:"部门高峰期配置",callback:h("query-org-busyperiod")},{label:"宿主机容器列表",callback:h("query-parent-host-list")},{label:"交换机物理机列表",callback:h("query-switch-host-list")},{label:"机柜/机架位物理机列表",callback:h("query-rack-host-list")},{label:"容器对应宿主机",callback:h("query-hulk-parent")},{label:"物理机-机柜号",callback:h("query-host-rack")},{label:"物理机-SN号",callback:h("query-host-sn")},{label:"结算单元对应SRE",callback:h("add-unit-sre")},{label:"结算单元对应部门",callback:h("add-unit-org")}]}],xd=[{key:"mws_sub_close_announce",desc:"MWS自动关闭公告",val:true},{key:"mws_sub_close_tips",desc:"移除帮助提示",val:true},{key:"mws_sub_favicon",desc:"MWS子站点图标自适应",val:true}],Sd=[{key:"yuntu_sub_close_announce",desc:"云图自动关闭公告",val:true},{key:"yuntu_sub_close_navbar",desc:"自动关闭云图看板目录",val:true},{key:"yuntu_sub_edit_enh",desc:"云图编辑功能增强",val:true}],Q=(e="")=>`__MT_ENHANCEMENT_${e}__`,bt=()=>navigator.userAgent.toLowerCase().indexOf("mac")>-1,mn=[{key:"km_enhancement",desc:"学城增强",val:true},{key:"km_enhancement_menu",desc:"自定义学城增强功能",title:"勾选 = 打开该功能",tips:"表格右键菜单",subMenus:Cd},{key:"yuntu_enhancement",desc:"云图增强",val:true},{key:"yuntu_enhancement_menu",desc:"自定义云图增强功能",title:"勾选 = 打开该功能",tips:"云图功能",subMenus:Sd},{key:"mws_enhancement",desc:"MWS增强",val:true},{key:"mws_enhancement_menu",desc:"自定义MWS增强功能",title:"勾选 = 打开该功能",tips:"MWS子站点功能",subMenus:xd}];function $d(e,t){const n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function he(e){return xe(e,true)}function An(e){return mn.find(n=>n.key===e).subMenus.filter(n=>n.val)}function qr(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{return !!document.execCommand("copy")}catch{return  false}finally{document.body.removeChild(t);}}async function Ed(e,t){if(typeof In<"u")try{return In(e,"html"),!0}catch{try{return In(t,"text"),!0}catch{}}try{const n=document.createElement("div");n.innerHTML=e,n.style.position="fixed",n.style.left="-9999px",n.style.top="-9999px",n.style.opacity="0",document.body.appendChild(n);const r=document.createRange();r.selectNodeContents(n);const o=window.getSelection();o?.removeAllRanges(),o?.addRange(r);const a=document.execCommand("copy");if(document.body.removeChild(n),o?.removeAllRanges(),a)return !0}catch{}if(X?.navigator?.clipboard?.write)try{return await X.navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([t],{type:"text/plain"})})]),!0}catch{}return qr(t)}function _s(e){return function t(...n){return n.length>=e.length?e.apply(this,n):(...r)=>t.apply(this,n.concat(r))}}function Ad(e){return /[\u4E00-\u9FA5]+/g.test(e)}function Ft(){return Math.round(Math.random()*4294967295).toString(16)}function fe(){return `${Ft()}${Ft()}${Ft()}${Ft()}`}function Dn(e){return Number(e.replace(/[^\d]/g,""))}function ir(e=1,t=5){if(e>t)throw new Error("最小秒数不能大于最大秒数");return (Math.random()*(t-e)+e)*1e3}function Td(){const e=X.getSelection();return !!(e&&e.rangeCount>0&&!e.isCollapsed)}function Pd(){const e=X.getSelection();return e&&e.rangeCount>0?e.toString().trim():""}function ne(e,...t){return new Promise((n,r)=>{requestAnimationFrame(()=>{setTimeout(()=>{try{e.call(this,...t),n();}catch(o){console.error("Error executing function in nextTick:",o),r(o);}},0);});})}function Cs(e,t){console.info(`%c ${e}%c v${t} `,"padding: 2px 1px; border-radius: 3px 0 0 3px; color: #fff; background: #606060; font-weight: bold;","padding: 2px 1px; border-radius: 0 3px 3px 0; color: #fff; background: #0a7bbc; font-weight: bold;");}function xs(e,t){let n=null;return (...r)=>{n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,r);},t);}}function Id(e){const t=Array.isArray(e)?e:[e],n=()=>{t.forEach((r,o)=>{try{r();}catch(a){console.error(`执行函数 ${r.name||`#${o+1}`} 时发生错误:`,a);}});};document.readyState==="complete"?n():window.addEventListener("load",n);}const Wo={id:"id",name:"name",children:"children"};function Ss(e,t,n=Wo,r=[],o=[]){const{id:a,name:s,children:i}=n||Wo;for(const c of e){const l=[...r,c[a]],u=[...o,c[s]];if(String(c[a])===String(t))return c.path=l,c.names=u,c;if(c[i]?.length){const d=Ss(c[i],t,n,l,u);if(d)return d}}return null}let wt=null;function ye(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstElementChild}function ke(e){if(!wt){const n=Q("HEAD_CSS");let r=document.getElementById(n);r||(r=document.createElement("style"),r.id=n,document.head.appendChild(r)),wt=r.sheet;}if(!wt)return;e.split("}").map(n=>n.trim().replace(/;+$/,"")).filter(Boolean).map(n=>`${n}}`).forEach(n=>{try{wt.insertRule(n,wt.cssRules.length);}catch(r){console.error(`Failed to insert CSS rule=${n}, e=`,r);}});}function Hr(){try{return window.self!==window.top}catch{return  false}}function Nd(){}function Ld(e){const t=document.getElementById(e);t&&window.getComputedStyle(t).display!=="none"&&(ke(`dialog#${e}[open] { display: initial !important; }`),ke(`dialog#${e}:not([open]) { display: none !important; }`));}function Rd(e,t){const n=`chrome-extension-citadel__${e}`;if(document.getElementById(n))return;const r=document.createElement("style");r.id=n,r.innerHTML=t,document.head.appendChild(r);}function Md(e,t){const n=e.state.doc.resolve(t);let r=0,o=n.depth,a=null,s=null;for(;o>0;o--){const i=n.node(o);if(i.type.name==="table_header"){r=n.before(o),a=i;const c=e.domAtPos(r);s=c.node.childNodes[c.offset];break}}return {tableHeaderPos:r,tableHeaderDepth:o,tableHeaderNode:a,tableHeaderDOM:s,resolvedPos:n}}function Od(e,t){return e.clientX>t.right-12-4-1}function qd(e,t,n){const r=t-2,o=e.before(r),a=n.domAtPos(o),s=a.node.childNodes[a.offset],i=s.pmViewDesc.node;return {tableDOM:s,tableNode:i,tablePos:o,tableDepth:r}}function Hd(e){return e.child(1).child(0).attrs.numCell}function Dd(e){let t=false;return e.descendants(n=>(n.type.name==="table"||["table_header","table_cell"].includes(n.type.name)&&(n.attrs.colspan>1||n.attrs.rowspan>1)&&(t=true),false)),t}function Ud(e,t){return e.child(0).child(0)===t}function Bd(e,t){return e.clientY>(t.top+t.bottom)/2?-1:1}const Xo=/^(-|\+)?\d+(\.\d+)?$/m,Yo=/^(\d)+(\.(\d)+)?%$/m,Qo=/^(-|\+)?\d+(,\d{3})+(\.\d+)?$/m;function Fd(e,t){let n=e.textContent,r=t.textContent;if(n===""&&r==="")return 0;if(n==="")return 1;if(r==="")return  -1;if(Yo.test(n)&&(n=n.split("%")[0]),Yo.test(r)&&(r=r.split("%")[0]),Qo.test(n)&&(n=n.replace(/,/g,"")),Qo.test(r)&&(r=r.replace(/,/g,"")),Xo.test(n)&&Xo.test(r)){const o=+n,a=+r;if(o===a)return 0;if(o>a)return 1;if(o<a)return  -1}return n.localeCompare(r,"zh-Hans-CN")}function $s(e,t,n,r){return e.content.content.slice(1).some(function(s,i){return s!==r[i]})?(n.dispatch(n.state.tr.replaceWith(t+1+e.child(0).nodeSize,t+e.nodeSize-1,r)),true):false}function jd(e,t,n,r,o){const a=e.content.content.slice(1),i=e.child(0).content.content.indexOf(t);return a.sort(function(c,l){return Fd(c.child(i),l.child(i))*n}),$s(e,o,r,a)}function Vd(e,t,n){const r=e.content.content.slice(1);return r.reverse(),$s(e,n,t,r)}function Gd(e){Rd("sort-table",`.ProseMirror[contenteditable="true"] table:hover tr:first-child th { position:relative;} .ProseMirror[contenteditable="true"] table:hover tr:first-child th::before { content:'';width:12px;height:12px;position:absolute;right:4px;top:50%;transform:translateY(-50%);background-image:url("data:image/svg+xml,%3C%3Fxml version%3D%221.0%22 standalone%3D%22no%22%3F%3E%3C!DOCTYPE svg PUBLIC %22-%2F%2FW3C%2F%2FDTD SVG 1.1%2F%2FEN%22 %22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg t%3D%221526442144261%22 class%3D%22icon%22 style%3D%22%22 viewBox%3D%220 0 1024 1024%22 version%3D%221.1%22 xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 p-id%3D%223424%22 xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22 width%3D%2212%22 height%3D%2212%22%3E%3Cdefs%3E%3Cstyle type%3D%22text%2Fcss%22%3E%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cpath d%3D%22M228.437333 251.904L475.562667 15.36a51.2 51.2 0 0 1 72.874666 0l247.125334 236.544a52.906667 52.906667 0 0 1 11.178666 57.173333 51.626667 51.626667 0 0 1-47.616 32.256H264.874667a51.541333 51.541333 0 0 1-47.616-32.426666 52.906667 52.906667 0 0 1 11.178666-57.002667z m567.125334 520.192L548.437333 1008.64a51.2 51.2 0 0 1-72.874666 0L228.437333 772.096a52.906667 52.906667 0 0 1-11.178666-57.173333A51.626667 51.626667 0 0 1 264.874667 682.666667h494.250666c20.821333 0 39.594667 12.8 47.616 32.426666a52.906667 52.906667 0 0 1-11.178666 57.002667z%22 fill%3D%22%23B0B0B0%22 p-id%3D%223425%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E");background-position:50%;cursor:pointer;}`);const t=e.state.config.plugins[0].constructor,n=e.state.config.plugins[0].spec.key.constructor;return new t({key:new n("sort-table"),props:{handleClick(r,o,a){const{tableHeaderDepth:s,tableHeaderPos:i,tableHeaderNode:c,tableHeaderDOM:l,resolvedPos:u}=Md(r,o);if(i){const d=l.getBoundingClientRect();if(Od(a,d)){const{tableNode:f,tablePos:p}=qd(u,s,r);if(Dd(f))return  false;const m=Bd(a,d);if(Hd(f)&&Ud(f,c)){if(m===-1)return Vd(f,r,p)}else return jd(f,c,m,r,p)}}return  false}}})}let Un=false;function Kd(e,t){const{state:n}=e,{config:r}=n,{plugins:o,pluginsByKey:a,fields:s}=r,i=s[0].constructor;t.forEach(c=>{if(a[c.key])throw new RangeError("Adding different instances of a keyed plugin ("+c.key+")");if(o.push(c),a[c.key]=c,c.spec.state){const l=new i(c.key,c.spec.state,c);s.push(l),n[l.name]=l.init(r,n);}c.spec.view&&e.pluginViews.push(c.spec.view(e));});}const zd=["editorInst","__templateEditorInst__"];async function Wd(){if(Un)return;let e;for(;!e?.view?.docView;)if(await ie(1e3),!e&&(zd.find(n=>X[n]?(e=X[n],true):false),g.version===1||location.pathname.startsWith("/page/")))return;if(Un)return;Un=true;const{view:t}=e;Kd(t,[Gd(t)]),Cs("mt-work-enhancement","2025.12.03.1139");}function mt(e){const t=history.pushState,n=history.replaceState;history.pushState=function(r,o,a){e(r,o,a);const s=[r,o,a];return t.apply(history,s)},history.replaceState=function(r,o,a){e(r,o,a);const s=[r,o,a];return n.apply(history,s)};}function Es(){const e=gs();return e.length&&e.forEach(t=>{t.callback=h(`link-custom-${t.label}`),t.desc||(t.desc=`菜单所在列 应用自定义链接规则: ${t.label}`),t.extra={...t.extra||{},isCustom:true};}),e||[]}function Xd(e){const t=document.createElement("div");t.style.top="0",t.style.left="0",t.style.zIndex="1",t.style.minWidth="160px",t.style.position="fixed",t.style.backgroundColor="#ffffff",t.style.boxShadow="0px 8px 16px 0px rgba(0,0,0,0.2)";const n=[...e];if(e.find(r=>r.isSetting)){const r=Es();n.splice(-1,0,...r);}return n.forEach(r=>{const o=document.createElement("span");r.isSetting?(o.appendChild(kd()),o.appendChild(document.createTextNode(r.label))):o.textContent=r.label,o.style.padding="4px 8px",o.style.display="flex",o.style.fontSize="11px",o.style.alignItems="center",o.style.textDecoration="none",o.onmouseover=()=>o.style.backgroundColor="#f5f5f5",o.onmouseout=()=>o.style.backgroundColor="transparent",o.addEventListener("click",a=>{a.stopPropagation(),r.callback();},{once:true}),t.appendChild(o);}),t.style.display="none",t}function Yd(e,t){const n=Xd(t);let r=false,o=false;e.addEventListener("mouseover",function(){r=true,a(e,n);}),e.addEventListener("mouseout",function(){r=false,setTimeout(()=>s(n),500);}),n.addEventListener("mouseover",function(){o=true;}),n.addEventListener("mouseout",function(){o=false,setTimeout(()=>s(n),500);}),e.appendChild(n);function a(i,c){const l=i.getBoundingClientRect();c.style.top=`${l.top}px`,c.style.left=`${l.right+4}px`,c.style.display="block";}function s(i){!r&&!o&&(i.style.display="none");}setTimeout(()=>{document.querySelectorAll("li.ant-menu-item.ant-menu-item-only-child").forEach(i=>{i!==e&&i.addEventListener("mouseover",()=>{n.style.display="none";});});},10);}const Jo=Q("XTABLE-MENU");function As(e,t,n,r){let o;return e===1?(o=document.createElement("div"),o.setAttribute("class","ct-table-context-item"),o.textContent=t):(o=document.createElement("li"),o.setAttribute("class","ant-menu-item ant-menu-item-only-child"),o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.innerHTML=`<span class="ant-menu-title-content"><div class="oafe-drop-menu-item-wrapper item-wrapper-normal"><span class="sub-item-label"><div style="line-height:1;overflow:hidden;"><div style="font-size:12px;line-height:16px;">${t}</div></div></span></div></span>`),o.addEventListener("click",n,{once:true}),r&&r.length&&Yd(o,r),o}function Qd(){if(!g.menu)return;const e=_s(As)(g.version),t=An("km_enhancement_menu"),n=g.menu,r=document.createElement("div");r.setAttribute("class","ant-menu-item-divider"),[...t.map(o=>e(o.label,o.callback,o.subMenus)),r].map((o,a)=>{n.insertBefore(o,n.children[a]);});}function Jd(){if(!g.menu)return;const e=_s(As)(g.version),t=An("km_enhancement_menu"),n=document.createElement("li");n.setAttribute("class","ant-menu-item-divider");const r=g.menu.children[0].children[0];[...t.map(o=>e(o.label,o.callback,o.subMenus)),n].map((o,a)=>{r.insertBefore(o,r.children[a]);});}function Zd(){const e=R.menuContainer?.querySelector(".xtable-menu-list");if(!e||e?.querySelector(`.${Jo}`))return;const t=document.createElement("div");t.className=`item-divider ${Jo}`,e.insertBefore(t,e.children[0]);const n=document.createElement("div");n.className="xtable-menu-item",n.innerHTML='<div class="item-left"><i class="ct-icon iconfont ct-icon-mtdicons-setting"></i></div><div class="item-right">学城增强工具</div>',n.addEventListener("click",ef),e.insertBefore(n,e.children[0]);}function ef(){R.dataView&&(He().showModal(),R.hideMenu());}const tf=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],nf=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...tf]),rf=new Set(["innerHTML","textContent","innerText","children"]),of=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),af=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function sf(e,t){const n=af[e];return typeof n=="object"?n[t]?n.$:void 0:n}const cf=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),lf={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function uf(e,t,n){let r=n.length,o=t.length,a=r,s=0,i=0,c=t[o-1].nextSibling,l=null;for(;s<o||i<a;){if(t[s]===n[i]){s++,i++;continue}for(;t[o-1]===n[a-1];)o--,a--;if(o===s){const u=a<r?i?n[i-1].nextSibling:n[a-i]:c;for(;i<a;)e.insertBefore(n[i++],u);}else if(a===i)for(;s<o;)(!l||!l.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[a-1]&&n[i]===t[o-1]){const u=t[--o].nextSibling;e.insertBefore(n[i++],t[s++].nextSibling),e.insertBefore(n[--a],u),t[o]=n[a];}else {if(!l){l=new Map;let d=i;for(;d<a;)l.set(n[d],d++);}const u=l.get(t[s]);if(u!=null)if(i<u&&u<a){let d=s,f=1,p;for(;++d<o&&d<a&&!((p=l.get(t[d]))==null||p!==u+f);)f++;if(f>u-i){const m=t[s];for(;i<u;)e.insertBefore(n[i++],m);}else e.replaceChild(n[i++],t[s++]);}else s++;else t[s++].remove();}}}const Zo="_$DX_DELEGATE";function Dr(e,t,n,r={}){let o;return Ct(a=>{o=a,t===document?e():E(t,e(),t.firstChild?null:void 0,n);},r.owner),()=>{o(),t.textContent="";}}function N(e,t,n){let r;const o=()=>{const s=document.createElement("template");return s.innerHTML=e,n?s.content.firstChild.firstChild:s.content.firstChild},a=t?()=>ce(()=>document.importNode(r||(r=o()),!0)):()=>(r||(r=o())).cloneNode(true);return a.cloneNode=a,a}function Ve(e,t=window.document){const n=t[Zo]||(t[Zo]=new Set);for(let r=0,o=e.length;r<o;r++){const a=e[r];n.has(a)||(n.add(a),t.addEventListener(a,gf));}}function re(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n);}function df(e,t,n,r){r==null?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r);}function Oe(e,t){t==null?e.removeAttribute("class"):e.className=t;}function ff(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const o=n[0];e.addEventListener(t,n[0]=a=>o.call(e,n[1],a));}else e.addEventListener(t,n);}function pf(e,t,n={}){const r=Object.keys(t||{}),o=Object.keys(n);let a,s;for(a=0,s=o.length;a<s;a++){const i=o[a];!i||i==="undefined"||t[i]||(ea(e,i,false),delete n[i]);}for(a=0,s=r.length;a<s;a++){const i=r[a],c=!!t[i];!i||i==="undefined"||n[i]===c||!c||(ea(e,i,true),n[i]=c);}return n}function we(e,t,n){if(!t)return n?re(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let o,a;for(a in n)t[a]==null&&r.removeProperty(a),delete n[a];for(a in t)o=t[a],o!==n[a]&&(r.setProperty(a,o),n[a]=o);return n}function be(e,t={},n,r){const o={};return r||q(()=>o.children=Pt(e,t.children,o.children)),q(()=>typeof t.ref=="function"?Tn(t.ref,e):t.ref=e),q(()=>mf(e,t,n,true,o,true)),o}function Tn(e,t,n){return ce(()=>e(t,n))}function E(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Pt(e,t,r,n);q(o=>Pt(e,t(),o,n),r);}function mf(e,t,n,r,o={},a=false){t||(t={});for(const s in o)if(!(s in t)){if(s==="children")continue;o[s]=ta(e,s,null,o[s],n,a);}for(const s in t){if(s==="children")continue;const i=t[s];o[s]=ta(e,s,i,o[s],n,a);}}function hf(e){return e.toLowerCase().replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}function ea(e,t,n){const r=t.trim().split(/\s+/);for(let o=0,a=r.length;o<a;o++)e.classList.toggle(r[o],n);}function ta(e,t,n,r,o,a){let s,i,c,l,u;if(t==="style")return we(e,n,r);if(t==="classList")return pf(e,n,r);if(n===r)return r;if(t==="ref")a||n(e);else if(t.slice(0,3)==="on:"){const d=t.slice(3);r&&e.removeEventListener(d,r),n&&e.addEventListener(d,n);}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);r&&e.removeEventListener(d,r,true),n&&e.addEventListener(d,n,true);}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),f=cf.has(d);if(!f&&r){const p=Array.isArray(r)?r[0]:r;e.removeEventListener(d,p);}(f||n)&&(ff(e,d,n,f),f&&Ve([d]));}else if(t.slice(0,5)==="attr:")re(e,t.slice(5),n);else if((u=t.slice(0,5)==="prop:")||(c=rf.has(t))||!o&&((l=sf(t,e.tagName))||(i=nf.has(t)))||(s=e.nodeName.includes("-")))u&&(t=t.slice(5),i=true),t==="class"||t==="className"?Oe(e,n):s&&!i&&!c?e[hf(t)]=n:e[l||t]=n;else {const d=o&&t.indexOf(":")>-1&&lf[t.split(":")[0]];d?df(e,d,t,n):re(e,of[t]||t,n);}return n}function gf(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:true,value:n}),Object.defineProperty(e,"currentTarget",{configurable:true,get(){return n||document}});n;){const r=n[t];if(r&&!n.disabled){const o=n[`${t}Data`];if(o!==void 0?r.call(n,o,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host;}}function Pt(e,t,n,r,o){for(;typeof n=="function";)n=n();if(t===n)return n;const a=typeof t,s=r!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,a==="string"||a==="number")if(a==="number"&&(t=t.toString()),s){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=Xe(e,n,r,i);}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t;else if(t==null||a==="boolean")n=Xe(e,n,r);else {if(a==="function")return q(()=>{let i=t();for(;typeof i=="function";)i=i();n=Pt(e,i,n,r);}),()=>n;if(Array.isArray(t)){const i=[],c=n&&Array.isArray(n);if(cr(i,t,n,o))return q(()=>n=Pt(e,i,n,r,true)),()=>n;if(i.length===0){if(n=Xe(e,n,r),s)return n}else c?n.length===0?na(e,i,r):uf(e,n,i):(n&&Xe(e),na(e,i));n=i;}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=Xe(e,n,r,t);Xe(e,n,null,t);}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t;}}return n}function cr(e,t,n,r){let o=false;for(let a=0,s=t.length;a<s;a++){let i=t[a],c=n&&n[e.length],l;if(!(i==null||i===true||i===false))if((l=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))o=cr(e,i,c)||o;else if(l==="function")if(r){for(;typeof i=="function";)i=i();o=cr(e,Array.isArray(i)?i:[i],Array.isArray(c)?c:[c])||o;}else e.push(i),o=true;else {const u=String(i);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u));}}return o}function na(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n);}function Xe(e,t,n,r){if(n===void 0)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let a=false;for(let s=t.length-1;s>=0;s--){const i=t[s];if(o!==i){const c=i.parentNode===e;!a&&!s?c?e.replaceChild(o,i):e.insertBefore(o,n):c&&i.remove();}else a=true;}}else e.insertBefore(o,n);return [o]}const yf=e=>typeof e=="function",hn=(e,t)=>yf(e)?e(t):e;var F;(function(e){e[e.ADD_TOAST=0]="ADD_TOAST",e[e.UPDATE_TOAST=1]="UPDATE_TOAST",e[e.UPSERT_TOAST=2]="UPSERT_TOAST",e[e.DISMISS_TOAST=3]="DISMISS_TOAST",e[e.REMOVE_TOAST=4]="REMOVE_TOAST",e[e.START_PAUSE=5]="START_PAUSE",e[e.END_PAUSE=6]="END_PAUSE";})(F||(F={}));const gn=Symbol("store-raw"),at=Symbol("store-node"),ve=Symbol("store-has"),Ts=Symbol("store-self");function Ps(e){let t=e[ge];if(!t&&(Object.defineProperty(e,ge,{value:t=new Proxy(e,vf)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,a=n.length;o<a;o++){const s=n[o];r[s].get&&Object.defineProperty(e,s,{enumerable:r[s].enumerable,get:r[s].get.bind(t)});}}return t}function ut(e){let t;return e!=null&&typeof e=="object"&&(e[ge]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function dt(e,t=new Set){let n,r,o,a;if(n=e!=null&&e[gn])return n;if(!ut(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,i=e.length;s<i;s++)o=e[s],(r=dt(o,t))!==o&&(e[s]=r);}else {Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let c=0,l=s.length;c<l;c++)a=s[c],!i[a].get&&(o=e[a],(r=dt(o,t))!==o&&(e[a]=r));}return e}function yn(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function It(e,t,n){if(e[t])return e[t];const[r,o]=te(n,{equals:false,internal:true});return r.$=o,e[t]=r}function bf(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return !n||n.get||!n.configurable||t===ge||t===at||(delete n.value,delete n.writable,n.get=()=>e[ge][t]),n}function Is(e){or()&&It(yn(e,at),Ts)();}function wf(e){return Is(e),Reflect.ownKeys(e)}const vf={get(e,t,n){if(t===gn)return e;if(t===ge)return n;if(t===rr)return Is(e),n;const r=yn(e,at),o=r[t];let a=o?o():e[t];if(t===at||t===ve||t==="__proto__")return a;if(!o){const s=Object.getOwnPropertyDescriptor(e,t);or()&&(typeof a!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(a=It(r,t,a)());}return ut(a)?Ps(a):a},has(e,t){return t===gn||t===ge||t===rr||t===at||t===ve||t==="__proto__"?true:(or()&&It(yn(e,ve),t)(),t in e)},set(){return  true},deleteProperty(){return  true},ownKeys:wf,getOwnPropertyDescriptor:bf};function ft(e,t,n,r=false){if(!r&&e[t]===n)return;const o=e[t],a=e.length;n===void 0?(delete e[t],e[ve]&&e[ve][t]&&o!==void 0&&e[ve][t].$()):(e[t]=n,e[ve]&&e[ve][t]&&o===void 0&&e[ve][t].$());let s=yn(e,at),i;if((i=It(s,t,o))&&i.$(()=>n),Array.isArray(e)&&e.length!==a){for(let c=e.length;c<a;c++)(i=s[c])&&i.$();(i=It(s,"length",a))&&i.$(e.length);}(i=s[Ts])&&i.$();}function Ns(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];ft(e,o,t[o]);}}function kf(e,t){if(typeof t=="function"&&(t=t(e)),t=dt(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const o=t[n];e[n]!==o&&ft(e,n,o);}ft(e,"length",r);}else Ns(e,t);}function kt(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const s=typeof r,i=Array.isArray(e);if(Array.isArray(r)){for(let c=0;c<r.length;c++)kt(e,[r[c]].concat(t),n);return}else if(i&&s==="function"){for(let c=0;c<e.length;c++)r(e[c],c)&&kt(e,[c].concat(t),n);return}else if(i&&s==="object"){const{from:c=0,to:l=e.length-1,by:u=1}=r;for(let d=c;d<=l;d+=u)kt(e,[d].concat(t),n);return}else if(t.length>1){kt(e[r],t,[r].concat(n));return}o=e[r],n=[r].concat(n);}let a=t[0];typeof a=="function"&&(a=a(o,n),a===o)||r===void 0&&a==null||(a=dt(a),r===void 0||ut(o)&&ut(a)&&!Array.isArray(a)?Ns(o,a):ft(e,r,a));}function Ls(...[e,t]){const n=dt(e||{}),r=Array.isArray(n),o=Ps(n);function a(...s){Ul(()=>{r&&s.length===1?kf(n,s[0]):kt(n,s);});}return [o,a]}const bn=new WeakMap,Rs={get(e,t){if(t===gn)return e;const n=e[t];let r;return ut(n)?bn.get(n)||(bn.set(n,r=new Proxy(n,Rs)),r):n},set(e,t,n){return ft(e,t,dt(n)),true},deleteProperty(e,t){return ft(e,t,void 0,true),true}};function jt(e){return t=>{if(ut(t)){let n;(n=bn.get(t))||bn.set(t,n=new Proxy(t,Rs)),e(n);}return t}}const[Be,Ae]=Ls({toasts:[],pausedAt:void 0}),_f=()=>{const{pausedAt:e,toasts:t}=Be;if(e)return;const n=Date.now();return t.map(o=>{if(o.duration===1/0)return;const a=(o.duration||0)+o.pauseDuration-(n-o.createdAt);if(a<=0){o.visible&&pe({type:F.DISMISS_TOAST,toastId:o.id});return}return setTimeout(()=>{pe({type:F.DISMISS_TOAST,toastId:o.id});},a)})},xt=new Map,ra=(e,t)=>{if(xt.has(e))return;const n=setTimeout(()=>{xt.delete(e),pe({type:F.REMOVE_TOAST,toastId:e});},t);xt.set(e,n);},Cf=e=>{const t=xt.get(e);xt.delete(e),t&&clearTimeout(t);},pe=e=>{switch(e.type){case F.ADD_TOAST:Ae("toasts",o=>{const a=o;return [e.toast,...a]});break;case F.DISMISS_TOAST:const{toastId:t}=e,n=Be.toasts;if(t){const o=n.find(a=>a.id===t);o&&ra(t,o.unmountDelay),Ae("toasts",a=>a.id===t,jt(a=>a.visible=false));}else n.forEach(o=>{ra(o.id,o.unmountDelay);}),Ae("toasts",o=>o.id!==void 0,jt(o=>o.visible=false));break;case F.REMOVE_TOAST:if(!e.toastId){Ae("toasts",[]);break}Ae("toasts",o=>o.filter(s=>s.id!==e.toastId));break;case F.UPDATE_TOAST:e.toast.id&&Cf(e.toast.id),Ae("toasts",o=>o.id===e.toast.id,o=>({...o,...e.toast}));break;case F.UPSERT_TOAST:Be.toasts.find(o=>o.id===e.toast.id)?pe({type:F.UPDATE_TOAST,toast:e.toast}):pe({type:F.ADD_TOAST,toast:e.toast});break;case F.START_PAUSE:Ae(jt(o=>{o.pausedAt=Date.now(),o.toasts.forEach(a=>{a.paused=true;});}));break;case F.END_PAUSE:const r=e.time-(Be.pausedAt||0);Ae(jt(o=>{o.pausedAt=void 0,o.toasts.forEach(a=>{a.pauseDuration+=r,a.paused=false;});}));break}},xf={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},st={id:"",icon:"",unmountDelay:500,duration:3e3,ariaProps:{role:"status","aria-live":"polite"},className:"",style:{},position:"top-right",iconTheme:{}},Ms={position:"top-right",toastOptions:st,gutter:8,containerStyle:{},containerClassName:""},Vt="16px",Sf={position:"fixed","z-index":9999,top:Vt,bottom:Vt,left:Vt,right:Vt,"pointer-events":"none"},$f=(()=>{let e=0;return ()=>String(++e)})(),Ef=e=>{Rf(t=>({containerClassName:e.containerClassName??t.containerClassName,containerStyle:e.containerStyle??t.containerStyle,gutter:e.gutter??t.gutter,position:e.position??t.position,toastOptions:{...e.toastOptions}}));},Af=(e,t)=>{const r=e.includes("top")?{top:0,"margin-top":`${t}px`}:{bottom:0,"margin-bottom":`${t}px`},o=e.includes("center")?{"justify-content":"center"}:e.includes("right")?{"justify-content":"flex-end"}:{};return {left:0,right:0,display:"flex",position:"absolute",transition:"all 230ms cubic-bezier(.21,1.02,.73,1)",...r,...o}},Tf=(e,t)=>{const n=e.getBoundingClientRect();n.height!==t.height&&pe({type:F.UPDATE_TOAST,toast:{id:t.id,height:n.height}});},Pf=(e,t)=>{const{toasts:n}=Be,r=tt().gutter||Ms.gutter||8,o=n.filter(c=>(c.position||t)===t&&c.height),a=o.findIndex(c=>c.id===e.id),s=o.filter((c,l)=>l<a&&c.visible).length;return o.slice(0,s).reduce((c,l)=>c+r+(l.height||0),0)},If=(e,t)=>(e.position||t).includes("top")?1:-1,Nf={display:"flex","align-items":"center",color:"#363636",background:"white","box-shadow":"0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05)","max-width":"350px","pointer-events":"auto",padding:"8px 10px","border-radius":"4px","line-height":"1.3","will-change":"transform"},Lf={display:"flex","align-items":"center",flex:"1 1 auto",margin:"4px 10px","white-space":"pre-line"},Gt={"flex-shrink":0,"min-width":"20px","min-height":"20px",display:"flex","align-items":"center","justify-content":"center","text-align":"center"},wn=e=>({calcMode:"spline",keyTimes:"0; 1",keySplines:e}),[tt,Rf]=te(Ms),Mf=(e,t="blank",n)=>({...st,...tt().toastOptions,...n,type:t,message:e,pauseDuration:0,createdAt:Date.now(),visible:true,id:n.id||$f(),paused:false,style:{...st.style,...tt().toastOptions?.style,...n.style},duration:n.duration||tt().toastOptions?.duration||xf[t],position:n.position||tt().toastOptions?.position||tt().position||st.position}),qt=e=>(t,n={})=>Ct(()=>{const r=Be.toasts.find(a=>a.id===n.id),o=Mf(t,e,{...r,duration:void 0,...n});return pe({type:F.UPSERT_TOAST,toast:o}),o.id}),ue=(e,t)=>qt("blank")(e,t);ce(()=>ue);ue.error=qt("error");ue.success=qt("success");ue.loading=qt("loading");ue.custom=qt("custom");ue.dismiss=e=>{pe({type:F.DISMISS_TOAST,toastId:e});};ue.promise=(e,t,n)=>{const r=ue.loading(t.loading,{...n});return e.then(o=>(ue.success(hn(t.success,o),{id:r,...n}),o)).catch(o=>{ue.error(hn(t.error,o),{id:r,...n});}),e};ue.remove=e=>{pe({type:F.REMOVE_TOAST,toastId:e});};var Of=N("<div><style>.sldt-active{z-index:9999;}.sldt-active>*{pointer-events:auto;}");const qf=e=>(ln(()=>{Ef(e);}),ln(()=>{const t=_f();Ar(()=>{t&&t.forEach(n=>n&&clearTimeout(n));});}),(()=>{var t=Of();return t.firstChild,E(t,P(Re,{get each(){return Be.toasts},children:n=>P(Bf,{toast:n})}),null),q(n=>{var r={...Sf,...e.containerStyle},o=e.containerClassName;return n.e=we(t,r,n.e),o!==n.t&&Oe(t,n.t=o),n},{e:void 0,t:void 0}),t})());var Kt=N("<div>"),Hf=N("<div><div>");const Df=e=>{let t;return ln(()=>{if(!t)return;const n=If(e.toast,e.position);e.toast.visible?t.animate([{transform:`translate3d(0,${n*-200}%,0) scale(.6)`,opacity:.5},{transform:"translate3d(0,0,0) scale(1)",opacity:1}],{duration:350,fill:"forwards",easing:"cubic-bezier(.21,1.02,.73,1)"}):t.animate([{transform:"translate3d(0,0,-1px) scale(1)",opacity:1},{transform:`translate3d(0,${n*-150}%,-1px) scale(.4)`,opacity:0}],{duration:400,fill:"forwards",easing:"cubic-bezier(.06,.71,.55,1)"});}),(()=>{var n=Hf(),r=n.firstChild,o=t;return typeof o=="function"?Tn(o,n):t=n,E(n,P(Yl,{get children(){return [P(Bt,{get when(){return e.toast.icon},get children(){var a=Kt();return E(a,()=>e.toast.icon),q(s=>we(a,Gt,s)),a}}),P(Bt,{get when(){return e.toast.type==="loading"},get children(){var a=Kt();return E(a,P(Xf,Ne(()=>e.toast.iconTheme))),q(s=>we(a,Gt,s)),a}}),P(Bt,{get when(){return e.toast.type==="success"},get children(){var a=Kt();return E(a,P(Gf,Ne(()=>e.toast.iconTheme))),q(s=>we(a,Gt,s)),a}}),P(Bt,{get when(){return e.toast.type==="error"},get children(){var a=Kt();return E(a,P(zf,Ne(()=>e.toast.iconTheme))),q(s=>we(a,Gt,s)),a}})]}}),r),be(r,Ne(()=>e.toast.ariaProps),false,true),E(r,()=>hn(e.toast.message,e.toast)),q(a=>{var s=e.toast.className,i={...Nf,...e.toast.style},c=Lf;return s!==a.e&&Oe(n,a.e=s),a.t=we(n,i,a.t),a.a=we(r,c,a.a),a},{e:void 0,t:void 0,a:void 0}),n})()};var Uf=N("<div>");const Bf=e=>{const t=()=>{const o=e.toast.position||st.position,a=Pf(e.toast,o);return Af(o,a)},n=Y(()=>t());let r;return ls(()=>{r&&Tf(r,e.toast);}),(()=>{var o=Uf();o.addEventListener("mouseleave",()=>pe({type:F.END_PAUSE,time:Date.now()})),o.addEventListener("mouseenter",()=>pe({type:F.START_PAUSE,time:Date.now()}));var a=r;return typeof a=="function"?Tn(a,o):r=o,E(o,(()=>{var s=Y(()=>e.toast.type==="custom");return ()=>s()?hn(e.toast.message,e.toast):P(Df,{get toast(){return e.toast},get position(){return e.toast.position||st.position}})})()),q(s=>{var i=n(),c=e.toast.visible?"sldt-active":"";return s.e=we(o,i,s.e),c!==s.t&&Oe(o,s.t=c),s},{e:void 0,t:void 0}),o})()};var Ff=N('<svg><circle cx=16 cy=16 r=0><animate attributeName=opacity values="0; 1; 1"></animate><animate attributeName=r values="0; 17.5; 16"></svg>',false,true),jf=N('<svg><circle cx=16 cy=16 r=12 opacity=0><animate attributeName=opacity values="1; 0"></animate><animate attributeName=r values="12; 26"></svg>',false,true);const Os=e=>{const t={dur:"0.35s",begin:"100ms",fill:"freeze",calcMode:"spline",keyTimes:"0; 0.6; 1",keySplines:"0.25 0.71 0.4 0.88; .59 .22 .87 .63"};return (()=>{var n=Ff(),r=n.firstChild,o=r.nextSibling;return be(r,t,true,false),be(o,t,true,false),q(()=>re(n,"fill",e.fill)),n})()},qs=e=>{const t={dur:"1s",begin:e.begin||"320ms",fill:"freeze",...wn("0.0 0.0 0.2 1")};return (()=>{var n=jf(),r=n.firstChild,o=r.nextSibling;return be(r,t,true,false),be(o,t,true,false),q(()=>re(n,"fill",e.fill)),n})()};var Vf=N('<svg viewBox="0 0 32 32"width=1.25rem height=1.25rem><path fill=none stroke-width=4 stroke-dasharray=22 stroke-dashoffset=22 stroke-linecap=round stroke-miterlimit=10 d=M9.8,17.2l3.8,3.6c0.1,0.1,0.3,0.1,0.4,0l9.6-9.7><animate attributeName=stroke-dashoffset values=22;0 dur=0.25s begin=250ms fill=freeze>');const Gf=e=>{const t=e.primary||"#34C759";return (()=>{var n=Vf(),r=n.firstChild,o=r.firstChild;return n.style.setProperty("overflow","visible"),E(n,P(Os,{fill:t}),r),E(n,P(qs,{fill:t,begin:"350ms"}),r),be(o,Ne(()=>wn("0.0, 0.0, 0.58, 1.0")),true,false),q(()=>re(r,"stroke",e.secondary||"#FCFCFC")),n})()};var Kf=N('<svg viewBox="0 0 32 32"width=1.25rem height=1.25rem><path fill=none stroke-width=4 stroke-dasharray=9 stroke-dashoffset=9 stroke-linecap=round d=M16,7l0,9><animate attributeName=stroke-dashoffset values=9;0 dur=0.2s begin=250ms fill=freeze></animate></path><circle cx=16 cy=23 r=2.5 opacity=0><animate attributeName=opacity values=0;1 dur=0.25s begin=350ms fill=freeze>');const zf=e=>{const t=e.primary||"#FF3B30";return (()=>{var n=Kf(),r=n.firstChild,o=r.firstChild,a=r.nextSibling,s=a.firstChild;return n.style.setProperty("overflow","visible"),E(n,P(Os,{fill:t}),r),E(n,P(qs,{fill:t}),r),be(o,Ne(()=>wn("0.0, 0.0, 0.58, 1.0")),true,false),be(s,Ne(()=>wn("0.0, 0.0, 0.58, 1.0")),true,false),q(i=>{var c=e.secondary||"#FFFFFF",l=e.secondary||"#FFFFFF";return c!==i.e&&re(r,"stroke",i.e=c),l!==i.t&&re(a,"fill",i.t=l),i},{e:void 0,t:void 0}),n})()};var Wf=N('<svg viewBox="0 0 32 32"width=1.25rem height=1.25rem><path fill=none stroke-width=4 stroke-miterlimit=10 d=M16,6c3,0,5.7,1.3,7.5,3.4c1.5,1.8,2.5,4,2.5,6.6c0,5.5-4.5,10-10,10S6,21.6,6,16S10.5,6,16,6z></path><path fill=none stroke-width=4 stroke-linecap=round stroke-miterlimit=10 d=M16,6c3,0,5.7,1.3,7.5,3.4c0.6,0.7,1.1,1.4,1.5,2.2><animateTransform attributeName=transform type=rotate from="0 16 16"to="360 16 16"dur=0.75s repeatCount=indefinite>');const Xf=e=>(()=>{var t=Wf(),n=t.firstChild,r=n.nextSibling;return t.style.setProperty("overflow","visible"),q(o=>{var a=e.primary||"#E5E7EB",s=e.secondary||"#4b5563";return a!==o.e&&re(n,"stroke",o.e=a),s!==o.t&&re(r,"stroke",o.t=s),o},{e:void 0,t:void 0}),t})(),Bn={tips:`示例: (长度不够将降级不做裁剪) 
[美团-1] -> 核心本地商业/业务研发平台/商业增值技术部/算法工程组; 
[美团-2] -> 业务研发平台/商业增值技术部/算法工程组; 
[美团-3] -> 商业增值技术部/算法工程组; 
[美团-4] -> 算法工程组`,title:"选择部门裁剪方式",options:[{value:"1",label:"美团-1",callback:()=>{nt(),k.orgX1=true;}},{value:"2",label:"美团-2",callback:()=>{nt(),k.orgX2=true;}},{value:"3",label:"美团-3",callback:()=>{nt(),k.orgX3=true;}},{value:"4",label:"美团-4",callback:()=>{nt(),k.orgX4=true;}}]},Yf={title:"地域选择",tips:"目前暂时仅支持 北京、上海、怀来、香港 地域",options:[{label:"全部",value:"-",callback:()=>yt(null)},{label:"北京",value:"beijing",callback:()=>yt("beijing")},{label:"上海",value:"shanghai",callback:()=>yt("shanghai")},{label:"怀来",value:"cnhl",callback:()=>yt("cnhl")},{label:"香港",value:"cnhk",callback:()=>yt("cnhk")}]},Qf=["","-","waimai-beifang","waimai-east","waimai-first-gray","waimai-huabei","waimai-huanan","waimai-huaxi","waimai-huazhong","waimai-nanfang","waimai-second-gray","waimai-west","waimai-zhongnan"],Ye={title:"自定义Set",tips:"目前暂时仅支持外卖",options:Qf.map(e=>({value:e,label:Jf(e),callback:()=>{wi(e===""?null:e==="-"?"":e);}}))};function Jf(e){return e===""?"全部":e==="-"?"主干道":e}const Qe={title:"自定义机房楼栋",tips:"目前暂时仅支持 月浦三期 -> YP-M3",options:[{value:"YP-M3",label:"月浦三期",callback:()=>{nt(),k.hostBuilding="YP-M3",k.hostIdcName="上海_月浦";}}]},Fn=[{key:"menu_appkey_fill",label:"服务右侧填充",subMenus:[{label:"服务开发团队",extra:{hasCustom:true,configs:Bn},desc:"依据 AppKey, 填充服务对应的开发团队",callback:h("add-org-path")},{label:"服务Owner",desc:"依据 AppKey, 填充服务的Owner信息",callback:h("add-owner")},{label:"服务Sre",desc:"依据 AppKey, 填充服务的首个SRE",callback:h("add-sre")},{label:"上周利用率",desc:"依据 AppKey, 填充服务上周的利用率数据",callback:h("add-util")},{label:"容灾等级",desc:"依据 AppKey, 填充服务的容灾等级信息",callback:h("add-capacity")},{label:"容灾不达标描述",desc:"依据 AppKey, 填充容灾不达标的详细描述",callback:h("add-capacity-desc")},{label:"容灾治理建议",desc:"依据 AppKey, 提供容灾治理的建议信息",callback:h("add-capacity-tip")},{label:"服务等级",desc:"依据 AppKey, 填充服务的等级分类, 核心和非核心",callback:h("add-rank")},{label:"服务状态",desc:"依据 AppKey, 填充服务的当前状态, 有状态和无状态",callback:h("add-stateful")},{label:"OCTO路由策略",desc:"依据 AppKey, 填充OCTO路由策略信息, 同机房优先或者同城市优先",callback:h("add-rpc-group")},{label:"Rhino限流状态",desc:"依据 AppKey, 填充Rhino限流的当前状态",callback:h("add-rhino-on")},{label:"Rhino限流Debug",desc:"依据 AppKey, 填充是否开启 Rhino 限流的 Debug 模式",callback:h("add-rhino-debug")},{label:"Rhino限流类型",desc:"依据 AppKey, 填充Rhino限流的类型信息",callback:h("add-rhino-type")},{label:"服务主动 GC",desc:"依据 AppKey, 填充octo 主动 GC 信息",callback:h("add-rhino-gc")},{label:"服务结算单元",desc:"依据 AppKey, 填充服务的所属结算单元",callback:h("add-unit")},{label:"服务推荐配置",desc:"依据 AppKey, 填充服务的推荐配置信息, 比如: 4C/8G/150GB, 表示 CPU 4 核, 内存 8GB, 磁盘 150 GB",extra:{hasCustom:true,configs:Fu},callback:h("add-specification")},{label:"线上部署机器数",desc:"依据 AppKey, 填充 服务线上部署的机器数量",extra:{hasCustom:true,configs:[wu,Ln]},callback:h("add-host-cnt"),cancel:[tn]},{label:"线上部署机房数",desc:"依据 AppKey, 填充线上部署的机房数量",callback:h("add-host-idc-cnt")},{label:"线上机Region数",desc:"依据 AppKey, 填充线上机器的Region数量",callback:h("add-host-region-cnt")},{label:"部署机房详情",desc:"依据 AppKey, 填充部署机房的详细信息",extra:{hasCustom:true,configs:[Yf,Ln]},callback:h("add-host-idc-detail"),cancel:[tn]},{label:"部署地域详情",desc:"依据 AppKey, 填充部署地域的详细信息",extra:{hasCustom:true,configs:[gu,Ln]},callback:h("add-host-region-detail"),cancel:[tn]},{label:"是否接入弹性",desc:"依据 AppKey, 填充服务是否接入弹性",callback:h("add-banner-status")},{label:"是否接入广告智能弹性",desc:"依据 AppKey, 填充服务是否已经接入广告智能弹性",callback:h("add-banner-status-ad")},{label:"Plus发布期间弹性",desc:"依据 AppKey, 填充服务 Plus 发布期间弹性配置",callback:h("add-banner-plus")},{label:"弹性目标追踪策略",desc:"依据 AppKey, 填充服务弹性目标追踪策略信息",callback:h("add-banner-tracking")},{label:"是否为MLP服务",desc:"依据 AppKey, 查询服务是否为 MLP 服务的信息, 昨日离线数据, prod 机器来源全部是 hulk-yarn 表示 mlp 服务",callback:h("query-appkey-mlp")},{label:"服务OWT",desc:"依据 AppKey, 查询服务所属 OWT",callback:h("add-appkey-owt")},{label:"服务描述",desc:"依据 AppKey, 查询服务描述",callback:h("add-appkey-desc")},{label:"服务中文名",desc:"依据 AppKey, 查询服务中文名",callback:h("add-appkey-cn-name")},{label:"服务紧急资源详情",desc:"依据 AppKey, 查询服务当前在用紧急资源详情， 用于资源追回",callback:h("add-host-info-migration")}]},{key:"menu_domain_fill",desc:"域名信息填充",label:"域名右侧填充",subMenus:[{label:"域名部门",desc:"依据列内容, 查询域名并填充所属的部门信息",extra:{hasCustom:true,configs:Bn},callback:h("add-org-path-domain")},{label:"域名Owner",desc:"依据列内容, 查询域名并填充 Owner 信息",callback:h("add-owner-domain")},{label:"域名解析",desc:"依据列内容, 查询域名并填充 DNS 解析信息",callback:h("add-domain-dns")}]},{key:"menu_query",desc:"学城批量查询功能",label:"批量查询功能",subMenus:[{label:"host查询Appkey",desc:"通过host查询对应的Appkey信息",callback:h("query-appkey")},{disabled:true,label:"部门后端服务列表",desc:"多维表格暂时不可用. 查询部门下所有的后端服务列表",callback:h("query-org-appkey-list")},{disabled:true,label:"活动资源报备列表",desc:"多维表格暂时不可用. 依据活动链接, 查询活动资源报备列表",callback:h("query-activity-resource-list")},{label:"部门高峰期配置",desc:"依据部门ID, 查询部门高峰期配置(排除系统封禁), 数据示例: 88888,153262,3559,153620",callback:h("query-org-busyperiod")},{label:"服务高峰期配置",desc:"依据AppKey, 查询服务高峰期配置(排除系统封禁), 数据示例: com.sankuai.coe.api",callback:h("query-appkey-busyperiod")},{label:"服务活动报备Tag",desc:"依据 AppKey, 查询服务最近一年进行活动报备次数和报备标签",callback:h("query-appkey-activity")},{disabled:true,label:"宿主机容器列表",desc:"多维表格暂时不可用. 查询宿主机上的所有容器列表",callback:h("query-parent-host-list")},{disabled:true,label:"交换机物理机列表",desc:"多维表格暂时不可用. 查询交换机下的所有物理机列表",callback:h("query-switch-host-list")},{disabled:true,label:"机柜/机架位物理机列表",desc:"多维表格暂时不可用. 查询机柜/机架位下的所有物理机列表",callback:h("query-rack-host-list")},{label:"容器对应宿主机",desc:"查询容器对应的宿主机信息",callback:h("query-hulk-parent")},{label:"物理机-机柜号",desc:"查询物理机对应的机柜号信息",callback:h("query-host-rack")},{label:"物理机-SN号",desc:"查询物理机对应的SN号信息",callback:h("query-host-sn")},{label:"结算单元对应SRE",desc:"查询结算单元对应的SRE信息",callback:h("add-unit-sre")},{label:"结算单元对应部门",desc:"查询结算单元对应的部门信息",callback:h("add-unit-org")},{label:"人员所属部门",desc:"查询人员所属的部门信息",extra:{hasCustom:true,configs:Bn},callback:h("mention-get-org")}]},{key:"menu_at",desc:"学城批量转换内容功能",label:"转换内容",subMenus:[{label:"批量@",desc:"批量添加@提及用户",callback:h("mention-user")},{label:"删除@",desc:"批量删除@提及",callback:h("remove-mention")},{disabled:true,label:"☑️ 添加任务",desc:"多维表格暂时不可用. 批量添加任务节点",callback:h("add-task-node")},{disabled:true,label:"🔲 移除任务",desc:"多维表格暂时不可用. 批量移除任务节点",callback:h("remove-task-node")},{label:"🥢 提取人员&拉群",desc:"提取该学城页面中 @提及 的人员信息并创建大象群, 注意如有编辑中的内容需要先保存文档",callback:ks()}]},{key:"menu_link_action",desc:"学城批量转换链接功能",label:"转换链接",subMenus:[{label:"删除链接",desc:"菜单所在列 批量删除内容中的链接",callback:h("remove-link")},{label:"提取链接URL",desc:"菜单所在列 提取链接中的 url, 并插入新列",callback:h("extract-link-url")},{label:"+Avatar链接",desc:"菜单所在列 批量添加 Avatar 服务详情页链接",callback:h("link-avatar")},{label:"+Octo链接",desc:"菜单所在列 批量添加 Octo 详情页链接",callback:h("link-octo")},{label:"+弹性链接",desc:"菜单所在列 批量添加服务弹性详情页链接",callback:h("link-as")},{label:"自定义设置",desc:"打开自定义链接替换规则配置对话框",extra:{isSetting:true},callback:vs()}]},{key:"menu_host_building",desc:"学城批量查询服务机房楼栋信息功能",label:"服务机房楼栋信息",subMenus:[{label:"机房楼栋部署详情",desc:"依据 AppKey, 查询服务机指定房楼栋部署详情",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-detail")},{label:"机房楼栋部署占比",desc:"依据 AppKey, 查询服务机指定房楼栋部署占比",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-percent")},{label:"机房楼栋部署台数",desc:"依据 AppKey, 查询服务机指定房楼栋部署台数",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-cnt")},{label:"机房楼栋CPU/核",desc:"依据 AppKey, 查询服务机房楼栋CPU/核",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-cpu")},{label:"机房楼栋内存/GB",desc:"依据 AppKey, 查询服务机房楼栋内存/GB",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-mem")},{label:"机房楼栋磁盘/GB",desc:"依据 AppKey, 查询服务机房楼栋磁盘/GB",extra:{hasCustom:true,configs:[Qe,Ye]},callback:h("add-host-building-disk")}]},{key:"menu_ai_fill",desc:"AI相关功能",label:"AI分析",subMenus:[{label:"服务实际负责人",desc:"AI 分析 AppKey 实际负责人",callback:h("ai-appkey-admin")}]}];var Zf=N('<div class=tab-nav-container><div class="tab-list scrollbar-hide">'),ep=N("<button><span class=tab-button-text>"),tp=N("<span>");const np=e=>{const t=n=>{const r=["indicator-blue","indicator-indigo","indicator-purple","indicator-pink","indicator-red"];return r[n%r.length]};return (()=>{var n=Zf(),r=n.firstChild;return E(r,P(Re,{get each(){return e.menuItems},children:(o,a)=>(()=>{var s=ep(),i=s.firstChild;return s.$$click=()=>e.setActiveTab(o.key),E(i,()=>o.label.split(" ➜ ")[0]),E(s,(()=>{var c=Y(()=>e.activeTab===o.key);return ()=>c()&&(()=>{var l=tp();return q(()=>Oe(l,`tab-indicator ${t(a())}`)),l})()})(),null),q(c=>{var l=`tab-button ${e.activeTab===o.key?"active":""}`,u=o.desc||"";return l!==c.e&&Oe(s,c.e=l),u!==c.t&&re(s,"title",c.t=u),c},{e:void 0,t:void 0}),s})()})),n})()};Ve(["click"]);var rp=N("<div><div><button>取消</button><button>确认"),op=N("<div><div></div><div>"),oa=N("<div>"),ap=N("<select>"),sp=N("<option>"),ip=N("<label><input>");const cp=e=>{const t=()=>Array.isArray(e.configs)?e.configs:[e.configs],[n,r]=te(t().map(i=>{if(i.type==="checkbox")return Array.isArray(i.defaultChecked)?[...i.defaultChecked]:typeof i.defaultChecked=="function"?i.defaultChecked():[];if(i.type==="select"){const l=i.dynamicOptions?i.dynamicOptions():i.options||[];return [i.defaultValue||(l.length>0?l[0]?.value:"")]}const c=i.options||[];return c.length>0?[c[0]?.value||""]:[""]}));t().forEach((i,c)=>{if(i.type==="checkbox")i.options?.forEach(l=>{});else if(i.type==="select"){const l=i.dynamicOptions?i.dynamicOptions():i.options||[],u=i.defaultValue||(l.length>0?l[0]?.value:""),d=l.find(f=>f.value===u);d&&typeof d.callback=="function"&&d.callback();}else i.options&&i.options.length>0&&typeof i.options[0].callback=="function"&&i.options[0].callback();});const o=(i,c,l)=>{const u=[...n()];t()[i].type==="checkbox"?l?u[i].includes(c)||(u[i]=[...u[i],c]):u[i]=u[i].filter(f=>f!==c):u[i]=[c],r(u);},a=(i,c)=>n()[i]?.includes(c),s=(i,c)=>{const l=t()[i],u=l.options?.[c];return u?.type&&(u.type==="radio"||u.type==="checkbox")?u.type:l.type&&(l.type==="radio"||l.type==="checkbox")?l.type:"radio"};return (()=>{var i=rp(),c=i.firstChild,l=c.firstChild,u=l.nextSibling;return i.style.setProperty("padding","24px"),i.style.setProperty("min-width","400px"),i.style.setProperty("max-width","600px"),E(i,P(Re,{get each(){return t()},children:(d,f)=>(()=>{var p=op(),m=p.firstChild,w=m.nextSibling;return m.style.setProperty("margin-bottom","16px"),m.style.setProperty("font-size","18px"),m.style.setProperty("font-weight","500"),E(m,()=>d.title),E(p,(()=>{var v=Y(()=>!!d.tips);return ()=>v()&&(()=>{var b=oa();return b.style.setProperty("color","#666"),b.style.setProperty("font-size","12px"),b.style.setProperty("line-height","1.5"),b.style.setProperty("margin-bottom","16px"),b.style.setProperty("white-space","pre-wrap"),b.style.setProperty("word-break","break-word"),E(b,()=>d.tips),b})()})(),w),w.style.setProperty("margin-bottom","16px"),E(w,(()=>{var v=Y(()=>d.type==="select");return ()=>v()?(()=>{var b=ap();return b.addEventListener("change",C=>{const $=C.currentTarget.value;o(f(),$);const L=(d.dynamicOptions?d.dynamicOptions():d.options||[]).find(T=>T.value===$);L&&L.callback&&L.callback();}),b.style.setProperty("width","100%"),b.style.setProperty("padding","8px 12px"),b.style.setProperty("border-radius","4px"),b.style.setProperty("border","1px solid #d9d9d9"),b.style.setProperty("font-size","14px"),b.style.setProperty("background","white"),b.style.setProperty("cursor","pointer"),E(b,P(Re,{get each(){return Y(()=>!!d.dynamicOptions)()?d.dynamicOptions():d.options||[]},children:C=>(()=>{var $=sp();return E($,()=>C.label),q(()=>$.value=C.value),$})()})),q(()=>b.value=n()[f()]?.[0]||""),b})():(()=>{var b=oa();return b.style.setProperty("background-color","#f5f5f5"),b.style.setProperty("margin-bottom","8px"),b.style.setProperty("border-radius","6px"),b.style.setProperty("flex-wrap","wrap"),b.style.setProperty("width","fit-content"),b.style.setProperty("display","flex"),b.style.setProperty("padding","4px"),b.style.setProperty("gap","4px"),E(b,P(Re,{get each(){return d.options||[]},children:(C,$)=>{const O=()=>a(f(),C.value),L=s(f(),$());return (()=>{var T=ip(),J=T.firstChild;return T.style.setProperty("padding","4px 16px"),T.style.setProperty("border-radius","4px"),T.style.setProperty("cursor","pointer"),T.style.setProperty("font-size","14px"),T.style.setProperty("transition","all 0.3s"),J.addEventListener("change",z=>{const j=z.currentTarget.checked;o(f(),C.value,j),C.callback();}),re(J,"type",L),J.style.setProperty("display","none"),E(T,()=>C.label,null),q(z=>{var j=O()?"white":"transparent",W=O()?"#1677ff":"#666",De=O()?"500":"normal",V=L==="radio"?`custom-option-${f()}`:`custom-option-${f()}-${$()}`;return j!==z.e&&((z.e=j)!=null?T.style.setProperty("background",j):T.style.removeProperty("background")),W!==z.t&&((z.t=W)!=null?T.style.setProperty("color",W):T.style.removeProperty("color")),De!==z.a&&((z.a=De)!=null?T.style.setProperty("font-weight",De):T.style.removeProperty("font-weight")),V!==z.o&&re(J,"name",z.o=V),z},{e:void 0,t:void 0,a:void 0,o:void 0}),q(()=>J.value=C.value),q(()=>J.checked=O()),T})()}})),b})()})()),p})()}),c),c.style.setProperty("display","flex"),c.style.setProperty("justify-content","flex-end"),c.style.setProperty("gap","12px"),l.$$click=()=>{e.onCancel&&Array.isArray(e.onCancel)&&e.onCancel.forEach(d=>{typeof d=="function"&&d();});},l.style.setProperty("padding","6px 16px"),l.style.setProperty("border","1px solid #d9d9d9"),l.style.setProperty("border-radius","4px"),l.style.setProperty("background","white"),l.style.setProperty("font-size","14px"),l.style.setProperty("cursor","pointer"),u.$$click=()=>{const d=n().map((f,p)=>t()[p].type==="checkbox"?f.join(","):f[0]||"");e.onConfirm(d);},u.style.setProperty("border","none"),u.style.setProperty("color","white"),u.style.setProperty("padding","6px 16px"),u.style.setProperty("background","#1677ff"),u.style.setProperty("border-radius","4px"),u.style.setProperty("font-size","14px"),u.style.setProperty("cursor","pointer"),i})()},lp=e=>{const t=document.createElement("dialog");t.style.border="none",t.style.borderRadius="8px",t.style.padding="0",t.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",document.body.appendChild(t),t.showModal();const n=Dr(()=>P(cp,Ne(e,{onConfirm:r=>{e.onConfirm(r),t.close(),t.remove(),n();},onCancel:[()=>{e.onCancel&&Array.isArray(e.onCancel)&&e.onCancel.forEach(r=>{typeof r=="function"&&r();}),t.close(),t.remove(),n();}]})),t);};Ve(["click"]);var up=N("<div class=tooltip-container><div>");const Je=10,dp=e=>{const t=e.position||"top",n=e.isDisabled||false,r=e.hasCustom||false,o=`tooltip-${t}`;let a;if(!e.text||e.visible===false)return Y(()=>e.children);const s=i=>{if(!i)return;const c=i.getBoundingClientRect(),l=window.innerWidth,u=window.innerHeight,d=250,f=100;let p=c.left+c.width/2,m=c.top,w=p,v=m;switch(t){case "top":c.top<f+Je?(m=c.bottom+f,v=c.bottom-5,i.style.setProperty("--tooltip-arrow-y",`${v}px`),i.style.setProperty("border-color","transparent transparent rgba(17, 24, 39, 0.9) transparent")):(m=c.top,v=c.top-5,i.style.setProperty("--tooltip-arrow-y",`${v}px`));break;case "bottom":c.bottom+f>u-Je?(m=c.top-f,v=c.top+5,i.style.setProperty("--tooltip-arrow-y",`${v}px`),i.style.setProperty("border-color","rgba(17, 24, 39, 0.9) transparent transparent transparent")):(m=c.bottom+f,v=c.bottom+5,i.style.setProperty("--tooltip-arrow-y",`${v}px`),i.style.setProperty("border-color","transparent transparent rgba(17, 24, 39, 0.9) transparent"));break;case "left":c.left<d+Je?(p=c.right+d/2,w=c.right+5,i.style.setProperty("--tooltip-arrow-x",`${w}px`),i.style.setProperty("border-color","transparent rgba(17, 24, 39, 0.9) transparent transparent")):(p=c.left-d/2,w=c.left-5,i.style.setProperty("--tooltip-arrow-x",`${w}px`),i.style.setProperty("border-color","transparent transparent transparent rgba(17, 24, 39, 0.9)")),m=c.top+c.height/2,v=m,i.style.setProperty("--tooltip-arrow-y",`${v}px`);break;case "right":c.right+d>l-Je?(p=c.left-d/2,w=c.left-5,i.style.setProperty("--tooltip-arrow-x",`${w}px`),i.style.setProperty("border-color","transparent transparent transparent rgba(17, 24, 39, 0.9)")):(p=c.right+d/2,w=c.right+5,i.style.setProperty("--tooltip-arrow-x",`${w}px`),i.style.setProperty("border-color","transparent rgba(17, 24, 39, 0.9) transparent transparent")),m=c.top+c.height/2,v=m,i.style.setProperty("--tooltip-arrow-y",`${v}px`);break}p=Math.max(d/2+Je,Math.min(p,l-d/2-Je)),i.style.setProperty("--tooltip-x",`${p}px`),i.style.setProperty("--tooltip-y",`${m}px`),i.style.setProperty("--tooltip-arrow-x",`${w}px`),r&&i.style.setProperty("--tooltip-bg-color","rgba(194, 65, 12, 0.9)"),n&&i.style.setProperty("--tooltip-bg-color","rgba(99, 102, 241, 0.3)");};return ls(()=>{if(a){const i=a.querySelector(".tooltip-icon");if(i){s(i);const c=()=>{s(i);};window.addEventListener("resize",c);const l=()=>{s(i);};window.addEventListener("scroll",l,true),Ar(()=>{window.removeEventListener("resize",c),window.removeEventListener("scroll",l,true);});}}}),(()=>{var i=up(),c=i.firstChild,l=a;return typeof l=="function"?Tn(l,i):a=i,E(i,()=>e.children,c),c.addEventListener("mouseenter",u=>{s(u.currentTarget),n&&u.currentTarget.style.setProperty("--tooltip-bg-color","rgba(99, 102, 241, 0.3)");}),Oe(c,`tooltip-icon ${o}`),(n?"rgba(99, 102, 241, 0.3)":r?"rgba(194, 65, 12, 0.9)":void 0)!=null?c.style.setProperty("--tooltip-bg-color",n?"rgba(99, 102, 241, 0.3)":r?"rgba(194, 65, 12, 0.9)":void 0):c.style.removeProperty("--tooltip-bg-color"),q(()=>re(c,"data-tooltip",e.text)),i})()};var fp=N("<div class=tab-content>"),pp=N("<div class=category-section><div class=items-grid>"),mp=N("<div><div class=function-header><div class=function-title>"),hp=N('<span class="status-badge beta">设置'),gp=N('<span class="status-badge new">自定义');const yp=e=>{const t=c=>"desc"in c&&c.desc?c.desc:"",n=c=>"disabled"in c&&c.disabled&&!!R.menuContainer,r=c=>"extra"in c&&c.extra?.isSetting,o=c=>"extra"in c&&c.extra?.isCustom,a=c=>"extra"in c&&c.extra?.hasCustom,s=(c,l)=>{const u="function-item";if(n(c))return `${u} disabled`;if(r(c))return `${u} setting`;const d=["blue","indigo","purple","pink","red"];return `${u} ${d[l%d.length]}`},i=c=>{if(!n(c)){if("extra"in c&&c.extra?.hasCustom&&c.extra?.configs){const l=c.extra.configs;lp({configs:l,onConfirm:u=>c.callback(),onCancel:c.cancel&&!Array.isArray(c.cancel)?[c.cancel]:c.cancel});return}c.callback();}};return (()=>{var c=fp();return E(c,P(Re,{get each(){return e.menuItems},children:(l,u)=>P(fn,{get when(){return e.activeTab===l.key},get children(){var d=pp(),f=d.firstChild;return E(f,P(Re,{get each(){return e.activeTab==="menu_link_action"?[...l.subMenus,...e.customMenuItems]:l.subMenus},children:(p,m)=>{const w=t(p),v=n(p),b=s(p,m());return P(dp,{text:w,position:"top",visible:!!w,isDisabled:v,get hasCustom(){return a(p)},get children(){var C=mp(),$=C.firstChild,O=$.firstChild;return C.$$click=()=>i(p),Oe(C,b),E(O,()=>p.label),E($,(()=>{var L=Y(()=>!!r(p));return ()=>L()&&hp()})(),null),E($,(()=>{var L=Y(()=>!!o(p));return ()=>L()&&gp()})(),null),C}})}})),d}})})),c})()};Ve(["click"]);var bp=N("<div class=setting-message>"),wp=N('<div class=setting-dialog><h2 class=setting-title>链接自定义设置</h2><form><div class=hist-content></div><hr><div class=add-new><label class=setting-label>菜单名称: </label><input class=setting-input required type=text placeholder=2至12个字符长度></div><div class=add-new><label class=setting-label>链接规则: </label><input class=setting-input required type=text placeholder="使用 ${q} 表示目标内容占位符, 需要包含 ://"></div><div class=setting-menu><button type=button class=menu-submit>确认添加</button><button class=menu-close type=button>关闭'),vp=N("<label class=setting-label>:"),kp=N("<input class=setting-input type=text disabled>"),_p=N("<button class=del-btn type=button>删除");const Cp=()=>{const{settingRows:e,setSettingRows:t}=pn,[n,r]=te(""),[o,a]=te(""),[s,i]=te(""),c=()=>{const d=n().trim(),f=o().trim();if(!d||d.length<2||d.length>12){i("菜单名称长度必须在 2 到 12 个字符之间");return}if(!f||!f.includes("${q}")||!f.includes("://")){i("链接规则无效, 必须包含 ${q} 和 ://");return}const p={label:d,rule:f,id:fe()},m=[...e(),p];t(m),r(""),a(""),i("");},l=d=>{const f=e().filter(p=>p.id!==d);t(f);},u=()=>{pn.setShowSetting(false),!R.menuContainer&&(He().close(),g.menu&&(g.menu.hidden=true),g.clear());};return (()=>{var d=wp(),f=d.firstChild,p=f.nextSibling,m=p.firstChild,w=m.nextSibling,v=w.nextSibling,b=v.firstChild,C=b.nextSibling,$=v.nextSibling,O=$.firstChild,L=O.nextSibling,T=$.nextSibling,J=T.firstChild,z=J.nextSibling;return E(m,P(Re,{get each(){return e()},children:j=>[(()=>{var W=vp(),De=W.firstChild;return E(W,()=>j.label||"--",De),W})(),(()=>{var W=kp();return q(()=>W.value=j.rule),W})(),(()=>{var W=_p();return W.$$click=l,W.$$clickData=j.id,W})()]})),C.$$input=j=>r(j.currentTarget.value),L.$$input=j=>a(j.currentTarget.value),J.$$click=c,z.$$click=u,E(T,P(fn,{get when(){return s()},get children(){var j=bp();return E(j,s),j}}),null),q(()=>C.value=n()),q(()=>L.value=o()),d})()};Ve(["input","click"]);var xp=N("<div class=progress-container><p class=progress-message></p><progress max=100>");const Sp="正在处理，请稍候...",$p=()=>(()=>{var e=xp(),t=e.firstChild,n=t.nextSibling;return E(t,()=>`${Sp}${sr.extraMsg()||""}`),q(()=>n.value=sr.progress()),e})();var Ep=N("<button class=close-button>&#x2715;"),Ap=N("<div class=app-header><div class=header-title-container><h1 class=app-title>学城功能增强"),Tp=N("<div class=app>");const Pp=()=>{const e=He(),t=n=>{n.stopPropagation(),n.preventDefault(),e.close(),g.clear(),R.clear();};return (()=>{var n=Ep();return n.$$click=t,n})()},Ip=()=>{const[e,t]=te(Fn[0]?.key||""),n=()=>e()!=="menu_link_action"?[]:Es();return (()=>{var r=Tp();return E(r,P(qf,{position:"top-center"}),null),E(r,P(fn,{get when(){return !sr.show()},get fallback(){return P($p,{})},get children(){return P(fn,{get when(){return !pn.showSetting()},get fallback(){return P(Cp,{})},get children(){return [(()=>{var o=Ap();return o.firstChild,E(o,P(Pp,{}),null),o})(),P(np,{get activeTab(){return e()},setActiveTab:t,menuItems:Fn}),P(yp,{get activeTab(){return e()},menuItems:Fn,get customMenuItems(){return n()}})]}})}}),null),r})()};Ve(["click"]);function Np(){G.kmUIDispose&&G.kmUIDispose(),G.kmUIDispose=Dr(()=>P(Ip,{}),He());}let lr=false;const Lp=["km.sankuai.com","km.it.test.sankuai.com"];function Rp(){mt((e,t,n)=>{const r=n instanceof URL?n.pathname:n;r&&ne(()=>{Hr()||(Op(r)?aa():Mp());});}),aa();}function aa(){lr||(lr=true,Lp.includes(location.host)&&he("km_enhancement")&&An("km_enhancement_menu").length&&(setTimeout(()=>Wd(),1e3),document.addEventListener("contextmenu",sa),G.kmHandleContextMenuEventRef=sa,window.addEventListener("contextmenu",rt,true),G.kmHandleXtableMenuEventRef=rt,document.addEventListener("click",rt),G.kmHandleXtableClickEventRef=rt,Np()));}function Mp(){G.kmHandleContextMenuEventRef&&document.removeEventListener("contextmenu",G.kmHandleContextMenuEventRef),G.kmHandleXtableMenuEventRef&&window.removeEventListener("contextmenu",rt,true),G.kmHandleXtableClickEventRef&&document.removeEventListener("click",rt),G.kmUIDispose&&G.kmUIDispose(),G.kmHandleContextMenuEventRef=void 0,G.kmHandleXtableMenuEventRef=void 0,G.kmHandleXtableClickEventRef=void 0,G.kmUIDispose=void 0,lr=false;}function Op(e){return e?["/collabpage/","/page/"].some(t=>e.startsWith(t)):false}function sa(e){if(!Hr()&&Fa()&&(g.menu=document.querySelector(".pk-table-context-menu")||document.querySelector(".ct-table-context-menu"),!(!g.menu||g.menu.contains(e.target))))switch(g.el=e.target,g.isSelected=Td(),g.selectedText=Pd(),g.version=xi(),g.version){case 1:return Qd();case 2:return Jd()}}function rt(e){if(Hr()||!Fa())return;const t=e.target;if(t?.nodeName!=="CANVAS")return;const n=t.closest(".table-view");n&&ne(()=>{R.initStore(n)&&Zd();});}const H=new class{sleep(e){const t=performance.now();return new Promise(n=>{const r=()=>{performance.now()-t>=e?n():requestAnimationFrame(r);};requestAnimationFrame(r);})}async waitElement(e,t=200,n=300,r=false){for(;t--;){const o=document.querySelector(e);if(!o){await this.sleep(n);continue}if(r&&o.innerText?.length===0){await this.sleep(n);continue}return o}return null}_ReadFileAsync(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{t(r.result);},r.onerror=n,r.readAsDataURL(e);})}async _Img2Base64(e){try{const t=await fetch(e).then(n=>n.blob());return await this._ReadFileAsync(t)}catch{return "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzODQgNTEyIj4gPHBhdGggZmlsbD0iIzRFNTA1NSIgZD0iTTIyNCAxMzZWMEgyNEMxMC43IDAgMCAxMC43IDAgMjR2NDY0YzAgMTMuMyAxMC43IDI0IDI0IDI0aDMzNmMxMy4zIDAgMjQtMTAuNyAyNC0yNFYxNjBIMjQ4Yy0xMy4yIDAtMjQtMTAuOC0yNC0yNHptMTYwLTE0LjF2Ni4xSDI1NlYwaDYuMWM2LjQgMCAxMi41IDIuNSAxNyA3bDk3LjkgOThjNC41IDQuNSA3IDEwLjYgNyAxNi45eiI+PC9wYXRoPiA8L3N2Zz4="}}async genBadgedFavicon(e,t,n="#fff",r="#ff9800"){const o=await this._Img2Base64(e);return `data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><foreignObject x="0" y="0" width="100%" height="100%"><body xmlns="http://www.w3.org/1999/xhtml"><style>html,body{height:100%;margin:0;text-align:center;}img{display:block;width:100%;height:100%;object-fit:contain;}strong{position:absolute;bottom:0;left:50%;transform:translateX(-50%);text-transform:uppercase;background-color:${r};color:${n};padding:0px 1px;border-radius:2px;font-size:11px;box-sizing:border-box;max-width:100%;width:max-content;height:16px;line-height:16px;word-break:break-all;overflow:hidden;}</style><strong>${t}</strong><img src='${o}'></img></body></foreignObject></svg>`.replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23")}};function qp(){if(!/.?mws|rhino\.sankuai\.com|\.inf\.(st|\dev)/.test(location.hostname)||!he("mws_enhancement")||!An("mws_enhancement_menu").length)return;const t="https://s3plus.meituan.net/v1/mss_491cda809310478f898d7e10a9bb68ec",n={avatar:`${t}/pub_image8/6e849ee9-a398-4762-9096-9e5a9f866028`,raptor:`${t}/pub_image3/eeecde5e-a9f2-4986-a652-446bfda3f71e`,lion:`${t}/pub_image12/fb800ab5-854f-472a-b5b3-895dbe4bea80`,radar:`${t}/pub_image12/c462b0e7-a837-46cd-a06e-62158205488d_200_200`,octo:`${t}/pub_image13/2a76f7c8-9d86-4b64-967a-bd6325e50a5c_162_162`,plus:`${t}/pub_image9/f1dc356f-b514-4009-97f3-c24c5967f88f_200_200`,seer:`${t}/pub_image6/78c4a6cd-e54e-48d1-b1cf-77da9ccb34c6_200_200`,mcm:`${t}/pub_image6/1f087fc8-0b77-4433-8af5-d5fa7eb4022c_200_194`,cloudtrail:`${t}/pub_image6/1f087fc8-0b77-4433-8af5-d5fa7eb4022c_200_194`,rhino:`${t}/pub_file3/3d69553e-faf7-4256-b26c-cacdff461e46`,dayu:`${t}/pub_image14/bf204caa-e5e3-4540-8348-f0bb3dd054ab_200_200`,alarm:`${t}/pub_image5/905a4319-780a-43c8-af3e-ac3a1485e9e7`,logan:`${t}/pub_image13/6149d0d7-764d-4d1c-8a5b-9c6e9e19ddb0_200_200`,oceanus:`${t}/pub_image1/6b16d1d7-e7f6-4cc0-a9c7-30bb2d51a0c5_200_200`,dora:`${t}/pub_image15/7b217243-aba1-4fd0-a7d5-10ea353d1b13_200_200`,billing:`${t}/pub_image1/ccae211b-ceb8-4f7b-942e-34e97c903083_200_200`,rds:`${t}/pub_image15/f0e745d4-b53b-48ae-ba32-128455359e23`,squirrel:`${t}/pub_image13/13a3def5-dc50-4227-b56b-861ff68f03de`,cellar:`${t}/pub_image12/3633892b-4960-4b0c-a90e-b7a0630b4ce7_200_124`,crane:"https://p0.meituan.net/travelcube/fae862bd8662b640f42edadb12e651a820465.png",mdp:`${t}/pub_image8/e849c529-fd12-49ae-8361-eae5a657d5cb`,monkey:`${t}/pub_image3/d173f538-aeae-499d-b9dd-0824905e0262`,camel:`${t}/pub_image2/5b787b7e-e1bf-4e71-acf6-379825947ebe`,xframe:`${t}/pub_image6/e789fd54-6557-47a8-9873-6a2eea213497`,mafka:`${t}/profile15/b1832c80-df2b-44be-ab3d-024d54991b96`,shepherd:`${t}/pub_image5/91a76d69-301d-409a-a658-1d92f4958d80`,shark:`${t}/pub_image7/fa90e41a-19ba-4376-9fc2-3533f98a9acd_200_200`,hulk:`${t}/pub_image10/8ead7266-43e9-4374-9116-ddbafa53a822`,coe:`${t}/pub_image1/8d5d1cee-41a3-4d99-b143-0a4cde6fad6a`,lijian:`${t}/pub_image9/5f42e651-f5af-42b3-bc19-cc6b14418927_200_124`,ccmp:"https://img.meituan.net/diegofilepublic/ebe2c167034c02eaac67a249f8a3ac3218453.png"};let r=false;if(he("mws_sub_favicon")){const o=async()=>{const a=location.hostname.split(".")[0].split("-")[0].toLowerCase(),s=Hp(n,a);if(!s)return;let i=null,c=null,l=null;const{hostname:u}=location;u.endsWith(".mws-test.sankuai.com")||u.endsWith(".mws.cloud.test.sankuai.com")?(i="test",l="#fff",c="#9c27b0"):u.endsWith("-st.mws.sankuai.com")||u.endsWith(".inf.st.sankuai.com")?(i="st",l="#fff",c="#f44336"):u.endsWith(".inf.dev.sankuai.com")&&(i="dev",l="#fff",c="#3330dc");const d=i?await H.genBadgedFavicon(s,i,l,c):s;let f=document.querySelector('link[rel="icon"]');const p=()=>{f?f.href=d:(f=document.createElement("link"),f.rel="icon",f.href=d,document.head.appendChild(f)),r||(r=true,M.mws.moduleClick("b_op_mws_site_icon_mc"));};p(),setTimeout(p,500),setTimeout(p,1e3),setTimeout(p,1500),setTimeout(p,2e3),i&&(document.title=`${a}-${i}`);};mt(o),X.addEventListener("load",o),X.addEventListener("popstate",o);}setTimeout(()=>{he("mws_sub_close_announce")&&((async()=>(await H.waitElement("#onecloud-noticeboard .portalnavfont-close",50,100,false))?.click())(),(async()=>(await H.waitElement(".notice-body .mtdicon-close-thick",50,100,false))?.click())(),(async()=>(await H.waitElement(".el-alert__closebtn .el-icon-close",50,100,false))?.click())(),M.mws.moduleView("b_op_mws_notice_mv")),he("mws_sub_close_tips")&&((async()=>(await H.waitElement("#onecloud-rate-container",100,50,false))?.remove())(),(async()=>(await H.waitElement("div#mwsnav-operation-bar",100,50,false))?.remove())(),(async()=>(await H.waitElement("#onecloud-user-center .oc-user-dropdown",100,30,false))?.remove())(),(async()=>(await H.waitElement("#onecloud-topnav-cost",100,30,false))?.remove())(),(async()=>(await H.waitElement("#onecloud-message-container",100,30,false))?.remove())(),M.mws.moduleView("b_op_ui_improve_mv"));},100);}function Hp(e,t){return e[t]}const Dp=["yuntu.sankuai.com","yuntu.keetapp.com"],Ur=()=>Dp.includes(location.host),Up=()=>{if(!Ur())return  false;const{pathname:e}=location;return !!/.*\/widget\/widget-[^/]+\/view$/.test(e)},ur=()=>{if(!Ur())return  false;const{pathname:e}=location;return !(/.*\/widget\/.*$/.test(e)||!/.*\/(view|edit)$/.test(e))},Hs=()=>{const{host:e,pathname:t}=location;return e!=="yuntu-manage.sankuai.com"?false:!!(/^\/nwidget\/dashboard\/dashboard-.*\/nwidget\/widget-.*\/edit.*/.test(t)||/^\/nwidget\/dashboard\/dashboard-.*\/new$/.test(t))},Bp=()=>{if(!Hs())return  false;const{pathname:e}=location;return /^\/nwidget\/dashboard\/dashboard-.*\/new$/.test(e)},Ds=()=>Hs()?he("yuntu_enhancement")&&he("yuntu_sub_edit_enh"):false,Br=()=>X!==X.top,Fp=()=>location.host==="rocket.sankuai.com",jp=()=>location.host==="timebird.sankuai.com",Vp=()=>location.host==="iomp.sankuai.com",Gp=()=>{const{host:e,pathname:t}=location;return t!=="/preview"?false:e==="nest.sankuai.com"||e==="nest.inf.test.sankuai.com"},Kp=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("oceanus."))},Fr=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("avatar."))},zp=()=>{if(!Fr())return  false;const{hash:e,pathname:t}=location;return e?.startsWith("#/service/detail/")||t?.startsWith("/v2/service/detail/")},Wp=()=>{if(!Fr())return  false;const{hash:e,pathname:t}=location;return e?.endsWith("/activity/card")||t?.endsWith("/activity/card")},Xp=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("radar."))},Yp=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("seer."))},Qp=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("ccmp."))},Jp=()=>{const{host:e}=location;return !(!e.includes("mws")||!e.startsWith("as."))},Us=()=>{const{host:e}=location;return !(!e.startsWith("km.")||!e.endsWith(".sankuai.com"))},Zp=()=>{const{host:e}=location;return ["sre.sankuai.com","sre.sre.test.sankuai.com","127.0.0.1:7070"].includes(e)},jn=Q("COPY_STYLE");async function em(){Jp()&&(Bs(),mt(rm));}async function Bs(){if(document.querySelector(`.${jn}`))return;const e=await H.waitElement("#app .sre-title .back-text");if(!e)return;const t=document.createElement("span");t.className=`mrgl8 ${jn}`,t.style.cursor="pointer",t.innerHTML='<i class="mt-icon mt-icon-copy" style="font-size: 16px;"></i>';const n=document.createElement("span");n.innerHTML='<i class="appkey-detail-btn mtdicon mtdicon-link-o" style="margin-left: 4px;"></i>',n.style.cursor="pointer",n.style.color="#0a70f5",document.querySelector(`.${jn}`)||(e.after(n),e.after(t),t.addEventListener("click",nm),n.addEventListener("click",tm));}function tm(){const e=new URL(location.href).searchParams.get("appkey")?.trim()||"";if(!e)return;const t=`https://avatar.mws.sankuai.com/v2/service/detail/host?appkey=${e}&env=prod`;window.open(t,"_blank");}function nm(){const e=new URL(location.href).searchParams.get("appkey")?.trim()||"";e&&navigator.clipboard.writeText(e).then(()=>{A.success("Appkey 复制成功");});}function rm(...e){const[,,t]=e;t?.startsWith("/avatar-hulk-new/")&&Bs();}function om(){document.addEventListener("keypress",e=>{if(am()){if(["["].includes(e.key)&&(e.ctrlKey||e.altKey)){switch(true){case location.host==="km.sankuai.com":document.querySelector("#ct-layout .sidebar-control .sidebar-control-wrapper")?.click(),M.km.moduleClick("b_op_km_hotkey_mc");case location.host.endsWith("mws.sankuai.com"):document.querySelector(".sidebar-control-wrapper")?.click(),M.mws.moduleClick("b_op_hotkey_mws_mc");}return}if(["]"].includes(e.key)&&(e.ctrlKey||e.altKey)){switch(true){case location.host==="km.sankuai.com":{const t=document.querySelector("#quote-comment-viewer .unfold-viewer-button i");t?t?.click():document.querySelector("#quote-comment-viewer .operation .close>i")?.click(),M.km.moduleClick("b_op_km_hotkey_mc");}}return}}});}function am(){const{pathname:e,host:t}=location;return t.endsWith("mws.sankuai.com")?true:!(!/^\/(collabpage|page)\/\d+.*/.test(e)||t!=="km.sankuai.com")}const ia=Q("SEER_STYLE");async function sm(){Yp()&&im();}function im(){if(document.querySelector(`style[data-id="${ia}"]`))return;const e=document.createElement("style");e.setAttribute("data-id",ia),e.innerHTML="#app .onecloud-wrapper .onecloud-content-wrapper.risk-detail-content-wrapper { overflow-x:hidden;} #app .onecloud-wrapper .onecloud-content-wrapper.risk-detail-content-wrapper>.risk-background { padding-right:0;} #app .onecloud-wrapper .onecloud-content-wrapper.risk-detail-content-wrapper>.risk-background>.l-flex.risk-detail-container { width:fit-content;}",document.head.appendChild(e);}const ca=Q("CCMP_STYLE");async function cm(){Qp()&&lm();}function lm(){if(document.querySelector(`style[data-id="${ca}"]`))return;const e=document.createElement("style");e.setAttribute("data-id",ca),e.innerHTML=".mtd-table-cell-tooltip { user-select:text;}",document.head.appendChild(e);}var zt=null,Fs=class dr{constructor(t){if(this.interceptConfigs=[],dr.isHijacked){if(zt)return zt.addConfig(t),zt;console.warn("XHRAndFetchInterceptor: Already activated, avoid duplicate interception.");return}this.interceptConfigs=Array.isArray(t)?t:[t],this.originalXHRopen=XMLHttpRequest.prototype.open,this.originalXHRsend=XMLHttpRequest.prototype.send,this.originalFetch=X.fetch,this.hijackXHR(),this.hijackFetch(),dr.isHijacked=true,zt=this;}addConfig(t){(Array.isArray(t)?t:[t]).forEach(n=>{this.interceptConfigs.some(r=>r.url===n.url&&r.method===n.method)||this.interceptConfigs.push(n);});}hijackXHR(){let t=this;XMLHttpRequest.prototype.open=function(n,r,o=true,a,s){this.uri=r,this.method=n,t.originalXHRopen.apply(this,[n,r,o,a,s]);},XMLHttpRequest.prototype.send=async function(n){let r=this.onreadystatechange,o=t.originalXHRsend.bind(this),a={status:0,statusText:"",response:null,responseText:"",responseXML:null,responseType:"",readyState:0},s=new Proxy(this,{get:(c,l)=>l==="readyState"?a.readyState:Reflect.get(c,l)}),i=this.uri?.startsWith("/")?`${location.origin}${this.uri}`:this.uri;for(let c of t.interceptConfigs)if(Wt(i,c.url)&&Xt(this.method,c.method)){if(c.beforeSendCallback){let l={url:new URL(i),data:n},{data:u,url:d}=await c.beforeSendCallback(l)||{};u&&(n=u),d&&(this.uri=d.toString(),t.originalXHRopen.apply(this,[this.method,this.uri,true]));}break}return this.onreadystatechange=async function(c){let l=true;if(this.readyState===4&&this.status===200)for(let u of t.interceptConfigs){if(!Wt(this.responseURL,u.url)||!Xt(this.method,u.method))continue;let d={url:Vn(this.responseURL),data:n};if(u.preCallback){let[p,m]=await u.preCallback(Gn(this),d);if(!p){l=false;let w=new XMLHttpRequest;return w.open(this.method,m.uri,true),w.onreadystatechange=async()=>{if(w.readyState===4){if(a.status=w.status,a.statusText=w.statusText,a.response=w.response,a.responseText=w.responseText,a.responseXML=w.responseXML,a.readyState=w.readyState,u.lastCallback){let v=await u.lastCallback(Gn(a),d);a.response=v,a.responseText=JSON.stringify(v);}Object.defineProperties(this,{status:{get:()=>a.status},response:{get:()=>a.response},statusText:{get:()=>a.statusText},responseXML:{get:()=>a.responseXML},responseText:{get:()=>a.responseText},responseType:{get:()=>a.responseType},readyState:{get:()=>a.readyState}}),r&&r.call(s,c);}},w.send(m?.data)}}let f=Gn(this);if(u.callback&&await u.callback(f),u.lastCallback){let p=await u.lastCallback(f,d);a.response=p,a.responseText=JSON.stringify(p),Object.defineProperties(this,{response:{get:()=>a.response},responseText:{get:()=>a.responseText}});}}r&&l&&r.call(this,c);},o(n)};}hijackFetch(){let t=this;X.fetch=async function(n,r){let o=typeof n=="string"?n:n instanceof URL?n.href:n.url,a=r&&r.method?r.method:"GET",s=n,i=r;for(let l of t.interceptConfigs)if(Wt(o,l.url)&&Xt(a,l.method)){if(l.beforeSendCallback){let u={url:Vn(o),data:r?.body},d=await l.beforeSendCallback(u);d&&(d.url&&(s=d.url.toString()),d.data&&(i={...r,body:d.data}));}break}let c=await t.originalFetch.call(X,s,i);for(let l of t.interceptConfigs)if(Wt(c.url,l.url)&&Xt(a,l.method)){let u=await c.clone().text(),d;try{d=JSON.parse(u);}catch{d=u;}let f={url:Vn(c.url),data:r?.body};if(l.callback&&await l.callback(d),l.lastCallback){let p=await l.lastCallback(d,f),m=typeof p=="string"?p:JSON.stringify(p);return new Response(m,{status:c.status,statusText:c.statusText,headers:c.headers})}}return c};}restore(){XMLHttpRequest.prototype.open=this.originalXHRopen,XMLHttpRequest.prototype.send=this.originalXHRsend,X.fetch=this.originalFetch;}};Fs.isHijacked=false;var um=Fs;function Vn(e){return e.startsWith("/")?new URL(`${location.origin}${e}`):new URL(e)}function Wt(e,t){if(t instanceof RegExp)return t.test(e);try{let n=new URL(e),r=new URL(t);return n.host===r.host&&n.protocol===r.protocol&&n.pathname===r.pathname}catch{return  false}}function Xt(e,t){return e?.toLocaleLowerCase()===t?.toLocaleLowerCase()}function Gn(e){return e.responseType==="json"?e.response:e.responseText}var le=um;const Kn=new Map;async function dm(){if(!Xp())return;const e=location.origin;new le([{method:"GET",url:`${e}/api/v2/alert/search/user/org`,lastCallback:mm}]);}function fm(){const{pathname:e}=location,t=e.match(/\/event\/detail\/(\d+)/);return t?Number(t[1]):null}async function pm(e){const t=fm();if(!t)return null;if(Kn.has(t))return Kn.get(t);const r=await(await fetch(`${location.origin}/api/em/display/events/${t}`)).json();if(r?.code===1e4){const o=r.result?.org_id;if(!o)return null;const a=Ss(e,o,{id:"value",name:"label",children:"children"});if(a?.path){const s=a.path;return Kn.set(t,s),s}}return null}async function mm(e){const t=typeof e=="string"?JSON.parse(e):e,n=t.data;if(hm()&&n?.value){const r=n.items,o=await pm(r);o&&(n.value=o.splice(0,4),M.radar.moduleClick("b_op_event_radar_mc"));}return t}function hm(){const{pathname:e}=location;return !!/^\/event\/detail\/\d+\/alarm$/.test(e)}function gm(e){e.styles.forEach(t=>ke(t)),e.routeChange.forEach(t=>mt(t)),new le(e.xhrInterceptor);}function ym(){const e=location.origin,t=new RegExp(`${e}/api/v2/avatar/appkey/[^/]+/utilization`),n=new RegExp(`${e}/api/v2/avatar/activity/prediction/\\d+/detail`),r=new RegExp(`${e}/api/v2/avatar/activity/\\d+/predictionTask`);return [{url:`${e}/api/v2/avatar/host`,lastCallback:bm,method:"POST"},{url:t,method:"GET",lastCallback:wm},{url:n,method:"GET",lastCallback:vm},{url:r,method:"GET",lastCallback:km}]}async function bm(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data.items.forEach(n=>{const{comment:r,manage_plat:o,_origin_type:a}=n;if(/^(结算|通用|活动|紧急)/.test(a))return;const s=r||o;if(!s)return;const i=a.replace("资源池","").replace("专属","专区");n._origin_type=`${i}(${s})`;}),t.data.items.forEach(n=>{n.iaasInfo?.building==="YP-M3"&&(n._idc_name=`${n._idc_name}(三期)`),n.iaasInfo?.building==="JD-M1"&&(n._idc_name=`${n._idc_name}(一期)`);}),t}async function wm(e){const t=typeof e=="string"?JSON.parse(e):e,n=t.data.detailUrl;if(!n)return t;const r=new URL(n),o=r.searchParams.get("config");if(!o)return t;const a=JSON.parse(o),s=a.startDate;if(!s)return t;const i=new Date(s),l=new Date(i.getFullYear(),i.getMonth()-2,i.getDate()).toISOString().split("T")[0];return a.startDate=l,r.searchParams.set("config",JSON.stringify(a)),t.data.detailUrl=r.toString(),t}async function vm(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data.forEach(n=>{if(Array.isArray(n.appkeyPredictions)){const r=new Map;n.appkeyPredictions.forEach(o=>{o.cell=o.cell||"-";const a=o.appkey||"",s=o.cpuCount||0;r.set(a,(r.get(a)||0)+s);}),n.appkeyPredictions=n.appkeyPredictions.sort((o,a)=>{const s=o.appkey||"",i=a.appkey||"",c=r.get(s)||0,l=r.get(i)||0;return c!==l?l-c:(a.cpuCount||0)-(o.cpuCount||0)});}}),t}async function km(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data.forEach(n=>{n.tags[0]=`id=${n.taskId} -- ${n.tags[0]}`;}),t}const fr=Q("FLOW_UNIT"),_m=["service_expand_quickly","service_expand","reduced_service"];function Cm(){const e=location.origin,t="/api/v2/avatar/workflow/flow/";return M.avatar.moduleView("b_op_workflow_mv"),[{url:new RegExp(`^${e}${t}[-\\w\\d]+/detail`),lastCallback:xm,method:"GET"}]}function xm(e){const t=typeof e=="string"?JSON.parse(e):e,{data:n={}}=t,r=_m.some(o=>o===n?.templateName);return ne(()=>{const o=n?.endTime,a=n?.appkey,s=n?.id,i=n?.env;a&&setTimeout(async()=>{if(la())return;const c=js();if(!c)return console.warn("未找到目标元素");const l=await de(a).then(m=>m?.billingUnitName),u=await de(a).then(m=>m?.team?.orgName||"");if(!l)return console.warn(`未找到结算单元, appkey=${a}`);const d=u.split("/").slice(-4).join("/"),f=ye(`<div class="info ${fr}"><div class="label">结算单元:&nbsp;<span class="value">${l}</span></div></div>`),p=ye(`<div class="info ${fr}"><div class="label">开发团队:&nbsp;<span class="value">${d}</span></div></div>`);if(!la()){M.avatar.moduleClick("b_op_workflow_mc");const m=c.querySelector("div.info")?.nextSibling;m?(c.insertBefore(p,m),r&&c.insertBefore(f,m)):(r&&c.appendChild(f),c.appendChild(p));}n?.status==="SUCCESS"&&n?.publicData?.display?.input?.find(m=>m.fieldName==="cluster"&&m.value==="紧急资源池")&&Sm(s,a,o,i);},100);}),t}function js(){return document.querySelector("#layout div.layout-detail.workflow .header div.content .bottom")}function la(){return !!js()?.querySelector(`div.info.${fr}`)}async function Sm(e,t,n,r){try{const a=new URLSearchParams(window.location.search).get("flowId");if(!a)return;let s=await fc(t,"使用");if(s=s.filter(u=>u.reason?.includes(a)),!s?.length){if(s=await pc(t,n,r),!s?.length)return;const d=(await mc(e)).map(p=>p.ipv4),f=d.length/2;s=s.filter(({keyword:p})=>p.filter(m=>d.includes(m)).length>=f||d.filter(m=>p.includes(m)).length>=f);}if(!s?.length)return;const i=document.querySelector(".workflow-content>.right>.card");if(!i)return;const c=ye('<div class="related-flows" style="margin-top:16px;padding:16px;border:1px solid #e8e8e8;border-radius:4px;"><h4 style="margin:0 0 12px 0;font-size:14px;font-weight:600;color:#333;">关联流程</h4><div class="flow-links"></div></div>'),l=c.querySelector(".flow-links");s.forEach(u=>{let d="#666";switch(u.cnStatus){case "已完成":d="#2d7a2d";break;case "已关闭":d="#c53030";break;case "延迟执行":d="#2b6cb0";break;case "待审批":d="#b83280";break}const f=ye(`<div style="margin-bottom:8px;"><a href="https://avatar.mws.sankuai.com/v2/service/workflow/detail?flowId=${u.applyId}" target="_blank" style="color:#1890ff;text-decoration:none;font-size:13px;"> ${u.applyName||u.applyId} </a><span style="margin-left:8px;color:#666;font-size:12px;"> ${u.endTime} - <span style="color:${d};font-weight:500;">${u.cnStatus}</span></span></div>`);l?.appendChild(f);}),i.appendChild(c);}catch(o){console.error("查询关联流程失败:",o);}}const zn="http://localhost:56193",$m=async e=>{const{uid:t,gid:n,pubid:r}=e,o=t?`${zn}/alive?from=&path=/chat?uid=${t}`:n?`${zn}/alive?from=&path=/chat?gid=${n}`:`${zn}/alive?from=&path=/pub?pubid=${r}`;try{return (await(await fetch(o,{method:"GET"})).json())?.data===!0}catch(a){return console.warn("openXmChat unexpected error: ",a,{uid:t,gid:n,pubid:r}),Em(e)}};function Em({uid:e,gid:t,pubid:n}){const o=`mtdaxiang://www.meituan.com/chat?${e?`uid=${e}`:t?`gid=${t}`:n?`pubid=${n}`:""}`;return window.open(o,"_blank"),true}class Vs{constructor(t,n){D(this,"key");D(this,"defaultValue");this.key=t,this.defaultValue=n;}get(){return xe(this.key,this.defaultValue)}set(t){Se(this.key,t);}update(t){const r={...this.get(),...t};this.set(r);}delete(){Se(this.key,this.defaultValue);}exists(){const t=this.get();return JSON.stringify(t)!==JSON.stringify(this.defaultValue)}}function Am(e,t){return new Vs(e,t)}const ua=new Vs("__mis_uid__",{}),pr=Am("avatarActivityFilter",false),Tm="https://s3plus.meituan.net/v1/mss_c967219e66d442fc9cef1b3dfa9accfa/material-static/dx.png",Pm=[`.itu-users-content-largeAvatar .itu-largeAvatar-current-personnel::after, .avatar-user .avatar-user-name > .avatar-user-name-cn::after { content:"";top:2px;right:4px;width:25px;height:25px;background-image:url("${Tm}");background-repeat:no-repeat;background-size:18px 18px;background-position:center;border:2px solid #1890ff;border-radius:50%;position:absolute;cursor:pointer;z-index:1000;}`,".itu-users-content-largeAvatar .itu-largeAvatar-current-personnel::after { top:16px;}",".itu-users-content-largeAvatar .itu-largeAvatar-current-personnel { width:100%;}"],Im=e=>{const t=e.target;if(!t?.classList?.contains("avatar-user-name-cn"))return  false;const n=t.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top,a=n.width-25-4,s=2;return r>=a&&r<=n.width&&o>=s&&o<=s+25},Nm=e=>{const t=e.target;if(!t?.classList?.contains("itu-largeAvatar-current-personnel"))return  false;const n=t.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top+5,a=n.width-25-4,s=16;return r>=a&&r<=n.width&&o>=s&&o<=s+25},da=e=>{const t=e.target;if(Im(e)){e.preventDefault(),e.stopPropagation();const n=Rm(t);fa(n);}else if(Nm(e)){e.preventDefault(),e.stopPropagation();const n=Mm(t);fa(n);}};function Lm(){document.removeEventListener("click",da),document.addEventListener("click",da);}async function fa(e){if(!e){console.warn("未找到用户信息");return}let n=ua.get()[e];if(!n){const r=await Yi(e);if(!r){console.warn(`未找到用户信息: ${e}`);return}n=r.userId,ua.update({[e]:n});}$m({uid:n});}function Rm(e){const t=e.closest(".avatar-user-name");if(!t)return null;const n=t.querySelector(".avatar-user-name-mis");return n&&n.textContent?.trim()||null}function Mm(e){const t=e.closest(".itu-largeAvatar-current-personnel");if(!t)return null;const n=t.querySelector(".itu-largeAvatar-current-personnel-copy");return n&&n.textContent?.trim()||null}const Gs=Q("ACTIVITY"),St={el:null,switchInput:null},Om=[".activity-resource .resource-search-header>.mtd-select.mtd-select-multiple:first-of-type { width:500px !important;}",".mtd-lock-scroll div.mtd-drawer.mtd-drawer-right div.mtd-drawer-content div.layout-edit.fix-header.drawer.v2 div.estimation-card {width:100% !important;}",".mtd-lock-scroll > div > div.mtd-drawer.mtd-drawer-right {width:calc(70vw + 70px) !important;}",".mtd-lock-scroll > div.drawer-form > div.mtd-drawer.mtd-drawer-right span.mtd-switch {width:40px !important;}"];function qm(){setTimeout(Ks,1e3);}function Ks(){return ne(()=>{Wp()&&(Um(),Dm(),setTimeout(async()=>{const e=await H.waitElement(".activity-cards .mtd-pagination");e?.__vue__?.pageSize&&(e.__vue__.pageSize=100);},600));})}function Hm(){return !!document.querySelector(`.${Gs}`)}function Dm(){if(Hm())return;const e=document.querySelector(".activity-card-content>.date-choose .tag-filter");if(!e)return;const t=pr.get(),n=document.createElement("div");n.className=Gs,n.style.cssText="display: flex; align-items: center; gap: 8px; margin-left: 16px;";const r=document.createElement("label");r.textContent="过滤测试活动",r.style.cssText="font-size: 14px; color: #333; cursor: pointer;";const o=document.createElement("span");o.style.cssText="position: relative; display: inline-block; width: 28px; height: 16px; vertical-align: middle;";const a=document.createElement("input");a.type="checkbox",a.style.display="none",a.checked=t;const s=document.createElement("span");s.style.cssText=`position: relative; display: inline-block; width: 100%; height: 100%; border-radius: 8px; box-sizing: border-box; background: ${t?"#1890ff":"#bbb"}; transition: background 0.2s;`;const i=document.createElement("span");i.style.cssText=`position: absolute; top: 3px; left: ${t?"16px":"2px"}; width: 10px; height: 10px; border-radius: 50%; background: #fff; transition: left 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.1);`,s.appendChild(i),o.appendChild(a),o.appendChild(s),n.addEventListener("click",()=>{const c=!a.checked;a.checked=c,s.style.background=c?"#1890ff":"#bbb",i.style.left=c?"16px":"2px",pr.set(c),setTimeout(async()=>{const l=await H.waitElement(".activity-cards .mtd-pagination");l?.__vue__?.pageSize&&(l.__vue__.pageSize=100),l?.__vue__?.handlePageSizeChange&&l.__vue__.handlePageSizeChange();},600);}),n.appendChild(r),n.appendChild(o),e.insertAdjacentElement("afterend",n),St.el=n,St.switchInput=a;}function Um(){St.el?.remove(),St.el=null,St.switchInput=null;}function Bm(){const e=location.origin;return [{method:"GET",url:`${e}/api/v2/avatar/activity`,lastCallback:jm,beforeSendCallback:Fm},{method:"GET",url:`${e}/api/v2/avatar/activity/appkey`,lastCallback:Vm},{method:"GET",url:`${e}/api/v2/avatar/activity/business`,lastCallback:Gm}]}async function Fm(e){const t=e.url.searchParams;return t.has("pageSize")?t.set("pageSize","100"):t.append("pageSize","100"),{url:e.url}}async function jm(e){const t=typeof e=="string"?JSON.parse(e):e;return pr.get()===true&&t.data?.items&&Array.isArray(t.data.items)&&(t.data.items=t.data.items.filter(r=>{const o=r.name||"";return !/(test|测试|专用)/i.test(o)}).sort((r,o)=>{const a=(r.startTime||"").localeCompare(o.startTime||"");return a!==0?a:(r.name||"").localeCompare(o.name||"")}),t.data.totalCount=t.data.items.length),t}function Vm(e,t){const n=typeof e=="string"?JSON.parse(e):e,r=!!t.url.searchParams.get("sortBy");return n?.data?.items?.length&&!r&&(n.data.items=n.data.items.sort((o,a)=>{const s=o.orgName.localeCompare(a.orgName);if(s!==0)return s;const i=o.appkey.localeCompare(a.appkey);if(i!==0)return i;const c=(o.cell||"").localeCompare(a.cell||"");return c!==0?c:(o.region||"").localeCompare(a.region||"")})),n}function Gm(e){const t=typeof e=="string"?JSON.parse(e):e;return t?.data?.items?.length&&t.data.items.forEach(n=>{n.billingUnit=n.billingUnit?.replace(/^业务研发平台/,"业研");}),t}function Pn(){return new URL(location.href).searchParams.get("appkey")}const zs=Q("DETAIL"),Pe={el:null,appkey:""};function Km(){setTimeout(Ws,1e3);}function Ws(){return ne(()=>{zp()&&(Xm(),Wm());})}function zm(){return !!document.querySelector(`.${zs}`)}async function Wm(){if(zm())return;const e=await H.waitElement("#layout div.layout-detail.service-detail .header div.content > div.bottom");if(!e)return;const t=Pn();if(!t)return;Pe.appkey=t;const n=document.createElement("div");Pe.el=n,e.appendChild(n),n.className=zs,n.style.color="#0009",n.style.fontSize="x-small",n.style.lineHeight="20px",n.innerHTML='<span style="cursor:pointer"><i class="mtdicon mtdicon-search"></i>服务额外信息</span>',n.addEventListener("click",Xs);}async function Xs(){const{el:e,appkey:t}=Pe;if(!e||!t)return;const n=await hc(t);e.innerText="活动标签："+(n.map(r=>`${r.tag}(${r.cell||"主干"})`).join(", ")||"无"),e.removeEventListener("click",Xs);}function Xm(){Pe.appkey&&Pe.appkey!==Pn()&&(Pe.el?.remove(),Pe.el=null,Pe.appkey="");}const Ym=()=>{const t=document.querySelector(".host-distribution .mtd-chart-con.distribution-graph:nth-child(2)")?.__vue__;return t?JSON.parse(JSON.stringify(t.data.rows)):[]},Qm=()=>{const e=Vr("SET");if(!e)return "default";const t=e.$children[0].value;return t==="-"?"default":t},Jm=()=>{const e=Vr("SET");if(!e)return "";const t=e.$children[0].value;return t==="-"?"":t},jr=()=>{const e=Vr("地域");if(!e)return [];const t=e.$children[0].$children[0].options,n=e.$children[0].value;return t.map(({label:r,value:o})=>({name:r.replace(/\(\d+\)/,""),isSelect:o===n,value:o}))},Zm=()=>jr().find(t=>t.isSelect)?.name||"";async function eh(...e){const t=".host-distribution .mtd-form.mtd-form-right .mtd-row";let n=null;await ie(1e3);const r=()=>{n&&n.disconnect();const o=document.querySelector(t);if(!o)return console.warn("未找到需要监控的表单行元素");let a=null;const s=()=>{a&&clearTimeout(a),a=setTimeout(()=>{a=null,e.forEach(i=>i()),r();},500);};n=new MutationObserver(i=>{i.some(l=>l.type==="attributes"&&l.attributeName==="placeholder")&&s();}),n.observe(o,{childList:true,subtree:true,attributes:true,attributeFilter:["placeholder"]});};r();}function Vr(e){const t=e.toLowerCase(),n=document.querySelectorAll(".host-distribution .mtd-form-item");for(const r of n){const o=r.__vue__,a=o.label;if(a&&a.toLowerCase().includes(t))return o}return null}const Ys=Q("HOST");async function pa(){nh();const e=document.querySelector(".host-distribution .drawer.v2 .layout-edit-content");if(!e)return console.warn("未找到 .layout-edit-content"),null;const t=Pn();if(!t)return console.warn("未获取到 appkey"),null;const n=Jm(),r=document.createElement("div");r.classList.add(Ys),th(r,`查询服务${n||"主干"}机器分布中...`),r.style.padding="12px 16px",r.style.backgroundColor="#f5f7fa",r.style.borderRadius="6px",r.style.marginBottom="16px",r.style.fontSize="14px",r.style.color="#606266",r.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.05)",e.appendChild(r);try{const o=await sc({appkey:t,cell:n||"-"});return o?(rh(r,o,n),o):(console.warn("未获取到 appkey 机器分布"),ma(r,"未获取到 appkey 机器分布"),null)}catch(o){return console.error("查询机器分布出错:",o),ma(r,"查询机器分布出错，请稍后重试"),null}}function th(e,t){const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="8px";const r=document.createElement("div");r.innerHTML='<style> @keyframes spin { 0% { transform:rotate(0deg);} 100% { transform:rotate(360deg);} } .loading-spinner { display:inline-block;width:16px;height:16px;border:2px solid rgba(96, 98, 102, 0.2);border-radius:50%;border-top-color:#409eff;animation:spin 1s linear infinite;} </style><div class="loading-spinner"></div>',r.style.display="inline-flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.width="16px",r.style.height="16px",r.style.marginTop="2px";const o=document.createElement("span");o.textContent=t,o.style.fontSize="14px",o.style.lineHeight="20px",n.appendChild(r),n.appendChild(o),e.appendChild(n);}function nh(){const e=document.querySelector(`.host-distribution .drawer.v2 .layout-edit-content .${Ys}`);e&&e.remove();}function rh(e,t,n){e.innerHTML="";const r=document.createElement("div");r.textContent=`服务${n||"主干"}机器分布详情`,r.style.fontFamily="PingFangSC-Medium",r.style.fontSize="14px",r.style.fontWeight="500",r.style.color="rgba(0, 0, 0, .9)",r.style.marginBottom="16px",r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",e.appendChild(r);const o=["#f9fafc","#f5f7fa","#fafafa","#f0f2f5"],a=["#1a1a1a","#0d5aa7","#006633","#8b2323"];let s=0;for(const i in t){const c=t[i];if(!Object.values(c).reduce((m,w)=>m+w,0))continue;const l=document.createElement("div");l.style.padding="4px 0",l.style.borderBottom="1px dashed #dcdfe6";const u=o[s%o.length],d=a[s%a.length];l.style.backgroundColor=u,l.style.padding="4px 4px",l.style.borderRadius="4px",l.style.marginBottom="4px",l.style.color=d,s++;const f=document.createElement("span");f.textContent=`${i==="-"?"<空>":i}: `,f.style.fontWeight="400",f.style.marginRight="8px",f.style.color=d,f.style.display="inline-block",f.style.minWidth="90px",l.appendChild(f);const p=document.createElement("div");if(p.style.display="inline-flex",p.style.flexWrap="wrap",p.style.gap="4px",p.style.verticalAlign="top",typeof c=="object"&&c!==null){const m=oh(c);Object.entries(m).forEach(([w,v])=>{const b=ah(w),C=document.createElement("div");C.style.display="inline-grid",C.style.gap="4px",C.style.marginRight="8px";const $=Object.values(v)?.length||1;C.style.gridTemplateColumns=`repeat(${$}, minmax(90px, 1fr))`,Object.entries(v).forEach(([O,L])=>{const T=document.createElement("span");T.textContent=`${O.replace(`${w}_`,"").replace("上海兴顺","兴顺")}:${L}`,T.style.display="inline-block",T.style.padding="1px 6px",T.style.backgroundColor=b.bg,T.style.color=L?b.text:"rgb(162 162 162 / 90%)",T.style.borderRadius="3px",T.style.fontSize="12px",T.style.border=`1px solid ${b.border}`,T.style.marginBottom="2px",L||(T.style.opacity="0.6"),C.appendChild(T);}),p.appendChild(C);});}else {const m=document.createElement("span");m.textContent=String(c),m.style.display="inline-block",m.style.padding="1px 6px",m.style.backgroundColor="#ecf5ff",m.style.color="#409eff",m.style.borderRadius="3px",m.style.fontSize="12px",m.style.border="1px solid #d9ecff",p.appendChild(m);}l.appendChild(p),e.appendChild(l);}return e}function oh(e){const t={};return Object.entries(e).forEach(([n,r])=>{const o=n.split("_")[0];t[o]||(t[o]={}),t[o][n]=r;}),t}function ah(e){const t=[{bg:"#ecf5ff",text:"#409eff",border:"#d9ecff"},{bg:"#f0f9eb",text:"#67c23a",border:"#e1f3d8"},{bg:"#fdf6ec",text:"#e6a23c",border:"#faecd8"},{bg:"#fef0f0",text:"#f56c6c",border:"#fde2e2"},{bg:"#f5f7fa",text:"#909399",border:"#e4e7ed"},{bg:"#f0f2f5",text:"#5a6d95",border:"#dcdfe6"}],n={北京:0,上海:1,广州:2,怀来:3,香港:4},r=n[e]!==void 0?n[e]:Math.abs(sh(e)%t.length);return t[r]}function sh(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}function ma(e,t){return e.innerHTML=t,e.style.color="#f56c6c",e}function ih(e){if(!e.length)return {isCompliant:true,totalHosts:0,maxAllowed:0,maxDeviation:0,minCost:0,suggestions:[]};const t=e.reduce((d,f)=>d+f.flow,0),n=e.length,r=Math.max(...e.map(d=>d.flow)),o=Math.floor(t*(1/Math.min(n,4))+r*.1),a=e.filter(d=>d.flow>o),s=e.filter(d=>d.flow<=o),i=e.reduce((d,f)=>d.flow>f.flow?d:f),c=Math.max(0,i.flow-o);if(a.length===0)return {isCompliant:true,totalHosts:t,maxAllowed:o,maxDeviation:c,minCost:0,suggestions:[]};const u=ch(a,s,o);return {isCompliant:false,totalHosts:t,maxAllowed:o,maxDeviation:c,minCost:u.totalMovements,suggestions:u.suggestions}}function ch(e,t,n){const r=[];let o=0;const a=[...t].map(s=>({...s,capacity:n-s.flow})).sort((s,i)=>i.capacity-s.capacity);for(const s of e){let c=s.flow-n;const l=a.find(u=>u.capacity>=c);if(l)r.push({from:s.type,to:l.type,count:c,fromCurrent:s.flow,toCurrent:l.flow}),l.flow+=c,l.capacity-=c,o+=c,c=0;else for(const u of a){if(c<=0)break;if(u.capacity<=0)continue;const d=Math.min(c,u.capacity);d>0&&(r.push({from:s.type,to:u.type,count:d,fromCurrent:s.flow,toCurrent:u.flow}),u.flow+=d,u.capacity-=d,c-=d,o+=d);}c>0&&(r.push({from:s.type,to:"需要新增机房",count:c,fromCurrent:s.flow,toCurrent:0}),o+=c);}return {suggestions:r,totalMovements:o}}function ha(e,t){if(!e.length||t<=0)return 0;const n=e.length,r=e.reduce((a,s)=>a+s.flow,0),o=Math.max(...e.map(a=>a.flow));if(t>n){const a=Math.floor(r*(1/Math.min(t,4))+o*.1);return e.filter(i=>i.flow>a).reduce((i,c)=>i+(c.flow-a),0)}else if(t<n){const a=[...e].sort((p,m)=>p.flow-m.flow),s=n-t,i=a.slice(0,s),c=a.slice(s),l=i.reduce((p,m)=>p+m.flow,0),u=c.length>0?Math.max(...c.map(p=>p.flow)):0,d=Math.floor(r*(1/Math.min(t,4))+u*.1),f=c.reduce((p,m)=>p+Math.max(0,m.flow-d),0);return l+f}else {const a=Math.floor(r*(1/Math.min(t,4))+o*.1);return e.filter(i=>i.flow>a).reduce((i,c)=>i+(c.flow-a),0)}}function lh(e,t){if(!e.length)return [];const n=e.reduce((i,c)=>i+c.flow,0),r=Math.max(...e.map(i=>i.flow)),o=Math.floor(n*(1/Math.min(t+1,4))+r*.1),a=[],s=e.filter(i=>i.flow>o);for(const i of s){const c=i.flow-o;c>0&&a.push({from:i.type,to:"「新机房」",count:c,fromCurrent:i.flow,toCurrent:0});}return a}function uh(e,t){if(!e.length||t<=1)return [];const n=e.reduce((d,f)=>d+f.flow,0),r=Math.max(...e.map(d=>d.flow)),o=Math.floor(n*(1/Math.min(t-1,4))+r*.1),a=[...e].sort((d,f)=>d.flow-f.flow),s=a[0],i=a.slice(1).map(d=>({...d})),c=[];if(s.flow>0){let d=s.flow;for(const f of i){if(d<=0)break;const p=o-f.flow;if(p>0){const m=Math.min(d,p);c.push({from:s.type,to:f.type,count:m,fromCurrent:s.flow,toCurrent:f.flow}),f.flow+=m,d-=m;}}}const l=i.filter(d=>d.flow>o),u=i.filter(d=>d.flow<=o);for(const d of l){let p=d.flow-o;const m=u.find(w=>o-w.flow>=p);if(m)c.push({from:d.type,to:m.type,count:p,fromCurrent:d.flow,toCurrent:m.flow}),m.flow+=p;else for(const w of u){if(p<=0)break;const v=o-w.flow;if(v>0){const b=Math.min(p,v);c.push({from:d.type,to:w.type,count:b,fromCurrent:d.flow,toCurrent:w.flow}),w.flow+=b,p-=b;}}}return c}const Qs=Q("ADD"),Gr=".host-distribution .drawer.v2 .layout-edit-content",dh=e=>`
  margin-bottom: 10px;
  padding: 12px 16px;
  border: 1px solid #e1e6eb;
  border-left: 4px solid ${e?"#ed9c9c":"#1890ff"};
  border-radius: 6px;
  background-color: #f8fafc;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  font-size: 14px;
  line-height: 1.5;
`,fh=()=>!!document.querySelector(Gr);async function ga(){yh();const e=document.querySelector(Gr);if(!e)return console.warn("未找到 .layout-edit-content");const t=ph();if(!t)return;const n=await kh(t);if(!n)return console.warn(`未获取到容灾等级信息: ${n}`);const r=mh(n,t);gh(e,r);}function ph(){const e=jr();return e.length===1?e[0].name:Zm()}function mh(e,t){const{capacity:n,maxHost:r,minHost:o,idcCnt:a,currentMax:s,currentMaxStr:i,subIdcMaxStr:c,subIdcMax:l,addIdcMaxStr:u,addIdcMax:d,hostList:f}=e,{region:p,isWhite:m,reason:w,updateTime:v,level:b}=n,C=Math.ceil(s)<r.flow,$=document.createElement("div");$.classList.add(Qs),$.style.cssText=dh(C),Ze($,`${p}, 容灾等级：${b}${m?"(加白)":""}; 原因：${w} [${v}]`),Ze($,"容灾治理方案：");let L=`🔍 当前机房最大部署上限：${i} = ${s}，`,T=0;if(C){if(L+=`超出❌(${r.flow-Math.ceil(s)}台)`,f&&f.length>1){const V=ih(f);if(!V.isCompliant&&V.suggestions.length>0){const Ee=V.suggestions.filter(Ue=>Ue.to!=="需要新增机房");if(Ee.length>0){const Ue=Ee.map(ae=>{const ht=ae.from.replace(/^[^_]+_/,""),gt=ae.to.replace(/^[^_]+_/,"");return `${ht} → ${gt} [${ae.count}台]`});T=V.minCost,L+=`，最小迁移成本：${T}台，治理建议：${Ue.join(", ")}`;}}}}else L+="未超过✅";Ze($,L);let J=0;if(a>=4){J=ha(f,a-1);let V=`📉 减少一个机房部署后，单机房部署上限：${c} = ${l}`;if(J>0){const Ee=uh(f,a);if(V+=`，最小迁移成本：${J}台`,Ee.length>0){const Ue=Ee.map(ae=>{const ht=ae.from.replace(/^[^_]+_/,""),gt=ae.to.replace(/^[^_]+_/,"");return `${ht} → ${gt} [${ae.count}台]`});V+=`，治理建议：${Ue.join(", ")}`;}}else V+="，已达标";Ze($,V);}let z=0;if(hh(t,a)){z=ha(f,a+1);let V=`📈 增加一个机房部署后，单机房部署上限：${u} = ${d}`;if(z>0){const Ee=lh(f,a);if(V+=`，最小迁移成本: ${z}台`,Ee.length>0){const Ue=Ee.map(ae=>{const ht=ae.from.replace(/^[^_]+_/,""),gt=ae.to==="[新机房]"?"[新机房]":ae.to.replace(/^[^_]+_/,"");return `${ht} → ${gt} [${ae.count}台]`});V+=`，治理建议: ${Ue.join(", ")}`;}}else V+="，已达标";Ze($,V);}const j=[T,J,z].filter(V=>V>0),W=j.length>0?Math.min(...j):0,De=W>0?`，最小迁移成本：${W}台`:"";return Ze($,`最多机房：${r.type}(${r.flow})，最少机房：${o.type}(${o.flow})${De}`),$}function Ze(e,t){const n=document.createElement("div");n.textContent=t,e.appendChild(n);}function hh(e,t){return e==="北京"&&t<5||e==="上海"&&t<4}function gh(e,t){const n=e.querySelector(".overview-graph");n?.nextSibling?e.insertBefore(t,n.nextSibling):n?n.insertAdjacentElement("afterend",t):e.appendChild(t);}function yh(){document.querySelector(`${Gr} .${Qs}`)?.remove();}async function bh(){const e=Pn();if(!e)return null;const t=await Sr(e);if(!t)return null;const n=new Map,{capacityLevels:r,isStandard:o,defaultCapacityLevel:a,standardCapacityLevel:s}=t;r.forEach(u=>{n.set(`${u.regionName}-${u.cellName}`,{isWhite:u.isWhite,region:u.regionName,reason:u.standardReason,updateTime:u.updateTime,level:`${u.capacityLevel}/${u.standardLevel}`});});const i=Number(String(a).replace(/\D+/,"")),c=Number(String(s).replace(/\D+/,""));return [!o||o&&i<c,n]}function wh(){const e=new Map;return jr().forEach(({name:t})=>{e.set(t,[]);}),Ym().forEach(t=>{const n=t.type.replace(/_.*$/,"");e.get(n)?.push(t);}),e}function vh(e,t,n){const r=a=>Math.round(10*(e*(1/Math.min(a,4))+n*.1))/10,o=a=>`${e} * (1 / MIN(${a}, 4)) + ${n} * 0.1`;return {currentMax:r(t),addIdcMax:r(t+1),subIdcMax:t>1?r(t-1):0,currentMaxStr:o(t),addIdcMaxStr:o(t+1),subIdcMaxStr:o(t-1)}}async function kh(e){const t=await bh();if(!t)return null;const[n,r]=t;if(!n)return null;const o=r.get(`${e}-${Qm()}`);if(!o)return null;const a=wh().get(e);if(!a?.length)return null;const s=a.reduce((l,u)=>l.flow>u.flow?l:u),i=a.reduce((l,u)=>l.flow<u.flow?l:u),c=a.reduce((l,u)=>l+u.flow,0);return {capacity:o,maxHost:s,minHost:i,idcCnt:a.length,hostList:a,...vh(c,a.length,s.flow)}}const _h=[100,1e3,3e3,6e3],Ch=500,Js=".onecloud-content-wrapper .service-detail-host .filter-query .advanced",xh=[".host-distribution .basic-info-container .basic-info { margin-right: 21px !important; }",".host-distribution .basic-info-container { zoom: 0.9 !important; }"];let Nt=[],mr=null,Yt=null;function Sh(){Ah(),_h.forEach(e=>{const t=setTimeout(Kr,e);Nt.push(()=>clearTimeout(t));});}const $h=()=>{mr=null,setTimeout(()=>Kr(),200);};function Eh(){const e=Array.from(document.querySelectorAll(Js));for(const t of e)if(t.textContent&&t.textContent.includes("资源分析"))return t;return null}function Ah(){Yt?.disconnect();const e=document.body;if(!e)return;let t=null;const n=()=>{t&&clearTimeout(t),t=setTimeout(()=>{Kr();},200);};Yt=new MutationObserver(r=>{r.some(a=>a.type==="childList"?Array.from(a.addedNodes).some(i=>{if(i.nodeType===Node.ELEMENT_NODE){const c=i;return c.querySelector&&c.querySelector(Js)}return  false}):false)&&n();}),Yt.observe(e,{childList:true,subtree:true}),Nt.push(()=>{t&&clearTimeout(t),Yt?.disconnect();});}function Kr(){ne(async()=>{await ie(400);const e=Eh();e&&e!==mr&&(Th(e),mr=e);});}function Th(e){e.removeEventListener("click",ya),e.addEventListener("click",ya);}function ya(){ne(async()=>{if(await ie(100),!fh()){console.warn("[Avatar Host] 容量优化显示失败，目标未准备好");return}M.avatar.moduleView("b_op_capacity_mv");const e=setTimeout(()=>{pa(),ga(),eh(ga,pa);},Ch);Nt.push(()=>clearTimeout(e));});}function Ph(){Nt.forEach(e=>e()),Nt=[];}typeof window<"u"&&window.addEventListener("beforeunload",Ph);let Qt=null,ba=false;const Zs=".service-move > .layout-edit-header > .layout-edit-header-operations",Ih=".content .dest-form>.hulk>.apply-normal",ei="mt-resource-refresh-btn__host_expand",ti=".layout-edit-header-title",Nh="主机扩容",Lh=300;function Rh(){const e=document.createElement("button");return e.id=ei,e.innerHTML='<i class="mtdicon mtdicon-refresh-o refresh"></i> 刷新',e.classList.add("mtd-btn"),e.onclick=()=>{document.querySelector(Ih)?.__vue__?.checkBudget();},e}function ni(){return document.getElementById(ei)}function Mh(){return document.querySelector(ti)?.textContent?.includes(Nh)??false}function Oh(){if(ni())return;const t=document.querySelector(Zs);if(!t)return;const n=Rh();t.insertBefore(n,t.firstChild),console.info("[Resource Available] 刷新按钮已添加到主机扩容页面");}function qh(){const e=ni();e&&e.parentNode&&(e.parentNode.removeChild(e),console.info("[Resource Available] 刷新按钮已移除"));}const ri=xs(()=>{ne(async()=>{await ie(500),Mh()?Oh():qh();});},Lh);function Hh(){Qt&&Qt.disconnect();const e=document.body;e&&(Qt=new MutationObserver(t=>{t.some(r=>r.type==="childList"?Array.from(r.addedNodes).some(a=>{if(a.nodeType===Node.ELEMENT_NODE){const s=a;return s.querySelector(ti)||s.querySelector(Zs)}return  false}):false)&&ri();}),Qt.observe(e,{childList:true,subtree:true,attributes:true,attributeFilter:["class"]}));}function Dh(){ba||setTimeout(()=>{ba=true,ri(),Hh();},1e3);}function Uh(){Fr()&&(Dh(),qm(),Km(),Lm(),Sh(),gm({styles:[...Om,...xh,...Pm],routeChange:[Ws,$h,Ks],xhrInterceptor:[...ym(),...Cm(),...Bm()]}));}function Bh(){Fp()&&ke(".mtd-modal-content .vue-codemirror .CodeMirror { height:100%;}");}const oi=Q("INVALID_NOTICE");function Fh(e){const t=typeof e=="string"?JSON.parse(e):e,{diff:n=""}=t?.result?.payload||{};if(!n)return t;const o=Kh(n).filter(a=>a.isWrite).filter(a=>!Vh(a.location,a.matches));return ne(()=>{jh(o);}),t}async function jh(e){if(!e.length||wa())return;await H.waitElement(".mission-detail .mtd-tab-pane .approve-detail",100,30);const t=document.querySelector("#app .mission-detail .mtd-tab-pane .approve-detail");if(!t)return;const n=[...new Set(e.map(o=>o.location))],r=`<div class='mtd-announcement mtd-announcement-error ${oi}' style="margin-bottom:5px">
  <div class="mtd-announcement-content"><div class="mtd-announcement-title">
  <i class="mtd-message-icon mtdicon-error-circle"></i>
  <span style="color:red"><strong>【Location Rewrite 异常】</strong>
  ${n.join()} 无法匹配内容, 可能导致异常转发流量!!! </span>
  <span style="font-size:10px;margin-left:10px;font-style:italic;color:magenta;">--来自浏览器提效插件检查</span>
  </div></div>`;wa()||t.insertAdjacentHTML("afterbegin",r);}function wa(){return !!document.querySelector(`.${oi}`)}function Vh(e,t){if(!t.length)return  false;const n=e.split(/\s+/).pop()||"";if(n.startsWith("@jump_to_error"))return  true;const r=ka(n)||e.startsWith("~");for(const o of t){const a=ka(o);if(r){if(a){if(n===o||Gh(n,o))return  true}else if(_a(o,n))return  true;continue}if(a){if(_a(n,o))return  true;continue}if(va(n)===va(o)||n.startsWith(o))return  true}return  false}function va(e){return e.replace(/^\^/,"").replace(/\$$/,"")}function ka(e){return e.includes(".*")||e.includes("\\d+")||e.includes("\\w+")||e.startsWith("~")||e.startsWith("^")}function Gh(e,t){const n=e.replace(/^\^/,"").replace(/\$$/,"")||"",r=t.replace(/^\^/,"").replace(/\$$/,""),o=new RegExp(n),a=new RegExp(r);return o.test(r)&&a.test(n)}function _a(e,t){return t.replace(/^\^/,"").startsWith(e)?true:new RegExp(t).test(e)}function Kh(e){const t=[];if(!e)return t;const n=e.split(`
`);let r=null,o=false;for(const a of n){if(!a.startsWith("+")&&!a.startsWith("-"))continue;const s=a.startsWith("+"),i=a.substring(1).trim();if(i.startsWith("location"))if(r&&o&&t.push(r),s){const c=i.match(/location[\s=]+([^\s{]+)\s*{/);c&&(r={location:c[1]?.trim(),matches:[],isWrite:false},o=true);}else o=false,r=null;if(o&&r&&s&&i.includes("rewrite")){const c=i.match(/rewrite\s+(\S+)\s+/);c&&(r.matches.push(c[1]?.trim()),r.isWrite=true);}}return r&&o&&t.push(r),t}const $t={ngx:[]},zh=["流程ID","站点名称","申请资源"],ai=Q("ORG_PATH"),si=Q("NGX_INFO");function Wh(e){const t=new URLSearchParams(e),n=t.get("corp"),r=t.get("owt"),o=t.get("pdl"),a=t.get("srv");return n&&r&&o&&a?`${n}.${r}.${o}.${a}`:""}function Xh(){const e=document.querySelector(".itu-info-item");if(!e||ii())return;const t=e.querySelectorAll(".cluster-tag");if(t.length){for(const n of Array.from(t)){const o=n.querySelector(".cluster-link")?.textContent?.trim()||"",a=$t.ngx.find(p=>p.ngx_name===o);if(!a)continue;const{addr:s,appkey:i}=a,l=`https://ark.sankuai.com/#/cluster/${Wh(s)}/info`,u=`https://raptor.mws.sankuai.com/alarm/application?appkey=${i}&category=hosts`,d=`
    <span class="${si}" style="padding-right:2px;margin:0 0 5px 5px;">
      ${i}<a style="user-select:none;padding-left:4px;" target=_blank href=${u}>告警配置<i class="mtdicon-link-o"></i></a> | 
      <a style="user-select:none;" target=_blank href=${l}>Ark<i class="mtdicon-link-o"></i></a>
    </span>`,f=n.querySelector(".itu-tag");f?.insertAdjacentHTML&&f.insertAdjacentHTML("afterend",d);}e.parentNode.classList.add("mtd-col-8");}}async function Yh(e){return (typeof e=="string"?JSON.parse(e):e)?.code===0&&ne(()=>{window.location.reload();}),e}function hr(){ne(async()=>{if(location.pathname==="/site_detail"&&!ii())for(let e=0;e<3;e++){if(new URL(location.href).searchParams.get("tab")==="cluster-config"){const n=new URL(location.href).searchParams.get("site_id");return !$t.ngx.length&&n&&await fetch(`${location.origin}/api/v2/site/${n}?tm=1234`).then(r=>r.json()).then(r=>$t.ngx=r.result.ngx_list),await H.waitElement(".mtd-tag-content .cluster-link",20,200),$t.ngx.length?Xh():void 0}await ie(100);}});}function Qh(e){const t=typeof e=="string"?JSON.parse(e):e;return $t.ngx=t.result.ngx_list,ne(hr),t}function Jh(e){const t=typeof e=="string"?JSON.parse(e):e,{applicant:n}=t.result||{};if(n){if(Wn())return;_e(n).then(r=>{const{orgNamePath:o}=r||{};o&&ne(async()=>{if(Wn())return;const a=await H.waitElement(".approve-detail .itu-infos-title :first-child",200,100);if(!a)return;const s=document.createElement("span");s.className=`itu-info-item-value ${ai}`,s.style.border="1px solid blue",s.style.borderRadius="3px",s.style.marginLeft="10px",s.style.padding="3px 6px",s.style.fontSize="12px",s.style.color="#666";const i=o.split("/").slice(-4).join("/");s.textContent=`申请人部门：${i}`,Wn()||a.appendChild(s);});});}return t}function Zh(e){const t=typeof e=="string"?JSON.parse(e):e,{result:n=[]}=t;return n.some(o=>zh.some(a=>o?.key.includes(a)))&&(M.oceanus.moduleView("b_op_workflow_oceanus_mv"),ne(async()=>{await H.waitElement(".mtd-tab-pane .itu-infos-view> .itu-info-row .itu-info-item",200,100);const o=document.querySelectorAll(".mtd-tab-pane .itu-infos-view> .itu-info-row .itu-info-item");for(const a of Array.from(o)){const s=a.textContent?.trim()||"";if(s.includes("流程ID")){const i=Ca(a);if(!i){console.warn("流程ID为空");continue}const c=a.querySelector(".itu-info-item-value > .mtd-tooltip-rel > span");if(!c){console.warn("查询流程span元素异常");continue}const l=document.createElement("a");l.href=`${location.origin}/mission-detail?uuid=${i}`,l.textContent=i,l.target="_blank",l.addEventListener("click",()=>{M.oceanus.moduleClick("b_op_workflow_oceanus_mc");}),c.parentNode?.replaceChild(l,c);continue}if(s.includes("站点名称")||s.includes("申请资源")){const i=Ca(a);if(!i){console.warn("siteName为空");continue}const c=await eg(i);if(!c){console.warn(`查询siteName信息为空, 可能站点 ${i} 已经下线`);continue}const l=a.querySelector(".itu-info-item-value > .mtd-tooltip-rel > span");if(!l){console.warn("查询站点span元素异常");continue}const u=document.createElement("a"),d=c.id;u.href=`${location.origin}/site_detail?site_name=${i}&site_id=${d}&from=all_site`,u.textContent=i,u.target="_blank",u.addEventListener("click",()=>{M.oceanus.moduleClick("b_op_workflow_oceanus_mc");}),l.parentNode?.replaceChild(u,l);continue}}})),t}function Ca(e){return e.querySelector(".itu-info-item-value")?.textContent?.trim()||null}async function eg(e){const{origin:t}=location,n=new URL(`${t}/api/v2/sites`);n.searchParams.append("@domain",e),n.searchParams.append("currentPage","1"),n.searchParams.append("limit","30"),n.searchParams.append("offset","0");const r=await fetch(n,{method:"GET"}),{result:o}=await r.json();return o.items?.find(s=>s.site_name===e||s.domains.some(i=>i.domain===e))||null}function Wn(){return !!document.querySelector(`.${ai}`)}function ii(){return !!document.querySelector(`.${si}`)}function tg(){if(!Kp())return;hr(),mt(hr),rg();const e=location.origin,t="/api/v2/workflow/mission/",n="/api/v2/workflow/mission/other-info/";new le([{url:new RegExp(`^${e}${n}[-\\w\\d]{36,}`),lastCallback:Zh,method:"GET"},{url:new RegExp(`^${e}${t}[-\\w\\d]{36,}`),lastCallback:Jh,method:"GET"},{url:new RegExp(`^${e}${t}[-\\w\\d]{36,}`),callback:Fh,method:"GET"},{url:new RegExp(`^${e}/api/v2/site/\\d+(\\?siteId=\\d+)?$`),callback:Qh,method:"GET"},{url:`${e}/api/v2/pool/locationOwner`,lastCallback:ng,method:"GET"},{url:`${e}/api/v2/workflow/mission/next`,lastCallback:Yh,method:"PUT"}]),H.waitElement("#app > div.mission-detail .itu-header-main > div.itu-header-operate").then(r=>{r?.firstChild?.classList.add("mtd-btn-ghost");});}function ng(e,t){const n=typeof e=="string"?JSON.parse(e):e;if(!n.result?.length){const r=t.url,a=new URL(r).searchParams.get("appkey");a?.trim()&&(n.result=[a?.trim()]);}return n}function rg(){const e="body>.approval-modal>.mtd-modal-wrapper.mtd-modal-center>.mtd-modal>.mtd-modal-footer>.confirm-footer{display:flex;flex-direction:row-reverse;justify-content:flex-end;gap:10px;}",t=document.createElement("style");t.appendChild(document.createTextNode(e)),document.head.appendChild(t);}const og="https://img.meituan.net/0.0.o/diegooacommunciationpublic/20833f83863b6e030848d173bd07a8af1549.png";function ag(){const e=document.querySelector('#root div[class^="rooms-item-wrapper"] > div[class^="filter-time-area"]'),t=document.querySelector('div[class^="room-item"] > div[class^="hour-block"]');if(!e||!t)return {};const n=Dn(t.style.height),{top:r,height:o}=e.style,a=Dn(r)/n,s=Dn(o)/n;return {start:a,duration:s}}async function sg(){const{host:e,pathname:t}=location;if(e!=="calendar.sankuai.com"||!/^\/rooms/.test(t))return;await ie(1e3),await H.waitElement('div[class^="rooms-list"]',100,40,false);const n=document.querySelector("#root button[class^=refresh-btn___]");let r=null,o=false;function a(i){const c=typeof i=="string"?JSON.parse(i):i;if(!c?.data.length)return;const{start:l,duration:u}=ag();if(!l||!u)return;c.data[0].appointmentVOS.some(p=>ig(p,l,u))?(r&&(clearTimeout(r),r=null),s(l)):(o=true,er({timeout:3e4,title:"会议室查询",text:"已查询到目前时间会议室, 请及时预定",image:og}));}function s(i){r||(r=setTimeout(()=>{n?.click(),o||s(i);},ir(1,5)+lg(i)));}new le({url:"https://calendar.sankuai.com/meeting/api/pc/room/appointment/findRoomAppointmentsV2",method:"POST",callback:a});}function ig(e,t,n){const{startTime:r,endTime:o}=e,a=cg(r),s=ug(r,o);return !(a>=t+n||a+s<=t)}function cg(e){const t=new Date(e);return t.getHours()+t.getMinutes()/60}function lg(e){if(!e)return 0;const t=new Date().getHours()+new Date().getMinutes()/60,n=e-t;return n>.6?ir(3,10):n>.3?ir(1,4):0}function ug(e,t){return (t-e)/(1e3*60*60)}const dg=".pk-drawio",fg=".pk-minder",xa="__pkDrawioClicked";function pg(){mg();}function Sa(e,t){return t.find(n=>n instanceof Element&&n.matches(e))}function mg(){document.addEventListener("click",e=>{if(!hg())return;const t=e.composedPath(),n=Sa(dg,t)||Sa(fg,t);if(n){const r=new CustomEvent(xa,{bubbles:true,composed:true});n.dispatchEvent(r);}}),document.addEventListener(xa,e=>{e.target?.click();});}function hg(){const{host:e,pathname:t}=location;return !(e!=="km.sankuai.com"||!/^\/(collabpage|page)\/\d+.*/.test(t))}async function gg(){Us()&&new le({url:new RegExp(`${location.origin}/api/collaboration/xtable/\\d+/meta`),lastCallback:yg,method:"GET"});}function yg(e,t){const n=typeof e=="string"?JSON.parse(e):e,r=[];if(n?.data?.columns?.length){const o=n.data?.models||[];n.data.columns.forEach(a=>{a?.config==="null"&&(a.config=null,r.push({name:a.name,id:a.id,deleted:a.deleted===1,hidden:wg(o,a.id)}),a.deleted=0);});}return r.length&&setTimeout(()=>{const o=t.url.pathname.match(/\/(\d+)\/meta/)?.[1],a=bg(o);A.warning(`文档多维表格中有插件历史版本产生的脏数据，列【${r.map(s=>`${s.name}${s.hidden?" (隐藏列)":""}${s.deleted?" [已删除,临时展示]":""}`).join(", ")}】辛苦在对应列操作“编辑此列”保存即可修复。（如未安装学城提效脚本多维表格将显示异常！）
位置: ${a||"无"}`,3e4,"km"),a&&window.open(a,"_self");},1e3),n}function bg(e){if(!e)return null;const t=document.querySelector(`.ct-node-view-dom[data-xtable-id="${e}"]`);if(!t)return null;const n=t.dataset.nodeId;return n?`${Ci()}#b-${n}`:null}function wg(e,t){return e?.length?e.some(n=>JSON.parse(n.config||"{}")?.colInfos?.[t]?.hidden):false}const _t={id:null,site:null,isTest:false,isTarget:false},$a=2721293014;async function vg(){if(!Us()||location.pathname!==`/collabpage/${$a}`)return;const e=new URL(location.href),t=e.searchParams.get("km_custom_option"),n=e.searchParams.get("id"),r=e.searchParams.get("dev"),o=e.searchParams.get("st");t&&n&&o?(_t.id=Number(n),_t.site=o,_t.isTarget=true):_t.isTest=!!r,new le({url:`${location.origin}/api/docs/recent/${$a}`,lastCallback:kg,method:"GET"});}async function kg(e){const t=typeof e=="string"?JSON.parse(e):e,{id:n,site:r,isTarget:o,isTest:a}=_t;if(o&&n&&r){const s=await Xc(r,n).catch(()=>null);s&&(t.data.body=s,_g());}else if(a){const s=await Yc().catch(()=>null);s&&(t.data.body=JSON.stringify(s));}return t}function _g(){const e=document.createElement("style");e.innerHTML='.ct-editor[id*="editor-"]{padding-top:0 !important;}.ProseMirror{padding:0 30px 30px 42px !important;}',document.head.appendChild(e);}const Cg="__yuntu_exclude_space__",xg=(()=>{let e="";return ()=>(e||(e=JSON.parse(sessionStorage.getItem("CUR_USER_INFO")||"{}").login),e)})(),Sg=xe(Cg,[]);function $g(){if(!Ur())return;const e=location.origin;new le([{url:`${e}/api/proxy/atlas/space/directories`,lastCallback:Eg,method:"GET"}]);}function Eg(e){const t=typeof e=="string"?JSON.parse(e):e;for(const n of t.data){const{name:r,owner:o,scope:a}=n;a==="shared"&&o!==xg()&&(n.name=`${r} (${o})`);}return t.data=t.data.filter(n=>!Sg.includes(n.id)),t}const Ea=["SELECT","FROM","WHERE","AND","OR","INSERT","UPDATE","DELETE","CREATE","TABLE","DROP","ALTER","INDEX","VIEW","GROUP BY","ORDER BY","HAVING","JOIN","INNER JOIN","LEFT JOIN","RIGHT JOIN","FULL JOIN","UNION","ALL","AS","DISTINCT","TOP","LIMIT","OFFSET","INTO"];let Xn=false;function ci(){if(!(!editorMap||!editorMap["sql-config"])&&!editorMap["sql-config"]?.state?.keyMaps?.length){if(Xn)return Aa();if(!Xn){Xn=true;const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/codemirror@5.65.9/addon/comment/comment.min.js",document.head.appendChild(e),e.onload=()=>{Aa();};}}}function Aa(){editorMap["sql-config"].setOption("extraKeys",{Tab:function(e){const t=e.getOption("indentUnit"),n=Array((t||2)+1).join(" ");e.replaceSelection(n);},"Ctrl-.":"autocomplete","Cmd-.":"autocomplete",Space:function(e){const t=e.getCursor(),r=e.getLine(t.line).slice(0,t.ch)?.split(/\s+/)?.pop()?.toUpperCase()||"";if(Ea.includes(r)){const o={line:t.line,ch:t.ch-r.length};e.replaceRange(r+" ",o,t);}else e.replaceSelection(" ");}}),editorMap["sql-config"].on("inputRead",function(e,t){if(t.text[0]===" "||t.text[0]===`
`){const n=e.getCursor(),o=e.getLine(n.line)?.slice(0,n.ch-1)?.split(/\s+/)?.pop()?.toUpperCase()||"";if(Ea.includes(o)){const a={line:n.line,ch:n.ch-o.length-1};e.replaceRange(o+t.text[0],a,n);}}}),editorMap["sql-config"].addKeyMap({"Cmd-/":e=>e?.toggleComment({lineComment:"--"}),"Ctrl-/":e=>e?.toggleComment({lineComment:"--"}),"Alt-Up":e=>Ta(e,-1),"Alt-Down":e=>Ta(e,1),"Shift-Alt-Up":e=>Pa(e,-1),"Shift-Alt-Down":e=>Pa(e,1),"Shift-Cmd-K":Ia,"Shift-Ctrl-K":Ia,"Cmd-Enter":e=>Na(e,1),"Shift-Cmd-Enter":e=>Na(e,-1),"Ctrl-J":e=>Tg(e)});}function Ag(e){const t=e.listSelections();if(t.length===0)return  false;const n=t[0];return !(!n.empty()||n.to().ch!==0||n.from().ch!==0||e.getLine(n.from().line).length===0)}function Ta(e,t){const n=e.listSelections();if(n.length===0)return;const r=Ag(e),o=n.map(a=>({from:a.from().line,to:a.to().line+(a.to().ch===0&&!r?0:1)}));e.operation(()=>{for(const{from:a,to:s}of o){const i=e.getRange({line:a,ch:0},{line:s,ch:0});e.replaceRange("",{line:a,ch:0},{line:s,ch:0});const c=a+t;e.replaceRange(i,{line:c,ch:0}),e.setSelection({line:c,ch:0},{line:c+(s-a-(r?1:0)),ch:0});}}),e.save();}function Pa(e,t){const n=e.listSelections();n.length!==0&&e.operation(()=>{const r=n.map(o=>{const a=o.from(),s=o.to();if(o.empty()){const i=e.getLine(a.line),c={line:a.line+(t>0?1:0),ch:0};return e.replaceRange(i+`
`,c),{anchor:{line:c.line,ch:a.ch},head:{line:c.line,ch:a.ch}}}else {const i=e.getRange({line:a.line,ch:0},{line:s.line+1,ch:0}),c={line:t>0?s.line+1:a.line,ch:0};e.replaceRange(i,c);const l=s.line-a.line+1;return {anchor:{line:c.line,ch:a.ch},head:{line:c.line+l-1,ch:s.ch}}}});e.setSelections(r),e.save();});}function Ia(e){e.operation(()=>{const t=e.listSelections();for(const n of t.reverse()){const r=n.from(),o=n.to();if(n.empty()){const a=r.line;e.replaceRange("",{line:a,ch:0},{line:a+1,ch:0});}else e.replaceRange("",{line:r.line,ch:0},{line:o.line+1,ch:0});}}),e.save();}function Na(e,t){e.operation(()=>{const n=e.getCursor(),r=e.getLine(n.line),o=r?.match(/^\s*/)?.[0]||"";t===1?(e.replaceRange(`
`+o,{line:n.line,ch:r.length}),e.setCursor({line:n.line+1,ch:o.length})):(e.replaceRange(o+`
`,{line:n.line,ch:0}),e.setCursor({line:n.line,ch:o.length}));}),e.save();}function Tg(e){const n=e.getCursor().line,r=n+1,o=e.getLine(n),a=e.getLine(r);if(a!==void 0){const s=o.trimEnd()+" "+a.trimStart();e.replaceRange(s,{line:n,ch:0},{line:r,ch:a.length}),e.setCursor({line:n,ch:s.length});}e.save();}const Et=Q("KET_BOARD");async function Pg(){Ds()&&(ke(".CodeMirror.CodeMirror-wrap { resize: vertical !important; }"),ke("::-webkit-scrollbar { height: 4px !important;"),ke("#preView_dataTable_wrapper table#preView_dataTable tr > th { min-width: 100px !important;}"),ke(".fa-table{position:relative;} .main.container .widget-version{height:calc(100% - 132px) !important;} .fa-table:hover::after{content:attr(data-tooltip);position:absolute;font-size:xx-small;scale:0.8;top:-190%;transform:translateX(-50%);background-color:#000;color:#fff;padding:5px;border-radius:5px;white-space:nowrap;} tbody.table-metas>:first-child .fa-table:hover::after{top:100%;}"),ke(`#sql-config .sql-tool-panel .${Et}{position:relative;} #sql-config .sql-tool-panel .${Et}:hover::after{display:block;width:260px;} #sql-config .sql-tool-panel .${Et}::after{ content:attr(data-tooltip);position:absolute;top:100%;left:50%;transform:translateX(-50%);background-color:#333c;color:#fff;padding:5px;border-radius:4px;font-size:12px;white-space:pre-line;line-height:normal;display:none;z-index:1000;}`),await H.waitElement(".main.container",30,200,false),Lg(),Hg(),Mg(),Ng(),Ig(),M.yuntu.moduleView("b_op_edit_mv"));}async function Ig(){await H.waitElement(".main.container",30,200,false);const e=document.querySelector(".main.container");e&&e.addEventListener("click",t=>{const n=t.target;n&&n.classList.contains("btn-next")&&setTimeout(()=>{document.querySelector("#data-config.active")&&ci();},300);});}async function Ng(){await H.waitElement(".main.container .config-module .form-group",30,200,false);const e=document.querySelector("div.main.container > .main-content.row .config-module");if(!e)return;const n=!!document.querySelector(".config-module .form-group .btn-next")?'<button class="btn btn-default btn-next" style="margin-right: 10px">下一步</button>':"";document.querySelector(" .main-content.row .config-module > .form-group")?.remove();const o=ye(`<div class="form-group" style="position:absolute;top:-60px;left:480px;width:initial;margin:0;">
    ${n}
    <button class="btn btn-default btn-preView" style="margin-right: 10px">预览</button>
    <button class="btn btn-default btn-deploy-version" style="margin-right: 10px;display: none">上线</button>
    <button class="btn btn-default btn-save-new-version" style="margin-right: 10px;display: none">存为新版本</button>
    <button class="btn btn-default btn-sure btn-save-and-deploy-version" style="margin-right: 10px;display: none">保存并上线</button>
  </div>`);e.insertBefore(o,e.firstChild);}function Lg(){const e=document.querySelector(".main.container");e.style.width="100%",e.style.marginLeft="0",document.querySelector("#header").style.display="none";const t=document.querySelector("#data-config");t&&(t.addEventListener("click",function(){setTimeout(ci,300);}),setTimeout(()=>{t.click();},100));const n=document.querySelector(".main-content.row"),r=n.querySelector(".config-module");r.classList.add("col-sm-10"),r.classList.remove("col-sm-8"),r.querySelector(".sql-config .form-group label").style.display="none";const o=r.querySelector(".sql-config .form-group div");o.classList.add("col-sm-14"),o.classList.remove("col-sm-9");const a=o.querySelector(".CodeMirror");a&&(a.style.resize="vertical");const s=n.querySelector(".datasource-meta");s.classList.add("col-sm-2"),s.classList.remove("col-sm-4"),document.querySelector("footer").style.display="none";const i=document.querySelector("#notie-alert-outer").style;i.width="450px",i.left="50%",i.transform="translateX(-50%)";const c=document.querySelector(".main.container .crumbs");c.style.willChange="transform",c.style.marginBottom="10px";const l=document.querySelector(".widget-version");if(l?.querySelector(".collapse-btn")?.remove(),!Bp()&&l){l.style.display="none";const p=document.createElement("button");p.innerHTML="展开历史版本",p.style.fontSize="smaller",p.style.marginLeft="16x",p.addEventListener("click",function(){M.yuntu.moduleView("b_op_edit_mc"),l?.style.display==="none"?(l.style.display="inherit",e.style.marginLeft="290px",e.style.width="calc(100% - 290px)",p.innerHTML="折叠历史版本",c.style.transform="translateX(-290px)"):(l&&(l.style.display="none"),e.style.marginLeft="0",e.style.width="100%",p.innerHTML="展开历史版本",c.style.transform="");}),c.appendChild(p);}const d=document.querySelector("#sql-config .sql-tool-panel");if(d&&!d.querySelector(`.${Et}`)){const p=ye(`<i class="mtdicon-keyboard ${Et}" style="padding-right:20px;font-size:12px;cursor:pointer;">快捷键</i>`),m=Rg();p.setAttribute("data-tooltip",m),d.insertBefore(p,d.firstChild);}const f=e.querySelector(".back-to-dash");f&&(f.style.display="inline",f.style.marginLeft="10px",c.appendChild(f));}function Rg(){const e=bt()?"⌘":"Ctrl",t=bt()?"⌥":"Alt",n=bt()?"⇧":"Shift",r=bt()?"↩":"Enter",o=bt()?"⌃":"Ctrl";return ["【快捷键说明】 -- from SRE浏览器提效插件"," 空格：SQL关键词自动大写"," Tab：SQL缩进Tab转空格",` ${e} + .：自动补全`,` ${e} + /：注释/取消注释`,` ${t} + ↑：当前行或选中行向上移动一行`,` ${t} + ↓：当前行或选中行向下移动一行`,` ${n} + ${t} + ↑：当前行或选中行向上复制`,` ${n} + ${t} + ↓：当前行或选中行向下复制`,` ${e} + ${r}：当前行下方插入新行`,` ${e} + ${n} + ${r}：当前行上方插入新行`,` ${o} + J：合并当前行和下一行`,` ${e} + ${n} + K：删除当前行或所选行`,` ${e} + D：删除当前行或所选行`,` ${e} + Z：撤销`].join(`
`)}function Mg(){async function e(){const o=document.querySelector(".scroll-table-meta tbody.table-metas");if(!o)return;function a(s){const i=s.target;if(!i||i?.getAttribute("data-tooltip")!=="点击复制")return;const u=i.closest("tr")?.querySelector("td .table-name")?.innerText;if(u){if(M.yuntu.moduleView("b_op_edit_mc"),Br()){qr(u)?A.success(`${u} 成功复制到剪贴板`):A.error("复制表名到剪贴板时失败",5e3);return}navigator.clipboard.writeText(u).then(()=>A.success(`${u} 成功复制到剪贴板`)).catch(d=>{A.error(`复制表名到剪贴板时出错: ${d}`,0);});}}o.removeEventListener("click",a),o.addEventListener("click",a);}function t(){document.querySelectorAll(".scroll-table-meta .table-metas i.fa-table:not([data-tooltip])")?.forEach(o=>{o.setAttribute("data-tooltip","点击复制");});}const n=new MutationObserver(function(o){o.some(s=>s.type==="childList")&&t();}),r=document.querySelector("div.scroll-table-meta");n.observe(r,{childList:true,subtree:true}),t(),e();}function Og(e){const t=[],n=e.querySelector("thead");n&&n.querySelectorAll("tr").forEach(o=>{const a=[];o.querySelectorAll("th").forEach(s=>{const i=s.innerText.trim(),c=parseInt(s.getAttribute("colspan")||"1",10);for(let l=0;l<c;l++)a.push(i);}),t.push(a);});const r=e.querySelector("tbody");if(r){const o=[];r.querySelectorAll("tr").forEach((a,s)=>{o[s]||(o[s]=[]);let i=0;a.querySelectorAll("td").forEach(c=>{const l=c.innerText.trim(),u=parseInt(c.getAttribute("rowspan")||"1",10),d=parseInt(c.getAttribute("colspan")||"1",10);for(;o[s][i]!==void 0;)i++;for(let f=0;f<u;f++)for(let p=0;p<d;p++){const m=s+f,w=i+p;o[m]||(o[m]=[]),o[m][w]=f===0&&p===0?l:"";}i+=d;});}),o.forEach(a=>{if(a&&a.length>0){const s=Math.max(...o.map(c=>c?c.length:0)),i=[];for(let c=0;c<s;c++)i.push((a[c]||"").toString());t.push(i);}});}return t.map(o=>o.join("	")).join(`
`)}function qg(e){if(!e)return;const n=e?.parentElement?.nextElementSibling;if(!n)return;n.style.overflowX="auto";const r=n.parentElement;r&&(r.style.overflow="hidden");}function Hg(){function e(){const n=document.querySelector("#preView_dataTable_filter");if(!n||n.parentElement?.querySelector(".preview-table-copy-btn"))return  false;qg(n.parentElement);const r=ye(`<button class="btn btn-default btn-sm preview-table-copy-btn" style="margin-right: 10px; margin-bottom: 10px;">
        <i class="fa fa-copy" style="margin-right: 5px;"></i>复制表格数据
      </button>`);return n.parentElement?.insertBefore(r,n),r.addEventListener("click",async()=>{const o=document.querySelector("#preView_dataTable");if(!o)return A.error("未找到预览表格");const a=o.querySelector("thead"),s=o.querySelector("tbody");let i='<table border="1" style="border-collapse: collapse;">';a&&(i+="<thead>",a.querySelectorAll("tr").forEach(l=>{i+="<tr>",l.querySelectorAll("th").forEach(u=>{const d=u.innerText.trim(),f=u.getAttribute("rowspan"),p=u.getAttribute("colspan");let m='<th style="border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2;"';f&&(m+=` rowspan="${f}"`),p&&(m+=` colspan="${p}"`),m+=`>${d}</th>`,i+=m;}),i+="</tr>";}),i+="</thead>"),s&&(i+="<tbody>",s.querySelectorAll("tr").forEach(l=>{i+="<tr>",l.querySelectorAll("td").forEach(u=>{const d=u.innerText.trim(),f=u.getAttribute("rowspan"),p=u.getAttribute("colspan");let m='<td style="border: 1px solid #ddd; padding: 8px;"';f&&(m+=` rowspan="${f}"`),p&&(m+=` colspan="${p}"`),m+=`>${d}</td>`,i+=m;}),i+="</tr>";}),i+="</tbody>"),i+="</table>";const c=Og(o);if(M.yuntu.moduleView("b_op_edit_preview_copy"),Br())await Ed(i,c)?A.success("表格数据已成功复制到剪贴板"):A.error("复制表格数据到剪贴板时失败",5e3);else try{await navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([i],{type:"text/html"}),"text/plain":new Blob([c],{type:"text/plain"})})]),A.success("富文本表格已成功复制到剪贴板");}catch{try{await navigator.clipboard.writeText(c),A.success("表格数据已成功复制到剪贴板（纯文本格式）");}catch(u){A.error(`复制表格数据到剪贴板时出错: ${u}`,0);}}}),true}e(),new MutationObserver(n=>{n.some(o=>o.type==="childList")&&setTimeout(()=>{e();},100);}).observe(document.body,{childList:true,subtree:true});}const li="auth.sankuai.com",se={MAX_ATTEMPT:10,_notice:false,_attempt:0,_param:"",_kmRes:null,STEP:100,reset(){this._param="",this._kmRes=null,this._attempt=0,this._notice=false;},doNotice(){this._notice||(this._notice=true,A.info("后台查询匹配中, 请稍后...",1e4));},getParam(){return this._param},getKmRes(){return this._kmRes},setKmRes(e){this._kmRes=e;},setParam(e){~e.indexOf("/")&&(this._param=e);},hasReachedMaxAttempt(){return this._attempt++,this._attempt>=this.MAX_ATTEMPT&&A.warning("查询已经达到最大迭代次数, 如果无想要的部门, 请更使用完整部门链"),this._attempt>=this.MAX_ATTEMPT}};async function Dg(){zg()&&(new le([{url:"https://auth.sankuai.com/newapi/component/common/searchOrgByPathName",method:"GET",preCallback:Vg,lastCallback:Kg},{url:"https://auth.sankuai.com/newapi/component/resource/list",method:"GET",lastCallback:Fg},{url:"https://auth.sankuai.com/newapi/component/resource/tree",method:"GET",lastCallback:Bg}]),Ug());}async function Ug(){if(!Wg())return;const e=await H.waitElement(".structure-container .sidebar-main ul.custom-tabs",30,300);e&&(e.lastElementChild?.click(),setTimeout(async()=>{e.firstElementChild?.click();const t=await H.waitElement(".mtd-tabs-nav-container .mtd-tabs-nav-animated",30,300);t&&t.children[1].click();},200));}function Bg(e,t){const n=typeof e=="string"?JSON.parse(e):e;if(n?.content)return n;const r=t.url.searchParams.get("resourceCode")||"",o=r.replace("dashboard_dashboard","dashboard_operation_dashboard"),s={system:"",status:0,all:false,full:false,attrs:[],ext:{BR:null,RT:"atlas_dashboard_operation",IB:"0"},scopes:null};return {message:"success",status:200,content:{code:r,name:"云图看板",items:[{code:`${o}_remove`,name:"删除",items:[],...s},{code:`${o}_edit`,name:"编辑",items:[],...s},{code:`${o}_view`,name:"查看",items:[],...s}],...s}}}function Fg(e,t){const n=typeof e=="string"?JSON.parse(e):e;if(n?.content?.items?.length)return n;const r=[{code:t.url.searchParams.get("keyword")||"",name:"云图看板",type:"看板",bindReports:null,reportManagers:""}];return {...n,content:{...n.content,items:r}}}function jg(e){return e.replace(/、|\|/g,"/").replace(/\s+/g,"")}async function Vg(e,t){const n=typeof e=="string"?JSON.parse(e):e,r=t.url.searchParams.get("keyword")||"",o=jg(r),a=r!==o,s=t.url.searchParams.get("keywordFull")||o;if(se.setParam(s),await Gg())return [true,{}];const l=!a&&!n.content?.orgList?.length||!!n.content?.orgList?.find(p=>p.orgName.endsWith(s));if(l)return [l,{}];if(se.hasReachedMaxAttempt())return [true,{}];const u=new URL(t.url.href);if(~o.indexOf("/")){const p=o.split("/").filter(Boolean).pop();p&&u.searchParams.set("keyword",p),u.searchParams.set("keywordFull",o);}else u.searchParams.set("keywordFull",se.getParam());const d=Number(u.searchParams.get("limit")||20);u.searchParams.set("limit",String(d+se.STEP));const f=u.toString();return se.doNotice(),[l,{uri:f,data:t.data}]}async function Gg(){const e=se.getParam().replace(/^公司\//,"");if(!e.startsWith("美团/"))return null;const t=await Ui(e);return t&&se.setKmRes(t),!!t}function Kg(e){const t=typeof e=="string"?JSON.parse(e):e,n=t.content?.orgList||[],r=se.getKmRes();if(r)return A.success("精确匹配到部门 ~"),t.content.orgList=[{orgName:r.name,orgId:String(r.orgId),orgPath:r.orgNamePath,roleCode:String(r.orgId),orgHeaderMisId:"-",orgHeaderName:"-",leaderInfoList:[],memberNumber:0,systemNames:null,systems:null,roleType:2,dynamicUserGroup:false}],se.reset(),t;let o;do o=n.findIndex(i=>i.orgPath.includes("失效")||!i.orgPath.startsWith("公司/美团")||/\/[^/]+省\//.test(i.orgPath)||/\/美团\/.*\/美团\//.test(i.orgPath)||i.orgPath.includes("销售")||i.orgPath.includes("废弃")||i.orgPath.includes("网店")),~o&&n.splice(o,1);while(~o);const a=se.getParam()?n.find(i=>i.orgPath.endsWith(se.getParam())):null;a&&n.splice(n.indexOf(a),1),n.sort((i,c)=>i.orgPath.split("/").length-c.orgPath.split("/").length);const s=n.shift();return n.sort((i,c)=>{const l=i.orgPath.split("/"),u=c.orgPath.split("/");for(let f=0;f<Math.min(l.length,u.length);f++)if(l[f]!==u[f])return l[f].localeCompare(u[f]);const d=l.length-u.length;return d!==0?d:i.orgPath.localeCompare(c.orgPath)}),s&&n.unshift(s),a&&n.unshift(a),se.reset(),t}function zg(){const{host:e,pathname:t}=location;return e!==li?false:!!(/^\/add$/.test(t)||/^\/res-query$/.test(t)||/^\/auth-query$/.test(t)||/^\/user\/dynamic$/.test(t))}function Wg(){const{host:e,pathname:t}=location;return e!==li?false:!!(/^\/res-query$/.test(t)||/^\/auth-query$/.test(t))}function Xg(){Yg()&&setTimeout(async()=>{const e=await H.waitElement("#my-ds",10,500);if(!e)return;const t=e.nextElementSibling?.firstChild?.nextSibling;t&&t.click();},100);}function Yg(){const{pathname:e,host:t}=location;return !(e!=="/datasource/default"||t!=="yuntu-manage.sankuai.com")}const gr=Q("FULL_VIEW");function Qg(){if(!/.*\/widget\/.*$/.test(location.pathname))return;const e=document.createElement("style");e.innerHTML=".report-config-dialog .mtd-modal {width:80% !important;}",document.head.appendChild(e);}function Jg(){if(Qg(),(Up()||ur())&&ry(),!ur()||!he("yuntu_enhancement"))return;he("yuntu_sub_close_announce")&&(async()=>{const t=await H.waitElement("#yuntu-top-announcement .mtdicon-close-thick",10,500);t&&(t.click(),M.yuntu.moduleView("b_op_notice_mv"));})();const e=document.createElement("style");e.innerHTML="@media (min-width:1000px) { #report-name-wrapper span:last-of-type { display:inline-block !important;float:none !important;margin-left:12px;} } .report-config-dialog .mtd-modal { width:80% !important;}",document.head.appendChild(e),he("yuntu_sub_close_navbar")&&setTimeout(()=>{(async()=>(await H.waitElement(".mtd-drawer .mtd-drawer-close",40,300))?.click())(),Zg(),ny(),ey();},100);}function ui(){const{pathname:e}=location,t=e.match(/\/dashboard\/(dashboard-[^/]+)\/\w+/);return t?t[1]:""}function Zg(){let e=null;document.addEventListener("keypress",t=>{["[","]"].includes(t.key)&&(t.ctrlKey||t.altKey)&&(e||(e=document.querySelector("#main-container div.report-catalog")),e&&e.children&&Array.from(e.children).forEach(n=>{const r=n;r.style.display=r.style.display==="none"?"":"none",M.yuntu.moduleClick("b_op_hotkey_mc");}));});}async function ey(){const e=await H.waitElement("#main-container",30,400);if(!e)return;e.addEventListener("click",r=>{const o=r.target;if(o?.classList?.contains(gr)){M.yuntu.moduleClick("b_op_yuntu_full_size_mc");const a=ty(o);window.open(a,"_blank");}});const t=xs(La,200);function n(){const r=document.getElementById("main-container");if(!r)return;const o={childList:true,subtree:true},a=i=>{for(const c of i)if(c.type==="childList"){t();break}};new MutationObserver(a).observe(r,o);}setTimeout(()=>{La(),n();},100);}function La(){document.querySelectorAll("#widget, .report-chart-container .report-chart-header").forEach(e=>{if(!e.querySelector(`.chart-menu .${gr}`)){const t=e.querySelector(".chart-menu"),n=ye(`<span class="mtd-popover-rel"><i title="打开子图" class="iconfont chart-header-operate-item icon-fullscreen-o ${gr}" style="color:magenta;margin-right:-1px;"></i></span>`);t.insertBefore(n,t.firstChild);}});}function ty(e){const{search:t}=location,n=ui(),o=e.closest(".report-chart-container")?.getAttribute("id")||"";return `https://yuntu.sankuai.com/v3/dashboard/${n}/widget/${o}/view${t}`}async function ny(){const e=await H.waitElement("#main-container .report-action",30,400);if(!e)return;const t=ui(),n=ye(`<span class="mtd-tooltip-rel" style="vertical-align:middle;"><a title="编辑权限" href="https://yuntu.sankuai.com/v3/auth/authorization?resourceType=dashboard&resourceKey=${t}" target="_blank" style="text-decoration:none;"><svg style="width:16px;height:18px;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M153.6 469.312v469.376h716.8V469.312H153.6zM64 384h896v640H64V384z m403.2 329.92c-26.752-14.72-44.8-42.304-44.8-73.92 0-47.104 40.128-85.312 89.6-85.312 49.472 0 89.6 38.208 89.6 85.312 0 31.616-18.048 59.136-44.8 73.92v115.968a44.8 44.8 0 0 1-89.6 0v-115.968zM332.8 384h358.4V256c0-94.272-80.256-170.688-179.2-170.688-98.944 0-179.2 76.416-179.2 170.688v128zM512 0c148.48 0 268.8 114.56 268.8 256v128H243.2V256c0-141.44 120.32-256 268.8-256z" fill="#262626"></path></svg></a></span>`),r=ye(`<span class="mtd-tooltip-rel" style="vertical-align:middle;"><a title="查看权限" href="https://yuntu.sankuai.com/v3/auth/query?resourceType=dashboard&resourceKey=${t}" target="_blank" style="text-decoration:none;"><svg style="width:16px;height:18px;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M512 195.047619c150.79619 0 288.280381 92.013714 412.42819 276.041143a73.142857 73.142857 0 0 1 2.755048 77.385143l-2.755048 4.437333-6.92419 10.118095C795.184762 740.303238 659.992381 828.952381 512 828.952381c-150.79619 0-288.280381-92.013714-412.42819-276.041143a73.142857 73.142857 0 0 1-2.755048-77.385143l2.755048-4.437333 6.92419-10.118095C228.815238 283.696762 364.007619 195.047619 512 195.047619z m0 73.142857c-120.880762 0-235.471238 75.142095-345.088 234.008381L160.207238 512l6.729143 9.825524C276.650667 680.740571 391.216762 755.809524 512 755.809524c120.880762 0 235.471238-75.142095 345.088-234.008381l6.704762-9.801143-6.729143-9.825524C747.349333 343.259429 632.783238 268.190476 512 268.190476z m0 88.551619a161.694476 161.694476 0 1 1 0 323.364572 161.694476 161.694476 0 0 1 0-323.364572z m0 73.142857a88.551619 88.551619 0 1 0 0 177.078858 88.551619 88.551619 0 0 0 0-177.078858z"></path></svg></a></span>`);n.querySelector("a")?.addEventListener("click",()=>{M.yuntu.moduleClick("b_op_auth_mc");}),r.querySelector("a")?.addEventListener("click",()=>{M.yuntu.moduleClick("b_op_auth_mc");}),e.insertBefore(r,e.firstChild),e.insertBefore(n,r);}function ry(){document.addEventListener("click",e=>{const t=e.target;if(!t||!t.closest(".mtd-input-wrapper")||!t.closest('[id^="widget-"]'))return;const o=t.closest(".pagination-wrap");if(!o)return;const a=o.__vue__?.pageInfo?.tn||0;if(a<=50)return;const s=o.__vue__?.pageSizeOptions;if(!(!s||s.includes(a))){for(let i=s.length-1;i>=0;i--)[5,10,20,50].includes(s[i])||s.splice(i,1);s.push(a);}});}function oy(){ur()&&new le({url:new RegExp("^https://yuntu.sankuai.com/api/proxy/widget/widget-[-\\w\\d]+/data"),method:"POST",lastCallback:ay});}async function ay(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.data?.type==="html"){const{config:n,content:r}=t.data?.resData;n&&(t.data.resData.config=n.replace(/<a /g,"<a target=_blank ")),r&&(t.data.resData.content=r.replace(/<a /g,"<a target=_blank "));}return t}let Ra=0;const Ma=400;let Yn=null;function sy(){Ds()&&uy();}function iy(e){if(e.isManuallyTriggered)return;const t=e.target;if(t?.tagName!=="TH")return;const n=new Date().getTime(),r=n-Ra;Yn&&clearTimeout(Yn),e.stopPropagation(),e.preventDefault(),r>Ma&&(Yn=setTimeout(()=>{const o=new MouseEvent("click",{bubbles:true,cancelable:true});o.isManuallyTriggered=true,t.dispatchEvent(o);},Ma)),Ra=n;}function cy(e){const t=e.target;t.tagName==="TH"&&(e.stopPropagation(),e.preventDefault(),ly(t));}function Oa(e){const t=e.style.backgroundColor;e.style.backgroundColor="#ffff99",setTimeout(()=>{e.style.backgroundColor=t;},1e3);}function ly(e){const t=e.textContent?.trim();if(!t)return;M.yuntu.moduleView("b_op_edit_mc");const n=`\`${t}\``;if(Br()){qr(n)?(A.success(`字段 ${n} 成功复制到剪贴板`),Oa(e)):A.error("复制表字段到剪贴板时失败",5e3);return}navigator.clipboard.writeText(n).then(()=>{A.success(`字段 ${n} 成功复制到剪贴板`),Oa(e);}).catch(r=>{A.error(`复制表字段到剪贴板时出错: ${r}`,0);});}function uy(){document.addEventListener("click",iy,true),document.addEventListener("dblclick",cy,false);}const Jt="__km-enhancement-setting-app";let et=null;function yr(){return et||(document.getElementById(Jt)?document.getElementById(Jt):(et=document.createElement("dialog"),et.setAttribute("id",Jt),document.body.append(et),requestAnimationFrame(()=>{Ld(Jt);}),et))}const[ib,dy]=te(false),[Te,nn]=te([]),[Qn,fy]=Ls({key:"",desc:"",title:"",tips:"",subMenus:[]}),br=e=>{dy(e),e?yr().showModal():yr().close();},py=e=>{fy(e),nn([]);};var my=N('<svg fill=none stroke=currentColor stroke-width=1.5 viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round d="M6 18 18 6M6 6l12 12">');const hy=(e={})=>(()=>{var t=my();return be(t,e,true,true),t})();var gy=N('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 1024 1024"><path fill=currentColor d="M569.6 998.4H172.8c-51.2 0-89.6-38.4-89.6-89.6v-800c0-51.2 38.4-89.6 89.6-89.6h672c51.2 0 89.6 38.4 89.6 89.6V640c0 12.8-12.8 25.6-25.6 25.6s-25.6-12.8-25.6-25.6V108.8c0-19.2-19.2-38.4-38.4-38.4h-672c-19.2 0-38.4 19.2-38.4 38.4v806.4c0 19.2 19.2 38.4 38.4 38.4h390.4c12.8 0 25.6 12.8 25.6 25.6s-6.4 19.2-19.2 19.2m19.2-256h-320c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h320c12.8 0 25.6 12.8 25.6 25.6-6.4 12.8-12.8 25.6-25.6 25.6m160-230.4H262.4c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h486.4c12.8 0 25.6 12.8 25.6 25.6S761.6 512 748.8 512m6.4-217.6H268.8c-12.8 0-25.6-12.8-25.6-25.6s12.8-25.6 25.6-25.6h486.4c12.8 0 25.6 12.8 25.6 25.6s-12.8 25.6-25.6 25.6M928 761.6c-12.8-12.8-32-12.8-38.4 0l-160 172.8-64-64c-12.8-12.8-32-12.8-38.4 0s-12.8 32 0 38.4l89.6 83.2c12.8 12.8 32 12.8 38.4 0l179.2-198.4c0-6.4 0-25.6-6.4-32">');const yy=(e={})=>(()=>{var t=gy();return be(t,e,true,true),t})();var by=N("<div class=backdrop><div class=innerBackdrop></div><div class=dialogRoot><div class=dialogHeader><div class=headerTitle></div><div class=btnGroup><div class=saveButton title=点击保存并关闭><div class=saveIcon></div><span>(<!>)</span></div><div class=closeButton title=放弃并关闭></div></div></div><div class=dialogMain><p></p><hr class=hrLine>"),wy=N("<label class=label><input class=checkboxInput type=checkbox>");function vy(){const e=()=>{br(false);},t=()=>{br(false),Te().length>0&&(Te().forEach(r=>{Se(r.key,r.newVal);}),location.reload());},n=(r,o)=>{const a=Te().findIndex(s=>s.key===r);if(a!==-1)if(Te()[a].oldVal===o){const s=Te().filter(i=>i.key!==r);nn(s);}else {const s=[...Te()];s[a].newVal=o,nn(s);}else nn([...Te(),{key:r,oldVal:!o,newVal:o}]);};return (()=>{var r=by(),o=r.firstChild,a=o.nextSibling,s=a.firstChild,i=s.firstChild,c=i.nextSibling,l=c.firstChild,u=l.firstChild,d=u.nextSibling,f=d.firstChild,p=f.nextSibling;p.nextSibling;var m=l.nextSibling,w=s.nextSibling,v=w.firstChild;return v.nextSibling,E(i,()=>Qn.title),l.$$click=t,E(u,P(yy,{})),E(d,()=>Te().length,p),m.$$click=e,E(m,P(hy,{})),E(v,()=>Qn.tips),E(w,()=>Qn.subMenus.map(b=>(()=>{var C=wy(),$=C.firstChild;return $.addEventListener("change",O=>n(b.key,O.currentTarget.checked)),E(C,()=>b.desc,null),q(()=>$.checked=b.val),C})()),null),r})()}Ve(["click"]);const Zt=[],qa=e=>e===void 0||e==="undefined";for(const e of mn){const t=xe(e.key);qa(t)?Se(e.key,e.val):e.val=t;for(const n of e?.subMenus||[]){const r=xe(n.key);qa(r)?Se(n.key,n.val):n.val=r;}}function ky(){G.settingDispose&&G.settingDispose(),G.settingDispose=Dr(()=>P(vy,{}),yr());}function di(){if(Zt.length>=mn.length)for(const e of Zt)hi(e);for(const e of mn){const{subMenus:t,val:n,desc:r}=e,o=t?"#️⃣":n?"✅":"❌",a=t?`(${t.filter(s=>s.val).length}/${t.length})`:"";Zt.push(Yr(`${o} ${r}${a}`,()=>Cy(e)));}Zt.push(Yr("💬 反馈 & 建议 [v2025.12.03.1139]",()=>wr("https://km.sankuai.com/page/1886884598",{active:true,insert:true,setParent:true})));}function _y(e){const{key:t,desc:n}=e;return e.val?(Se(t,false),er({text:`已关闭 [${n}] 功能
（点击刷新网页后生效）`,timeout:4500,onclick:()=>location.reload()})):(Se(t,true),er({text:`已开启 [${n}] 功能
（点击刷新网页后生效）`,timeout:4500,onclick:()=>location.reload()})),di(),""}function Cy(e){e.subMenus?(py(e),br(true)):_y(e);}function xy(){jp()&&Sy();}async function Sy(){const t=await H.waitElement("#app .app-main .el-card__body tbody > tr.ant-descriptions-row .ant-descriptions-item-content",100,40,true),n=t?.textContent?.trim();if(!n)return;const r=await Qa(n);if(!r)return;const o=`https://avatar.mws.sankuai.com/v2/service/detail/host?appkey=${r}&env=prod&q=${n}`;t.innerHTML=`<a style="color: #1890ff" href="${o}" target="_blank">${n}</a>`;}const $y="__test_feature__";function Ey(){Ly()&&Ny()&&(new le([{url:"https://ccmp.mws.sankuai.com/api/common/isadmin",lastCallback:Jn,method:"GET"},{url:"https://ccmp.mws.sankuai.com/api/profit/metric/common/auth",lastCallback:Jn,method:"GET"},{url:"https://ccmp.mws.sankuai.com/cpp/api/common/itu-pricing-auth",lastCallback:Jn,method:"GET"},{url:"https://ccmp.mws.sankuai.com/cpp/api/access/getGlobalAuthority",lastCallback:Ay,method:"GET"},{url:"https://raptor.mws.sankuai.com/raptor/dashboard/auth/project/userAuth",lastCallback:Ty,method:"POST"},{url:"https://raptor.mws.sankuai.com/raptor/alarmMeta/auth/project/userAuth",lastCallback:Py,method:"POST"},{url:"https://mws.sankuai.com/bus/v2/console/verify",lastCallback:Iy,method:"GET"}]),Cs("mt-work-enhancement","2025.12.03.1139"));}function Jn(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data=true,t}function Ay(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data.isFP=true,t.data.isAdmin=true,t.data.isMultiCalculator=true,t}function Ty(e){const t=typeof e=="string"?JSON.parse(e):e;for(const n of t.result)n.authType="admin";return t}function Py(e){const t=typeof e=="string"?JSON.parse(e):e;for(const n of t.result)n.authType="admin";return t}function Iy(e){const t=typeof e=="string"?JSON.parse(e):e;return t.data=true,t}function Ny(){return location.host==="ccmp.mws.sankuai.com"||location.host==="raptor.mws.sankuai.com"||location.host==="avatar.mws.sankuai.com"||location.host==="mws.sankuai.com"}function Ly(){return !!xe($y)}function Ry(e){let t=Number(e.match(/\[(\d+)\]/)?.[1]||0);e=e.replace(/^\./,"").replace(/(\[\d+\])/,"");const n=e.match(/#([^.]+)/)?.[1]||null,o=e.replace(/#[^.]+/,"").replace(/^\./,"")?.split(".")||[];return function(a){if(!a)return  false;if(n){if(a.id!==n)return  false;if(o.length===0)return  true}if(o.length>0&&a.classList){const s=o.every(i=>a.classList.contains(i));return s&&t?(t--,false):s}return  false}}function My(e,t){const n=Ry(t);function r(o,a){if(o.$el&&n(o.$el))return a;if(o.$children&&o.$children.length>0)for(let s=0;s<o.$children.length;s++){const i=r(o.$children[s],a.concat(s));if(i.length>0)return i}return []}return r(e,[])}function Oy(e,t="#app"){let n=null;const r=[],o=document.querySelector(t)?.__vue__;if(!o)return {targetNode:n,accessPath:r};n=o;for(const a of e.split(/\s+/)){const s=a.trim(),i=My(n,s);if(n=i.reduce((c,l)=>c.$children?c.$children[l]:c,n),!n)break;r.push(...i);}return {targetNode:n,accessPath:r}}const zr="https://nest.sankuai.com",Wr="http://nest.inf.test.sankuai.com";async function qy(e,t,n){const r=`${n?zr:Wr}/api/services/${e}/functions`,{data:o}=await _(r);return o?.find(s=>s.name===t)||null}async function Hy(e,t){const n=new URL(`${t?zr:Wr}/api/v1/configTemplate/list`);n.searchParams.append("functionId",e.toString());const{data:r}=await _(n);return r}async function Dy(e,t){const n=new URL(`${t?zr:Wr}/api/v1/group/list`);n.searchParams.append("functionId",e.toString());const{data:r}=await _(n);return r}const fi=Q("REFRESH"),Xr=Q("CHANGE_ENV"),ot=location.host==="nest.sankuai.com";function Uy(){Gp()&&(en(),mt(en),setTimeout(en,300),setTimeout(en,2e3),new le({url:`${location.origin}/api/deploy/preview`,beforeSendCallback:By,method:"POST"}));}async function By(e){const t=JSON.parse(e.data||"");if(!t.configTemplateId&&!t.groupIds.length){const n=Xy(),[r,o]=await Promise.all([Hy(n,ot),Dy(n,ot)]);r.length&&(t.configTemplateId=r[0].id),t.groupIds=o.map(a=>a.id);}return {data:JSON.stringify(t)}}function en(){return ne(()=>{setTimeout(()=>{Fy(),Wy();},200);})}function Fy(){if(!jy())return;const e=document.querySelector("#function-info-page .revisions .revisions-filters");if(!e||Vy(e))return;const t=".new-main.mtd-container .mtd-main #function-info-page.mt-22",{targetNode:n}=Oy(t),r=n?.$children[0]?.$children[0]?.$children.find(a=>typeof a?.$children[0]?.autoRefreshChange=="function")?.$children[0];if(!r)return;const o=document.createElement("button");o.textContent="刷新",o.onclick=()=>{o.disabled=true,o.style.cursor="not-allowed",o.classList.add("mtd-btn-disabled"),r.autoRefreshChange(),r.revisions.length=0,r.init(),setTimeout(()=>{o.disabled=false,o.style.cursor="pointer",o.classList.remove("mtd-btn-disabled");},1e3);},o.classList.add(fi),o.classList.add("mtd-btn"),o.classList.add("filter"),o.style.setProperty("zoom","0.9"),o.style.borderRadius="15px",o.style.marginLeft="12px",o.style.fontSize="small",o.style.padding="0 8px",o.style.cursor="pointer",o.style.width="60px",e.appendChild(o);}function jy(){return location.hash.replace(/\?.*/,"").endsWith("/revisions")}function Vy(e){return !!e.querySelector(`.${fi}`)}function Gy(){return document.querySelectorAll("#placehoder-parent .mtdicon-right-thick").length>3}function Zn(e){return !!e.querySelector(`.${Xr}`)}function Ky(){const e=location.hash,t=/#\/service\/(?<appkey>[^/]+)\/.*[?&]name=(?<name>[^&]+)/,n=e.match(t),{appkey:r="",name:o=""}=n?.groups||{};return {appkey:r,name:o}}function zy(e,t,n,r,o){return t?`http://nest.inf.test.sankuai.com/preview#/service/${e}/function/${n}/deployment/build?name=${r}&desc=${o}`:`https://nest.sankuai.com/preview#/service/${e}/function/${n}/deployment/build?name=${r}&desc=${o}`}async function Wy(){if(!Gy())return Ha();const e=document.querySelector("#placehoder-parent .el-row .el-col");if(!e)return Ha();if(Zn(e))return;const{appkey:t,name:n}=Ky();if(!t||!n)return;const r=await qy(t,n,!ot),o=r?.description||"",a=r?.id||0,s=zy(t,ot,a,n,o);if(Zn(e))return;const i=document.createElement("button");i.onclick=()=>{window.open(s,"_blank");},i.textContent=ot?"→ Test环境":"→ Prod环境",i.classList.add(Xr),i.classList.add("mtd-btn-small"),i.classList.add("mtd-btn"),i.style.margin="0 5px",i.style.color="#ffffff",i.style.backgroundColor=ot?"#8e3deb":"#069a55",Zn(e)||e.appendChild(i);}function Ha(){const e=document.querySelector(`.${Xr}`);e&&e.remove();}function Xy(){return location.hash.replace(/.*\/function\//,"").split("/").shift()||""}const Yy=(e,t)=>{if(!e)return null;t||(t="_ssoid");const n=e.trim(),[r,o]=n.split("=");return r===t||r?.endsWith(t)?o?.split(";")[0]:null},Qy=e=>{try{const{protocol:t,host:n}=new URL(e);return `${t}//${n}/`}catch{}return e},Da=(e,t="_ssoid",n=5e3)=>new Promise((r,o)=>{const a=Qy(e);gi({url:e,method:"GET",headers:{Accept:"application/json, text/plain, */*","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8","Cache-Control":"no-cache",Referer:a,"User-Agent":navigator.userAgent,Pragma:"no-cache"},onload:s=>{const i=s.responseHeaders.split(`
`).filter(c=>c.toLowerCase().startsWith("set-cookie:"));if(i.length===0)return r(null);for(const c of i){const l=c.substring(11).trim(),u=Yy(l,t);if(u)return r(u)}r(null);},ontimeout:()=>o(new Error("请求超时")),onerror:s=>o(s),timeout:n});}),Jy=async(e,t=2e3)=>{const n=wr(e,{active:false,insert:true,setParent:true});await new Promise(r=>setTimeout(r,t)),n?.close();},Zy=e=>new TextDecoder().decode(Uint8Array.from(atob(e),t=>t.charCodeAt(0))),eb=e=>{if(!e)return {error:"未找到 cookie"};const t=e.split("**").pop();if(!t)return {error:"未找到加密用户信息"};try{const n=Zy(t).split(","),r=+n[n.length-1],o=new Date(r);return {error:null,cookie:e,userInfo:n,expireTime:`${o.toLocaleDateString()} ${o.toLocaleTimeString()}`}}catch{return {error:"解析用户信息失败"}}},tb=async(e,t)=>{let n=await Da(e,t);if(!n){const r=e.split("com/")[0]+"com/";await Jy(r),n=await Da(e,t);}return n?eb(n):{error:"重试后仍未找到 cookie"}};function nb(){Zp()&&(X.__cookieGetter__=tb);}function rb(){if(!Vp())return;const e=location.origin;new le({url:`${e}/aida/api/web/quota/page/list`,beforeSendCallback:ab,lastCallback:ob,method:"POST"});}function ob(e){const t=typeof e=="string"?JSON.parse(e):e;return t?.data?.items?.length>0&&(t.data.items=t.data.items.filter(n=>n.cpuFree!==0||n.cpuQuota!==0||n.cpuReserved!==0||n.cpuUsed!==0||n.diskFree!==0||n.diskQuota!==0||n.diskReserved!==0||n.diskUsed!==0||n.memFree!==0||n.memQuota!==0||n.memReserved!==0||n.memUsed!==0||n.memFree!==0||n.memQuota!==0||n.memReserved!==0||n.memUsed!==0)),t}async function ab(e){const t=JSON.parse(e.data||"");return t?.sn&&t?.sn<100&&(t.sn=100),{data:JSON.stringify(t)}}$g(),gg(),Ey(),qp(),sm(),cm(),rb(),Uh(),tg(),Dg(),vg(),oy(),setTimeout(()=>{ky(),di();},300),Id([Rp,om,sg,Pg,sy,Xg,Jg,pg,xy,Bh,Uy,dm,nb,Nd,em]);

})();