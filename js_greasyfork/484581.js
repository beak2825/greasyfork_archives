// ==UserScript==
// @name         水源去签名
// @namespace    http://tampermonkey.net/
// @version      0.2-beta
// @description  去除水源社区中显示的自定义用户签名，有误伤可能
// @author       You
// @match        https://shuiyuan.sjtu.edu.cn/*
// @license      GPL-3.0-only
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/484581/%E6%B0%B4%E6%BA%90%E5%8E%BB%E7%AD%BE%E5%90%8D.user.js
// @updateURL https://update.greasyfork.org/scripts/484581/%E6%B0%B4%E6%BA%90%E5%8E%BB%E7%AD%BE%E5%90%8D.meta.js
// ==/UserScript==

// Generated by gpt4, tested and revised by Myosotis.

(function() {
    'use strict';

    // Function to remove the last <hr> and following <p> within each .cooked div
    function removeLastHrAndP() {
        const cookedElements = document.querySelectorAll('.cooked');
        cookedElements.forEach(function(div) {
            // Get all <hr> elements within the current .cooked div
            var hrs = div.querySelectorAll('hr');
            
            // If the last <hr> exists
            if (hrs.length) {
                var lastHr = hrs[hrs.length - 1];
                
                // Check for the next sibling to be a <p> element and remove it
                var nextSibling = lastHr.nextElementSibling;
                if (nextSibling && nextSibling.tagName.toLowerCase() === 'p') {
                    nextSibling.remove();
                }
                
                // Lastly remove the <hr>
                lastHr.remove();
            }
        });
    }

    // Initialize a mutation observer to monitor DOM changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length || mutation.type === 'attributes') {
                removeLastHrAndP();
            }
        });
    });

    // Start observing the document with the configured settings
    observer.observe(document, {
        subtree: true,
        childList: true,
        attributes: false
    });

    // Run the function when the window loads
    window.addEventListener('load', removeLastHrAndP);
})();