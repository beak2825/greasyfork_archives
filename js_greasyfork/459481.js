// ==UserScript==
// @name         山东执业药师继续教育-online
// @namespace    1721384107@qq.com
// @version      2.0
// @description  执业药师继续教育--屏蔽视频页弹窗，自动刷课
// @author       winegd
// @match        https://www.sdlpa.org.cn/*
// @match        https://www.sddfvc.sdlpa.org.cn/*
// @match        https://sdu.sdlpa.org.cn/*
// @match        https://sddfvc.sdlpa.org.cn/*
// @match        https://sdutcm.sdlpa.org.cn/*
// @match        https://sdu.sdlpa.org.cn/*
// @match         http://xj.mtne/*

// @icon         data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkIxNEIyNjFEMDAyNDExRTVCNzNGRUVGNEJFRTU3OENGIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkIxNEIyNjFFMDAyNDExRTVCNzNGRUVGNEJFRTU3OENGIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QjE0QjI2MUIwMDI0MTFFNUI3M0ZFRUY0QkVFNTc4Q0YiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QjE0QjI2MUMwMDI0MTFFNUI3M0ZFRUY0QkVFNTc4Q0YiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5802I/AAACGUlEQVR42pyTz0tUURTH7/uF44zMjC0EcRpdBA5a6qKgRWk/lFo1I4GbMA01khbWf1B/QGCLkBDBCMZSI42WgxSirsoZMWg5QjKKLYZEZvS9d1/fM5wnF3PVhQ/nvnvv+95zvuc9zfM8oY4nQ7MUmkAeXANZEAXF8am+ojgxzFNeJAbAV45vWKAdPDgpoPkZQKADYQxkwAFYwI3qHokkQQ5M+3sVAT7QCiJg9dX5iSxfkOD1D483R0kgxeu/wWcS0XmBNs+BNBazSoa94DlNIEoeTLM3N9kfYeL2ikHgI0fB9d4Gj8BZ8AJ8Yl/oggaOxxlQbbpfF0Yj6AL1VCa4AW7RBneiGwweezDc9zasedofV3fFUiIjtqO/fKFJ0Ama6WFo5aFwdEcEAlab7bjm6/S9734G3Z7miYBdLVoKrWqXXoJn/gMJm64pymV733XkRbWEoH8odFgjpCYrN2FsgnfAcAxb5GLrQuoSNWnUe1v9kMKma9VOXp2gNqZ0T4+ALd7bAHexP1+IFO5D+KkhjThU9tQMfkC1RzGwgyMRBkdsahM8uoCzlzH/pmaw7OpOf2ojGV9oW1zkdhb5+4iyF9HETsv75t3EdfhFLS2oAhJ1z5zZr+scWR6N2Ya9JjV325JWvmSVyJNg6ChUj/SvoFtfIPDzn5+J0kQbM4DacAlp3sELe1VOFdVajXkt4hxezp/6M/3v+CvAACvoyrZL083WAAAAAElFTkSuQmCC

// @grant        unsafeWindow
// @grant        window.close
// @grant        GM_setValue
// @grant        GM_getValue
// @require      http://code.jquery.com/jquery-migrate-1.2.1.min.js
 
 
 
// @downloadURL https://update.greasyfork.org/scripts/459481/%E5%B1%B1%E4%B8%9C%E6%89%A7%E4%B8%9A%E8%8D%AF%E5%B8%88%E7%BB%A7%E7%BB%AD%E6%95%99%E8%82%B2-online.user.js
// @updateURL https://update.greasyfork.org/scripts/459481/%E5%B1%B1%E4%B8%9C%E6%89%A7%E4%B8%9A%E8%8D%AF%E5%B8%88%E7%BB%A7%E7%BB%AD%E6%95%99%E8%82%B2-online.meta.js
// ==/UserScript==
 
/* globals jQuery, $, waitForKeyElements */
function isNaN(e){return e!=e}!function(){"use strict";console.log("山东药师继续教育刷课脚本执行");var e=unsafeWindow.location.pathname,n=new RegExp("/Learning/VideoH52/*"),t=(new RegExp("/Exam/SingleExam/*"),new RegExp("/CourseAssess"));if("/Learning/Default1"==e||"/learning/Default1"==e){$("body").append('<button class="b6" style="width:100px;height:50px;color:red;font-size:20px;position:absolute;left:100px;top:100px">刷课中..</button>');var o,l=document.querySelectorAll(".ttr");let e=0;for(o of l)if(e++,"听课中"==o.children[3].innerText||"待考试"==o.children[3].innerText){o.children[4].children[0].click(),setTimeout(()=>{var e,n=document.querySelectorAll(".ttr"),n=Array.prototype.slice.call(n,0,4);console.log(n.length),GM_setValue("p_len",n.length);let t=0,o=1;for(e of n)try{var l=e.children[2].innerText;if(console.log(l),"通过"==l&&t++,"通过"!=l&&"去考试"!=l){e.children[4].children[0].click(),GM_setValue("p_n_len",o);break}o++}catch(e){}4==t?$("body").append('<button class="b5" style="height:50px;color:red;font-size:20px;position:absolute;left:40%;top:50%">当前脚本仅可试刷4个章节，如需完整脚本或刷课请＋微信：hllwx2023</button>'):setTimeout(()=>{var n=document.querySelectorAll(".ttr"),t=(console.log(n.length),n.length-1);""==n[t].children[2].innerText?GM_setValue("len",t):GM_setValue("len",1+t),console.log("设置len完成"+t),console.log("列表长度"),console.log(n.length);for(let e=0;e<=t;e++){var o=n[e].children[2].innerText;if(console.log("视频时长"+o),"0.0"==o){console.log("0.0"==o),GM_setValue("n_len",e+1),console.log("设置n_len完成");var l=n[e].children[0].children[0].href;unsafeWindow.open(l);break}if(""!=o){var l=n[e].children[1].innerText.split(":"),o=3600*l[0]+60*l[1]+parseInt(l[2]),i=n[e].children[2].innerText.split(":"),i=3600*i[0]+60*i[1]+parseInt(i[2]);if(!(o<=i)){GM_setValue("n_len",e+1);o=n[e].children[0].children[0].href;unsafeWindow.open(o);break}}}},2e3)},2e3);break}e==l.length&&$(".b6").text("已学完")}else if(n.test(e)){$("body").append('<button style="width:100px;height:50px;color:red;font-size:20px;position:absolute;left:100px;top:100px">刷课中..</button>'),$("body").append('<button class="b2" style="width:100px;height:50px;color:red;font-size:20px;position:absolute;left:100px;top:150px"></button>'),$("body").append('<button class="b3" style="width:100px;height:50px;color:red;font-size:20px;position:absolute;left:100px;top:200px"></button>'),$("body").append('<button class="b4" style="width:200px;height:50px;color:red;font-size:20px;position:absolute;left:50px;top:250px"></button>');var l=GM_getValue("p_n_len"),n=GM_getValue("p_len"),i=GM_getValue("n_len"),r=GM_getValue("len");$(".b2").text(l+"/"+n),$(".b3").text(i+"/"+r),console.log(l+"/"+n),console.log(i+"/"+r),$(unsafeWindow).unbind("beforeunload"),unsafeWindow.onbeforeunload=null,$("video").prop("muted",!0),setInterval(()=>{$(".b4").text("当前视频进度: "+parseInt(parseInt(player.currentTime)/parseInt(player.duration)*100)+"%")},2e4),$("video").get(0).addEventListener("pause",function(){console.log("视频暂停播放"),$("video").prop("muted",!0),setTimeout(()=>{layer.closeAll(),console.log("关闭弹窗"),$("video").get(0).play(),console.log("开始播放")},2e3)},!1),$("video").get(0).addEventListener("playing",function(){$("video").prop("muted",!0),$("video").get(0).play(),$(".b4").text("当前视频进度: "+parseInt(parseInt(player.currentTime)/parseInt(player.duration)*100)+"%")},!1),$("video").get(0).addEventListener("ended",function(){console.log("播放结束");var e=window.location.search,e=new URLSearchParams(e).get("wId"),n=window.location.pathname.split("/"),t=(console.log("cid: "+n[n.length-1]),console.log("wid: "+e),new FormData);t.append("cid",n[n.length-1]),t.append("wid",e),t.append("time",tempSubmitTimes),navigator.sendBeacon("/Service/SaveTime",t),upload(),setTimeout(()=>{$(unsafeWindow).unbind("beforeunload"),unsafeWindow.onbeforeunload=null,unsafeWindow.close(),unsafeWindow.opener.location.reload()},2e3)},!1)}else if(t.test(e)){var a;for(a of document.querySelectorAll(".star"))a.children[1].children[4].click();setTimeout(()=>{document.querySelector("#next").click()},1e3)}}();