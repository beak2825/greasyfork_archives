// ==UserScript==
// @name         æ¥µè‡´æµæš¢å³éµæ‹–æ›³ + æ‰‹å‹¢å°èˆª
// @namespace    http://tampermonkey.net/
// @version      3.0
// @description  å³éµæ‹–æ›³æ»¾å‹• + å·¦å³æ»‘å‹•è¿”å›/å‰é€²ï¼Œé¡ä¼¼Chromeè§¸æ§æ‰‹å‹¢
// @match        *://*/*
// @grant        none
// @run-at       document-start
// @downloadURL https://update.greasyfork.org/scripts/561717/%E6%A5%B5%E8%87%B4%E6%B5%81%E6%9A%A2%E5%8F%B3%E9%8D%B5%E6%8B%96%E6%9B%B3%20%2B%20%E6%89%8B%E5%8B%A2%E5%B0%8E%E8%88%AA.user.js
// @updateURL https://update.greasyfork.org/scripts/561717/%E6%A5%B5%E8%87%B4%E6%B5%81%E6%9A%A2%E5%8F%B3%E9%8D%B5%E6%8B%96%E6%9B%B3%20%2B%20%E6%89%8B%E5%8B%A2%E5%B0%8E%E8%88%AA.meta.js
// ==/UserScript==

(function(){'use strict';const CONFIG={friction:.92,multiplier:1.5,minVelocity:.5,maxVelocity:150,smoothing:.3,gestureThreshold:150,gestureVerticalLimit:100};let isDragging=!1,isAnimating=!1,startY=0,startX=0,lastY=0,lastX=0,velocityX=0,velocityY=0,lastTime=0,animationId=null,hasMoved=!1,gestureTriggered=!1,gestureDirection=null,indicator=null;const now=()=>performance.now(),clamp=(v,min,max)=>Math.max(min,Math.min(max,v));function createIndicator(){if(indicator)return;indicator=document.createElement('div');indicator.innerHTML=`<style>.gesture-indicator{position:fixed;top:50%;transform:translateY(-50%);width:60px;height:60px;border-radius:50%;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:999999;opacity:0;transition:opacity .15s,transform .15s;pointer-events:none;backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,.3)}.gesture-indicator.left{left:20px}.gesture-indicator.right{right:20px}.gesture-indicator.show{opacity:1}.gesture-indicator.ready{transform:translateY(-50%) scale(1.2);background:rgba(66,133,244,.9)}.gesture-indicator svg{width:30px;height:30px;fill:#fff}</style><div class="gesture-indicator left" id="gestureLeft"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></div><div class="gesture-indicator right" id="gestureRight"><svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg></div>`;document.body.appendChild(indicator)}function showIndicator(dir,ready=!1){createIndicator();const el=document.getElementById(dir==='left'?'gestureLeft':'gestureRight'),other=document.getElementById(dir==='left'?'gestureRight':'gestureLeft');el&&(el.classList.add('show'),el.classList.toggle('ready',ready));other&&other.classList.remove('show','ready')}function hideIndicators(){const l=document.getElementById('gestureLeft'),r=document.getElementById('gestureRight');l&&l.classList.remove('show','ready');r&&r.classList.remove('show','ready')}function navigateWithAnimation(dir){const overlay=document.createElement('div');overlay.style.cssText=`position:fixed;top:0;${dir==='left'?'left':'right'}:0;width:100%;height:100%;background:linear-gradient(${dir==='left'?'90deg':'-90deg'},rgba(66,133,244,.3) 0%,transparent 50%);z-index:999998;pointer-events:none;animation:gestureSlide .3s ease-out forwards`;const style=document.createElement('style');style.textContent=`@keyframes gestureSlide{0%{opacity:1;transform:translateX(0)}100%{opacity:0;transform:translateX(${dir==='left'?'-30%':'30%'})}}`;document.head.appendChild(style);document.body.appendChild(overlay);setTimeout(()=>{overlay.remove();style.remove();dir==='left'?history.back():history.forward()},150)}document.addEventListener('contextmenu',e=>{(hasMoved||gestureTriggered)&&(e.preventDefault(),e.stopPropagation())},!0);document.addEventListener('mousedown',e=>{if(e.button!==2)return;animationId&&(cancelAnimationFrame(animationId),animationId=null);isDragging=!0;hasMoved=!1;isAnimating=!1;gestureTriggered=!1;gestureDirection=null;startX=lastX=e.clientX;startY=lastY=e.clientY;velocityX=velocityY=0;lastTime=now();document.body.style.cursor='grabbing';document.body.style.userSelect='none';e.preventDefault()});document.addEventListener('mousemove',e=>{if(!isDragging)return;const currentTime=now(),deltaTime=currentTime-lastTime;if(deltaTime===0)return;const deltaX=lastX-e.clientX,deltaY=lastY-e.clientY,totalDeltaX=e.clientX-startX,totalDeltaY=Math.abs(e.clientY-startY);(Math.abs(totalDeltaX)>3||totalDeltaY>3)&&(hasMoved=!0);if(totalDeltaY<CONFIG.gestureVerticalLimit){const progress=Math.abs(totalDeltaX)/CONFIG.gestureThreshold;if(totalDeltaX>30){gestureDirection='left';showIndicator('left',progress>=1);progress>=1&&(gestureTriggered=!0)}else if(totalDeltaX<-30){gestureDirection='right';showIndicator('right',progress>=1);progress>=1&&(gestureTriggered=!0)}else{gestureDirection=null;hideIndicators()}}else{gestureDirection=null;gestureTriggered=!1;hideIndicators()}if(!gestureDirection){const ivx=(deltaX/deltaTime)*16*CONFIG.multiplier,ivy=(deltaY/deltaTime)*16*CONFIG.multiplier;velocityX=velocityX*CONFIG.smoothing+ivx*(1-CONFIG.smoothing);velocityY=velocityY*CONFIG.smoothing+ivy*(1-CONFIG.smoothing);velocityX=clamp(velocityX,-CONFIG.maxVelocity,CONFIG.maxVelocity);velocityY=clamp(velocityY,-CONFIG.maxVelocity,CONFIG.maxVelocity);window.scrollBy(deltaX,deltaY)}lastX=e.clientX;lastY=e.clientY;lastTime=currentTime});document.addEventListener('mouseup',e=>{if(e.button!==2||!isDragging)return;isDragging=!1;document.body.style.cursor='';document.body.style.userSelect='';hideIndicators();if(gestureTriggered&&gestureDirection){navigateWithAnimation(gestureDirection);gestureTriggered=!1;gestureDirection=null;return}gestureDirection=null;(Math.abs(velocityX)>CONFIG.minVelocity||Math.abs(velocityY)>CONFIG.minVelocity)&&(isAnimating=!0,animateScroll())});function animateScroll(){if(!isAnimating)return;velocityX*=CONFIG.friction;velocityY*=CONFIG.friction;if(Math.abs(velocityX)<CONFIG.minVelocity&&Math.abs(velocityY)<CONFIG.minVelocity){isAnimating=!1;velocityX=velocityY=0;return}window.scrollBy(velocityX,velocityY);animationId=requestAnimationFrame(animateScroll)}document.addEventListener('mouseleave',()=>{if(isDragging){isDragging=!1;document.body.style.cursor='';document.body.style.userSelect='';hideIndicators();!gestureTriggered&&(Math.abs(velocityX)>CONFIG.minVelocity||Math.abs(velocityY)>CONFIG.minVelocity)&&(isAnimating=!0,animateScroll())}});document.addEventListener('mousedown',e=>{e.button!==2&&isAnimating&&(isAnimating=!1,animationId&&(cancelAnimationFrame(animationId),animationId=null))});console.log('ğŸš€ æ¥µè‡´æµæš¢å³éµæ‹–æ›³ + æ‰‹å‹¢å°èˆªå·²å•Ÿç”¨ï¼')})();