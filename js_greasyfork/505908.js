// ==UserScript==
// @name         VK Auto-Load Missing Tabs with Dynamic Page Updates
// @version      0.31
// @description  Auto-load missing tabs on VK group page with support for dynamic updates
// @match        https://vk.com/*
// @namespace https://greasyfork.org/users/789838
// @downloadURL https://update.greasyfork.org/scripts/505908/VK%20Auto-Load%20Missing%20Tabs%20with%20Dynamic%20Page%20Updates.user.js
// @updateURL https://update.greasyfork.org/scripts/505908/VK%20Auto-Load%20Missing%20Tabs%20with%20Dynamic%20Page%20Updates.meta.js
// ==/UserScript==

(function() {
    'use strict';

    // Идентификатор элемента, в который нужно добавить недостающие вкладки
    const tabsContainerSelector = '.ui_tabs_container.group_content_tabs';

    // Определяем недостающие вкладки
    const missingTabs = [
        {
            dataTab: 'photos',
            svgIcon: '<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M6.84 16.44c.76.06 1.74.06 3.16.06 1.42 0 2.4 0 3.16-.06a3.75 3.75 0 0 0 1.43-.32 3.5 3.5 0 0 0 1.53-1.53c.15-.29.26-.69.32-1.43l.03-.63-1.3-1.3c-.3-.3-.5-.5-.67-.64a.86.86 0 0 0-.27-.18.75.75 0 0 0-.46 0 .86.86 0 0 0-.27.18c-.16.13-.36.33-.67.64l-2.3 2.3a.75.75 0 0 1-1.06 0l-.3-.3c-.3-.3-.5-.5-.67-.64a.86.86 0 0 0-.27-.18.75.75 0 0 0-.46 0 .86.86 0 0 0-.27.18c-.16.13-.36.33-.67.64L4.56 15.5c.25.24.53.45.85.6.29.16.69.27 1.43.33zm9.39-6.27.27.27V10c0-1.42 0-2.4-.06-3.16a3.75 3.75 0 0 0-.32-1.43 3.5 3.5 0 0 0-1.53-1.53 3.75 3.75 0 0 0-1.43-.32A43.2 43.2 0 0 0 10 3.5c-1.42 0-2.4 0-3.16.06-.74.06-1.14.17-1.43.32a3.5 3.5 0 0 0-1.53 1.53c-.15.29-.26.69-.32 1.43A43.2 43.2 0 0 0 3.5 10c0 1.42 0 2.4.06 3.16.04.47.1.8.17 1.05l2.04-2.04.02-.02c.28-.28.52-.52.74-.7.23-.2.47-.37.77-.47.46-.15.94-.15 1.4 0 .3.1.54.27.77.46.16.14.34.3.53.5l1.77-1.77.02-.02c.28-.28.52-.52.74-.7.23-.2.47-.37.77-.47.46-.15.94-.15 1.4 0 .3.1.54.27.77.46.22.19.46.43.74.7zM2.54 4.73C2 5.8 2 7.2 2 10c0 2.8 0 4.2.54 5.27a5 5 0 0 0 2.19 2.19C5.8 18 7.2 18 10 18c2.8 0 4.2 0 5.27-.54a5 5 0 0 0 2.19-2.19C18 14.2 18 12.8 18 10c0-2.8 0-4.2-.55-5.27a5 5 0 0 0-2.18-2.19C14.2 2 12.8 2 10 2c-2.8 0-4.2 0-5.27.54a5 5 0 0 0-2.19 2.19zM7.25 6a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5z" fill="currentColor" fill-rule="evenodd"></path></svg>',
            label: 'Фото',
            urlTemplate: 'https://vk.com/albums-{id}'
        },
        {
            dataTab: 'audios',
            svgIcon: '<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="music_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="music_outline_20__Icons-20/music_outline_20"><g id="music_outline_20__music_outline_20"><path d="M0 0h20v20H0z"></path><path d="M14.73 2.05a2.28 2.28 0 0 1 2.75 2.23v7.99c0 3.57-3.5 5.4-5.39 3.51-1.9-1.9-.06-5.38 3.52-5.38h.37V6.76L8 8.43v5.82c0 3.5-3.35 5.34-5.27 3.62l-.11-.1c-1.9-1.9-.06-5.4 3.51-5.4h.37V6.24c0-.64.05-1 .19-1.36l.05-.13c.17-.38.43-.7.76-.93.36-.26.7-.4 1.41-.54ZM6.5 13.88h-.37c-2.32 0-3.34 1.94-2.45 2.82.88.89 2.82-.13 2.82-2.45v-.37Zm9.48-1.98h-.37c-2.32 0-3.34 1.94-2.46 2.82.89.89 2.83-.13 2.83-2.45v-.37Zm-.02-7.78a.78.78 0 0 0-.92-.6L9.06 4.77c-.4.09-.54.15-.68.25a.8.8 0 0 0-.27.33c-.08.18-.1.35-.1.88v.67l7.97-1.67V4.2Z" id="music_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"></path></g></g></g></svg>',
            label: 'Музыка',
            urlTemplate: 'https://vk.com/audios{id}'
        },
        {
            dataTab: 'discussions',
            svgIcon: '<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M6.43 18.89a1.5 1.5 0 0 1-.93-1.39v-2c-.37 0-.72 0-1.02-.03-.37-.03-.8-.1-1.23-.32-.6-.3-1.1-.8-1.4-1.4a3.24 3.24 0 0 1-.32-1.23c-.03-.35-.03-.76-.03-1.19V6.67c0-1.3 0-2.21.13-2.91.14-.77.4-1.46.93-1.98.52-.52 1.2-.8 1.98-.93.7-.13 1.61-.13 2.9-.13h5.7c1.3 0 2.21 0 2.9.13.78.14 1.46.4 1.98.93.53.52.8 1.2.93 1.98.13.7.13 1.61.13 2.9v5.75c0 1.3 0 2.21-.13 2.9-.14.78-.4 1.46-.93 1.98-.52.53-1.2.8-1.98.93-.7.13-1.6.13-2.9.13H8.62c-.41 0-.78 0-1.09.03a5.66 5.66 0 0 1-.92.05H7l-2.57 2.38Zm-2.63-7.18c-.02.4-.02.8.02 1.14.06.8.25 1.3.6 1.7.36.36.9.54 1.7.6.37.03.79.03 1.22.03h.8c.73 0 1.32 0 1.81.1.54.1.92.28 1.22.6.3.3.48.68.6 1.22.07.34.07.76.07 1.48v.58l2.14-1.98c.46-.43.92-.57 1.62-.62.34-.03.73-.03 1.14-.03h5.7c1.1 0 1.76 0 2.26-.1.44-.08.74-.2.97-.42.22-.22.34-.53.42-.97.1-.5.1-1.15.1-2.26V6.67c0-1.1 0-1.76-.1-2.26-.08-.44-.2-.74-.42-.97-.23-.22-.53-.34-.97-.42-.5-.1-1.15-.1-2.26-.1H6.67c-1.1 0-1.76 0-2.26.1-.44.08-.74.2-.97.42-.23.23-.34.53-.42.97-.1.5-.1 1.15-.1 2.26v5.75c0 .43 0 .84.03 1.19Zm14.43-4.21a1 1 0 0 1 0 2h-9a1 1 0 1 1 0-2h9Zm-4 4a1 1 0 0 1 0 2h-5a1 1 0 1 1 0-2h5ZM14 7.5a1 1 0 0 1-1 1h-6a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1Z" fill="currentColor" fill-rule="evenodd"></path></svg>',
            label: 'Обсуждения',
            urlTemplate: 'https://vk.com/board{id}'
        },
      {
            dataTab: 'videos',
            svgIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.32 2h3.36c.96 0 1.72 0 2.33.05.63.05 1.17.16 1.67.41a4.25 4.25 0 0 1 1.86 1.86c.25.5.36 1.04.41 1.67.05.61.05 1.37.05 2.33v3.36c0 .96 0 1.72-.05 2.33a4.39 4.39 0 0 1-.41 1.67 4.25 4.25 0 0 1-1.86 1.86c-.5.25-1.04.36-1.67.41-.61.05-1.38.05-2.33.05H8.32c-.96 0-1.72 0-2.33-.05a4.39 4.39 0 0 1-1.67-.41 4.25 4.25 0 0 1-1.86-1.86 4.39 4.39 0 0 1-.41-1.67C2 13.4 2 12.63 2 11.68V8.32c0-.96 0-1.72.05-2.33.05-.63.16-1.17.41-1.67a4.25 4.25 0 0 1 1.86-1.86c.5-.25 1.04-.36 1.67-.41C6.6 2 7.36 2 8.32 2Zm-2.2 1.54A2.9 2.9 0 0 0 5 3.8 2.75 2.75 0 0 0 3.8 5c-.13.25-.21.57-.26 1.11-.04.55-.04 1.25-.04 2.24v3.3c0 1 0 1.7.04 2.24.05.53.13.86.26 1.1A2.75 2.75 0 0 0 5 16.2c.25.13.57.21 1.11.26.55.04 1.25.04 2.24.04h3.3c1 0 1.7 0 2.24-.04a2.9 2.9 0 0 0 1.1-.26A2.75 2.75 0 0 0 16.2 15c.13-.25.21-.57.26-1.11.04-.55.04-1.25.04-2.24v-3.3c0-1 0-1.7-.04-2.24a2.9 2.9 0 0 0-.26-1.1A2.75 2.75 0 0 0 15 3.8a2.94 2.94 0 0 0-1.11-.26c-.55-.04-1.25-.04-2.24-.04h-3.3c-1 0-1.7 0-2.24.04Zm2.59 4.5a.15.15 0 0 0-.03.07 9.73 9.73 0 0 0 0 3.79l.03.05.04.04a.1.1 0 0 0 .04.01.1.1 0 0 0 .04 0 9.4 9.4 0 0 0 3.12-1.89.15.15 0 0 0 0-.22 9.39 9.39 0 0 0-3.13-1.88.1.1 0 0 0-.04-.01.1.1 0 0 0-.04.01.11.11 0 0 0-.03.04Zm.62-1.44a1.6 1.6 0 0 0-2.12 1.22 11.23 11.23 0 0 0 0 4.37 1.6 1.6 0 0 0 2.13 1.21 10.9 10.9 0 0 0 3.62-2.18c.72-.65.72-1.78 0-2.44A10.9 10.9 0 0 0 9.33 6.6Z" clip-rule="evenodd"></path></svg>',
            label: 'Видео',
            urlTemplate: 'https://vk.com/video/@club{id}'
        },
        {
            dataTab: 'files',
            svgIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.18 1.5H9c-.8 0-1.47 0-2.01.05-.63.05-1.17.16-1.67.41a4.25 4.25 0 0 0-1.86 1.86c-.25.5-.36 1.04-.41 1.67C3 6.1 3 6.86 3 7.82v4.36c0 .95 0 1.71.05 2.33.05.63.16 1.17.41 1.67a4.25 4.25 0 0 0 1.86 1.86c.5.25 1.04.36 1.67.4.61.06 1.37.06 2.33.06h1.36c.96 0 1.72 0 2.33-.05a4.39 4.39 0 0 0 1.67-.41 4.25 4.25 0 0 0 1.86-1.86c.25-.5.36-1.04.41-1.67.05-.62.05-1.38.05-2.33V8.32c0-.48 0-.73-.06-.96-.05-.2-.13-.4-.24-.58-.12-.2-.3-.37-.64-.72l-3.62-3.62a4.27 4.27 0 0 0-.72-.65 2 2 0 0 0-.58-.24c-.23-.05-.48-.05-.96-.05Zm5.32 10.65c0 1 0 1.7-.04 2.24a2.9 2.9 0 0 1-.26 1.1A2.75 2.75 0 0 1 14 16.7c-.25.13-.57.21-1.11.26-.55.04-1.25.04-2.24.04h-1.3c-1 0-1.7 0-2.24-.04a2.9 2.9 0 0 1-1.1-.26 2.75 2.75 0 0 1-1.21-1.2 2.94 2.94 0 0 1-.26-1.11c-.04-.55-.04-1.25-.04-2.24v-4.3c0-1 0-1.7.04-2.24.05-.53.13-.86.26-1.1A2.75 2.75 0 0 1 6 3.3c.25-.13.57-.21 1.11-.26C7.66 3 8.36 3 9.35 3H10v2.35c0 .4 0 .76.02 1.05.03.3.09.61.24.9.21.4.54.73.94.94.29.15.6.21.9.24.29.03.65.02 1.05.02H15v4.6Zm-3.65-9.09c-.24-.07-.37-.1-.48-.12-.13-.03-.26-.04-.45-.04H10V4.3c0-.45 0-.77-.03-1a.97.97 0 0 0-.04-.26.47.47 0 0 1 .13.09l3.62 3.62a.97.97 0 0 1 .09.13 4.37 4.37 0 0 0-.26-.04c-.23-.03-.55-.03-1-.03H11.7c-.18 0-.32 0-.45-.04-.11-.03-.24-.06-.48-.13-.26-.07-.47-.18-.65-.3-.23-.15-.42-.34-.56-.56-.12-.18-.23-.4-.3-.65ZM10.2 14a.9.9 0 0 1-.9-.9.9.9 0 1 1 .9.9Zm0-2.6a.9.9 0 0 1-.9-.9.9.9 0 1 1 .9.9Z" clip-rule="evenodd"></path></svg>',
            label: 'Файлы',
            urlTemplate: 'https://vk.com/docs-{id}'
        },
        {
            dataTab: 'clips',
            svgIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.2 1.5a.85.85 0 0 1 .9.8l.25 3.8a.85.85 0 0 1-1.7.1L6.4 2.4a.85.85 0 0 1 .8-.9Zm5.89.18a.85.85 0 0 1 .58 1.06l-1.35 4.65a.85.85 0 0 1-1.64-.48l1.35-4.65a.85.85 0 0 1 1.06-.58Zm.59 7.08a.75.75 0 0 1 1.05-.08 5.14 5.14 0 0 1 1.77 4.07c0 2.68-2.3 5.75-6.5 5.75-3.12 0-6.5-2.22-6.5-5.75 0-.68.21-1.59.77-2.35C4.85 9.6 5.8 9 7.14 9c.39 0 1.9.13 2.79 1.91a.75.75 0 1 1-1.35.68c-.53-1.08-1.35-1.09-1.44-1.09-.83 0-1.34.35-1.66.79A2.62 2.62 0 0 0 5 12.75C5 15.18 7.4 17 10 17c3.36 0 5-2.4 5-4.25 0-.95-.22-2.06-1.24-2.93a.75.75 0 0 1-.08-1.06Z" clip-rule="evenodd"></path></svg>',
            label: 'Клипы',
            urlTemplate: 'https://vk.com/clips/club{id}'
        },
        {
            dataTab: 'articles',
            svgIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.68 2h8.64c.98 0 1.79 0 2.43.05.67.05 1.28.18 1.82.45a4.5 4.5 0 0 1 1.89 1.89c.27.54.4 1.15.45 1.82.05.64.05 1.45.05 2.43v4.76c0 .98 0 1.79-.05 2.43-.05.67-.18 1.28-.45 1.82a4.5 4.5 0 0 1-1.89 1.89c-.54.27-1.15.4-1.82.45-.64.05-1.45.05-2.43.05H5.68c-.98 0-1.79 0-2.43-.05-.67-.05-1.28-.18-1.82-.45a4.5 4.5 0 0 1-1.89-1.89c-.27-.54-.4-1.15-.45-1.82C0 14.23 0 13.42 0 12.44V7.68c0-.98 0-1.79.05-2.43.05-.67.18-1.28.45-1.82a4.5 4.5 0 0 1 1.89-1.89c.54-.27 1.15-.4 1.82-.45C3.89 2 4.7 2 5.68 2Zm9.3 1.54H5.02a2.8 2.8 0 0 0-1.05.21 3 3 0 0 0-1.26 1.26 2.8 2.8 0 0 0-.21 1.05v7.96c0 .39 0 .71.02.95.02.26.07.51.17.74a3 3 0 0 0 1.68 1.68c.23.1.48.15.74.17.24.02.56.02.95.02h9.96c.39 0 .71 0 .95-.02.26-.02.51-.07.74-.17a3 3 0 0 0 1.68-1.68c.1-.23.15-.48.17-.74.02-.24.02-.56.02-.95V5.06c0-.39 0-.71-.02-.95-.02-.26-.07-.51-.17-.74a3 3 0 0 0-1.68-1.68c-.23-.1-.48-.15-.74-.17-.24-.02-.56-.02-.95-.02ZM3.75 6.75c0-.62.13-1.14.38-1.53.25-.39.6-.69 1.05-.9.44-.21 1.01-.32 1.7-.32h6.24c.68 0 1.26.11 1.7.32.45.21.8.51 1.05.9.25.39.38.91.38 1.53V13.2c0 .62-.13 1.14-.38 1.53-.25.39-.6.69-1.05.9-.44.21-1.01.32-1.7.32H6.88c-.68 0-1.26-.11-1.7-.32-.45-.21-.8-.51-1.05-.9-.25-.39-.38-.91-.38-1.53V6.75Zm6.23 5.32c0 .5-.41.91-.91.91a.91.91 0 0 1-.91-.91V9.18c0-.5.41-.91.91-.91.5 0 .91.41.91.91v2.89Zm1.55 1.11a.71.71 0 0 1-.71-.7v-4a.71.71 0 0 1 .7-.7h3.49c.4 0 .71.31.71.7v4c0 .39-.31.7-.7.7h-3.49Zm-.71-3.3a.3.3 0 0 0-.3.3v2.29c0 .16.13.29.3.29h3.09a.29.29 0 0 0 .3-.29V9.18a.29.29 0 0 0-.3-.29h-3.09Z" clip-rule="evenodd"></path></svg>',
            label: 'Статьи',
            urlTemplate: 'https://vk.com/@public{id}'
        }
    ];

// Функция для добавления недостающих вкладок
const addMissingTabs = (tabsContainer, id) => {
    missingTabs.forEach(tab => {
        if (!tabsContainer.querySelector(`[data-tab="${tab.dataTab}"]`)) {
            const newTab = document.createElement('a');
            newTab.classList.add('ui_tab', '_ui_tab');
            newTab.dataset.tab = tab.dataTab;
            newTab.innerHTML = `${tab.svgIcon}<span>${tab.label}</span>`;
            newTab.href = tab.urlTemplate.replace('{id}', id);
            tabsContainer.appendChild(newTab);
        }
    });
};

// Функция для получения ID группы из элемента на странице
const getid = () => {
    const groupInfoElement = document.querySelector('.group_info_row.more .line_value a');
    const href = groupInfoElement ? groupInfoElement.href : null;
    const match = href ? href.match(/club(\d+)/) : null;
    return match ? match[1] : null;
};

// Наблюдатель за изменениями в DOM
const observer = new MutationObserver((mutationsList) => {
    mutationsList.forEach(mutation => {
        if (mutation.type === 'childList') {
            const tabsContainer = document.querySelector(tabsContainerSelector);
            if (tabsContainer) {
                const id = getid(); // Извлечение ID группы
                if (id) {
                    addMissingTabs(tabsContainer, id);
                }
            }
        }
    });
});


    // Конфигурация наблюдателя
    const observerConfig = { childList: true, subtree: true };

    // Запуск наблюдателя
    observer.observe(document.body, observerConfig);
})();
