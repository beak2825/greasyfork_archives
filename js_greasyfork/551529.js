// ==UserScript==
// @name         恒傲:抖音来客
// @namespace    恒傲:抖音来客
// @version      2025.10.04.0
// @description  抖音来客相关操作脚本
// @author       Cosil
// @match        https://life.douyin.com/*
// @license      MIT
// @icon         data:image/x-icon;base64,AAABAAEAQEAAAAEAIAAoQgAAFgAAACgAAABAAAAAgAAAAAEAIAAAAAAAAEAAABMLAAATCwAAAAAAAAAAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Ha//7pwv/+5rb//+a3//7nt//+89z//vv0//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Lm//7bs//+vWn//q86//60O//+ujz//r89//vDQf/3xkX/9MhJ//DKS//x1nD/9uWn//v23///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8eX//rt///6dNv/+pzn//q06//6xOv/+tjz//rs8//7APf/7xEH/9sdG//LLS//tz1D/59JV/+PVWv/j1Vr/69+D//f11v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+0bH//p9N//6dN//+ozj//qg5//6tOv/+sjv//rY8//67PP/+wD3/+8RB//bHRv/xy0v/7c9Q/+fRVf/j1Vr/3tlf/9ndZP/Z3WT/6uyo//399//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+uYr//o0z//6ZNv/+nzj//qM4//6oOf/+rTr//rE7//62O//+uzz//sA9//vDQf/2x0b/8ctL/+zOUP/o0lX/49Za/97ZX//Z3WT/1eFp/9HjbP/Z6Ij/+Pvt////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////rnz//o00//6UNf/+mTb//p43//6jOP/+qDn//q06//6yO//+tjv//rs8//7APf/6w0D/9shG//HLS//tz1D/6NJV/+PWWv/e2V//2dxk/9Tgaf/P423/y+dy/8/rhv/4/O7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////qXr//ogy//6QNf/+lTb//5o3//6eOP/+ojf//qg5//6tOv/+sTv//7c8//67PP/+wD3/+8NB//bHRv/xy0v/7c9Q/+jSVf/j1lr/3tlf/9ndZP/U4Gn/0ORt/8voc//G63j/yu+M//f97///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wKD//4Aw//6LNP/+kDX//pQ2//6aN//+njf//qM4//6oOf/+rTr//7I7//62O//+uzz//sA9//vEQf/1x0X/8cpL/+3PUP/n0lX/49Za/97ZX//Z3WT/1eFp/8/kbv/L6HP/xut4/8Hvff/X97D/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7OP//oA5//6GM//+izT//pA1//6UNf/+mTf//p43//6jOP/+qDn//qw5//6yO//+tjv//s1t///Yhv/824j/+dqA//LOVv/szlD/59FU/+LVWv/e2V//2dxk/9Tgaf/Q5G7/y+hz/8breP/B733/vvGA/+f6z////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////62F//6AMv/+hzT//os0//6QNf/+lTb//po3//6eOP/+ozn//qg5//63Uv//4rb/////////////////////////////////+vPU/+3egP/j1Vr/3tlf/9ndZP/V4Gn/0ORu/8vnc//G63j/we59/77xgP/G85D///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+DRP//gjP//oc0//6LNP/+kDX//5U2//+aN//+njf//qM4///OkP//+vP/////////////////////////////////////////////////8u23/97ZX//Z3GT/1OBp/9Dkbv/L53P/xut4/8Hvff++8YD/vvGA//f+7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////j1P//oIz//6GM//+izT//pA1//6VNv/+mTb//p43///Rm//////////////////////////////////////////////////////////////////y8sT/2d1k/9TgaP/Q5G7/y+dz/8breP/B7n3/vvGA/77xgP/3/u///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7CI//6AMv/+hzT//os0//6QNf/+lTb//po3//7Cgv///////////////////////////////////////////////////////////////////////////+7wvP/U4Gn/z+Nu/8voc//G63j/we59/77xgP/O9aD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////38v//jUr//oYy//6LNP/+kDX//pU2//6sXP//////////////////////////////////////////////////////////////////////////////////////6fC0/9Dkbv/L6HP/xut4/8Lvff/C8oj/8/zn//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////fy///Cmf/+oFn//qRa///Djv/////////////////////////////////////////////////////////////////////////////////////////////////w99L/2O6W/9Hvkf/Z9a7/9/3v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+7l//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3Yxv/9xav//ces//3ayP/+9fL////////////////////////////////////////////////////////////////////////////////////////////+997///DF///tuv/+997//v31////////////////////////////////////////////////////////////////////////////////////////////7vvf/+L5x//e+MD/5vnQ//f97///////////////////////////////////////////////////////////////////////+a2L//lwL//8bin//XEs//1zLP/8cSr/+3g1//y2kv////////////////////////////////////////////////////////////////////////////3vwP/63W7/9d9j//PkaP/z5Wf/9ORl//blbP/776T//vvr///////////////////////////////////////////////////////////////////////n+c7/xvKO/77xf/++8H//vvGA/73xgP+98YH/zfSh//L85//////////////////////////////////////////////////96uH/9XEy//1wLf/+czD//nMw//10L//9dC7//HQt//t1LP/7cin/+olQ//7t5P////////////////////////////////////////////////////////z1//znmv/34Gj/8udx//Hocf/w6XH/8Opw//Dpbv/x6mz/8+lp//fna//9+Nb////////////////////////////////////////////////////////////f973/v/B8/7/wff++8H7/vvB+/77xf/++8YD/vvGA/73xgf/B8on/5vrQ////////////////////////////////////////////94VQ//1vLf/+czH//nMw//5zMP/9cy///XQt//t0LP/6cyv/+XMp//lxKf/5f0L//uPW/////////////////////////////////////////////vrr//zcc//44m3/9uRv//Tlb//y53D/8edv//Hnbv/y6Gv/8udo//PnZf/252L/+ORc//753/////////////////////////////////////////////v+9v/T9KL/v/B6/7/ve/+/8Hz/v/B9/7/wfv++8X7/vvF//73wgP+98YD/vfGB/8Hyif/2/e///////////////////////////////////MKq//xsKv/+czH//nIx//5yMP/9cy///XMu//10Lf/6cyz/+XMr//hyKv/3byj/9m4p//d2Nv/8x67///////////////////////////////////fh//zddv/73m3/+eFt//fjb//25G7/9ORu//PlbP/z5Wr/9OVm//TkY//24mD/9+Jc//ngV//74mj//vvp//////////////////////////////////f87f/I8If/wO54/8Dwev/A8Hv/v/B8/7/wfP+/8H3/vvB+/77wfv++8ID/vvGA/73xgP++8oL/zvWh//////////////////////////////////yNXf/9cTD//XIw//5yMP/9cS///XIv//1yLf/8ci3/+nIr//hwKf/3cCr/9m4o//VsKP/1ayr/9moq//u0k////////////////////////uu3//7WYf/92mn/+91r//rfbP/54Gz/9+Fs//bia//24mj/9uFk//bhYP/331z/995X//jcU//62k//+9hM//zcYP///PT///////////////////////P74//I74P/wO10/8Dud//A73n/wO96/8Dwe/+/8Hz/v/B9/7/wff++8H7/vvB+/77xgP++8YD/vfGB/73xgf/2/e/////////////////////////18f/7air//XEv//1xL//9cS///nEu//xxLv/8cS3/+nAs//pvKv/5byn/9m0o//VrJ//1aif/9Ggo//RpKf/1aCj/+aqI/////////////uap//7QXP/+1GT//NZm//zaaP/73Gn/+t5p//neaP/53mb/+N5i//jdXv/421j/+NpU//rYT//61kr/+9NG//zRRP/80EH//t18/////////////////+T1u//C6mr/wetu/8Htcv/A7XX/wO54/8Dvef+/73r/wO97/7/wfP+/8H3/vvB9/77wfv++8H//vvB//77xgP++8YH/4vnI////////////////////////7OT//G0s//xwLv/8by3//HAt//xvLf/7cCz/+28s//pvK//5bir/+G0p//ZsKP/1aij/9Gko//RnKP/0Zij/82Yo//RoKv/5ilX//uCa///HVP/+ylr//c9e//7TY//91mT//Nhl//vaZP/722P/+9pg//raW//62Ff/+tZR//nUS//60Ub/+85C//zNP//9yjz//cg6//3HO//+45z//////+DyrP/C5mD/wehm/8HqbP/B7HD/we1z/8Hudv/A7nj/wO96/7/vev+/73v/v/B8/7/wff++8H3/vvB+/77xf/++8YD/vfGA/974wP///////////////////////u3l//tuLP/7biz/+24r//tuK//6biz/+m8s//puK//6bSr/+Gwq//drKP/2aif/9Wgn//VnJ//0Zif/82Uo//NlKP/3cy3//bhB//69Sv/+wE///sVU//7KWf/9z13//dFf//3UYP/81V///NZc//zVWf/71FT//NJO//vQSf/8zET//Mo///zHO//9xTj//cQ3//3CNf/9vzT/+b82/9jfa//C41T/wuVc/8LnZP/B6Wn/wetu/8Hscv/B7nX/wO53/8Dvef/A73r/wPB7/7/ve/+/73z/v/B9/7/wff++8H7/vvB//77xgP/i+cj////////////////////////////7gEb/+W0q//lsKf/5ayn/+Wwp//hsKP/4ayj/92so//drKP/2aib/9Wkn//VnJv/0Zyf/9Gcn//NlJ//1cir//bM7//6zP//+tkT//rtJ//3ATv/+xFP//clV//3MV//9z1n//dBY//3RVf/8z1H//c5M//3MR//8yEH//MU9//zDOP/9wDX//b8z//6+Mv/9uzL/9rsz/8nYQP/D3kf/wuBQ/8LjWP/C5mH/wuhn/8LqbP/B7HH/we1z/8Hudv/A7nj/wO95/8Dvev/A73r/v+97/7/wfP++8H3/vvB9/77wfv++8X//7/vf////////////////////////////+6N6//hqJ//3aif/92km//dpJv/3aSb/9mkm//ZpJv/1aCX/9Wgl//VnJv/1ZyX/9GYl//NkI//3gSz//a83//2qOP/+rTr//bA+//61Q//+ukf//r5L//3DT//+xlH//slS//7KT//+ykz//slK//3HRP/9xT///MI6//2/N//9vTX//bsx//65MP/+tS7/9rYw/8rVOP/D2jv/wtxD/8PfTf/C4lb/w+Ze/8LoZf/C6mr/wutv/8Htc//B7nb/we93/8Dvef/A73n/wO96/7/ve/+/73v/v/B8/7/wff++8H3/wvGG//////////////////////////////////3s5P/0eT//9Wcl//VmI//0ZiP/9GYj//VmI//0ZyT/9GYk//VnJP/0ZiT/9GYj//JkIf/4kS7//bE2//2iMv/+pTT//ak3//2tOv/9sT3//rVA//66RP/+vUf//sBI//7CSP/+xEj//cNF//7DQv/+wT7//b45//28Nv/9uTP//bcw//20L//9ry7/6L0w/8jUMP/E1jD/w9g4/8PbQf/C3kr/w+FU/8LlXP/C52T/wulp/8Lrb//B7HL/we51/8Hud//A7nj/wO95/8Dvef/A73r/wO97/7/ve/+/8Hz/vvB9/+P5x///////////////////////////////////////+My4/+xhH//xZCD/8mQh//NkIf/zZCH/82Qh//NlIv/0ZSL/8mIg//BgHf/4ky7//qc0//2eMP/9oDH//qMy//2mNP/+qDb//a05//2wO//+tD7//rlA//67QP/+vUL//r1A//29Pv/+vDv//bo3//24Nv/9tTL//bMv//6xL//+qy//4b4w/8TVKv/E0yn/xNUv/8PYN//D20D/w95J/8PhU//D5Fz/w+dj/8PpaP/C6m3/wuxx/8LtdP/B7nb/we53/8HveP/A73n/wO95/8Dvev+/73v/v+97/9/3vv/////////////////////////////////////////////////41sb/6G0r/+1fHf/vYR7/72If//BiH//wYh//7l8c/+5nHP/7pTb//p8z//2bMP/+nTH//p8x//2gMf/9ozL//aYz//2pNf/+rTb//rE5//2zOv/+tjv//rc7//63Ov/9tzf//bU2//20NP/9sjH//rAw//2rLv/+py7/3sIv/8XTJP/F0ST/xdMp/8TVMP/E2Dj/xNtB/8PeSv/D4VP/w+Rb/8PnYv/D6Wj/wutt/8LscP/C7nP/we51/8Hud//B7nf/we94/8Dvef/A73r/wO96/9/3vf////////////////////////////////////////////////////////////zw5P/wo0f/6oAl/+lyIv/qcCD/63Uh//WQLv/9qDf//Z41//2bM//9mzL//Zwy//6dMf/9nzD//aIx//2kMf/9pzL//aky//2tNf/+rzX//bE2//2yNv/9sTX//bAz//6wMv/9rzH//qww//2oLv/2qjD/0M4s/8bQH//G0CH/xtEl/8XTKv/E1TH/xNk5/8XcQv/E30v/xOJU/8PlXP/D52P/w+lo/8PrbP/C7HD/wu1z/8Ludf/B7nb/we53/8Hud//B73j/wO95/+P4xf///////////////////////////////////////////////////////////////////////vzz//vVcf/6wUH/+7lA//uuP//8pDz//J85//2cN//9mzb//Zsz//2bM//9nTL//Z4w//2gL//+ojH//aUx//2oMv/9qjH//asy//2sMv/9rTL//a0y//2rMf/9qzD//akw//6lLv/3pC//zdIt/8fPHv/Hzh7/xs8i/8bRJ//F1C3/xdY0/8XZPP/F3EX/xd9O/8TjVv/E5V3/xOhj/8PpaP/D623/w+xw/8Ptc//C7nT/wu52/8Hudv/B7nf/yfGJ//P85v///////////////////////////////////////////////////////////////////////////////////////N+W//q+Rf/7tEP//KpA//ykPP/9nzr//Zw3//2aNP/9mjP//Zwz//2dMf/9nzD//qEw//2kMP/+pTH//aYw//6nMf/9qDH//qgw//6nMP/+pzD//aQv//6gL//ssC//y9In/8jMG//HzR3/x84g/8bQJP/G0iv/xtUx/8XXOP/F2z//xt5I/8TgT//E41j/xOZf/8ToZP/E6mn/xOtt/8PscP/C7XL/wu50/8Ludf/C7nb/yfCH//f97v/////////////////////////////////////////////////////////////////////////////////////////////////95a7/+rxG//uyQ//8qkH//KM9//2eOv/8nDf//Zo0//2aNP/9nTL//Z4w//2gMf/+oS///aIv//6kMf/9pC///qQw//2kL//+pDD//qEu//6aL//ivC//yNYk/8jLGv/IzBz/yM0e/8fPIv/H0Cf/x9Mt/8bVNP/G2Dz/xtxE/8XeTP/F4VP/xeVc/8TmYf/F6Wb/xOpq/8Tsbv/D7HD/w+1y/8Ptc//C7XT/1fOg//v+9v////////////////////////////////////////////////////////////////////////////////////////////////////////////7vzf/8vVL/+7BE//ynQf/8oj///Z47//2bOP/8mjT//Zw0//2dM//9nTH//Z4w//yfL//9oDD//aAw//2gL//+oDD//p0w//6WL//gvC7/ydEe/8jJF//Jyhr/x8sb/8jNIP/IzyX/yNEq/8fUMf/G1jj/xtlA/8bcR//G4FD/xuNX/8XlXf/F52L/xelo/8Tra//E7G7/xOxw/8Ptcf/D7XP/4fa5//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////fo//2+Xv/9rET//KQ///yfPf/9mzv//Zo3//2aNf/+mTL//psy//2bMf/9nDD//Zwx//6cL//9nDD//pcv//edL//Tziz/yssY/8rJFv/JyRf/ycka/8nLHf/JzCH/yM4m/8jRLf/H0zT/x9c8/8faQ//H3kz/xuBT/8XjWf/F5mD/xehl/8Xpaf/F62z/xOtu/8TscP/E7XH/5ffB////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9uj//b9r//2nQ//8nz7//Zs7//2YOP/8lzb//Zc0//2XMv/9lzH//Zkx//2ZMf/+mC///pYw//eYMP/R0S3/zMoY/8vIFv/KyBb/ysgY/8nJG//Jyh7/ycwj/8jOKf/I0DD/x9Q3/8jXP//I20f/x95P/8bhVv/G5Fz/xuZi/8boZv/F6mr/xets/8Trbf/M74L/9Pvk///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9x4n//aA///2aPf/8ljn//ZM1//6TNP/9lDP//ZQx//2VMf/9lC///pEw//GgMP/SyCT/zMgV/8zHFf/Mxxb/y8cW/8rHGf/KyBv/yskf/8nKJP/JzSr/ydAx/8jTOf/I2EH/yNtK/8ffUv/H4lj/x+Vf/8bnY//G6Wf/xupr/8XrbP/M7oD/+P3t///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Nn//9ljv//ZM5//2QNv/9kDX//Y80//2PMf/9jjH//Yox/+WxMP/N0CP/zcYW/83HFv/MxhX/zMYX/8vGFv/Kxhn/y8cc/8rIH//KyiX/ycwr/8nOMv/I0zr/yNdD/8nbS//I3lP/yOJa/8flX//H52T/x+lo/8bqav/U8JH/+/72////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+d61/++pQv/7jjX//ogz//2JM//+hjH/7qAy/9rBL//OzSL/zscZ/87GF//Nxhb/zMUW/8zFFv/LxBf/y8UY/8vFHP/KxiD/ysgl/8nKK//JzjP/ydI7/8nWRP/J2k3/yN5U/8jiW//I5WD/x+dk/8fpaP/j9bX////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////29tn/1tZK/9bHMP/VyDD/0NAs/9DMJ//QyB//z8cc/8/HGv/Oxhn/zcUY/83FF//NxBf/zMMX/8zEGf/LxBz/y8Qg/8vHJv/Kyiz/ys0z/8nRPP/J1kT/ydpN/8jeVP/I4lv/yORg/8fnZf/j9LT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////n55f/b11X/0c0s/9HLKf/Ryyb/0Moj/9DJIP/Pxx3/z8Yb/87GGf/OxBn/zcQY/8zCGP/Mwxr/y8Ic/8vEIf/LxSf/y8kt/8vMNf/J0Tz/ydVF/8naTv/J3lX/yeJb/8zmav/x+dj//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Pzy/+Phff/Rzi7/0cwq/9DMJ//QyiT/0Mkh/8/HHv/PxRv/zsQa/83DGf/NwRr/zMEa/8zCHv/LwyH/zMUo/8vILv/LzDb/ytE9/8rVRv/K2k7/yd1V/8/mb//4/Ov/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6OeY/9LPL//RzSv/0Msn/9DJI//PxyD/z8Ye/8/EHP/Owxv/zcAa/83BG//MwR7/zMIi/8zFKP/Mxy7/y8w1/8rQPf/K1Ub/y9pO/9PkdP/4++v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v7bL/1NI8/9HNK//Ryif/0Mcj/9DGIP/PxB3/zsEb/87AG//OwR3/zcEf/8zCJP/MxCn/zMgv/8vMNv/L0T7/y9ZG/+Lqm/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////b22P/X1Ej/0csq/9HJJv/QxiL/z8Mf/8/CHv/OwB3/zsAe/83BIP/NwiT/zcQq/83IL//LzDf/y9E+/+Xqo///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+fnl/9fSR//RySn/0cYl/9DDIf/PwSD/z8Af/87BIP/OwSH/zcMm/83FK//NyTL/0NBF/+/wwv/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8/PL/4Ntt/9HHKP/QxCT/0MIi/9DBIP/PwSH/zsEj/83DJ//Nxiz/1NBM//n55v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////r56H/1Mkz/9DDJf/QwiL/z8Ei/8/DJf/OxCn/4Nx8//n45v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////08Mj/7eis/+rkn//w7Lz/+fjk////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
// @grant        unsafeWindow
// @grant        GM_xmlhttpRequest
// @downloadURL https://update.greasyfork.org/scripts/551529/%E6%81%92%E5%82%B2%3A%E6%8A%96%E9%9F%B3%E6%9D%A5%E5%AE%A2.user.js
// @updateURL https://update.greasyfork.org/scripts/551529/%E6%81%92%E5%82%B2%3A%E6%8A%96%E9%9F%B3%E6%9D%A5%E5%AE%A2.meta.js
// ==/UserScript==


let pageSign = '';
const processingMap = {};
setInterval(runner, 1000);
function runner() {
	if (location.pathname !== '/p/liteapp/fulfillment-admin/order-list') {
		// console.log('route not match..');
		// 切换页面时清空pageSign
		pageSign = '';
	} else {
		// console.log('route matched!');
		if (document.querySelectorAll(`.lifep-table-header`).length === 0 || document.querySelectorAll(`.lifep-table-body`).length === 0) {
			return;
		}
		// initScriptContainerDom
		const colIndex = getChannelColIndex();
		if (colIndex === -1) throw new Error('未找到成交渠道/带货角色列');
		const rows = Array.from(document.querySelectorAll(`tbody tr`));
		rows.forEach(tr => {
			const channelCell = tr.children[colIndex];
			if (channelCell && !channelCell.querySelector('.script-container')) {
				channelCell.children[0].insertAdjacentHTML('beforeEnd', `<div class="script-container"></div>`);
			}
		});
		const orderIdArr = getPageOrderArr();
		const newPageSign = orderIdArr.join('\n');
		if (pageSign != newPageSign) {
			clearContainers();
		}
		pageSign = newPageSign;
		const channelCells = Array.from(document.querySelectorAll(`tbody .lifep-table-row .script-container`)).map(scriptContainer => scriptContainer.parentElement.parentElement);
		if (channelCells.length !== orderIdArr.length) {
			return;// 保证rows和orderId一一对应
		}
		channelCells.forEach((channelCell, index) => {
			if (channelCell.innerText !== '直播/商家') {
				return;
			}
			let scriptContainer = channelCell.querySelector('.script-container');
			const orderId = orderIdArr[index];
			if (processingMap[orderId] === true) {
				return;
			}
			if (scriptContainer && orderId) {
				processingMap[orderId] = true;
				scriptContainer.innerText = '直播间获取中...'
				getLiveRoomNameByOrderId(orderId).then(liveRoomName => {
					if (liveRoomName) {
						console.log('getLiveRoomName', orderId, liveRoomName)
						scriptContainer.innerText = liveRoomName;
						delete processingMap[orderId];
					}
				}).catch(err => {
					console.log(err);
					scriptContainer.innerText = `(${orderId})获取直播间失败：${err.message}`;
				});
			}
		});
	}
}

function getChannelColIndex() {
	const headers = Array.from(document.querySelectorAll(`thead th`));
	for (const index in headers) {
		if (headers[index].innerText === '成交渠道/带货角色') {
			return index;
		}
	}
	return -1;
}
function clearContainers() {
	Array.from(document.querySelectorAll('.script-container')).forEach(clearContainer);
}

function clearContainer(container) {
	if (container) {
		container.innerText = '';
	}
}

function getPageOrderArr() {
	return Array.from(document.querySelectorAll(`.trade_id_copy_tooltip`))
		.map(e => e.innerText)
		.filter(v => v.startsWith('订单ID'))
		.map(innerText => innerText.replace('订单ID：', '').replace('复制', '').trim());
}

function getOrderDetail(orderId) {
	return new Promise((resolve, reject) => {
		if ('string' !== typeof orderId && !!orderId) {
			reject('请输入正确的订单ID');
		}
		orderId = orderId.trim();
		const life_account_id = Object.values(JSON.parse(localStorage.getItem('root_life_account_id') || '{}'))[0];
		if (!life_account_id) {
			reject('请先登录');
		}
		fetch(`https://life.douyin.com/life/trade_view/v1/management/coupon/sale/get_detail?industry=industry_common&root_life_account_id=${life_account_id}`, {
			"body": JSON.stringify({
				"order_id": orderId,
			}),
			"method": "POST",
			"mode": "cors",
			"credentials": "include"
		}).then(res => res.json())
			.then(res => {
				if (res.status_code !== 0) {
					reject(res.status_msg);
				} else {
					resolve(res.data);
				}
			})
			.catch(err => reject(err))
	})
}

function GMXhr(options) {
	const followFlag = options.redirect == "follow" && !options.fetch;
	if (followFlag) {
		delete options.redirect;
	}
	return new Promise((resolve) => {
		GM_xmlhttpRequest({
			...options,
			onload: async res => {
				if (res.finalUrl !== options.url && followFlag && (res.status >= 300 || res.status < 200)) {
					resolve(await GMXhr({
						...options,
						url: res.finalUrl,
					}));
				} else {
					resolve(res);
				}
			},
			onerror: err => {
				throw err instanceof Error ? err : new Error(err);
			}
		})
	});
}

async function getLiveUrlByOrderId(orderId) {
	return new Promise((resolve, reject) => {
		getOrderDetail(orderId).then(resData => {
			console.log('getOrderDetail', orderId, resData)
			const { data: dataStr } = resData;
			const data = JSON.parse(dataStr);
			const media_url = data?.order_source?.media_url;
			console.log('media_url', media_url)
			if (media_url) {
				resolve(media_url)
			} else {
				reject('查找直播间url失败')
			}
		}).catch(err => {
			reject(err);
		})
	})
}

function getLiveRoomNameByOrderId(orderId) {
	return new Promise((resolve, reject) => {
		getLiveUrlByOrderId(orderId).then(url => {
			getLiveRoomName(url).then(resolve).catch(err => {
				console.log('getLiveRoomNameByOrderId', orderId, err)
				reject(err)
			})
		}).catch(err => {
			console.log('getLiveRoomNameByOrderId', orderId, err)
			reject(err)
		})
	})
}


function getLiveRoomName(url) {
	if (url.includes('webcast.amemv.com')) {
		return getNicinameByWebcast(url);
	}
	throw new Error('不支持的直播间类型：' + url);
}

async function getNicinameByWebcast(url) {
	const { responseText: mediaDom } = await GMXhr({ url, redirect: 'follow' })
	// console.log('mediaDom', mediaDom)
	const nickname = /(?<=\\"nickname\\":\\")(?:[^"\\]|\\\\.)+?(?=\\")/.exec(mediaDom)[0]
	return nickname;
}