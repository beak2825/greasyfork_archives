// ==UserScript==
// @name         TrainingSimulator
// @namespace    https://trophymanager.com
// @version      1.4.1
// @description  Trophymanager: Training Simulator
// @include      https://trophymanager.com/players/*
// @exclude	     https://trophymanager.com/players/
// @exclude      https://trophymanager.com/players/compare/*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/488619/TrainingSimulator.user.js
// @updateURL https://update.greasyfork.org/scripts/488619/TrainingSimulator.meta.js
// ==/UserScript==

const TrainingSimulator_TABLE_BODY_ID = 'tmvn_script_TrainingSimulator_table_body';

const SPECIALTY_ARRAY_FIELD_PLAYER = new Map([
  ['1', 'Strength'],
  ['2', 'Stamina'],
  ['3', 'Pace'],
  ['4', 'Marking'],
  ['5', 'Tackling'],
  ['6', 'Workrate'],
  ['7', 'Positioning'],
  ['8', 'Passing'],
  ['9', 'Crossing'],
  ['10', 'Technique'],
  ['11', 'Heading'],
  ['12', 'Finishing'],
  ['13', 'Longshots'],
  ['14', 'Set Pieces'],
]);

const SPECIALTY_ARRAY_GK_PLAYER = new Map([
  ['1', 'Strength'],
  ['2', 'Stamina'],
  ['3', 'Pace'],
  ['4', 'Handling'],
  ['5', 'One-On-Ones'],
  ['6', 'Reflexes'],
  ['7', 'Aerial Ability'],
  ['8', 'Jumping'],
  ['9', 'Communication'],
  ['10', 'Kicking'],
  ['11', 'Throwing'],
]);


const weightR5 = [
  [0.41029304, 0.18048062, 0.56730138, 1.06344654, 1.02312672, 0.40831256, 0.58235457, 0.12717479, 0.05454137, 0.09089830, 0.42381693, 0.04626272, 0.02199046, 0], // DC
  [0.42126371, 0.18293193, 0.60567629, 0.91904794, 0.89070915, 0.40038476, 0.56146633, 0.15053902, 0.15955429, 0.15682932, 0.42109742, 0.09460329, 0.03589655, 0], // DL/R
  [0.23412419, 0.32032289, 0.62194779, 0.63162534, 0.63143081, 0.45218831, 0.47370658, 0.55054737, 0.17744915, 0.39932519, 0.26915814, 0.16413124, 0.07404301, 0], // DMC
  [0.27276905, 0.26814289, 0.61104798, 0.39865092, 0.42862643, 0.43582015, 0.46617076, 0.44931076, 0.25175412, 0.46446692, 0.29986350, 0.43843061, 0.21494592, 0], // DML/R
  [0.25219260, 0.25112993, 0.56090649, 0.18230261, 0.18376490, 0.45928749, 0.53498118, 0.59461481, 0.09851189, 0.61601950, 0.31243959, 0.65402884, 0.29982016, 0], // MC
  [0.28155678, 0.24090675, 0.60680245, 0.19068879, 0.20018012, 0.45148647, 0.48230007, 0.42982389, 0.26268609, 0.57933805, 0.31712419, 0.65824985, 0.29885649, 0], // ML/R
  [0.22029884, 0.29229690, 0.63248227, 0.09904394, 0.10043602, 0.47469498, 0.52919791, 0.77555880, 0.10531819, 0.71048302, 0.27667115, 0.56813972, 0.21537826, 0], // OMC
  [0.21151292, 0.35804710, 0.88688492, 0.14391236, 0.13769621, 0.46586605, 0.34446036, 0.51377701, 0.59723919, 0.75126119, 0.16550722, 0.29966502, 0.12417045, 0], // OML/R
  [0.35479780, 0.14887553, 0.43273380, 0.00023928, 0.00021111, 0.46931131, 0.57731335, 0.41686333, 0.05607604, 0.62121195, 0.45370457, 1.03660702, 0.43205492, 0], // F
  [0.45462811, 0.30278232, 0.45462811, 0.90925623, 0.45462811, 0.90925623, 0.45462811, 0.45462811, 0.30278232, 0.15139116, 0.15139116]]; // GK

const weightRb = [
  [0.10493615, 0.05208547, 0.07934211, 0.14448971, 0.13159554, 0.06553072, 0.07778375, 0.06669303, 0.05158306, 0.02753168, 0.12055170, 0.01350989, 0.02549169, 0.03887550],	// DC
  [0.07715535, 0.04943315, 0.11627229, 0.11638685, 0.12893778, 0.07747251, 0.06370799, 0.03830611, 0.10361093, 0.06253997, 0.09128094, 0.01314110, 0.02449199, 0.03726305],	// DL/R
  [0.08219824, 0.08668831, 0.07434242, 0.09661001, 0.08894242, 0.08998026, 0.09281287, 0.08868309, 0.04753574, 0.06042619, 0.05396986, 0.05059984, 0.05660203, 0.03060871],	// DMC
  [0.06744248, 0.06641401, 0.09977251, 0.08253749, 0.09709316, 0.09241026, 0.08513703, 0.06127851, 0.10275520, 0.07985941, 0.04618960, 0.03927270, 0.05285911, 0.02697852],	// DML/R
  [0.07304213, 0.08174111, 0.07248656, 0.08482334, 0.07078726, 0.09568392, 0.09464529, 0.09580381, 0.04746231, 0.07093008, 0.04595281, 0.05955544, 0.07161249, 0.03547345],	// MC
  [0.06527363, 0.06410270, 0.09701305, 0.07406706, 0.08563595, 0.09648566, 0.08651209, 0.06357183, 0.10819222, 0.07386495, 0.03245554, 0.05430668, 0.06572005, 0.03279859],	// ML/R
  [0.07842736, 0.07744888, 0.07201150, 0.06734457, 0.05002348, 0.08350204, 0.08207655, 0.11181914, 0.03756112, 0.07486004, 0.06533972, 0.07457344, 0.09781475, 0.02719742],	// OMC
  [0.06545375, 0.06145378, 0.10503536, 0.06421508, 0.07627526, 0.09232981, 0.07763931, 0.07001035, 0.11307331, 0.07298351, 0.04248486, 0.06462713, 0.07038293, 0.02403557],	// OML/R
  [0.07738289, 0.05022488, 0.07790481, 0.01356516, 0.01038191, 0.06495444, 0.07721954, 0.07701905, 0.02680715, 0.07759692, 0.12701687, 0.15378395, 0.12808992, 0.03805251],	// F
  [0.07466384, 0.07466384, 0.07466384, 0.14932769, 0.10452938, 0.14932769, 0.10452938, 0.10344411, 0.07512610, 0.04492581, 0.04479831]	// GK
];

// REC weights
const weightR = [
  [0.653962303361921, 0.330014238020285, 0.562994547223387, 0.891800163983125, 0.871069095865164, 0.454514672470839, 0.555697278549252, 0.42777598627972, 0.338218821750765, 0.134348455965202, 0.796916786677566, 0.048831870932616, 0.116363443378865, 0.282347752982916],	//DC
  [0.565605120229193, 0.430973382039533, 0.917125432457378, 0.815702528287723, 0.99022325015212, 0.547995876625372, 0.522203232914265, 0.309928898819518, 0.837365352274204, 0.483822472259513, 0.656901420858592, 0.137582588344562, 0.163658117596413, 0.303915447383549],	//DL/R
  [0.55838825558912, 0.603683502357502, 0.563792314670998, 0.770425088563048, 0.641965853834719, 0.675495235675077, 0.683863478201805, 0.757342915150728, 0.473070797767482, 0.494107823556837, 0.397547163237438, 0.429660916538242, 0.56364174077388, 0.224791093448809],	//DMC
  [0.582074038075056, 0.420032202680124, 0.7887541874616, 0.726221389774063, 0.722972329840151, 0.737617252827595, 0.62234458453736, 0.466946909655194, 0.814382915598981, 0.561877829393632, 0.367446981999576, 0.360623408340649, 0.390057769678583, 0.249517737311268],	//DML/R
  [0.578431939417021, 0.778134685048085, 0.574726322388294, 0.71400292078636, 0.635403391007978, 0.822308254446722, 0.877857040588335, 0.864265671245476, 0.433450219618618, 0.697164252367046, 0.412568516841575, 0.586627586272733, 0.617905053049757, 0.308426814834866],	//MC
  [0.497429376361348, 0.545347364699553, 0.788280917110089, 0.578724574327427, 0.663235306043286, 0.772537143243647, 0.638706135095199, 0.538453108494387, 0.887935381275257, 0.572515970409641, 0.290549550901104, 0.476180499897665, 0.526149424898544, 0.287001645266184],	//ML/R
  [0.656437768926678, 0.617260722143117, 0.656569986958435, 0.63741054520629, 0.55148452726771, 0.922379789905246, 0.790553566121791, 0.999688557334153, 0.426203575603164, 0.778770912265944, 0.652374065121788, 0.662264393455567, 0.73120100926333, 0.274563618133769],	//OMC
  [0.483341947292063, 0.494773052635464, 0.799434804259974, 0.628789194186491, 0.633847969631333, 0.681354437033551, 0.671233869875345, 0.536121458625519, 0.849389745477645, 0.684067723274814, 0.389732973354501, 0.499972692291964, 0.577231818355874, 0.272773352088982],	//OML/R
  [0.493917051093473, 0.370423904816088, 0.532148929996192, 0.0629206658586336, 0.0904950078155216, 0.415494774080483, 0.54106107545574, 0.468181146095801, 0.158106484131194, 0.461125738338018, 0.83399612271067, 0.999828328674183, 0.827171977606305, 0.253225855459207],	//F
  [0.5, 0.333, 0.5, 1, 0.5, 1, 0.5, 0.5, 0.333, 0.333, 0.333] //GK
];

const positionNames = ["D C", "D L", "D R", "DM C", "DM L", "DM R", "M C", "M L", "M R", "OM C", "OM L", "OM R", "F", "GK"];
const positionNames2 = ["DC", "DL/R", "DMC", "DML/R", "MC", "ML/R", "OMC", "OML/R", "F"];
const positionNames3 = ["DL", "DC", "DR", "DML", "DMC", "DMR", "ML", "MC", "MR", "OML", "OMC", "OMR", "F", "GK"];
const positionFullNames = [
/* EN */["Defender Center", "Defender Left", "Defender Right", "Defensive Midfielder Center", "Defensive Midfielder Left", "Defensive Midfielder Right", "Midfielder Center", "Midfielder Left", "Midfielder Right", "Offensive Midfielder Center", "Offensive Midfielder Left", "Offensive Midfielder Right", "Forward", "Goalkeeper"],
/* JP */["ディフェンダー 中央", "ディフェンダー 左", "ディフェンダー 右", "守備的ミッドフィルダー 中央", "守備的ミッドフィルダー 左", "守備的ミッドフィルダー 右", "ミッドフィルダー 中央", "ミッドフィルダー 左", "ミッドフィルダー 右", "攻撃的ミッドフィルダー 中央", "攻撃的ミッドフィルダー 左", "攻撃的ミッドフィルダー 右", "フォワード", "ゴールキーパー"],
/* P  */["Obrońca środkowy", "Obrońca lewy", "Obrońca prawy", "Defensywny pomocnik środkowy", "Defensywny pomocnik lewy", "Defensywny pomocnik prawy", "Pomocnik środkowy", "Pomocnik lewy", "Pomocnik prawy", "Ofensywny pomocnik środkowy", "Ofensywny pomocnik lewy", "Ofensywny pomocnik prawy", "Napastnik", "Bramkarz"],
/* D  */["Forsvar Centralt", "Forsvar Venstre", "Forsvar Højre", "Defensiv Midtbane Centralt", "Defensiv Midtbane Venstre", "Defensiv Midtbane Højre", "Midtbane Centralt", "Midtbane Venstre", "Midtbane Højre", "Offensiv Midtbane Centralt", "Offensiv Midtbane Venstre", "Offensiv Midtbane Højre", "Angriber", "Målmand"],
/* I  */["Difensore Centrale", "Difensore Sinistro", "Difensore Destro", "Centrocampista Difensivo Centrale", "Centrocampista Difensivo Sinistro", "Centrocampista Difensivo Destro", "Centrocampista Centrale", "Centrocampista Sinistro", "Centrocampista Destro", "Centrocampista Offensivo Centrale", "Centrocampista Offensivo Sinistro", "Centrocampista Offensivo Destro", "Attaccante", "Portiere"],
/* H  */["Defensa Central", "Defensa Izquierdo", "Defensa Derecho", "Mediocampista Defensivo Central", "Mediocampista Defensivo Izquierdo", "Mediocampista Defensivo Derecho", "Mediocampista Central", "Mediocampista Izquierdo", "Mediocampista Derecho", "Mediocampista Ofensivo Central", "Mediocampista Ofensivo Izquierdo", "Mediocampista Ofensivo Derecho", "Delantero", "Portero"],
/* F  */["Défenseur Central", "Défenseur Gauche", "Défenseur Droit", "Milieu défensif Central", "Milieu défensif Gauche", "Milieu défensif Droit", "Milieu Central", "Milieu Gauche", "Milieu Droit", "Milieu offensif Central", "Milieu offensif Gauche", "Milieu offensif Droit", "Attaquant", "Gardien de but"],
/* A  */["Defender Center", "Defender Left", "Defender Right", "Defensive Midfielder Center", "Defensive Midfielder Left", "Defensive Midfielder Right", "Midfielder Center", "Midfielder Left", "Midfielder Right", "Offensive Midfielder Center", "Offensive Midfielder Left", "Offensive Midfielder Right", "Forward", "Goalkeeper"],
/* C  */["Obrambeni Sredina", "Obrambeni Lijevo", "Obrambeni Desno", "Defenzivni vezni Sredina", "Defenzivni vezni Lijevo", "Defenzivni vezni Desno", "Vezni Sredina", "Vezni Lijevo", "Vezni Desno", "Ofenzivni vezni Sredina", "Ofenzivni vezni Lijevo", "Ofenzivni vezni Desno", "Napadač", "Golman"],
/* G  */["Verteidiger Zentral", "Verteidiger Links", "Verteidiger Rechts", "Defensiver Mittelfeldspieler Zentral", "Defensiver Mittelfeldspieler Links", "Defensiver Mittelfeldspieler Rechts", "Mittelfeldspieler Zentral", "Mittelfeldspieler Links", "Mittelfeldspieler Rechts", "Offensiver Mittelfeldspieler Zentral", "Offensiver Mittelfeldspieler Links", "Offensiver Mittelfeldspieler Rechts", "Stürmer", "Torhüter"],
/* PO */["Defesa Centro", "Defesa Esquerdo", "Defesa Direito", "Médio Defensivo Centro", "Médio Defensivo Esquerdo", "Médio Defensivo Direito", "Medio Centro", "Medio Esquerdo", "Medio Direito", "Medio Ofensivo Centro", "Medio Ofensivo Esquerdo", "Medio Ofensivo Direito", "Avançado", "Guarda-Redes"],
/* R  */["Fundas Central", "Fundas Stânga", "Fundas Dreapta", "Mijlocas Defensiv Central", "Mijlocas Defensiv Stânga", "Mijlocas Defensiv Dreapta", "Mijlocas Central", "Mijlocas Stânga", "Mijlocas Dreapta", "Mijlocas Ofensiv Central", "Mijlocas Ofensiv Stânga", "Mijlocas Ofensiv Dreapta", "Atacant", "Portar"],
/* T  */["Defans Orta", "Defans Sol", "Defans Sağ", "Defansif Ortasaha Orta", "Defansif Ortasaha Sol", "Defansif Ortasaha Sağ", "Ortasaha Orta", "Ortasaha Sol", "Ortasaha Sağ", "Ofansif Ortasaha Orta", "Ofansif Ortasaha Sol", "Ofansif Ortasaha Sağ", "Forvet", "Kaleci"],
/* RU */["Defender Center", "Defender Left", "Defender Right", "Defensive Midfielder Center", "Defensive Midfielder Left", "Defensive Midfielder Right", "Midfielder Center", "Midfielder Left", "Midfielder Right", "Offensive Midfielder Center", "Offensive Midfielder Left", "Offensive Midfielder Right", "Forward", "Goalkeeper"],
/* CE */["Obránce Střední", "Obránce Levý", "Obránce Pravý", "Defenzivní Záložník Střední", "Defenzivní Záložník Levý", "Defenzivní Záložník Pravý", "Záložník Střední", "Záložník Levý", "Záložník Pravý", "Ofenzivní záložník Střední", "Ofenzivní záložník Levý", "Ofenzivní záložník Pravý", "Útočník", "Gólman"],
/* HU */["Védő , középső", "Védő , bal oldali", "Védő , jobb oldali", "Védekező Középpályás , középső", "Védekező Középpályás , bal oldali", "Védekező Középpályás , jobb oldali", "Középpályás , középső", "Középpályás , bal oldali", "Középpályás , jobb oldali", "Támadó középpályás , középső", "Támadó középpályás , bal oldali", "Támadó középpályás , jobb oldali", "Csatár", "Kapus"],
/* GE */["მცველი ცენტრალური", "მცველი მარცხენა", "მცველი მარჯვენა", "საყრდენი ნახევარმცველი ცენტრალური", "საყრდენი ნახევარმცველი მარცხენა", "საყრდენი ნახევარმცველი მარჯვენა", "ნახევარმცველი ცენტრალური", "ნახევარმცველი მარცხენა", "ნახევარმცველი მარჯვენა", "შემტევი ნახევარმცველი ცენტრალური", "შემტევი ნახევარმცველი მარცხენა", "შემტევი ნახევარმცველი მარჯვენა", "თავდამსხმელი", "მეკარე"],
/* FI */["Puolustaja Keski", "Puolustaja Vasen", "Puolustaja Oikea", "Puolustava Keskikenttä Keski", "Puolustava Keskikenttä Vasen", "Puolustava Keskikenttä Oikea", "Keskikenttä Keski", "Keskikenttä Vasen", "Keskikenttä Oikea", "Hyökkäävä Keskikenttä Keski", "Hyökkäävä Keskikenttä Vasen", "Hyökkäävä Keskikenttä Oikea", "Hyökkääjä", "Maalivahti"],
/* SV */["Försvarare Central", "Försvarare Vänster", "Försvarare Höger", "Defensiv Mittfältare Central", "Defensiv Mittfältare Vänster", "Defensiv Mittfältare Höger", "Mittfältare Central", "Mittfältare Vänster", "Mittfältare Höger", "Offensiv Mittfältare Central", "Offensiv Mittfältare Vänster", "Offensiv Mittfältare Höger", "Anfallare", "Målvakt"],
/* NO */["Forsvar Sentralt", "Forsvar Venstre", "Forsvar Høyre", "Defensiv Midtbane Sentralt", "Defensiv Midtbane Venstre", "Defensiv Midtbane Høyre", "Midtbane Sentralt", "Midtbane Venstre", "Midtbane Høyre", "Offensiv Midtbane Sentralt", "Offensiv Midtbane Venstre", "Offensiv Midtbane Høyre", "Angrep", "Keeper"],
/* SC */["Defender Centre", "Defender Left", "Defender Richt", "Defensive Midfielder Centre", "Defensive Midfielder Left", "Defensive Midfielder Richt", "Midfielder Centre", "Midfielder Left", "Midfielder Richt", "Offensive Midfielder Centre", "Offensive Midfielder Left", "Offensive Midfielder Richt", "Forward", "Goalkeeper"],
/* VL */["Verdediger Centraal", "Verdediger Links", "Verdediger Rechts", "Verdedigende Middenvelder Centraal", "Verdedigende Middenvelder Links", "Verdedigende Middenvelder Rechts", "Middenvelder Centraal", "Middenvelder Links", "Middenvelder Rechts", "Aanvallende Middenvelder Centraal", "Aanvallende Middenvelder Links", "Aanvallende Middenvelder Rechts", "Aanvaller", "Doelman"],
/* BR */["Zagueiro Central", "Zagueiro Esquerdo", "Zagueiro Direito", "Volante Central", "Volante Esquerdo", "Volante Direito", "Meio-Campista Central", "Meio-Campista Esquerdo", "Meio-Campista Direito", "Meia Ofensivo Central", "Meia Ofensivo Esquerdo", "Meia Ofensivo Direito", "Atacante", "Goleiro"],
/* GR */["Αμυντικός Κεντρικός", "Αμυντικός Αριστερός", "Αμυντικός Δεξιός", "Αμυντικός Μέσος Κεντρικός", "Αμυντικός Μέσος Αριστερός", "Αμυντικός Μέσος Δεξιός", "Μέσος Κεντρικός", "Μέσος Αριστερός", "Μέσος Δεξιός", "Επιθετικός μέσος Κεντρικός", "Επιθετικός μέσος Αριστερός", "Επιθετικός μέσος Δεξιός", "Επιθετικός", "Τερματοφύλακας"],
/* BG */["Защитник Централен", "Защитник Ляв", "Защитник Десен", "Дефанзивен Халф Централен", "Дефанзивен Халф Ляв", "Дефанзивен Халф Десен", "Халф Централен", "Халф Ляв", "Халф Десен", "Атакуващ Халф Централен", "Атакуващ Халф Ляв", "Атакуващ Халф Десен", "Нападател"],
/* ID */["Bek Tengah", "Bek Kiri", "Bek Kanan", "Gelandang Bertahan Tengah", "Gelandang Bertahan Kiri", "Gelandang Bertahan Kanan", "Gelandang Tengah", "Gelandang Kiri", "Gelandang Kanan", "Gelandang Serang Tengah", "Gelandang Serang Kiri", "Gelandang Serang Kanan", "Penyerang", "Penjaga Gawang"],
/* CL */["Defensa Centre", "Defensa Esquerra", "Defensa Dreta", "Migcampista Defensiu Centre", "Migcampista Defensiu Esquerra", "Migcampista Defensiu Dreta", "Migcampista Centre", "Migcampista Esquerra", "Migcampista Dreta", "Migcampista Ofensiu Centre", "Migcampista Ofensiu Esquerra", "Migcampista Ofensiu Dreta", "Davanter", "Porter"],
/* CQ */["後衛 中", "後衛 左", "後衛 右", "防守中場 中", "防守中場 左", "防守中場 右", "中場 中", "中場 左", "中場 右", "進攻中場 中", "進攻中場 左", "進攻中場 右", "前鋒", "龍門"],
/* EE */["Kaitsja Kesk", "Kaitsja Vasak", "Kaitsja Parem", "Kaitsev Kesmängija Kesk", "Kaitsev Kesmängija Vasak", "Kaitsev Kesmängija Parem", "Keskmängija Kesk", "Keskmängija Vasak", "Keskmängija Parem", "Ründav Keskmängija Kesk", "Ründav Keskmängija Vasak", "Ründav Keskmängija Parem", "Ründaja", "Väravavaht"],
/* UA */["Захисник Центральний", "Захисник Лівий", "Захисник Правий", "Опорний півзахисник Центральний", "Опорний півзахисник Лівий", "Опорний півзахисник Правий", "Півзахисник Центральний", "Півзахисник Лівий", "Півзахисник Правий", "Атакувальний півзахисник Центральний", "Атакувальний півзахисник Лівий", "Атакувальний півзахисник Правий", "Нападник", "Воротар"],
];

const MR = Math.round;
const MP = Math.pow;
const ML = Math.log;

const en = new Intl.NumberFormat("en-US");


let FP = [];
let positionArray = [];

const playerId = player_id.toString();
const clubId = document.querySelector('table.info_table a').getAttribute('club_link');

let playerBaseData = {};
let playerFutureData = {};

const phyPeakFieldPlayerIndexs = [0, 1, 2, 10];
const tacPeakFieldPlayerIndexs = [3, 4, 5, 6];
const tecPeakFieldPlayerIndexs = [7, 8, 9, 11, 12, 13];
const phyPeakGkPlayerIndexs = [0, 1, 2, 7];
const tacPeakGkPlayerIndexs = [4, 6, 8];
const tecPeakGkPlayerIndexs = [3, 5, 9, 10];
const pointsAllc = [0, 10, 17, 23, 25];
const trainingCustomDefault = new Array(6).fill('2');



const talentWeightsFieldPlayer = [[3.01, 3.01, 2.01, 2.01, 1.01, 1.01, 1.01, 0.01, 0.01, 0.01],
[3.1325, 3.064444444, 2.1325, 2.064444444, 1.1325, 1.064444444, 1.064444444, 0.1325, 0.064444444, 0.064444444],
[3.255, 3.118888889, 2.255, 2.118888889, 1.255, 1.118888889, 1.118888889, 0.255, 0.118888889, 0.118888889],
[3.3775, 3.173333333, 2.3775, 2.173333333, 1.3775, 1.173333333, 1.173333333, 0.3775, 0.173333333, 0.173333333],
[3.5, 3.227777778, 2.5, 2.227777778, 1.5, 1.227777778, 1.227777778, 0.5, 0.227777778, 0.227777778],
[3.6225, 3.282222222, 2.6225, 2.282222222, 1.6225, 1.282222222, 1.282222222, 0.6225, 0.282222222, 0.282222222],
[3.745, 3.336666667, 2.745, 2.336666667, 1.745, 1.336666667, 1.336666667, 0.745, 0.336666667, 0.336666667],
[3.8675, 3.391111111, 2.8675, 2.391111111, 1.8675, 1.391111111, 1.391111111, 0.8675, 0.391111111, 0.391111111],
[3.99, 3.445555556, 2.99, 2.445555556, 1.99, 1.445555556, 1.445555556, 0.99, 0.445555556, 0.445555556],
[4.01, 3.5, 3.01, 2.5, 2.01, 1.5, 1.5, 1.01, 0.5, 0.5],
[4.056666667, 3.554444444, 3.056666667, 2.554444444, 2.056666667, 1.554444444, 1.554444444, 1.046296296, 0.554444444, 0.554444444],
[4.103333333, 3.608888889, 3.103333333, 2.608888889, 2.103333333, 1.608888889, 1.608888889, 1.082592593, 0.608888889, 0.608888889],
[4.15, 3.663333333, 3.15, 2.663333333, 2.15, 1.663333333, 1.663333333, 1.118888889, 0.663333333, 0.663333333],
[4.196666667, 3.717777778, 3.196666667, 2.717777778, 2.196666667, 1.717777778, 1.717777778, 1.155185185, 0.717777778, 0.717777778],
[4.243333333, 3.772222222, 3.243333333, 2.772222222, 2.243333333, 1.772222222, 1.772222222, 1.191481481, 0.772222222, 0.772222222],
[4.29, 3.826666667, 3.29, 2.826666667, 2.29, 1.826666667, 1.826666667, 1.227777778, 0.826666667, 0.826666667],
[4.336666667, 3.881111111, 3.336666667, 2.881111111, 2.336666667, 1.881111111, 1.881111111, 1.264074074, 0.881111111, 0.881111111],
[4.383333333, 3.935555556, 3.383333333, 2.935555556, 2.383333333, 1.935555556, 1.935555556, 1.30037037, 0.935555556, 0.935555556],
[4.43, 3.99, 3.43, 2.99, 2.43, 1.99, 1.99, 1.336666667, 0.99, 0.99],
[4.476666667, 4.01, 3.476666667, 3.01, 2.476666667, 2.01, 2.01, 1.372962963, 1.01, 1.01],
[4.523333333, 4.067647059, 3.523333333, 3.067647059, 2.523333333, 2.067647059, 2.052608696, 1.409259259, 1.052608696, 1.024202899],
[4.57, 4.125294118, 3.57, 3.125294118, 2.57, 2.125294118, 2.095217391, 1.445555556, 1.095217391, 1.038405797],
[4.616666667, 4.182941176, 3.616666667, 3.182941176, 2.616666667, 2.182941176, 2.137826087, 1.481851852, 1.137826087, 1.052608696],
[4.663333333, 4.240588235, 3.663333333, 3.240588235, 2.663333333, 2.240588235, 2.180434783, 1.518148148, 1.180434783, 1.066811594],
[4.71, 4.298235294, 3.71, 3.298235294, 2.71, 2.298235294, 2.223043478, 1.554444444, 1.223043478, 1.081014493],
[4.756666667, 4.355882353, 3.756666667, 3.355882353, 2.756666667, 2.355882353, 2.265652174, 1.590740741, 1.265652174, 1.095217391],
[4.803333333, 4.413529412, 3.803333333, 3.413529412, 2.803333333, 2.413529412, 2.30826087, 1.627037037, 1.30826087, 1.10942029],
[4.85, 4.471176471, 3.85, 3.471176471, 2.85, 2.471176471, 2.350869565, 1.663333333, 1.350869565, 1.123623188],
[4.896666667, 4.528823529, 3.896666667, 3.528823529, 2.896666667, 2.528823529, 2.393478261, 1.69962963, 1.393478261, 1.137826087],
[4.943333333, 4.586470588, 3.943333333, 3.586470588, 2.943333333, 2.586470588, 2.436086957, 1.735925926, 1.436086957, 1.152028986],
[4.99, 4.644117647, 3.99, 3.644117647, 2.99, 2.644117647, 2.478695652, 1.772222222, 1.478695652, 1.166231884],
[5.01, 4.701764706, 4.01, 3.701764706, 3.01, 2.701764706, 2.521304348, 1.808518519, 1.521304348, 1.180434783],
[5.099090909, 4.759411765, 4.099090909, 3.759411765, 3.099090909, 2.759411765, 2.563913043, 1.844814815, 1.563913043, 1.194637681],
[5.188181818, 4.817058824, 4.188181818, 3.817058824, 3.188181818, 2.817058824, 2.606521739, 1.881111111, 1.606521739, 1.20884058],
[5.277272727, 4.874705882, 4.277272727, 3.874705882, 3.277272727, 2.874705882, 2.649130435, 1.917407407, 1.649130435, 1.223043478],
[5.366363636, 4.932352941, 4.366363636, 3.932352941, 3.366363636, 2.932352941, 2.69173913, 1.953703704, 1.69173913, 1.237246377],
[5.455454545, 4.99, 4.455454545, 3.99, 3.455454545, 2.99, 2.734347826, 1.99, 1.734347826, 1.251449275],
[5.544545455, 5.01, 4.544545455, 4.01, 3.544545455, 3.01, 2.776956522, 2.01, 1.776956522, 1.265652174],
[5.633636364, 5.099090909, 4.633636364, 4.099090909, 3.633636364, 3.099090909, 2.819565217, 2.099090909, 1.819565217, 1.279855072],
[5.722727273, 5.188181818, 4.722727273, 4.188181818, 3.722727273, 3.188181818, 2.862173913, 2.188181818, 1.862173913, 1.294057971],
[5.811818182, 5.277272727, 4.811818182, 4.277272727, 3.811818182, 3.277272727, 2.904782609, 2.277272727, 1.904782609, 1.30826087],
[5.900909091, 5.366363636, 4.900909091, 4.366363636, 3.900909091, 3.366363636, 2.947391304, 2.366363636, 1.947391304, 1.322463768],
[5.99, 5.455454545, 4.99, 4.455454545, 3.99, 3.455454545, 2.99, 2.455454545, 1.99, 1.336666667],
[6.01, 5.544545455, 5.01, 4.544545455, 4.01, 3.544545455, 3.01, 2.544545455, 2.01, 1.350869565],
[6.091666667, 5.633636364, 5.091666667, 4.633636364, 4.091666667, 3.633636364, 3.091666667, 2.633636364, 2.031777778, 1.365072464],
[6.173333333, 5.722727273, 5.173333333, 4.722727273, 4.173333333, 3.722727273, 3.173333333, 2.722727273, 2.053555556, 1.379275362],
[6.255, 5.811818182, 5.255, 4.811818182, 4.255, 3.811818182, 3.255, 2.811818182, 2.075333333, 1.393478261],
[6.336666667, 5.900909091, 5.336666667, 4.900909091, 4.336666667, 3.900909091, 3.336666667, 2.900909091, 2.097111111, 1.407681159],
[6.418333333, 5.99, 5.418333333, 4.99, 4.418333333, 3.99, 3.418333333, 2.99, 2.118888889, 1.421884058],
[6.5, 6.01, 5.5, 5.01, 4.5, 4.01, 3.5, 3.01, 2.140666667, 1.436086957],
[6.581666667, 6.091666667, 5.581666667, 5.091666667, 4.581666667, 4.091666667, 3.581666667, 3.023611111, 2.162444444, 1.450289855],
[6.663333333, 6.173333333, 5.663333333, 5.173333333, 4.663333333, 4.173333333, 3.663333333, 3.037222222, 2.184222222, 1.464492754],
[6.745, 6.255, 5.745, 5.255, 4.745, 4.255, 3.745, 3.050833333, 2.206, 1.478695652],
[6.826666667, 6.336666667, 5.826666667, 5.336666667, 4.826666667, 4.336666667, 3.826666667, 3.064444444, 2.227777778, 1.492898551],
[6.908333333, 6.418333333, 5.908333333, 5.418333333, 4.908333333, 4.418333333, 3.908333333, 3.078055556, 2.249555556, 1.507101449],
[6.99, 6.5, 5.99, 5.5, 4.99, 4.5, 3.99, 3.091666667, 2.271333333, 1.521304348],
[7.01, 6.581666667, 6.01, 5.581666667, 5.01, 4.581666667, 4.01, 3.105277778, 2.293111111, 1.535507246],
[7.15, 6.663333333, 6.064444444, 5.663333333, 5.064444444, 4.663333333, 4.025076923, 3.118888889, 2.314888889, 1.549710145],
[7.29, 6.745, 6.118888889, 5.745, 5.118888889, 4.745, 4.040153846, 3.1325, 2.336666667, 1.563913043],
[7.43, 6.826666667, 6.173333333, 5.826666667, 5.173333333, 4.826666667, 4.055230769, 3.146111111, 2.358444444, 1.578115942],
[7.57, 6.908333333, 6.227777778, 5.908333333, 5.227777778, 4.908333333, 4.070307692, 3.159722222, 2.380222222, 1.592318841],
[7.71, 6.99, 6.282222222, 5.99, 5.282222222, 4.99, 4.085384615, 3.173333333, 2.402, 1.606521739],
[7.85, 7.01, 6.336666667, 6.01, 5.336666667, 5.01, 4.100461538, 3.186944444, 2.423777778, 1.620724638],
[7.99, 7.091666667, 6.391111111, 6.091666667, 5.391111111, 5.026610169, 4.115538462, 3.200555556, 2.445555556, 1.634927536],
[8.01, 7.173333333, 6.445555556, 6.173333333, 5.445555556, 5.043220339, 4.130615385, 3.214166667, 2.467333333, 1.649130435],
[8.085384615, 7.255, 6.5, 6.255, 5.5, 5.059830508, 4.145692308, 3.227777778, 2.489111111, 1.663333333],
[8.160769231, 7.336666667, 6.554444444, 6.336666667, 5.554444444, 5.076440678, 4.160769231, 3.241388889, 2.510888889, 1.677536232],
[8.236153846, 7.418333333, 6.608888889, 6.418333333, 5.608888889, 5.093050847, 4.175846154, 3.255, 2.532666667, 1.69173913],
[8.311538462, 7.5, 6.663333333, 6.5, 5.663333333, 5.109661017, 4.190923077, 3.268611111, 2.554444444, 1.705942029],
[8.386923077, 7.581666667, 6.717777778, 6.581666667, 5.717777778, 5.126271186, 4.206, 3.282222222, 2.576222222, 1.720144928],
[8.462307692, 7.663333333, 6.772222222, 6.663333333, 5.772222222, 5.142881356, 4.221076923, 3.295833333, 2.598, 1.734347826],
[8.537692308, 7.745, 6.826666667, 6.745, 5.826666667, 5.159491525, 4.236153846, 3.309444444, 2.619777778, 1.748550725],
[8.613076923, 7.826666667, 6.881111111, 6.826666667, 5.881111111, 5.176101695, 4.251230769, 3.323055556, 2.641555556, 1.762753623],
[8.688461538, 7.908333333, 6.935555556, 6.908333333, 5.935555556, 5.192711864, 4.266307692, 3.336666667, 2.663333333, 1.776956522],
[8.763846154, 7.99, 6.99, 6.99, 5.99, 5.209322034, 4.281384615, 3.350277778, 2.685111111, 1.79115942],
[8.839230769, 8.01, 7.01, 7.01, 6.01, 5.225932203, 4.296461538, 3.363888889, 2.706888889, 1.805362319],
[8.914615385, 8.085384615, 7.085384615, 7.031304348, 6.031304348, 5.242542373, 4.311538462, 3.3775, 2.728666667, 1.819565217],
[8.99, 8.160769231, 7.160769231, 7.052608696, 6.052608696, 5.259152542, 4.326615385, 3.391111111, 2.750444444, 1.833768116],
[9.01, 8.236153846, 7.236153846, 7.073913043, 6.073913043, 5.275762712, 4.341692308, 3.404722222, 2.772222222, 1.847971014],
[9.108, 8.311538462, 7.311538462, 7.095217391, 6.095217391, 5.292372881, 4.356769231, 3.418333333, 2.794, 1.862173913],
[9.206, 8.386923077, 7.386923077, 7.116521739, 6.116521739, 5.308983051, 4.371846154, 3.431944444, 2.815777778, 1.876376812],
[9.304, 8.462307692, 7.462307692, 7.137826087, 6.137826087, 5.32559322, 4.386923077, 3.445555556, 2.837555556, 1.89057971],
[9.402, 8.537692308, 7.537692308, 7.159130435, 6.159130435, 5.34220339, 4.402, 3.459166667, 2.859333333, 1.904782609],
[9.5, 8.613076923, 7.613076923, 7.180434783, 6.180434783, 5.358813559, 4.417076923, 3.472777778, 2.881111111, 1.918985507],
[9.598, 8.688461538, 7.688461538, 7.20173913, 6.20173913, 5.375423729, 4.432153846, 3.486388889, 2.902888889, 1.933188406],
[9.696, 8.763846154, 7.763846154, 7.223043478, 6.223043478, 5.392033898, 4.447230769, 3.5, 2.924666667, 1.947391304],
[9.794, 8.839230769, 7.839230769, 7.244347826, 6.244347826, 5.408644068, 4.462307692, 3.513611111, 2.946444444, 1.961594203],
[9.892, 8.914615385, 7.914615385, 7.265652174, 6.265652174, 5.425254237, 4.477384615, 3.527222222, 2.968222222, 1.975797101],
[9.99, 8.99, 7.99, 7.286956522, 6.286956522, 5.441864407, 4.492461538, 3.540833333, 2.99, 1.99],
[10.01, 9.01, 8.01, 7.30826087, 6.30826087, 5.458474576, 4.507538462, 3.554444444, 3.01, 2.01],
[10.08, 9.08, 8.040625, 7.329565217, 6.329565217, 5.475084746, 4.522615385, 3.568055556, 3.040625, 2.040625],
[10.15, 9.15, 8.07125, 7.350869565, 6.350869565, 5.491694915, 4.537692308, 3.581666667, 3.07125, 2.07125],
[10.22, 9.22, 8.101875, 7.372173913, 6.372173913, 5.508305085, 4.552769231, 3.595277778, 3.101875, 2.101875],
[10.29, 9.29, 8.1325, 7.393478261, 6.393478261, 5.524915254, 4.567846154, 3.608888889, 3.1325, 2.1325],
[10.36, 9.36, 8.163125, 7.414782609, 6.414782609, 5.541525424, 4.582923077, 3.6225, 3.163125, 2.163125],
[10.43, 9.43, 8.19375, 7.436086957, 6.436086957, 5.558135593, 4.598, 3.636111111, 3.19375, 2.19375],
[10.5, 9.5, 8.224375, 7.457391304, 6.457391304, 5.574745763, 4.613076923, 3.649722222, 3.224375, 2.224375],
[10.57, 9.57, 8.255, 7.478695652, 6.478695652, 5.591355932, 4.628153846, 3.663333333, 3.255, 2.255],
[10.64, 9.64, 8.285625, 7.5, 6.5, 5.607966102, 4.643230769, 3.676944444, 3.285625, 2.285625],
[10.71, 9.71, 8.31625, 7.521304348, 6.521304348, 5.624576271, 4.658307692, 3.690555556, 3.31625, 2.31625],
[10.78, 9.78, 8.346875, 7.542608696, 6.542608696, 5.641186441, 4.673384615, 3.704166667, 3.346875, 2.346875],
[10.85, 9.85, 8.3775, 7.563913043, 6.563913043, 5.65779661, 4.688461538, 3.717777778, 3.3775, 2.3775],
[10.92, 9.92, 8.408125, 7.585217391, 6.585217391, 5.67440678, 4.703538462, 3.731388889, 3.408125, 2.408125],
[10.99, 9.99, 8.43875, 7.606521739, 6.606521739, 5.691016949, 4.718615385, 3.745, 3.43875, 2.43875],
[11.01, 10.01, 8.469375, 7.627826087, 6.627826087, 5.707627119, 4.733692308, 3.758611111, 3.469375, 2.469375],
[11.08, 10.06764706, 8.5, 7.649130435, 6.649130435, 5.724237288, 4.748769231, 3.772222222, 3.5, 2.5],
[11.15, 10.12529412, 8.530625, 7.670434783, 6.670434783, 5.740847458, 4.763846154, 3.785833333, 3.530625, 2.530625],
[11.22, 10.18294118, 8.56125, 7.69173913, 6.69173913, 5.757457627, 4.778923077, 3.799444444, 3.56125, 2.56125],
[11.29, 10.24058824, 8.591875, 7.713043478, 6.713043478, 5.774067797, 4.794, 3.813055556, 3.591875, 2.591875],
[11.36, 10.29823529, 8.6225, 7.734347826, 6.734347826, 5.790677966, 4.809076923, 3.826666667, 3.6225, 2.6225],
[11.43, 10.35588235, 8.653125, 7.755652174, 6.755652174, 5.807288136, 4.824153846, 3.840277778, 3.653125, 2.653125],
[11.5, 10.41352941, 8.68375, 7.776956522, 6.776956522, 5.823898305, 4.839230769, 3.853888889, 3.68375, 2.68375],
[11.57, 10.47117647, 8.714375, 7.79826087, 6.79826087, 5.840508475, 4.854307692, 3.8675, 3.714375, 2.714375],
[11.64, 10.52882353, 8.745, 7.819565217, 6.819565217, 5.857118644, 4.869384615, 3.881111111, 3.745, 2.745],
[11.71, 10.58647059, 8.775625, 7.840869565, 6.840869565, 5.873728814, 4.884461538, 3.894722222, 3.775625, 2.775625],
[11.78, 10.64411765, 8.80625, 7.862173913, 6.862173913, 5.890338983, 4.899538462, 3.908333333, 3.80625, 2.80625],
[11.85, 10.70176471, 8.836875, 7.883478261, 6.883478261, 5.906949153, 4.914615385, 3.921944444, 3.836875, 2.836875],
[11.92, 10.75941176, 8.8675, 7.904782609, 6.904782609, 5.923559322, 4.929692308, 3.935555556, 3.8675, 2.8675],
[11.99, 10.81705882, 8.898125, 7.926086957, 6.926086957, 5.940169492, 4.944769231, 3.949166667, 3.898125, 2.898125],
[12.01, 10.87470588, 8.92875, 7.947391304, 6.947391304, 5.956779661, 4.959846154, 3.962777778, 3.92875, 2.92875],
[12.25, 10.93235294, 8.959375, 7.968695652, 6.968695652, 5.973389831, 4.974923077, 3.976388889, 3.959375, 2.959375],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99],
[12.5, 10.99, 8.99, 7.99, 6.99, 5.99, 4.99, 3.99, 3.99, 2.99]];

const talentWeightsGkPlayer = [
  [11.78230769, 10.74269231, 9.876346154, 9.01, 3.01, 3.01, 3.01, 3.01, 3.01, 3.01, 3.01, 2.01, 2.01, 1.01],
  [11.82977208, 10.78596866, 9.916132478, 9.046296296, 3.099090909, 3.091666667, 3.08, 3.064444444, 3.047692308, 3.045, 3.033333333, 2.052608696, 2.033333333, 1.054545455],
  [11.87723647, 10.82924501, 9.955918804, 9.082592593, 3.188181818, 3.173333333, 3.15, 3.118888889, 3.085384615, 3.08, 3.056666667, 2.095217391, 2.056666667, 1.099090909],
  [11.92470085, 10.87252137, 9.995705128, 9.118888889, 3.277272727, 3.255, 3.22, 3.173333333, 3.123076923, 3.115, 3.08, 2.137826087, 2.08, 1.143636364],
  [11.97216524, 10.91579772, 10.03549145, 9.155185185, 3.366363636, 3.336666667, 3.29, 3.227777778, 3.160769231, 3.15, 3.103333333, 2.180434783, 2.103333333, 1.188181818],
  [12.01962963, 10.95907407, 10.07527778, 9.191481481, 3.455454545, 3.418333333, 3.36, 3.282222222, 3.198461538, 3.185, 3.126666667, 2.223043478, 2.126666667, 1.232727273],
  [12.06709402, 11.00235043, 10.1150641, 9.227777778, 3.544545455, 3.5, 3.43, 3.336666667, 3.236153846, 3.22, 3.15, 2.265652174, 2.15, 1.277272727],
  [12.1145584, 11.04562678, 10.15485043, 9.264074074, 3.633636364, 3.581666667, 3.5, 3.391111111, 3.273846154, 3.255, 3.173333333, 2.30826087, 2.173333333, 1.321818182],
  [12.16202279, 11.08890313, 10.19463675, 9.30037037, 3.722727273, 3.663333333, 3.57, 3.445555556, 3.311538462, 3.29, 3.196666667, 2.350869565, 2.196666667, 1.366363636],
  [12.20948718, 11.13217949, 10.23442308, 9.336666667, 3.811818182, 3.745, 3.64, 3.5, 3.349230769, 3.325, 3.22, 2.393478261, 2.22, 1.410909091],
  [12.25695157, 11.17545584, 10.2742094, 9.372962963, 3.900909091, 3.826666667, 3.71, 3.554444444, 3.386923077, 3.36, 3.243333333, 2.436086957, 2.243333333, 1.455454545],
  [12.30441595, 11.21873219, 10.31399573, 9.409259259, 3.99, 3.908333333, 3.78, 3.608888889, 3.424615385, 3.395, 3.266666667, 2.478695652, 2.266666667, 1.5],
  [12.35188034, 11.26200855, 10.35378205, 9.445555556, 4.01, 3.99, 3.85, 3.663333333, 3.462307692, 3.43, 3.29, 2.521304348, 2.29, 1.544545455],
  [12.39934473, 11.3052849, 10.39356838, 9.481851852, 4.118888889, 4.01, 3.92, 3.717777778, 3.5, 3.465, 3.313333333, 2.563913043, 2.313333333, 1.589090909],
  [12.44680912, 11.34856125, 10.4333547, 9.518148148, 4.227777778, 4.099090909, 3.99, 3.772222222, 3.537692308, 3.5, 3.336666667, 2.606521739, 2.336666667, 1.633636364],
  [12.4942735, 11.39183761, 10.47314103, 9.554444444, 4.336666667, 4.188181818, 4.01, 3.826666667, 3.575384615, 3.535, 3.36, 2.649130435, 2.36, 1.678181818],
  [12.54173789, 11.43511396, 10.51292735, 9.590740741, 4.445555556, 4.277272727, 4.085384615, 3.881111111, 3.613076923, 3.57, 3.383333333, 2.69173913, 2.383333333, 1.722727273],
  [12.58920228, 11.47839031, 10.55271368, 9.627037037, 4.554444444, 4.366363636, 4.160769231, 3.935555556, 3.650769231, 3.605, 3.406666667, 2.734347826, 2.406666667, 1.767272727],
  [12.63666667, 11.52166667, 10.5925, 9.663333333, 4.663333333, 4.455454545, 4.236153846, 3.99, 3.688461538, 3.64, 3.43, 2.776956522, 2.43, 1.811818182],
  [12.68413105, 11.56494302, 10.63228633, 9.69962963, 4.772222222, 4.544545455, 4.311538462, 4.01, 3.726153846, 3.675, 3.453333333, 2.819565217, 2.453333333, 1.856363636],
  [12.73159544, 11.60821937, 10.67207265, 9.735925926, 4.881111111, 4.633636364, 4.386923077, 4.075333333, 3.763846154, 3.71, 3.476666667, 2.862173913, 2.476666667, 1.900909091],
  [12.77905983, 11.65149573, 10.71185897, 9.772222222, 4.99, 4.722727273, 4.462307692, 4.140666667, 3.801538462, 3.745, 3.5, 2.904782609, 2.5, 1.945454545],
  [12.82652422, 11.69477208, 10.7516453, 9.808518519, 5.01, 4.811818182, 4.537692308, 4.206, 3.839230769, 3.78, 3.523333333, 2.947391304, 2.523333333, 1.99],
  [12.8739886, 11.73804843, 10.79143162, 9.844814815, 5.118888889, 4.900909091, 4.613076923, 4.271333333, 3.876923077, 3.815, 3.546666667, 2.99, 2.546666667, 2.01],
  [12.92145299, 11.78132479, 10.83121795, 9.881111111, 5.227777778, 4.99, 4.688461538, 4.336666667, 3.914615385, 3.85, 3.57, 3.01, 2.57, 2.022894737],
  [12.96891738, 11.82460114, 10.87100427, 9.917407407, 5.336666667, 5.01, 4.763846154, 4.402, 3.952307692, 3.885, 3.593333333, 3.023066667, 2.593333333, 2.035789474],
  [13.01638177, 11.86787749, 10.9107906, 9.953703704, 5.445555556, 5.099090909, 4.839230769, 4.467333333, 3.99, 3.92, 3.616666667, 3.036133333, 2.616666667, 2.048684211],
  [13.06384615, 11.91115385, 10.95057692, 9.99, 5.554444444, 5.188181818, 4.914615385, 4.532666667, 4.01, 3.955, 3.64, 3.0492, 2.64, 2.061578947],
  [13.09, 11.935, 10.9725, 10.01, 5.663333333, 5.277272727, 4.99, 4.598, 4.075333333, 3.99, 3.663333333, 3.062266667, 2.663333333, 2.074473684],
  [13.51717949, 12.32448718, 11.33057693, 10.33666667, 5.772222222, 5.366363636, 5.01, 4.663333333, 4.140666667, 4.01, 3.686666667, 3.075333333, 2.686666667, 2.087368421],
  [13.94435897, 12.71397436, 11.68865384, 10.66333333, 5.881111111, 5.455454545, 5.085384615, 4.728666667, 4.206, 4.024, 3.71, 3.0884, 2.71, 2.100263158],
  [14.37153846, 13.10346154, 12.04673077, 10.99, 5.99, 5.544545455, 5.160769231, 4.794, 4.271333333, 4.038, 3.733333333, 3.101466667, 2.733333333, 2.113157895],
  [14.39769231, 13.12730769, 12.06865385, 11.01, 6.01, 5.633636364, 5.236153846, 4.859333333, 4.336666667, 4.052, 3.756666667, 3.114533333, 2.756666667, 2.126052632],
  [14.8248718, 13.51679488, 12.42673077, 11.33666667, 6.118888889, 5.722727273, 5.311538462, 4.924666667, 4.402, 4.066, 3.78, 3.1276, 2.78, 2.138947368],
  [15.25205128, 13.90628205, 12.78480769, 11.66333333, 6.227777778, 5.811818182, 5.386923077, 4.99, 4.467333333, 4.08, 3.803333333, 3.140666667, 2.803333333, 2.151842105],
  [15.67923077, 14.29576923, 13.14288462, 11.99, 6.336666667, 5.900909091, 5.462307692, 5.01, 4.532666667, 4.094, 3.826666667, 3.153733333, 2.826666667, 2.164736842],
  [15.70538462, 14.31961538, 13.16480769, 12.01, 6.445555556, 5.99, 5.537692308, 5.045, 4.598, 4.108, 3.85, 3.1668, 2.85, 2.177631579],
  [16.13256411, 14.70910257, 13.52288462, 12.33666667, 6.554444444, 6.01, 5.613076923, 5.08, 4.663333333, 4.122, 3.873333333, 3.179866667, 2.873333333, 2.190526316],
  [16.55974359, 15.09858974, 13.88096153, 12.66333333, 6.663333333, 6.108, 5.688461538, 5.115, 4.728666667, 4.136, 3.896666667, 3.192933333, 2.896666667, 2.203421053],
  [16.98692308, 15.48807692, 14.23903846, 12.99, 6.772222222, 6.206, 5.763846154, 5.15, 4.794, 4.15, 3.92, 3.206, 2.92, 2.216315789],
  [17.01307692, 15.51192308, 14.26096154, 13.01, 6.881111111, 6.304, 5.839230769, 5.185, 4.859333333, 4.164, 3.943333333, 3.219066667, 2.943333333, 2.229210526],
  [17.44025641, 15.90141026, 14.61903847, 13.33666667, 6.99, 6.402, 5.914615385, 5.22, 4.924666667, 4.178, 3.966666667, 3.232133333, 2.966666667, 2.242105263],
  [17.86743589, 16.29089743, 14.97711538, 13.66333333, 7.01, 6.5, 5.99, 5.255, 4.99, 4.192, 3.99, 3.2452, 2.99, 2.255],
  [18.29461538, 16.68038462, 15.33519231, 13.99, 7.118888889, 6.598, 6.01, 5.29, 5.01, 4.206, 4.01, 3.258266667, 3.01, 2.267894737],
  [18.32076923, 16.70423077, 15.35711538, 14.01, 7.227777778, 6.696, 6.059, 5.325, 5.0275, 4.22, 4.0275, 3.271333333, 3.0275, 2.280789474],
  [18.74794872, 17.09371795, 15.71519231, 14.33666667, 7.336666667, 6.794, 6.108, 5.36, 5.045, 4.234, 4.045, 3.2844, 3.045, 2.293684211],
  [19.1751282, 17.48320512, 16.07326923, 14.66333333, 7.445555556, 6.892, 6.157, 5.395, 5.0625, 4.248, 4.0625, 3.297466667, 3.0625, 2.306578947],
  [19.60230769, 17.87269231, 16.43134615, 14.99, 7.554444444, 6.99, 6.206, 5.43, 5.08, 4.262, 4.08, 3.310533333, 3.08, 2.319473684],
  [19.62846154, 17.89653846, 16.45326923, 15.01, 7.663333333, 7.01, 6.255, 5.465, 5.0975, 4.276, 4.0975, 3.3236, 3.0975, 2.332368421],
  [20.26923077, 18.48076923, 16.99038462, 15.5, 7.772222222, 7.099090909, 6.304, 5.5, 5.115, 4.29, 4.115, 3.336666667, 3.115, 2.345263158],
  [20.91, 19.065, 17.5275, 15.99, 7.881111111, 7.188181818, 6.353, 5.535, 5.1325, 4.304, 4.1325, 3.349733333, 3.1325, 2.358157895],
  [20.93615385, 19.08884615, 17.54942308, 16.01, 7.99, 7.277272727, 6.402, 5.57, 5.15, 4.318, 4.15, 3.3628, 3.15, 2.371052632],
  [21.36333334, 19.47833334, 17.9075, 16.33666667, 8.01, 7.366363636, 6.451, 5.605, 5.1675, 4.332, 4.1675, 3.375866667, 3.1675, 2.383947368],
  [21.79051282, 19.86782051, 18.26557692, 16.66333333, 8.118888889, 7.455454545, 6.5, 5.64, 5.185, 4.346, 4.185, 3.388933333, 3.185, 2.396842105],
  [22.21769231, 20.25730769, 18.62365385, 16.99, 8.227777778, 7.544545455, 6.549, 5.675, 5.2025, 4.36, 4.2025, 3.402, 3.2025, 2.409736842],
  [22.24384615, 20.28115385, 18.64557692, 17.01, 8.336666667, 7.633636364, 6.598, 5.71, 5.22, 4.374, 4.22, 3.415066667, 3.22, 2.422631579],
  [22.67102565, 20.67064103, 19.00365385, 17.33666667, 8.445555556, 7.722727273, 6.647, 5.745, 5.2375, 4.388, 4.2375, 3.428133333, 3.2375, 2.435526316],
  [23.09820512, 21.0601282, 19.36173077, 17.66333333, 8.554444444, 7.811818182, 6.696, 5.78, 5.255, 4.402, 4.255, 3.4412, 3.255, 2.448421053],
  [23.52538462, 21.44961538, 19.71980769, 17.99, 8.663333333, 7.900909091, 6.745, 5.815, 5.2725, 4.416, 4.2725, 3.454266667, 3.2725, 2.461315789],
  [23.55153846, 21.47346154, 19.74173077, 18.01, 8.772222222, 7.99, 6.794, 5.85, 5.29, 4.43, 4.29, 3.467333333, 3.29, 2.474210526],
  [23.97871795, 21.86294872, 20.0998077, 18.33666667, 8.881111111, 8.01, 6.843, 5.885, 5.3075, 4.444, 4.3075, 3.4804, 3.3075, 2.487105263],
  [24.40589743, 22.25243589, 20.45788461, 18.66333333, 8.99, 8.099090909, 6.892, 5.92, 5.325, 4.458, 4.325, 3.493466667, 3.325, 2.5],
  [24.83307692, 22.64192308, 20.81596154, 18.99, 9.01, 8.188181818, 6.941, 5.955, 5.3425, 4.472, 4.3425, 3.506533333, 3.3425, 2.512894737],
  [24.85923077, 22.66576923, 20.83788462, 19.01, 9.118888889, 8.277272727, 6.99, 5.99, 5.36, 4.486, 4.36, 3.5196, 3.36, 2.525789474],
  [25.28641026, 23.05525641, 21.19596154, 19.33666667, 9.227777778, 8.366363636, 7.01, 6.01, 5.3775, 4.5, 4.3775, 3.532666667, 3.3775, 2.538684211],
  [25.71358974, 23.44474359, 21.55403846, 19.66333333, 9.336666667, 8.455454545, 7.038, 6.038, 5.395, 4.514, 4.395, 3.545733333, 3.395, 2.551578947],
  [26.14076923, 23.83423077, 21.91211538, 19.99, 9.445555556, 8.544545455, 7.066, 6.066, 5.4125, 4.528, 4.4125, 3.5588, 3.4125, 2.564473684],
  [26.16692308, 23.85807692, 21.93403846, 20.01, 9.554444444, 8.633636364, 7.094, 6.094, 5.43, 4.542, 4.43, 3.571866667, 3.43, 2.577368421],
  [26.48730769, 24.15019231, 22.20259615, 20.255, 9.663333333, 8.722727273, 7.122, 6.122, 5.4475, 4.556, 4.4475, 3.584933333, 3.4475, 2.590263158],
  [26.80769231, 24.44230769, 22.47115385, 20.5, 9.772222222, 8.811818182, 7.15, 6.15, 5.465, 4.57, 4.465, 3.598, 3.465, 2.603157895],
  [27.12807692, 24.73442308, 22.73971154, 20.745, 9.881111111, 8.900909091, 7.178, 6.178, 5.4825, 4.584, 4.4825, 3.611066667, 3.4825, 2.616052632],
  [27.44846154, 25.02653846, 23.00826923, 20.99, 9.99, 8.99, 7.206, 6.206, 5.5, 4.598, 4.5, 3.624133333, 3.5, 2.628947368],
  [27.47461538, 25.05038462, 23.03019231, 21.01, 10.01, 9.01, 7.234, 6.234, 5.5175, 4.612, 4.5175, 3.6372, 3.5175, 2.641842105],
  [27.90179488, 25.4398718, 23.38826923, 21.33666667, 10.11888889, 9.046296296, 7.262, 6.262, 5.535, 4.626, 4.535, 3.650266667, 3.535, 2.654736842],
  [28.32897435, 25.82935897, 23.74634615, 21.66333333, 10.22777778, 9.082592593, 7.29, 6.29, 5.5525, 4.64, 4.5525, 3.663333333, 3.5525, 2.667631579],
  [28.75615385, 26.21884615, 24.10442308, 21.99, 10.33666667, 9.118888889, 7.318, 6.318, 5.57, 4.654, 4.57, 3.6764, 3.57, 2.680526316],
  [28.78230769, 26.24269231, 24.12634615, 22.01, 10.44555556, 9.155185185, 7.346, 6.346, 5.5875, 4.668, 4.5875, 3.689466667, 3.5875, 2.693421053],
  [29.20948718, 26.63217949, 24.48442308, 22.33666667, 10.55444444, 9.191481481, 7.374, 6.374, 5.605, 4.682, 4.605, 3.702533333, 3.605, 2.706315789],
  [29.63666666, 27.02166666, 24.8425, 22.66333333, 10.66333333, 9.227777778, 7.402, 6.402, 5.6225, 4.696, 4.6225, 3.7156, 3.6225, 2.719210526],
  [30.06384615, 27.41115385, 25.20057692, 22.99, 10.77222222, 9.264074074, 7.43, 6.43, 5.64, 4.71, 4.64, 3.728666667, 3.64, 2.732105263],
  [30.09, 27.435, 25.2225, 23.01, 10.88111111, 9.30037037, 7.458, 6.458, 5.6575, 4.724, 4.6575, 3.741733333, 3.6575, 2.745],
  [30.51717949, 27.82448718, 25.58057693, 23.33666667, 10.99, 9.336666667, 7.486, 6.486, 5.675, 4.738, 4.675, 3.7548, 3.675, 2.757894737],
  [30.94435897, 28.21397436, 25.93865384, 23.66333333, 11.01, 9.372962963, 7.514, 6.514, 5.6925, 4.752, 4.6925, 3.767866667, 3.6925, 2.770789474],
  [31.37153846, 28.60346154, 26.29673077, 23.99, 11.06764706, 9.409259259, 7.542, 6.542, 5.71, 4.766, 4.71, 3.780933333, 3.71, 2.783684211],
  [31.39769231, 28.62730769, 26.31865385, 24.01, 11.12529412, 9.445555556, 7.57, 6.57, 5.7275, 4.78, 4.7275, 3.794, 3.7275, 2.796578947],
  [31.71807692, 28.91942308, 26.58721154, 24.255, 11.18294118, 9.481851852, 7.598, 6.598, 5.745, 4.794, 4.745, 3.807066667, 3.745, 2.809473684],
  [32.03846154, 29.21153846, 26.85576923, 24.5, 11.24058824, 9.518148148, 7.626, 6.626, 5.7625, 4.808, 4.7625, 3.820133333, 3.7625, 2.822368421],
  [32.35884615, 29.50365385, 27.12432692, 24.745, 11.29823529, 9.554444444, 7.654, 6.654, 5.78, 4.822, 4.78, 3.8332, 3.78, 2.835263158],
  [32.67923077, 29.79576923, 27.39288462, 24.99, 11.35588235, 9.590740741, 7.682, 6.682, 5.7975, 4.836, 4.7975, 3.846266667, 3.7975, 2.848157895],
  [32.70538462, 29.81961538, 27.41480769, 25.01, 11.41352941, 9.627037037, 7.71, 6.71, 5.815, 4.85, 4.815, 3.859333333, 3.815, 2.861052632],
  [33.02576923, 30.11173077, 27.68336538, 25.255, 11.47117647, 9.663333333, 7.738, 6.738, 5.8325, 4.864, 4.8325, 3.8724, 3.8325, 2.873947368],
  [33.34615385, 30.40384615, 27.95192308, 25.5, 11.52882353, 9.69962963, 7.766, 6.766, 5.85, 4.878, 4.85, 3.885466667, 3.85, 2.886842105],
  [33.66653846, 30.69596154, 28.22048077, 25.745, 11.58647059, 9.735925926, 7.794, 6.794, 5.8675, 4.892, 4.8675, 3.898533333, 3.8675, 2.899736842],
  [33.98692308, 30.98807692, 28.48903846, 25.99, 11.64411765, 9.772222222, 7.822, 6.822, 5.885, 4.906, 4.885, 3.9116, 3.885, 2.912631579],
  [34.01307692, 31.01192308, 28.51096154, 26.01, 11.70176471, 9.808518519, 7.85, 6.85, 5.9025, 4.92, 4.9025, 3.924666667, 3.9025, 2.925526316],
  [34.26938462, 31.24561538, 28.72580769, 26.206, 11.75941176, 9.844814815, 7.878, 6.878, 5.92, 4.934, 4.92, 3.937733333, 3.92, 2.938421053],
  [34.52569231, 31.47930769, 28.94065385, 26.402, 11.81705882, 9.881111111, 7.906, 6.906, 5.9375, 4.948, 4.9375, 3.9508, 3.9375, 2.951315789],
  [34.782, 31.713, 29.1555, 26.598, 11.87470588, 9.917407407, 7.934, 6.934, 5.955, 4.962, 4.955, 3.963866667, 3.955, 2.964210526],
  [35.03830769, 31.94669231, 29.37034615, 26.794, 11.93235294, 9.953703704, 7.962, 6.962, 5.9725, 4.976, 4.9725, 3.976933333, 3.9725, 2.977105263],
  [35.29461538, 32.18038462, 29.58519231, 26.99, 11.99, 9.99, 7.99, 6.99, 5.99, 4.99, 4.99, 3.99, 3.99, 2.99]
];

const talentTI = new Array(14).fill(0);
const boostTI = new Array(14).fill(0);

const TiAge = new Array(14).fill(0);
const TiTotal = new Array(14).fill(0);

/*Main Ui Function  - present the Training Simulator */
const present = function () {
  const specialty = 0;
  const trainingCustom = trainingCustomDefault;

  let TrainingSimulatorDiv = '<div class="box" id = "trainingSimulatorDiv">' + '<div class="box_head">' + '<h2 class="std">SKILLS CALC</h2>' + '</div>' + '<div class="box_body">' + '<div class="box_shadow"></div>' + '<div id="CalculateFutureButton1" class="CalculateFutureButton"></div>' + '<div id="TrainingSimulator_content" class="content_menu"></div>' + '<div id="CalculateFutureButton2" class="CalculateFutureButton"></div>' + '</div>' + '<div class="box_footer">' + '<div></div>' + '</div>' + '</div>';

  $('.column1').append(TrainingSimulatorDiv);

  /* Calculate Button 1 */
  $('#CalculateFutureButton1').attr('style', 'text-align: center; padding-top: 10px;padding-bottom: 10px;');
  let CalculateFutureButton1 = '<span class="button"  style="width:170px; text-align:left;"><span class="button_border" style="width:168px;text-align: center ; padding: 0;">&nbsp;Calculate Future</span></span>';
  $('#CalculateFutureButton1').append(CalculateFutureButton1);

  /* Training Simulator Input */
  let TrainingSimulator_content = "<table><tbody id='" + TrainingSimulator_TABLE_BODY_ID + "'></tbody></table>";
  $('#TrainingSimulator_content').append(TrainingSimulator_content);
  let tbody = $('#' + TrainingSimulator_TABLE_BODY_ID)[0];
  tbody.style.display = 'flex';
  tbody.style.flexDirection = 'column';

  /* Trainingg Input Header TR */
  let trTrainingHeader = document.createElement('tr');
  trTrainingHeader.className = 'odd';

  let tdTrainingHeader = document.createElement('td');
  tdTrainingHeader.innerHTML = 'Training';

  trTrainingHeader.appendChild(tdTrainingHeader);
  setInputHeaderStyle(trTrainingHeader, tdTrainingHeader);
  tbody.appendChild(trTrainingHeader);

  /* TI Input TR */
  let trTI = document.createElement('tr');

  let tdTILabel = document.createElement('td');
  tdTILabel.innerHTML = '&nbsp;TI:';

  let tdTI = document.createElement('td');
  let TI_Input = document.createElement('input');

  setInput(TI_Input, 'TI_Input', 0, 4000, 100);

  tdTI.appendChild(TI_Input);
  trTI.appendChild(tdTILabel);
  trTI.appendChild(tdTI);

  setInputStyle(trTI);
  tbody.appendChild(trTI);

  /* Target Age TR */
  let trTargetAge = document.createElement('tr');
  trTargetAge.className = 'odd';

  let tdTargetAgeLabel = document.createElement('td');
  tdTargetAgeLabel.innerHTML = '&nbsp;Target Age:';

  let tdTargetAge = document.createElement('td');
  let TargetAge_Input = document.createElement('input');

  setInput(TargetAge_Input, 'TargetAge_Input', 16, 29, 25);

  tdTargetAge.appendChild(TargetAge_Input);
  trTargetAge.appendChild(tdTargetAgeLabel);
  trTargetAge.appendChild(tdTargetAge);

  setInputStyle(trTargetAge);
  tbody.appendChild(trTargetAge);

  /* Peaks Header TR */
  let trPeaksHeader = document.createElement('tr');

  let tdPeaksHeader = document.createElement('td');
  tdPeaksHeader.innerHTML = 'Peaks';

  trPeaksHeader.appendChild(tdPeaksHeader);
  setInputHeaderStyle(trPeaksHeader, tdPeaksHeader);
  tbody.appendChild(trPeaksHeader);

  /*Physical */
  let trPhysical = document.createElement('tr');
  trPhysical.className = 'odd';

  let tdPhysicalLabel = document.createElement('td');
  tdPhysicalLabel.innerHTML = '&nbsp;Physical:';

  let tdPhysical = document.createElement('td');

  let Physical_Input = document.createElement('input');
  setInput(Physical_Input, 'Physical_Input', 30, 80, 50);
  tdPhysical.appendChild(Physical_Input);
  trPhysical.appendChild(tdPhysicalLabel);
  trPhysical.appendChild(tdPhysical);

  setInputStyle(trPhysical);
  tbody.appendChild(trPhysical);

  /*Tactical */
  let trTactical = document.createElement('tr');

  let tdTacticalLabel = document.createElement('td');
  tdTacticalLabel.innerHTML = '&nbsp;Tactical:';

  let tdTactical = document.createElement('td');

  let Tactical_Input = document.createElement('input');
  setInput(Tactical_Input, 'Tactical_Input', 30, 80, 50);
  tdTactical.appendChild(Tactical_Input);
  trTactical.appendChild(tdTacticalLabel);
  trTactical.appendChild(tdTactical);

  setInputStyle(trTactical);
  tbody.appendChild(trTactical);

  /*Technical */
  let trTechnical = document.createElement('tr');
  trTechnical.className = 'odd';

  let tdTechnicalLabel = document.createElement('td');
  tdTechnicalLabel.innerHTML = '&nbsp;Technical:';

  let tdTechnical = document.createElement('td');

  let Technical_Input = document.createElement('input');
  setInput(Technical_Input, 'Technical_Input', 40, 120, 60);
  tdTechnical.appendChild(Technical_Input);
  trTechnical.appendChild(tdTechnicalLabel);
  trTechnical.appendChild(tdTechnical);

  setInputStyle(trTechnical);
  tbody.appendChild(trTechnical);

  /* Specialist Skill Header TR */
  let trSpecialistSkillHeader = document.createElement('tr');

  let tdSpecialistSkillHeader = document.createElement('td');
  tdSpecialistSkillHeader.innerHTML = 'Specialist Skill';

  trSpecialistSkillHeader.appendChild(tdSpecialistSkillHeader);
  setInputHeaderStyle(trSpecialistSkillHeader, tdSpecialistSkillHeader);
  tbody.appendChild(trSpecialistSkillHeader);

  /*Specialty */
  let trSpecialty = document.createElement('tr');
  trSpecialty.className = 'odd';

  let tdSpecialtyLabel = document.createElement('td');
  tdSpecialtyLabel.innerHTML = '&nbsp;Specialty:';

  let tdSpecialty = document.createElement('td');

  let Specialty_Select = document.createElement('select');
  setSpecialty(Specialty_Select, 'Specialty_Select');
  setOptions(Specialty_Select);
  Specialty_Select.value = specialty;

  tdSpecialty.appendChild(Specialty_Select);
  trSpecialty.appendChild(tdSpecialtyLabel);
  trSpecialty.appendChild(tdSpecialty);

  setInputStyle(trSpecialty);
  tbody.appendChild(trSpecialty);

  if (player_fp != 'gk') {
    /* Custom Training Header TR */
    let trCustomTrainingHeader = document.createElement('tr');

    let tdCustomTrainingHeader = document.createElement('td');
    tdCustomTrainingHeader.innerHTML = 'Custom Training';

    trCustomTrainingHeader.appendChild(tdCustomTrainingHeader);
    setInputHeaderStyle(trCustomTrainingHeader, tdCustomTrainingHeader);
    tbody.appendChild(trCustomTrainingHeader);

    if (trainingCustom.length == 0) {
      trainingCustom = [2, 2, 2, 2, 2, 2];
    }

    /* Team 1 Strength, Workrate, Stamina TR */
    let trTeam1 = document.createElement('tr');
    trTeam1.className = 'odd';

    let tdTeam1Label = document.createElement('td');
    tdTeam1Label.innerHTML = '&nbsp;Str, Sta, Wor:';

    let tdTeam1 = document.createElement('td');

    let Team1_Input = document.createElement('input');
    setInput(Team1_Input, 'Team1_Input', 0, 4, trainingCustom[0]);
    tdTeam1.appendChild(Team1_Input);
    trTeam1.appendChild(tdTeam1Label);
    trTeam1.appendChild(tdTeam1);

    setInputStyle(trTeam1);
    tbody.appendChild(trTeam1);

    /* Team 2 Marking, Tackling TR */

    let trTeam2 = document.createElement('tr');

    let tdTeam2Label = document.createElement('td');
    tdTeam2Label.innerHTML = '&nbsp;Mar, Tac:';

    let tdTeam2 = document.createElement('td');

    let Team2_Input = document.createElement('input');
    setInput(Team2_Input, 'Team2_Input', 0, 4, trainingCustom[1]);
    tdTeam2.appendChild(Team2_Input);
    trTeam2.appendChild(tdTeam2Label);
    trTeam2.appendChild(tdTeam2);

    setInputStyle(trTeam2);
    tbody.appendChild(trTeam2);

    /* Team 3 Crossing, Pace TR */
    let trTeam3 = document.createElement('tr');
    trTeam3.className = 'odd';

    let tdTeam3Label = document.createElement('td');
    tdTeam3Label.innerHTML = '&nbsp;Cro, Pac:';

    let tdTeam3 = document.createElement('td');

    let Team3_Input = document.createElement('input');
    setInput(Team3_Input, 'Team3_Input', 0, 4, trainingCustom[2]);
    tdTeam3.appendChild(Team3_Input);
    trTeam3.appendChild(tdTeam3Label);
    trTeam3.appendChild(tdTeam3);

    setInputStyle(trTeam3);
    tbody.appendChild(trTeam3);

    /* Team 4 Passing, Technique, Set pieces TR */

    let trTeam4 = document.createElement('tr');

    let tdTeam4Label = document.createElement('td');
    tdTeam4Label.innerHTML = '&nbsp;Pas, Tec, Set:';

    let tdTeam4 = document.createElement('td');

    let Team4_Input = document.createElement('input');
    setInput(Team4_Input, 'Team4_Input', 0, 4, trainingCustom[3]);
    tdTeam4.appendChild(Team4_Input);
    trTeam4.appendChild(tdTeam4Label);
    trTeam4.appendChild(tdTeam4);

    setInputStyle(trTeam4);
    tbody.appendChild(trTeam4);

    /* Team 5 Heading, Positioning TR */
    let trTeam5 = document.createElement('tr');
    trTeam5.className = 'odd';

    let tdTeam5Label = document.createElement('td');
    tdTeam5Label.innerHTML = '&nbsp;Hea, Pos:';

    let tdTeam5 = document.createElement('td');

    let Team5_Input = document.createElement('input');
    setInput(Team5_Input, 'Team5_Input', 0, 4, trainingCustom[4]);
    tdTeam5.appendChild(Team5_Input);
    trTeam5.appendChild(tdTeam5Label);
    trTeam5.appendChild(tdTeam5);

    setInputStyle(trTeam5);
    tbody.appendChild(trTeam5);

    /* Team 6 Finishing, Longshots TR */

    let trTeam6 = document.createElement('tr');

    let tdTeam6Label = document.createElement('td');
    tdTeam6Label.innerHTML = '&nbsp;Fin, Lon:';

    let tdTeam6 = document.createElement('td');

    let Team6_Input = document.createElement('input');
    setInput(Team6_Input, 'Team6_Input', 0, 4, trainingCustom[5]);
    tdTeam6.appendChild(Team6_Input);
    trTeam6.appendChild(tdTeam6Label);
    trTeam6.appendChild(tdTeam6);

    setInputStyle(trTeam6);
    tbody.appendChild(trTeam6);

    /* Training Summary Header TR */
    let trTrainingSummaryHeader = document.createElement('tr');
    trTrainingSummaryHeader.className = 'odd';

    let tdTrainingSummaryHeader = document.createElement('td');
    tdTrainingSummaryHeader.innerHTML = 'Training Summary';

    trTrainingSummaryHeader.appendChild(tdTrainingSummaryHeader);
    setInputHeaderStyle(trTrainingSummaryHeader, tdTrainingSummaryHeader);
    tbody.appendChild(trTrainingSummaryHeader);

    /* Remaining Points TR */
    let trRemainingPoints = document.createElement('tr');

    let tdRemainingPointsLabel = document.createElement('td');
    tdRemainingPointsLabel.innerHTML = '&nbsp;Remaining Points:';

    let tdRemainingPoints = document.createElement('td');
    tdRemainingPoints.id = 'RemainingPoints';

    trRemainingPoints.appendChild(tdRemainingPointsLabel);
    trRemainingPoints.appendChild(tdRemainingPoints);

    setInputStyle(trRemainingPoints);
    trRemainingPoints.style.paddingRight = '15px';

    tbody.appendChild(trRemainingPoints);

    /* Training Percentage TR */
    let trTrainingPercentage = document.createElement('tr');
    trTrainingPercentage.className = 'odd';

    let tdTrainingPercentageLabel = document.createElement('td');
    tdTrainingPercentageLabel.innerHTML = '&nbsp;Training %:';

    let tdTrainingPercentage = document.createElement('td');
    tdTrainingPercentage.id = 'TrainingPercentage';

    trTrainingPercentage.appendChild(tdTrainingPercentageLabel);
    trTrainingPercentage.appendChild(tdTrainingPercentage);

    setInputStyle(trTrainingPercentage);
    trTrainingPercentage.style.paddingRight = '15px';

    tbody.appendChild(trTrainingPercentage);

    /* Calculated TI TR */
    let trCalculatedTI = document.createElement('tr');

    let tdCalculatedTILabel = document.createElement('td');
    tdCalculatedTILabel.innerHTML = '&nbsp;Calculated TI:';

    let tdCalculatedTI = document.createElement('td');
    tdCalculatedTI.id = 'CalculatedTI';

    trCalculatedTI.appendChild(tdCalculatedTILabel);
    trCalculatedTI.appendChild(tdCalculatedTI);

    setInputStyle(trCalculatedTI);
    trCalculatedTI.style.paddingRight = '15px';

    tbody.appendChild(trCalculatedTI);

    /* Points Allocation Info TR */

    let trPointsAlloctionInfo = document.createElement('tr');
    trPointsAlloctionInfo.className = 'odd';
    trPointsAlloctionInfo.style.display = 'grid';
    trPointsAlloctionInfo.style.textAlign = 'center';

    let tdPointsAlloctionInfo = document.createElement('td');
    tdPointsAlloctionInfo.id = 'PointsAlloctionInfo';
    tdPointsAlloctionInfo.style.color = 'black'
    tdPointsAlloctionInfo.innerText = '-';
    trPointsAlloctionInfo.appendChild(tdPointsAlloctionInfo);

    tbody.appendChild(trPointsAlloctionInfo);

    let playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
    setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
    updatePointsAllcText(playerTraining);

    /* On Change */
    TI_Input.addEventListener('change', function () {
      playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    TargetAge_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team1_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team2_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team3_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team4_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team5_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });

    Team6_Input.addEventListener('change', function () {
      const isAllZero = TiTotal.every(item => item === 0);
      const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (isAllZero == false && remainingPoints == 0) {
        setTiAgeFieldPlayer();
        setTiTotal(playerBaseData.age, playerBaseData.months);
        TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
      }
      setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTraining);
      updatePointsAllcText(playerTraining);
    });
  }

  else {
    if (player_fp === 'gk') {
      TargetAge_Input.addEventListener('change', function () {
        const isAllZero = TiTotal.every(item => item === 0);
        if (isAllZero == false) {
          TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
        }
      });
    }
  }

  /* Calculate Button 2 */
  $('#CalculateFutureButton2').attr('style', 'text-align: center; padding-top: 10px;padding-bottom: 10px;');
  let CalculateFutureButton2 = '<span class="button"  style="width:170px; text-align:left;"><span class="button_border" style="width:168px;text-align: center ; padding: 0;">&nbsp;Calculate Future</span></span>';
  $('#CalculateFutureButton2').append(CalculateFutureButton2);

  $('.CalculateFutureButton > span.button').on('click', function () {
    const playerTI_1 = Number(TI_Input.value);
    const playerTargetAge_1 = Number(TargetAge_Input.value);
    const playerPhysicalPeak = Number(Physical_Input.value);
    const playerTacticalPeak = Number(Tactical_Input.value);
    const playerTechnicalPeak = Number(Technical_Input.value);
    const playerSpecialty = Number(Specialty_Select.value);
    const playerTraining = player_fp == 'gk' ? null : getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
    if (player_fp != 'gk') {
      const remainingPoints = 12 - (playerTraining.reduce((sum, val) => sum + val));
      if (remainingPoints == 0) {
        playerFutureData = runTrainingSimulation(playerBaseData, playerTI_1, playerTargetAge_1, playerPhysicalPeak, playerTacticalPeak, playerTechnicalPeak, playerSpecialty, playerTraining);
        updatePlayerData(playerFutureData)
      }
    }
    else {
      playerFutureData = runTrainingSimulation(playerBaseData, playerTI_1, playerTargetAge_1, playerPhysicalPeak, playerTacticalPeak, playerTechnicalPeak, playerSpecialty, playerTraining);
      updatePlayerData(playerFutureData)
    }
  });

  const trainingSimulatorDiv = document.querySelector('#trainingSimulatorDiv');
  const parentElement = trainingSimulatorDiv.parentElement;
  if (parentElement && parentElement.children.length > 1) {
    const secondChild = parentElement.children[1];
    parentElement.insertBefore(trainingSimulatorDiv, secondChild);
  }
};

const setTrainingSummary = function (tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, TI_Input, trainingInput) {
  const remainingPoints = 12 - (trainingInput.reduce((sum, val) => sum + val));
  const trainingPercentage = trainingInput.reduce((sum, index) => sum + pointsAllc[index], 0);
  const calculatedTI = TI_Input;
  tdRemainingPoints.innerText = remainingPoints;
  tdTrainingPercentage.innerText = `${trainingPercentage}/102`;
  if (remainingPoints >= 0) {
    tdCalculatedTI.innerText = calculatedTI;
  }
}

const updatePointsAllcText = function (trainingInput) {
  const remainingPoints = 12 - (trainingInput.reduce((sum, val) => sum + val));
  let pointsAlloctionInfoTD = document.getElementById('PointsAlloctionInfo');
  if (remainingPoints == 0) {
    pointsAlloctionInfoTD.innerText = 'Points Alloction: OK'
    pointsAlloctionInfoTD.style.backgroundColor = '#00ff00'
  }
  if (remainingPoints > 0) {
    pointsAlloctionInfoTD.innerText = 'Points Alloction: Warning'
    pointsAlloctionInfoTD.style.backgroundColor = 'orange'
  }

  if (remainingPoints < 0) {
    pointsAlloctionInfoTD.innerText = 'Points Alloction: ERROR'
    pointsAlloctionInfoTD.style.backgroundColor = '#FF0000'
  }
}

const getPlayerTrainingArrayFromInput = function () {
  const Team1_Input = document.querySelector('#Team1_Input');
  const Team2_Input = document.querySelector('#Team2_Input');
  const Team3_Input = document.querySelector('#Team3_Input');
  const Team4_Input = document.querySelector('#Team4_Input');
  const Team5_Input = document.querySelector('#Team5_Input');
  const Team6_Input = document.querySelector('#Team6_Input');
  const playerTraining = getPlayerTrainingArray(Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input);
  return playerTraining;
}

const getPlayerTrainingArray = function (Team1_Input, Team2_Input, Team3_Input, Team4_Input, Team5_Input, Team6_Input) {
  return [Number(Team1_Input.value), Number(Team2_Input.value), Number(Team3_Input.value), Number(Team4_Input.value), Number(Team5_Input.value), Number(Team6_Input.value)];
};

const runTrainingSimulation = function (playerBaseData, playerTI, playerTargetAge, playerPhysicalPeak, playerTacticalPeak, playerTechnicalPeak, playerSpecialty, playerTraining) {
  const playerFutureData = calculateFutureSkills(playerBaseData.skills, playerBaseData.skill_index, playerBaseData.favposition, playerTI, playerPhysicalPeak, playerTacticalPeak, playerTechnicalPeak, playerSpecialty, playerTraining);
  const [wage, skill_index, skills, skills_array, skill_index_number] = getFutureDataForView(playerFutureData);
  const playerFutureRoutine = calculateFutureRoutine(playerBaseData.age, playerBaseData.months, playerBaseData.routine, playerTargetAge);

  const playerRoutineBonus = getRoutineBonus(playerFutureRoutine)
  const playerSkillsB = getSkilsB(playerFutureData[0], playerRoutineBonus);
  const [recAndRating, R5FP0, R5FP1] = getREREC(positionArray, playerFutureData[0], skill_index_number, playerRoutineBonus, playerSkillsB)
  let playerFutureResult = {};
  playerFutureResult['player_id'] = playerBaseData.player_id;
  playerFutureResult['favposition'] = playerBaseData.favposition;
  playerFutureResult['age'] = (playerTargetAge - 1).toString();
  playerFutureResult['months'] = '11';
  playerFutureResult['routine'] = playerFutureRoutine
  playerFutureResult['skills_acc'] = playerFutureData[0];
  playerFutureResult['recommendation'] = getRecommendation(recAndRating);
  playerFutureResult['wage'] = wage;
  playerFutureResult['skill_index'] = skill_index;
  playerFutureResult['skills'] = skills;
  playerFutureResult['skills_array'] = skills_array;
  playerFutureResult['skill_index_number'] = skill_index_number;
  playerFutureResult['skillsB'] = playerSkillsB;
  playerFutureResult['rerec'] = recAndRating;
  playerFutureResult['R5FP0'] = R5FP0;
  playerFutureResult['R5FP1'] = R5FP1;
  playerFutureResult['staPrice'] = calc_SellToAgent(skill_index_number, (playerTargetAge - 1), 11);

  console.log(playerFutureResult);
  return playerFutureResult;
};

const setInputTable = function (report, playerTraining, playerAge) {

  const { phy, tac, tec, specialty } = report;
  let Physical_Input = document.querySelector('#Physical_Input');
  let Tactical_Input = document.querySelector('#Tactical_Input');
  let Technical_Input = document.querySelector('#Technical_Input');
  let Specialty_Select = document.querySelector('#Specialty_Select');
  let TargetAgeInput = document.querySelector('#TargetAge_Input');
  let skillsArray = player_fp == 'gk' ? SPECIALTY_ARRAY_GK_PLAYER : SPECIALTY_ARRAY_FIELD_PLAYER;

  if (Number(playerAge) < 25) {
    TargetAgeInput.value = 25;
  } else {
    TargetAgeInput.value = Number(playerAge) + 1;
  }

  TargetAgeInput.min = Number(playerAge) + 1;
  if (phy && tac && tec && specialty && specialty.indexOf("=") == -1) {
    Physical_Input.value = Number(phy);
    Tactical_Input.value = Number(tac);
    Technical_Input.value = Number(tec);
    Specialty_Select.value = (Number(getByValue(skillsArray, specialty)) - 1).toString();
  }

  if (player_fp != 'gk') {
    let playerTrainingArray = (playerTraining.split("")).map(val => Number(val));
    if (playerTrainingArray.length == 0) {
      playerTrainingArray = [2, 2, 2, 2, 2, 2];
    }
    let Team1_Input = document.querySelector('#Team1_Input');
    let Team2_Input = document.querySelector('#Team2_Input');
    let Team3_Input = document.querySelector('#Team3_Input');
    let Team4_Input = document.querySelector('#Team4_Input');
    let Team5_Input = document.querySelector('#Team5_Input');
    let Team6_Input = document.querySelector('#Team6_Input');

    Team1_Input.value = playerTrainingArray[0];
    Team2_Input.value = playerTrainingArray[1];
    Team3_Input.value = playerTrainingArray[2];
    Team4_Input.value = playerTrainingArray[3];
    Team5_Input.value = playerTrainingArray[4];
    Team6_Input.value = playerTrainingArray[5];
  }
}

const updateTrainingSummary = function (playerTrainingArray) {
  const tdRemainingPoints = document.querySelector('#RemainingPoints');
  const tdTrainingPercentage = document.querySelector('#TrainingPercentage');
  const tdCalculatedTI = document.querySelector('#CalculatedTI');
  const TI_Input = document.querySelector('#TI_Input');
  setTrainingSummary(tdRemainingPoints, tdTrainingPercentage, tdCalculatedTI, Number(TI_Input.value), playerTrainingArray);
  updatePointsAllcText(playerTrainingArray);
}

const updatePlayerData = function (playerFutureData) {
  updateInfoTable(playerFutureData)
  updateSkills(playerFutureData.skills, playerFutureData.skillsB);
  if (playerFutureData.favposition != 'gk') {
    updateFutureR5Table(playerFutureData.rerec);
  }
  updateTransferOptionsTable(playerFutureData)
}

const updateInfoTable = function (playerFutureData) {
  const infoTable = document.querySelector('.info_table');
  const thElements = infoTable.querySelectorAll('th');

  thElements.forEach(thElement => {
    if (thElement.textContent.includes('Age')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        siblingElement.innerHTML = `${playerFutureData.age} Years ${playerFutureData.months} Months`;
      }
    }
    if (thElement.textContent.includes('Wage')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        siblingElement.innerHTML = `<span class="coin">${playerFutureData.wage}</span>`;
      }
    }
    if (thElement.textContent.includes('Recommendation')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        siblingElement.innerHTML = playerFutureData.recommendation;
      }
    }
    if (thElement.textContent.includes('RERECb')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        if (FP[0] != FP[1]) {
          siblingElement.innerHTML = `${playerFutureData.rerec[0][FP[0]]}/${playerFutureData.rerec[0][FP[1]]}`;
        }
        else {
          siblingElement.innerHTML = `${playerFutureData.rerec[0][FP[0]]}`;
        }
      }
    }
    if (thElement.textContent.includes('RatingR5')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        if (FP[0] != FP[1]) {
          siblingElement.innerHTML = `${playerFutureData.R5FP0}/${playerFutureData.R5FP1}`;
        }
        else {
          siblingElement.innerHTML = `${playerFutureData.R5FP0}`;
        }
      }
    }
    if (thElement.textContent.includes('Skill Index')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        siblingElement.innerHTML = `${playerFutureData.skill_index}`;
      }
    }
    if (thElement.textContent.includes('Routine')) {
      const siblingElement = thElement.nextElementSibling;
      if (siblingElement) {
        siblingElement.innerHTML = `${playerFutureData.routine}`;
      }
    }
  });

}

const updateSkills = function (skills, skillsB) {
  const skillToIndexMapField = new Map([
    ['strength', 0], ['stamina', 1], ['pace', 2], ['marking', 3], ['tackling', 4], ['workrate', 5],
    ['positioning', 6], ['passing', 7], ['crossing', 8], ['technique', 9], ['heading', 10],
    ['finishing', 11], ['longshots', 12], ['set_pieces', 13]
  ])
  const skillToIndexMapGK = new Map([
    ['strength', 0], ['stamina', 1], ['pace', 2], ['handling', 3], ['one_on_ones', 4],
    ['reflexes', 5], ['aerial_ability', 6], ['jumping', 7],
    ['communication', 8], ['kicking', 9], ['throwing', 10]
  ])
  const skillToIndexMap = skills.length == 14 ? skillToIndexMapField : skillToIndexMapGK;
  for (let skill of skills) {
    const name = skill.name.toLowerCase();
    const tableHeaders = document.querySelectorAll('.skill_table th');
    const keyToIndex = skillToIndexMap.get(skill.key);
    const skillB = funFix2(skillsB[keyToIndex]);
    for (const tableHeader of tableHeaders) {
      if (tableHeader.textContent.toLowerCase().includes(name)) {
        const tableCell = tableHeader.nextElementSibling;
        const isNumeric = !isNaN(Number(skill.value));
        const isSubtle = isNumeric && skill.value <= 5;
        if (isNumeric) {
          // For numeric values, update text content
          tableCell.innerHTML = `${isSubtle ? '<span class="subtle">' + skill.value + '</span>' : skill.value}<small style="color: moccasin;"> (${skillB})</small>`;
        } else {
          // For image values, update HTML content
          tableCell.innerHTML = `${skill.value}<small style="color: moccasin;"> (${skillB})</small>`;
        }
        break;
      }
    }
  }
}

const updateFutureR5Table = function (REREC) {
  const existingElement = document.getElementById('R5FutureTable');
  if (existingElement) {
    existingElement.parentNode.removeChild(existingElement);
  }

  const R5FutureTableContainer = document.createElement('div');
  R5FutureTableContainer.classList.add('std');
  R5FutureTableContainer.id = 'R5FutureTable';

  const R5FutureTableDiv = document.createElement('div');
  R5FutureTableDiv.id = 'R5FutureTable_div';

  const R5FutureTable = document.createElement('table');
  R5FutureTable.id = 'R5FutureTable';
  R5FutureTable.style.marginBottom = '10px';
  R5FutureTable.style.marginTop = '10px';
  R5FutureTable.style.border = '1px solid';

  const tbody = document.createElement('tbody');

  // Append the created elements to construct the structure
  R5FutureTable.appendChild(tbody);
  R5FutureTableDiv.appendChild(R5FutureTable);
  R5FutureTableContainer.appendChild(R5FutureTableDiv);

  const hiddenSkillsButtonElement = document.querySelector('.hidden_skills_text');
  const hiddenSkillsTableElement = document.querySelector('#hidden_skill_table');
  // Check if the element is found
  if (hiddenSkillsButtonElement) {
    hiddenSkillsButtonElement.parentNode.insertBefore(R5FutureTableContainer, hiddenSkillsButtonElement.nextSibling);
  }
  else {
    if (hiddenSkillsTableElement) {
      hiddenSkillsTableElement.parentNode.insertBefore(R5FutureTableContainer, hiddenSkillsTableElement.nextSibling);
    }
  }




  const R5FutureTable_header = "<thead><tr style=\"background-color: #333333\"><th colspan=\"10\">All Positions Future Rating</th></tr><tr style=\"background-color: #333333\"><th></th><th>DC</th><th>DLR</th><th>DMC</th><th>DMLR</th><th>MC</th><th>MLR</th><th>OMC</th><th>OMLR</th><th>F</th></tr></thead>";
  const RERECbFuture_row = "<tr id=\"RERECbFuture_row\"><td style=\"padding-left:5px\">RERECb</td></tr>";
  const R5Futureall_row = "<tr id=\"R5Futureall_row\" class=\"odd\"><td style=\"padding-left:5px\">R5</td></tr>";
  $("#R5FutureTable > tbody").before(R5FutureTable_header);
  $("#R5FutureTable").find("th").attr("align", "center");
  $("#R5FutureTable").find("th").attr("style", "border-bottom:solid 1px");
  $("#R5FutureTable > tbody").append(RERECbFuture_row, R5Futureall_row);
 for (let i = 0; i < 9; i++) {
  const table = document.querySelector("#R5FutureTable tbody");
  const firstRow = table.querySelector("tr:nth-child(1)");
  const secondRow = table.querySelector("tr:nth-child(2)");

  const cell1 = document.createElement("td");
  cell1.style.textAlign = "center";
  cell1.textContent = REREC[0][i];
  firstRow.appendChild(cell1);

  const cell2 = document.createElement("td");
  cell2.style.textAlign = "center";
  cell2.textContent = REREC[2][i];
  secondRow.appendChild(cell2);
}
}


const updateTransferOptionsTable = function (playerFutureData) {
  updateStaPriceFuture(playerFutureData.staPrice, playerFutureData.age)
}

const updateStaPriceFuture = function (staPrice, age) {
  let staPriceFuture_num;
  let staPriceFuture_row;
  $("#pricetable td:contains('Sell-To-Agent')").text('Agent Price');
  if (age < 18) {
    staPriceFuture_num = "<span class=\"coin\" style=\"color:silver;\">" + en.format(staPrice) + "</span>";
  }
  else {
    staPriceFuture_num = "<span class=\"coin\">" + en.format(staPrice) + "</span>";
  }
  const classOdd = $("#pricetable tbody tr").length % 2 == 0 ? "even" : "odd";
  if (classOdd == "even") {
    staPriceFuture_row = "<tr id=\"sta_price_future\"><td align=\"left\" >Agent Price (Future)</td><td align=\"right\">" + staPriceFuture_num + "</td></tr>";
  }
  else {
    staPriceFuture_row = "<tr class=\"odd\" id=\"sta_price_future\"><td align=\"left\">Agent Price (Future)</td><td align=\"right\">" + staPriceFuture_num + "</td></tr>";
  }

  if ($("#sta_price_future").length == 1) {
    $("#sta_price_future td:nth-child(2)").html(staPriceFuture_num);
  }
  else {
    $("#pricetable").append(staPriceFuture_row);
  }
}

const getRecommendation = function (recAndRating) {
  const maxRec = Math.max(recAndRating[0][FP[0]], recAndRating[0][FP[1]]);
  let star1 = '';
  let star2 = '';
  let star3 = '';
  const star = "<img src = \"/pics/star.png\">";
  const halfstar = "<img src = \"/pics/half_star.png\">";
  const darkstar = "<img src = \"/pics/dark_star.png\">";
  for (let j = 0; j < Math.floor(maxRec); j++) {
    star1 += star;
  }
  star2 = maxRec - Math.floor(maxRec);
  if (maxRec < 5 && star2 >= 0.5)
    star2 = halfstar;
  else
    star2 = "";
  if (5 - MR(maxRec) >= 1) {
    for (let k = 0; k < 5 - MR(maxRec); k++) {
      star3 += darkstar;
    }
  }
  return (star1 + star2 + star3);
}

const getFutureDataForView = function (playerFutureData) {
  const skills = getSkilsObjFromArray(playerFutureData[0]);
  const skills_array = getPlayerSkillsArray(skills);
  const skill_index_number = MR(MP(playerFutureData[1] / playerFutureData[0].length * 14 * 0.023359, 6.99998));
  const skill_index = skill_index_number.toLocaleString();
  const wage = (MR(15.8079 * skill_index_number)).toLocaleString();
  return [wage, skill_index, skills, skills_array, skill_index_number];
}

const getSkilsObjFromArray = function (skills_acc) {
  const getSkillValue = (value) => {
    if (value < 19.0) {
      return Math.floor(value);
    }
    if (value >= 19.0 && value < 20.0) {
      return "<img src='/pics/star_silver.png' alt='19' title='19' />";
    }
    if (value == 20.0) {
      return "<img src='/pics/star.png' alt='20' title='20' />"
    }
  }
  let skills = null;
  if (skills_acc.length == 14) {
    skills = [
      { key: 'strength', name: 'Strength', value: getSkillValue(skills_acc[0]) },
      { key: 'passing', name: 'Passing', value: getSkillValue(skills_acc[7]) },
      { key: 'stamina', name: 'Stamina', value: getSkillValue(skills_acc[1]) },
      { key: 'crossing', name: 'Crossing', value: getSkillValue(skills_acc[8]) },
      { key: 'pace', name: 'Pace', value: getSkillValue(skills_acc[2]) },
      { key: 'technique', name: 'Technique', value: getSkillValue(skills_acc[9]) },
      { key: 'marking', name: 'Marking', value: getSkillValue(skills_acc[3]) },
      { key: 'heading', name: 'Heading', value: getSkillValue(skills_acc[10]) },
      { key: 'tackling', name: 'Tackling', value: getSkillValue(skills_acc[4]) },
      { key: 'finishing', name: 'Finishing', value: getSkillValue(skills_acc[11]) },
      { key: 'workrate', name: 'Workrate', value: getSkillValue(skills_acc[5]) },
      { key: 'longshots', name: 'Longshots', value: getSkillValue(skills_acc[12]) },
      { key: 'positioning', name: 'Positioning', value: getSkillValue(skills_acc[6]) },
      { key: 'set_pieces', name: 'Set Pieces', value: getSkillValue(skills_acc[13]) }
    ]
  }
  else {
    skills = [
      { key: 'strength', name: 'Strength', value: getSkillValue(skills_acc[0]) },
      { key: 'handling', name: 'Handling', value: getSkillValue(skills_acc[3]) },
      { key: 'stamina', name: 'Stamina', value: getSkillValue(skills_acc[1]) },
      { key: 'one_on_ones', name: 'One on ones', value: getSkillValue(skills_acc[4]) },
      { key: 'pace', name: 'Pace', value: getSkillValue(skills_acc[2]) },
      { key: 'reflexes', name: 'Reflexes', value: getSkillValue(skills_acc[5]) },
      { key: 'null', name: 'null1', value: null },
      { key: 'aerial_ability', name: 'Aerial Ability', value: getSkillValue(skills_acc[6]) },
      { key: 'null', name: 'null1', value: null },
      { key: 'jumping', name: 'Jumping', value: getSkillValue(skills_acc[7]) },
      { key: 'null', name: 'null1', value: null },
      { key: 'communication', name: 'Communication', value: getSkillValue(skills_acc[8]) },
      { key: 'null', name: 'null2', value: null },
      { key: 'kicking', name: 'Kicking', value: getSkillValue(skills_acc[9]) },
      { key: 'null', name: 'null3', value: null },
      { key: 'throwing', name: 'Throwing', value: getSkillValue(skills_acc[10]) }
    ]
  }
  return skills;
}

const calculateFutureSkills = function (playerSkills, playerSkillIndex, playerFavPosition, playerTI, playerPhysicalPeak, playerTacticalPeak, playerTechnicalPeak, playerSpecialty, playerTraining) {
  const playerSkillsAcc = getPlayerSkillsAcc(playerSkills, playerSkillIndex, playerFavPosition);
  const trainingAllocation = getTrainingAllocation(playerTraining, playerSpecialty, playerFavPosition);
  const skillsCount = player_fp != 'gk' ? 14 : 11;
  const phyPeakIndexs = player_fp != 'gk' ? phyPeakFieldPlayerIndexs : phyPeakGkPlayerIndexs;
  const tacPeakIndexs = player_fp != 'gk' ? tacPeakFieldPlayerIndexs : tacPeakGkPlayerIndexs;
  const tecPeakIndexs = player_fp != 'gk' ? tecPeakFieldPlayerIndexs : tecPeakGkPlayerIndexs;

  let currentPhyPeak = sumPeak(playerSkillsAcc, phyPeakIndexs);
  let currentTacPeak = sumPeak(playerSkillsAcc, tacPeakIndexs);
  let currentTecPeak = sumPeak(playerSkillsAcc, tecPeakIndexs);


  // running until TI //
  for (let i = 0; i < playerTI; i++) {
    for (const j of phyPeakIndexs) {
      if (currentPhyPeak == playerPhysicalPeak || currentPhyPeak > playerPhysicalPeak) {
        updatePlayerSkillsPeakReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      } else {
        updatePlayerSkillsPeakNotReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      }
    }
    for (const j of tacPeakIndexs) {
      if (currentTacPeak == playerTacticalPeak || currentTacPeak > playerTacticalPeak) {
        updatePlayerSkillsPeakReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      } else {
        updatePlayerSkillsPeakNotReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      }
    }
    for (const j of tecPeakIndexs) {
      if (currentTecPeak == playerTechnicalPeak || currentTecPeak > playerTechnicalPeak) {
        updatePlayerSkillsPeakReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      } else {
        updatePlayerSkillsPeakNotReached(playerSkillsAcc, trainingAllocation, j, skillsCount);
      }
    }
    currentPhyPeak = sumPeak(playerSkillsAcc, phyPeakIndexs);
    currentTacPeak = sumPeak(playerSkillsAcc, tacPeakIndexs);
    currentTecPeak = sumPeak(playerSkillsAcc, tecPeakIndexs);
  }

  for (let i = 0; i < skillsCount; i++) {
    if (playerSkillsAcc[i] > 20.0) {
      playerSkillsAcc[i] = 20.0;
    }
    playerSkillsAcc[i] = Number(playerSkillsAcc[i].toFixed(4));
  }
  const skillSum = Number(playerSkillsAcc.reduce((sum, x) => sum + x).toFixed(1));
  return [playerSkillsAcc, skillSum];
};

const updatePlayerSkillsPeakReached = function (playerSkillsAcc, trainingAllocation, skillIndex, skillsCount) {
  let not20Count = getNot20Count(playerSkillsAcc);
  for (let i = 0; i < skillsCount; i++) {
    if (playerSkillsAcc[i] < 5.0) {
      playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
      if (randomNumber(0, 100) < 50) {
        playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
      }
    }
    if (playerSkillsAcc[i] >= 5.0 && playerSkillsAcc[i] < 15.0) {
      playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
    }
    if (playerSkillsAcc[i] >= 15.0 && playerSkillsAcc[i] < 18.0 && randomNumber(0, 100) < 50) {
      playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0
    };
    if (playerSkillsAcc[i] >= 18.0 && playerSkillsAcc[i] < 20.0 && randomNumber(0, 100) < 40) {
      playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
    }
  }
};

const updatePlayerSkillsPeakNotReached = function (playerSkillsAcc, trainingAllocation, skillIndex, skillsCount) {
  let not20Count = getNot20Count(playerSkillsAcc);
  if (playerSkillsAcc[skillIndex] > 20.0 || playerSkillsAcc[skillIndex] == 20.0) {
    playerSkillsAcc[skillIndex] = 20.0;
    for (let i = 0; i < skillsCount; i++) {
      if (playerSkillsAcc[i] < 5.0) {
        playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
        if (randomNumber(0, 100) < 50) {
          playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
        }
      }
      if (playerSkillsAcc[i] >= 5.0 && playerSkillsAcc[i] < 15.0) {
        playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
      }
      if (playerSkillsAcc[i] >= 15.0 && playerSkillsAcc[i] < 18.0 && randomNumber(0, 100) < 50) {
        playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
      }
      if (playerSkillsAcc[i] >= 18.0 && playerSkillsAcc[i] < 20.0 && randomNumber(0, 100) < 40) {
        playerSkillsAcc[i] += trainingAllocation[skillIndex] / not20Count / 10.0;
      }
    }
  }
  if (playerSkillsAcc[skillIndex] < 5.0) {
    playerSkillsAcc[skillIndex] += trainingAllocation[skillIndex] / 10.0;
    if (randomNumber(0, 100) < 50) {
      playerSkillsAcc[skillIndex] += trainingAllocation[skillIndex] / 10.0;
    }
  }
  if (playerSkillsAcc[skillIndex] >= 5.0 && playerSkillsAcc[skillIndex] < 15.0) {
    playerSkillsAcc[skillIndex] += trainingAllocation[skillIndex] / 10.0;
  }
  if (playerSkillsAcc[skillIndex] >= 15.0 && playerSkillsAcc[skillIndex] < 18.0 && randomNumber(0, 100) < 50) {
    playerSkillsAcc[skillIndex] += trainingAllocation[skillIndex] / 10.0;
  }
  if (playerSkillsAcc[skillIndex] >= 18.0 && playerSkillsAcc[skillIndex] <= 20.0 && randomNumber(0, 100) < 40) {
    playerSkillsAcc[skillIndex] += trainingAllocation[skillIndex] / 10.0;
  }
  if (playerSkillsAcc[skillIndex] > 20.0 || playerSkillsAcc[skillIndex] == 20.0) {
    playerSkillsAcc[skillIndex] = 20.0;
  }
};

const sumPeak = function (playerSkills, skillsIndexs) {
  let sum = 0;
  for (const i of skillsIndexs) {
    sum += playerSkills[i];
  }
  return sum;
};

const getTrainingAllocation = function (playerTraining, playerSpecialty, playerFavPosition) {
  const trainingAllocation = playerFavPosition != 'gk' ? new Array(14).fill(0) : new Array(11).fill(0);
  if (playerFavPosition != 'gk') {
    const weight = playerTraining[0] * 3.0 + playerTraining[1] * 2.0 + playerTraining[2] * 2.0 + playerTraining[3] * 3.0 + playerTraining[4] * 2.0 + playerTraining[5] * 2.0;
    trainingAllocation[0] = (0.95 / weight) * playerTraining[0];
    trainingAllocation[1] = (0.95 / weight) * playerTraining[0];
    trainingAllocation[2] = (0.95 / weight) * playerTraining[2];
    trainingAllocation[3] = (0.95 / weight) * playerTraining[1];
    trainingAllocation[4] = (0.95 / weight) * playerTraining[1];
    trainingAllocation[5] = (0.95 / weight) * playerTraining[0];
    trainingAllocation[6] = (0.95 / weight) * playerTraining[4];
    trainingAllocation[7] = (0.95 / weight) * playerTraining[3];
    trainingAllocation[8] = (0.95 / weight) * playerTraining[2];
    trainingAllocation[9] = (0.95 / weight) * playerTraining[3];
    trainingAllocation[10] = (0.95 / weight) * playerTraining[4];
    trainingAllocation[11] = (0.95 / weight) * playerTraining[5];
    trainingAllocation[12] = (0.95 / weight) * playerTraining[5];
    trainingAllocation[13] = (0.95 / weight) * playerTraining[3];
    trainingAllocation[playerSpecialty] += 0.05;
  } else {
    trainingAllocation[0] = 0.8 / 11;
    trainingAllocation[1] = 0.8 / 11;
    trainingAllocation[2] = 0.8 / 11;
    trainingAllocation[3] = 0.8 / 11;
    trainingAllocation[4] = 0.8 / 11;
    trainingAllocation[5] = 0.8 / 11;
    trainingAllocation[6] = 0.8 / 11;
    trainingAllocation[7] = 0.8 / 11;
    trainingAllocation[8] = 0.8 / 11;
    trainingAllocation[9] = 0.8 / 11;
    trainingAllocation[10] = 0.8 / 11;
    trainingAllocation[playerSpecialty] += 0.2;
  }
  return trainingAllocation;
};

const getPlayerSkillsAcc = function (playerSkills, playerSkillIndex, playerFavPosition) {
  let playerSkillsAcc = [];
  const playerSkillsArray = getPlayerSkillsArray(playerSkills);
  const not20 = getNot20Count(playerSkillsArray);
  const skillSumWithoutRemainder = playerSkillsArray.reduce((sum, x) => sum + x);
  const playerSkillIndexNumber = Number(new String(playerSkillIndex).replace(/,/g, ''));

  let weight = playerFavPosition != 'gk' ? 263533760000 : 48717927500;
  let skillSum = Math.pow(2, Math.log(weight * playerSkillIndexNumber) / Math.log(Math.pow(2, 7)));
  skillSum = Number(skillSum.toFixed(1));
  const remainder = skillSum - skillSumWithoutRemainder;
  const skill_add = remainder / not20;

  for (let i = 0; i < playerSkillsArray.length; i++) {
    if (playerSkillsArray[i] < 20) {
      playerSkillsAcc.push(playerSkillsArray[i] + skill_add);
    } else {
      playerSkillsAcc.push(20);
    }
  }
  return playerSkillsAcc;
};

const getPlayerSkillsArray = function (playerSkills) {
  const skillArray = [];
  for (let i = 0; i < playerSkills.length; i += 2) {
    if (playerSkills[i].value !== null) {
      if (Number.isInteger(playerSkills[i].value)) {
        skillArray.push(playerSkills[i].value);
      } else {
        if (playerSkills[i].value.indexOf('star.png') > 0) {
          skillArray.push(20);
        } else if (playerSkills[i].value.indexOf('star_silver.png') > 0) {
          skillArray.push(19);
        }
      }
    }
  }
  for (let i = 1; i < playerSkills.length; i += 2) {
    if (playerSkills[i].value !== null) {
      if (Number.isInteger(playerSkills[i].value)) {
        skillArray.push(playerSkills[i].value);
      } else {
        if (playerSkills[i].value.indexOf('star.png') > 0) {
          skillArray.push(20);
        } else if (playerSkills[i].value.indexOf('star_silver.png') > 0) {
          skillArray.push(19);
        }
      }
    }
  }
  return skillArray;
};

const getNot20Count = function (playerSkills) {
  let not20Count = 0;
  for (let i = 0; i < playerSkills.length; i++) {
    if (playerSkills[i] < 20.0) {
      not20Count++;
    }
  }
  return not20Count;
};

const calculateFutureRoutine = function (currentAge, currentMonth, currentRoutine, targetAge) {
  const weeksDiff = Number(targetAge - 1) * 12 + 11 - (Number(currentAge) * 12 + Number(currentMonth));
  const gainedRoutine = 0.3 * weeksDiff;
  const newRoutine = ((Number(currentRoutine) + gainedRoutine).toFixed(1)).toString();
  return newRoutine;
};

//set input style and attr//
const setInputHeaderStyle = function (inputHeaderTR, inputHeaderTD) {
  inputHeaderTR.style.display = 'flex';
  inputHeaderTD.style.textAlign = 'center';
  inputHeaderTD.style.fontWeight = 'bold';
  inputHeaderTD.style.color = 'black';
  inputHeaderTD.style.flex = '1';
};

//set input style and attr//
const setInputStyle = function (inputTR) {
  inputTR.style.display = 'flex';
  inputTR.style.justifyContent = 'space-between';
};

//set input style and attr//
const setInput = function (input, id, min, max, default_value) {
  input.type = 'number';
  input.id = id;
  input.min = min;
  input.max = max;
  input.value = default_value;
  input.style.width = '65px';
  input.style.background = 'transparent';
  input.style.color = 'white';
  input.style.border = 'none';
  input.style.float = 'right';
  input.style.textAlign = 'center';
  return;
};

// set select style and options //
const setSpecialty = function (select, id) {
  select.id = id;
  select.style.color = 'white';
  select.style.border = 'none';
  select.style.background = '#649024';
  select.style.float = 'right';
  select.style['text-align'] = 'center';
  select.style['max-width'] = '85px';
};

// set options for select //
const setOptions = function (select) {
  let skillsArray = player_fp == 'gk' ? SPECIALTY_ARRAY_GK_PLAYER : SPECIALTY_ARRAY_FIELD_PLAYER;

  for (const [key, value] of skillsArray.entries()) {
    let option = document.createElement('option');
    option.text = value;
    option.value = key - 1;
    select.appendChild(option);
  }
};

const randomNumber = function (min, max) {
  return Math.floor(Math.random() * (max - min) + min);
};

const getPlayerData = function (playerId) {
  return $.post('//trophymanager.com/ajax/tooltip.ajax.php', {
    player_id: playerId,
  });
};


const getPlayerTrainingCustom = function (playerId, clubId) {
  return new Promise((resolve, reject) => {
    $.post('https://trophymanager.com/ajax/players_get_select.ajax.php', {
      type: 'change',
      club_id: clubId,
    })
      .done((data) => {
        let playerData = JSON.parse(data).post[playerId];
        resolve(playerData.training_custom);
      })
      .fail((error) => {
        throw 'Failed to retrieve players data: ' + JSON.stringify(error);
      });
  });
};

// Get Player Report Data//
const getPlayerReport = function (playerId) {
  return $.get("//autoscoutproject.com/scout/api/report/read.php", {
    "player_id": playerId
  });
}


const getPlayerBaseData = function (playerTooltipData) {
  let playerBaseData = {};
  const playerSkillsArray = getPlayerSkillsArray(playerTooltipData.skills);
  const playerSkillIndexNumber = getSkillIndexNumber(playerTooltipData.skill_index);
  const playerRoutineBonus = getRoutineBonus(playerTooltipData.routine)
  const playerSkillsAcc = getPlayerSkillsAcc(playerTooltipData.skills, playerTooltipData.skill_index, playerTooltipData.favposition);
  const playerSkillsB = getSkilsB(playerSkillsAcc, playerRoutineBonus);
  const [recAndRating, R5FP0, R5FP1] = getREREC(positionArray, playerSkillsArray, playerSkillIndexNumber, playerRoutineBonus, playerSkillsB)
  playerBaseData['player_id'] = playerTooltipData.player_id;
  playerBaseData['age'] = playerTooltipData.age;
  playerBaseData['months'] = playerTooltipData.months;
  playerBaseData['wage'] = playerTooltipData.wage.match(/<span class='coin'>(.*?)<\/span>/)[1];
  playerBaseData['recommendation'] = playerTooltipData.recommendation;
  playerBaseData['skill_index'] = playerTooltipData.skill_index;
  playerBaseData['routine'] = playerTooltipData.routine;
  playerBaseData['favposition'] = playerTooltipData.favposition;
  playerBaseData['skills'] = playerTooltipData.skills;
  playerBaseData['skills_acc'] = playerSkillsAcc;
  playerBaseData['skills_array'] = playerSkillsArray;
  playerBaseData['skill_index_number'] = playerSkillIndexNumber;
  playerBaseData['skillsB'] = playerSkillsB
  playerBaseData['rerec'] = recAndRating;
  playerBaseData['R5FP0'] = R5FP0;
  playerBaseData['R5FP1'] = R5FP1;
  return playerBaseData;
};

const getREREC = function (positionArray, playerSkillsArray, playerSkillIndexNumber, playerRoutineBonus, playerSkillsB) {
  let REREC = [[], [], []]
  for (let i = 0; i < positionArray.length; i++) {
    let positionIndex = findPositionIndex(positionArray[i]);
    if (i == 0) {
      REREC = calculateREREC(positionIndex, playerSkillsArray, playerSkillIndexNumber, playerRoutineBonus, playerSkillsB);
    }
  }
  return REREC
}


const calculateREREC = function (positionIndex, playerSkillsArray, playerSkillIndexNumber, playerRoutineBonus, playerSkillsB) {
  let weight = positionIndex == 13 ? 48717927500 : 263533760000;
  let rec = [];			// RERECb
  let ratingR = [];		// RatingR5
  let ratingR5 = [];		// RatingR5 + routine
  let skillSum = 0;
  for (let i = 0; i < playerSkillsArray.length; i++) {
    skillSum += Number(playerSkillsArray[i]);
  }
  skillSum = funFix1(skillSum);
  for (i = 0; 2 + i <= positionIndex; i += 2) {		// TrExMaとRECのweight表のずれ修正
    positionIndex--;
  }
  let remainder = MR((MP(2, ML(weight * playerSkillIndexNumber) / ML(MP(2, 7))) - skillSum) * 10) / 10;		// RatingR5 remainder
  if (remainder == -0) {
    remainder = 0;
  }
  for (let i = 0; i < 10; i++) {
    rec[i] = 0;
    ratingR[i] = 0;
  }
  for (let j = 0; j < 9; j++) {		// All position
    let remainderWeight = 0;		// REREC remainder weight sum
    let remainderWeight2 = 0;		// RatingR5 remainder weight sum
    let not20 = 0;					// 20以外のスキル数
    if (positionIndex == 9) j = 9;	// GK

    for (let i = 0; i < weightR[positionIndex].length; i++) {
      rec[j] += playerSkillsArray[i] * weightRb[j][i];
      ratingR[j] += playerSkillsArray[i] * weightR5[j][i];
      if (playerSkillsArray[i] != 20) {
        remainderWeight += weightRb[j][i];
        remainderWeight2 += weightR5[j][i];
        not20++;
      }
    }


    if (remainder / not20 > 0.9 || not20 == 0) {
      if (positionIndex == 9) not20 = 11;
      else not20 = 14;
      remainderWeight = 1;
      remainderWeight2 = 5;
    }
    rec[j] = funFix3((rec[j] + remainder * remainderWeight / not20 - 2) / 3);
    ratingR[j] += remainder * remainderWeight2 / not20;
    ratingR5[j] = funFix2(ratingR[j] + playerRoutineBonus * 5);
    ratingR[j] = funFix2(ratingR[j]);
    if (positionIndex == 9) j = 9;		// Loop end
  }


  let recAndRating = [rec, ratingR, ratingR5];

  const { R5FP0, R5FP1, posGain, posKeep, headerBonus, ckBonus, fkBonus, pkBonus, allBonus } = calc_R5bonus(playerSkillsB, recAndRating);

  if (playerSkillsArray.length == 14) {
    for (let i = 0; i < 9; i++) {
      rec[i] = funFix3(rec[i] * 1);
      ratingR5[i] = funFix2(ratingR5[i] * 1 + allBonus * 1 + posGain[i] * 1 + posKeep[i] * 1);
      if (ratingR5[i] >= 100) ratingR5[i] = funFix1(ratingR5[i]);
    }
  }
  return [recAndRating, R5FP0, R5FP1];
}

const calc_R5bonus = function (skillsB, REREC) {
  let headerBonus = skillsB[10] > 12 ? funFix2((MP(Math.E, (skillsB[10] - 10) ** 3 / 1584.77) - 1) * 0.8 + MP(Math.E, (skillsB[0] * skillsB[0] * 0.007) / 8.73021) * 0.15 + MP(Math.E, (skillsB[6] * skillsB[6] * 0.007) / 8.73021) * 0.05) : 0;
  let fkBonus = funFix2(MP(Math.E, MP(skillsB[13] + skillsB[12] + skillsB[9] * 0.5, 2) * 0.002) / 327.92526);
  let ckBonus = funFix2(MP(Math.E, MP(skillsB[13] + skillsB[8] + skillsB[9] * 0.5, 2) * 0.002) / 983.65770);
  let pkBonus = funFix2(MP(Math.E, MP(skillsB[13] + skillsB[11] + skillsB[9] * 0.5, 2) * 0.002) / 1967.31409);
  let gainBase = funFix2((skillsB[0] ** 2 + skillsB[1] ** 2 * 0.5 + skillsB[2] ** 2 * 0.5 + skillsB[3] ** 2 + skillsB[4] ** 2 + skillsB[5] ** 2 + skillsB[6] ** 2) / 6 / 22.9 ** 2);
  let keepBase = funFix2((skillsB[0] ** 2 * 0.5 + skillsB[1] ** 2 * 0.5 + skillsB[2] ** 2 + skillsB[3] ** 2 + skillsB[4] ** 2 + skillsB[5] ** 2 + skillsB[6] ** 2) / 6 / 22.9 ** 2);
  //	0:DC			1:DL/R			2:DMC			3:DML/R			4:MC			5:ML/R			6:OMC			7:OML/R			8:F
  let posGain = [gainBase * 0.3, gainBase * 0.3, gainBase * 0.9, gainBase * 0.6, gainBase * 1.5, gainBase * 0.9, gainBase * 0.9, gainBase * 0.6, gainBase * 0.3];
  let posKeep = [keepBase * 0.3, keepBase * 0.3, keepBase * 0.9, keepBase * 0.6, keepBase * 1.5, keepBase * 0.9, keepBase * 0.9, keepBase * 0.6, keepBase * 0.3];
  let allBonus = skillsB.length == 11 ? 0 : headerBonus * 1 + fkBonus * 1 + ckBonus * 1 + pkBonus * 1;

  let R5FP0 = skillsB.length == 11 ? funFix2(REREC[2][FP[0]] * 1 + allBonus * 1) : funFix2(REREC[2][FP[0]] * 1 + allBonus * 1 + posGain[FP[0]] * 1 + posKeep[FP[0]] * 1);
  let R5FP1 = skillsB.length == 11 ? funFix2(REREC[2][FP[1]] * 1 + allBonus * 1) : funFix2(REREC[2][FP[1]] * 1 + allBonus * 1 + posGain[FP[1]] * 1 + posKeep[FP[1]] * 1);

  return { R5FP0, R5FP1, posGain, posKeep, headerBonus, ckBonus, fkBonus, pkBonus, allBonus };
}

const getSkillIndexNumber = function (playerSkillIndex) {
  return Number(new String(playerSkillIndex).replace(/,/g, ''));
}

const getRoutineBonus = function (routine) {
  return (3 / 100) * (100 - (100) * MP(Math.E, -routine * 0.035));
}

const findPositionIndex = function (position) {
  let index = -1;
  for (let i = 0; i < positionFullNames.length; i++) {
    for (let j = 0; j < positionFullNames[i].length; j++) {
      if (position.indexOf(positionFullNames[i][j]) == 0) return j;
    }
  }
  return index;
};

const getSkilsB = function (skills, routineBonus) {
  let skillsB = [];
  for (i = 0; i < skills.length; i++) {
    if (i == 1) {
      skillsB[1] = skills[1];
    }
    else {
      skillsB[i] = skills[i] * 1 + routineBonus;
    }
  }
  return skillsB
}

const funFix1 = (i) => {
  i = (MR(i * 10) / 10).toFixed(1);
  return i;
}

const funFix2 = (i) => {
  i = (MR(i * 100) / 100).toFixed(2);
  return i;
}

const funFix3 = (i) => {
  i = (MR(i * 1000) / 1000).toFixed(3);
  return i;
}

const setPositionArray = function () {
  const positionCell = document.getElementsByClassName("favposition long")[0].childNodes;
  const positionArray = [];
  if (positionCell.length == 1) {
    positionArray[0] = positionCell[0].textContent;
  }
  else if (positionCell.length == 2) {
    positionArray[0] = positionCell[0].textContent + positionCell[1].textContent;
  }
  else if (positionCell[1].className == "split") {
    positionArray[0] = positionCell[0].textContent + positionCell[3].textContent;
    positionArray[1] = positionCell[2].textContent + positionCell[3].textContent;
  }
  else if (positionCell[3].className == "f") {
    positionArray[0] = positionCell[0].textContent + positionCell[1].textContent;
    positionArray[1] = positionCell[3].textContent;
  }
  else {
    positionArray[0] = positionCell[0].textContent + positionCell[1].textContent;
    positionArray[1] = positionCell[0].textContent + positionCell[3].textContent;
  }
  return positionArray;
}

const setFP = function (positionArray) {
  let FP = [];
  for (var i = 0; i < positionArray.length; i++) {
    let positionIndex = findPositionIndex(positionArray[i]);
    FP[i] = positionIndex;
    FP[i + 1] = FP[i];
  }
  for (i = 0; i < FP.length; i++) {
    for (j = 0; 2 + j <= FP[i]; j += 2) FP[i]--;
  }
  return [FP[0], FP[1]];

}

const getByValue = function (map, searchValue) {
  for (let [key, value] of map.entries()) {
    if (value === searchValue)
      return key;
  }
}

const setTalentAndBoostRatesFieldPlayer = function (talent, boost, boostAge) {
  const talentNumber = Number(talent);
  const boostNumber = Number(boost);
  const boostAgeNumber = Number(boostAge);
  talentTI[0] = talentNumber * 0.34;
  talentTI[1] = talentNumber * 0.31;
  talentTI[2] = talentNumber * 0.285;
  talentTI[3] = talentNumber * 0.26;
  for (let i = 4; i < 14; i++) {
    talentTI[i] = talentWeightsFieldPlayer[talentNumber - 1][i - 4];
  }
  for (let i = 0; i < 14; i++) {
    let age = i + 15;
    if (age >= boostAgeNumber && age < (boostAgeNumber + 3)) {
      boostTI[i] = boostNumber / 3;
    }
    else {
      boostTI[i] = 0;
    }
  }
}

const setTalentAndBoostRatesGkPlayer = function (talent, boost, boostAge) {
  const talentNumber = Number(talent);
  const boostNumber = Number(boost);
  const boostAgeNumber = Number(boostAge);
  for (let i = 0; i < 14; i++) {
    talentTI[i] = talentWeightsGkPlayer[talentNumber - 1][i];
  }
  for (let i = 0; i < 14; i++) {
    let age = i + 15;
    if (age >= boostAgeNumber && age < (boostAgeNumber + 3)) {
      boostTI[i] = (boostNumber / 3) * 1.18;
    }
    else {
      boostTI[i] = 0;
    }
  }
}



const setTiAgeFieldPlayer = function () {
  const playerTraining = getPlayerTrainingArrayFromInput()
  const trainingPercentage = playerTraining.reduce((sum, index) => sum + pointsAllc[index], 0);
  for (let i = 0; i < 14; i++) {
    TiAge[i] = Math.ceil((talentTI[i] + boostTI[i]) / 102 * trainingPercentage);
  }
}

const setTiAgeGkPlayer = function () {
  for (let i = 0; i < 14; i++) {
    TiAge[i] = Math.ceil(talentTI[i] + boostTI[i]);
  }
}

const setTiTotal = function (currentAge, currentMonth) {
  const ageNumber = Number(currentAge);
  const monthNumber = Number(currentMonth);
  for (let i = 0; i < 14; i++) {
    if (ageNumber > (i + 15)) {
      TiTotal[i] = 0;
    }
    if (ageNumber == (i + 15)) {
      TiTotal[i] = (11 - monthNumber) * TiAge[i];
    }
    if (ageNumber < (i + 15)) {
      TiTotal[i] = (12) * TiAge[i];
    }
  }
}

const getTargetAgeTotalTi = function (targetAge) {
  const targetAgeNumber = Number(targetAge);
  let totalTi = 0;
  for (let i = 0; i < (targetAgeNumber - 15); i++) {
    totalTi = totalTi + TiTotal[i];
  }
  return totalTi;
}


const calc_SellToAgent = function (SI, year, month) {
  const ageMonths = year * 12 + month;
  const posIndex = player_fp != 'gk' ? 1 : 0.75;
  const staPrice = parseInt(SI * 500 * MP(300 / ageMonths, 2.5) * posIndex)
  return staPrice;
}

const tempVal = 11;

(function () {
  ('use strict');
  positionArray = setPositionArray();
  FP = setFP(positionArray);
  present();
  getPlayerData(playerId).then((values) => {
    let data = JSON.parse(values);
    playerBaseData = getPlayerBaseData(data.player);
    getPlayerTrainingCustom(playerId, clubId).then((playerTraining) => {
      getPlayerReport(playerId).then((report) => {
        setInputTable(report, playerTraining, playerBaseData.age);
        const TI_Input = document.querySelector('#TI_Input');
        if (player_fp != 'gk' && report.talent != null && report.boost != null && report.boost_age != null) {
          setTalentAndBoostRatesFieldPlayer(report.talent, report.boost, report.boost_age);
          setTiAgeFieldPlayer();
          setTiTotal(playerBaseData.age, playerBaseData.months);
          TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
        }

        if (player_fp == 'gk' && report.talent != null && report.boost != null && report.boost_age != null) {
          setTalentAndBoostRatesGkPlayer(report.talent, report.boost, report.boost_age);
          setTiAgeGkPlayer();
          setTiTotal(playerBaseData.age, playerBaseData.months);
          TI_Input.value = getTargetAgeTotalTi(TargetAge_Input.value);
        }


        if (player_fp != 'gk') {
          updateTrainingSummary(getPlayerTrainingArrayFromInput());
        }

        let parent = document.getElementsByClassName('column1')[0];
        let elementsToMove = document.querySelectorAll('.column1 > :not(.box)');
        elementsToMove.forEach(function (element) {
          parent.appendChild(element);
        });
      })
    });
  });
})();
