// ==UserScript==
// @name         商品編碼
// @namespace    http://tampermonkey.net/
// @version      1.1.0
// @description  商品編碼11
// @author       Cahozh
// @match       https://swapp.singlewindow.cn/decserver/sw/dec/*
// @require      https://unpkg.com/jquery@3.6.0/dist/jquery.min.js
// @grant        none
// @include /^http[s]?:\/\/(\w*\.)?tujidao[\d]*\.com.*$/
// @grant  GM_xmlhttpRequest
// @license MIT
// @downloadURL https://update.greasyfork.org/scripts/455386/%E5%95%86%E5%93%81%E7%B7%A8%E7%A2%BC.user.js
// @updateURL https://update.greasyfork.org/scripts/455386/%E5%95%86%E5%93%81%E7%B7%A8%E7%A2%BC.meta.js
// ==/UserScript==

(function() {
    'use strict';

    var codeTsArr = ["0106392390","0106392310","0106329090","0106329010","0106321090","0106321010","0106202019","0106202011","0106201990","0106201910","0106122990","0106122910","0106122190","0106122110","1211903985","1211903984","1211903983","1211903982","1211903979","1211903971","1211901790","1211901710","1211901690","1211901610","1211901490","1211901410","1211209999","1211209991","1211209299","1211209291","1211209199","1211209191","0602909430","0602909420","0602409090","0602409010","0602401090","0602401010","0602309090","0602309010","0602301090","0602301010","0507909030","0507909020","0507909019","0507909011","0507902090","0507902010","9403830090","9403830010","9403820090","9403820010","9401619090","9401619010","9401611090","9401611010","9401530090","9401530010","9401520090","9401520010","9401419090","9401419010","9401411090","9401411010","7226110010","7226110010","7226110010","7225110010","7225110010","7225110010","4421911020","4420191290","4420191210","4419190090","4419190010","4419129090","4419129010","4419121020","4419110090","4419110010","4407960090","4407960010","4407930099","4407930091","4407930019","4407930011","4407920099","4407920091","4407920019","4407920011","4407910092","4407910012","4407210099","4407210091","4407210019","4407210011","4403960000","4403950000","4403930090","4403930010","4403910020","4401120090","4401120010","4401110090","4401110010","3004905290","3004905210","3002120094","3001909019","3001909011","2006009000","2005999929","2005999921","2005919000","2005911000","1401100000","1301903090","1301903010","1212291090","1212291010","1212216999","1212216991","1212216919","1212216911","1212216190","1212216110","0908320090","0908320010","0908310090","0908310010","0908220090","0908220010","0908210090","0908210010","0908120090","0908120010","0908110090","0908110010","0709991000","0709595090","0709595010","0709560090","0709560010","0709550090","0709550010","0712901000","0712399920","0711903100","0711591920","0802999019","0802999011","0802920019","0802920011","0802910019","0802910011","0106392390","0106392310","0106329090","0106329010","0106321090","0106321010","0106202019","0106202011","0106201990","0106201910","0106122990","0106122910","0106122190","0106122110","1211903985","1211903984","1211903983","1211903982","1211903979","1211903971","1211901790","1211901710","1211901690","1211901610","1211901490","1211901410","1211209999","1211209991","1211209299","1211209291","1211209199","1211209191","0602909430","0602909420","0602409090","0602409010","0602401090","0602401010","0602309090","0602309010","0602301090","0602301010","0507909030","0507909020","0507909019","0507909011","0507902090","0507902010","9403830090","9403830010","9403820090","9403820010","9401619090","9401619010","9401611090","9401611010","9401530090","9401530010","9401520090","9401520010","9401419090","9401419010","9401411090","9401411010","4421911020","4420191290","4420191210","4419190090","4419190010","4419129090","4419129010","4419121020","4419110090","4419110010","4407960090","4407960010","4407930099","4407930091","4407930019","4407930011","4407920099","4407920091","4407920019","4407920011","4407910092","4407910012","4407210099","4407210091","4407210019","4407210011","4403960000","4403950000","4403930090","4403930010","4403910020","4401120090","4401120010","4401110090","4401110010","3004905290","0604901090","3004905210","3002120094","3001909019","3001909011","2006009000","2005999929","2005999921","2005919000","2005911000","1401100000","1301903090","1301903010","1212291090","1212291010","0604901010","1212216999","1212216991","1212216919","1212216911","1212216190","1212216110","0908320090","0908320010","0908310090","0908310010","0908220090","0908220010","0908210090","0908210010","0908120090","0908120010","0908110090","0908110010","0709991000","0709595090","0709595010","0709560090","0709560010","0709550090","0709550010","0712901000","0712399920","0711903100","0711591920","0802999019","0802999011","0802920019","0802920011","0802910019","0802910011","0604901090","0604901010","0604201090","0604201090","0604201010","0601102990","0601102910","0601102190","0601102110","0510003090","0510003010","0407110000","0305591020","0305591010","0210930090","0210930010","0210920020","0210920019","0210920011","0604201010","0208500090","0208500010","0208400020","0208400019","0208400011","0201300010","0201200010","0201100010","2001909050","2001909030","2001909020","0601102990","0601102910","0601102190","0601102110","0510003090","0510003010","2004900030","2004900020","1211903810","1211209910","1211209210","1211209110","1211202990","1211202910","1211202190","1211202110","0802991000","0601101000","0507909090","0407110000","0712909910","0202300010","0202200010","0202100010","0305591020","0305591010","6702901010","6701000010","4418910010","4418890010","4418830010","4418820010","4418810010","4421919010","4412310010","4412109990","4412109910","4412109590","4412109510","4412109490","4412109410","4412109390","4412109310","4412102099","4412102091","4412102019","4412102011","4412101999","4412101991","4412101919","4412101911","4412101191","4412101111","4409229020","4409221020","4409219010","4409211010","4408901310","4408399010","4408392010","4408391910","4408391110","4403998010","4403995000","4403499020","4403269020","4403269010","4403259020","4403259010","4403240010","4403230010","4403229010","4403219010","4403120010","4403110020","4403110010","4302301010","3301291000","0210930090","0210930010","0210920020","0210920019","0210920011","0208500090","0208500010","0208400020","0208400019","0208400011","2008199910","2003909020","2003901020","1515909010","1302199095","1302194000","1301904010","0812900060","0811909030","0811909021","0709999010","0709591000","0710809030","0602909930","0602909410","0602909120","0510002010","0103920010","0103912010","0103911010","0203290010","0203220090","0203220010","0203219090","0203219010","0203211090","0203211010","0203190010","0203120090","0203120010","0203119090","0203119010","0203111090","0203111010"];
    var codeDataArr = [];
    var str = "";
    var obj = {};
    for (var i=0;i<codeTsArr.length;i++){
        if (obj[codeTsArr[i]] == undefined) {
            str += (getCodeBaseByAjax(codeTsArr[i]) + "###");
            obj[codeTsArr[i]] = 1;
        }
    }

    $("body").html(str)


    function getCodeBaseByAjax(codeTs){
        var sql = "";
        $.ajax({
            async:false,
            type : "POST",
            url:"https://swapp.singlewindow.cn/decserver/sw/dec/common/L1ufEw8VxD?keyValue="+codeTs,
            success:function(rtData){
                if(rtData){

                    codeDataArr.push(JSON.parse(rtData).rows[0]);
                    sql = getCodeGmodelByAjax(JSON.parse(rtData).rows[0],codeTs);

                }
            }
        });
        return sql;
    }

function getCodeGmodelByAjax(codeBaseData,codeTs){
    var sql;
    $.ajax({
        async:false,
        type : "POST",
        url:"https://swapp.singlewindow.cn/decserver/sw/dec/common/L1ufEw8VxE",
        data : JSON.stringify({'codeTs':codeTs, 'ieFlag':'E'}),
        dataType : "json",
        contentType : "application/json;charset=UTF-8",
        success:function(rtData){
            if(rtData){
                var decFactor = "";
                for (var i = 0; i < rtData.length;i++ ) {
                    decFactor += (i + '.' +rtData[i].textName);
                }
                

                sql = "INSERT INTO BILL_BD_FREIGHT (ID, GOODS_CODING, EXTRA_CODE, GOODS_NAME_CN, GOODS_NAME_EN, LEGAL_UNIT, SECOND_UNIT, DECLARATION_FACTOR, CUSTOMS_SUPERVISION, CIQ_SUPERVISION, CREATE_USER, CREATE_TIME, UPDATE_USER, UPDATE_TIME, NOTE_S, FLAG, CODE_TS, TRADE_CODE) " +
                    "VALUES (SYS_GUID(), '"+codeTs.substr(0,8)+"', '"+codeTs.substr(8)+"', '"+codeBaseData.gname+"', null, '"+codeBaseData.unit1+"', '"+codeBaseData.unit2+"', '"+decFactor+"', null, null, 'admin', sysdate, 'admin', sysdate, '"+codeBaseData.noteS+"', '0', '"+codeTs+"', '"+codeBaseData.controlMark+"');"
            }
        }
    });
    return sql;
}
})();