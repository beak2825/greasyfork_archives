// ==UserScript==
// @name         vSprint Info+
// @namespace    http://tampermonkey.net/
// @version      2.5
// @description  Modu statystk allegro z poziomu listingu
// @author       Pawe Kaczmarek
// @match        https://allegro.pl/listing?string=*
// @match        https://allegro.pl/produkt/*
// @match        https://allegro.pl/kategoria/*
// @match        https://allegro.pl/uzytkownik/*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/509170/vSprint%20Info%2B.user.js
// @updateURL https://update.greasyfork.org/scripts/509170/vSprint%20Info%2B.meta.js
// ==/UserScript==

!function(){"use strict";var e;function t(){document.querySelectorAll("div[data-role='rightItems'] article, .sponsored-article-selector article").forEach((function(e){if(!e.querySelector("button.statystyka-btn")){var t=function(e){var t=e.querySelector("a[href*='/oferta/']");if(t){return t.getAttribute("href").split("-").pop()}return null}(e),o=function(e){var t=e.querySelector("h2");return t?t.textContent.trim():""}(e);if(t){var r=document.createElement("button");r.className="statystyka-btn",r.innerHTML="Statystyka",r.style.position="absolute",r.style.right="0px",r.style.bottom="62px",r.style.padding="10px 20px",r.style.backgroundColor="#007bff",r.style.color="#fff",r.style.border="none",r.style.borderRadius="5px",r.style.cursor="pointer",r.style.zIndex="10000",e.style.position="relative",e.appendChild(r),r.addEventListener("click",(function(e){e.stopPropagation(),function(e,t){var o=document.querySelector("#statystyka-modal");if(o)o.style.transform="translateX(0)";else{var r=document.createElement("div");r.id="statystyka-modal",r.style.position="fixed",r.style.top="0",r.style.right="0",r.style.width="35%",r.style.height="100%",r.style.backgroundColor="#ffffff",r.style.overflowY="auto",r.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.2)",r.style.transform="translateX(100%)",r.style.transition="transform 0.3s ease",r.style.zIndex="10000",r.style.color="#333",r.style.fontFamily="Arial, sans-serif";var s=document.createElement("div");s.style.padding="20px",s.style.position="relative",s.style.lineHeight="1.6";var i=document.createElement("span");i.innerHTML="&times;",i.style.position="absolute",i.style.top="10px",i.style.right="10px",i.style.cursor="pointer",i.style.fontSize="24px",i.style.color="#007bff",i.addEventListener("click",(function(){r.style.transform="translateX(100%)",setTimeout((function(){r.remove()}),300)}));var l=document.createElement("div");l.id="statystyka-content";var d=document.createElement("script"),c=document.createElement("script");d.src="https://cdn.jsdelivr.net/npm/flatpickr",c.src="https://cdn.jsdelivr.net/npm/chart.js",document.head.appendChild(d),document.head.appendChild(c);var p=document.createElement("script");p.src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js",document.head.appendChild(p),Promise.all([new Promise((e=>{d.onload=e})),new Promise((e=>{p.onload=e}))]).then((()=>{var e=document.querySelector("#start-date"),t=document.querySelector("#end-date");function n(){e&&t&&(localStorage.setItem("start-date",e.value),localStorage.setItem("end-date",t.value))}function a(){var n=localStorage.getItem("start-date"),a=localStorage.getItem("end-date");n&&(e.value=n),a&&(t.value=a)}e&&flatpickr(e,{dateFormat:"Y-m-d",disableMobile:!0,locale:"pl",allowInput:!1,onChange:n}),t&&flatpickr(t,{dateFormat:"Y-m-d",disableMobile:!0,locale:"pl",allowInput:!1,onChange:n}),a();var o=document.createElement("button");o.innerText="Poprzedni tydzie",o.className="date-button",o.addEventListener("click",(function(){var n=new Date,a=new Date(n.setDate(n.getDate()-n.getDay()-7)),o=new Date(n.setDate(n.getDate()-6));e.value=o.toISOString().split("T")[0],t.value=a.toISOString().split("T")[0]}));var r=document.createElement("button");r.innerText="Ostatnie 7 dni",r.className="date-button";var s=document.createElement("button");s.innerText="Ostatnie 14 dni",s.className="date-button",r.addEventListener("click",(function(){var n=new Date;n.setDate(n.getDate()-1);var a=new Date(n);a.setDate(a.getDate()-6),e.value=a.toISOString().split("T")[0],t.value=n.toISOString().split("T")[0]})),s.addEventListener("click",(function(){var n=new Date;n.setDate(n.getDate()-1);var a=new Date(n);a.setDate(a.getDate()-13),e.value=a.toISOString().split("T")[0],t.value=n.toISOString().split("T")[0]}));var i=document.createElement("button");i.innerText="Wczoraj",i.className="date-button",i.addEventListener("click",(function(){var n=new Date;n.setDate(n.getDate()-1),e.value=n.toISOString().split("T")[0],t.value=n.toISOString().split("T")[0]}));var d=document.createElement("div");d.className="DataButton-container",d.appendChild(i),d.appendChild(o),d.appendChild(r),d.appendChild(s);var c=u.querySelector("#fetch-data-btn");u.insertBefore(d,c),l.appendChild(u)}));var u=document.createElement("div");u.innerHTML='\n            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">\n\n            <div class="date-container">\n                <label for="start-date">Data pocztkowa:</label>\n                <input type="text" id="start-date" placeholder="Wybierz dat">\n            </div>\n            <div class="date-container">\n                <label for="end-date">Data kocowa:</label>\n                <input type="text" id="end-date" placeholder="Wybierz dat">\n            </div>\n            <button id="fetch-data-btn">Pobierz dane</button>\n        ',u.style.marginBottom="20px",s.appendChild(i),s.appendChild(u),s.appendChild(l),r.appendChild(s),document.body.appendChild(r),setTimeout((function(){r.style.transform="translateX(0)"}),10),document.querySelector("#fetch-data-btn").addEventListener("click",(function(){var o=document.querySelector("#start-date").value,r=document.querySelector("#end-date").value;!async function(e,t,o,r){var s=document.querySelector("#statystyka-content");if(!s)return;s.innerHTML='\n        <div id="loading-spinner" style="display: flex; justify-content: center; align-items: center;">\n            <div style="border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #007bff; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>\n        </div>\n        <style>\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n        </style>\n    ';try{var i=await fetch("https://edge.allegro.pl/analytics/auction/deals",{credentials:"include",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:128.0) Gecko/20100101 Firefox/128.0",Accept:"application/vnd.allegro.internal.v1+json","Accept-Language":"pl-PL","Content-Type":"application/vnd.allegro.internal.v1+json","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site",Priority:"u=0",Pragma:"no-cache","Cache-Control":"no-cache"},referrer:"https://allegro.pl/",body:JSON.stringify({includePhrasesMode:"OfferOrProduct",excludePhrasesMode:"OfferOrProduct",auctionId:e,sellerIds:[],marketplaceIds:["allegro-pl"],startDate:o,endDate:r,startDateTime:o+"T00:00:00.000Z",endDateTime:r+"T23:59:59.999Z",reportCode:"TOP7D"}),method:"POST",mode:"cors"}),l=await fetch("https://edge.allegro.pl/analytics/reports/auctions/pricemonitor/pricejournal",{credentials:"include",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:128.0) Gecko/20100101 Firefox/128.0",Accept:"application/vnd.allegro.internal.v1+json","Accept-Language":"pl-PL","Content-Type":"application/vnd.allegro.internal.v1+json",Priority:"u=4",Pragma:"no-cache","Cache-Control":"no-cache","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site"},referrer:"https://allegro.pl/",body:JSON.stringify({includePhrases:t,includePhrasesMode:"OfferOrProduct",excludePhrasesMode:"OfferOrProduct",auctionType:1,sellerIds:[],skip:0,take:1e3,marketplaceIds:["allegro-pl"],startDate:o+"T00:00:00.000Z",endDate:r+"T00:00:00.000Z",startDateTime:o+"T00:00:00.000Z",endDateTime:r+"T23:59:59.999Z",reportCode:"TOP7D"}),method:"POST",mode:"cors"});if(!i.ok||!l.ok)throw new Error("Bd podczas pobierania danych z API Allegro.");{var d=await i.json(),c=await l.json();console.log("Odpowied藕 z API Allegro (sprzeda偶):",d),console.log("Odpowied藕 z API Allegro (monitorowanie cen):",c);var p=d.result.saleInfo.totalSale,u=d.result.saleInfo.todaySale,y=d.result.saleInfo.yesterdaySale,g=d.result.promotionCyclesHistory||[],f=d.result.overallItemInfo.startDate,h=d.result.startingQuantity,m=d.result.currentQuantity,b=d.result.seller.name,v=d.result.pmdProductIds,x=c.entries.filter((t=>t.id==e)).sort(((e,t)=>new Date(e.priceChange)-new Date(t.priceChange)));if(v.length>0)var k=v[0];else console.error("Tablica productid jest pusta");if(i.ok&&l.ok)var w=await fetch("https://edge.allegro.pl/analytics/reports/sale/byconversion",{credentials:"include",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:130.0) Gecko/20100101 Firefox/130.0",Accept:"application/vnd.allegro.internal.v1+json","Accept-Language":"pl-PL","Content-Type":"application/vnd.allegro.internal.v1+json","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site",Priority:"u=0",Pragma:"no-cache","Cache-Control":"no-cache"},referrer:"https://allegro.pl/",body:JSON.stringify({includePhrases:k,includePhrasesMode:"AnyId",excludePhrasesMode:"AnyId",sellerIds:[],includeCancelledAndReturned:!0,skip:0,take:1e3,marketplaceIds:["allegro-pl"],startDate:o+"T00:00:00.000Z",endDate:r+"T00:00:00.000Z",startDateTime:o+"T00:00:00.000Z",endDateTime:r+"T23:59:59.999Z",reportCode:"TOP7D"}),method:"POST",mode:"cors"});var S=await w.json(),z=S.result.entries.filter((t=>t.ids.includes(e))),$=S.result.entries.filter((t=>t.ids.includes(e))),C=$.length?$[0].pmdProductName:null;if(C){var D=await fetch("https://edge.allegro.pl/analytics/reports/sale/byconversion",{credentials:"include",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:130.0) Gecko/20100101 Firefox/130.0",Accept:"application/vnd.allegro.internal.v1+json","Accept-Language":"pl-PL","Content-Type":"application/vnd.allegro.internal.v1+json","Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site"},referrer:"https://allegro.pl/",body:JSON.stringify({includePhrases:C,includePhrasesMode:"Product",excludePhrasesMode:"Product",auctionType:1,sellerIds:[],skip:0,take:1e3,marketplaceIds:["allegro-pl"],startDate:o+"T00:00:00.000Z",endDate:r+"T00:00:00.000Z",startDateTime:o+"T00:00:00.000Z",endDateTime:r+"T23:59:59.999Z",reportCode:"TOP7D"}),method:"POST",mode:"cors"});if(D.ok){var P=await D.json();console.log("Odpowied藕 z API Allegro (nowy fetch):",P)}else console.error("Bd podczas fetch response4")}if(i.ok&&l.ok)var T=await fetch("https://edge.allegro.pl/analytics/reports/sale/bypromotion",{credentials:"include",headers:{Accept:"application/vnd.allegro.internal.v1+json","Accept-Language":"pl-PL","Content-Type":"application/vnd.allegro.internal.v1+json",Priority:"u=1, i","Sec-CH-UA":'"Google Chrome";v="129", "Not=A?Brand";v="8", "Chromium";v="129"',"Sec-CH-UA-Mobile":"?0","Sec-CH-UA-Platform":'"Windows"',"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site"},referrer:"https://allegro.pl/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({includePhrases:"2c3f3821-4408-42b8-9ce3-94103d84715e",includePhrasesMode:"AnyId",sellerIds:[],marketplaceIds:["allegro-pl"],startDate:o+"T00:00:00.000Z",endDate:r+"T00:00:00.000Z",startDateTime:o+"T02:00:00.000Z",endDateTime:r+"T23:53:00.000Z",reportCode:"LASTFULL7DAYS"}),method:"POST",mode:"cors"}),j=await T.json();var I=j.result.entries,F={},A={},E={};function se(e){switch(e){case 4:return"Bardzo wysoki";case 3:return"Wysoki";case 2:return"redni";case 1:return"Niski";default:return"Nieznany"}}function ie(e){return(100*e).toFixed(2)+"%"}I.forEach((e=>{68===e.options?(F.efficiencyClass=se(e.efficiencyClass),F.sale=ie(e.saleParticipation.sale),F.transactions=ie(e.saleParticipation.transactions)):64===e.options?(A.efficiencyClass=se(e.efficiencyClass),A.sale=ie(e.saleParticipation.sale),A.transactions=ie(e.saleParticipation.transactions)):4===e.options&&(E.efficiencyClass=se(e.efficiencyClass),E.sale=ie(e.saleParticipation.sale),E.transactions=ie(e.saleParticipation.transactions))})),console.log("Dane dla FreeDeliveryAndPromotion:",F),console.log("Dane dla FreeDelivery:",A),console.log("Dane dla Promotion:",E),console.log(F),console.log(A);var L=P.result.entries.filter((e=>e.pmdProductId===String(v))),O=L.reduce(((e,t)=>e+t.transactions),0),M=L.length>0?O/L.length:0,q=L.reduce(((e,t)=>e+t.conversion),0),W=L.length>0?q/L.length:0,B=L.reduce(((e,t)=>e+t.viewsCount),0),N=L.length>0?B/L.length:0,Z=L.reduce(((e,t)=>e+t.averageSoldItems),0),H=L.length>0?Z/L.length:0,U=L.filter((e=>e.transactions>0)),J=U.reduce(((e,t)=>e+t.transactions),0),G=U.length>0?J/U.length:0,Y=U.length>0?U.reduce(((e,t)=>e+t.conversion),0)/U.length:0,_=U.length>0?U.reduce(((e,t)=>e+t.viewsCount),0)/U.length:0,R=U.length>0?U.reduce(((e,t)=>e+t.averageSoldItems),0)/U.length:0,X=U.reduce(((e,t)=>e+t.viewsCount),0);const le=(e,t)=>0===t?0:((e-t)/t*100).toFixed(2),de=(e,t)=>(e-t).toFixed(2);function ce(e){return e>=0?"text-success":"text-danger"}const pe=(e,t)=>0===e?0:(t/e*100).toFixed(2),ue=document.createElement("style");ue.innerHTML="\n    .text-success {\n        color: green; /* Zielony kolor dla wartoci dodatnich */\n    }\n    .text-danger {\n        color: red; /* Czerwony kolor dla wartoci ujemnych */\n    }\n",document.head.appendChild(ue),s.innerHTML=`\n    <h2 style="margin-top: 0;">Statystyki dla oferty ${e}</h2>\n\n    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;" class="conversion">\n    <h3>Warto sprzeda偶y:</h3>\n    <p><strong>Sprzeda偶 w wybranym okresie:</strong> ${n(p)}</p>\n    <p><strong>Sprzeda偶 dzisiaj:</strong> ${n(u)}</p>\n    <p><strong>Sprzeda偶 wczoraj:</strong> ${n(y)}</p>\n    <br>\n    <h4 class="section-title">Dodatkowe informacje</h4>\n    <p><strong>Data rozpoczcia oferty:</strong> ${V=f,ee=new Date(V),te=String(ee.getDate()).padStart(2,"0"),ne=String(ee.getMonth()+1).padStart(2,"0"),ae=ee.getFullYear(),oe=String(ee.getHours()).padStart(2,"0"),re=String(ee.getMinutes()).padStart(2,"0"),`${te}-${ne}-${ae} | ${oe}:${re}`}</p>\n    <p><strong>Pocztkowa ilo:</strong> ${h}</p>\n    <p><strong>Obecna ilo:</strong> ${m}</p>\n    <p><strong>Sprzedawca:</strong> ${b}</p>\n    <a class="product-btn" href="https://allegro.pl/moje-allegro/sprzedaz/produkt/zglos-blad/${v}" target="_blank">Sprawd藕 / zgo produkt</a>\n</div>\n\n\n\n    </div>\n\n    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">\n    <h3>Cykle promowania oferty:</h3>\n    ${g.length>0?g.map((e=>{let t;switch(e.promotionOptions){case 4:t="Wyr贸偶nienie ";break;case 68:t="Wyr贸偶nienie + darmowa dostawa";break;default:t="Wyr贸偶nienie"}return`<p><strong>${t}</strong>: ${a(e.startDate)} do ${a(e.endDate)}</p>`})).join(""):"<p>Brak promowania w danym okresie</p>"}\n\n    <div class="prom-efficiency">\n    <h4 style="font-size:1.2em" class="section-title">Potencja wyr贸偶nie dla tego produktu</h3>\n    <table>\n        <thead>\n            <tr>\n                <th>Typ</th>\n                <th>Potencja</th>\n                <th>Udzia sprzeda偶y</th>\n                <th>Udzia transakcji</th>\n            </tr>\n        </thead>\n        <tbody>\n            ${Object.keys(F).length>0?`\n            <tr>\n                <td>Wyr贸偶nienie + Darmowa dostawa</td>\n                <td>${F.efficiencyClass}</td>\n                <td>${F.sale}</td>\n                <td>${F.transactions}</td>\n            </tr>\n            `:""}\n\n            ${Object.keys(A).length>0?`\n            <tr>\n                <td>Darmowa dostawa</td>\n                <td>${A.efficiencyClass}</td>\n                <td>${A.sale}</td>\n                <td>${A.transactions}</td>\n            </tr>\n            `:""}\n\n            ${Object.keys(E).length>0?`\n            <tr>\n                <td>Wyr贸偶nienie</td>\n                <td>${E.efficiencyClass}</td>\n                <td>${E.sale}</td>\n                <td>${E.transactions}</td>\n            </tr>\n            `:""}\n        </tbody>\n    </table>\n</div></div>\n\n\n\n<div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">\n    <h3>Monitorowanie cen:</h3>\n    ${x.length>0?x.map((e=>`<div style="margin-bottom: 10px;">\n            <p>${a(e.priceChange)}: Stara cena: <strong>${n(e.oldPrice)}</strong> | Nowa cena: <strong>${n(e.newPrice)}</strong></p>\n        </div>`)).join(""):"<p>Brak danych o cenach dla tego ID.</p>"}\n    <button id="chart-button" style="margin-top: 10px; padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">\n        Poka偶 wykres\n    </button>\n    <canvas id="price-chart" style="display: none; margin-top: 15px;"></canvas>\n</div>\n\n\n    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;" class="conversion">\n        <h3>Dane konwersji:</h3>\n        ${z.length?z.map(((e,t)=>`\n            <div style="margin-bottom: 10px;" class="original-conversion">\n    <p>Transakcje: <strong>${e.transactions}</strong>\n    <span style="display: none;" class="transaction-diff ${ce(pe(O,e.transactions))}">\n        (${pe(O,e.transactions)}% wszystkich transakcji)\n    </span>\n    <span style="display: none;" class="successful-transaction-diff ${ce(pe(J,e.transactions))}">\n        (${pe(J,e.transactions)}% wszystkich transakcji)\n    </span>\n    </p>\n    <p>rednia liczba sprzedanych sztuk: <strong>${e.averageSoldItems}</strong>\n        <span style="display: none;" class="average-sold-items-diff ${ce(le(e.averageSoldItems,H.toFixed(2)))}">\n            (${le(e.averageSoldItems,H.toFixed(2))}%)\n        </span>\n        <span style="display: none;" class="average-sold-items-successful-diff ${ce(le(e.averageSoldItems,R.toFixed(2)))}">\n                        (${le(e.averageSoldItems,R.toFixed(2))}%)\n                    </span>\n    </p>\n    <p>Liczba odson: <strong>${e.viewsCount}</strong>\n        <span style="display: none;" class="views-count-diff ${ce(le(e.viewsCount,N.toFixed(2)))}">\n            (${pe(B.toFixed(2),e.viewsCount)}% wszystkich odson)\n\n        </span>\n        <span style="display: none;" class="views-count-successful-diff ${ce(le(e.viewsCount,_.toFixed(2)))}">\n                        (${pe(X,e.viewsCount)}% wszystkich odson)\n                    </span>\n    </p>\n   <p>Wsp贸czynnik konwersji: <strong>${(100*e.conversion).toFixed(2)}%</strong>\n    <span style="display: none;" class="conversion-diff ${ce(de((100*e.conversion).toFixed(2),(100*W).toFixed(2)))}">\n        (${de((100*e.conversion).toFixed(2),(100*W).toFixed(2))} pkt %)\n    </span>\n    <span style="display: none;" class="successful-conversion-diff ${ce(de((100*e.conversion).toFixed(2),(100*Y).toFixed(2)))}">\n        (${de((100*e.conversion).toFixed(2),(100*Y).toFixed(2))} pkt %)\n    </span>\n</p>\n\n    <p>Dodania do ulubionych: <strong>${e.favoriteAdditionsCount}</strong></p>\n    <p>Dodania do koszyka: <strong>${e.cartAdditionsCount}</strong></p>\n\n\n            <button class="show-total-stats" data-index="${t}" style="margin-top: 10px;">Poka偶 cae statystyki</button>\n            <button class="show-successful-stats" data-index="${t}" style="margin-top: 10px;">Poka偶 udane transakcje</button>\n            <div id="more-info-${t}" style="display: none; margin-top: 10px;">\n                <div class="total-stats" style="display: none;">\n                 <h3>Statystyki ofert kt贸re miay wizyty</h3>\n                    <p>Wszystkich transakcji: <strong>${O}</strong></p>\n                                        <p>rednia liczba sprzedanych sztuk: <strong>${H.toFixed(2)}</strong></p>\n                    <p>rednia liczba transakcji: <strong>${M.toFixed(2)}</strong></p>\n                    <p>Liczba wywietle: <strong>${B}</strong></p>\n                    <p>rednia konwersja: <strong>${(100*W).toFixed(2)}%</strong></p>\n                    <p>rednia liczba odson: <strong>${N.toFixed(2)}</strong></p>\n\n\n                </div>\n                <div class="successful-stats" style="display: none;">\n                    <h3>Statystyki ofert kt贸re miay transakcje</h3>\n                    <p>rednia liczba sprzedanych sztuk: <strong>${R.toFixed(2)}</strong></p>\n                    <p>Wszystkich transakcji: <strong>${J}</strong></p>\n                    <p>rednia liczba transakcji: <strong>${G.toFixed(2)}</strong></p>\n                    <p>Liczba wywietle: <strong>${X}</strong></p>\n                    <p>rednia konwersja: <strong>${(100*Y).toFixed(2)}%</strong></p>\n                    <p>rednia liczba odson: <strong>${_.toFixed(2)}</strong></p>\n\n\n\n                </div>\n            </div>\n        `)).join(""):"<p>Brak danych konwersji.</p>"}\n        <button id="showEntriesBtn">Poka偶 statystyki ofert</>\n   \x3c!--     <button id="downloadExcel" style="margin-top: 20px;">Pobierz do Excela</button> --\x3e\n\n    </div>\n    </div>\n`,z.forEach(((e,t)=>{const n=document.querySelector(`.show-total-stats[data-index="${t}"]`),a=document.querySelector(`.show-successful-stats[data-index="${t}"]`);n.addEventListener("click",(function(){const e=document.getElementById(`more-info-${t}`);e.style.display="block",e.querySelector(".total-stats").style.display="block",n.style.backgroundColor="#ff5a00",a.style.backgroundColor="#007bff",e.querySelector(".successful-stats").style.display="none";const o=document.querySelector(".transaction-diff"),r=document.querySelector(".average-sold-items-diff"),s=document.querySelector(".views-count-diff"),i=document.querySelector(".conversion-diff");o.style.display="inline",r.style.display="inline",s.style.display="inline",i.style.display="inline";const l=document.querySelector(".successful-transaction-diff"),d=document.querySelector(".average-sold-items-successful-diff"),c=document.querySelector(".views-count-successful-diff"),p=document.querySelector(".successful-conversion-diff");l.style.display="none",d.style.display="none",c.style.display="none",p.style.display="none"})),a.addEventListener("click",(function(){const e=document.getElementById(`more-info-${t}`);e.style.display="block",e.querySelector(".total-stats").style.display="none",e.querySelector(".successful-stats").style.display="block",a.style.backgroundColor="#ff5a00",n.style.backgroundColor="#007bff";const o=document.querySelector(".transaction-diff"),r=document.querySelector(".average-sold-items-diff"),s=document.querySelector(".views-count-diff"),i=document.querySelector(".conversion-diff");o.style.display="none",r.style.display="none",s.style.display="none",i.style.display="none";const l=document.querySelector(".successful-transaction-diff"),d=document.querySelector(".average-sold-items-successful-diff"),c=document.querySelector(".views-count-successful-diff"),p=document.querySelector(".successful-conversion-diff");l.style.display="inline",d.style.display="inline",c.style.display="inline",p.style.display="inline"}))})),function(e){var t,n,o;if(console.log("Funkcja generatePriceChart zostaa wywoana."),console.log("Dane wejciowe:",e),e.length>0){t=e.map((e=>a(e.priceChange))),n=e.map((e=>e.newPrice));const r=Math.max(...n);o=Math.ceil(1.2*r)}else t=["No data"],n=[0,1],o=2;console.log("Etykiety:",t),console.log("Dane:",n),console.log("Maksymalna warto osi Y:",o);var r=document.getElementById("price-chart"),s=r.getContext("2d");r.width=400,r.height=200,new Chart(s,{type:"line",data:{labels:t,datasets:[{label:"Cena",data:n,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1,pointRadius:5,pointHoverRadius:8}]},options:{scales:{y:{beginAtZero:!0,max:o}},plugins:{tooltip:{padding:10,backgroundColor:"rgba(0, 0, 0, 0.7)",titleColor:"#fff",bodyColor:"#fff",titleFont:{size:16},bodyFont:{size:14},callbacks:{label:function(e){const t=e.raw,a=e.dataIndex;let o=0;if(a>0){const e=n[a-1];o=(t-e)/e*100}return[`Cena: ${t.toFixed(2)} z`,`Zmiana: ${o.toFixed(2)}%`]}}}}}})}(x),document.querySelector("#chart-button").addEventListener("click",(function(){var e=document.getElementById("price-chart");"none"===e.style.display?e.style.display="block":e.style.display="none"}));var K=document.querySelector("#showEntriesBtn");function ye(e){if(!e||0===e.length)return void alert("Brak danych do wywietlenia.");const t=`\n        <div id="modal-entries" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 10001;max-width:100%">\n            <div style="background: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 100%; overflow-y: auto; max-height: 80%; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">\n                <div style="display: flex; justify-content: space-between; align-items: center;">\n                    <h2 style="margin-top: 0; text-align: center; color: #333;">Wszystkie oferty</h2>\n                    <button id="closeEntriesModalBtn" style="padding: 10px 15px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">Zamknij</button>\n                </div>\n                <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-family: Arial, sans-serif;">\n                    <thead style="background-color: #007bff; color: white;">\n                        <tr>\n                            <th style="padding: 15px; text-align: center;">Oferty</th>\n                            <th style="padding: 15px; text-align: center;">Sprzedawca</th>\n                            <th style="padding: 15px; text-align: center;">Transakcji <span class="filter-icon" data-col="2"></span></th>\n                            <th style="padding: 15px; text-align: center;">r. sprzedanych sztuk <span class="filter-icon" data-col="3"></span></th>\n                            <th style="padding: 15px; text-align: center;">Odson <span class="filter-icon" data-col="4"></span></th>\n                            <th style="padding: 15px; text-align: center;">Konwersja <span class="filter-icon" data-col="5"></span></th>\n                            <th style="padding: 15px; text-align: center;">Cena <span class="filter-icon" data-col="6"></span></th>\n                            <th style="padding: 15px; text-align: center;">Dodanych do ulubionych <span class="filter-icon" data-col="7"></span></th>\n                            <th style="padding: 15px; text-align: center;">Dodanych do koszyka <span class="filter-icon" data-col="8"></span></th>\n                        </tr>\n                    </thead>\n                    <tbody id="entriesTableBody">\n                        ${e.map((e=>`\n        <tr>\n<td style="text-align: center;">\n    <a href="https://allegro.pl/oferta/${e.ids.join(", ")}" target="_blank">${e.ids.join(", ")}</a>\n</td>\n<td style="text-align: center;">\n    <a href="https://allegro.pl/uzytkownik/${e.seller.name}" target="_blank">${e.seller.name}</a>\n</td>\n\n            <td style="text-align: center;">${e.transactions}</td>\n            <td style="text-align: center;">${e.averageSoldItems}</td>\n            <td style="text-align: center;">${e.viewsCount}</td>\n            <td style="text-align: center;">${(100*e.conversion).toFixed(2)}%</td>\n            <td style="text-align: center;">${e.offerPrice.toFixed(2)} z</td>\n            <td style="text-align: center;">${e.favoriteAdditionsCount}</td>\n            <td style="text-align: center;">${e.cartAdditionsCount}</td>\n        </tr>\n    `)).join("")}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    `;document.body.insertAdjacentHTML("beforeend",t);const n=document.createElement("style");n.textContent="\n        table {\n            border-radius: 8px;\n            overflow: hidden;\n        }\n        tbody tr:nth-child(even) {\n            background-color: #f2f2f2; /* Jasnoszare to dla parzystych wierszy */\n        }\n        tbody tr:hover {\n            background-color: #e0e0e0; /* Jasnoszare to przy najechaniu */\n        }\n        th, td {\n            padding: 12px; /* Wiksze odstpy w kom贸rkach */\n            border-bottom: 1px solid #ddd; /* Dolna granica */\n            text-align: center; /* Wyrodkowanie tekstu */\n        }\n        th {\n            font-weight: bold; /* Pogrubione nag贸wki */\n        }\n        .filter-icon {\n            cursor: pointer;\n            font-size: 14px;\n            margin-left: 5px;\n            vertical-align: middle; /* Wyr贸wnanie strzaki w pionie */\n        }\n        .ascending::before {\n            content: ''; /* Strzaka w g贸r */\n        }\n        .descending::before {\n            content: ''; /* Strzaka w d贸 */\n        }\n    ",document.head.appendChild(n),document.getElementById("closeEntriesModalBtn").addEventListener("click",(()=>{const e=document.getElementById("modal-entries");e&&e.remove()}));const a=document.querySelectorAll(".filter-icon");a.forEach((t=>{t.addEventListener("click",(()=>{const n=parseInt(t.getAttribute("data-col")),o=t.classList.toggle("ascending");a.forEach((e=>{e!==t&&e.classList.remove("ascending","descending")})),o?t.classList.add("ascending"):t.classList.add("descending");const r=[...e].sort(((e,t)=>{let a,r;switch(n){case 2:a=e.transactions,r=t.transactions;break;case 3:a=e.averageSoldItems,r=t.averageSoldItems;break;case 4:a=e.viewsCount,r=t.viewsCount;break;case 5:a=e.conversion,r=t.conversion;break;case 6:a=e.offerPrice,r=t.offerPrice;break;case 7:a=e.favoriteAdditionsCount,r=t.favoriteAdditionsCount;break;case 8:a=e.cartAdditionsCount,r=t.cartAdditionsCount;break;default:return 0}return o?a-r:r-a})).map((e=>`\n                <tr>\n<td style="text-align: center;">\n    <a href="https://allegro.pl/oferta/${e.ids.join(", ")}" target="_blank">${e.ids.join(", ")}</a>\n</td>\n<td style="text-align: center;">\n    <a href="https://allegro.pl/uzytkownik/${e.seller.name}" target="_blank">${e.seller.name}</a>\n</td>\n\n                    <td style="text-align: center;">${e.transactions}</td>\n                    <td style="text-align: center;">${e.averageSoldItems}</td>\n                    <td style="text-align: center;">${e.viewsCount}</td>\n                    <td style="text-align: center;">${(100*e.conversion).toFixed(2)}%</td>\n                    <td style="text-align: center;">${e.offerPrice.toFixed(2)} z</td>\n                    <td style="text-align: center;">${e.favoriteAdditionsCount}</td>\n                    <td style="text-align: center;">${e.cartAdditionsCount}</td>\n                </tr>\n            `)).join("");document.getElementById("entriesTableBody").innerHTML=r}))}))}K&&K.addEventListener("click",(function(){ye(L)}))}}catch(ge){console.error("Wystpi bd podczas pobierania danych:",ge),s.innerHTML=`<p>Wystpi bd podczas pobierania danych: ${ge.message}</p>`}finally{var Q=document.querySelector("#loading-spinner");Q&&(Q.style.display="none")}var V,ee,te,ne,ae,oe,re}(e,t,o,r)}))}}(t,o)}))}}}))}function n(e){return new Intl.NumberFormat("pl-PL",{style:"currency",currency:"PLN"}).format(e)}function n(e){return new Intl.NumberFormat("pl-PL",{style:"currency",currency:"PLN"}).format(e)}function a(e){var t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}.${String(t.getMonth()+1).padStart(2,"0")}`}(e=document.createElement("style")).textContent='\n\n                .date-container {\n                    margin-bottom: 20px;\n                }\n                .date-container label {\n                    display: block;\n                    margin-bottom: 5px;\n                }\n                .date-container input {\n                    width: 95%;\n                    padding: 12px;\n                    border: 1px solid #ddd;\n                    border-radius: 5px;\n                    font-size: 16px;\n                }\n                #fetch-data-btn, #showEntriesBtn, .show-successful-stats, .show-total-stats, .product-btn {\n                    padding: 10px 15px;\n                    color: #fff;\n                    border: none;\n                    border-radius: 5px;\n                    cursor: pointer;\n                    text-decoration: none;\n                }\n\n                #fetch-data-btn{\n                margin-left:5px;\n                }\n\n\n\n    .date-button {\n            padding: 10px 15px;\n            color: #fff;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            margin-left: 5px;\n    }\n\n    .date-button:hover{\n    background-color: #0056b3;}\n\n    .DataButton-container{\n    padding-bottom: 10px;\n    }\n\n    .prom-efficiency {\n        margin: 40px 0px 20px 0px;\n        font-family: Arial, sans-serif;\n    }\n\n    .prom-efficiency table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-top: 20px;\n    }\n\n    .prom-efficiency thead {\n        background-color: #878c91;\n        color: white;\n    }\n\n    .prom-efficiency th,\n    .prom-efficiency td {\n        padding: 12px 15px;\n        text-align: left;\n        border: 1px solid #ddd;\n    }\n\n    .prom-efficiency tr:nth-child(even) {\n        background-color: #f2f2f2;\n    }\n\n    .prom-efficiency h3 {\n        margin-bottom: 10px;\n    }\n\n    .prom-efficiency td:first-child {\n        font-weight: bold;\n    }\n    #statystyka-content h3{\n        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);\n        color: white; /* Kolor tekstu */\n        padding: 10px; /* Wypenienie wewntrzne */\n        border-top-left-radius: 8px; /* Zaokrglenie lewego g贸rnego rogu */\n        border-top-right-radius: 8px; /* Zaokrglenie prawego g贸rnego rogu */\n        margin: -15px -15px 15px -15px; /* Negatywne marginesy, aby nag贸wek wkomponowa si w ramk */\n        font-size: 0.9em; /* Zwikszenie rozmiaru czcionki */\n        font-weight: bold; /* Ustawienie czcionki na pogrubion */\n        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Cie tekstu */\n        }\n\n        #statystyka-content button, .product-btn {\n            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);\n        }\n\n        #statystyka-content .date-button {\n            background-color: grey !important;\n            background: none;\n        }\n\n\n        .total-stats, .successful-stats{\n            margin-top:40px;\n        }\n\n        .section-title {\n            margin-top: 0;\n            font-size: 1.2em;\n            position: relative; /* Umo偶liwia pozycjonowanie pseudo-elementu */\n        }\n\n        .section-title::after {\n            content: ""; /* Pusty zawarto, tworzy lini */\n            display: block; /* Umo偶liwia ustawienie wysokoci */\n            width: 100%; /* Dugo linii */\n            height: 2px; /* Grubo linii */\n            background: #ccc; /* Kolor linii */\n            margin-top: 5px; /* Odstp od nag贸wka */\n        }\n\n        ',document.head.appendChild(e),window.addEventListener("load",(function(){t(),setInterval(t,1e3);const e=new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&t()}))}));e.observe(document.body,{childList:!0,subtree:!0});const n=document.querySelector("div[data-role='rightItems']");n&&e.observe(n,{childList:!0,subtree:!0})}))}();