// ==UserScript==
// @name         krastlva tools
// @namespace    https://golden-legion.eu/
// @description  Some random parser to help us ¯\_(ツ)_/¯
// @version      1.0.4
// @author       idtt
// @match        https://www.renaissancekingdoms.com/*
// @downloadURL https://update.greasyfork.org/scripts/382149/krastlva%20tools.user.js
// @updateURL https://update.greasyfork.org/scripts/382149/krastlva%20tools.meta.js
// ==/UserScript==
jQuery(document).ready(function(){var e=$("div.zonePubDroiteContenant");e.css("background","none"),e.html('<ul style="padding-top: 25px;"><li><button id="getCitizens">Списък граждани</button></li><li><button id="getMarket">Списък пазар</button></li><li><button id="getArmy">Списък армии/групи</button></li></ul>');var n=$(".nomJoueur a").text(),i=$(".horloge div").clone().children().remove().end().text().trim();function a(e,n){$.ajax({url:"https://api.golden-legion.eu/send/"+e,type:"POST",data:{data:n},success:function(e){$("#navigation_frame").contents().find("body").prepend('<div id="product_box" style="z-index: 3; position: relative;"><div class="pseudopopupWrapper"><div class="pseudopopup"><p>'+e+"</p></div></div></div>"),setTimeout(function(){$("#navigation_frame").contents().find("#product_box").remove()},2500)}})}$("#getCitizens").click(function(){var e=$("#navigation_frame").contents().find("#zoneTexte0 ul table tbody tr"),t=$("#navigation_frame").contents().find("#zoneTexte0 ul ul a"),o={c:{},n:{}},c={};e.each(function(e,n){var t={};$(n).find("td").each(function(e,n){switch(e){case 0:t.n=n.innerText;break;case 1:t.l=n.innerText;break;case 2:t.r=n.innerText.substring(0,n.innerText.length-2)}}),o.c[e]=t}),t.each(function(e,n){c[e]=n.innerText}),o.n=c,a("citizen",JSON.stringify({l:i,u:n,d:o}))}),$("#getMarket").click(function(){var e=$("#navigation_frame").contents().find("#zoneTexte0.texte.texteInventaire table tbody tr"),t={};e.each(function(e,n){var i={};if(!e)return 1;$(n).find("td").each(function(e,n){switch(e){case 1:i.i=n.innerText;break;case 2:i.p=n.innerText;break;case 3:i.q=n.innerText}}),t[e]=i}),a("market",JSON.stringify({l:i,u:n,d:t}))}),$("#getArmy").click(function(){var e=$("#navigation_frame").contents().find("#zoneTexte2.texte ul li"),o={},c={},r={};e.each(function(e,n){switch(n.innerText){case"Армии тук:":$(n).next().find("div.uneArmee").each(function(e,n){t={},$(n).find("li").each(function(e,n){switch(e){case 1:t.n=n.innerText;break;case 2:t.l=n.innerText}}),o[e]=t});break;case"Групи тук:":$(n).next().find("table tr.ligneGroupe1").each(function(e,n){t={},$(n).find("td a").each(function(e,n){t[e]=n.innerText}),c[e]=t});break;case"Контрол над областта":r=$(n).next().find("li")[0].innerText}}),a("army",JSON.stringify({l:i,u:n,d:{a:o,g:c,c:r}}))})});