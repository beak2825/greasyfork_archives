// ==UserScript==
// @namespace greasyfork
// @name B站番剧解锁
// @version 0.0.59
// @description 自用
// @include https://www.youtube.com/*
// @include https://www.bilibili.com/*
// @include https://space.bilibili.com/*
// @connect bilibili.com
// @connect hd2a.tk
// @connect 123.207.22.95
// @connect 127.0.0.1
// @connect localhost
// @connect 193.29.63.28
// @grant GM_info
// @grant GM_cookie
// @grant GM_deleteValue
// @grant GM_getValue
// @grant GM_setValue
// @grant GM_xmlhttpRequest
// @grant unsafeWindow
// @grant window.onurlchange
// @run-at document-start
// @downloadURL https://update.greasyfork.org/scripts/429716/B%E7%AB%99%E7%95%AA%E5%89%A7%E8%A7%A3%E9%94%81.user.js
// @updateURL https://update.greasyfork.org/scripts/429716/B%E7%AB%99%E7%95%AA%E5%89%A7%E8%A7%A3%E9%94%81.meta.js
// ==/UserScript==
void function(){var ipod={},u={aria2clear(){let e={id:u.uid(),method:"aria2.purgeDownloadResult"};GM_xmlhttpRequest({url:ipod.aria2.jsonrpc,method:"POST",responseType:"json",data:JSON.stringify(e)})},aria2config(){let e={id:u.uid(),method:"aria2.changeGlobalOption",params:[{"allow-overwrite":"false","auto-file-renaming":"false","max-concurrent-downloads":"1"}]};GM_xmlhttpRequest({url:ipod.aria2.jsonrpc,method:"POST",responseType:"json",data:JSON.stringify(e)})},aria2(e){let o=[],t={id:u.uid(),method:"system.multicall",params:[]};e.forEach(e=>{let n={},i={methodName:"aria2.addUri",params:[]};Object.keys(e).forEach(o=>{n[o]=e[o]}),n.split||(n.split=""+e.url.length),e.extype&&(n.out=t.id+e.extype),ipod.aria2&&ipod.aria2.token&&i.params.push("token:"+ipod.aria2.token),i.params.push(e.url),i.params.push(n),o.push(i)}),t.params.push(o),GM_xmlhttpRequest({url:ipod.aria2.jsonrpc,method:"POST",responseType:"json",data:JSON.stringify(t),onerror(){alert("Aria2\u8fde\u63a5\u5931\u8d25 \u8bf7\u68c0\u6d4bAria2\u662f\u5426\u8fd0\u884c\u548c\u586b\u5199\u7684jsonrpc\u662f\u5426\u6b63\u786e")}})},zdom(e){let o=window.event;return o.preventDefault(),o.stopPropagation(),e?o.target:o.currentTarget},zform(e,o){document.querySelectorAll(e).forEach(e=>{let t=e.getAttribute("name");if(o.hasOwnProperty(t))switch(e.getAttribute("type")){case"radio":o[t]==e.value&&(e.checked=!0);break;case"checkbox":o[t]&&(e.checked=!0);break;default:e.value=o[t]}})},load(e,o){let t,n=(e?e+".":"")+u.zhost();return(t=GM_getValue(n))?JSON.parse(t):o},save(e,o){let t=(e?e+".":"")+u.zhost();GM_setValue(t,JSON.stringify(o))},serialize(e,o){let t=[];switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return Object.keys(e).forEach(n=>{t.push(u.serialize(e[n],o?o+"["+n+"]":n))}),0==t.length?"":t.join("&");default:return o+"="+encodeURIComponent(""+e)}},strcut(e,o,t){let n,i,r="";return e&&e.includes(o)&&(n=e.indexOf(o)+o.length,-1==(i=e.indexOf(t,n))&&(i=e.length),r=e.substring(n,i)),r},str2obj(e){let o=null;return"[object String]"==Object.prototype.toString.call(e)&&e.length&&(o=e.includes('"')?JSON.parse(e):JSON.parse(e.replace(/'/g,'"'))),o},sprintf(e){let o,t,n="string"==typeof e?e:"";if(n.length)for(o=arguments.length-1;o>0;o--)t=RegExp("%"+o,"ig"),n=n.replace(t,arguments[o]);return n},download(e){if(e){let o=e.startsWith("magnet:")?{url:[]}:{url:[],"use-header":"true","min-split-size":"1M",split:"8"};Object.assign(o,ipod.aria2),e=e.startsWith("magnet:")?u.magnet(e):e.startsWith("http")?e:e.startsWith("//")?location.protocol+e:e.startsWith("/")?location.origin+e:location.origin+"/"+e,o.url.push(e),u.aria2([o])}},magnet(e){let o=e.indexOf("&");return-1==o?e:e.substring(0,o)},namefix(e){let o,t=['"',"*","//","\\",":","<",">","?","|"];for(o=0;t.length>o;o++)e=e.replace(t[o],"");return e},tpl(e,o){let t=e.replace(/\s+/g," ").replace(/\[/g,"\tjstpl").replace(/\]/g,"\t").split("\t");return(Array.isArray(o)?o:[o]).map((e,o)=>(e.idx=o+1,t.map(o=>{if(o.startsWith("jstpl")){let t=o.substring(5);o=e.hasOwnProperty(t)?e[t]:"["+t+"]"}return o}).join(""))).join("")},history(e){const o=history[e];return function(){let t=new Event(e);return t.arguments=arguments,window.dispatchEvent(t),o.apply(this,arguments)}},usp(e){let o={},t=new URLSearchParams(e.startsWith("?")?e.substring(1):e);for([k,v]of t.entries())o[k]=v;return o},zhost(){let e=location.host.split(".");while(e.length>2)e.shift();return e.join(".")},now:()=>Math.ceil(Date.now()/1e3),uid:()=>Date.now().toString(36).toUpperCase(),ajax:e=>new Promise((o,t)=>{"POST"==(e=Object.assign(e,{responseType:"json",onerror(e){t(e)},onload(e){o(e)}})).method&&(u.vobj(e.data)&&(e.data=u.serialize(e.data)),e.headers=Object.assign(e.headers,{"content-type":"application/x-www-form-urlencoded; charset=utf-8"})),GM_xmlhttpRequest(e)}),rand:e=>Math.floor(1e3*Math.random())%e,urlfix:e=>e.startsWith("http")?e:e.startsWith("//")?location.protocol+e:e.startsWith("/")?location.origin+e:location.origin+"/"+e,vobj:e=>"[object Object]"==Object.prototype.toString.call(e),vstr:e=>"[object String]"==Object.prototype.toString.call(e)};function e(e){let o,t=+e;return(o=isNaN(t)?"0":""+t).padStart(3,"0")}function o(e){let o,t,n=[],i=[],r=u.usp(location.search).v;e.streamingData.adaptiveFormats.forEach(e=>{e.hasOwnProperty("signatureCipher")&&(e.url=e.signatureCipher),e.url&&e.mimeType.includes("audio/mp4")&&!i.includes("audio")&&(i.push("audio"),n.push({name:r+".mp3",summary:"\u97f3\u9891",url:e.url})),e.url&&e.mimeType.includes("video/")&&!i.includes(o=/p$/.test(e.qualityLabel)?e.qualityLabel+e.fps:e.qualityLabel)&&(i.push(o),e.mimeType.includes("video/webm")&&Number.parseInt(e.height,10)>720&&n.push({name:r+".mp4",summary:o,url:e.url}),e.mimeType.includes("video/mp4")&&Number.parseInt(e.height,10)>360&&n.push({name:r+".mp4",summary:o,url:e.url}))}),n.length?(n.reverse(),(t=document.querySelector("#zydl"))?t.innerHTML=u.tpl(ipod.tpls.dlist,n):(document.querySelector("#meta-contents").insertAdjacentHTML("beforebegin",'<div id="zydl" class="btn-group outline"></div>'),(t=document.querySelector("#zydl")).innerHTML=u.tpl(ipod.tpls.dlist,n),t.setAttribute("style","font-size: 14px; margin-top: .5em"),t.addEventListener("click",async()=>{let e,o=u.zdom(1),t=o.getAttribute("data-url");t.startsWith("http")||(ipod.decsign||(ipod.decsign=await fetch(document.querySelector('script[src$="base.js"]').src).then(e=>e.text()).then(e=>{let o,t,n;return o=/=([a-zA-Z0-9\$]+?)\(decodeURIComponent/.exec(e),t=(o=RegExp(o[1]+"=function\\((.+?)\\){(.+?)}").exec(e))[1],o=/;(.+?)\..+?\(/.exec(n=o[2]),o=RegExp("var "+o[1]+"={[\\s\\S]+?};").exec(e),Function(t,(n=o[0]+"\n"+n).replace("var","let"))})),e=u.usp(t),t=u.sprintf("%1&%2=%3",e.url,e.sp,ipod.decsign.call(null,e.s))),ipod.aria2.mode?(e={url:t,name:o.getAttribute("data-name"),saveAs:!1},GM_download(e),GM_setClipboard(e.url,"text")):(e={"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36",url:[t],"all-proxy":ipod.aria2.proxy,dir:ipod.aria2.dir,out:o.getAttribute("data-name"),split:"16"},u.aria2([e]))})),t.insertAdjacentHTML("afterbegin",'<button name="zyset"><i class="ion-settings"></i> \u8bbe\u7f6e</button>'),t.querySelector("button[name=zyset]").addEventListener("click",()=>{u.zdom(),f()})):(t=document.querySelector("#zydl"))&&(t.innerHTML="")}function t(){let e=unsafeWindow.__INITIAL_STATE__;e&&e.hasOwnProperty("epInfo")&&e.hasOwnProperty("epList")?(e.epInfo.epStatus=2,e.epInfo.status=2,e.epInfo.rights.area_limit=0,e.epList.forEach(e=>{e.badge="",e.epStatus=2,e.status=2,e.rights.area_limit=0})):((e,o)=>{let t;Object.defineProperty(unsafeWindow,"__INITIAL_STATE__",{configurable:!0,enumerable:!0,get:()=>t,set(e){t=o.zwrite(e)}})})(0,{zwrite:o=>(o.hasOwnProperty("epInfo")&&o.hasOwnProperty("epList")&&(o.epInfo.epStatus=2,o.epInfo.status=2,o.epInfo.rights.area_limit=0,o.epList.forEach(e=>{e.badge="",e.epStatus=2,e.status=2,e.rights.area_limit=0}),e=o),o)})}function n(){let e=unsafeWindow.XMLHttpRequest,o=(o,t=0)=>{let n=new e;return n.open("GET",o,!1),n.withCredentials=t,n.send(),n.responseText};unsafeWindow.XMLHttpRequest=new Proxy(unsafeWindow.XMLHttpRequest,{construct(e){let t={};return new Proxy(new e,{get(e,n){if(t.hasOwnProperty(n))return t[n];let i=e[n];if("function"==typeof i){let r=i;i=function(){if("open"==n)t.method=arguments[0],t.url=arguments[1];else if("send"==n&&ipod.buinfo.level>0)if(t.url.includes("/info?mid=11783021&"))t.responseText='{"code":0,"message":"0","ttl":1,"data":{"mid":11783021,"name":"\u54d4\u54e9\u54d4\u54e9\u756a\u5267\u51fa\u5dee","sex":"\u4fdd\u5bc6","face":"http://i2.hdslb.com/bfs/face/9f10323503739e676857f06f5e4f5eb323e9f3f2.jpg","sign":"","rank":10000,"level":6,"jointime":0,"moral":0,"silence":0,"birthday":"","coins":0,"fans_badge":false,"fans_medal":{"show":false,"wear":false,"medal":null},"official":{"role":3,"title":"\u54d4\u54e9\u54d4\u54e9\u756a\u5267\u51fa\u5dee \u5b98\u65b9\u8d26\u53f7","desc":"","type":1},"vip":{"type":0,"status":0,"due_date":0,"vip_pay_type":0,"theme_type":0,"label":{"path":"","text":"","label_theme":"","text_color":"","bg_style":0,"bg_color":"","border_color":""},"avatar_subscript":0,"nickname_color":"","role":0,"avatar_subscript_url":""},"pendant":{"pid":0,"name":"","image":"","expire":0,"image_enhance":"","image_enhance_frame":""},"nameplate":{"nid":0,"name":"","image":"","image_small":"","level":"","condition":""},"user_honour_info":{"mid":0,"colour":null,"tags":null},"is_followed":false,"top_photo":"http://i1.hdslb.com/bfs/space/cb1c3ef50e22b6096fde67febe863494caefebad.png","theme":{},"sys_notice":{},"live_room":{"roomStatus":0}}}';else if(t.url.includes("/pgc/player/web/playurl?")){let e=t.url.startsWith("//")?location.protocol+t.url:t.url,n=JSON.parse(o(e,1));0==n.code&&0==n.result.is_preview?t.responseText=JSON.stringify(n).replace('"need_vip":true,',""):(e=u.sprintf("%1/bvlink.php%2&version=%3&sign=%4&%5&t=%6",ipod.host,e.substring(e.indexOf("?")),ipod.version,btoa(JSON.stringify(ipod.buinfo)),u.serialize(ipod.zone),Date.now()),n=o(e),0==JSON.parse(n).code?t.responseText=n:(e=u.sprintf("%1/bvlink.php%2&version=%3&sign=%4&%5&t=%6",ipod.host,e.substring(e.indexOf("?")),ipod.version,btoa(JSON.stringify(ipod.buinfo)),u.serialize(ipod.zone),Date.now()),n=o(e),0==JSON.parse(n).code&&(console.log("d = %o",JSON.parse(n)),t.responseText=n)))}return r.apply(e,arguments)}}return i},set:(e,o,t)=>(e[o]=t,!0)})}})}function i(){if(0==ipod.task){ipod.header=["User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36","Referer: "+location.href],ipod.bvinfo=unsafeWindow.__INITIAL_STATE__;let o=u.zdom();if(document.querySelector("#zydl > i").setAttribute("style","color: #fb7299"),ipod.list=[],ipod.task=setInterval(()=>{ipod.len==ipod.list.length&&(clearInterval(ipod.task),ipod.task=0,document.querySelector("#zydl > i").removeAttribute("style"),u.aria2(ipod.list))},1e3),ipod.bvinfo.videoData)if(ipod.vtype="video",ipod.bvid=ipod.bvinfo.videoData.bvid,ipod.count=ipod.len=ipod.bvinfo.videoData.pages.length,1==ipod.count)r(ipod.bvinfo.videoData.pages.map(e=>({bvid:ipod.bvid,cid:e.cid,out:ipod.bvid+".flv"})));else{let t='<div><div class="btn-group full"><button name="cancel"> \u53d6\u6d88 </button><button name="all"> \u5168\u9009 </button><button name="invert"> \u53cd\u9009 </button><button name="download"><i class="ion-download"></i> \u4e0b\u8f7d </button></div><ul>';(o=document.querySelector("#zylist"))?o.setAttribute("style","display: flex"):(o=document.createElement("div"),document.body.insertAdjacentElement("beforeend",o),o.setAttribute("class","tamper"),o.setAttribute("id","zylist")),ipod.bvinfo.videoData.pages.forEach(o=>{t+=u.sprintf('<li name="%1">%2</li>',o.cid,e(o.page)+" "+o.part)}),o.innerHTML=t+"</ul></div>",document.querySelector("#zylist > div > ul").addEventListener("click",()=>{let e=u.zdom(1);e.className="on"==e.className?"":"on"}),document.querySelector("#zylist > div > div.btn-group").addEventListener("click",()=>{switch(u.zdom(1).getAttribute("name")){case"cancel":clearInterval(ipod.task),ipod.task=0,document.querySelector("#zydl > i").removeAttribute("style"),document.querySelector("#zylist").setAttribute("style","display: none");break;case"all":document.querySelectorAll("#zylist > div > ul > li").forEach(e=>{e.className="on"});break;case"invert":document.querySelectorAll("#zylist > div > ul > li").forEach(e=>{e.className="on"==e.className?"":"on"});break;default:let o=[],t=[];document.querySelector("#zylist").setAttribute("style","display: none"),document.querySelectorAll("#zylist > div > ul > li").forEach(e=>{"on"==e.className&&o.push(Number.parseInt(e.getAttribute("name")))}),ipod.len=o.length,ipod.list=[],"video"==ipod.vtype&&(ipod.bvinfo.videoData.pages.forEach(n=>{o.includes(n.cid)&&t.push({bvid:ipod.bvid,cid:n.cid,out:(ipod.count>1?ipod.bvid+"/":"")+e(n.page)+".flv"})}),r(t)),"anime"==ipod.vtype&&(ipod.bvinfo.epList.forEach(e=>{o.includes(e.cid)&&t.push({bvid:e.bvid,cid:e.cid,out:(ipod.count>1?u.namefix(ipod.title.replace("/"," ").replace(/\s+/g," "))+"/":"")+e.title+" "+e.longTitle+".flv"})}),danime(t))}})}}}function r(e){e.forEach(e=>{GM_xmlhttpRequest({url:"http://123.207.22.95/baiduyun/bvlink.php?"+u.sprintf("bvid=%1&cid=%2&sign=%3",e.bvid,e.cid,btoa(JSON.stringify(ipod.buinfo))),method:"GET",responseType:"json",onload(o){let t=o.response;0==t.code?ipod.list.push({"use-header":"true",header:ipod.header,split:"16",dir:ipod.aria2.video,out:e.out,url:[t.data.durl[0].url]}):ipod.len--}})})}function a(){document.head.insertAdjacentHTML("beforeend",'<style type="text/css">@font-face{font-family:"Ionicons";src:url("https://cdn.bootcss.com/ionicons/4.5.6/fonts/ionicons.eot?v=4.5.5#iefix") format("embedded-opentype"),url("https://cdn.bootcss.com/ionicons/4.5.6/fonts/ionicons.woff2?v=4.5.5") format("woff2"),url("https://cdn.bootcss.com/ionicons/4.5.6/fonts/ionicons.woff?v=4.5.5") format("woff"),url("https://cdn.bootcss.com/ionicons/4.5.6/fonts/ionicons.ttf?v=4.5.5") format("truetype"),url("https://cdn.bootcss.com/ionicons/4.5.6/fonts/ionicons.svg?v=4.5.5#Ionicons") format("svg");font-weight:normal;font-style:normal}i[class|=ion]{display:inline-block;font-family:"Ionicons";font-size:120%;font-style:normal;font-variant:normal;font-weight:normal;line-height:1;text-rendering:auto;text-transform:none;vertical-align:text-bottom;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}.ion-android:before{content:"\\f225"}.ion-angular:before{content:"\\f227"}.ion-apple:before{content:"\\f229"}.ion-bitbucket:before{content:"\\f193"}.ion-bitcoin:before{content:"\\f22b"}.ion-buffer:before{content:"\\f22d"}.ion-chrome:before{content:"\\f22f"}.ion-closed-captioning:before{content:"\\f105"}.ion-codepen:before{content:"\\f230"}.ion-css3:before{content:"\\f231"}.ion-designernews:before{content:"\\f232"}.ion-dribbble:before{content:"\\f233"}.ion-dropbox:before{content:"\\f234"}.ion-euro:before{content:"\\f235"}.ion-facebook:before{content:"\\f236"}.ion-flickr:before{content:"\\f107"}.ion-foursquare:before{content:"\\f237"}.ion-freebsd-devil:before{content:"\\f238"}.ion-game-controller-a:before{content:"\\f13b"}.ion-game-controller-b:before{content:"\\f181"}.ion-github:before{content:"\\f239"}.ion-google:before{content:"\\f23a"}.ion-googleplus:before{content:"\\f23b"}.ion-hackernews:before{content:"\\f23c"}.ion-html5:before{content:"\\f23d"}.ion-instagram:before{content:"\\f23e"}.ion-ionic:before{content:"\\f150"}.ion-ionitron:before{content:"\\f151"}.ion-javascript:before{content:"\\f23f"}.ion-linkedin:before{content:"\\f240"}.ion-markdown:before{content:"\\f241"}.ion-model-s:before{content:"\\f153"}.ion-no-smoking:before{content:"\\f109"}.ion-nodejs:before{content:"\\f242"}.ion-npm:before{content:"\\f195"}.ion-octocat:before{content:"\\f243"}.ion-pinterest:before{content:"\\f244"}.ion-playstation:before{content:"\\f245"}.ion-polymer:before{content:"\\f15e"}.ion-python:before{content:"\\f246"}.ion-reddit:before{content:"\\f247"}.ion-rss:before{content:"\\f248"}.ion-sass:before{content:"\\f249"}.ion-skype:before{content:"\\f24a"}.ion-slack:before{content:"\\f10b"}.ion-snapchat:before{content:"\\f24b"}.ion-steam:before{content:"\\f24c"}.ion-tumblr:before{content:"\\f24d"}.ion-tux:before{content:"\\f2ae"}.ion-twitch:before{content:"\\f2af"}.ion-twitter:before{content:"\\f2b0"}.ion-usd:before{content:"\\f2b1"}.ion-vimeo:before{content:"\\f2c4"}.ion-vk:before{content:"\\f10d"}.ion-whatsapp:before{content:"\\f2c5"}.ion-windows:before{content:"\\f32f"}.ion-wordpress:before{content:"\\f330"}.ion-xbox:before{content:"\\f34c"}.ion-xing:before{content:"\\f10f"}.ion-yahoo:before{content:"\\f34d"}.ion-yen:before{content:"\\f34e"}.ion-youtube:before{content:"\\f34f"}.ion-add:before{content:"\\f273"}.ion-add-circle:before{content:"\\f272"}.ion-add-circle-outline:before{content:"\\f158"}.ion-airplane:before{content:"\\f15a"}.ion-alarm:before{content:"\\f274"}.ion-albums:before{content:"\\f275"}.ion-alert:before{content:"\\f276"}.ion-american-football:before{content:"\\f277"}.ion-analytics:before{content:"\\f278"}.ion-aperture:before{content:"\\f279"}.ion-apps:before{content:"\\f27a"}.ion-appstore:before{content:"\\f27b"}.ion-archive:before{content:"\\f27c"}.ion-arrow-back:before{content:"\\f27d"}.ion-arrow-down:before{content:"\\f27e"}.ion-arrow-dropdown:before{content:"\\f280"}.ion-arrow-dropdown-circle:before{content:"\\f27f"}.ion-arrow-dropleft:before{content:"\\f282"}.ion-arrow-dropleft-circle:before{content:"\\f281"}.ion-arrow-dropright:before{content:"\\f284"}.ion-arrow-dropright-circle:before{content:"\\f283"}.ion-arrow-dropup:before{content:"\\f286"}.ion-arrow-dropup-circle:before{content:"\\f285"}.ion-arrow-forward:before{content:"\\f287"}.ion-arrow-round-back:before{content:"\\f288"}.ion-arrow-round-down:before{content:"\\f289"}.ion-arrow-round-forward:before{content:"\\f28a"}.ion-arrow-round-up:before{content:"\\f28b"}.ion-arrow-up:before{content:"\\f28c"}.ion-at:before{content:"\\f28d"}.ion-attach:before{content:"\\f28e"}.ion-backspace:before{content:"\\f28f"}.ion-barcode:before{content:"\\f290"}.ion-baseball:before{content:"\\f291"}.ion-basket:before{content:"\\f292"}.ion-basketball:before{content:"\\f293"}.ion-battery-charging:before{content:"\\f294"}.ion-battery-dead:before{content:"\\f295"}.ion-battery-full:before{content:"\\f296"}.ion-beaker:before{content:"\\f297"}.ion-bed:before{content:"\\f160"}.ion-beer:before{content:"\\f298"}.ion-bicycle:before{content:"\\f299"}.ion-bluetooth:before{content:"\\f29a"}.ion-boat:before{content:"\\f29b"}.ion-body:before{content:"\\f29c"}.ion-bonfire:before{content:"\\f29d"}.ion-book:before{content:"\\f29e"}.ion-bookmark:before{content:"\\f29f"}.ion-bookmarks:before{content:"\\f2a0"}.ion-bowtie:before{content:"\\f2a1"}.ion-briefcase:before{content:"\\f2a2"}.ion-browsers:before{content:"\\f2a3"}.ion-brush:before{content:"\\f2a4"}.ion-bug:before{content:"\\f2a5"}.ion-build:before{content:"\\f2a6"}.ion-bulb:before{content:"\\f2a7"}.ion-bus:before{content:"\\f2a8"}.ion-business:before{content:"\\f1a4"}.ion-cafe:before{content:"\\f2a9"}.ion-calculator:before{content:"\\f2aa"}.ion-calendar:before{content:"\\f2ab"}.ion-call:before{content:"\\f2ac"}.ion-camera:before{content:"\\f2ad"}.ion-car:before{content:"\\f2b2"}.ion-card:before{content:"\\f2b3"}.ion-cart:before{content:"\\f2b4"}.ion-cash:before{content:"\\f2b5"}.ion-cellular:before{content:"\\f164"}.ion-chatboxes:before{content:"\\f2b6"}.ion-chatbubbles:before{content:"\\f2b7"}.ion-checkbox:before{content:"\\f2b9"}.ion-checkbox-outline:before{content:"\\f2b8"}.ion-checkmark:before{content:"\\f2bc"}.ion-checkmark-circle:before{content:"\\f2bb"}.ion-checkmark-circle-outline:before{content:"\\f2ba"}.ion-clipboard:before{content:"\\f2bd"}.ion-clock:before{content:"\\f2be"}.ion-close:before{content:"\\f2c0"}.ion-close-circle:before{content:"\\f2bf"}.ion-close-circle-outline:before{content:"\\f166"}.ion-cloud:before{content:"\\f2c9"}.ion-cloud-circle:before{content:"\\f2c2"}.ion-cloud-done:before{content:"\\f2c3"}.ion-cloud-download:before{content:"\\f2c6"}.ion-cloud-outline:before{content:"\\f2c7"}.ion-cloud-upload:before{content:"\\f2c8"}.ion-cloudy:before{content:"\\f2cb"}.ion-cloudy-night:before{content:"\\f2ca"}.ion-code:before{content:"\\f2ce"}.ion-code-download:before{content:"\\f2cc"}.ion-code-working:before{content:"\\f2cd"}.ion-cog:before{content:"\\f2cf"}.ion-color-fill:before{content:"\\f2d0"}.ion-color-filter:before{content:"\\f2d1"}.ion-color-palette:before{content:"\\f2d2"}.ion-color-wand:before{content:"\\f2d3"}.ion-compass:before{content:"\\f2d4"}.ion-construct:before{content:"\\f2d5"}.ion-contact:before{content:"\\f2d6"}.ion-contacts:before{content:"\\f2d7"}.ion-contract:before{content:"\\f2d8"}.ion-contrast:before{content:"\\f2d9"}.ion-copy:before{content:"\\f2da"}.ion-create:before{content:"\\f2db"}.ion-crop:before{content:"\\f2dc"}.ion-cube:before{content:"\\f2dd"}.ion-cut:before{content:"\\f2de"}.ion-desktop:before{content:"\\f2df"}.ion-disc:before{content:"\\f2e0"}.ion-document:before{content:"\\f2e1"}.ion-done-all:before{content:"\\f2e2"}.ion-download:before{content:"\\f2e3"}.ion-easel:before{content:"\\f2e4"}.ion-egg:before{content:"\\f2e5"}.ion-exit:before{content:"\\f2e6"}.ion-expand:before{content:"\\f2e7"}.ion-eye:before{content:"\\f2e9"}.ion-eye-off:before{content:"\\f2e8"}.ion-fastforward:before{content:"\\f2ea"}.ion-female:before{content:"\\f2eb"}.ion-filing:before{content:"\\f2ec"}.ion-film:before{content:"\\f2ed"}.ion-finger-print:before{content:"\\f2ee"}.ion-fitness:before{content:"\\f1ac"}.ion-flag:before{content:"\\f2ef"}.ion-flame:before{content:"\\f2f0"}.ion-flash:before{content:"\\f17e"}.ion-flash-off:before{content:"\\f12f"}.ion-flashlight:before{content:"\\f16b"}.ion-flask:before{content:"\\f2f2"}.ion-flower:before{content:"\\f2f3"}.ion-folder:before{content:"\\f2f5"}.ion-folder-open:before{content:"\\f2f4"}.ion-football:before{content:"\\f2f6"}.ion-funnel:before{content:"\\f2f7"}.ion-gift:before{content:"\\f199"}.ion-git-branch:before{content:"\\f2fa"}.ion-git-commit:before{content:"\\f2fb"}.ion-git-compare:before{content:"\\f2fc"}.ion-git-merge:before{content:"\\f2fd"}.ion-git-network:before{content:"\\f2fe"}.ion-git-pull-request:before{content:"\\f2ff"}.ion-glasses:before{content:"\\f300"}.ion-globe:before{content:"\\f301"}.ion-grid:before{content:"\\f302"}.ion-hammer:before{content:"\\f303"}.ion-hand:before{content:"\\f304"}.ion-happy:before{content:"\\f305"}.ion-headset:before{content:"\\f306"}.ion-heart:before{content:"\\f308"}.ion-heart-dislike:before{content:"\\f167"}.ion-heart-empty:before{content:"\\f1a1"}.ion-heart-half:before{content:"\\f1a2"}.ion-help:before{content:"\\f30b"}.ion-help-buoy:before{content:"\\f309"}.ion-help-circle:before{content:"\\f30a"}.ion-help-circle-outline:before{content:"\\f16d"}.ion-home:before{content:"\\f30c"}.ion-hourglass:before{content:"\\f111"}.ion-ice-cream:before{content:"\\f30d"}.ion-image:before{content:"\\f30e"}.ion-images:before{content:"\\f30f"}.ion-infinite:before{content:"\\f310"}.ion-information:before{content:"\\f312"}.ion-information-circle:before{content:"\\f311"}.ion-information-circle-outline:before{content:"\\f16f"}.ion-jet:before{content:"\\f315"}.ion-journal:before{content:"\\f18d"}.ion-key:before{content:"\\f316"}.ion-keypad:before{content:"\\f317"}.ion-laptop:before{content:"\\f318"}.ion-leaf:before{content:"\\f319"}.ion-link:before{content:"\\f22e"}.ion-list:before{content:"\\f31b"}.ion-list-box:before{content:"\\f31a"}.ion-locate:before{content:"\\f31c"}.ion-lock:before{content:"\\f31d"}.ion-log-in:before{content:"\\f31e"}.ion-log-out:before{content:"\\f31f"}.ion-magnet:before{content:"\\f320"}.ion-mail:before{content:"\\f322"}.ion-mail-open:before{content:"\\f321"}.ion-mail-unread:before{content:"\\f172"}.ion-male:before{content:"\\f323"}.ion-man:before{content:"\\f324"}.ion-map:before{content:"\\f325"}.ion-medal:before{content:"\\f326"}.ion-medical:before{content:"\\f327"}.ion-medkit:before{content:"\\f328"}.ion-megaphone:before{content:"\\f329"}.ion-menu:before{content:"\\f32a"}.ion-mic:before{content:"\\f32c"}.ion-mic-off:before{content:"\\f32b"}.ion-microphone:before{content:"\\f32d"}.ion-moon:before{content:"\\f32e"}.ion-more:before{content:"\\f1c9"}.ion-move:before{content:"\\f331"}.ion-musical-note:before{content:"\\f332"}.ion-musical-notes:before{content:"\\f333"}.ion-navigate:before{content:"\\f334"}.ion-notifications:before{content:"\\f338"}.ion-notifications-off:before{content:"\\f336"}.ion-notifications-outline:before{content:"\\f337"}.ion-nuclear:before{content:"\\f339"}.ion-nutrition:before{content:"\\f33a"}.ion-open:before{content:"\\f33b"}.ion-options:before{content:"\\f33c"}.ion-outlet:before{content:"\\f33d"}.ion-paper:before{content:"\\f33f"}.ion-paper-plane:before{content:"\\f33e"}.ion-partly-sunny:before{content:"\\f340"}.ion-pause:before{content:"\\f341"}.ion-paw:before{content:"\\f342"}.ion-people:before{content:"\\f343"}.ion-person:before{content:"\\f345"}.ion-person-add:before{content:"\\f344"}.ion-phone-landscape:before{content:"\\f346"}.ion-phone-portrait:before{content:"\\f347"}.ion-photos:before{content:"\\f348"}.ion-pie:before{content:"\\f349"}.ion-pin:before{content:"\\f34a"}.ion-pint:before{content:"\\f34b"}.ion-pizza:before{content:"\\f354"}.ion-planet:before{content:"\\f356"}.ion-play:before{content:"\\f357"}.ion-play-circle:before{content:"\\f174"}.ion-podium:before{content:"\\f358"}.ion-power:before{content:"\\f359"}.ion-pricetag:before{content:"\\f35a"}.ion-pricetags:before{content:"\\f35b"}.ion-print:before{content:"\\f35c"}.ion-pulse:before{content:"\\f35d"}.ion-qr-scanner:before{content:"\\f35e"}.ion-quote:before{content:"\\f35f"}.ion-radio:before{content:"\\f362"}.ion-radio-button-off:before{content:"\\f360"}.ion-radio-button-on:before{content:"\\f361"}.ion-rainy:before{content:"\\f363"}.ion-recording:before{content:"\\f364"}.ion-redo:before{content:"\\f365"}.ion-refresh:before{content:"\\f366"}.ion-refresh-circle:before{content:"\\f228"}.ion-remove:before{content:"\\f368"}.ion-remove-circle:before{content:"\\f367"}.ion-remove-circle-outline:before{content:"\\f176"}.ion-reorder:before{content:"\\f369"}.ion-repeat:before{content:"\\f36a"}.ion-resize:before{content:"\\f36b"}.ion-restaurant:before{content:"\\f36c"}.ion-return-left:before{content:"\\f36d"}.ion-return-right:before{content:"\\f36e"}.ion-reverse-camera:before{content:"\\f36f"}.ion-rewind:before{content:"\\f370"}.ion-ribbon:before{content:"\\f371"}.ion-rocket:before{content:"\\f179"}.ion-rose:before{content:"\\f372"}.ion-sad:before{content:"\\f373"}.ion-save:before{content:"\\f1a9"}.ion-school:before{content:"\\f374"}.ion-search:before{content:"\\f375"}.ion-send:before{content:"\\f376"}.ion-settings:before{content:"\\f377"}.ion-share:before{content:"\\f379"}.ion-share-alt:before{content:"\\f378"}.ion-shirt:before{content:"\\f37a"}.ion-shuffle:before{content:"\\f37b"}.ion-skip-backward:before{content:"\\f37c"}.ion-skip-forward:before{content:"\\f37d"}.ion-snow:before{content:"\\f37e"}.ion-speedometer:before{content:"\\f37f"}.ion-square:before{content:"\\f381"}.ion-square-outline:before{content:"\\f380"}.ion-star:before{content:"\\f384"}.ion-star-half:before{content:"\\f382"}.ion-star-outline:before{content:"\\f383"}.ion-stats:before{content:"\\f385"}.ion-stopwatch:before{content:"\\f386"}.ion-subway:before{content:"\\f387"}.ion-sunny:before{content:"\\f388"}.ion-swap:before{content:"\\f389"}.ion-switch:before{content:"\\f38a"}.ion-sync:before{content:"\\f38b"}.ion-tablet-landscape:before{content:"\\f38c"}.ion-tablet-portrait:before{content:"\\f38d"}.ion-tennisball:before{content:"\\f38e"}.ion-text:before{content:"\\f38f"}.ion-thermometer:before{content:"\\f390"}.ion-thumbs-down:before{content:"\\f391"}.ion-thumbs-up:before{content:"\\f392"}.ion-thunderstorm:before{content:"\\f393"}.ion-time:before{content:"\\f394"}.ion-timer:before{content:"\\f395"}.ion-today:before{content:"\\f17d"}.ion-train:before{content:"\\f396"}.ion-transgender:before{content:"\\f397"}.ion-trash:before{content:"\\f398"}.ion-trending-down:before{content:"\\f399"}.ion-trending-up:before{content:"\\f39a"}.ion-trophy:before{content:"\\f39b"}.ion-tv:before{content:"\\f17f"}.ion-umbrella:before{content:"\\f39c"}.ion-undo:before{content:"\\f39d"}.ion-unlock:before{content:"\\f39e"}.ion-videocam:before{content:"\\f39f"}.ion-volume-high:before{content:"\\f123"}.ion-volume-low:before{content:"\\f131"}.ion-volume-mute:before{content:"\\f3a1"}.ion-volume-off:before{content:"\\f3a2"}.ion-walk:before{content:"\\f3a4"}.ion-wallet:before{content:"\\f18f"}.ion-warning:before{content:"\\f3a5"}.ion-watch:before{content:"\\f3a6"}.ion-water:before{content:"\\f3a7"}.ion-wifi:before{content:"\\f3a8"}.ion-wine:before{content:"\\f3a9"}.ion-woman:before{content:"\\f3aa"}div.tamper{align-items:center;background-color:rgba(0,0,0,0.85);box-sizing:border-box;cursor:default;display:flex;font-size:14px !important;height:100%;justify-content:center;left:0;position:fixed;top:0;text-align:left;width:100%;z-index:900000}div.tamper>div{background-color:white;box-sizing:border-box;padding:1em;width:360px}div.tamper>div.doc{padding-left:1.1em;width:720px}div.tamper a,div.tamper h1,div.tamper h2,div.tamper h3,div.tamper h4,div.tamper h5,div.tamper h6{color:#333 !important}div.tamper h1{font-size:1.8rem;font-weight:400;margin:10px 0 20px 0;text-align:center}div.tamper form{display:block}div.tamper form>div{padding:.5em 0}div.tamper form>div>div{margin:.5em 0}div.tamper form>div>div:last-child{margin-bottom:0}div.tamper form label{color:#000;font-weight:normal;margin:0;vertical-align:middle}div.tamper form label:first-child{display:block;margin-bottom:.5em}div.tamper form label:first-child:before{content:"\\00bb";margin:0 .25em}div.tamper form label:not(:first-child){display:inline}div.tamper form input{box-shadow:none;color:#000}div.tamper form input[type=text]{background-color:#fff;border:1px solid #ddd;box-sizing:border-box;display:block;font-size:1em;padding:.5em;width:100%}div.tamper form input[type=text]:focus{border:1px solid #59c1f0}div.tamper form input[type=password]{background-color:#fff;border:1px solid #ddd;box-sizing:border-box;display:block;font-size:1em;padding:.5em;width:100%}div.tamper form input[type=password]:focus{border:1px solid #59c1f0}div.tamper form input[type=radio],div.tamper form input[type=checkbox]{display:inline-block !important;height:1em;margin-right:.25em;vertical-align:text-bottom;width:1em}div.tamper form input[type=checkbox]{-webkit-appearance:checkbox !important}div.tamper form input[type=radio]{-webkit-appearance:radio !important}div.tamper ul{margin:.5em;padding:0;list-style-type:disc;list-style-position:inside;max-height:520px;overflow-y:auto;scrollbar-width:thin}div.tamper ul>li{box-sizing:content-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:.25em 0;cursor:default}div.tamper ul>li.on{color:#f45a8d}div.summary{color:#666}div.btn-group{box-sizing:border-box;display:inline-flex}div.btn-group.full{display:flex}div.btn-group.outline>button{background-color:#fff;border:1px solid #ccc;color:#000}div.btn-group.outline>button:hover{color:#ffffff;background-color:#000;border-color:#000}div.btn-group.outline>button:not(:first-child){border-left:none}div.btn-group>button{background-color:#666;border-radius:0;border:none;color:#fff;display:inline-block;flex:1 1 auto;margin:0;outline:none;padding:.5em 1.25em;position:relative;font-size:inherit}div.btn-group>button:hover{background-color:#000}div.btn-group>button:first-child{border-bottom-left-radius:.25rem;border-top-left-radius:.25rem}div.btn-group>button:last-child{border-bottom-right-radius:.25rem;border-top-right-radius:.25rem}.mt1{margin-top:10px}@keyframes spinner{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.spinner{animation-name:spinner;animation-duration:2400ms;animation-timing-function:linear;animation-iteration-count:infinite}body{cursor:default}</tyle>')}function f(){if(document.querySelector("#zyset"))ipod.aria2&&u.zform("#zyset input",ipod.aria2),document.querySelector("#zyset").setAttribute("style","display: flex");else{let e;switch(u.zhost()){case"bilibili.com":e='<div class="tamper" id="zyset"><div><form><div><label>\u8bbe\u7f6e aria2 jsonrpc</label><input name="jsonrpc" type="text"></div><div><label>\u8bbe\u7f6e aria2 \u8bbf\u95ee\u53e3\u4ee4</label><input name="token" type="password" placeholder="\u6ca1\u6709\u53e3\u4ee4\u5219\u4e0d\u8981\u586b\u5199"></div><div><label>\u8bbe\u7f6e\u89c6\u9891\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84</label><input name="video" type="text"></div><div><label>\u8bbe\u7f6e\u756a\u5267\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84</label><input name="anime" type="text"></div><div class="btn-group"><button type="submit"><i class="ion-checkmark"></i> \u786e\u5b9a </button><button type="button"><i class="ion-close"></i> \u53d6\u6d88 </button></div></form></div></div>';break;case"youtube.com":e='<div class="tamper" id="zyset"><div><form><div><input name="mode" type="checkbox" value="1"><label>\u4f7f\u7528\u6d4f\u89c8\u5668\u76f4\u63a5\u4e0b\u8f7d\u800c\u975eAria2</label><div class="summary">\u4e0d\u77e5\u9053\u5982\u4f55\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\u8bf7\u52fe\u9009\u6d4f\u89c8\u5668\u4e0b\u8f7d</div></div><div><label>\u8bbe\u7f6e aria2 jsonrpc</label><input name="jsonrpc" type="text"></div><div><label>\u8bbe\u7f6e aria2 \u8bbf\u95ee\u53e3\u4ee4</label><input name="token" type="password" placeholder="\u6ca1\u6709\u53e3\u4ee4\u5219\u4e0d\u8981\u586b\u5199"></div><div><label>\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668</label><input name="proxy" type="text"></div><div><label>\u8bbe\u7f6e\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84</label><input name="dir" type="text"></div><div class="btn-group"><button type="submit"><i class="ion-checkmark"></i> \u786e\u5b9a</button><button type="button"><i class="ion-close"></i> \u53d6\u6d88</button></div></form></div></div>';break;default:e='<div class="tamper" id="zyset"><div><form><div><label>\u8bbe\u7f6e aria2 jsonrpc</label><input name="jsonrpc" type="text"></div><div><label>\u8bbe\u7f6e aria2 \u8bbf\u95ee\u53e3\u4ee4</label><input name="token" type="password" placeholder="\u6ca1\u6709\u53e3\u4ee4\u5219\u4e0d\u8981\u586b\u5199"></div><div><label>\u8bbe\u7f6e\u4e0b\u8f7d\u4fdd\u5b58\u8def\u5f84</label><input name="dir" type="text"></div><div class="btn-group"><button type="submit"><i class="ion-checkmark"></i> \u786e\u5b9a</button><button type="button"><i class="ion-close"></i> \u53d6\u6d88</button></div></form></div></div>'}document.body.insertAdjacentHTML("beforeend",e),ipod.aria2&&u.zform("#zyset input",ipod.aria2),document.querySelector("#zyset button[type=button]").addEventListener("click",()=>{u.zdom(),document.querySelector("#zyset").setAttribute("style","display: none")}),document.querySelector("#zyset form").addEventListener("submit",()=>{let e,o={},t=u.zdom(),n=new FormData(t);for(e of n.entries())if(/^\d+/.test(e[1])){let t=Number.parseInt(e[1],10);o[e[0]]=e[1]==""+t?t:e[1]}else o[e[0]]=e[1];ipod.aria2=Object.assign({},ipod.defaults,o),u.save("aria2",ipod.aria2),document.querySelector("#zyset").setAttribute("style","display: none")})}}if(ipod.version=GM_info.script.version,location.hostname.includes("bilibili.com")){if(ipod.defaults={token:"",jsonrpc:"http://127.0.0.1:16800/jsonrpc",video:"D:/A2DH",anime:"D:/A2DH"},ipod.aria2=u.load("aria2"),ipod.host="https://www.hd2a.tk",ipod.now=u.now(),ipod.latest=u.load("latest",0),ipod.buinfo=u.load("buinfo",null),ipod.zone=u.load("zone",null),ipod.uid=document.cookie.includes("DedeUserID")?u.strcut(document.cookie,"DedeUserID=",";"):0,ipod.uid&&(void 0==ipod.ua||ipod.now>ipod.latest||ipod.uid!=ipod.buinfo.uid)&&(ipod.latest=ipod.now+1e3,u.save("latest",ipod.latest),GM_cookie.list({},e=>{let o=["_dfcaptcha","_offset","balh_","bg_view"];ipod.cookie=e.filter(e=>!o.some(o=>e.name.includes(o))||(GM_cookie.delete(e),!1)).map(e=>e.name+"="+e.value).join(";")}),fetch("https://api.bilibili.com/x/web-interface/nav",{method:"GET",mode:"cors",credentials:"include"}).then(e=>e.json()).then(e=>{ipod.buinfo=0==e.code?{ua:navigator.userAgent,uid:e.data.mid,level:e.data.level_info.current_level,vip:e.data.vipStatus,csrf:u.strcut(document.cookie,"bili_jct=",";"),cookie:ipod.cookie}:null,u.save("buinfo",ipod.buinfo)}),fetch("https://api.bilibili.com/x/web-interface/zone",{method:"GET",mode:"cors",credentials:"omit"}).then(e=>e.json()).then(e=>{0==e.code&&(ipod.zone=e.data,u.save("zone",ipod.zone))}),location.pathname.startsWith("/bangumi")&&setTimeout(()=>{GM_xmlhttpRequest({url:ipod.host+"/vlist.json",method:"GET",responseType:"json",onload(e){let o=e.response;Array.isArray(o)&&o.length&&o.forEach(e=>{fetch("https://api.bilibili.com/x/web-interface/archive/stat?bvid="+e.bvid,{method:"GET",mode:"cors",credentials:"include"}).then(e=>e.json()).then(o=>{0==o.code&&(e.like=o.data.like-e.like1,e.view=o.data.view-e.view1,e.times>e.like&&(0==e.times2||Math.ceil(100*e.times/e.times2)>=Math.round(100*e.like/e.view))&&fetch("https://api.bilibili.com/x/web-interface/archive/relation?aid="+e.aid+"&bvid="+e.bvid,{method:"GET",mode:"cors",credentials:"include"}).then(e=>e.json()).then(o=>{0==o.code&&0==o.data.like&&fetch("https://api.bilibili.com/x/web-interface/archive/like",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",mode:"cors",credentials:"include",body:u.serialize({aid:e.aid,like:1,csrf:ipod.buinfo.csrf})})}))})})}})},9e4)),location.pathname.startsWith("/video")){let e=location.pathname.substring(7,19);fetch("https://api.bilibili.com/x/web-interface/view?bvid="+e).then(e=>e.json()).then(o=>{switch(o.code){case-404:GM_xmlhttpRequest({url:u.sprintf("%1/ajax.php?act=bangumi&version=%2&bvid=%3",ipod.host,ipod.version,e),method:"GET",responseType:"json",onload(e){let o=""+e.response.message;o.startsWith("http")||(o="https://www.bilibili.com/bangumi/play/ep"+o),location.href=o}});break;default:ipod.task=setInterval(()=>{document.querySelector("#app").hasAttribute("data-server-rendered")||(clearInterval(ipod.task),ipod.task=0,ipod.buinfo&&setTimeout(()=>{document.querySelector("#zydl")||(document.querySelector("#arc_toolbar_report").insertAdjacentHTML("beforeend",'<div name="zyset" class="appeal-text">A2DH</div>'),document.querySelector("#arc_toolbar_report > div.ops").insertAdjacentHTML("afterbegin",'<span id="zydl" title="\u4e0b\u8f7d"><i class="van-icon-download"></i>\u4e0b\u8f7d</span>'),document.querySelector("#zydl").addEventListener("click",i),document.querySelector("div[name=zyset]").addEventListener("click",f))},3e3))},3e3)}})}(location.pathname.startsWith("/bangumi")||location.pathname.startsWith("/watchroom"))&&(n(),t(),history.pushState=u.history("pushState"),window.addEventListener("pushState",t),ipod.task=setInterval(()=>{let e=document.querySelector("#app");e&&!e.hasAttribute("data-server-rendered")&&(clearInterval(ipod.task),ipod.task=0,ipod.bvchk=1,document.querySelector("#bvchk")||setTimeout(()=>{let e=ipod.buinfo.ua.includes("Firefox")?"1.5em":"2em";document.querySelector("#toolbar_module").insertAdjacentHTML("afterbegin",'<div style="float:right;margin-right:1em"><i id="bvchk" class="iconfont icon-bili" style="font-size:'+e+'"></i></div>'),document.querySelector("#bvchk").addEventListener("click",()=>{let e=unsafeWindow.__INITIAL_STATE__.epInfo.cid;ipod.bvchk&&e&&(ipod.bvchk=0,GM_xmlhttpRequest({url:u.sprintf("%1/ajax.php?act=bvfix&version=%2&uid=%3&cid=%4",ipod.host,ipod.version,ipod.uid,e),method:"GET",responseType:"json",onerror(){alert("\u8fde\u63a5\u89e3\u6790\u670d\u52a1\u5668\u5931\u8d25")},onload(e){let o=e.response;switch(o.code){case 9:alert(o.message);break;case 0:u.save("latest",0),ipod.buinfo?(GM_cookie.list({},e=>{let o=["DedeUserID","DedeUserID__ckMd5","PVID","SESSDATA","_uuid","bili_jct","blackside_state","buvid3","buvid_fp","buvid_fp_plain","fingerprint","rpdid","sid"];e.forEach(e=>{o.includes(e.name)||GM_cookie.delete(e)})}),0==ipod.buinfo.level&&alert("0\u7ea7\u53f7\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528")):alert("1. \u8bf7\u767b\u5f55\u54d4\u54e9\u54d4\u54e9\n2. \u8bf7\u66f4\u6362\u811a\u672c\u7ba1\u7406\u5668\u4e3a\u7ea2\u7334"),setTimeout(()=>{location.reload()},1e3);break;default:location.href=o.message}}}))})},3e3))},3e3)),location.pathname.startsWith("/11783021")&&n(),document.onreadystatechange=(()=>{"interactive"==document.readyState&&(a(),null==ipod.aria2&&(ipod.aria2=Object.assign({},ipod.defaults),f()))})}location.hostname.includes("youtube.com")&&(unsafeWindow.fetch=new Proxy(fetch,{apply:(e,t,n)=>e.apply(t,n).then(e=>{let t=n[0];return t instanceof Request&&t.url.includes("player")&&e.clone().json().then(o),e})}),ipod.tpls={dlist:'<button data-name="[name]" data-url="[url]">[summary]</button>'},ipod.defaults={dir:"D:/A2DH",proxy:"http://127.0.0.1:1080",jsonrpc:"http://127.0.0.1:16800/jsonrpc"},ipod.aria2=u.load("aria2"),null==ipod.aria2&&(ipod.aria2=Object.assign({},ipod.defaults)),document.onreadystatechange=(()=>{if(console.log("readyState = %s",document.readyState),"interactive"==document.readyState&&a(),"complete"==document.readyState&&location.pathname.startsWith("/watch"))try{let e=ytplayer.config.args.raw_player_response;e&&o(e)}catch(e){}}))}();
