// ==UserScript==
// @name         Kralstva Tools
// @namespace    Kralstva Tools
// @description  Some parser
// @version      1.0.1
// @author       idtt
// @match        https://www.kralstva.com/*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/379876/Kralstva%20Tools.user.js
// @updateURL https://update.greasyfork.org/scripts/379876/Kralstva%20Tools.meta.js
// ==/UserScript==
jQuery(document).ready(function(){var n=$("div.zonePubDroiteContenant");function e(t,n){$.ajax({url:"https://api.golden-legion.eu/send/"+t,type:"POST",data:{data:n},success:function(t){html='<div id="product_box" style="visibility: visible; z-index: 3000; opacity: 1; top: 0px; position: relative;"><div class="pseudopopupWrapper"><div class="pseudopopup"><p>Успешно изпратена информация!</p></div></div></div>',$("#navigation_frame").contents().find("body").prepend(html),setTimeout(function(){$("#navigation_frame").contents().find("#product_box").remove()},2500)},error:function(t,n,e){console.log(t,n,e)}})}
n.css("background","none"),n.html('<ul style="padding-top: 25px;"><li><button id="getCitizens">Списък граждани</button></li><li><button id="getMarket">Списък пазар</button></li><li><button id="getArmy">Списък армии/групи</button></li></ul>'),$("input#charName").val($(".nomJoueur a").text()),$("input#location").val($(".horloge div").clone().children().remove().end().text().trim()),$("#getCitizens").click(function(){var t=$("#navigation_frame").contents().find("#zoneTexte0 ul table tbody tr"),n=$("#navigation_frame").contents().find("#zoneTexte0 ul ul a"),i={c:{},n:{}},a={};t.each(function(t,n){var e={};$(n).find("td").each(function(t,n){switch(t){case 0:e.n=n.innerText;break;case 1:e.l=n.innerText;break;case 2:e.r=n.innerText.substring(0,n.innerText.length-2)}}),i.c[t]=e}),n.each(function(t,n){a[t]=n.innerText}),i.n=a,e("citizen",JSON.stringify({l:$(".horloge div").clone().children().remove().end().text().trim(),u:$(".nomJoueur a").text(),d:i}))}),$("#getMarket").click(function(){var t=$("#navigation_frame").contents().find("#zoneTexte0.texte.texteInventaire table tbody tr"),n={};t.each(function(t,e){var i={};if(!t)return 1;$(e).find("td").each(function(t,n){switch(t){case 1:i.i=n.innerText;break;case 2:i.p=n.innerText;break;case 3:i.q=n.innerText}}),n[t]=i}),e("market",JSON.stringify({l:$(".horloge div").clone().children().remove().end().text().trim(),u:$(".nomJoueur a").text(),d:n}))}),$("#getArmy").click(function(){var n,i=$("#navigation_frame").contents().find("#zoneTexte2.texte ul ul"),a={},o={};i.each(function(e,i){switch(e){case 0:$(i).find("div.uneArmee").each(function(n,e){t={},$(e).find("li").each(function(n,e){switch(n){case 1:t.n=e.innerText;break;case 2:t.l=e.innerText}}),a[n]=t});break;case 1:$(i).find("table tr.ligneGroupe1").each(function(n,e){t={},$(e).find("td a").each(function(n,e){t[n]=e.innerText}),o[n]=t});break;case 2:n=$(i).find("li")[0].innerText}}),e("army",JSON.stringify({l:$(".horloge div").clone().children().remove().end().text().trim(),u:$(".nomJoueur a").text(),d:{a:a,g:o,c:n}}))})})