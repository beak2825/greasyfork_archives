// ==UserScript==
// @name         Erev2 Tools
// @namespace    Erev2 Tools
// @description  Feel free to donate https://www.erev2.com/en/profile/182
// @version      0.8
// @author       tyrlaka
// @match        https://www.erev2.com/*
// @grant        none


// @downloadURL https://update.greasyfork.org/scripts/376211/Erev2%20Tools.user.js
// @updateURL https://update.greasyfork.org/scripts/376211/Erev2%20Tools.meta.js
// ==/UserScript==
jQuery(document).ready(function(){setInterval(function(){if("refill"==localStorage.energy){var e=$("#energyBarT").text().split(" / ");if(console.log(e[0]+" || "+e[1]),$("#energyButton #energyButtonT").html()>0){var t=Math.floor(10*Math.random())+1;setTimeout(function(){if(1*e[0]<1*e[1]){document.getElementById("energyButton").click();console.log("Energy refilled")}},60*t*1e3)}}},6e4),setTimeout(function(){window.location.href="https://www.erev2.com/"},6e5);var e,t="https://www.erev2.com/en/api/citizen/"+$("#user-left-box").find("a")[0].href.split("/")[5];$.ajax({url:t,type:"GET",success:function(t){var a=JSON.parse(t);e=a[0].DMG1HIT}}),$.ajax({url:"https://www.erev2.com/en/inventory",type:"GET",success:function(t){var a,o=$(t).find(".vs303"),s=0,r=0,n=0,i=0,c=0,l=0,p=0,g=$(t).find(".vsPanel-title").text().split("[")[1].split("]");$("#header-nav").before("<div id='settings' style='float: left;margin-left: 20px;margin-top: 5px;'>"),"show"==localStorage.storage?$("#settings").append("<input type='checkbox' id='sstorage' checked> Show storage "):$("#settings").append("<input type='checkbox' id='sstorage'> Show storage "),"show"==localStorage.dmg?$("#settings").append("<input type='checkbox' id='sdmg' checked> Show DMG <br /> "):$("#settings").append("<input type='checkbox' id='sdmg'> Show DMG <br /> "),"refill"==localStorage.energy?$("#settings").append("<input type='checkbox' id='senergy' checked> Autorefill energy </div>"):$("#settings").append("<input type='checkbox' id='senergy'> Autorefill energy </div>");for(var h=0,d=0,f=0,u=0;u<o.length;u++){var y=$(t).find(".vs303 .vs303-2")[u].innerHTML,b=$(t).find(".vs303 .vs303-3")[u].innerHTML,v=$(t).find(".vs303 .vs303-4")[u].innerHTML;switch(y){case"Food":switch(a="food",b){case"Q1":r=2;break;case"Q2":r=4;break;case"Q3":r=6;break;case"Q4":r=8;break;case"Q5":r=10}s+=r*v;break;case"Weapons":switch(b){case"Q1":a="weapons1",1.3;break;case"Q2":a="weapons2",1.6;break;case"Q3":a="weapons3",1.9;break;case"Q4":a="weapons4",2.2,h=v;break;case"Q5":a="weapons5",2.5,d=v}break;case"Energy":a="energy-bar";var m=v;break;case"RPG":a="rpg",f=v;break;case"Booster":a="booster";var x=b.split("Q");x[1]>p&&(p=x[1]);break;case"Missile":switch(a="missile",b){case"Q1":l=2e5;break;case"Q2":l=4e5;break;case"Q3":l=6e5;break;case"Q4":l=8e5;break;case"Q5":l=1e6}c+=l*v;break;case"House":a="house"}var k=0;$("#page-wrapper #content-wrapper .row").each(function(e,t){0==k&&(k=1,$(this).before('<span id="str" class="str" style="display: inline-block;margin-bottom: 10px;"><div class="vs303"><img class="vs303-1" src="/public/game/items/'+a+'.png" width="50" height="50"><span class="vs303-2">'+y+'</span><small class="vs303-3">'+b+'</small><strong class="vs303-4">'+v+"</strong></div></span>"))})}function w(){"show"==localStorage.storage?$(".str").show():$(".str").hide()}function M(){n=0;var t=0,a=0,o=$("#WQ4").val(),s=$("#WQ5").val(),r=$("#wrpg").val(),l=$("#bars").val(),g=$("#energyBarT").text().split(" / "),h=$("#energyButton #energyButtonT").html();switch(a=10*l,g[0]==g[1]?a+=h>0?g[0]/10+h/10:g[0]/10:a+=g[0]/10,0!=r?r<a?(i=e*(3.5*r),r,a-=r):(r>a||r==a)&&(i=e*(3.5*a),a=0):i=0,0!=s&&(s<a?(n+=e*(2.5*s),s,a-=s):(s>a||s==a)&&(n+=e*(2.5*a),a=0)),0!=o&&(o<a?(n+=e*(2.2*o),o,a-=o):(o>a||o==a)&&(n+=e*(2.2*a))),p){case"1":t=1.1;break;case"2":t=1.2;break;case"3":t=1.3;break;case"4":t=1.4;break;case"5":t=1.5;break;default:t=1}var d,f,u,y=$("#enemy").is(":checked"),b=$("#boost").is(":checked");$("#missiles").is(":checked");if(1==y&&1==b){Math.floor(c);0!=p&&"undefined"!=p?(d=Math.floor(1.1*n*t),f=Math.floor(1.1*i*t)):(d=Math.floor(1.1*n),f=Math.floor(1.1*i)),u=Math.floor(d+f)}else 1==y&&0==b?(d=Math.floor(1.1*n),f=Math.floor(1.1*i),u=Math.floor(d+f)):0==y&&1==b?(0!=p&&"undefined"!=p?(d=Math.floor(n*t),f=Math.floor(i*t)):(d=Math.floor(n),f=Math.floor(i)),u=Math.floor(d+f)):0==y&&0==b&&(d=Math.floor(n),f=Math.floor(i),u=Math.floor(d+f));$("#totaldmg").html(u.toLocaleString())}function Q(){"show"==localStorage.dmg?($("#header-navbar .container").after("<div id='wdmg' style='color: #fff'><span style='margin-left:220px; margin-right:50px;'>Bars: <input type='text' id='bars' value='"+m+"' style='width: 40px;height:20px;color:#333;margin-right:20px;text-align: center;'>  Q4:<input type='text' id='WQ4' value='"+h+"' style='width: 50px; height: 20px; color: #333;margin-right:20px;text-align: center;'> Q5:<input type='text' id='WQ5' value='"+d+"' style='width: 50px; height: 20px; color: #333;margin-right:20px;text-align: center;'> <span style='margin-right:20px;'>RPG: <input type='text' id='wrpg' value='"+f+"' style='width:40px;height:20px;color:#333;text-align: center;'></span> <span style='margin-right:10px;'>Total: <b><span id='totaldmg'>0</span></b></span> <input type='checkbox' id='enemy'> Natural Enemy <input type='checkbox' id='boost'> Booster <input type='checkbox' id='missiles'> Missiles</div>"),$("#enemy").on("click",function(e){M()}),$("#boost").on("click",function(e){M()}),$("#missiles").on("click",function(e){M()})):"hide"==localStorage.dmg&&$("#wdmg").remove(),M()}w(),Q(),$("#sstorage").change(function(e){var t=$("#sstorage").is(":checked");localStorage.storage=1==t?"show":"hide",w()}),$("#sdmg").change(function(e){var t=$("#sdmg").is(":checked");localStorage.dmg=1==t?"show":"hide",Q()}),$("#senergy").change(function(e){var t=$("#senergy").is(":checked");localStorage.energy=1==t?"refill":"dont"}),$("#WQ4").keyup(function(e){M()}),$("#WQ5").keyup(function(e){M()}),$("#wrpg").keyup(function(e){M()}),$("#bars").keyup(function(e){M()}),$("#energyButton").before("<div id='energy' style='color: #fff; margin-bottom: 3px;'><span>You have food for: <b>"+s.toLocaleString()+"</b> Energy</span></div>");var S="<div style='border: 1px solid #E7EBEE;box-shadow: 0 1px 1px rgba(0,0,0,0.1);margin-bottom: 5px;border-radius: 3px;padding: 2px 5px;'><img src='/public/game/companies/storage.png' width='24' height='24' > Storage <span style='float: right;font-size: 12px;color: #fff;cursor: default;font-weight: 700;line-height: 24px;'>"+g[0]+"</span></div>",T=document.createElement("div");T.innerHTML=S,$(".vs100")[0].before(T.firstChild)}})});