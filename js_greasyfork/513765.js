// ==UserScript==
// @name         vSprint Opisy Baselinker - Publikacje
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Modyfikowanie opisów baselinker po API claude
// @author       Paweł Kaczmarek
// @match        https://*.baselinker.com/inventory_products.php*
// @grant        GM_xmlhttpRequest
// @downloadURL https://update.greasyfork.org/scripts/513765/vSprint%20Opisy%20Baselinker%20-%20Publikacje.user.js
// @updateURL https://update.greasyfork.org/scripts/513765/vSprint%20Opisy%20Baselinker%20-%20Publikacje.meta.js
// ==/UserScript==

!function(){"use strict";let e="";function t(t){let n=document.createElement("button");n.textContent="vSprint Opisy ",n.style.padding="10px 20px",n.style.backgroundColor="#ff5a00",n.style.color="white",n.style.border="none",n.style.borderRadius="5px",n.style.cursor="pointer",n.style.marginLeft="10px",n.onclick=t=>{t.stopPropagation(),t.preventDefault(),function(){const t=document.createElement("div");t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="10000",t.style.backgroundColor="white",t.style.padding="20px",t.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)",t.style.borderRadius="8px",t.style.width="800px",t.style.maxHeight="80%",t.style.overflowY="auto",t.style.color="black";const n=document.createElement("div");n.style.display="flex",n.style.cursor="pointer";const l=document.createElement("div");l.textContent="Zapytanie",l.style.flex="1",l.style.padding="10px",l.style.textAlign="center",l.style.border="1px solid #ccc",l.style.borderBottom="none",l.style.backgroundColor="#f1f1f1",l.onclick=()=>{r.style.display="block",d.style.display="none",l.style.backgroundColor="#f1f1f1",s.style.backgroundColor="white"};const s=document.createElement("div");s.textContent="Prompt",s.style.flex="1",s.style.padding="10px",s.style.textAlign="center",s.style.border="1px solid #ccc",s.style.borderBottom="none",s.style.backgroundColor="white",s.onclick=()=>{r.style.display="none",d.style.display="block",s.style.backgroundColor="#f1f1f1",l.style.backgroundColor="white"},n.appendChild(l),n.appendChild(s),t.appendChild(n);const r=document.createElement("textarea");r.placeholder="Wpisz swoje zapytanie...",r.style.width="100%",r.style.height="400px",r.style.marginBottom="10px",r.style.padding="8px",r.style.border="1px solid #ccc",r.style.borderRadius="4px",r.style.resize="none";const d=document.createElement("textarea");d.placeholder="Wpisz swój prompt...",d.style.width="100%",d.style.height="400px",d.style.marginBottom="10px",d.style.padding="8px",d.style.border="1px solid #ccc",d.style.borderRadius="4px",d.style.display="none",d.style.resize="none",d.value=e;const i=document.createElement("button");i.textContent="Wyślij",i.style.padding="10px 20px",i.style.backgroundColor="#ff5a00",i.style.color="white",i.style.border="none",i.style.borderRadius="5px",i.style.cursor="pointer",i.onclick=()=>{const e=r.value.trim(),t=d.value.trim(),n=t?`${t} ${e}`:e;n?(o(!0),function(e){GM_xmlhttpRequest({method:"POST",url:"https://api.anthropic.com/v1/messages",headers:{"x-api-key":"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","anthropic-version":"2023-06-01","Content-Type":"application/json"},data:JSON.stringify({model:"claude-3-5-sonnet-20240620",max_tokens:4e3,messages:[{role:"user",content:e}]}),onload:function(e){if(o(!1),200===e.status){!function(e){const t=document.getElementById("product_integration_field_values");if(t){const o=t.querySelector("textarea.text_field.synchronized-to-uploader");o&&(o.value=e)}}(JSON.parse(e.responseText).content[0].text)}else console.error("Błąd w odpowiedzi API:",e.statusText)},onerror:function(e){o(!1),console.error("Błąd żądania:",e)}})}(n)):alert("Nie wpisano żadnego zapytania ani promptu!")};const a=document.createElement("button");a.textContent="Zamknij",a.style.padding="10px 20px",a.style.backgroundColor="#f44336",a.style.color="white",a.style.border="none",a.style.borderRadius="5px",a.style.cursor="pointer",a.style.marginTop="10px",a.style.marginLeft="10px",a.onclick=()=>{t.remove(),c.remove()},t.appendChild(r),t.appendChild(d),t.appendChild(i),t.appendChild(a),document.body.appendChild(t);const c=document.createElement("div");c.style.position="fixed",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.backgroundColor="rgba(0, 0, 0, 0.5)",c.style.zIndex="9999",document.body.appendChild(c),c.onclick=()=>{t.remove(),c.remove()};const p=document.getElementById("product_integration_field_values");if(p){const e=p.querySelector("textarea.text_field.synchronized-to-uploader");e&&(r.value=e.value)}}()},t.insertAdjacentElement("beforeend",n)}function o(e){let t=document.getElementById("loadingIndicator");e?t||(t=document.createElement("div"),t.id="loadingIndicator",t.textContent="Ładowanie...",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="10001",t.style.padding="10px 20px",t.style.backgroundColor="#333",t.style.color="white",t.style.borderRadius="5px",t.style.fontSize="16px",t.style.opacity="0.8",document.body.appendChild(t)):t&&t.remove()}new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{1===e.nodeType&&"product_integration_field_values"===e.id&&e.querySelectorAll("label.h16").forEach((e=>{if("Opis (PL)"===e.textContent.trim()){const o=e.closest(".inblock-group");o&&t(o)}}))}))}))})).observe(document.body,{childList:!0,subtree:!0})}();