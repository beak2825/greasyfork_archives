// ==UserScript==
// @name         CheckoutCXSimplification
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  Script that tampers the current 'review order' checkout panel to include 3 tabs and reduce the number of delivery options
// @author       @dgoncas ( Daniel Gonzalez Castineiras )
// @match        https://www.amazon.com/gp/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=hibbard.eu
// @grant        none
// @require      http://code.jquery.com/jquery-latest.js
// @downloadURL https://update.greasyfork.org/scripts/495791/CheckoutCXSimplification.user.js
// @updateURL https://update.greasyfork.org/scripts/495791/CheckoutCXSimplification.meta.js
// ==/UserScript==
(()=>{"use strict";const n={class:"shipment"},e={class:"item-row"},t={"data-testid":"Product_title"},a={"data-testid":"Product_price"},i={"data-testid":"Product_image"},s={class:"a-row shipping-speeds"},o=(n,e=document,t=!0)=>{const a=Object.keys(n)[0],i=t?"*=":"=";return Array.from(e.querySelectorAll(`[${a}${i}'${n[a]}']`))},l=n=>({lineItem:o(e,n).flatMap(r),deliveryOptionsMenu:[o(s,n)[0].innerHTML]}),r=n=>({title:[o(t,n)[0].innerText],price:[o(a,n)[0].innerText],image:[o(i,n)[0].src]}),p="{text}",d={purchaseDocument:"\n{tabSelector} {tabDeliveryGroups}\n",tabSelector:'\n<div id="delivery-preference-tabs-wrapper">\n    <div data-csa-c-func-deps="aui-da-a-button-group" data-csa-c-type="widget" data-csa-interaction-events="click" class="a-button-group a-declarative tabs-container" data-action="a-button-group" role="radiogroup"> \n        <span class="a-button a-button-base tab-button a-button-selected" id="fast-tab-button"><span class="a-button-inner"><input class="a-button-input" aria-labelledby="a-autoid-0-announce"><span class="a-button-text" aria-hidden="true" id="a-autoid-0-announce"> <span class="a-size-base aok-block"> Fast </span> <span class="a-size-base aok-block color-gray"> Ship items at the earliest available dates </span> </span></span></span> \n        <span class="a-button a-button-base tab-button" id="consolidated-tab-button"><span class="a-button-inner"><input class="a-button-input" aria-labelledby="a-autoid-1-announce"><span class="a-button-text" aria-hidden="true" id="a-autoid-1-announce"> <span class="a-size-base aok-block"> Most Consolidated </span> <span class="a-size-base aok-block color-gray"> Ship items in the fewest deliveries possible </span> </span></span></span> \n        <span class="a-button a-button-base tab-button" id="optimized-tab-button"><span class="a-button-inner"><input class="a-button-input" aria-labelledby="a-autoid-2-announce"><span class="a-button-text" aria-hidden="true" id="a-autoid-2-announce"> <span class="a-size-base aok-block"> Optimized </span> <span class="a-size-base aok-block color-gray"> Balance between speed and consolidation </span> </span></span></span> \n    </div>\n</div>\n\n<style>\n\n#delivery-preference-tabs-wrapper{\n    margin-bottom: 40px;\n    margin-top: 20px;\n}\n\n.tabs-container {\n    display: flex;\n}\n\n.tab-button {\n    flex: 1;\n}\n\n.tab-button .a-button-inner {\n    height: auto;\n}\n\n.tab-button .a-button-text {\n    padding: 20px !important;\n    text-wrap: wrap !important;\n}\n\n.color-gray {\n    color: #999B9B !important;\n}\n\n</style> ',tabDeliveryGroups:'\n<div id="tab-contents-{tabName}"> \n    {deliveryGroup}\n</div>\n',deliveryGroup:'\n<div class="a-box box">\n    <div class="a-box-inner">\n\n        <div class="contract-promise-wrapper"> \n            <span class="a-size-medium-plus title a-text-bold"> Delivery group 1/3 </span> \n        </div>\n        \n        <div id="delivery-group-card-content"> \n            <div id="line-items-wrapper">\n                {lineItem}\n            </div>\n\n            <div id="delivery-options-menu-wrapper"> \n                {deliveryOptionsMenu}\n            </div>\n        </div>\n\n    </div>\n</div>\n\n<style>\n\n    .box {\n        margin-bottom: 20px;\n    }\n\n    #delivery-group-card-content {\n        margin-top: 20px;\n        display: flex;\n        flex-direction: row;\n        gap: 20px;\n    }\n\n    #line-items-wrapper {\n        flex: 1;\n        max-width: 500px;\n    }\n\n    #delivery-options-menu-wrapper{\n        flex: 1;\n    }\n\n    #line-items-wrapper {\n        display: flex;\n        flex-direction: column;\n        gap: 20px;\n    }\n\n    .title {\n        color: #EA9018;\n    }\n\n    .contract-promise-wrapper {\n        margin-top: 10px;\n    }\n\n    .color-gray {\n        color: #999B9B !important;\n    }\n\n    #spc-form{\n        display : none;\n    }\n\n</style>\n',lineItem:'\n<div class="line-item-wrapper"> \n    <img alt="" src="{image}" class="line-item-image"/> \n    <div id="line-item-description"> \n        <span class="a-size-base aok-block a-text-bold"> {title} </span> \n        <span class="a-size-base a-color-price aok-block a-text-bold"> {price} </span> \n        <span id="quantity-selector" class="a-button a-button-dropdown a-button-base">\n            <span class="a-button-inner">\n                <i class="a-icon a-icon-dropdown"></i>\n                <input class="a-button-input" aria-labelledby="quantity-selector-announce">\n                <span id="quantity-selector-announce" class="a-button-text" aria-hidden="true"> Qty: 10 </span>\n            </span>\n        </span> \n        <span class="a-size-base aok-block color-gray"> Sold by: Amazon.com LLC </span> \n    </div> \n</div>\n\n<style>\n\n    #quantity-selector {\n        width: min-content !important;\n        height: min-content !important;;\n    }\n\n    .line-item-wrapper{\n        display: flex;\n        flex-direction: row;\n        gap: 10px;\n    }\n\n    #line-item-description{\n        display: flex;\n        flex-direction: column;\n        gap: 5px;\n    }\n\n    .line-item-image{\n        width: 100px;\n        height: min-content;\n    }\n\n</style>\n',title:p,price:p,image:p,deliveryOptionsMenu:p,tabName:p},c=(n,e="purchaseDocument")=>{let t=d[e];return"string"==typeof n?t.replace(p,n):(Object.keys(n).forEach((e=>{let a="";n[e].forEach((n=>{a+=c(n,e)})),t=t.replace(`{${e}}`,a)})),t)},u=[" "],b=n=>{const e=[];return n.forEach(((n,t)=>{n.lineItem.forEach((t=>{e.push({lineItem:[t],deliveryOptionsMenu:n.deliveryOptionsMenu})}))})),e},m=n=>{const e=[{lineItem:[],deliveryOptionsMenu:n[0].deliveryOptionsMenu}];return n.forEach((n=>{n.lineItem.forEach((n=>{e[0].lineItem.push(n)}))})),e},y="fast",v="optimized",g="consolidated",x="spc-form",f="tab-contents-",h=f+y,w=f+v,k=f+g,I=n=>{z(n)&&E(n),setTimeout((()=>I(n)),500)},z=n=>null!==n.getElementById(x),E=e=>{const t=(e=>({deliveryGroups:o(n,e).map(l)}))(e),a={tabSelector:u,tabDeliveryGroups:[{tabName:["fast"],deliveryGroup:b((i=t).deliveryGroups)},{tabName:["consolidated"],deliveryGroup:m(i.deliveryGroups)},{tabName:["optimized"],deliveryGroup:i.deliveryGroups}]};var i;const s=c(a);B(x,"review-order-panel",s),e.getElementById("fast-tab-button").onclick=()=>G(e,y),e.getElementById("consolidated-tab-button").onclick=()=>G(e,g),e.getElementById("optimized-tab-button").onclick=()=>G(e,v),G(e,y)},B=(n,e,t)=>{const a=document.getElementById(n);a.innerHTML=t,a.id=e},G=(n,e)=>{n.getElementById(h).style.display="none",n.getElementById(k).style.display="none",n.getElementById(w).style.display="none",n.getElementById(f+e).style.display="block"};$(document).ready((function(){I(document)}))})();