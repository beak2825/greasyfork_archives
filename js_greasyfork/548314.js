// ==UserScript==
// @name         KRS 3.0 WEB CN
// @version      1.07
// @description  将KRS 3.0 WEB控制台的指定英文文本替换为简体中文。
// @author       ste
// @match        https://192.168.31.120/*
// @grant        none
// @run-at       document-end
// @namespace http://tampermonkey.net/
// @downloadURL https://update.greasyfork.org/scripts/548314/KRS%2030%20WEB%20CN.user.js
// @updateURL https://update.greasyfork.org/scripts/548314/KRS%2030%20WEB%20CN.meta.js
// ==/UserScript==
 
(function() {
    'use strict';
 
    // --- 翻译配置 ---
 
    // 基于文本内容的通用翻译 (用于标题、按钮、标签、卡片内容等)
    // 修正：将 [key, value] 格式更改为 'key': 'value' 的标准对象格式
    const textTranslations = {
        'Research Sandbox': '研究沙盒',
        'Sign In': '登录',
        'User name': '用户名',
        'Password': '密码',
        'Error 404. Page not found.': '错误 404。页面未找到。',
        'Neither KSN nor KPSN is configured. The results are incomplete. For details, see the "Could not check the reputation of files and URLs" section in the Help.': 'KSN 和 KPSN 均未配置。结果不完整。有关详情，请参阅帮助中的“无法检查文件和 URL 的信誉”部分。',
        'The page you are looking for could not be found.': '您正在查找的页面不存在。',
        'Please check the URL and try again. If the problem reoccurs, please contact us.': '请检查 URL 并重试。如果问题再次出现，请联系我们。',
        'Back to Sandbox page': '返回沙盒页面',
        'Sandbox': '沙盒',
        'Environments': '环境',
        'Templates & Storage': '模板和存储',
        'Accounts': '账户',
        'Settings': '设置',
        'Account': '账户',
        'Profile': '个人资料',
        'Sign out': '退出登录',
        'Agreements': '协议',
        'End User License Agreement': '最终用户授权许可协议',
        'KSN Agreement': 'KSN 协议',
        'Change password': '更改密码',
        'Current Password': '当前密码',
        'New Password': '新密码',
        'Confirm Password': '确认密码',
        'All fields must be filled in': '所有字段都必须填写',
        'New password must be at least 8 characters': '新密码必须至少为 8 个字符',
        'New password cannot be longer than 64 characters': '新密码不能超过 64 个字符',
        'New password must contain digits and special characters': '新密码必须包含数字和特殊字符',
        'New password must contain lowercase and uppercase characters': '新密码必须包含小写和大写字符',
        'New password cannot match the previous one': '新密码不能与旧密码相同',
        '"New password" and "Confirm password" fields must match': '“新密码”和“确认密码”字段必须匹配',
        'By using this service, you accept the terms and conditions of the End User License Agreement.': '使用此服务即表示您接受最终用户授权许可协议的条款和条件。',
        'Close': '关闭',
        'Kaspersky security network': '卡巴斯基安全网络',
        'Cloud reputation services': '云信誉服务',
        'Connection type': '连接类型',
        'Not connected': '未连接',
        'Active': '活动',
        'Processing results are incomplete if KSN/KPSN is not used': '如果不使用 KSN/KPSN，处理结果将不完整',
        'Save': '保存',
        'Upload and execute file': '上传并执行文件',
        'Browse URL': '浏览 URL',
        'Drag & drop file here': '将文件拖放到此处',
        'Select file': '选择文件',
        'File size up to 1024 MB': '文件大小上限为 1024 MB',
        'Full analysis': '完整分析',
        'Static analysis': '静态分析',
        'Unpack password': '解包密码',
        'Execution environment': '执行环境',
        'Execution time (sec)': '执行时间 (秒)',
        'Auto': '自动',
        'Advanced options': '高级选项',
        'Start file execution': '开始文件执行',
        'Reset': '重置',
        'Available only for Windows and Linux execution environments': '仅适用于 Windows 和 Linux 执行环境',
        'Change file name and extension to:': '将文件名和扩展名更改为:',
        'Document password': '文档密码',
        'Internet channel': '互联网通道',
        'Add YARA file': '添加 YARA 文件',
        'YARA file': 'YARA 文件',
        'Browse': '浏览',
        'Add Suricata rules file': '添加 Suricata 规则文件',
        'Suricata rules file': 'Suricata 规则文件',
        'Recommended file size not more than 5 MB': '推荐文件大小不超过 5 MB',
        'Command line parameters': '命令行参数',
        'You can specify the command line parameters to start the object execution with, for example Windows environment variables. For details and usage examples, see the "Command line parameter examples" section in the Help.': '您可以指定用于启动对象执行的命令行参数，例如 Windows 环境变量。有关详情和使用示例，请参阅帮助中的“命令行参数示例”部分。',
        'Decrypt HTTPS': '解密 HTTPS',
        'Click document links': '单击文档链接',
        'VNC access': 'VNC 访问',
        'Launch automatically': '自动启动',
        'Disable clicker': '禁用点击器',
        'Create debug report': '创建调试报告',
        'Created': '已创建',
        'Zone\tStatus\tDetails': '区域\t状态\t详情',
        'Actions': '操作',
        'View details': '查看详情',
        'MD5\t25d95101644059eca8298c0e58a820b0': 'MD5\t25d95101644059eca8298c0e58a820b0',
        'File size': '文件大小',
        'Executed as': '执行身份',
        'File type': '文件类型',
        'Analyzed': '已分析',
        'Execution environment': '执行环境',
        'Execution time': '执行时间',
        'Disable dynamic analysis': '禁用动态分析',
        'Click document links': '单击文档链接',
        'HTTPS decryption': 'HTTPS 解密',
        'Debug report': '调试报告',
        'Channel': '通道',
        'VNC sample autostart': 'VNC 样本自动启动',
        'YARA scan status': 'YARA 扫描状态',
        'Not scanned': '未扫描',
        'Suricata file': 'Suricata 文件',
        'Suricata scan status': 'Suricata 扫描状态',
        'Sandbox report': '沙盒报告',
        'Static analysis': '静态分析',
        'Static info': '静态信息',
        'Threats': '威胁',
        'Extracted files': '提取的文件',
        'Dynamic analysis': '动态分析',
        'System activities': '系统活动',
        'Network activities': '网络活动',
        'Execution environments are created based on templates. To create an environment, you first need to import or create a template.': '执行环境是基于模板创建的。要创建环境，您首先需要导入或创建一个模板。',
        'For more information on creating execution environments, see the "Creating a new template" section in the Help.': '有关创建执行环境的更多信息，请参阅帮助中的“创建新模板”部分。',
        'Default': '默认',
        'Custom': '自定义',
        'Deployed': '已部署',
        'Deployed by': '部署者',
        'Bus width': '总线宽度',
        'Name': '名称',
        'Version': '版本',
        'Kaspersky Research Sandbox allows you to create custom file execution environments. On this page, you can create and manage environment templates and storage media. Deployed templates will be available in the list of execution environments on the Sandbox page.': 'Kaspersky Research Sandbox 允许您创建自定义文件执行环境。在此页面上，您可以创建和管理环境模板和存储介质。已部署的模板将在“沙盒”页面的执行环境列表中可用。',
        'Add': '添加',
        'Templates': '模板',
        'Storage media': '存储介质',
        'Import': '导入',
        'Add template': '添加模板',
        'Prepare image': '准备映像',
        'Choose a name and image.': '选择一个名称和映像。',
        'Configure template': '配置模板',
        'Install and set up the operating system.': '安装并设置操作系统。',
        'You can stop and resume the setup process at any time.': '您可以随时停止和恢复设置过程。',
        'Deploy': '部署',
        'A new execution environment will be created based on this template.': '将基于此模板创建一个新的执行环境。',
        'Description': '描述',
        'ISO image': 'ISO 映像',
        'Upload image': '上传映像',
        'File format: ISO.': '文件格式: ISO。',
        'KSN Statement': 'KSN 声明',
        'I am aware and agree that my data will be handled and transmitted (including to third countries) as described in the': '我知晓并同意，我的数据将按照...中的描述进行处理和传输 (包括传输到第三国)',
        'I confirm that I have fully read and understand the': '我确认我已完全阅读并理解...',
        'I agree to participate in KSN': '我同意参与 KSN',
        'Report for file': '文件报告',
        'Export results': '导出结果',
        'Not categorized': '未分类',
        'Not categorized': '未分类',
        'Clean': '干净',
        'Good': '良好',
        'Processing failed': '处理失败',
        'Summary': '摘要',
        'This section displays general information about execution results.': '本节显示有关执行结果的常规信息。',
        'Detections': '检测',
        'Total': '总计',
        'Malware': '恶意软件',
        'Adware and other': '广告软件及其他',
        'YARA detections': 'YARA 检测',
        'Suspicious activities': '可疑活动',
        'Dangerous': '危险',
        'Database update': '数据库更新',
        'Automatically detected type of the executed file. For details, see the "Automatic file format detection and detonation" section in the Help.': '自动检测到的已执行文件类型。有关详情，请参阅帮助中的“自动文件格式检测和引爆”部分。',
        'This section contains screenshots taken during execution of the task. Screenshots are taken for each action the object performs. You can view screenshots online or download them by clicking the "Download data" link.': '本节包含任务执行期间截取的屏幕截图。对象执行的每个操作都会截取屏幕截图。您可以在线查看屏幕截图，或单击“下载数据”链接下载它们。',
        'Screenshots': '屏幕截图',
        'Completed': '已完成',
        'Status': '状态',
        'Sandbox detection names': '沙盒检测名称',
        'YARA detections': 'YARA 检测',
        'No data found': '未找到数据',
        'YARA detections': 'YARA 检测',
        'No data found': '未找到数据',
        'This table displays information about detections that were registered during execution in Kaspersky Research Sandbox.': '此表显示在 Kaspersky Research Sandbox 中执行期间注册的检测信息。',
        'This table displays the YARA detections for files that were extracted from the network traffic.': '此表显示从网络流量中提取的文件的 YARA 检测结果。',
        'This table displays information about files that the uploaded packed object contains.': '此表显示上传的加壳对象所包含的文件的信息。',
        'Packed object content': '加壳对象内容',
        'Execution map': '执行图',
        'A visual representation of the sequence of the object\'s activities and the relationships between them.': '对象活动序列及其之间关系的可视化表示。',
        'Sample run': '样本运行',
        'Process creation': '进程创建',
        'RPC Execution': 'RPC 执行',
        'ImagePath': '映像路径',
        'TTPs&MITRE': 'TTP 和 MITRE',
        'Triggered IDS rules': '触发的 IDS 规则',
        'Triggered custom IDS rules': '触发的自定义 IDS 规则',
        'This table displays information about suspicious activities that were detected during file execution.': '此表显示文件执行期间检测到的可疑活动信息。',
        'This table displays the names of Suricata rules that were triggered during execution.': '此表显示执行期间触发的 Suricata 规则的名称。',
        'Transferred files': '传输的文件',
        'Dropped files': '释放的文件',
        'This table displays information about files that were saved by the executed file.': '此表显示由已执行文件保存的文件信息。',
        'This table displays information about files that were extracted from network traffic during file execution.': '此表显示文件执行期间从网络流量中提取的文件信息。',
        'File name': '文件名',
        'SMB sessions': 'SMB 会话',
        'SMTP sessions': 'SMTP 会话',
        'IP sessions': 'IP 会话',
        'This table displays information about the SMB sessions that were registered during file execution.': '此表显示文件执行期间注册的 SMB 会话信息。',
        'This table displays information about the SMTP sessions that were registered during file execution.': '此表显示文件执行期间注册的 SMTP 会话信息。',
        'This table displays information about the IP sessions that were registered during file execution.': '此表显示文件执行期间注册的 IP 会话信息。',
        'Destination IP': '目标 IP',
        'Started\tEnded': '开始\t结束',
        'Size': '大小',
        'Packets': '数据包',
        'Copy to clipboard': '复制到剪贴板',
        'Threat Intelligent Portal Lookup': '威胁情报门户查找',
        'TCP sessions': 'TCP 会话',
        'UDP sessions': 'UDP 会话',
        'This table displays information about the TCP sessions that were registered during file execution.': '此表显示文件执行期间注册的 TCP 会话信息。',
        'This table displays information about the UDP sessions that were registered during file execution.': '此表显示文件执行期间注册的 UDP 会话信息。',
        'DNS sessions': 'DNS 会话',
        'This table displays information about the DNS sessions that were registered during execution.': '此表显示执行期间注册的 DNS 会话信息。',
        'SSL sessions': 'SSL 会话',
        'FTP sessions': 'FTP 会话',
        'IRC sessions': 'IRC 会话',
        'POP3 sessions': 'POP3 会话',
        'SOCKS sessions': 'SOCKS 会话',
        'HTTP requests': 'HTTP 请求',
        'HTTPS requests': 'HTTPS 请求',
        'Edit account': '编辑账户',
        'Full name': '全名',
        'admin': 'admin',
        'Should contain only a-z A-Z 0-9 . _ - and spaces': '应仅包含 a-z A-Z 0-9 . _ - 和空格',
        'Role': '角色',
        'Confirm password': '确认密码',
        'Password must be at least 8 characters': '密码必须至少为 8 个字符',
        'Password cannot be longer than 64 characters': '密码不能超过 64 个字符',
        'Password must contain digits and special characters': '密码必须包含数字和特殊字符',
        'Password must contain lowercase and uppercase characters': '密码必须包含小写和大写字符',
        'Password cannot match the previous one': '密码不能与旧密码相同',
        '"Password" and "Confirm password" fields must match': '“密码”和“确认密码”字段必须匹配',
        'This field is required': '此字段为必填项',
        'Pattern does not match': '模式不匹配',
        'Edit': '编辑',
        'Cancel': '取消',
        'Delete': '删除',
        'Add account': '添加账户',
        'The submitted object did not generate malicious activity during execution.': '提交的对象在执行期间未产生恶意活动。',
        'Entropy Map': '熵图',
        'Imports': '导入',
        'Sections': '区段',
        'Offset': '偏移量',
        'RawSize': '原始大小',
        'Flags': '标志',
        'Entropy': '熵',
        'Company Name': '公司名称',
        'File Description': '文件描述',
        'File Version': '文件版本',
        'Internal Name': '内部名称',
        'Legal Copyright': '法律版权',
        'Original File Name': '原始文件名',
        'Product Name': '产品名称',
        'PE Info': 'PE 信息',
        'Target Machine': '目标机器',
        'Machine Type': '机器类型',
        'Compilation Timestamp': '编译时间戳',
        'Entrypoint': '入口点',
        'Section Count': '区段计数',
        'CodeSize': '代码大小',
        'Characteristics': '特征',
        'LinkerVersion': '链接器版本',
        'OsVersion': '操作系统版本',
        'ImageVersion': '映像版本',
        'Subsystem': '子系统',
        'File Size': '文件大小',
        'Certificate': '证书',
        'Signed': '已签名',
        'Valid From': '有效期从',
        'Valid To': '有效期至',
        'Serial Number': '序列号',
        'Thumbprint': '指纹',
        'Certificate Subject': '证书主题',
        'Certificate Issuer': '证书颁发者',
        'Distinguished Name': '可分辨名称',
        'Version Info': '版本信息',
        'File Version': '文件版本',
        'Product Version': '产品版本',
        'File OS': '文件操作系统',
        'File Type': '文件类型',
        'File Subtype': '文件子类型',
        'This table displays information about the SOCKS sessions that were registered during file execution.': '此表显示文件执行期间注册的 SOCKS 会话信息。',
        'This table displays information about HTTP requests that were registered during execution.': '此表显示执行期间注册的 HTTP 请求信息。',
        'Search for Process ID': '搜索进程 ID',
        'This table displays information about interactions of the file with various processes that were registered during file execution.': '此表显示文件与文件执行期间注册的各种进程交互的信息。',
        'This table displays information about the POP3 sessions that were registered during file execution.': '此表显示文件执行期间注册的 POP3 会话信息。',
        'This table displays information about HTTPS requests that were registered during execution.': '此表显示执行期间注册的 HTTPS 请求信息。',
        'Process operations': '进程操作',
        'Loaded images/modules': '已加载的映像/模块',
        'File operations': '文件操作',
        'Registry operations': '注册表操作',
        'Synchronize operations': '同步操作',
        'Process ID': '进程 ID',
        'Operation': '操作',
        'Path': '路径',
        'Command line': '命令行',
        'Requestor process ID': '请求者进程 ID',
        'Process started': '进程已启动',
        'This table displays information about loaded images and modules that were detected during file execution.': '此表显示文件执行期间检测到的已加载映像和模块的信息。',
        'Thread ID': '线程 ID',
        'Image base': '映像基址',
        'PE image loaded': 'PE 映像已加载',
        'This table displays information about file operations that were registered during file execution.': '此表显示文件执行期间注册的文件操作信息。',
        'File created': '文件已创建',
        'File read': '文件已读取',
        'File written': '文件已写入',
        'File modified': '文件已修改',
        'This table displays information about operations performed on the operating system registry that were detected during file execution.': '此表显示文件执行期间检测到的在操作系统注册表上执行的操作信息。',
        'Registry keys enumerated': '已枚举的注册表项',
        'Registry values enumerated': '已枚举的注册表值',
        'Registry key queried': '已查询的注册表项',
        'This table displays information about the operations of created synchronization objects (mutual exclusions (mutexes), semaphores, and events) that were registered during file execution.': '此表显示文件执行期间注册的已创建同步对象 (互斥体、信号量和事件) 的操作信息。',
        'Download data': '下载数据',
        'Synchronization object creation attempt': '尝试创建同步对象',
        'Synchronization object created': '同步对象已创建',
        'Start URL analysis': '开始 URL 分析',
        'Suricata scan date': 'Suricata 扫描日期',
        'YARA scan date': 'YARA 扫描日期',
        'File deleted': '文件已删除',
        'Command_line:': '命令行:',
        'ImagePath:': '映像路径:',
        'Dropper_image_path:': '释放器映像路径:',
        'File_path:': '文件路径:',
        'Template': '模板',
        'Info': '信息',
        'This section displays the results of file execution and web address analysis. It shows the object status determined by the execution task.': '本节显示文件执行和网址分析的结果。它显示了由执行任务确定的对象状态。',
        'History': '历史',
        'Should contain only a-z 0-9 . _ -': '应仅包含 a-z 0-9 . _ -',
        'Process ended': '进程已结束',
        'Registry key created': '注册表项已创建',
        'Registry value set': '注册表值已设置',
        'Registry value queried': '已查询的注册表值',
        'Source IP': '源 IP',
        'Source port': '源端口',
        'Destination port': '目标端口',
        'SYN packets': 'SYN 数据包',
        'FIN packets': 'FIN 数据包',
        'Out-of-order packets': '乱序数据包',
        'Lost ACK packets': '丢失的 ACK 数据包',
        'Duplicated ACK packets': '重复的 ACK 数据包',
        'Window in': '入站窗口',
        'Window out': '出站窗口',
        'Cipher': '加密算法',
        'Curve': '曲线',
        'Server name': '服务器名称',
        'Subject': '主题',
        'Issuer': '颁发者',
        'This table displays information about the FTP sessions that were registered during file execution.': '此表显示文件执行期间注册的 FTP 会话信息。',
        'This table displays information about the IRC sessions that were registered during file execution.': '此表显示文件执行期间注册的 IRC 会话信息。',
        'This table displays information about the SSL sessions that were registered during file execution.': '此表显示文件执行期间注册的 SSL 会话信息。',
        'Microsoft software activation': 'Microsoft 软件激活',
        'Please use a valid Microsoft Windows XP, 7 or 10 Multiple Activation Key. A configured internet channel for the selected template is required.': '请使用有效的 Microsoft Windows XP、7 或 10 多次激活密钥 (MAK)。所选模板需要配置互联网通道。',
        'Not activated': '未激活',
        'Activate': '激活',
        'Please select the type of cloud reputation service to be used: public Kaspersky Security Network (KSN) or private Kaspersky Private Security Network (KPSN).': '请选择要使用的云信誉服务类型: 公共卡巴斯基安全网络 (KSN) 或私有卡巴斯基私有安全网络 (KPSN)。',
        'If you choose "Not connected", the results of processing samples will be incomplete.': '如果选择“未连接”，样本处理结果将不完整。'
    };
 
 
    /**
     * 翻译页面上的静态文本内容
     */
    function translatePageContent() {
        // 执行基于文本的通用翻译
        const allTextNodes = document.evaluate(
            "//body//text()[normalize-space() and not(ancestor::script) and not(ancestor::style)]",
            document,
            null,
            XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
            null
        );
 
        for (let i = 0; i < allTextNodes.snapshotLength; i++) {
            const node = allTextNodes.snapshotItem(i);
            const originalText = node.textContent.trim();
            if (textTranslations[originalText] && node.textContent !== textTranslations[originalText]) {
                // 使用 replace 替换，避免影响同一节点内的其他文本
                node.textContent = node.textContent.replace(originalText, textTranslations[originalText]);
            }
        }
    }
 
    // --- 脚本执行逻辑 ---
 
    // 使用 MutationObserver 来监视页面的动态变化
    const observer = new MutationObserver((mutationsList, observer) => {
        // 在每次DOM变化时都尝试运行一次翻译函数
        translatePageContent();
    });
 
    // 配置观察器：监视整个<body>，包括所有子孙元素的变化。
    observer.observe(document.body, {
        childList: true, // 监视子元素的添加或删除
        subtree: true    // 监视所有后代元素
    });
 
    // 在页面初始加载完成后也执行一次翻译
    window.addEventListener('load', translatePageContent);
 
})();