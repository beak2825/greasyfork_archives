// ==UserScript==
// @name         Travian Resource-Sum
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  try to take over the world!
// @author       You
// @include     *://*.travian.*
// @include     *://*/*.travian.*
// @exclude     *://*.travian*.*/hilfe.php*
// @exclude     *://*.travian*.*/index.php*
// @exclude     *://*.travian*.*/anleitung.php*
// @exclude     *://*.travian*.*/impressum.php*
// @exclude     *://*.travian*.*/anmelden.php*
// @exclude     *://*.travian*.*/gutscheine.php*
// @exclude     *://*.travian*.*/spielregeln.php*
// @exclude     *://*.travian*.*/links.php*
// @exclude     *://*.travian*.*/geschichte.php*
// @exclude     *://*.travian*.*/tutorial.php*
// @exclude     *://*.travian*.*/manual.php*
// @exclude     *://*.travian*.*/ajax.php*
// @exclude     *://*.travian*.*/ad/*
// @exclude     *://*.travian*.*/chat/*
// @exclude     *://wbb.forum.travian*.*
// @exclude     *://*.travian*.*/activate.php*
// @exclude     *://*.travian*.*/support.php*
// @exclude     *://help.travian*.*
// @exclude     *://*.answers.travian*.*
// @exclude     *.css
// @exclude     *.js
// @downloadURL https://update.greasyfork.org/scripts/381576/Travian%20Resource-Sum.user.js
// @updateURL https://update.greasyfork.org/scripts/381576/Travian%20Resource-Sum.meta.js
// ==/UserScript==

(function() {
    'use strict';

    //Draw production sums
    var el = $('#content #map_details table#production tbody');
    if(el.length)
    {
        let ac_village = $('#sidebarBoxVillagelist ul li.active a'),
            cv_id = 0,
            v_datas = {};

        if(localStorage.villagedatas) v_datas = JSON.parse(localStorage.villagedatas);

        let sum = 0;
        el.find('tr .num').each(function() {
            sum += parseInt($(this).text().replace('−', '-').replace(/[^0-9-]/g, ''));
        });

        if(ac_village.length)
        {
            let m = /newdid=(\d*)/gm.exec(ac_village.attr('href'));
            if(m && typeof m[1] != 'undefined' && m[1] != '')
            {
                cv_id = parseInt(m[1]);
            }
            v_datas[cv_id] = sum;
            localStorage.villagedatas = JSON.stringify(v_datas);
        }

        let html = '<tr><td colspan=2 class="res" style="padding-top: 10px">Összesen:</td><td class="num" style="padding-top: 10px">'+ sum +'</td></tr>';

        sum = 0;
        for(let id in v_datas) sum += parseInt(v_datas[id]);

        el.after(html + '<tr><td colspan=2 class="res">Faluk összesen:</td><td class="num">'+ sum +'</td></tr>');
    }

    //Build level needed resources
    var buildLevels = {
        //Favágó
        'gid1': [
            [40, 100, 50, 60, 2],
            [65, 165, 85, 100, 1],
            [110, 280, 140, 165, 1],
            [185, 465, 235, 280, 1],
            [310, 780, 390, 465, 1],
            [520, 1300, 650, 780, 2],
            [870, 2170, 1085, 1300, 2],
            [1450, 3625, 1810, 2175, 2],
            [2420, 6050, 3025, 3630, 2],
            [4040, 10105, 5050, 6060, 2],
            [6750, 16870, 8435, 10125, 2],
            [11270, 28175, 14090, 16905, 2],
            [18820, 47055, 23525, 28230, 2],
            [31430, 78580, 39290, 47150, 2],
            [52490, 131230, 65615, 78740, 2],
            [87660, 219155, 109575, 131490, 3],
            [146395, 365985, 182995, 219590, 3],
            [244480, 611195, 305600, 366715, 3],
            [408280, 1020695, 510350, 612420, 3],
            [681825, 1704565, 852280, 1022740, 3],
            [1138650, 2846620, 1423310, 1707970, 3],
            [1901540, 4753855, 2376925, 2852315, 3],
            [3175575, 7938935, 3969470, 4763360, 3],
            [5303210, 13258025, 6629015, 7954815, 3],
            [8856360, 22140900, 11070450, 13284540, 3]
        ],
        //Agyagbánya
        'gid2': [
            [80, 40, 80, 50, 2],
            [135, 65, 135, 85, 1],
            [225, 110, 225, 140, 1],
            [375, 185, 375, 235, 1],
            [620, 310, 620, 390, 1],
            [1040, 520, 1040, 650, 2],
            [1735, 870, 1735, 1085, 2],
            [2900, 1450, 2900, 1810, 2],
            [4840, 2420, 4840, 3025, 2],
            [8080, 4040, 8080, 5050, 2],
            [13500, 6750, 13500, 8435, 2],
            [22540, 11270, 22540, 14090, 2],
            [37645, 18820, 37645, 23525, 2],
            [62865, 31430, 62865, 39290, 2],
            [104985, 52490, 104985, 65615, 2],
            [175320, 87660, 175320, 109575, 3],
            [292790, 146395, 292790, 182995, 3],
            [488955, 244480, 488955, 305600, 3],
            [816555, 408280, 816555, 510350, 3],
            [1363650, 681825, 1363650, 852280, 3],
            [2277295, 1138650, 2277295, 1423310, 3],
            [3803085, 1901540, 3803085, 2376925, 3],
            [6351150, 3175575, 6351150, 3969470, 3],
            [10606420, 5303210, 10606420, 6629015, 3],
            [17712720, 8856360, 17712720, 11070450, 3]
        ],
        //Vasércbánya
        'gid3': [
            [100, 80, 30, 60, 3],
            [165, 135, 50, 100, 2],
            [280, 225, 85, 165, 2],
            [465, 375, 140, 280, 2],
            [780, 620, 235, 465, 2],
            [1300, 1040, 390, 780, 2],
            [2170, 1735, 650, 1300, 2],
            [3625, 2900, 1085, 2175, 2],
            [6050, 4840, 1815, 3630, 2],
            [10105, 8080, 3030, 6060, 2],
            [16870, 13500, 5060, 10125, 3],
            [28175, 22540, 8455, 16905, 3],
            [47055, 37645, 14115, 28230, 3],
            [78580, 62865, 23575, 47150, 3],
            [131230, 104985, 39370, 78740, 3],
            [219155, 175320, 65745, 131490, 3],
            [365985, 292790, 109795, 219590, 3],
            [611195, 488955, 183360, 366715, 3],
            [1020695, 816555, 306210, 612420, 3],
            [1704565, 1363650, 511370, 1022740, 3],
            [2846620, 2277295, 853985, 1707970, 4],
            [4753855, 3803085, 1426155, 2852315, 4],
            [7938935, 6351150, 2381680, 4763360, 4],
            [13258025, 10606420, 3977410, 7954815, 4],
            [22140900, 17712720, 6642270, 13284540, 4]
        ],
        //Búzamező
        'gid4': [
            [70, 90, 70, 20, 0],
            [115, 150, 115, 35, 0],
            [195, 250, 195, 55, 0],
            [325, 420, 325, 95, 0],
            [545, 700, 545, 155, 0],
            [910, 1170, 910, 260, 1],
            [1520, 1950, 1520, 435, 1],
            [2535, 3260, 2535, 725, 1],
            [4235, 5445, 4235, 1210, 1],
            [7070, 9095, 7070, 2020, 1],
            [11810, 15185, 11810, 3375, 1],
            [19725, 25360, 19725, 5635, 1],
            [32940, 42350, 32940, 9410, 1],
            [55005, 70720, 55005, 15715, 1],
            [91860, 118105, 91860, 26245, 1],
            [153405, 197240, 153405, 43830, 2],
            [256190, 329385, 256190, 73195, 2],
            [427835, 550075, 427835, 122240, 2],
            [714485, 918625, 714485, 204140, 2],
            [1193195, 1534105, 1193195, 340915, 2],
            [1992635, 2561960, 1992635, 569325, 2],
            [3327700, 4278470, 3327700, 950770, 2],
            [5557255, 7145045, 5557255, 1587785, 2],
            [9280620, 11932225, 9280620, 2651605, 2],
            [15498630, 19926810, 15498630, 4428180, 2]
        ],
        //Fűrészmalom
        'gid5': [
            [520, 380, 290, 90, 4],
            [935, 685, 520, 160, 2],
            [1685, 1230, 940, 290, 2],
            [3035, 2215, 1690, 525, 2],
            [5460, 3990, 3045, 945, 2]
        ],
        //Agyagégető
        'gid6': [
            [440, 480, 320, 50, 3],
            [790, 865, 575, 90, 2],
            [1425, 1555, 1035, 160, 2],
            [2565, 2800, 1865, 290, 2],
            [4620, 5040, 3360, 525, 2]
        ],
        //Vasöntöde
        'gid7': [
            [200, 450, 510, 120, 6],
            [360, 810, 920, 215, 3],
            [650, 1460, 1650, 390, 3],
            [1165, 2625, 2975, 700, 3],
            [2100, 4725, 5355, 1260, 3]
        ],
        //Malom
        'gid8': [
            [500, 440, 380, 1240, 3],
            [900, 790, 685, 2230, 2],
            [1620, 1425, 1230, 4020, 2],
            [2915, 2565, 2215, 7230, 2],
            [5250, 4620, 3990, 13015, 2]
        ],
        //Pékség
        'gid9': [
            [1200, 1480, 870, 1600, 4],
            [2160, 2665, 1565, 2880, 2],
            [3890, 4795, 2820, 5185, 2],
            [7000, 8630, 5075, 9330, 2],
            [12595, 15535, 9135, 16795, 2]
        ],
        //Raktár
        'gid10': [
            [130, 160, 90, 40, 1],
            [165, 205, 115, 50, 1],
            [215, 260, 145, 65, 1],
            [275, 335, 190, 85, 1],
            [350, 430, 240, 105, 1],
            [445, 550, 310, 135, 1],
            [570, 705, 395, 175, 1],
            [730, 900, 505, 225, 1],
            [935, 1155, 650, 290, 1],
            [1200, 1475, 830, 370, 1],
            [1535, 1890, 1065, 470, 2],
            [1965, 2420, 1360, 605, 2],
            [2515, 3095, 1740, 775, 2],
            [3220, 3960, 2230, 990, 2],
            [4120, 5070, 2850, 1270, 2],
            [5275, 6490, 3650, 1625, 2],
            [6750, 8310, 4675, 2075, 2],
            [8640, 10635, 5980, 2660, 2],
            [11060, 13610, 7655, 3405, 2],
            [14155, 17420, 9800, 4355, 2]
        ],
        //Magtár
        'gid11': [
            [80, 100, 70, 20, 1],
            [100, 130, 90, 25, 1],
            [130, 165, 115, 35, 1],
            [170, 210, 145, 40, 1],
            [215, 270, 190, 55, 1],
            [275, 345, 240, 70, 1],
            [350, 440, 310, 90, 1],
            [450, 565, 395, 115, 1],
            [575, 720, 505, 145, 1],
            [740, 920, 645, 185, 1],
            [945, 1180, 825, 235, 2],
            [1210, 1510, 1060, 300, 2],
            [1545, 1935, 1355, 385, 2],
            [1980, 2475, 1735, 495, 2],
            [2535, 3170, 2220, 635, 2],
            [3245, 4055, 2840, 810, 2],
            [4155, 5190, 3635, 1040, 2],
            [5315, 6645, 4650, 1330, 2],
            [6805, 8505, 5955, 1700, 2],
            [8710, 10890, 7620, 2180, 2]
        ],
        //Páncélkovács
        'gid13': [
            [180, 250, 500, 160, 4],
            [230, 320, 640, 205, 2],
            [295, 410, 820, 260, 2],
            [375, 525, 1050, 335, 2],
            [485, 670, 1340, 430, 2],
            [620, 860, 1720, 550, 3],
            [790, 1100, 2200, 705, 3],
            [1015, 1405, 2815, 900, 3],
            [1295, 1800, 3605, 1155, 3],
            [1660, 2305, 4610, 1475, 3],
            [2125, 2950, 5905, 1890, 3],
            [2720, 3780, 7555, 2420, 3],
            [3480, 4835, 9670, 3095, 3],
            [4455, 6190, 12380, 3960, 3],
            [5705, 7925, 15845, 5070, 3],
            [7300, 10140, 20280, 6490, 4],
            [9345, 12980, 25960, 8310, 4],
            [11965, 16615, 33230, 10635, 4],
            [15315, 21270, 42535, 13610, 4],
            [19600, 27225, 54445, 17420, 4]
        ],
        //Gyekorlótér
        'gid14': [
            [1750, 2250, 1530, 240, 1],
            [2240, 2880, 1960, 305, 1],
            [2865, 3685, 2505, 395, 1],
            [3670, 4720, 3210, 505, 1],
            [4700, 6040, 4105, 645, 1],
            [6015, 7730, 5255, 825, 1],
            [7695, 9895, 6730, 1055, 1],
            [9850, 12665, 8615, 1350, 1],
            [12610, 16215, 11025, 1730, 1],
            [16140, 20755, 14110, 2215, 1],
            [20660, 26565, 18065, 2835, 2],
            [26445, 34000, 23120, 3625, 2],
            [33850, 43520, 29595, 4640, 2],
            [43330, 55705, 37880, 5940, 2],
            [55460, 71305, 48490, 7605, 2],
            [70990, 91270, 62065, 9735, 2],
            [90865, 116825, 79440, 12460, 2],
            [116305, 149540, 101685, 15950, 2],
            [148875, 191410, 130160, 20415, 2],
            [190560, 245005, 166600, 26135, 2]
        ],
        //Főépület
        'gid15': [
            [70, 40, 60, 20, 2],
            [90, 50, 75, 25, 1],
            [115, 65, 100, 35, 1],
            [145, 85, 125, 40, 1],
            [190, 105, 160, 55, 1],
            [240, 135, 205, 70, 2],
            [310, 175, 265, 90, 2],
            [395, 225, 340, 115, 2],
            [505, 290, 430, 145, 2],
            [645, 370, 555, 185, 2],
            [825, 470, 710, 235, 2],
            [1060, 605, 905, 300, 2],
            [1355, 775, 1160, 385, 2],
            [1735, 990, 1485, 495, 2],
            [2220, 1270, 1900, 635, 2],
            [2840, 1625, 2435, 810, 3],
            [3635, 2075, 3115, 1040, 3],
            [4650, 2660, 3990, 1330, 3],
            [5955, 3405, 5105, 1700, 3],
            [7620, 4355, 6535, 2180, 3]
        ],
        //Gyülekezőtér
        'gid16': [
            [110, 160, 90, 70, 1],
            [140, 205, 115, 90, 1],
            [180, 260, 145, 115, 1],
            [230, 335, 190, 145, 1],
            [295, 430, 240, 190, 1],
            [380, 550, 310, 240, 1],
            [485, 705, 395, 310, 1],
            [620, 900, 505, 395, 1],
            [795, 1155, 650, 505, 1],
            [1015, 1475, 830, 645, 1],
            [1300, 1890, 1065, 825, 2],
            [1660, 2420, 1360, 1060, 2],
            [2130, 3095, 1740, 1355, 2],
            [2725, 3960, 2230, 1735, 2],
            [3485, 5070, 2850, 2220, 2],
            [4460, 6490, 3650, 2840, 2],
            [5710, 8310, 4675, 3635, 2],
            [7310, 10635, 5980, 4650, 2],
            [9360, 13610, 7655, 5955, 2],
            [11980, 17420, 9800, 7620, 2]
        ],
        //Piac
        'gid17': [
            [80, 70, 120, 70, 4],
            [100, 90, 155, 90, 2],
            [130, 115, 195, 115, 2],
            [170, 145, 250, 145, 2],
            [215, 190, 320, 190, 2],
            [275, 240, 410, 240, 3],
            [350, 310, 530, 310, 3],
            [450, 395, 675, 395, 3],
            [575, 505, 865, 505, 3],
            [740, 645, 1105, 645, 3],
            [945, 825, 1415, 825, 3],
            [1210, 1060, 1815, 1060, 3],
            [1545, 1355, 2320, 1355, 3],
            [1980, 1735, 2970, 1735, 3],
            [2535, 2220, 3805, 2220, 3],
            [3245, 2840, 4870, 2840, 4],
            [4155, 3635, 6230, 3635, 4],
            [5315, 4650, 7975, 4650, 4],
            [6805, 5955, 10210, 5955, 4],
            [8710, 7620, 13065, 7620, 4]
        ],
        //Követség
        'gid18': [
            [180, 130, 150, 80, 3],
            [230, 165, 190, 100, 2],
            [295, 215, 245, 130, 2],
            [375, 275, 315, 170, 2],
            [485, 350, 405, 215, 2],
            [620, 445, 515, 275, 2],
            [790, 570, 660, 350, 2],
            [1015, 730, 845, 450, 2],
            [1295, 935, 1080, 575, 2],
            [1660, 1200, 1385, 740, 2],
            [2125, 1535, 1770, 945, 3],
            [2720, 1965, 2265, 1210, 3],
            [3480, 2515, 2900, 1545, 3],
            [4455, 3220, 3715, 1980, 3],
            [5705, 4120, 4755, 2535, 3],
            [7300, 5275, 6085, 3245, 3],
            [9345, 6750, 7790, 4155, 3],
            [11965, 8640, 9970, 5315, 3],
            [15315, 11060, 12760, 6805, 3],
            [19600, 14155, 16335, 8710, 3]
        ],
        //Kaszárnya
        'gid19': [
            [210, 140, 260, 120, 4],
            [270, 180, 335, 155, 2],
            [345, 230, 425, 195, 2],
            [440, 295, 545, 250, 2],
            [565, 375, 700, 320, 2],
            [720, 480, 895, 410, 3],
            [925, 615, 1145, 530, 3],
            [1180, 790, 1465, 675, 3],
            [1515, 1010, 1875, 865, 3],
            [1935, 1290, 2400, 1105, 3],
            [2480, 1655, 3070, 1415, 3],
            [3175, 2115, 3930, 1815, 3],
            [4060, 2710, 5030, 2320, 3],
            [5200, 3465, 6435, 2970, 3],
            [6655, 4435, 8240, 3805, 3],
            [8520, 5680, 10545, 4870, 4],
            [10905, 7270, 13500, 6230, 4],
            [13955, 9305, 17280, 7975, 4],
            [17865, 11910, 22120, 10210, 4],
            [22865, 15245, 28310, 13065, 4]
        ],
        //Istálló
        'gid20': [
            [260, 140, 220, 100, 5],
            [335, 180, 280, 130, 3],
            [425, 230, 360, 165, 3],
            [545, 295, 460, 210, 3],
            [700, 375, 590, 270, 3],
            [895, 480, 755, 345, 3],
            [1145, 615, 970, 440, 3],
            [1465, 790, 1240, 565, 3],
            [1875, 1010, 1585, 720, 3],
            [2400, 1290, 2030, 920, 3],
            [3070, 1655, 2595, 1180, 4],
            [3930, 2115, 3325, 1510, 4],
            [5030, 2710, 4255, 1935, 4],
            [6435, 3465, 5445, 2475, 4],
            [8240, 4435, 6970, 3170, 4],
            [10545, 5680, 8925, 4055, 4],
            [13500, 7270, 11425, 5190, 4],
            [17280, 9305, 14620, 6645, 4],
            [22120, 11910, 18715, 8505, 4],
            [28310, 15245, 23955, 10890, 4]
        ],
        //Műhely
        'gid21': [
            [460, 510, 600, 320, 3],
            [590, 655, 770, 410, 2],
            [755, 835, 985, 525, 2],
            [965, 1070, 1260, 670, 2],
            [1235, 1370, 1610, 860, 2],
            [1580, 1750, 2060, 1100, 2],
            [2025, 2245, 2640, 1405, 2],
            [2590, 2870, 3380, 1800, 2],
            [3315, 3675, 4325, 2305, 2],
            [4245, 4705, 5535, 2950, 2],
            [5430, 6020, 7085, 3780, 3],
            [6950, 7705, 9065, 4835, 3],
            [8900, 9865, 11605, 6190, 3],
            [11390, 12625, 14855, 7925, 3],
            [14580, 16165, 19015, 10140, 3],
            [18660, 20690, 24340, 12980, 3],
            [23885, 26480, 31155, 16615, 3],
            [30570, 33895, 39875, 21270, 3],
            [39130, 43385, 51040, 27225, 3],
            [50090, 55535, 65335, 34845, 3]
        ],
        //Akadémia
        'gid22': [
            [220, 160, 90, 40, 4],
            [280, 205, 115, 50, 2],
            [360, 260, 145, 65, 2],
            [460, 335, 190, 85, 2],
            [590, 430, 240, 105, 2],
            [755, 550, 310, 135, 3],
            [970, 705, 395, 175, 3],
            [1240, 900, 505, 225, 3],
            [1585, 1155, 650, 290, 3],
            [2030, 1475, 830, 370, 3],
            [2595, 1890, 1065, 470, 3],
            [3325, 2420, 1360, 605, 3],
            [4255, 3095, 1740, 775, 3],
            [5445, 3960, 2230, 990, 3],
            [6970, 5070, 2850, 1270, 3],
            [8925, 6490, 3650, 1625, 4],
            [11425, 8310, 4675, 2075, 4],
            [14620, 10635, 5980, 2660, 4],
            [18715, 13610, 7655, 3405, 4],
            [23955, 17420, 9800, 4355, 4]
        ],
        //Rejtekhely
        'gid23': [
            [40, 50, 30, 10, 0],
            [50, 65, 40, 15, 0],
            [65, 80, 50, 15, 0],
            [85, 105, 65, 20, 0],
            [105, 135, 80, 25, 0],
            [135, 170, 105, 35, 1],
            [175, 220, 130, 45, 1],
            [225, 280, 170, 55, 1],
            [290, 360, 215, 70, 1],
            [370, 460, 275, 90, 1]
        ],
        //Főépület
        'gid24': [
            [1250, 1110, 1260, 600, 4],
            [1600, 1420, 1615, 770, 2],
            [2050, 1820, 2065, 985, 2],
            [2620, 2330, 2640, 1260, 2],
            [3355, 2980, 3380, 1610, 2],
            [4295, 3815, 4330, 2060, 3],
            [5500, 4880, 5540, 2640, 3],
            [7035, 6250, 7095, 3380, 3],
            [9005, 8000, 9080, 4325, 3],
            [11530, 10240, 11620, 5535, 3],
            [14755, 13105, 14875, 7085, 3],
            [18890, 16775, 19040, 9065, 3],
            [24180, 21470, 24370, 11605, 3],
            [30950, 27480, 31195, 14855, 3],
            [39615, 35175, 39930, 19015, 3],
            [50705, 45025, 51110, 24340, 4],
            [64905, 57635, 65425, 31155, 4],
            [83075, 73770, 83740, 39875, 4],
            [106340, 94430, 107190, 51040, 4],
            [136115, 120870, 137200, 65335, 4]
        ],
        //Rezidencia
        'gid25': [
            [580, 460, 350, 180, 1],
            [740, 590, 450, 230, 1],
            [950, 755, 575, 295, 1],
            [1215, 965, 735, 375, 1],
            [1555, 1235, 940, 485, 1],
            [1995, 1580, 1205, 620, 1],
            [2550, 2025, 1540, 790, 1],
            [3265, 2590, 1970, 1015, 1],
            [4180, 3315, 2520, 1295, 1],
            [5350, 4245, 3230, 1660, 1],
            [6845, 5430, 4130, 2125, 2],
            [8765, 6950, 5290, 2720, 2],
            [11220, 8900, 6770, 3480, 2],
            [14360, 11390, 8665, 4455, 2],
            [18380, 14580, 11090, 5705, 2],
            [23530, 18660, 14200, 7300, 2],
            [30115, 23885, 18175, 9345, 2],
            [38550, 30570, 23260, 11965, 2],
            [49340, 39130, 29775, 15315, 2],
            [63155, 50090, 38110, 19600, 2]
        ],
        //Palota
        'gid26': [
            [550, 800, 750, 250, 1],
            [705, 1025, 960, 320, 1],
            [900, 1310, 1230, 410, 1],
            [1155, 1680, 1575, 525, 1],
            [1475, 2145, 2015, 670, 1],
            [1890, 2750, 2575, 860, 1],
            [2420, 3520, 3300, 1100, 1],
            [3095, 4505, 4220, 1405, 1],
            [3965, 5765, 5405, 1800, 1],
            [5075, 7380, 6920, 2305, 1],
            [6495, 9445, 8855, 2950, 2],
            [8310, 12090, 11335, 3780, 2],
            [10640, 15475, 14505, 4835, 2],
            [13615, 19805, 18570, 6190, 2],
            [17430, 25355, 23770, 7925, 2],
            [22310, 32450, 30425, 10140, 2],
            [28560, 41540, 38940, 12980, 2],
            [36555, 53170, 49845, 16615, 2],
            [46790, 68055, 63805, 21270, 2],
            [59890, 87110, 81670, 27225, 2]
        ],
        //Kincstár
        'gid27': [
            [2880, 2740, 2580, 990, 4],
            [3630, 3450, 3250, 1245, 2],
            [4570, 4350, 4095, 1570, 2],
            [5760, 5480, 5160, 1980, 2],
            [7260, 6905, 6505, 2495, 2],
            [9145, 8700, 8195, 3145, 3],
            [11525, 10965, 10325, 3960, 3],
            [14520, 13815, 13010, 4990, 3],
            [18295, 17405, 16390, 6290, 3],
            [23055, 21930, 20650, 7925, 3],
            [29045, 27635, 26020, 9985, 3],
            [36600, 34820, 32785, 12580, 3],
            [46115, 43875, 41310, 15850, 3],
            [58105, 55280, 52050, 19975, 3],
            [73210, 69655, 65585, 25165, 3],
            [92245, 87760, 82640, 31710, 4],
            [116230, 110580, 104125, 39955, 4],
            [146450, 139330, 131195, 50340, 4],
            [184530, 175560, 165305, 63430, 4],
            [232505, 221205, 208285, 79925, 4]
        ],
        //Kereskedelmi központ
        'gid28': [
            [1400, 1330, 1200, 400, 3],
            [1790, 1700, 1535, 510, 2],
            [2295, 2180, 1965, 655, 2],
            [2935, 2790, 2515, 840, 2],
            [3760, 3570, 3220, 1075, 2],
            [4810, 4570, 4125, 1375, 2],
            [6155, 5850, 5280, 1760, 2],
            [7880, 7485, 6755, 2250, 2],
            [10090, 9585, 8645, 2880, 2],
            [12915, 12265, 11070, 3690, 2],
            [16530, 15700, 14165, 4720, 3],
            [21155, 20100, 18135, 6045, 3],
            [27080, 25725, 23210, 7735, 3],
            [34660, 32930, 29710, 9905, 3],
            [44370, 42150, 38030, 12675, 3],
            [56790, 53950, 48680, 16225, 3],
            [72690, 69060, 62310, 20770, 3],
            [93045, 88395, 79755, 26585, 3],
            [119100, 113145, 102085, 34030, 3],
            [152445, 144825, 130670, 43555, 3]
        ],
        //Nagy kaszárnya
        'gid29': [
            [630, 420, 780, 360, 4],
            [805, 540, 1000, 460, 2],
            [1030, 690, 1280, 590, 2],
            [1320, 880, 1635, 755, 2],
            [1690, 1125, 2095, 965, 2],
            [2165, 1445, 2680, 1235, 3],
            [2770, 1845, 3430, 1585, 3],
            [3545, 2365, 4390, 2025, 3],
            [4540, 3025, 5620, 2595, 3],
            [5810, 3875, 7195, 3320, 3],
            [7440, 4960, 9210, 4250, 3],
            [9520, 6345, 11785, 5440, 3],
            [12185, 8125, 15085, 6965, 3],
            [15600, 10400, 19310, 8915, 3],
            [19965, 13310, 24720, 11410, 3],
            [25555, 17035, 31640, 14605, 4],
            [32710, 21810, 40500, 18690, 4],
            [41870, 27915, 51840, 23925, 4],
            [53595, 35730, 66355, 30625, 4],
            [68600, 45735, 84935, 39200, 4]
        ],
        //Nagy istálló
        'gid30': [
            [780, 420, 660, 300, 5],
            [1000, 540, 845, 385, 3],
            [1280, 690, 1080, 490, 3],
            [1635, 880, 1385, 630, 3],
            [2095, 1125, 1770, 805, 3],
            [2680, 1445, 2270, 1030, 3],
            [3430, 1845, 2905, 1320, 3],
            [4390, 2365, 3715, 1690, 3],
            [5620, 3025, 4755, 2160, 3],
            [7195, 3875, 6085, 2765, 3],
            [9210, 4960, 7790, 3540, 4],
            [11785, 6345, 9975, 4535, 4],
            [15085, 8125, 12765, 5805, 4],
            [19310, 10400, 16340, 7430, 4],
            [24720, 13310, 20915, 9505, 4],
            [31640, 17035, 26775, 12170, 4],
            [40500, 21810, 34270, 15575, 4],
            [51840, 27915, 43865, 19940, 4],
            [66355, 35730, 56145, 25520, 4],
            [84935, 45735, 71870, 32665, 4]
        ],
        //Kőfal
        'gid31': [
            [70, 90, 170, 70, 0],
            [90, 115, 220, 90, 0],
            [115, 145, 280, 115, 0],
            [145, 190, 355, 145, 0],
            [190, 240, 455, 190, 0],
            [240, 310, 585, 240, 1],
            [310, 395, 750, 310, 1],
            [395, 505, 955, 395, 1],
            [505, 650, 1225, 505, 1],
            [645, 830, 1570, 645, 1],
            [825, 1065, 2005, 825, 1],
            [1060, 1360, 2570, 1060, 1],
            [1355, 1740, 3290, 1355, 1],
            [1735, 2230, 4210, 1735, 1],
            [2220, 2850, 5390, 2220, 1],
            [2840, 3650, 6895, 2840, 2],
            [3635, 4675, 8825, 3635, 2],
            [4650, 5980, 11300, 4650, 2],
            [5955, 7655, 14460, 5955, 2],
            [7620, 9800, 18510, 7620, 2]
        ],
        //Földfal
        'gid32': [
            [120, 200, 0, 80, 0],
            [155, 255, 0, 100, 0],
            [195, 330, 0, 130, 0],
            [250, 420, 0, 170, 0],
            [320, 535, 0, 215, 0],
            [410, 685, 0, 275, 1],
            [530, 880, 0, 350, 1],
            [675, 1125, 0, 450, 1],
            [865, 1440, 0, 575, 1],
            [1105, 1845, 0, 740, 1],
            [1415, 2360, 0, 945, 1],
            [1815, 3020, 0, 1210, 1],
            [2320, 3870, 0, 1545, 1],
            [2970, 4950, 0, 1980, 1],
            [3805, 6340, 0, 2535, 1],
            [4870, 8115, 0, 3245, 2],
            [6230, 10385, 0, 4155, 2],
            [7975, 13290, 0, 5315, 2],
            [10210, 17015, 0, 6805, 2],
            [13065, 21780, 0, 8710, 2]
        ],
        //Cölöpfal
        'gid33': [
            [160, 100, 80, 60, 0],
            [205, 130, 100, 75, 0],
            [260, 165, 130, 100, 0],
            [335, 210, 170, 125, 0],
            [430, 270, 215, 160, 0],
            [550, 345, 275, 205, 1],
            [705, 440, 350, 265, 1],
            [900, 565, 450, 340, 1],
            [1155, 720, 575, 430, 1],
            [1475, 920, 740, 555, 1],
            [1890, 1180, 945, 710, 1],
            [2420, 1510, 1210, 905, 1],
            [3095, 1935, 1545, 1160, 1],
            [3960, 2475, 1980, 1485, 1],
            [5070, 3170, 2535, 1900, 1],
            [6490, 4055, 3245, 2435, 2],
            [8310, 5190, 4155, 3115, 2],
            [10635, 6645, 5315, 3990, 2],
            [13610, 8505, 6805, 5105, 2],
            [17420, 10890, 8710, 6535, 2]
        ],
        //Kőfaragó
        'gid34': [
            [155, 130, 125, 70, 2],
            [200, 165, 160, 90, 1],
            [255, 215, 205, 115, 1],
            [325, 275, 260, 145, 1],
            [415, 350, 335, 190, 1],
            [535, 445, 430, 240, 2],
            [680, 570, 550, 310, 2],
            [875, 730, 705, 395, 2],
            [1115, 935, 900, 505, 2],
            [1430, 1200, 1155, 645, 2],
            [1830, 1535, 1475, 825, 2],
            [2340, 1965, 1890, 1060, 2],
            [3000, 2515, 2420, 1355, 2],
            [3840, 3220, 3095, 1735, 2],
            [4910, 4120, 3960, 2220, 2],
            [6290, 5275, 5070, 2840, 3],
            [8050, 6750, 6490, 3635, 3],
            [10300, 8640, 8310, 4650, 3],
            [13185, 11060, 10635, 5955, 3],
            [16880, 14155, 13610, 7620, 3]
        ],
        //Sörfőzde
        'gid35': [
            [1460, 930, 1250, 1740, 6],
            [2045, 1300, 1750, 2435, 3],
            [2860, 1825, 2450, 3410, 3],
            [4005, 2550, 3430, 4775, 3],
            [5610, 3575, 4800, 6685, 3],
            [7850, 5000, 6725, 9360, 4],
            [10995, 7000, 9410, 13100, 4],
            [15390, 9805, 13175, 18340, 4],
            [21545, 13725, 18445, 25680, 4],
            [30165, 19215, 25825, 35950, 4]
        ],
        //Csapdakészítő
        'gid36': [
            [80, 120, 70, 90, 4],
            [100, 155, 90, 115, 2],
            [130, 195, 115, 145, 2],
            [170, 250, 145, 190, 2],
            [215, 320, 190, 240, 2],
            [275, 410, 240, 310, 3],
            [350, 530, 310, 395, 3],
            [450, 675, 395, 505, 3],
            [575, 865, 505, 650, 3],
            [740, 1105, 645, 830, 3],
            [945, 1415, 825, 1065, 3],
            [1210, 1815, 1060, 1360, 3],
            [1545, 2320, 1355, 1740, 3],
            [1980, 2970, 1735, 2230, 3],
            [2535, 3805, 2220, 2850, 3],
            [3245, 4870, 2840, 3650, 4],
            [4155, 6230, 3635, 4675, 4],
            [5315, 7975, 4650, 5980, 4],
            [6805, 10210, 5955, 7655, 4],
            [8710, 13065, 7620, 9800, 4]
        ],
        //Hősök háza
        'gid37': [
            [700, 670, 700, 240, 2],
            [930, 890, 930, 320, 1],
            [1240, 1185, 1240, 425, 1],
            [1645, 1575, 1645, 565, 1],
            [2190, 2095, 2190, 750, 1],
            [2915, 2790, 2915, 1000, 2],
            [3875, 3710, 3875, 1330, 2],
            [5155, 4930, 5155, 1765, 2],
            [6855, 6560, 6855, 2350, 2],
            [9115, 8725, 9115, 3125, 2],
            [12125, 11605, 12125, 4155, 2],
            [16125, 15435, 16125, 5530, 2],
            [21445, 20525, 21445, 7350, 2],
            [28520, 27300, 28520, 9780, 2],
            [37935, 36310, 37935, 13005, 2],
            [50450, 48290, 50450, 17300, 3],
            [67100, 64225, 67100, 23005, 3],
            [89245, 85420, 89245, 30600, 3],
            [118695, 113605, 118695, 40695, 3],
            [157865, 151095, 157865, 54125, 3]
        ],
        //Nagy raktár
        'gid38': [
            [650, 800, 450, 200, 1],
            [830, 1025, 575, 255, 1],
            [1065, 1310, 735, 330, 1],
            [1365, 1680, 945, 420, 1],
            [1745, 2145, 1210, 535, 1],
            [2235, 2750, 1545, 685, 1],
            [2860, 3520, 1980, 880, 1],
            [3660, 4505, 2535, 1125, 1],
            [4685, 5765, 3245, 1440, 1],
            [5995, 7380, 4150, 1845, 1],
            [7675, 9445, 5315, 2360, 2],
            [9825, 12090, 6800, 3020, 2],
            [12575, 15475, 8705, 3870, 2],
            [16095, 19805, 11140, 4950, 2],
            [20600, 25355, 14260, 6340, 2],
            [26365, 32450, 18255, 8115, 2],
            [33750, 41540, 23365, 10385, 2],
            [43200, 53170, 29910, 13290, 2],
            [55295, 68055, 38280, 17015, 2],
            [70780, 87110, 49000, 21780, 2]
        ],
        //Nagy magtár
        'gid39': [
            [400, 500, 350, 100, 1],
            [510, 640, 450, 130, 1],
            [655, 820, 575, 165, 1],
            [840, 1050, 735, 210, 1],
            [1075, 1340, 940, 270, 1],
            [1375, 1720, 1205, 345, 1],
            [1760, 2200, 1540, 440, 1],
            [2250, 2815, 1970, 565, 1],
            [2880, 3605, 2520, 720, 1],
            [3690, 4610, 3230, 920, 1],
            [4720, 5905, 4130, 1180, 2],
            [6045, 7555, 5290, 1510, 2],
            [7735, 9670, 6770, 1935, 2],
            [9905, 12380, 8665, 2475, 2],
            [12675, 15845, 11090, 3170, 2],
            [16225, 20280, 14200, 4055, 2],
            [20770, 25960, 18175, 5190, 2],
            [26585, 33230, 23260, 6645, 2],
            [34030, 42535, 29775, 8505, 2],
            [43555, 54445, 38110, 10890, 2]
        ],
        //Világcsoda
        'gid40': [
            [66700, 69050, 72200, 13200, 1],
            [68535, 70950, 74185, 13565, 1],
            [70420, 72900, 76225, 13935, 1],
            [72355, 74905, 78320, 14320, 1],
            [74345, 76965, 80475, 14715, 1],
            [76390, 79080, 82690, 15120, 1],
            [78490, 81255, 84965, 15535, 1],
            [80650, 83490, 87300, 15960, 1],
            [82865, 85785, 89700, 16400, 1],
            [85145, 88145, 92165, 16850, 1],
            [87485, 90570, 94700, 17315, 2],
            [89895, 93060, 97305, 17790, 2],
            [92365, 95620, 99980, 18280, 2],
            [94905, 98250, 102730, 18780, 2],
            [97515, 100950, 105555, 19300, 2],
            [100195, 103725, 108460, 19830, 2],
            [102950, 106580, 111440, 20375, 2],
            [105785, 109510, 114505, 20935, 2],
            [108690, 112520, 117655, 21510, 2],
            [111680, 115615, 120890, 22100, 2],
            [114755, 118795, 124215, 22710, 3],
            [117910, 122060, 127630, 23335, 3],
            [121150, 125420, 131140, 23975, 3],
            [124480, 128870, 134745, 24635, 3],
            [127905, 132410, 138455, 25315, 3],
            [131425, 136055, 142260, 26010, 3],
            [135035, 139795, 146170, 26725, 3],
            [138750, 143640, 150190, 27460, 3],
            [142565, 147590, 154320, 28215, 3],
            [146485, 151650, 158565, 28990, 3],
            [150515, 155820, 162925, 29785, 4],
            [154655, 160105, 167405, 30605, 4],
            [158910, 164505, 172010, 31450, 4],
            [163275, 169030, 176740, 32315, 4],
            [167770, 173680, 181600, 33200, 4],
            [172380, 178455, 186595, 34115, 4],
            [177120, 183360, 191725, 35055, 4],
            [181995, 188405, 197000, 36015, 4],
            [186995, 193585, 202415, 37005, 4],
            [192140, 198910, 207985, 38025, 4],
            [197425, 204380, 213705, 39070, 5],
            [202855, 210000, 219580, 40145, 5],
            [208430, 215775, 225620, 41250, 5],
            [214165, 221710, 231825, 42385, 5],
            [220055, 227805, 238200, 43550, 5],
            [226105, 234070, 244750, 44745, 5],
            [232320, 240505, 251480, 45975, 5],
            [238710, 247120, 258395, 47240, 5],
            [245275, 253915, 265500, 48540, 5],
            [252020, 260900, 272800, 49875, 5],
            [258950, 268075, 280305, 51245, 6],
            [266070, 275445, 288010, 52655, 6],
            [273390, 283020, 295930, 54105, 6],
            [280905, 290805, 304070, 55590, 6],
            [288630, 298800, 312430, 57120, 6],
            [296570, 307020, 321025, 58690, 6],
            [304725, 315460, 329850, 60305, 6],
            [313105, 324135, 338925, 61965, 6],
            [321715, 333050, 348245, 63670, 6],
            [330565, 342210, 357820, 65420, 6],
            [339655, 351620, 367660, 67220, 7],
            [348995, 361290, 377770, 69065, 7],
            [358590, 371225, 388160, 70965, 7],
            [368450, 381435, 398835, 72915, 7],
            [378585, 391925, 409800, 74920, 7],
            [388995, 402700, 421070, 76985, 7],
            [399695, 413775, 432650, 79100, 7],
            [410685, 425155, 444550, 81275, 7],
            [421980, 436845, 456775, 83510, 7],
            [433585, 448860, 469335, 85805, 7],
            [445505, 461205, 482240, 88165, 8],
            [457760, 473885, 495505, 90590, 8],
            [470345, 486920, 509130, 93080, 8],
            [483280, 500310, 523130, 95640, 8],
            [496570, 514065, 537520, 98270, 8],
            [510225, 528205, 552300, 100975, 8],
            [524260, 542730, 567490, 103750, 8],
            [538675, 557655, 583095, 106605, 8],
            [553490, 572990, 599130, 109535, 8],
            [568710, 588745, 615605, 112550, 8],
            [584350, 604935, 632535, 115645, 9],
            [600420, 621575, 649930, 118825, 9],
            [616930, 638665, 667800, 122090, 9],
            [633895, 656230, 686165, 125450, 9],
            [651330, 674275, 705035, 128900, 9],
            [669240, 692820, 724425, 132445, 9],
            [687645, 711870, 744345, 136085, 9],
            [706555, 731445, 764815, 139830, 9],
            [725985, 751560, 785850, 143675, 9],
            [745950, 772230, 807460, 147625, 9],
            [766460, 793465, 829665, 151685, 10],
            [787540, 815285, 852480, 155855, 10],
            [809195, 837705, 875920, 160140, 10],
            [831450, 860745, 900010, 164545, 10],
            [854315, 884415, 924760, 169070, 10],
            [877810, 908735, 950190, 173720, 10],
            [901950, 933725, 976320, 178495, 10],
            [926750, 959405, 1000000, 183405, 10],
            [952235, 985785, 1000000, 188450, 10],
            [1000000, 1000000, 1000000, 193630, 10]
        ],
        //Lóitató
        'gid41': [
            [780, 420, 660, 540, 5],
            [1000, 540, 845, 690, 3],
            [1280, 690, 1080, 885, 3],
            [1635, 880, 1385, 1130, 3],
            [2095, 1125, 1770, 1450, 3],
            [2680, 1445, 2270, 1855, 3],
            [3430, 1845, 2905, 2375, 3],
            [4390, 2365, 3715, 3040, 3],
            [5620, 3025, 4755, 3890, 3],
            [7195, 3875, 6085, 4980, 3],
            [9210, 4960, 7790, 6375, 4],
            [11785, 6345, 9975, 8160, 4],
            [15085, 8125, 12765, 10445, 4],
            [19310, 10400, 16340, 13370, 4],
            [24720, 13310, 20915, 17115, 4],
            [31640, 17035, 26775, 21905, 4],
            [40500, 21810, 34270, 28040, 4],
            [51840, 27915, 43865, 35890, 4],
            [66355, 35730, 56145, 45940, 4],
            [84935, 45735, 71870, 58800, 4]
        ]
    };

    //Draw more levels
    var el = $('#build');
    if(el.length && el.attr('class').indexOf('gid') != -1 && el.find('.upgradeBuilding').length)
    {
        let box = $('<div class="buildingDescription" style="position: relative; top: -3px;border: solid 1px #A1BC79;margin-bottom:20px"><div class="headline" style="border-top: 0;border-left:0;border-right:0"><div class="openedClosedSwitch switchClosed"></div><h4>További szintek költségei</h4></div><div class="description2" style="padding: 10px"></div></div>');
        el.find('.upgradeBuilding').css('margin-bottom', '0').after(box);

        let temp = el.attr('class').split(' '),
            lvl = parseInt(temp[1].replace('level', '')),
            gid = parseInt(temp[0].replace('gid', '')),
            levels = buildLevels[temp[0]];

        if(typeof levels != "undefined") for(let i = lvl;i < levels.length;i++)
        {
            if(gid < 5 && i > 19) continue;

            let resBox = $('<div class="resourceWrapper noSum" style="display: block"><span style="display: inline-block; width: 55px">'+ (i+1) +'.szint</span><div class="inlineIcon resource"><i class="r1"></i><span class="value value">'+ levels[i][0] +'</span></div><div class="inlineIcon resource"><i class="r2"></i><span class="value value">'+ levels[i][1] +'</span></div><div class="inlineIcon resource"><i class="r3"></i><span class="value value">'+ levels[i][2] +'</span></div><div class="inlineIcon resource"><i class="r4"></i><span class="value value">'+ levels[i][3] +'</span></div><div class="inlineIcon resource"><i class="cropConsumption"></i><span class="value value">'+ levels[i][4] +'</span></div><img style="height: 16px;cursor: pointer;position:relative;top:2px;opacity:0.5" title="Nyersanyag összesítőbe" src="https://cdn0.iconfinder.com/data/icons/zondicons/20/calculator-128.png" /></div>');
            box.find('.description2').append(resBox);
            resBox.find('.resource').css({ 'width': '75px', 'display': 'inline-block' });
            resBox.find('.resource i').css({ 'position': 'relative', 'top': '1px' });
            resBox.find('.resource').last().css('width', 'auto');
            resBox.find('img').hover(function() { $(this).css('opacity', 1) }, function() { $(this).css('opacity', 0.5) }).on('click', function() {
                $(this).parent().find('.resource .value').each(function(i) {
                    if(i < 4) addResourceToSum(i + 1, parseInt($(this).html().replace(/ /g, '')));
                });
                return false;
            });
        }

        //Open close
        box.find('.description2').hide();
        box.find('.headline').css('border-bottom-width', 0);
        box.find('.openedClosedSwitch').on('click', function() {
            if($(this).hasClass('switchOpened'))
            {
                $(this).removeClass('switchOpened').addClass('switchClosed');
                box.find('.description2').hide();
                box.find('.headline').css('border-bottom-width', 0);
            }
            else
            {
                $(this).removeClass('switchClosed').addClass('switchOpened');
                box.find('.description2').show();
                box.find('.headline').css('border-bottom-width', '1px');
            }
            return false;
        });
    }

    //Draw box
    {
    var box = $('<div id="sidebarResourceSum" class="sidebarBox" style="margin-top: 50px"><div class="sidebarBoxBaseBox"><div class="baseBox baseBoxTop"><div class="baseBox baseBoxBottom"><div class="baseBox baseBoxCenter"></div></div></div></div><div class="sidebarBoxInnerBox"><div class="innerBox header"><div class="boxTitle" style="margin-top: 10px">Nyersanyag összesítő</div></div><div class="innerBox content rescontent"></div><div class="innerBox footer"></div></div></div>'),
        content = box.find('.rescontent'),
        resWrapper = $('<div class="inlineIconList resourceWrapper"></div>'),
        reses = [],
        addResourceToSum = function(i, count) {
            localStorage['resourceSumR'+ i] = parseInt(localStorage['resourceSumR'+ i]) + count;
            reses[i].find('.value').html(localStorage['resourceSumR'+ i]);

            sum += count;
            sumBlock.find('b').html(sum);
        },
        bottomBlock = $('<div style="display: block; padding-left: 0px; padding-top: 5px"></div>'),
        sumBlock = $('<span style="margin-right: 10px">Összesen: <b>0</b></span>'),
        sum = 0;

    for(let i = 1;i <= 4;i++)
    {
        if(!localStorage['resourceSumR'+ i]) localStorage['resourceSumR'+ i] = 0;
        let v = parseInt(localStorage['resourceSumR'+ i]);

        sum += v;

        reses[i] = $('<div class="inlineIcon resource"><i class="r'+ i +'"></i><span class="value value">'+ v +'</span></div>');
        reses[i].css('margin-right', '5px');
        resWrapper.append(reses[i]);
    }

    bottomBlock.append(sumBlock);
    sumBlock.find('b').html(sum);

    box.css('width', '350px');
    content.append(resWrapper).append(bottomBlock);
    $('#sidebarAfterContent').append(box);
    }

    //Draw reset button
    var resetButton = $('<a style="user-select: none">Nulláz</a>');
    resetButton.on('click', function() {
        for(let i = 1;i <= 4;i++)
        {
            localStorage['resourceSumR'+ i] = 0;
            reses[i].find('.value').html(0);
        }
        sum = 0;
        sumBlock.find('b').html(sum);
        return false;
    });
    bottomBlock.append(resetButton);

    //Draw allocation button
    var allocButton = $('<a style="user-select: none;float: right">Eloszt</a>');
    allocButton.on('click', function() {
        new Travian.Dialog.Ajax({
            "cssClass":"white",
            "draggable":false,
            "overlayCancel":true,
            "buttonOk":false,
            "saveOnUnload":false,
            "data": {
                "cmd":"exchangeResources",
                "defaultValues":{"r1": parseInt(localStorage.resourceSumR1),"r2": parseInt(localStorage.resourceSumR2),"r3": parseInt(localStorage.resourceSumR3),"r4": parseInt(localStorage.resourceSumR4)},
                "did":"1688"
            },
            "preventFormSubmit":true
        });
        return false;
    });
    bottomBlock.append(allocButton);

    //Draw add to sum button
    var fields = $('#build .resourceWrapper:not(.noSum)');
    if(fields.length)
    {
        fields.each(function() {
            let field = $(this);

            let btn = $('<a style="position: absolute; right: 0;bottom: 0;user-select: none;">Összesítőbe</a>'),
                resfields = field.find('.resource .value');

            if(resfields.length < 4) return;

            field.css({'position': 'relative', 'padding-bottom': '20px'});
            btn.on('click', function() {
                resfields.each(function(i) {
                    if(i < 4) addResourceToSum(i + 1, parseInt($(this).html().replace(/ /g, '')));
                });
                return false;
            });

            field.append(btn);
        });
    }
})();