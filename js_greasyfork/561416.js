// ==UserScript==
// @name         YouTubeAdSolutions
// @name:ar      YouTubeAdSolutions
// @name:be      YouTubeAdSolutions
// @name:bg      YouTubeAdSolutions
// @name:ckb     YouTubeAdSolutions
// @name:cs      YouTubeAdSolutions
// @name:da      YouTubeAdSolutions
// @name:de      YouTubeAdSolutions
// @name:el      YouTubeAdSolutions
// @name:en      YouTubeAdSolutions
// @name:eo      YouTubeAdSolutions
// @name:es      YouTubeAdSolutions
// @name:es-419  YouTubeAdSolutions
// @name:fi      YouTubeAdSolutions
// @name:fr      YouTubeAdSolutions
// @name:fr-CA   YouTubeAdSolutions
// @name:he      YouTubeAdSolutions
// @name:hr      YouTubeAdSolutions
// @name:hu      YouTubeAdSolutions
// @name:id      YouTubeAdSolutions
// @name:it      YouTubeAdSolutions
// @name:ja      YouTubeAdSolutions
// @name:ka      YouTubeAdSolutions
// @name:ko      YouTubeAdSolutions
// @name:mr      YouTubeAdSolutions
// @name:nb      YouTubeAdSolutions
// @name:nl      YouTubeAdSolutions
// @name:pl      YouTubeAdSolutions
// @name:pt-BR   YouTubeAdSolutions
// @name:ro      YouTubeAdSolutions
// @name:ru      YouTubeAdSolutions
// @name:sk      YouTubeAdSolutions
// @name:sr      YouTubeAdSolutions
// @name:sv      YouTubeAdSolutions
// @name:th      YouTubeAdSolutions
// @name:tr      YouTubeAdSolutions
// @name:uk      YouTubeAdSolutions
// @name:ug      YouTubeAdSolutions
// @name:vi      YouTubeAdSolutions
// @name:zh-CN   YouTubeAdSolutions
// @name:zh-TW   YouTubeAdSolutions
// @description  Premium-Logo, Downloader, Audio-Features, Skip-Highlight, Picture-in-Picture, Miniplayer, Speed-Control & Shorts Volume Slider.
// @description:ar     ÿ¥ÿπÿßÿ± ÿ®ÿ±ŸäŸÖŸäŸàŸÖÿå ÿ£ÿØÿßÿ© ÿ™ŸÜÿ≤ŸäŸÑÿå ŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿµŸàÿ™ÿå ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ™ŸÖŸäŸäÿ≤ÿå ÿµŸàÿ±ÿ© ÿØÿßÿÆŸÑ ÿµŸàÿ±ÿ©ÿå ŸÖÿ¥ÿ∫ŸÑ ŸÖÿµÿ∫ÿ±ÿå ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿßŸÑÿ≥ÿ±ÿπÿ© ŸàŸÖŸÜÿ≤ŸÑŸÇ ÿµŸàÿ™ Shorts.
// @description:be     –ü—Ä—ç–º—ñ—É–º-–ª–∞–≥–∞—Ç—ã–ø, –∑–∞–≥—Ä—É–∑–Ω—ñ–∫, –∞—û–¥—ã—è-—Ñ—É–Ω–∫—Ü—ã—ñ, –ø—Ä–∞–ø—É—Å–∫ –ø–∞–¥—Å–≤–µ—Ç–∫—ñ, –º–∞–ª—é–Ω–∞–∫ —É –º–∞–ª—é–Ω–∫—É, –º—ñ–Ω—ñ-–ø–ª—ç–µ—Ä, –∫–∞–Ω—Ç—Ä–æ–ª—å —Ö—É—Ç–∫–∞—Å—Ü—ñ —ñ —Ä—ç–≥—É–ª—è—Ç–∞—Ä –≥—É—á–Ω–∞—Å—Ü—ñ Shorts.
// @description:bg     Premium –ª–æ–≥–æ, –∏–∑—Ç–µ–≥–ª—è–Ω–µ, –∞—É–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ–ø—É—Å–∫–∞–Ω–µ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–∏, –∫–∞—Ä—Ç–∏–Ω–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∞—Ç–∞, –º–∏–Ω–∏ –ø–ª–µ–π—ä—Ä, –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—Ç–∞ –∏ –ø–ª—ä–∑–≥–∞—á –∑–∞ —Å–∏–ª–∞—Ç–∞ –Ω–∞ Shorts.
// @description:ckb    ŸÑ€Ü⁄Ø€Ü€å Ÿæÿ±€éŸÖ€åŸàŸÖÿå ÿØÿß⁄Øÿ±ÿ™ŸÜÿå ÿ™ÿß€åÿ®€ïÿ™ŸÖ€ïŸÜÿØ€å€å ÿØ€ïŸÜ⁄Øÿå ÿ™€éŸæ€ï⁄ïÿßŸÜÿØŸÜ€å ÿØ€åÿßÿ±€å⁄©ÿ±ÿØŸÜÿå Ÿà€éŸÜ€ï ŸÑ€ï ŸÜÿßŸà Ÿà€éŸÜ€ïÿØÿßÿå ŸÖ€åŸÜ€å ŸæŸÑ€ï€å€ïÿ±ÿå ⁄©€ÜŸÜÿ™ÿ±€Ü⁄µ€å ÿÆ€éÿ±ÿß€å€å Ÿà ÿ≥ŸÑÿß€åÿØ€ïÿ±€å ÿØ€ïŸÜ⁄Ø€å Shorts.
// @description:cs     Pr√©miov√© logo, stahov√°n√≠, zvukov√© funkce, p≈ôeskoƒçen√≠ zv√Ωraznƒõn√≠, obraz v obraze, minip≈ôehr√°vaƒç, ovl√°d√°n√≠ rychlosti a posuvn√≠k hlasitosti Shorts.
// @description:da     Premium-logo, downloader, lydfunktioner, spring markeringer over, billede-i-billede, miniafspiller, hastighedskontrol og lydstyrkeskyder til Shorts.
// @description:de     Premium-Logo, Downloader, Audio-Funktionen, Skip-Highlight, Picture-in-Picture, Miniplayer, Geschwindigkeitskontrolle & Lautst√§rkeregler f√ºr Shorts.
// @description:el     ŒõŒøŒ≥œåœÑœÖœÄŒø Premium, ŒªŒÆœàŒ∑, ŒªŒµŒπœÑŒøœÖœÅŒ≥ŒØŒµœÇ ŒÆœáŒøœÖ, œÄŒ±œÅŒ¨ŒªŒµŒπœàŒ∑ ŒµœÄŒπœÉŒÆŒºŒ±ŒΩœÉŒ∑œÇ, ŒµŒπŒ∫œåŒΩŒ± œÉŒµ ŒµŒπŒ∫œåŒΩŒ±, mini player, Œ≠ŒªŒµŒ≥œáŒøœÇ œÑŒ±œáœçœÑŒ∑œÑŒ±œÇ Œ∫Œ±Œπ œÅœÖŒ∏ŒºŒπœÉœÑŒπŒ∫œå Œ≠ŒΩœÑŒ±œÉŒ∑œÇ Shorts.
// @description:en     Premium logo, downloader, audio features, skip highlight, picture-in-picture, miniplayer, speed control & Shorts volume slider.
// @description:eo     Premium-emblemo, el≈ùutilo, sonaj funkcioj, preterpasi emfazon, bildo-en-bildo, mini-ludilo, rapideca kontrolo kaj glitilo de Shorts-la≈≠teco.
// @description:es     Logotipo Premium, descargador, funciones de audio, omitir resaltado, imagen en imagen, minirreproductor, control de velocidad y control de volumen de Shorts.
// @description:es-419 Logotipo Premium, descargador, funciones de audio, omitir resaltados, imagen en imagen, minirreproductor, control de velocidad y control de volumen de Shorts.
// @description:fi     Premium-logo, latausohjelma, √§√§niominaisuudet, korostusten ohitus, kuva kuvassa, minisoitin, nopeudens√§√§t√∂ ja Shorts-√§√§nenvoimakkuuss√§√§din.
// @description:fr     Logo Premium, t√©l√©chargeur, fonctions audio, saut de surbrillance, image dans l‚Äôimage, mini-lecteur, contr√¥le de vitesse et curseur de volume Shorts.
// @description:fr-CA  Logo Premium, t√©l√©chargeur, fonctions audio, saut de surbrillance, image dans l‚Äôimage, mini-lecteur, contr√¥le de vitesse et curseur de volume Shorts.
// @description:he     ◊ú◊ï◊í◊ï ◊§◊®◊ô◊û◊ô◊ï◊ù, ◊î◊ï◊®◊ì◊î, ◊™◊õ◊ï◊†◊ï◊™ ◊©◊û◊¢, ◊ì◊ô◊ú◊ï◊í ◊¢◊ú ◊î◊ì◊í◊©◊ï◊™, ◊™◊û◊ï◊†◊î ◊ë◊™◊ï◊ö ◊™◊û◊ï◊†◊î, ◊†◊í◊ü ◊û◊ï◊ß◊ò◊ü, ◊©◊ú◊ô◊ò◊™ ◊û◊î◊ô◊®◊ï◊™ ◊ï◊û◊ó◊ï◊ï◊ü ◊¢◊ï◊¶◊û◊™ ◊ß◊ï◊ú ◊ú-Shorts.
// @description:hr     Premium logo, preuzimanje, audio funkcije, preskakanje isticanja, slika u slici, mini player, kontrola brzine i klizaƒç glasnoƒáe za Shorts.
// @description:hu     Pr√©mium log√≥, let√∂lt≈ë, hangfunkci√≥k, kiemel√©sek kihagy√°sa, k√©p a k√©pben, mini lej√°tsz√≥, sebess√©gszab√°lyz√°s √©s Shorts hanger≈ëcs√∫szka.
// @description:id     Logo Premium, pengunduh, fitur audio, lewati sorotan, gambar dalam gambar, pemutar mini, kontrol kecepatan dan penggeser volume Shorts.
// @description:it     Logo Premium, downloader, funzioni audio, salta evidenziazioni, picture-in-picture, mini player, controllo velocit√† e cursore volume Shorts.
// @description:ja     „Éó„É¨„Éü„Ç¢„É†„É≠„Ç¥„ÄÅ„ÉÄ„Ç¶„É≥„É≠„Éº„ÉÄ„Éº„ÄÅÈü≥Â£∞Ê©üËÉΩ„ÄÅ„Éè„Ç§„É©„Ç§„Éà„ÅÆ„Çπ„Ç≠„ÉÉ„Éó„ÄÅ„Éî„ÇØ„ÉÅ„É£„Éº„Ç§„É≥„Éî„ÇØ„ÉÅ„É£„Éº„ÄÅ„Éü„Éã„Éó„É¨„Éº„É§„Éº„ÄÅÈÄüÂ∫¶Ë™øÊï¥„Å®ShortsÈü≥Èáè„Çπ„É©„Ç§„ÉÄ„Éº„ÄÇ
// @description:ka     ·Éû·É†·Éî·Éõ·Éò·É£·Éõ ·Éö·Éù·Éí·Éù, ·É©·Éê·Éõ·Éù·É¢·Éï·Éò·É†·Éó·Éï·Éê, ·Éê·É£·Éì·Éò·Éù ·É§·É£·Éú·É•·É™·Éò·Éî·Éë·Éò, ·Éí·Éê·Éõ·Éù·Éô·Éï·Éî·Éó·Éî·Éë·Éò·É° ·Éí·Éê·Éõ·Éù·É¢·Éù·Éï·Éî·Éë·Éê, ·É°·É£·É†·Éê·Éó·Éò ·É°·É£·É†·Éê·Éó·É®·Éò, ·Éõ·Éò·Éú·Éò ·Éì·Éê·Éõ·Éô·Éï·É†·Éî·Éö·Éò, ·É°·Éò·É©·É•·Éê·É†·Éò·É° ·Éô·Éù·Éú·É¢·É†·Éù·Éö·Éò ·Éì·Éê Shorts ·ÉÆ·Éõ·Éò·É° ·É†·Éî·Éí·É£·Éö·Éê·É¢·Éù·É†·Éò.
// @description:ko     ÌîÑÎ¶¨ÎØ∏ÏóÑ Î°úÍ≥†, Îã§Ïö¥Î°úÎìú, Ïò§ÎîîÏò§ Í∏∞Îä•, ÌïòÏù¥ÎùºÏù¥Ìä∏ Í±¥ÎÑàÎõ∞Í∏∞, ÌôîÎ©¥ ÏÜç ÌôîÎ©¥, ÎØ∏Îãà ÌîåÎ†àÏù¥Ïñ¥, ÏÜçÎèÑ Ï°∞Ï†à Î∞è Shorts Î≥ºÎ•® Ïä¨ÎùºÏù¥Îçî.
// @description:mr     ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§≤‡•ã‡§ó‡•ã, ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°‡§∞, ‡§ë‡§°‡§ø‡§ì ‡§µ‡•à‡§∂‡§ø‡§∑‡•ç‡§ü‡•ç‡§Ø‡•á, ‡§π‡§æ‡§Ø‡§≤‡§æ‡§á‡§ü ‡§µ‡§ó‡§≥‡§æ, ‡§™‡§ø‡§ï‡•ç‡§ö‡§∞-‡§á‡§®-‡§™‡§ø‡§ï‡•ç‡§ö‡§∞, ‡§Æ‡§ø‡§®‡•Ä ‡§™‡•ç‡§≤‡•á‡§Ö‡§∞, ‡§ó‡§§‡•Ä ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§Ü‡§£‡§ø Shorts ‡§µ‡•ç‡§π‡•â‡§≤‡•ç‡§Ø‡•Ç‡§Æ ‡§∏‡•ç‡§≤‡§æ‡§Ø‡§°‡§∞.
// @description:nb     Premium-logo, nedlasting, lydfunksjoner, hopp over h√∏ydepunkter, bilde-i-bilde, minispiller, hastighetskontroll og volumskyveknapp for Shorts.
// @description:nl     Premium-logo, downloader, audiofuncties, markeringen overslaan, picture-in-picture, minispeler, snelheidsregeling en volumeschuif voor Shorts.
// @description:pl     Logo Premium, pobieranie, funkcje audio, pomijanie wyr√≥≈ºnie≈Ñ, obraz w obrazie, mini odtwarzacz, kontrola prƒôdko≈õci i suwak g≈Ço≈õno≈õci Shorts.
// @description:pt-BR  Logotipo Premium, downloader, recursos de √°udio, pular destaques, picture-in-picture, mini player, controle de velocidade e controle de volume do Shorts.
// @description:ro     Logo Premium, descƒÉrcare, func»õii audio, sƒÉrire eviden»õieri, imagine √Æn imagine, mini player, control vitezƒÉ »ôi glisor volum Shorts.
// @description:ru     –ü—Ä–µ–º–∏—É–º-–ª–æ–≥–æ—Ç–∏–ø, –∑–∞–≥—Ä—É–∑—á–∏–∫, –∞—É–¥–∏–æ—Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ–ø—É—Å–∫ –≤—ã–¥–µ–ª–µ–Ω–∏–π, –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ, –º–∏–Ω–∏-–ø–ª–µ–µ—Ä, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Ä–µ–≥—É–ª—è—Ç–æ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç–∏ Shorts.
// @description:sk     Pr√©miov√© logo, s≈•ahovanie, zvukov√© funkcie, preskoƒçenie zv√Ωraznen√≠, obraz v obraze, mini prehr√°vaƒç, ovl√°danie r√Ωchlosti a posuvn√≠k hlasitosti Shorts.
// @description:sr     Premium logo, preuzimanje, audio funkcije, preskakanje isticanja, slika u slici, mini plejer, kontrola brzine i klizaƒç jaƒçine zvuka za Shorts.
// @description:sv     Premium-logotyp, nedladdning, ljudfunktioner, hoppa √∂ver markeringar, bild-i-bild, minispelare, hastighetskontroll och volymreglage f√∂r Shorts.
// @description:th     ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°, ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î, ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á, ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå, ‡∏†‡∏≤‡∏û‡∏ã‡πâ‡∏≠‡∏ô‡∏†‡∏≤‡∏û, ‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏û‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå, ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á Shorts
// @description:tr     Premium logo, indirici, ses √∂zellikleri, vurgularƒ± atla, resim i√ßinde resim, mini oynatƒ±cƒ±, hƒ±z kontrol√º ve Shorts ses kaydƒ±rƒ±cƒ±sƒ±.
// @description:uk     –ü—Ä–µ–º—ñ—É–º-–ª–æ–≥–æ—Ç–∏–ø, –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á, –∞—É–¥—ñ–æ—Ñ—É–Ω–∫—Ü—ñ—ó, –ø—Ä–æ–ø—É—Å–∫ –≤–∏–¥—ñ–ª–µ–Ω—å, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ, –º—ñ–Ω—ñ–ø–ª–µ—î—Ä, –∫–æ–Ω—Ç—Ä–æ–ª—å —à–≤–∏–¥–∫–æ—Å—Ç—ñ —Ç–∞ —Ä–µ–≥—É–ª—è—Ç–æ—Ä –≥—É—á–Ω–æ—Å—Ç—ñ Shorts.
// @description:ug     Premium ŸÑŸà⁄ØŸàÿå ⁄Ü€àÿ¥€àÿ±⁄Ø€à⁄Üÿå ÿ¶ÿß€ãÿßÿ≤ ÿ¶ŸâŸÇÿ™ŸâÿØÿßÿ±ŸÑŸâÿ±Ÿâÿå ŸäŸàÿ±€áÿ™€áÿ¥ŸÜŸâ ÿ¶€Üÿ™ŸÉ€àÿ≤€àÿ¥ÿå ÿ±€ïÿ≥ŸâŸÖ ÿ¶Ÿâ⁄ÜŸâÿØ€ï ÿ±€ïÿ≥ŸâŸÖÿå ŸÉŸâ⁄ÜŸâŸÉ ŸÇŸàŸäÿ∫€á⁄Üÿå ÿ≥€àÿ±ÿ¶€ïÿ™ ŸÉŸàŸÜÿ™ÿ±ŸàŸÑ €ã€ï Shorts ÿ¶ÿß€ãÿßÿ≤ ÿ≥ŸâŸäÿ±Ÿâÿ∫€á⁄ÜŸâ.
// @description:vi     Logo Premium, tr√¨nh t·∫£i xu·ªëng, t√≠nh nƒÉng √¢m thanh, b·ªè qua n·ªïi b·∫≠t, h√¨nh trong h√¨nh, tr√¨nh ph√°t mini, ƒëi·ªÅu khi·ªÉn t·ªëc ƒë·ªô v√† thanh √¢m l∆∞·ª£ng Shorts.
// @description:zh-CN  È´òÁ∫ßÂæΩÊ†á„ÄÅ‰∏ãËΩΩÂô®„ÄÅÈü≥È¢ëÂäüËÉΩ„ÄÅË∑≥ËøáÈ´ò‰∫Æ„ÄÅÁîª‰∏≠Áîª„ÄÅËø∑‰Ω†Êí≠ÊîæÂô®„ÄÅÈÄüÂ∫¶ÊéßÂà∂Âíå Shorts Èü≥ÈáèÊªëÂùó„ÄÇ
// @description:zh-TW  È´òÁ¥öÊ®ôË™å„ÄÅ‰∏ãËºâÂô®„ÄÅÈü≥Ë®äÂäüËÉΩ„ÄÅË∑≥ÈÅéÈáçÈªû„ÄÅÂ≠êÊØçÁï´Èù¢„ÄÅËø∑‰Ω†Êí≠ÊîæÂô®„ÄÅÈÄüÂ∫¶ÊéßÂà∂Ëàá Shorts Èü≥ÈáèÊªëÊ°ø„ÄÇ

// @namespace    http://tampermonkey.net/
// @version      2.1
// @author       Pascal
// @match        https://www.youtube.com/*
// @grant        none
// @icon         https://www.youtube.com/s/desktop/ee47b5e0/img/logos/favicon_144x144.png
// @run-at       document-start
// @license      MIT
// @downloadURL https://update.greasyfork.org/scripts/561416/YouTubeAdSolutions.user.js
// @updateURL https://update.greasyfork.org/scripts/561416/YouTubeAdSolutions.meta.js
// ==/UserScript==

(function() {
    'use strict';

    let audioCtx, source, gainNode, bassFilter;
    let isAudioInited = false;
    let isAdActive = false;
    const tripleControlClass = 'custom-audio-control';

    // --- 0. ANTI-BLOCK-ENFORCEMENT ---
    function removeEnforcementMessage() {
        const enforcement = document.querySelector('ytd-enforcement-message-view-model');
        if (enforcement) {
            enforcement.remove();
            const video = document.querySelector('video');
            if (video && video.paused) video.play();
            console.log("YouTube Sperr-Dialog entfernt.");
        }
        const overlay = document.querySelector('tp-yt-iron-overlay-backdrop');
        if (overlay) { overlay.remove(); }
    }

    // --- 1. TRUSTED TYPES BYPASS ---
    if (window.trustedTypes && trustedTypes.createPolicy) {
        if (!trustedTypes.defaultPolicy) {
            try {
                const passThroughFn = (x) => x;
                trustedTypes.createPolicy('default', {
                    createHTML: passThroughFn, createScriptURL: passThroughFn, createScript: passThroughFn,
                });
            } catch (e) {}
        }
    }

    // --- 2. CSS ANPASSUNGEN (Global & Shorts) ---
    const style = document.createElement('style');
    style.innerHTML = `
        ytd-masthead, #masthead-container { z-index: 50000 !important; }
        #search-form, yt-searchbox { z-index: 60000 !important; position: relative !important; }
        .ytp-pip-btn svg, #custom-miniplayer-button svg { fill: white !important; }

        /* SHORTS SLIDER STYLING */
        .custom-shorts-slider {
            position: fixed;
            right: 60px;
            bottom: 50%;
            transform: rotate(-90deg) translateX(50%);
            transform-origin: right center;
            width: 600px; /* EXTRA LANG */
            height: 8px;
            accent-color: #ff0000;
            z-index: 999999;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            visibility: hidden;
            filter: drop-shadow(0px 0px 4px rgba(0,0,0,0.6));
        }
        body[is-shorts] .custom-shorts-slider {
            opacity: 0.5;
            visibility: visible;
        }
        body[is-shorts] .custom-shorts-slider:hover {
            opacity: 1;
        }
    `;
    document.head.appendChild(style);

    // --- 3. AUDIO LOGIK ---
    function initAudio() {
        const video = document.querySelector('video');
        if (!video || isAudioInited) return;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            source = audioCtx.createMediaElementSource(video);
            gainNode = audioCtx.createGain();
            bassFilter = audioCtx.createBiquadFilter();
            bassFilter.type = "lowshelf";
            bassFilter.frequency.value = 150;
            source.connect(bassFilter);
            bassFilter.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            isAudioInited = true;
        } catch (e) { console.warn("Audio Fehler:", e); }
    }

    function createControlPair(color, title) {
        const $container = document.createElement('span');
        $container.className = tripleControlClass;
        $container.style.cssText = 'display: inline-flex; align-items: center; height: 100%; vertical-align: middle; margin-right: 8px;';
        const $btn = document.createElement('button');
        $btn.className = 'ytp-button';
        $btn.title = title;
        $btn.innerHTML = `<svg viewBox="0 0 36 36" width="100%" height="100%"><path d="M18,11 L18,25 M11,18 L25,18" stroke="${color}" stroke-width="3" fill="none"/></svg>`;
        $btn.style.cssText = 'display: inline-flex; align-items: center; justify-content: center; min-width: 36px; height: 100%; cursor: pointer; background: none; border: none;';
        const $slider = document.createElement('input');
        $slider.type = 'range';
        $slider.style.cssText = `display: none; width: 8vw; accent-color: ${color}; margin: 0 5px; cursor: pointer;`;
        const $label = document.createElement('span');
        $label.style.cssText = `display: none; color: ${color}; font-size: 11px; font-weight: bold; min-width: 30px; font-family: Roboto;`;
        $btn.onclick = (e) => {
            e.preventDefault();
            const show = ($slider.style.display === 'none');
            $slider.style.display = $label.style.display = show ? 'inline-block' : 'none';
        };
        $container.append($btn, $slider, $label);
        return { $container, $slider, $label };
    }

    // --- 4. PiP LOGIK ---
    async function togglePiP() {
        const video = document.querySelector('video');
        if (!video) return;
        try {
            if (document.pictureInPictureElement) { await document.exitPictureInPicture(); }
            else { await video.requestPictureInPicture(); }
        } catch (err) {}
    }

    // --- 5. PREMIUM LOGO (Optimierte Version) ---
    const PREMIUM_SVG_CONTENT = `
        <g>
            <path d="M14.4848 20C14.4848 20 23.5695 20 25.8229 19.4C27.0917 19.06 28.0459 18.08 28.3808 16.87C29 14.65 29 9.98 29 9.98C29 9.98 29 5.34 28.3808 3.14C28.0459 1.9 27.0917 0.94 25.8229 0.61C23.5695 0 14.4848 0 14.4848 0C14.4848 0 5.42037 0 3.17711 0.61C1.9286 0.94 0.954148 1.9 0.59888 3.14C0 5.34 0 9.98 0 9.98C0 9.98 0 14.65 0.59888 16.87C0.954148 18.08 1.9286 19.06 3.17711 19.4C5.42037 20 14.4848 20 14.4848 20Z" fill="#FF0033"/>
            <path d="M19 10L11.5 5.75V14.25L19 10Z" fill="white"/>
        </g>
        <g fill="currentColor">
            <path d="M32.1819 2.10016V18.9002H34.7619V12.9102H35.4519C38.8019 12.9102 40.5619 11.1102 40.5619 7.57016V6.88016C40.5619 3.31016 39.0019 2.10016 35.7219 2.10016H32.1819ZM37.8619 7.63016C37.8619 10.0002 37.1419 11.0802 35.4019 11.0802H34.7619V3.95016H35.4519C37.4219 3.95016 37.8619 4.76016 37.8619 7.13016V7.13016Z"/>
            <path d="M41.982 18.9002H44.532V10.0902C44.952 9.37016 45.992 9.05016 47.302 9.32016L47.462 6.33016C47.292 6.31016 47.142 6.29016 47.002 6.29016C45.802 6.29016 44.832 7.20016 44.342 8.86016H44.162L43.952 6.54016H41.982V18.9002Z"/>
            <path d="M55.7461 11.5002C55.7461 8.52016 55.4461 6.31016 52.0161 6.31016C48.7861 6.31016 48.0661 8.46016 48.0661 11.6202V13.7902C48.0661 16.8702 48.7261 19.1102 51.9361 19.1102C54.4761 19.1102 55.7861 17.8402 55.6361 15.3802L53.3861 15.2602C53.3561 16.7802 53.0061 17.4002 51.9961 17.4002C50.7261 17.4002 50.6661 16.1902 50.6661 14.3902V13.5502H55.7461V11.5002ZM51.9561 7.97016C53.1761 7.97016 53.2661 9.12016 53.2661 11.0702V12.0802H50.6661V11.0702C50.6661 9.14016 50.7461 7.97016 51.9561 7.97016Z"/>
            <path d="M60.1945 18.9002V8.92016C60.5745 8.39016 61.1945 8.07016 61.7945 8.07016C62.5645 8.07016 62.8445 8.61016 62.8445 9.69016V18.9002H65.5045L65.4845 8.93016C65.8545 8.37016 66.4845 8.04016 67.1045 8.04016C67.7745 8.04016 68.1445 8.61016 68.1445 9.69016V18.9002H70.8045V9.49016C70.8045 7.28016 70.0145 6.27016 68.3445 6.27016C67.1845 6.27016 66.1945 6.69016 65.2845 7.67016C64.9045 6.76016 64.1545 6.27016 63.0845 6.27016C61.8745 6.27016 60.7345 6.79016 59.9345 7.76016H59.7845L59.5945 6.54016H57.5445V18.9002H60.1945Z"/>
            <path d="M74.0858 4.97016C74.9858 4.97016 75.4058 4.67016 75.4058 3.43016C75.4058 2.27016 74.9558 1.91016 74.0858 1.91016C73.2058 1.91016 72.7758 2.23016 72.7758 3.43016C72.7758 4.67016 73.1858 4.97016 74.0858 4.97016ZM72.8658 18.9002H75.3958V6.54016H72.8658V18.9002Z"/>
            <path d="M79.9516 19.0902C81.4116 19.0902 82.3216 18.4802 83.0716 17.3802H83.1816L83.2916 18.9002H85.2816V6.54016H82.6416V16.4702C82.3616 16.9602 81.7116 17.3202 81.1016 17.3202C80.3316 17.3202 80.0916 16.7102 80.0916 15.6902V6.54016H77.4616V15.8102C77.4616 17.8202 78.0416 19.0902 79.9516 19.0902Z"/>
            <path d="M90.0031 18.9002V8.92016C90.3831 8.39016 91.0031 8.07016 91.6031 8.07016C92.3731 8.07016 92.6531 8.61016 92.6531 9.69016V18.9002H95.3131L95.2931 8.93016C95.6631 8.37016 96.2931 8.04016 96.9131 8.04016C97.5831 8.04016 97.9531 8.61016 97.9531 9.69016V18.9002H100.613V9.49016C100.613 7.28016 99.8231 6.27016 98.1531 6.27016C96.9931 6.27016 96.0031 6.69016 95.0931 7.67016C94.7131 6.76016 93.9631 6.27016 92.8931 6.27016C91.6831 6.27016 90.5431 6.79016 89.7431 7.76016H89.5931L89.4031 6.54016H87.3531V18.9002H90.0031Z"/>
        </g>
    `;

    function applyPremiumLogo() {
        const logoSelectors = [
            'ytd-topbar-logo-renderer #logo svg',
            'ytd-guide-renderer #logo svg',
            'ytd-logo svg',
            'svg#yt-ringo2-svg_yt5',
            'svg#yt-ringo2-svg_yt4'
        ];

        logoSelectors.forEach(selector => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(svg => {
                if (svg && svg.getAttribute('data-is-premium') !== 'true') {
                    svg.setAttribute('width', '101');
                    svg.setAttribute('viewBox', '0 0 101 20');
                    svg.setAttribute('data-is-premium', 'true');
                    svg.innerHTML = PREMIUM_SVG_CONTENT;
                }
            });
        });
    }

    // --- 6. SKIP-BUTTON HIGHLIGHT ---
    function highlightSkip() {
        const btn = document.querySelector('.ytp-skip-ad-button, .ytp-ad-skip-button');
        if (btn && !btn.getAttribute('data-hl')) {
            btn.setAttribute('data-hl', 'true');
            btn.style.border = "3px solid #ff00ff";
            btn.style.boxShadow = "0 0 15px #ff00ff";
            btn.style.borderRadius = "4px";
        }
    }

    // --- 7. DOWNLOADER (Final: 60px Optimization) ---
    function initializDownload() {
    const rightControls = document.querySelector('.ytp-right-controls');
    if (!rightControls || document.getElementById('dwnldBtnPlayer')) return;

    const dwnldBtn = document.createElement('button');
    dwnldBtn.id = 'dwnldBtnPlayer';
    dwnldBtn.className = 'ytp-button';
    dwnldBtn.setAttribute('title', 'Download');

    // Deine optimierte Breite von 60px
    dwnldBtn.style.cssText = `
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        width: 60px;
    `;

    // SVG Pfad angepasst f√ºr perfekte Zentrierung im 60px Container
    dwnldBtn.innerHTML = `
        <svg width="100%" height="100%" viewBox="0 0 36 36" version="1.1">
            <path d="M19 22V10H17V22H13.5L18 26.5L22.5 22H19ZM10 28V30H26V28H10Z" fill="white"></path>
        </svg>`;

    let menu = document.getElementById('dwnldMenuGlobal');
    if (!menu) {
        menu = document.createElement('div');
        menu.id = 'dwnldMenuGlobal';
        document.body.appendChild(menu);
    }

    menu.style.cssText = `
        display: none;
        position: fixed;
        background: rgba(28, 28, 28, 0.98);
        border-radius: 12px;
        min-width: 200px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.8);
        z-index: 2147483647;
        padding: 8px 0;
        border: 1px solid rgba(255,255,255,0.15);
        font-family: 'Roboto', sans-serif;
        backdrop-filter: blur(12px);
    `;

    dwnldBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();

        const rect = dwnldBtn.getBoundingClientRect();
        const currentId = new URLSearchParams(window.location.search).get('v');

        const sources = [
            { name: 'üéûÔ∏è MP3 / MP4 (Y2Mate)', url: 'https://evdfrance.fr/convert/?id=' + currentId },
            { name: 'üé∂ MP3 (YTMP3)', url: 'https://ytmp3.as/#' + currentId + '/mp3' },
            { name: 'üöÄ 4K Video (Loader)', url: 'https://loader.to/api/card/?url=https://www.youtube.com/watch?v=' + currentId },
            { name: 'üü¢ MP4 (SaveFrom)', url: 'https://ssyoutube.com/watch?v=' + currentId },
            { name: '‚úÇÔ∏è DVR / Edit (Dirpy)', url: 'https://dirpy.com/studio?url=https://www.youtube.com/watch?v=' + currentId },
            { name: 'üì∫ Multi-Format (noTube)', url: 'https://notube.net/convert/de?url=https://www.youtube.com/watch?v=' + currentId },
            { name: 'üõ°Ô∏è Cobalt (No Ads)', url: 'https://cobalt.tools/' }
        ];

        menu.innerHTML = "";
        sources.forEach(src => {
            const item = document.createElement('a');
            item.href = src.url;
            item.target = "_blank";
            item.innerText = src.name;
            item.style.cssText = "display: block; padding: 12px 20px; color: white; text-decoration: none; font-size: 14px;";

            // Men√º beim Klick auf einen Link automatisch schlie√üen
            item.addEventListener('click', () => { menu.style.display = 'none'; });

            item.onmouseover = () => item.style.backgroundColor = "rgba(255,255,255,0.1)";
            item.onmouseout = () => item.style.backgroundColor = "transparent";
            menu.appendChild(item);
        });

        menu.style.display = 'block';
        const menuRect = menu.getBoundingClientRect();
        menu.style.left = (rect.left + (rect.width / 2) - (menuRect.width / 2)) + 'px';
        menu.style.top = (rect.top - menuRect.height - 15) + 'px';

        const close = (event) => {
            if (!dwnldBtn.contains(event.target) && !menu.contains(event.target)) {
                menu.style.display = 'none';
                window.removeEventListener('mousedown', close);
            }
        };
        setTimeout(() => window.addEventListener('mousedown', close), 1);
    }, true);

    const pipBtn = document.querySelector('.ytp-pip-btn') || document.querySelector('.ytp-miniplayer-button');
    if (pipBtn) {
        rightControls.insertBefore(dwnldBtn, pipBtn);
    } else {
        rightControls.prepend(dwnldBtn);
    }
}

    // --- 8. SETUP INTERFACE (Audio, PiP, Miniplayer) ---
    function setupInterface() {
        const rightControls = document.querySelector('.ytp-right-controls');
        const timeDisp = document.querySelector('.ytp-time-display');
        const videoPlayer = document.getElementById('movie_player');

        if (timeDisp && !document.querySelector('.' + tripleControlClass)) {
            const savedVol = sessionStorage.getItem('custom-player-volume') ?? 0.948;
            if (videoPlayer && videoPlayer.setVolume) videoPlayer.setVolume((savedVol**2)*100);

            const vol = createControlPair('#FF0000', 'Volume');
            vol.$slider.min = '0'; vol.$slider.max = '1'; vol.$slider.step = '0.01';
            vol.$slider.value = savedVol;
            vol.$label.textContent = Math.round((savedVol**2)*100) + "%";
            vol.$slider.oninput = () => {
                if (videoPlayer && videoPlayer.setVolume) videoPlayer.setVolume((vol.$slider.value**2)*100);
                vol.$label.textContent = Math.round((vol.$slider.value**2)*100) + "%";
                sessionStorage.setItem('custom-player-volume', vol.$slider.value);
            };

            const savedBoost = sessionStorage.getItem('custom-player-boost') ?? 1;
            const boost = createControlPair('#FFFF00', 'Booster');
            boost.$slider.min = '1'; boost.$slider.max = '10'; boost.$slider.step = '0.1';
            boost.$slider.value = savedBoost;
            boost.$label.textContent = savedBoost + "x";
            boost.$slider.oninput = () => {
                initAudio();
                if(gainNode) gainNode.gain.value = boost.$slider.value;
                boost.$label.textContent = boost.$slider.value + "x";
                sessionStorage.setItem('custom-player-boost', boost.$slider.value);
            };

            const savedBass = sessionStorage.getItem('custom-player-bass') ?? 0;
            const bass = createControlPair('#FFA500', 'Bass');
            bass.$slider.min = '0'; bass.$slider.max = '30'; bass.$slider.step = '1';
            bass.$slider.value = savedBass;
            bass.$label.textContent = savedBass + "dB";
            bass.$slider.oninput = () => {
                initAudio();
                if(bassFilter) bassFilter.gain.value = bass.$slider.value;
                bass.$label.textContent = bass.$slider.value + "dB";
                sessionStorage.setItem('custom-player-bass', bass.$slider.value);
            };

            timeDisp.after(bass.$container);
            timeDisp.after(boost.$container);
            timeDisp.after(vol.$container);
        }

        if (rightControls && !document.querySelector('.ytp-pip-btn')) {
            const pipBtn = document.createElement('button');
            pipBtn.className = 'ytp-button ytp-pip-btn';
            pipBtn.title = 'Picture-in-Picture (p)';
            pipBtn.style.cssText = 'display: inline-flex; align-items: center; justify-content: center;';
            pipBtn.innerHTML = `<svg width="60%" height="60%" viewBox="0 0 24 24" fill="white"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/></svg>`;
            pipBtn.onclick = (e) => { e.preventDefault(); togglePiP(); };
            rightControls.prepend(pipBtn);
        }

        if (rightControls && !document.getElementById('custom-miniplayer-button')) {
            const miniBtn = document.createElement('button');
            miniBtn.id = 'custom-miniplayer-button';
            miniBtn.className = 'ytp-button';
            miniBtn.title = 'Miniplayer (i)';
            miniBtn.style.cssText = 'display: inline-flex; align-items: center; justify-content: center;';
            miniBtn.innerHTML = `<svg width="100%" height="100%" viewBox="0 0 36 36"><path fill="white" d="M25,17 L17,17 L17,23 L25,23 L25,17 Z M29,25 L29,11 L7,11 L7,25 L29,25 Z M27,13 L27,23 L9,23 L9,13 L27,13 Z"/></svg>`;
            miniBtn.onclick = (e) => {
                e.preventDefault();
                document.dispatchEvent(new KeyboardEvent('keydown', { key: 'i', keyCode: 73, bubbles: true }));
            };
            rightControls.appendChild(miniBtn);
        }
    }

    // --- 9. SPEED CONTROLLER LOGIK (Neutral Design - No Icon - Force 10x) ---
    let manualSpeed = 1.0;

    function setupSpeedInterface() {
        const actionsMenu = document.querySelector('#actions-inner #menu ytd-menu-renderer #top-level-buttons-computed');
        const video = document.querySelector('video');

        // Neutralisierte IDs
        if (!actionsMenu || !video || document.getElementById('premium-speed-control')) return;

        const control = document.createElement('div');
        control.id = 'premium-speed-control';
        control.className = 'premium-speed-logic top-level-buttons style-scope ytd-menu-renderer';

        control.innerHTML = `
            <div style="display: flex; align-items: center; padding-left: 8px;">
                <button id="speed-down-btn" style="background:none; border:none; color:white; cursor:pointer; font-size:18px; font-weight:bold; padding: 0 10px; min-width:30px;">-</button>
                <span id="premium-speed-display" style="min-width:35px; text-align:center; user-select:none; font-family:Roboto; font-size:14px; color:white; font-weight:500;">${video.playbackRate}x</span>
                <button id="speed-up-btn" style="background:none; border:none; color:white; cursor:pointer; font-size:18px; font-weight:bold; padding: 0 10px; min-width:30px;">+</button>
            </div>
        `;

        const btnDown = control.querySelector('#speed-down-btn');
        const btnUp = control.querySelector('#speed-up-btn');
        const display = control.querySelector('#premium-speed-display');

        const updateSpeed = (delta) => {
            manualSpeed = Math.round((video.playbackRate + delta) * 100) / 100;
            manualSpeed = Math.max(0.25, Math.min(10, manualSpeed));

            video.playbackRate = manualSpeed;
            display.textContent = `${manualSpeed}x`;
        };

        btnDown.onclick = (e) => { e.stopPropagation(); updateSpeed(-0.25); };
        btnUp.onclick = (e) => { e.stopPropagation(); updateSpeed(0.25); };

        video.addEventListener('ratechange', () => {
            if (!isAdActive) {
                if (video.playbackRate !== manualSpeed) {
                    video.playbackRate = manualSpeed;
                }
                display.textContent = `${manualSpeed}x`;
            }
        });

        actionsMenu.appendChild(control);
    }

     // --- 10. HANDLE ADS (Feinschliff f√ºr Direktlinks & Kaltstarts) ---
    function handleAds() {
        const video = document.querySelector('video');
        const ad = document.querySelector('.ad-showing, .ad-interrupting, .ytp-ad-player-overlay');
        const speedDisplay = document.querySelector('#premium-speed-display');

        if (video && ad) {
            isAdActive = true;

            // Aggressiver Mute: Falls YouTube versucht, den Ton wieder einzuschalten (Direktlinks)
            if (!video.muted) {
                video.muted = true;
                video.volume = 0; // Zus√§tzliche Sicherheit
            }

            // Geschwindigkeit bleibt wie gew√ºnscht bei 2.0x
            if (video.playbackRate !== 2.0) {
                video.playbackRate = 2.0;
            }

            if (speedDisplay && speedDisplay.textContent !== "2x") {
                speedDisplay.textContent = "2x";
            }

        } else if (video && isAdActive) {
            isAdActive = false;
            video.muted = false;

            // Lautst√§rke aus Speicher wiederherstellen
            const savedVol = sessionStorage.getItem('custom-player-volume') || 0.8;
            video.volume = savedVol;

            // Zur√ºck auf die manuell gew√§hlte Geschwindigkeit
            video.playbackRate = manualSpeed;
            if (speedDisplay) speedDisplay.textContent = manualSpeed + "x";
            console.log("%c[Premium] Werbung beendet - Normalmodus", "color: #00ff00");
        }
    }

    // --- 11. SHORTS VOLUME SLIDER ---
    function setupShortsUI() {
        if (document.querySelector('.custom-shorts-slider')) return;

        // Ge√§ndert auf sessionStorage
        const savedVol = sessionStorage.getItem('custom-player-volume') || 0.8;

        const $slider = document.createElement('input');
        $slider.className = 'custom-shorts-slider';
        $slider.type = 'range';
        $slider.min = '0'; $slider.max = '1'; $slider.step = '0.01';
        $slider.value = savedVol;

        const updateAllShorts = (val) => {
            document.querySelectorAll('video').forEach(v => {
                if (window.location.href.includes('/shorts/')) {
                    v.volume = val;
                    v.muted = (val == 0);
                }
            });
        };

        $slider.oninput = () => updateAllShorts($slider.value);
        // Ge√§ndert auf sessionStorage
        $slider.onchange = () => sessionStorage.setItem('custom-player-volume', $slider.value);
        document.body.appendChild($slider);

        window.addEventListener('yt-navigate-finish', checkShortsStatus);
        checkShortsStatus();
    }

    function checkShortsStatus() {
        if (window.location.href.includes('/shorts/')) {
            document.body.setAttribute('is-shorts', '');
            const v = document.querySelector('video');
            if (v) {
                // Ge√§ndert auf sessionStorage
                v.volume = sessionStorage.getItem('custom-player-volume') || 0.8;
            }
        } else {
            document.body.removeAttribute('is-shorts');
        }
    }

    // --- 12. ANTI-PAUSE-DIALOG ---
¬† ¬† function autoConfirmVideoPaused() {
¬† ¬† // 1. Suche den Ja-Button im Dialog
¬† ¬† const confirmBtn = document.querySelector('yt-confirm-dialog-renderer #confirm-button button');

¬† ¬† if (confirmBtn) {
¬† ¬† ¬† ¬† // Klick auf "Ja"
¬† ¬† ¬† ¬† confirmBtn.click();
¬† ¬† ¬† ¬† console.log("%c[Premium] 'Video angehalten'-Dialog automatisch best√§tigt.", "color: #00ffff");

¬† ¬† ¬† ¬† // 2. Video sofort wieder abspielen, falls es noch pausiert ist
¬† ¬† ¬† ¬† const video = document.querySelector('video');
¬† ¬† ¬† ¬† if (video && video.paused) {
¬† ¬† ¬† ¬† ¬† ¬† video.play();
¬† ¬† ¬† ¬† }
¬† ¬† }
}
    // --- SHORTCUTS & DEBUG ---
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.isContentEditable) return;
        if (e.key.toLowerCase() === 'p') { e.preventDefault(); togglePiP(); }
    }, { capture: true });

    // --- INTERVALLE ---
    setInterval(handleAds, 200); // Schnellerer Takt (200ms statt 500ms)
    setInterval(initializDownload, 800);
    setInterval(removeEnforcementMessage, 1000);
    setInterval(applyPremiumLogo, 1000);
    setInterval(setupInterface, 2000);
    setInterval(setupSpeedInterface, 1000);
    setInterval(highlightSkip, 1000);
    setInterval(setupShortsUI, 2000);

    // Initialer Start
    setupShortsUI();
})();