// ==UserScript==
// @name         Allegro Analytics + 
// @namespace    http://tampermonkey.net/
// @version      2.3
// @description  Rozszerzenie funkcjonalności w Allegro Analytics
// @author       Paweł Kaczmarek
// @match        https://allegro.pl/moje-allegro/sprzedaz/allegro-analytics/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/498247/Allegro%20Analytics%20%2B.user.js
// @updateURL https://update.greasyfork.org/scripts/498247/Allegro%20Analytics%20%2B.meta.js
// ==/UserScript==

!function(){"use strict";if(!window.location.pathname.includes("/moje-allegro/sprzedaz/allegro-analytics/sprzedaz-dni"))return;let e=null;function n(){document.getElementById("modal").style.display="block",document.getElementById("overlay").style.display="block",r(),d(),e&&clearInterval(e),e=setInterval((()=>{"block"===document.getElementById("modal").style.display?d():(clearInterval(e),e=null)}),1e3)}function t(){document.getElementById("modal").style.display="none",document.getElementById("overlay").style.display="none",e&&(clearInterval(e),e=null)}function o(e){document.cookie=`savedAccounts=${JSON.stringify(e)}; path=/; max-age=31536000`}function a(){const e=document.cookie.match(/savedAccounts=([^;]*)/);return e?JSON.parse(e[1]):[]}function r(){const e=a(),n=document.getElementById("savedAccountsList");n.innerHTML="";let t=null;e.forEach(((a,i)=>{const l=document.createElement("li");l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="space-between",l.style.color="black",l.draggable=!0,l.dataset.idx=i,l.addEventListener("dragstart",(function(e){t=i,l.style.opacity="0.5",e.dataTransfer.effectAllowed="move"})),l.addEventListener("dragend",(function(){l.style.opacity=""})),l.addEventListener("dragover",(function(e){e.preventDefault(),l.style.background="#ffe5d0"})),l.addEventListener("dragleave",(function(){l.style.background=""})),l.addEventListener("drop",(function(n){if(n.preventDefault(),l.style.background="",null===t||t===i)return;const a=e.splice(t,1)[0];e.splice(i,0,a),o(e),r()}));const c=document.createElement("span");c.textContent=a.name;const d=document.createElement("button");d.textContent="x",d.style.color="black",d.style.background="none",d.style.border="none",d.style.cursor="pointer",d.style.fontWeight="bold",d.addEventListener("click",(()=>{e.splice(i,1),o(e),r()})),l.appendChild(c),l.appendChild(d),n.appendChild(l)}))}function i(){const e=document.getElementById("account-select"),n=e.options[e.selectedIndex];if(!n.value)return;const t=a();t.push({name:n.textContent,value:n.value}),o(t),r()}function l(){document.cookie="savedAccounts=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;",r()}function c(){return sessionStorage.getItem("x-trana-id")}function d(){const e=document.getElementById("tranaIdStatus"),n=document.getElementById("downloadData");if(!tranaIdStatus||!n)return;c()?(e.innerHTML='<div style="color: green; font-weight: bold; margin-top: 10px;">✓ Możesz zacząć pobieranie</div>',n.disabled=!1,n.style.opacity="1",n.style.cursor="pointer"):(e.innerHTML='<div style="color: #ff8c00; margin-top: 10px;">⚠️ Pobierz ręcznie jeden raport dla dowolnego konta i daty, aby kontynuować</div>',n.disabled=!0,n.style.opacity="0.5",n.style.cursor="not-allowed")}function s(){if(!c())return void d();let e=null,n=[];const t=a(),o=[{code:"allegro-pl",label:"Allegro PL"},{code:"allegro-cz",label:"Allegro CZ"},{code:"allegro-sk",label:"Allegro SK"},{code:"allegro-hu",label:"Allegro HU"}],r={};let i=0,l=0;const s=t.length*o.length;let p,u,m;const f=document.querySelector('input[name="dateMode"]:checked')?.value,g=new Date;if("current"===f){const e=new Date;e.setDate(1),p=e.toISOString().split("T")[0]+"T00:00:00.000Z";const n=new Date(g.getTime()-3e5),t=n.toISOString().split("T")[0],o=n.toTimeString().split(" ")[0].slice(0,5);u=`${t}T00:00:00.000Z`,m=`${t}T${o}:00.000Z`}else if("previousMonth"===f){const e=new Date,n=e.getFullYear();let t=n,o=e.getMonth()-1;o<0&&(o=11,t=n-1);const a=new Date(t,o,1),r=new Date(t,o+1,0),i=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0");p=i+"T00:00:00.000Z";const l=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0");u=`${l}T23:59:59.999Z`,m=`${l}T23:59:59.999Z`}else{const e=new Date;e.setDate(1),p=e.toISOString().split("T")[0]+"T00:00:00.000Z";const n=new Date;n.setDate(n.getDate()-1);const t=n.toISOString().split("T")[0];u=`${t}T00:00:00.000Z`,m=`${t}T01:00:00.000Z`}const y=document.getElementById("progressContainer"),b=document.getElementById("progressBar"),h=document.getElementById("progressText"),x=y.querySelector(".warning-message");x&&x.remove(),y&&b&&h&&(y.style.display="block",b.style.width="0%",h.style.color="#333",h.style.fontWeight="normal",h.textContent=`0/${s}`,setTimeout((()=>{i<s&&(e=document.createElement("div"),e.classList.add("warning-message"),e.textContent="⚠️ Analytics może być przeciążony. Spróbuj ponownie później, poczekaj jeszcze chwilę lub zrestartuj stronę.",e.style.color="#cc0000",e.style.fontSize="14px",e.style.marginTop="10px",e.style.textAlign="center",y.appendChild(e))}),15e3));const v=document.getElementById("excludeReturns").checked;function k(e=!1){if(e)return 500+1500*Math.random();const n=1e3,t=4e3,o=Math.random();let a;return a=o<.5?n+Math.sqrt(3e3*o*1500):t-Math.sqrt(3e3*(1-o)*1500),Math.round(a)}const w=[];t.forEach((e=>{r[e.name]={},o.forEach((n=>{w.push({acc:e,market:n})}))})),function t(a){if(a>=w.length)return;const{acc:d,market:f}=w[a],g=k(!!(0===a));setTimeout((()=>{const g=JSON.stringify({includePhrasesMode:"OfferOrProduct",excludePhrasesMode:"OfferOrProduct",sellerIds:[d.value],includeCancelledAndReturned:!v,skip:0,take:1e3,marketplaceIds:[f.code],startDate:p,endDate:u,startDateTime:p.replace("00:00:00.000Z","01:00:00.000Z"),endDateTime:m,reportCode:"LASTFULL7DAYS"}),y={accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL","content-type":"application/vnd.allegro.internal.v1+json",priority:"u=1, i","sec-ch-ua":'"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},b=c();b&&(y["x-trana-id"]=b),fetch("https://edge.allegro.pl/analytics/reports/sale/byday",{method:"POST",headers:y,body:g,mode:"cors",credentials:"include"}).then((e=>e.json())).then((e=>{const n=(e.result?.overallSale??0).toFixed(2).replace(".",",");r[d.name][f.label]=n,l++})).catch((e=>{console.error(`Błąd dla konta ${d.name} (${f.code}):`,e),r[d.name][f.label]="BŁĄD",n.push(`${d.name} (${f.label})`)})).finally((()=>{i++,function(e,n,t=0,o=0){const a=document.getElementById("progressBar"),r=document.getElementById("progressText");if(a&&r){const i=Math.round(e/n*100);a.style.width=`${i}%`,e===n?o>0?(r.textContent=`Pobrano ${t}/${n} raportów (${o} błędów)`,r.style.color="#ff8c00",r.style.fontWeight="bold"):(r.textContent="Pobrano raport!",r.style.color="green",r.style.fontWeight="bold"):(r.textContent=`${e}/${n}`,r.style.color="#333",r.style.fontWeight="normal")}}(i,s,l,n.length),i===s?(e&&e.remove(),n.length>0?(h.textContent=`Pobrano ${l}/${s} raportów (${n.length} błędów)`,h.style.color="#ff8c00",h.style.fontWeight="bold",console.log("Pomijam eksport Excela z powodu błędów:",n)):(h.textContent="Pobrano raport!",h.style.color="green",h.style.fontWeight="bold",function(e,n){const t=[["Konto",...n]];for(const o in e){const a=[o];n.forEach((n=>{const t=e[o][n];a.push("0,00"===t||void 0===t?"":t)})),t.push(a)}const o=XLSX.utils.aoa_to_sheet(t),a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,o,"Sprzedaż"),XLSX.writeFile(a,"Sprzedaz_zestawienie.xlsx")}(r,o.map((e=>e.label))))):t(a+1)}))}),g)}(0)}function p(){const e=document.querySelector("account-filter");if(!e)return;const n=e.querySelector("select");if(!n)return;const t=a().map((e=>e.value));if(!t.length)return;const o=Array.from(n.options),r=[],i=[];for(o.forEach((e=>{t.includes(e.value)?(r.push(e),e.classList.add("saved-account-bold")):(i.push(e),e.classList.remove("saved-account-bold"))})),r.sort(((e,n)=>t.indexOf(e.value)-t.indexOf(n.value)));n.options.length>0;)n.remove(0);r.forEach((e=>n.add(e))),i.forEach((e=>n.add(e))),n.selectedIndex=0,n.dispatchEvent(new Event("change",{bubbles:!0}))}!function(){const e=document.createElement("style");e.textContent='\n            /* Przycisk otwierający modal */\n            #downloadDataButton {\n                position: fixed;\n                top: 10px;\n                right: 10px;\n                background-color: #ff5a00;\n                color: white;\n                border: none;\n                padding: 10px 15px;\n                font-size: 14px;\n                cursor: pointer;\n                border-radius: 5px;\n                box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);\n                z-index: 1000;\n            }\n\n            #downloadDataButton:hover {\n                background-color: #e04e00;\n            }\n\n            /* Overlay */\n            #overlay {\n                display: none;\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.5);\n                z-index: 1000;\n            }\n\n            /* Modal */\n            #modal {\n                display: none;\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: #ffffff;\n                padding: 30px;\n                border-radius: 12px;\n                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);\n                z-index: 2000;\n                min-width: 300px;\n                max-width: 90vw;\n                width: 1000px;\n                font-family: Arial, sans-serif;\n            }\n\n            #modal h2, #modal h3 {\n                color: #000;\n                margin-bottom: 10px;\n            }\n\n            #modal select {\n                width: 100%;\n                padding: 8px;\n                margin-bottom: 15px;\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                font-size: 14px;\n            }\n\n            #modal ul {\n                padding: 0;\n                list-style: none;\n                margin-top: 10px;\n                margin-bottom: 15px;\n                color: black;\n            }\n\n            #modal ul li {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 5px 8px;\n                border-bottom: 1px solid #eee;\n            }\n\n            .delete-account-btn {\n                background: none;\n                color: black;\n                border: none;\n                font-weight: bold;\n                cursor: pointer;\n                font-size: 16px;\n            }\n\n            .delete-account-btn:hover {\n                color: red;\n            }\n\n            /* Przyciski */\n            #modal button {\n                padding: 8px 16px;\n                margin-top: 10px;\n                margin-right: 5px;\n                cursor: pointer;\n                background-color: #ff5a00;\n                color: white;\n                border: none;\n                border-radius: 5px;\n                font-size: 14px;\n            }\n\n            #modal button:hover {\n                background-color: #e04e00;\n            }\n\n            #account-select {\n                width: 100%;\n                padding: 8px 12px;\n                font-size: 14px;\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                background-color: #fff;\n                color: black;\n                appearance: none;\n                -webkit-appearance: none;\n                -moz-appearance: none;\n                cursor: pointer;\n\n                background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 4 5\'><path fill=\'%23333\' d=\'M2 0L0 2h4L2 0z\'/></svg>");\n                background-repeat: no-repeat;\n                background-position: right 10px center;\n                background-size: 8px 10px;\n            }\n\n            .date-mode-container {\n                display: flex;\n                gap: 15px;\n                margin-bottom: 15px;\n                align-items: center; /* pionowe wyśrodkowanie */\n                justify-content: center;\n                width: 100%; /* zajmuje całą szerokość */\n                box-sizing: border-box;\n                flex-wrap: wrap; /* pozwala na zawijanie elementów */\n            }\n\n            /* label wyśrodkowany pionowo */\n            .date-mode-container label {\n                display: flex;\n                align-items: center;\n                cursor: pointer;\n                font-size: 14px;\n                color: #000;\n                user-select: none;\n            }\n\n            /* styl radio */\n            .date-mode-container input[type="radio"] {\n                appearance: none;\n                -webkit-appearance: none;\n                -moz-appearance: none;\n                width: 24px;          /* zwiększona szerokość */\n                height: 24px;         /* zwiększona wysokość */\n                border: 2px solid #ccc;\n                border-radius: 50%;\n                margin-right: 8px;\n                position: relative;\n                cursor: pointer;\n                background-color: #fff;\n                transition: border-color 0.3s ease, background-color 0.3s ease;\n                flex-shrink: 0;       /* nie pozwala się kurczyć */\n            }\n\n            .date-mode-container input[type="radio"]:checked {\n                border-color: #ff5a00;\n                background-color: #ff5a00;\n            }\n\n            .date-mode-container input[type="radio"]:checked::after {\n                content: "";\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                width: 12px;\n                height: 12px;\n                background: white;\n                border-radius: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .date-mode-container label:hover input[type="radio"] {\n                border-color: #e04e00;\n            }\n\n            /* Sekcje modalowe - wizualne oddzielenie */\n            #modal .section {\n                border: 1px solid #ddd;\n                padding: 15px 20px;\n                margin-bottom: 15px;\n                border-radius: 8px;\n                background-color: #fafafa;\n            }\n\n            /* Sekcja przycisków bez ramki, z wyrównaniem do środka */\n            #modal .section.buttons {\n                border: none;\n                background: none;\n                padding: 0;\n                margin-bottom: 0;\n                display: flex;\n                justify-content: center;\n                gap: 10px;\n            }\n\n            /* Przycisków nie trzeba zmieniać, ale można doprecyzować margines */\n            #modal button {\n                padding: 8px 16px;\n                cursor: pointer;\n                background-color: #ff5a00;\n                color: white;\n                border: none;\n                border-radius: 5px;\n                font-size: 14px;\n                transition: background-color 0.3s ease;\n            }\n            .saved-account-bold {\n                font-weight: 400 !important;\n                color:#ff5a00;\n            }\n            #modal button:hover {\n                background-color: #e04e00;\n            }\n\n            #savedAccountsList {\n                max-height: 350px;\n                overflow-y: auto;\n                scrollbar-width: thin; /* Firefox */\n                scrollbar-color: #ff5a00 transparent; /* Firefox - kolor paska i tła */\n            }\n\n            /* Dla Chrome, Edge i Safari - niestandardowy scrollbar */\n            #savedAccountsList::-webkit-scrollbar {\n                width: 6px; /* bardzo wąski pasek */\n            }\n\n            #savedAccountsList::-webkit-scrollbar-track {\n                background: transparent; /* przezroczysty */\n                border-radius: 3px;\n            }\n\n            #savedAccountsList::-webkit-scrollbar-thumb {\n                background-color: #ff5a00; /* kolor paska przewijania */\n                border-radius: 3px;\n            }\n\n            #savedAccountsList::-webkit-scrollbar-thumb:hover {\n                background-color: #e04e00; /* kolor po najechaniu */\n            }\n        ',document.head.appendChild(e)}(),function(){if(document.getElementById("downloadDataButton"))return;const e=document.createElement("button");e.id="downloadDataButton",e.textContent="Pobierz dane",e.style.position="fixed",e.style.top="10px",e.style.right="20px",e.style.zIndex="99999",e.style.background="#23272e",e.style.color="#fff",e.style.border="1.5px solid #ff5a00",e.style.borderRadius="8px",e.style.padding="10px 20px",e.style.fontSize="16px",e.style.cursor="pointer",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.10)",e.style.fontWeight="bold",e.style.transition="background 0.2s, color 0.2s",e.onmouseenter=function(){e.style.background="#ff5a00",e.style.color="#fff"},e.onmouseleave=function(){e.style.background="#23272e",e.style.color="#fff"},e.addEventListener("click",n),document.body.appendChild(e)}(),function(){const e=document.createElement("div");e.id="overlay",e.addEventListener("click",t),document.body.appendChild(e);const n=document.createElement("div");n.id="modal",n.innerHTML='\n            <div style="display: flex; gap: 30px; width: 100%;">\n                \x3c!-- Lewa kolumna --\x3e\n                <div style="flex: 1; min-width: 300px;">\n                    <div class="section">\n                        <h2>Wybierz konto</h2>\n                        <select id="account-select"></select>\n                        <button id="addAccount">Dodaj</button>\n                    </div>\n                    <div class="section">\n                        <h3>Zapisane konta:</h3>\n                        <ul id="savedAccountsList"></ul>\n                    </div>\n                </div>\n\n                \x3c!-- Prawa kolumna --\x3e\n                <div style="flex: 1.2; min-width: 350px;">\n                    <div class="section">\n                        <h3>Zakres dat</h3>\n                        <div class="date-mode-container">\n                            <label><input type="radio" name="dateMode" value="yesterday" checked> Do wczoraj</label>\n                            <label><input type="radio" name="dateMode" value="current"> Aktualne</label>\n                            <label><input type="radio" name="dateMode" value="previousMonth"> Poprzedni miesiąc</label>\n                        </div>\n                    </div>\n                    <div class="section">\n                        <h3>Opcje raportu</h3>\n                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">\n                            <input type="checkbox" id="excludeReturns" checked style="margin: 0; width: 16px; height: 16px;">\n                            <label for="excludeReturns" style="margin: 0; cursor: pointer; font-size: 14px; color: #333; font-weight: 500;">Pomniejsz o zwroty i anulacje</label>\n                        </div>\n                    </div>\n                    <div class="section" id="tranaIdSection" style="background-color: #fff3cd; border-color: #ffc107;">\n                        <h3 style="color: #856404; margin-bottom: 10px;">Wymagana autoryzacja</h3>\n                        <div style="color: #856404; font-size: 14px; line-height: 1.5;">\n                            Aby rozpocząć pobieranie danych, musisz najpierw ręcznie pobrać jeden raport w Analytics dla dowolnego konta i daty.\n                            <br><br>\n                            <strong>Instrukcja:</strong>\n                            <ol style="margin: 10px 0; padding-left: 20px;">\n                                <li>Zamknij ten modal</li>\n                                <li>Na stronie Analytics kliknij "Wyświetl raport" dla dowolnego konta i zakresu dat</li>\n                                <li>Poczekaj na zakończenie pobierania</li>\n                                <li>Wróć tutaj i kliknij "Pobierz dane"</li>\n                            </ol>\n                        </div>\n                        <div id="tranaIdStatus"></div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Pasek postępu - na pełną szerokość --\x3e\n            <div class="section" id="progressContainer" style="display:none;">\n                <div style="width: 100%; background-color: #eee; border-radius: 5px; overflow: hidden; height: 20px; margin-bottom: 5px;">\n                    <div id="progressBar" style="height: 100%; width: 0%; background-color: #ff5a00; transition: width 0.3s ease;"></div>\n                </div>\n                <div id="progressText" style="text-align: center; font-size: 14px; color: #333;">0/0</div>\n            </div>\n\n            \x3c!-- Przyciski - na pełną szerokość --\x3e\n            <div class="section buttons">\n                <button id="clearAccounts">Usuń wszystko</button>\n                <button id="downloadData" disabled style="opacity: 0.5; cursor: not-allowed;">Pobierz dane</button>\n                <button id="closeModal">Zamknij</button>\n            </div>\n        ',document.body.appendChild(n),document.getElementById("addAccount").addEventListener("click",i),document.getElementById("clearAccounts").addEventListener("click",l),document.getElementById("closeModal").addEventListener("click",t),document.getElementById("downloadData").addEventListener("click",s),setTimeout((()=>d()),100)}(),function(){const e=window.fetch;window.fetch=function(...n){const t=n[0];if("string"==typeof t&&t.includes("/analytics/reports/sale/byday")&&n[1]&&n[1].headers){const e=n[1].headers;let t=null;e instanceof Headers?t=e.get("x-trana-id"):"object"==typeof e&&(t=e["x-trana-id"]||e.get&&e.get("x-trana-id")),t&&(sessionStorage.setItem("x-trana-id",t),d())}return e.apply(this,n)}}(),function(){const e=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.setRequestHeader,t=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(n,t,...o){return this._url=t,this._requestHeaders={},e.apply(this,[n,t,...o])},XMLHttpRequest.prototype.setRequestHeader=function(e,t){return this._url&&this._url.includes("/analytics/reports/sale/byday")&&(this._requestHeaders[e.toLowerCase()]=t,"x-trana-id"===e.toLowerCase()&&(sessionStorage.setItem("x-trana-id",t),d())),n.apply(this,[e,t])},XMLHttpRequest.prototype.send=function(...e){if(this._url&&this._url.includes("/analytics/reports/sale/byday")){const e=this._requestHeaders["x-trana-id"];e&&(sessionStorage.setItem("x-trana-id",e),d())}return t.apply(this,e)}}(),function e(n,t){const o=document.querySelector(n);o?t(o):setTimeout((()=>e(n,t)),500)}("account-filter",(e=>{!function(){const e=document.querySelector("account-filter");if(!e)return;const n=e.querySelectorAll("option"),t=document.getElementById("account-select");t.innerHTML="",n.forEach((e=>{if(e.value){const n=document.createElement("option");n.value=e.value,n.textContent=e.textContent,t.appendChild(n)}}))}(),e.addEventListener("mousedown",p)}))}(),function(){"use strict";function e(e){localStorage.setItem("vaPlusFavAccounts",JSON.stringify(e))}function n(){try{return JSON.parse(localStorage.getItem("vaPlusFavAccounts"))||[]}catch(e){return[]}}function t(){document.getElementById("vaPlusModalOverlay").style.display="block",document.getElementById("vaPlusModal").style.display="flex",r(),function(){const e=document.querySelector('.vaPlusTab[data-tab="favAccounts"]');if(!e)return;e.addEventListener("click",(function(){a=!a,a?e.classList.add("active"):e.classList.remove("active"),r()}))}()}function o(){document.getElementById("vaPlusModalOverlay").style.display="none",document.getElementById("vaPlusModal").style.display="none"}let a=!1;function r(){const t=document.getElementById("vaPlusModalContent");a?(t.innerHTML='\n            <div id="vaPlusFavAccountsSection">\n                <div class="section">\n                    <h2>Wybierz konto</h2>\n                    <select id="vaPlusFavAccountSelect"></select>\n                    <button id="vaPlusFavAccountAddBtn">Dodaj</button>\n                </div>\n                <div class="section">\n                    <h3>Zapisane konta:</h3>\n                    <ul id="vaPlusFavAccountsList"></ul>\n                </div>\n                <div class="section buttons">\n                    <button id="vaPlusFavClearAccounts">Usuń wszystko</button>\n                </div>\n            </div>\n        ',i(),l(),document.getElementById("vaPlusFavAccountAddBtn").onclick=()=>{!function(){const t=document.getElementById("vaPlusFavAccountSelect"),o=t.options[t.selectedIndex];if(!o||!o.value)return;const a=n();a.push({name:o.textContent,value:o.value}),e(a),l()}(),c(),d()},document.getElementById("vaPlusFavClearAccounts").onclick=()=>{localStorage.removeItem("vaPlusFavAccounts"),l(),c(),d()},c(),d()):t.innerHTML=""}function i(){const e=document.querySelector("account-filter");if(!e)return;const n=e.querySelectorAll("option"),t=document.getElementById("vaPlusFavAccountSelect");t&&(t.innerHTML="",n.forEach((e=>{if(e.value){const n=document.createElement("option");n.value=e.value,n.textContent=e.textContent,t.appendChild(n)}})))}function l(){const t=document.getElementById("vaPlusFavAccountsList");if(!t)return;const o=n();t.innerHTML="";let a=null;o.forEach(((o,r)=>{const i=document.createElement("li");i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="space-between",i.style.color="black",i.draggable=!0,i.dataset.idx=r;const s=document.createElement("span");s.textContent=o.name;const p=document.createElement("button");p.textContent="x",p.className="vaPlusFav-account-del-btn",p.addEventListener("click",(()=>{const t=n();t.splice(r,1),e(t),l(),c(),d()})),i.appendChild(s),i.appendChild(p),i.addEventListener("dragstart",(function(e){a=r,i.style.opacity="0.5",e.dataTransfer.effectAllowed="move"})),i.addEventListener("dragend",(function(){i.style.opacity=""})),i.addEventListener("dragover",(function(e){e.preventDefault(),i.style.background="#ffe5d0"})),i.addEventListener("dragleave",(function(){i.style.background=""})),i.addEventListener("drop",(function(t){if(t.preventDefault(),i.style.background="",null===a||a===r)return;const o=n(),s=o.splice(a,1)[0];o.splice(r,0,s),e(o),l(),c(),d()})),t.appendChild(i)}))}function c(){const e=document.querySelector("account-filter");if(!e)return;const n=e.querySelector("select");if(!n)return;let t=[];try{t=JSON.parse(localStorage.getItem("vaPlusFavAccounts"))||[]}catch(e){}const o=t.map((e=>e.value));Array.from(n.options).forEach((e=>{o.includes(e.value)?e.classList.add("saved-account-bold"):e.classList.remove("saved-account-bold")}))}function d(){const e=document.querySelector("account-filter");if(!e)return;const n=e.querySelector("select");if(!n)return;let t=[];try{t=JSON.parse(localStorage.getItem("vaPlusFavAccounts"))||[]}catch(e){}const o=t.map((e=>e.value));if(!o.length)return;const a=Array.from(n.options),r=[],i=[];for(a.forEach((e=>{o.includes(e.value)?(r.push(e),e.classList.add("saved-account-bold")):(i.push(e),e.classList.remove("saved-account-bold"))})),r.sort(((e,n)=>o.indexOf(e.value)-o.indexOf(n.value)));n.options.length>0;)n.remove(0);r.forEach((e=>n.add(e))),i.forEach((e=>n.add(e))),n.selectedIndex=0,n.dispatchEvent(new Event("change",{bubbles:!0}))}!function(){const e=document.createElement("style");e.textContent="\n            #vaPlusButton {\n                position: fixed;\n                right: 0px;\n                bottom: 24px;\n                border-radius: 16px 0 0 16px;\n                z-index: 99999;\n                background: rgb(255, 90, 0);\n                color: #fff;\n                border: none;\n                padding: 10px 10px 10px 18px;\n                font-size: 16px;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n                cursor: pointer;\n                transition: width 0.2s, min-width 0.2s, padding 0.2s, background 0.2s, color 0.2s;\n                overflow: hidden;\n                white-space: nowrap;\n                width: 54px;\n                min-width: 54px;\n                text-align: center;\n            }\n            #vaPlusButton.vaPlusButton-expanded {\n                width: 180px !important;\n                min-width: 180px !important;\n                padding: 10px 18px 10px 18px !important;\n            }\n            #vaPlusModalOverlay {\n                display: none;\n                position: fixed;\n                top: 0; left: 0; width: 100vw; height: 100vh;\n                background: rgba(0,0,0,0.15);\n                z-index: 100001;\n            }\n            #vaPlusModal {\n                display: none;\n                position: fixed;\n                right: 24px;\n                bottom: 70px;\n                background: #fff;\n                border: 1.5px solid #ff5a00;\n                border-radius: 12px;\n                box-shadow: 0 4px 24px rgba(0,0,0,0.18);\n                padding: 0;\n                z-index: 100002;\n                min-width: 340px;\n                font-size: 16px;\n                display: flex;\n                flex-direction: column;\n                font-family: Arial, sans-serif;\n            }\n            #vaPlusModalHeader {\n                font-weight: bold;\n                font-size: 20px;\n                padding: 28px 32px 12px 32px;\n                color: #ff5a00;\n                letter-spacing: 1px;\n                text-align: center;\n                border-bottom: 1px solid #eee;\n            }\n            #vaPlusModalTabs {\n                display: flex;\n                border-bottom: 1.5px solid #eee;\n                background: #fafafa;\n            }\n            .vaPlusTab {\n                flex: 1;\n                padding: 16px 0;\n                text-align: center;\n                font-size: 16px;\n                font-weight: 500;\n                color: #333;\n                cursor: pointer;\n                border-bottom: 2.5px solid transparent;\n                transition: border 0.2s, color 0.2s;\n                background: #fafafa;\n            }\n            .vaPlusTab.active {\n                color: #ff5a00;\n                border-bottom: 2.5px solid #ff5a00;\n                background: #fff;\n            }\n            #vaPlusModalContent {\n                padding: 24px 32px 24px 32px;\n                min-height: 120px;\n                background: #fff;\n            }\n            #vaPlusModalCloseBtn {\n                margin: 18px auto 22px auto;\n                background: rgb(255, 90, 0);\n                color: #fff;\n                border: none;\n                border-radius: 8px;\n                padding: 10px 28px;\n                font-size: 16px;\n                cursor: pointer;\n                font-weight: bold;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.10);\n                display: block;\n            }\n            /* --- SEKCJA ULUBIONE KONTA: identycznie jak w oryginalnym modalu --- */\n            #vaPlusFavAccountsSection .section {\n                border: 1px solid #ddd;\n                padding: 15px 20px;\n                margin-bottom: 15px;\n                border-radius: 8px;\n                background-color: #fafafa;\n            }\n            #vaPlusFavAccountsSection h2, #vaPlusFavAccountsSection h3 {\n                color: #000;\n                margin-bottom: 10px;\n                font-size: 1.5em;\n                font-weight: bold;\n            }\n            #vaPlusFavAccountsSection select {\n                width: 100%;\n                padding: 8px;\n                margin-bottom: 15px;\n                border: 1px solid #ccc;\n                border-radius: 5px;\n                font-size: 14px;\n                background-color: #fff;\n                color: black;\n                appearance: none;\n                -webkit-appearance: none;\n                -moz-appearance: none;\n                cursor: pointer;\n                background-image: url(\"data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23333' d='M2 0L0 2h4L2 0z'/></svg>\");\n                background-repeat: no-repeat;\n                background-position: right 10px center;\n                background-size: 8px 10px;\n            }\n            #vaPlusFavAccountsSection ul {\n                padding: 0;\n                list-style: none;\n                margin-top: 10px;\n                margin-bottom: 15px;\n                color: black;\n                max-height: 350px;\n                overflow-y: auto;\n                scrollbar-width: thin;\n                scrollbar-color: #ff5a00 transparent;\n            }\n            #vaPlusFavAccountsSection ul::-webkit-scrollbar {\n                width: 6px;\n            }\n            #vaPlusFavAccountsSection ul::-webkit-scrollbar-track {\n                background: transparent;\n                border-radius: 3px;\n            }\n            #vaPlusFavAccountsSection ul::-webkit-scrollbar-thumb {\n                background-color: #ff5a00;\n                border-radius: 3px;\n            }\n            #vaPlusFavAccountsSection ul::-webkit-scrollbar-thumb:hover {\n                background-color: #e04e00;\n            }\n            #vaPlusFavAccountsSection ul li {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 5px 8px;\n                border-bottom: 1px solid #eee;\n            }\n            #vaPlusFavAccountsSection .vaPlusFav-account-del-btn {\n                background: none;\n                color: black;\n                border: none;\n                font-weight: bold;\n                cursor: pointer;\n                font-size: 16px;\n            }\n            #vaPlusFavAccountsSection .vaPlusFav-account-del-btn:hover {\n                color: red;\n            }\n            #vaPlusFavAccountsSection button {\n                padding: 8px 16px;\n                margin-top: 10px;\n                margin-right: 5px;\n                cursor: pointer;\n                background-color: #ff5a00;\n                color: white;\n                border: none;\n                border-radius: 5px;\n                font-size: 14px;\n            }\n            #vaPlusFavAccountsSection button:hover {\n                background-color: #e04e00;\n            }\n            .saved-account-bold {\n                font-weight: 400 !important;\n                color: #ff5a00 !important;\n            }\n        ",document.head.appendChild(e)}(),function(){if(document.getElementById("vaPlusButton"))return;const e=document.createElement("button");e.id="vaPlusButton",e.textContent="vA+",e.onmouseenter=function(){e.textContent="vSprint Analytics+",e.classList.add("vaPlusButton-expanded")},e.onmouseleave=function(){e.textContent="vA+",e.classList.remove("vaPlusButton-expanded")},e.onclick=t,document.body.appendChild(e)}(),function(){if(document.getElementById("vaPlusModal"))return;const e=document.createElement("div");e.id="vaPlusModalOverlay",e.onclick=o,document.body.appendChild(e);const n=document.createElement("div");n.id="vaPlusModal",n.style.display="none",n.innerHTML='\n            <div id="vaPlusModalHeader">vSprint Analytics+</div>\n            <div id="vaPlusModalTabs">\n                <div class="vaPlusTab active" data-tab="favAccounts">Ulubione konta</div>\n            </div>\n            <div id="vaPlusModalContent"></div>\n            <button id="vaPlusModalCloseBtn">Zamknij</button>\n        ',document.body.appendChild(n),document.getElementById("vaPlusModalCloseBtn").onclick=o,r()}(),function e(n,t){const o=document.querySelector(n);o?t(o):setTimeout((()=>e(n,t)),500)}("account-filter",(e=>{i(),e.addEventListener("mousedown",c),e.addEventListener("mousedown",d)}));const s=document.getElementById("vaPlusButton");s&&s.addEventListener("click",(()=>{i(),l()})),function(){const e=document.getElementById("vaPlusModalTabs");if(e&&!document.querySelector('.vaPlusTab[data-tab="settings"]')){const n=document.createElement("div");n.className="vaPlusTab",n.dataset.tab="settings",n.innerHTML='<i class="fa-regular fa-gear" style="margin-right:8px;"></i>Ustawienia',e.appendChild(n)}function n(){const e=document.getElementById("vaPlusModalContent");e.innerHTML="";const n=t(),a=document.createElement("div");a.className="section";[{key:"obrot",label:"Raport obrotu",icon:"fa-chart-line"},{key:"odwiedziny",label:"Odwiedziny wg. ofert vSprint+",icon:"fa-eye"},{key:"kategorie",label:"Raport Trendów Kategorii",icon:"fa-chart-area"},{key:"ulubione",label:"Ulubione konta",icon:"fa-star"}].forEach((e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.color="#23272e",t.style.fontSize="16px",t.style.padding="8px 0",t.style.cursor="pointer";const r=document.createElement("input");r.type="checkbox",r.checked=!1!==n[e.key],r.style.width="20px",r.style.height="20px",r.style.accentColor="#ff5a00",r.onchange=function(){n[e.key]=r.checked,function(e){localStorage.setItem("vAPlusSettings",JSON.stringify(e))}(n),o()},t.appendChild(r);const i=document.createElement("span");i.textContent=e.label,i.style.fontFamily="Open Sans,Helvetica Neue,Helvetica,Arial,sans-serif",i.style.fontWeight="400",t.appendChild(i);const l=document.createElement("i");l.className=`fa-regular ${e.icon}`,l.style.fontSize="20px",l.style.width="24px",t.appendChild(l),a.appendChild(t)}));const r=document.createElement("div");r.textContent="in progress...",r.style.fontSize="12px",r.style.color="#aaa",r.style.margin="8px 0 0 2px",r.style.fontFamily="Open Sans,Helvetica Neue,Helvetica,Arial,sans-serif",a.appendChild(r);const i=document.createElement("label");i.style.display="flex",i.style.alignItems="center",i.style.gap="8px",i.style.color="#aaa",i.style.fontSize="16px",i.style.padding="8px 0",i.style.cursor="not-allowed";const l=document.createElement("input");l.type="checkbox",l.disabled=!0,l.style.width="20px",l.style.height="20px",l.style.accentColor="#aaa",i.appendChild(l);const c=document.createElement("span");c.textContent="Raport Top Oferty",c.style.fontFamily="Open Sans,Helvetica Neue,Helvetica,Arial,sans-serif",c.style.fontWeight="400",i.appendChild(c);const d=document.createElement("i");d.className="fa-regular fa-trophy",d.style.fontSize="20px",d.style.width="24px",d.style.color="#aaa",i.appendChild(d),a.appendChild(i);const s=document.createElement("div");s.style.fontSize="12px",s.style.color="#aaa",s.style.margin="8px 0 0 2px",s.style.fontFamily="Open Sans,Helvetica Neue,Helvetica,Arial,sans-serif",a.appendChild(s);const p=document.createElement("label");p.style.display="flex",p.style.alignItems="center",p.style.gap="8px",p.style.color="#aaa",p.style.fontSize="16px",p.style.padding="8px 0",p.style.cursor="not-allowed";const u=document.createElement("input");u.type="checkbox",u.disabled=!0,u.style.width="20px",u.style.height="20px",u.style.accentColor="#aaa",p.appendChild(u);const m=document.createElement("span");m.textContent="All-in-one Raport",m.style.fontFamily="Open Sans,Helvetica Neue,Helvetica,Arial,sans-serif",m.style.fontWeight="400",p.appendChild(m);const f=document.createElement("i");f.className="fa-regular fa-layer-group",f.style.fontSize="20px",f.style.width="24px",f.style.color="#aaa",p.appendChild(f),a.appendChild(p),e.appendChild(a)}function t(){try{return Object.assign({obrot:!0,odwiedziny:!0,kategorie:!0,ulubione:!0},JSON.parse(localStorage.getItem("vAPlusSettings")||"{}"))}catch(e){return{obrot:!0,odwiedziny:!0,kategorie:!0,ulubione:!0}}}function o(){const e=t(),n=document.getElementById("downloadDataButton");n&&(n.style.display=e.obrot?"":"none");const o=document.getElementById("customButtonVSprint");o&&(o.style.display=e.odwiedziny?"":"none");const a=document.getElementById("download-button");if(a&&(a.style.display=e.kategorie?"":"none"),document.body.classList.toggle("va-ulubione-disabled",!e.ulubione),e.ulubione){const e=document.getElementById("vaPlusFavAccountsSection");e&&(e.style.display="")}else{const e=document.querySelector("account-filter");if(e){const n=e.querySelector("select");n&&Array.from(n.options).forEach((e=>e.classList.remove("saved-account-bold")))}const n=document.getElementById("vaPlusFavAccountsSection");n&&(n.style.display="none")}}const a=document.getElementById("vaPlusButton");a&&a.addEventListener("click",(()=>{document.querySelectorAll(".vaPlusTab").forEach((e=>e.classList.remove("active")));const e=document.querySelector('.vaPlusTab[data-tab="settings"]');e&&e.classList.add("active"),n()})),function(){const e=document.querySelector('.vaPlusTab[data-tab="settings"]');e&&e.addEventListener("click",(function(){document.querySelectorAll(".vaPlusTab").forEach((e=>e.classList.remove("active"))),e.classList.add("active"),n()}))}(),document.querySelectorAll(".vaPlusTab").forEach((e=>{e.addEventListener("click",(function(){document.querySelectorAll(".vaPlusTab").forEach((e=>e.classList.remove("active"))),e.classList.add("active"),"settings"===e.dataset.tab?n():"favAccounts"===e.dataset.tab&&r()}))})),o();new MutationObserver(o).observe(document.body,{childList:!0,subtree:!0})}()}(),function(){"use strict";function e(){const e=document.createElement("style");e.innerHTML='\n\n            #vsprintModal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.8);\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                z-index: 1001;\n            }\n            #vsprintModal .modal-content {\n                background: white;\n                display: flex;\n                width: 90%;\n                height: 90%;\n                border-radius: 10px;\n                overflow: hidden;\n            }\n            #vsprintModal .options-column,\n            #TOPO_modal .TOPO_options-column\n {\n                width: 400px;\n                padding: 20px;\n                background: #f7f7f7;\n                border-right: 1px solid #ddd;\n                transition: width 0.3s ease;\n                display: flex;\n                flex-direction: column;\n                justify-content: flex-start;\n            }\n            #vsprintModal .data-column {\n                flex-grow: 1;\n                padding: 20px;\n                background: #fff;\n                overflow-y: hidden;\n            }\n\n            #TOPO_modal .checkbox-group{\ndisplay:flex;\nflex-direction:column;\ngap:8px;\n}\n\n#vsprintModal select,\n#vsprintModal input,\n#TOPO_modal select,\nTOPO_modal, input {\n    padding: 10px; /* Większy padding dla lepszego UX */\n    margin-bottom: 12px;\n    font-size: 16px; /* Większa czytelność */\n    border: 1px solid #ccc; /* Subtelna ramka */\n    border-radius: 6px; /* Zaokrąglone rogi dla nowoczesnego wyglądu */\n    background-color: #f9f9f9; /* Jasne, ale nie białe tło */\n    color: #333; /* Ciemniejszy tekst dla lepszej czytelności */\n    outline: none; /* Usunięcie domyślnej niebieskiej ramki */\n    transition: all 0.3s ease-in-out; /* Płynne przejście przy interakcji */\n}\n\n/* Efekt hover dla lepszej interaktywności */\n#vsprintModal select:hover,\n#vsprintModal input:hover {\n    background-color: #f1f1f1;\n    border-color: #bbb;\n}\n\n/* Efekt focus - podświetlenie pola po kliknięciu */\n#vsprintModal select:focus,\n#vsprintModal input:focus {\n    background-color: #fff;\n    border-color: #007bff; /* Niebieski kolor podkreślenia */\n    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);\n}\n\n/* Styl dla select */\n#vsprintModal select {\n    appearance: none; /* Usunięcie domyślnego stylu systemowego */\n    cursor: pointer;\n    background-image: url(\'data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23333" d="M2 0L0 2h4zM2 5l2-2H0z"/></svg>\');\n    background-repeat: no-repeat;\n    background-position: right 10px center;\n    background-size: 10px;\n    padding-right: 30px; /* Więcej miejsca dla strzałki */\n}\n\n/* Dla starszych przeglądarek */\n#vsprintModal select::-ms-expand {\n    display: none;\n}\n\n\n/* Usunięcie domyślnej ikony kalendarza w Chrome, Edge, Safari */\n#dataOd::-webkit-calendar-picker-indicator,\n#dataDo::-webkit-calendar-picker-indicator {\n    filter: invert(0.5); /* Zmiana koloru na ciemniejszy */\n    cursor: pointer;\n}\n\n/* Personalizacja kalendarza w Firefox */\n#dataOd, #dataDo {\n    -moz-appearance: textfield;\n}\n\n/* Dla Webkit (Chrome, Edge, Safari) */\n@media screen and (-webkit-min-device-pixel-ratio:0) {\n    #dataOd, #dataDo {\n        background-color: #f9f9f9;\n        color: #333;\n    }\n}\n\n            #vsprintModal button, #TOPO_modal button {\n                padding: 8px 16px;\n                margin-top: 10px;\n                cursor: pointer;\n                background-color: #ff5a00;\n                color: white;\n                border: none;\n                border-radius: 5px;\n            }\n            #vsprintModal button:hover, #TOPO_modal button:hover {\n                background-color: #0056b3;\n            }\n            #toggleOptions {\n                position: absolute;\n                top: 50px;\n                left: 20px;\n                background: #ccc;\n                padding: 5px;\n                cursor: pointer;\n                z-index: 10001;\n                border-radius: 5px;\n            }\n            #toggleOptions:after {\n                content: "▶";\n            }\n            #vsprintModal .options-column.collapsed {\n                width: 0;\n                padding: 0;\n                overflow: hidden;\n            }\n            #vsprintModal .data-column.expanded {\n                width: 100%;\n            }\n            #toggleOptions.collapsed:after {\n                content: "◁";\n            }\n\n.checkbox-group {\n    display: flex;\n    flex-direction: column; /* Ustawienie w kolumnie */\n    gap: 8px;\n}\n\n.checkbox-group div\n {\n    display: flex;\n    align-items: center; /* Wyrównanie checkboxa i tekstu w jednej linii */\n}\n\n#TOPO_modal .checkbox div{\n display: flex;\n    align-items: center; /* Wyrównanie checkboxa i tekstu w jednej linii */\n}\n\n.checkbox-group input[type="checkbox"] {\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border: 2px solid #007bff;\n    border-radius: 4px;\n    background-color: white;\n    position: relative;\n    cursor: pointer;\n    transition: all 0.3s ease-in-out;\n    margin-right: 10px; /* Odstęp między checkboxem a etykietą */\n}\n\n.checkbox-group input[type="checkbox"]:checked {\n    background-color: #007bff;\n    border-color: #0056b3;\n}\n\n.checkbox-group input[type="checkbox"]:checked::after {\n    content: "✔";\n    font-size: 14px;\n    color: #155724; /* Ciemnozielony haczyk */\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-weight: bold;\n}\n\n.checkbox-group input[type="checkbox"]:hover {\n    border-color: #0056b3;\n    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Efekt podświetlenia */\n}\n\n/* Stylowanie etykiety */\n.checkbox-group label {\n    display: flex;\n    align-items: center; /* Wyrównanie tekstu z checkboxem */\n    gap: 10px; /* Odstęp między checkboxem a etykietą */\n    font-size: 16px;\n    color: #212529; /* Ciemny tekst */\n    cursor: pointer;\n}\n\n\n\n\n\n/* Kontener z wynikami */\n.result-container {\n    display: flex;\n    margin-top: 20px;\n    padding: 20px;\n    height:90%;\n}\n\n/* Lewa kolumna z kafelkami */\n.left-column {\n    width: 200px;\n    overflow-y: scroll; /* Pionowe przewijanie */\n    height:100%;\n    margin-right: 20px;\n    color: black;\n    font-size: 13px;\n   padding-right: 20px;\n}\n\n/* Prawa kolumna z wykresem i przyciskami */\n.right-column {\n    flex: 1;  /* Szersza kolumna */\n    display: flex;\n    flex-direction: column;\n}\n\n/* Kontener wykresu */\n.chart-container {\n    width: 100%;\n    height: 100%; /* Wysokość wykresu */\n}\n\n/* Kontener z przyciskami */\n.button-container {\n    margin-bottom: 10px;\n    display: column;\n    flex-wrap: wrap; /* Umożliwienie zawijania przycisków, gdy jest ich dużo */\n    justify-content: space-around;\n}\n\n.button-container h4 {\n    margin: 0; /* Usunięcie domyślnego marginesu */\n    font-size: 20px; /* Zwiększenie rozmiaru czcionki nagłówka */\n    color:black;\n}\n\n/* Przyciski metryk */\n.metric-button {\n    background-color: lightgray;\n    margin: 5px;\n    padding: 10px;\n    border: none;\n    cursor: pointer;\n}\n\n/* Przyciski metryk - hover */\n.metric-button:hover {\n    background-color: #ddd;\n}\n\n/* Przyciski metryk - aktywne */\n.metric-button.active {\n    background-color: #ffffff !important; /* Zmieniamy tło na niebieskie dla aktywnego przycisku */\n    color: black !important; /* Zmieniamy kolor tekstu na biały */\n    border: 2px solid #ff5a00 !important; /* Ciemniejsza ramka */\n}\n\n\n/* Kafelek z imageUri i auctionName */\n.tile {\n    margin-bottom: 20px;\n    text-align: center;\n    padding: 15px;  /* Padding, aby zawartość była oddzielona od krawędzi kafelka */\n    background-color: white;  /* Tło kafelka */\n    border: 1px solid #ddd;  /* Szara ramka */\n    border-radius: 10px;  /* Zaokrąglone rogi */\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  /* Subtelny cień dla 3D efektu */\n    transition: all 0.3s ease;  /* Płynne przejście przy najechaniu */\n}\n\n/* Obrazek w kafelku */\n.tile img {\n    width: 100px;\n    height: 100px;\n    object-fit: cover;\n    border-radius: 5px;  /* Zaokrąglone rogi dla obrazka */\n    margin-bottom: 10px;  /* Odstęp między obrazkiem a podpisem */\n}\n\n/* Nazwa aukcji */\n.tile .auction-name {\n    font-weight: bold;\n    font-size: 14px;\n    color: #333;\ntext-transform: lowercase;\n}\n\n/* Efekt przy najechaniu myszką */\n.tile:hover {\n    transform: translateY(-5px);  /* Lekki unoszenie się przy najechaniu */\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);  /* Większy cień przy najechaniu */\n    border-color: #bbb;  /* Zmiana koloru ramki na ciemniejszy przy najechaniu */\n}\n\n/* Styl dla aktywnego kafelka */\n.tile.active {\n    border: 2px solid #ff5a00; /* Podświetlenie ramki aktywnego kafelka */\n    background-color: #e5e0dc; /* Lekko niebieskie tło */\n    transform: translateY(-5px); /* Zachowanie efektu hover */\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Nieco mocniejszy cień */\n}\n.close-button {\n    position: absolute;\n    top: 50px;\n    right: 15px;\n    background: none;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n    color: #333;\n}\n\n.close-button:hover {\n    color: red;\n}\n\n#progressBarContainer{\ncolor: black;\n}\n\n#progressBar{\ncolor: black;}\n\n#vsprintModal #progressText{\nfont-size:30px;\ntext-align:center;}\n\n#vsprintModal #percentageText{\nfont-size:30px;\ntext-align:center;}\n\n\n#vsprintModal progress {\n    width: 100%;\n    height: 25px;\n    border-radius: 12px;\n    background: #eee;\n    appearance: none;\n}\n\n#vsprintModal progress::-webkit-progress-value {\n    background: linear-gradient(to right, #4CAF50, #8BC34A);\n    border-radius: 12px;\n    transition: width 0.5s ease-in-out; /* Płynna animacja */\n}\n\n#vsprintModal progress::-webkit-progress-bar {\n    background-color: #ddd;\n    border-radius: 12px;\n    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);\n}\n\n#customButtonVSprint {\n    padding: 8px 16px;\n    border-radius: 10px;\n    font-size: 18px;\n    margin-left: 10px;\n    background-color: #ff5a00;\n    border: none;\n    float: right;\n    cursor: pointer; /* Zmieniamy kursor na wskazujący, aby pokazać, że można kliknąć */\n    transition: background-color 0.3s ease; /* Dodajemy efekt płynnej zmiany koloru */\n}\n\n#customButtonVSprint:hover {\n    background-color: #e64a00; /* Ciemniejszy odcień koloru po najechaniu */\n}\n\n\n/* STYLE TOPO*/\n/* Styl modala */\n#TOPO_modal {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 1000;\n}\n\n/* Zawartość modala */\n.TOPO_modal-content {\n    background-color: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);\n    text-align: center;\n}\n\n/* Styl dla label */\n.TOPO_modal-content label {\n    display: block;\n    margin: 10px 0;\n    font-size: 14px;\n    color: #333;\n}\n\n#TOPO_selectAccount{width:418px;}\n\n#TOPO_modal .TOPO_options-column {\nborder:none !important;\n}\n\n/* Styl dla select i input */\n.TOPO_modal-content select,\n.TOPO_modal-content input {\n    width: 100%;\n    padding: 8px;\n    margin-bottom: 10px;\n    border-radius: 4px;\n    border: 1px solid #ccc;\n}\n\n\n\n\n\n.TOPO_close-btn {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    background-color: transparent;\n    border: none;\n    font-size: 20px;\n    color: #333;\n    cursor: pointer;\n}\n\n.TOPO_close-btn:hover {\n    color: #ff0000; /* Kolor na hover */\n}\n\ninput[type="date"]::-webkit-calendar-picker-indicator {\n    filter: invert(1) brightness(0.2) !important;\n}\ninput[type="date"]::-ms-input-placeholder {\n    color: black !important;\n}\ninput[type="date"]::-webkit-input-placeholder {\n    color: black !important;\n}\ninput[type="date"]::-moz-placeholder {\n    color: black !important;\n}\ninput[type="date"]::-moz-placeholder {\n    color: black !important;\n}\ninput[type="date"]::-o-placeholder {\n    color: black !important;\n}\ninput[type="date"]::placeholder {\n    color: black !important;\n}\n       ',document.head.appendChild(e)}let n;function t(){if(n=document.querySelector("#vsprintModal .data-column"),document.querySelector("#vsprintModal"))return;const e=document.createElement("div");e.id="vsprintModal";const t=document.createElement("div");t.className="modal-content";const a=document.createElement("button");a.innerHTML="&times;",a.className="close-button",a.addEventListener("click",(()=>e.remove()));const r=document.createElement("div");r.className="options-column";const i=document.createElement("select");i.id="selectAccount",i.innerHTML="<option disabled selected>Wybierz konto</option>";const l=document.createElement("option");l.value="",l.textContent="Całe Allegro",i.appendChild(l);const d=document.getElementById("customSelect3");d&&d.querySelectorAll("option").forEach((e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.textContent,i.appendChild(n)}));const s=document.createElement("input");s.type="date",s.id="dataOd",s.placeholder="Data od";const p=document.createElement("input");p.type="date",p.id="dataDo",p.placeholder="Data do";const u=document.createElement("input");u.type="text",u.id="categoryNumber",u.placeholder="Podaj numer kategorii";const m=document.createElement("input");m.type="text",m.id="searchText",m.placeholder="Szukaj...";const f=document.createElement("div");f.className="checkbox-group";[{id:"offerName",label:"W nazwie oferty produktu"},{id:"productName",label:"W nazwie produktu"},{id:"offerTitle",label:"W nazwie oferty"},{id:"identifiers",label:"W identyfikatorach"}].forEach((e=>{const n=document.createElement("div"),t=document.createElement("input");t.type="checkbox",t.id=e.id,t.name="searchOption",t.addEventListener("change",(e=>function(e){document.querySelectorAll('input[name="searchOption"]').forEach((n=>{n!==e.target&&(n.checked=!1)}))}(e)));const o=document.createElement("label");o.setAttribute("for",e.id),o.textContent=e.label,n.appendChild(t),n.appendChild(o),f.appendChild(n)}));const g=document.createElement("button");g.id="toggleOptions",g.addEventListener("click",(()=>{r.classList.toggle("collapsed"),g.classList.toggle("collapsed"),t.querySelector(".data-column").classList.toggle("expanded")}));const y=document.createElement("button");y.innerText="Pobierz",y.id="fetchButton",y.addEventListener("click",o),y.addEventListener("click",(()=>{console.log("Pobieranie raportu...")})),r.appendChild(i),r.appendChild(s),r.appendChild(p),r.appendChild(u);const b=document.createElement("button");b.type="button",b.textContent="Ostatnie wyszukiwania",b.style.marginTop="auto",b.style.marginBottom="8px";const h=document.createElement("div");h.style.display="none",h.style.width="100%",h.style.maxHeight="160px",h.style.overflowY="auto",h.style.position="static",h.style.background="white",h.style.border="1px solid #ccc",h.style.zIndex="10000",b.onclick=()=>{"block"===h.style.display?h.style.display="none":(!function(){h.innerHTML="";const e=JSON.parse(localStorage.getItem("recentSearches")||"[]");if(!e.length){const e=document.createElement("div");return e.textContent="Brak wyszukiwań.",e.style.color="black",void h.appendChild(e)}e.forEach(((e,n)=>{const t=document.createElement("div");t.textContent=`${function(e){const n=document.getElementById("selectAccount");if(!n)return e||"";const t=Array.from(n.options).find((n=>n.value===e));return t?t.textContent:e||""}(e.selectAccount)} | ${e.dataOd||""} - ${e.dataDo||""} | ${e.searchText||""}`,t.style.cursor="pointer",t.style.color="black",t.style.padding="4px 8px",t.onmouseover=()=>t.style.background="#eee",t.onmouseout=()=>t.style.background="white",t.onclick=()=>{c(e),h.style.display="none"},h.appendChild(t)}))}(),h.style.display="block")};const x=document.createElement("button");x.type="button",x.textContent="Zapisane zdarzenia",x.style.marginBottom="8px",x.style.marginTop="";const v=document.createElement("div");v.style.display="none",v.style.width="100%",v.style.maxHeight="160px",v.style.overflowY="auto",v.style.position="static",v.style.background="white",v.style.border="1px solid #ccc",v.style.zIndex="10000",x.onclick=()=>{"block"===v.style.display?v.style.display="none":(!function(){v.innerHTML="";let e=JSON.parse(localStorage.getItem("offerEvents")||"{}"),n=[];if(Object.entries(e).forEach((([e,t])=>{t.forEach((t=>{n.push({offerId:e,...t})}))})),!n.length){const e=document.createElement("div");return e.textContent="Brak zapisanych zdarzeń.",e.style.color="black",void v.appendChild(e)}n.sort(((e,n)=>n.date.localeCompare(e.date))),n.forEach((e=>{const n=document.createElement("div");n.textContent=`${e.offerId} | ${e.date} | ${e.desc}`,n.style.cursor="pointer",n.style.color="black",n.style.padding="4px 8px",n.onmouseover=()=>n.style.background="#eee",n.onmouseout=()=>n.style.background="white",n.onclick=()=>{if(e.searchSnapshot){const n=new Date(e.date),t=new Date(n);t.setDate(n.getDate()-3);const o=new Date(n);o.setDate(n.getDate()+3),e.searchSnapshot.dataOd=t.toISOString().slice(0,10),e.searchSnapshot.dataDo=o.toISOString().slice(0,10),c(e.searchSnapshot)}v.style.display="none"},v.appendChild(n)}))}(),v.style.display="block")},r.appendChild(m),r.appendChild(f),r.appendChild(g),r.appendChild(b),r.appendChild(h),r.appendChild(x),r.appendChild(v),r.appendChild(y),n=document.createElement("div"),n.className="data-column",t.appendChild(r),t.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),e.addEventListener("click",(n=>{n.target===e&&e.remove()}))}function o(){if(function(e){let n=JSON.parse(localStorage.getItem("recentSearches")||"[]");const t=JSON.stringify({...e,dataOd:"",dataDo:""});n=n.filter((e=>JSON.stringify({...e,dataOd:"",dataDo:""})!==t)),n.unshift(e),n.length>10&&(n=n.slice(0,10));localStorage.setItem("recentSearches",JSON.stringify(n))}(d()),n=document.querySelector("#vsprintModal .data-column"),!n)return void console.error("Nie znaleziono elementu data-column!");n.innerHTML="";const e=document.getElementById("showButton");e&&e.remove();const t=document.getElementById("selectAccount").value,o=document.getElementById("searchText").value,a=document.getElementById("dataOd").value,r=document.getElementById("dataDo").value,i=document.getElementById("categoryNumber").value;let c="";const s=document.getElementById("offerName"),p=document.getElementById("productName"),u=document.getElementById("offerTitle"),m=document.getElementById("identifiers");s.checked?c="OfferOrProduct":p.checked?c="Product":u.checked?c="Offer":m.checked&&(c="AnyId");const f=function(e,n){const t=[];let o=new Date(e);const a=new Date(n);for(;o<=a;)t.push(new Date(o)),o.setDate(o.getDate()+1);return t}(a,r),g={};let y=0;n=document.querySelector("#vsprintModal .data-column");const b=document.createElement("div");b.id="progressBarContainer",n.appendChild(b);const h=document.createElement("progress");h.id="progressBar",h.max=f.length,h.value=0,b.appendChild(h);const x=document.createElement("div");x.id="progressText",x.textContent=`0 / ${f.length}`,b.appendChild(x);const v=document.createElement("div");function k(e,a){const r=e.toISOString().split("T")[0],s={includePhrases:o||"",includePhrasesMode:c,excludePhrases:"",excludePhrasesMode:"OfferOrProduct",sellerIds:t?[t]:[],includeCancelledAndReturned:!0,skip:0,take:1e3,marketplaceIds:["allegro-pl"],startDate:r+"T00:00:00.000Z",endDate:r+"T23:59:59.999Z",startDateTime:r+"T00:00:00.000Z",endDateTime:r+"T23:59:59.999Z",reportCode:"LASTFULL7DAYS"};i&&(s.categories=[i]);const p=1500*Math.random();setTimeout((()=>{fetch("https://edge.allegro.pl/analytics/reports/sale/byconversion",{headers:{accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL","content-type":"application/vnd.allegro.internal.v1+json",priority:"u=1, i","sec-ch-ua":'"Not A(Brand";v="8", "Chromium";v="132", "Google Chrome";v="132"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://allegro.pl/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify(s),method:"POST",mode:"cors",credentials:"include"}).then((e=>e.json())).then((e=>{console.log(`Raport dla ${r}:`,e),e.result.entries.forEach((e=>{const n=e.ids[0];g[n]||(g[n]={id:n,imageUri:e.imageUri,auctionName:e.auctionName,sellerName:e.seller.name,stats:[]}),g[n].stats.push({date:r,transactions:e.transactions,averageSoldItems:e.averageSoldItems,viewsCount:e.viewsCount,conversion:e.conversion,offerPrice:e.offerPrice,favoriteAdditionsCount:e.favoriteAdditionsCount,cartAdditionsCount:e.cartAdditionsCount})})),y++,h.value=y,x.textContent=`${y} / ${f.length}`;const t=Math.floor(y/f.length*100);if(v.textContent=`${t}%`,y===f.length){console.log("Wszystkie wyniki:",g),b.style.display="none";const o=document.createElement("button");function a(e,n,t){const o={viewsCount:"Wyświetlenia",conversion:"Konwersja",offerPrice:"Cena",averageSoldItems:"Śr. sprzedanych szt.",favoriteAdditionsCount:"Polubienia",cartAdditionsCount:"Koszyki"},a=t.stats.map((e=>({...e,date:new Date(e.date)}))).sort(((e,n)=>e.date-n.date)),r=a.map((e=>e.date.toLocaleDateString())),i=a.map((n=>n[e]));n.innerHTML="";const c=document.createElement("canvas");n.appendChild(c);const d=[];l(t.id).forEach(((e,n)=>{const t=new Date(e.date).toLocaleDateString(),o=r.findIndex((e=>e===t));-1!==o&&d.push({index:r[o],label:e.desc,color:"red"})}));const s=new Chart(c,{type:"bar",data:{labels:r,datasets:[{label:o[e]||e.charAt(0).toUpperCase()+e.slice(1),data:i,fill:!1,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{responsive:!0,scales:{x:{title:{display:!0,text:"Data"}},y:{title:{display:!0,text:o[e]||e.charAt(0).toUpperCase()+e.slice(1)}}},plugins:{tooltip:{enabled:!0,displayColors:!1,callbacks:{label:function(n){const t=n.label,r=a.find((e=>e.date.toLocaleDateString()===t));r[e];return[`${o.viewsCount}: ${r.viewsCount}`,`${o.conversion}: ${r.conversion}`,`${o.offerPrice}: ${r.offerPrice}`,`${o.averageSoldItems}: ${r.averageSoldItems}`,`${o.favoriteAdditionsCount}: ${r.favoriteAdditionsCount}`,`${o.cartAdditionsCount}: ${r.cartAdditionsCount}`]},title:function(n){const t=n[0].label,r=a.find((e=>e.date.toLocaleDateString()===t));return`${o[e]||e}: ${r[e]} (Data: ${r.date.toLocaleDateString()})`}}}}},plugins:[{id:"customVerticalLinePlugin",afterDraw:e=>{const{ctx:n,chartArea:t,scales:o}=e;e.config._eventLines&&e.config._eventLines.forEach((e=>{const a=o.x.getPixelForValue(e.index);n.save(),n.beginPath(),n.moveTo(a,t.top),n.lineTo(a,t.bottom),n.strokeStyle=e.color||"red",n.lineWidth=2,n.stroke(),n.fillStyle=e.color||"red",n.font="12px sans-serif",n.fillText(e.label,a+4,t.top+14),n.restore()}))}}]});s.config._eventLines=d}o.textContent="Pokaż",o.id="showButton",o.style.backgroundColor="#ff5a00",o.style.color="#fff",o.style.border="none",o.style.padding="10px 20px",o.style.fontSize="16px",o.style.cursor="pointer",o.style.borderRadius="5px",o.style.display="block",o.style.margin="20px auto",n.appendChild(o),o.addEventListener("click",(()=>{o.remove();const e=Object.values(g).map((e=>(e.totalViewsCount=e.stats.reduce(((e,n)=>Math.max(e,n.viewsCount)),0),e))).sort(((e,n)=>n.totalViewsCount-e.totalViewsCount)).slice(0,30);let t=e[0];const r=document.createElement("div");r.classList.add("result-container");const i=document.createElement("div");i.classList.add("left-column");const c=document.createElement("div");c.classList.add("right-column");const s=document.createElement("div");s.id="chartContainer",s.classList.add("chart-container"),c.appendChild(s);const p=document.createElement("div");p.classList.add("button-container");const u=document.createElement("h4");u.textContent="Wybierz dane do wyświetlenia:";p.appendChild(u),[{label:"Wyświetlenia",metric:"viewsCount"},{label:"Konwersja",metric:"conversion"},{label:"Transakcje",metric:"transactions"},{label:"Śr. sprzedanych szt.",metric:"averageSoldItems"},{label:"Cena",metric:"offerPrice"},{label:"Polubienia",metric:"favoriteAdditionsCount"},{label:"Koszyki",metric:"cartAdditionsCount"}].forEach((({label:e,metric:n})=>{const o=document.createElement("button");o.textContent=e,o.classList.add("metric-button"),o.addEventListener("click",(()=>{document.querySelectorAll(".metric-button").forEach((e=>e.classList.remove("active"))),o.classList.add("active"),a(n,s,t)})),p.appendChild(o)})),c.appendChild(p);const m=document.createElement("form");m.style.display="flex",m.style.gap="8px",m.style.marginBottom="10px",m.style.alignItems="center";const f=document.createElement("input");f.type="date",f.required=!0,f.removeAttribute("readonly"),f.style.webkitAppearance="",f.style.appearance="",f.style.background="",f.style.color="";const y=document.createElement("input");y.type="text",y.placeholder="Opis zdarzenia",y.required=!0;const b=document.createElement("button");b.type="submit",b.textContent="Dodaj zdarzenie",m.appendChild(f),m.appendChild(y);const h=document.createElement("button");h.type="button",h.textContent="Edytuj zdarzenia",h.style.marginLeft="0",h.style.paddingLeft="8px",h.style.paddingRight="8px",m.appendChild(b),m.appendChild(h),p.appendChild(m);const x=document.createElement("div");x.style.display="none",x.style.maxHeight="120px",x.style.overflowY="auto",p.appendChild(x);let v=!1;function k(){if(x.innerHTML="",!t)return;const e=l(t.id);if(!e.length)return x.textContent="Brak zapisanych zdarzeń.",void(x.style.color="black");e.forEach(((e,n)=>{const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="8px",o.style.marginBottom="4px";const r=document.createElement("span");r.textContent=`${e.date} — ${e.desc}`,r.style.color="black",o.appendChild(r);const i=document.createElement("button");i.textContent="Usuń",i.type="button",i.onclick=()=>{!function(e){const n=l(t.id);n.splice(e,1);let o=JSON.parse(localStorage.getItem("offerEvents")||"{}");o[t.id]=n,localStorage.setItem("offerEvents",JSON.stringify(o)),k(),a("viewsCount",s,t)}(n)},o.appendChild(i),x.appendChild(o)}))}h.addEventListener("click",(()=>{v=!v,x.style.display=v?"block":"none",h.textContent=v?"Ukryj zdarzenia":"Edytuj zdarzenia",v&&k()})),m.addEventListener("submit",(function(){v&&k()})),i.addEventListener("click",(()=>{v&&k()})),m.addEventListener("submit",(function(e){e.preventDefault(),t&&(!function(e,n,t){let o=JSON.parse(localStorage.getItem("offerEvents")||"{}");o[e]||(o[e]=[]);o[e].push({date:n,desc:t,searchSnapshot:d()}),localStorage.setItem("offerEvents",JSON.stringify(o))}(t.id,f.value,y.value),alert("Zdarzenie zapisane!"),m.reset(),a("viewsCount",s,t))})),e.forEach(((e,n)=>{const o=document.createElement("div");o.classList.add("tile");const r=document.createElement("img");r.src=e.imageUri,r.alt=e.auctionName,r.classList.add("auction-image"),o.appendChild(r);const l=document.createElement("div");l.classList.add("auction-info");const c=document.createElement("a");c.href=`https://allegro.pl/oferta/${e.id}`,c.textContent=e.id,c.target="_blank",c.classList.add("auction-id-link");const d=document.createElement("span");d.classList.add("auction-name"),d.textContent=` - ${e.auctionName}`,l.appendChild(c),l.appendChild(d),o.appendChild(l),i.appendChild(o),o.addEventListener("click",(()=>{t=e;document.querySelectorAll(".tile").forEach((e=>e.classList.remove("active"))),o.classList.add("active"),a("viewsCount",s,t),k()}))})),r.appendChild(i),r.appendChild(c),n.appendChild(r)}))}})).catch((e=>{console.error(`Błąd przy pobieraniu raportu dla ${r}:`,e),alert(`Wystąpił błąd podczas pobierania raportu dla ${r}.`)}))}),p)}v.id="percentageText",b.appendChild(v),f.forEach(((e,n)=>{k(e)}))}function a(){console.log("addDetailsButtons wywołana");let e=function(){let e=new Date;e.setDate(e.getDate()-1);let n=new Date(e);n.setDate(n.getDate()-6);let t=e=>e.toISOString().split("T")[0];return{start:t(n),end:t(e)}}();document.querySelectorAll("table tbody tr").forEach((n=>{if(!n.querySelector("td img.dropdown-toggle")){let t=n.querySelector("a[target]");if(t){let o=t.getAttribute("href").match(/item=(\d+)/)[1],a=`\n                            <td class="mjyo_6x mg9e_8 m09p_40 mj7a_8 mx7m_1 mnyp_co mlkp_ag mgn2_14 mupj_5k _33c33_lWqnO mgmw_wo _33c33_D4nR5 mzmg_6m mh36_0">\n                                <div class="dropdown">\n                                    <img class="dropdown-toggle mg9e_8 mj7a_0 mqen_m6"\n                                        src="https://a.allegroimg.com/original/345306/13b7a0e047fd8735a283a540f5e7/action-common-three-dots-8d6d31cbb0"\n                                        style="cursor: pointer;">\n                                    <div class="dropdown-menu" style="display:none; position: relative; background-color: #2E2E2E; padding: 8px; border-radius: 4px; border: 1px solid #b1b1b1fe; margin-left: 10px;">\n                                        <a style="color: #00a891; text-decoration: none"\n                                            href="https://allegro.pl/moje-allegro/sprzedaz/allegro-analytics/szczegoly-oferty?start=${e.start}&end=${e.end}&context=My&marketplaceId=allegro-pl&auctionId=${o}"\n                                            target="_blank" class="dropdown-item">\n                                            Szczegóły oferty\n                                        </a>\n                                    </div>\n                                </div>\n                            </td>`;n.insertAdjacentHTML("beforeend",a);let r=n.querySelector("img.dropdown-toggle"),i=n.querySelector("div.dropdown-menu");r.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),i.style.display="none"===i.style.display?"block":"none"})),document.addEventListener("click",(function(e){r.contains(e.target)||i.contains(e.target)||(i.style.display="none")}))}}}))}function r(){console.log("Otwarte modal z raportem vSprint");const e=document.createElement("div");e.id="TOPO_modal";const n=document.createElement("div");n.classList.add("TOPO_modal-content");const t=document.createElement("button");t.innerText="X",t.classList.add("TOPO_close-btn"),t.addEventListener("click",i);const o=document.createElement("div");o.classList.add("TOPO_options-column");const a=document.createElement("select");a.id="TOPO_selectAccount";const r=document.querySelector("#TOPO_customSelect2");r&&Array.from(r.options).forEach((e=>{const n=document.createElement("option");n.value=e.value,n.innerText=e.innerText,a.appendChild(n)}));const l=document.createElement("input");l.type="text",l.id="TOPO_search",l.placeholder="Wpisz frazę do wyszukiwania";const c=document.createElement("input");c.type="number",c.id="TOPO_inputOffers",c.placeholder="Wpisz ilość ofert";const d=document.createElement("button");d.innerText="Pobierz",d.classList.add("TOPO_download-btn");const s=document.createElement("div");s.className="checkbox-group";function p(e){return 1===e?"Odpowiednie":0===e?"Do poprawy":"Brak danych"}[{id:"offerName",label:"W nazwie oferty produktu"},{id:"productName",label:"W nazwie produktu"},{id:"offerTitle",label:"W nazwie oferty"},{id:"identifiers",label:"W identyfikatorach"}].forEach((e=>{const n=document.createElement("div"),t=document.createElement("input");t.type="checkbox",t.id=e.id,t.name="searchOption";const o=document.createElement("label");o.setAttribute("for",e.id),o.innerText=e.label,n.appendChild(t),n.appendChild(o),s.appendChild(n),t.addEventListener("change",(function(){document.querySelectorAll('input[name="searchOption"]').forEach((e=>{e!==t&&(e.checked=!1)}))}))})),o.appendChild(a),o.appendChild(c),o.appendChild(l),o.appendChild(s),o.appendChild(d),n.appendChild(t),n.appendChild(o),e.appendChild(n),document.body.appendChild(e),d.addEventListener("click",(function(){const e=a.value,n=l.value,t=parseInt(c.value)||10,o=document.querySelector('input[name="searchOption"]:checked'),r={repository:"BuyBoxDetails",filter:[{columnName:o?{offerName:"OfferNameOrProductName",productName:"ProductName",offerTitle:"OfferTitle",identifiers:"Identifiers"}[o.id]:"OfferNameOrProductName",operator:"Eq",values:n},{columnName:"SellerId",operator:"In",values:[e]},{columnName:"MarketplaceId",operator:"In",values:["allegro-pl"]}],groupBy:["OfferId","SellerId"],select:["OfferId","ProductId","OfferName","OfferImageUrl","SellerId","PromotionScore","SalesQualityScore","OfferTypeScore","PictureQualityScore","BestPriceGuaranteeScore","CurrentPriceScore","DeliveryTimeScore","PriceDifference"],sort:[{column:"Sale",type:"Desc"},{column:"OfferName",type:"Asc"}],take:t,page:1};d.textContent="Oczekuje...",fetch("https://edge.allegro.pl/analytics/data/report",{method:"POST",headers:{accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL","content-type":"application/vnd.allegro.internal.v1+json",priority:"u=1, i","sec-ch-ua":'"Not A(Brand";v="8", "Chromium";v="132", "Google Chrome";v="132"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},body:JSON.stringify(r),mode:"cors",credentials:"include"}).then((e=>e.json())).then((e=>{console.log("Otrzymane dane:",e),e.reportId?function(e){const n=setInterval((()=>{fetch(`https://edge.allegro.pl/analytics/data/report/${e}`,{method:"GET",headers:{accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL"},credentials:"include"}).then((e=>e.json())).then((e=>{console.log("Sprawdzanie statusu raportu:",e),"Completed"===e.reportStatus&&e.report&&(clearInterval(n),d.textContent="Raport gotowy",function(e){const n=["ID","Tytuł","Promowanie","Jakość sprzedaży","Stan produktu","Jakość zdjęć","GNC","Różnica Ceny","Czas dostawy"],t=e.records.map((e=>[e[0],e[2],p(e[5]),p(e[6]),p(e[7]),p(e[8]),p(e[9]),null===e[12]?"Odpowiednia":e[12],p(e[10])])),o=XLSX.utils.aoa_to_sheet([n,...t]),a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,o,"Raport"),XLSX.writeFile(a,"raport.xlsx")}(e.report))})).catch((e=>{console.error("Błąd podczas sprawdzania statusu raportu:",e)}))}),5e3)}(e.reportId):(console.error("Brak reportId w odpowiedzi!"),d.textContent="Błąd!")})).catch((e=>{console.error("Błąd podczas pobierania danych:",e),d.textContent="Błąd!"}))}))}function i(){const e=document.getElementById("TOPO_modal");e&&(e.style.display="none",document.body.removeChild(e))}function l(e){return JSON.parse(localStorage.getItem("offerEvents")||"{}")[e]||[]}window.addEventListener("load",(function(){"https://allegro.pl/moje-allegro/sprzedaz/allegro-analytics/wizyty-oferty"===window.location.href&&(e(),function(){let e=1,n=1,t=1;document.querySelectorAll("report-filter button").forEach((n=>{n.id=`customButton${e}`,n.classList.add("custom-button"),e++})),document.querySelectorAll("report-filter select").forEach((e=>{e.id=`customSelect${n}`,e.classList.add("custom-select"),n++})),document.querySelectorAll("report-filter input").forEach((e=>{e.id=`customInput${t}`,e.classList.add("custom-input"),t++}))}(),function(){console.log("Funkcja addElements została wywołana.");const e=document.createElement("button");e.innerText="Raport vSprint",e.id="customButtonVSprint",e.style.position="fixed",e.style.top="10px",e.style.right="20px",e.style.zIndex="99999",e.style.background="#23272e",e.style.color="#fff",e.style.border="1.5px solid #ff5a00",e.style.borderRadius="8px",e.style.padding="10px 20px",e.style.fontSize="16px",e.style.cursor="pointer",e.style.boxShadow="0 2px 8px rgba(0,0,0,0.10)",e.style.fontWeight="bold",e.style.transition="background 0.2s, color 0.2s",e.onmouseenter=function(){e.style.background="#ff5a00",e.style.color="#fff"},e.onmouseleave=function(){e.style.background="#23272e",e.style.color="#fff"},document.body.appendChild(e),e.addEventListener("click",t)}(),a())})),window.addEventListener("load",(function(){"https://allegro.pl/moje-allegro/sprzedaz/allegro-analytics/wybor-top-oferty"===window.location.href&&(e(),function(){let e=1,n=1,t=1;document.querySelectorAll(".root button").forEach((n=>{n.id=`TOPO_customButton${e}`,n.classList.add("TOPO_custom-button"),e++})),document.querySelectorAll(".root select").forEach((e=>{e.id=`TOPO_customSelect${n}`,e.classList.add("TOPO_custom-select"),n++})),document.querySelectorAll(".root input").forEach((e=>{e.id=`TOPO_customInput${t}`,e.classList.add("TOPO_custom-input"),t++}))}(),function(){const e=document.querySelector(".root button");if(e){const n=document.createElement("button");n.innerText="vSprint raport",n.id="customButtonVSprint",e.insertAdjacentElement("afterend",n),n.style.marginLeft="10px",n.addEventListener("click",r)}}())}));function c(e){document.getElementById("selectAccount").value=e.selectAccount||"",document.getElementById("dataOd").value=e.dataOd||"",document.getElementById("dataDo").value=e.dataDo||"",document.getElementById("searchText").value=e.searchText||"",document.getElementById("categoryNumber").value=e.categoryNumber||"",["offerName","productName","offerTitle","identifiers"].forEach((n=>{document.getElementById(n).checked=e.searchOption===n}))}function d(){return{selectAccount:document.getElementById("selectAccount").value,dataOd:document.getElementById("dataOd").value,dataDo:document.getElementById("dataDo").value,searchText:document.getElementById("searchText").value,categoryNumber:document.getElementById("categoryNumber").value,searchOption:["offerName","productName","offerTitle","identifiers"].find((e=>document.getElementById(e).checked))}}new MutationObserver((function(){a()})).observe(document.body,{childList:!0,subtree:!0})}(),function(){"use strict";if("/moje-allegro/sprzedaz/allegro-analytics/sprzedaz-kategorii"!==window.location.pathname)return;const e=document.createElement("style");e.textContent="\n        #download-button {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 1000;\n            background: #23272e;\n            color: #fff;\n            border: 1.5px solid #ff5a00;\n            border-radius: 8px;\n            padding: 10px 20px;\n            font-size: 16px;\n            font-weight: bold;\n            cursor: pointer;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.10);\n            transition: background 0.2s, color 0.2s;\n        }\n        #download-button:hover {\n            background: #ff5a00;\n            color: #fff;\n        }\n        #modal {\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            min-width: 340px;\n            max-width: 400px;\n            background: #fff;\n            border-radius: 12px;\n            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);\n            z-index: 2000;\n            padding: 30px 24px 24px 24px;\n            font-family: Arial, sans-serif;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n        }\n        #modal-content {\n            width: 100%;\n            padding: 0;\n            text-align: center;\n            position: relative;\n        }\n        .modal-title {\n            font-size: 20px;\n            font-weight: bold;\n            color: #23272e;\n            margin-bottom: 18px;\n        }\n        #account-select {\n            width: 100%;\n            padding: 8px 12px;\n            font-size: 14px;\n            border: 1px solid #ccc;\n            border-radius: 5px;\n            background-color: #fff;\n            color: black;\n            appearance: none;\n            background-image: url(\"data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23333' d='M2 0L0 2h4L2 0z'/></svg>\");\n            background-repeat: no-repeat;\n            background-position: right 10px center;\n            background-size: 8px 10px;\n            margin-bottom: 18px;\n        }\n        #account-select:focus {\n            outline: none;\n            border-color: #ff5a00;\n            box-shadow: 0 0 5px rgba(255, 90, 0, 0.2);\n        }\n        .modal-button {\n            padding: 8px 16px;\n            cursor: pointer;\n            background-color: #ff5a00;\n            color: white;\n            border: none;\n            border-radius: 5px;\n            font-size: 14px;\n            transition: background-color 0.3s ease;\n            margin-top: 10px;\n            margin-right: 5px;\n        }\n        .modal-button:hover {\n            background: #e04e00;\n            color: #fff;\n        }\n        .close-button {\n            position: absolute;\n            top: -30px;\n            right: -25px;\n            background: none;\n            border: none;\n            font-size: 22px;\n            cursor: pointer;\n            color: #ff5a00;\n            z-index: 10;\n        }\n        .close-button:hover {\n            color: #e04e00;\n        }\n        .loading-spinner {\n            margin: 24px auto 0 auto;\n            border: 4px solid #f3f3f3;\n            border-top: 4px solid #ff5a00;\n            border-radius: 50%;\n            width: 36px;\n            height: 36px;\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        .loading-text {\n            margin-top: 18px;\n            color: #ff5a00;\n            font-size: 16px;\n            font-weight: bold;\n        }\n        .progress-bar-container {\n            width: 100%;\n            background: #eee;\n            border-radius: 8px;\n            margin: 18px 0 0 0;\n            height: 18px;\n            overflow: hidden;\n        }\n        .progress-bar {\n            height: 100%;\n            background: #ff5a00;\n            width: 0%;\n            transition: width 0.3s;\n        }\n        .progress-bar-label {\n            margin-top: 8px;\n            font-size: 14px;\n            color: #23272e;\n            font-weight: bold;\n        }\n    ",document.head.appendChild(e);const n=document.createElement("button");n.id="download-button",n.innerText="Pobierz dane",document.body.appendChild(n),n.onclick=function(){const e=function(){const e=new Date,n=new Date(e.setDate(e.getDate()-1));return{startDate:new Date(e.setDate(e.getDate()-89)).toISOString().split("T")[0]+"T00:00:00.000Z",endDate:n.toISOString().split("T")[0]+"T23:59:59.999Z"}}(),n=document.createElement("div");n.id="modal";const t=document.createElement("div");t.id="modal-content";const o=document.createElement("div");o.className="modal-title",o.textContent="Raport trendów sprzedaży wg kategorii",t.appendChild(o);const a=document.createElement("button");a.innerText="✖",a.className="close-button",a.onclick=function(){document.body.removeChild(n)},t.appendChild(a);const r=document.querySelector("account-filter");if(!r)return t.appendChild(document.createTextNode("Nie znaleziono listy kont. Poczekaj na załadowanie strony.")),n.appendChild(t),void document.body.appendChild(n);const i=r.querySelectorAll("option"),l=document.createElement("select");l.id="account-select",i.forEach((e=>{const n=document.createElement("option");n.value=e.value,n.textContent=e.textContent,l.appendChild(n)})),t.appendChild(l);const c=document.createElement("button");c.innerText="Pobierz dane",c.className="modal-button",t.appendChild(c);const d=document.createElement("div");d.style.width="100%",t.appendChild(d);let s=null,p=[],u=[];c.onclick=async function(){c.disabled=!0,c.innerText="",d.innerHTML='<div class="loading-spinner"></div><div class="loading-text">Ładowanie danych...</div>';const n=l.value;if(n)try{const t=await fetch("https://edge.allegro.pl/analytics/reports/sale/bycategory",{headers:{accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL","content-type":"application/vnd.allegro.internal.v1+json",priority:"u=1, i","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://allegro.pl/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({sellerIds:[n],skip:0,take:1e3,marketplaceIds:["allegro-pl"],startDate:e.startDate,endDate:e.endDate,reportCode:"LASTFULL7DAYS"}),method:"POST",mode:"cors",credentials:"include"});if(!t.ok)throw new Error("Network response was not ok: "+t.statusText);const o=(await t.json()).result.entries;o&&Array.isArray(o)?(s=o.sort(((e,n)=>n.saleParticipation.sale-e.saleParticipation.sale)).slice(0,10).map((e=>e.category.id)),d.innerHTML='<div class="loading-text">Teraz pobierz raport szczegółowy</div>',c.innerText="Pobierz dane kategorii",c.disabled=!1,c.onclick=async function(){c.disabled=!0,c.innerText="",d.innerHTML='<div class="loading-text">Ładowanie raportu...</div>';const e=document.createElement("div");e.className="progress-bar-container";const n=document.createElement("div");n.className="progress-bar",e.appendChild(n);const t=document.createElement("div");t.className="progress-bar-label",d.appendChild(e),d.appendChild(t),p=[],u=[];const{startDate:a,endDate:r}=function(){const e=new Date;e.setDate(1),e.setHours(0,0,0,0);const n=new Date(e);return n.setMonth(e.getMonth()-13),n.setDate(2),{startDate:n.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0]}}();let i=0;for(let e=0;e<10;e++){const o=s[e];try{const e=await fetch("https://edge.allegro.pl/analytics/reports/sale/byday",{headers:{accept:"application/vnd.allegro.internal.v1+json","accept-language":"pl-PL","content-type":"application/vnd.allegro.internal.v1+json",priority:"u=1, i","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://allegro.pl/",referrerPolicy:"strict-origin-when-cross-origin",body:JSON.stringify({includePhrasesMode:"OfferOrProduct",excludePhrasesMode:"OfferOrProduct",categories:[o],categoryId:o,sellerIds:[],includeCancelledAndReturned:!0,marketplaceIds:["allegro-pl"],periods:[{startDate:a+"T00:00:00.000Z",endDate:r+"T00:00:00.000Z"}],reportCode:"LASTFULL7DAYS"}),method:"POST",mode:"cors",credentials:"include"});if(!e.ok)throw new Error("Network response was not ok: "+e.statusText);const n=(await e.json()).result.saleAggregations;if("object"==typeof n&&null!==n){for(const[e,t]of Object.entries(n))p.push({categoryId:o,date:e,saleParticipation:t.saleParticipation.sale});const e=Object.entries(n).map((([e,n])=>({categoryId:o,date:e,saleParticipation:n.saleParticipation.sale})));u.push(...e)}}catch(e){return d.innerHTML='<div class="loading-text" style="color:red;">Błąd podczas pobierania danych dla kategorii '+o+"</div>",c.innerText="Pobierz dane kategorii",void(c.disabled=!1)}i++,n.style.width=i/10*100+"%",t.textContent=`Pobrano ${i} z 10 kategorii`,await new Promise((e=>setTimeout(e,Math.floor(500*Math.random())+1e3)))}d.innerHTML='<div class="loading-text" style="color:green;">Dane pobrane! Teraz możesz pobrać plik Excel.</div>',c.innerText="Pobierz Excel",c.disabled=!1,c.onclick=function(){if(!u.length)return void(d.innerHTML='<div class="loading-text" style="color:red;">Brak danych do pobrania w formacie Excel.</div>');const e=XLSX.utils.book_new(),n=(()=>{const e=[];for(const n of o)e.push({"ID kategorii":n.category.id,"Nazwa kategorii":n.category.name,"Wartość sprzedaży":isNaN(n.overallSale.sale)?0:n.overallSale.sale,"Udział sprzedaży (%)":isNaN(n.saleParticipation.sale)?"0%":(100*n.saleParticipation.sale).toFixed(2)+"%"});return XLSX.utils.json_to_sheet(e)})();XLSX.utils.book_append_sheet(e,n,"Dane");const t=new Set,a={};p.forEach((e=>{const n=e.categoryId,o=new Date(e.date),r=o.getMonth()+1,i=o.getFullYear(),l=`${String(r).padStart(2,"0")}.${i}`;t.add(l),a[n]||(a[n]={}),a[n][l]=(a[n][l]||0)+(isNaN(e.saleParticipation)?0:e.saleParticipation)}));const r=Array.from(t).sort(((e,n)=>new Date(e)-new Date(n))),i=[["ID kategorii",...r]];Object.entries(a).forEach((([e,n])=>{const t=[e];r.forEach((e=>{t.push(n[e]||0)})),i.push(t)}));const l=XLSX.utils.aoa_to_sheet(i);XLSX.utils.book_append_sheet(e,l,"Kategorie");const c=[["ID kategorii",...r]];Object.entries(a).forEach((([e,n])=>{const t=Math.max(...Object.values(n)),o=[e];r.forEach((e=>{const a=n[e]||0,r=t>0?(a/t*100).toFixed(2)+"%":"0%";o.push(r)})),c.push(o)}));const s=XLSX.utils.aoa_to_sheet(c);XLSX.utils.book_append_sheet(e,s,"Trendy Kategorii"),XLSX.writeFile(e,"dane.xlsx"),d.innerHTML='<div class="loading-text" style="color:green;">Plik Excel został wygenerowany!</div>'}}):(d.innerHTML='<div class="loading-text" style="color:red;">Brak danych do pobrania top 10 kategorii.</div>',c.innerText="Pobierz dane",c.disabled=!1)}catch(e){d.innerHTML='<div class="loading-text" style="color:red;">Błąd podczas pobierania danych.</div>',c.innerText="Pobierz dane",c.disabled=!1}},n.appendChild(t),document.body.appendChild(n)};const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js",t.onload=function(){console.log("Biblioteka XLSX została załadowana.")},document.head.appendChild(t)}();