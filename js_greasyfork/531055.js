// ==UserScript==
// @author      Renji-xD
// @name        ttu-whispersync
// @namespace   https://github.com/Renji-XD
// @match       https://reader.ttsu.app/*
// @match       http://localhost:5173/*
// @version     1.0.11
// @description Listen to audiobooks with ttu ebook-reader
// @icon https://raw.githubusercontent.com/Renji-XD/ttu-whispersync/main/src/assets/icons/icon64.png
// @resource mediaInfo https://cdn.jsdelivr.net/npm/mediainfo.js@0.2.1/dist/MediaInfoModule.wasm
// @resource ffmpeg-core.js https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.js
// @resource ffmpeg-core.wasm https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.wasm
// @run-at      document-idle
// @noframes
// @grant       GM_getResourceURL
// @supportURL  https://github.com/Renji-XD/ttu-whispersync/issues
// @homepageURL https://github.com/Renji-XD/ttu-whispersync
// @downloadURL https://update.greasyfork.org/scripts/531055/ttu-whispersync.user.js
// @updateURL https://update.greasyfork.org/scripts/531055/ttu-whispersync.meta.js
// ==/UserScript==
var f7=Object.defineProperty;var d7=(Gn,wt,an)=>wt in Gn?f7(Gn,wt,{enumerable:!0,configurable:!0,writable:!0,value:an}):Gn[wt]=an;var Qn=(Gn,wt,an)=>(d7(Gn,typeof wt!="symbol"?wt+"":wt,an),an),s_=(Gn,wt,an)=>{if(!wt.has(Gn))throw TypeError("Cannot "+an)};var cn=(Gn,wt,an)=>(s_(Gn,wt,"read from private field"),an?an.call(Gn):wt.get(Gn)),zs=(Gn,wt,an)=>{if(wt.has(Gn))throw TypeError("Cannot add the same private member more than once");wt instanceof WeakSet?wt.add(Gn):wt.set(Gn,an)},Hl=(Gn,wt,an,Ta)=>(s_(Gn,wt,"write to private field"),Ta?Ta.call(Gn,an):wt.set(Gn,an),an);(function(){"use strict";var gi,Us,Ts,Eo,So,Cc,ni;var Gn=typeof document<"u"?document.currentScript:null;function wt(){}function an(t,e){for(const n in e)t[n]=e[n];return t}function Ta(t){return t()}function q1(){return Object.create(null)}function vn(t){t.forEach(Ta)}function Ai(t){return typeof t=="function"}function Tn(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ul;function Mo(t,e){return t===e?!0:(Ul||(Ul=document.createElement("a")),Ul.href=e,t===Ul.href)}function a_(t){return Object.keys(t).length===0}function ts(t,...e){if(t==null){for(const r of e)r(void 0);return wt}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Mt(t){let e;return ts(t,n=>e=n)(),e}function fe(t,e,n){t.$$.on_destroy.push(ts(e,n))}function Ro(t,e,n,r){if(t){const i=Z1(t,e,n,r);return t[0](i)}}function Z1(t,e,n,r){return t[1]&&r?an(n.ctx.slice(),t[1](r(e))):n.ctx}function Lo(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const s=[],o=Math.max(e.dirty.length,i.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function Po(t,e,n,r,i,s){if(i){const o=Z1(e,n,r,s);t.p(o,i)}}function Io(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function pe(t,e,n){return t.set(n),e}function ka(t){return t&&Ai(t.destroy)?t.destroy:wt}let J1=typeof window<"u"?t=>requestAnimationFrame(t):wt;const Ic=typeof window<"u"?window:typeof globalThis<"u"?globalThis:globalThis||void 0||self;function oe(t,e){t.appendChild(e)}function de(t,e,n){t.insertBefore(e,n||null)}function ce(t){t.parentNode&&t.parentNode.removeChild(t)}function ge(t){return document.createElement(t)}function Xs(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ft(t){return document.createTextNode(t)}function me(){return Ft(" ")}function Dr(){return Ft("")}function Ke(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function Wl(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Aa(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function re(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Bc(t){return t===""?null:+t}function l_(t){return Array.from(t.childNodes)}function ln(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ci(t,e){t.value=e??""}function Mr(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function jl(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Q1(t){const e=t.querySelector(":checked");return e&&e.__value}function ht(t,e,n){t.classList.toggle(e,!!n)}function u_(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}class c_{constructor(e=!1){Qn(this,"is_svg",!1);Qn(this,"e");Qn(this,"n");Qn(this,"t");Qn(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,r=null){this.e||(this.is_svg?this.e=Xs(n.nodeName):this.e=ge(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)de(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(ce)}}function ed(t,e){return new t(e)}let Ca;function Ma(t){Ca=t}function Ra(){if(!Ca)throw new Error("Function called outside component initialization");return Ca}function La(t){Ra().$$.on_mount.push(t)}function Gl(t){Ra().$$.on_destroy.push(t)}function Mi(){const t=Ra();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=u_(e,n,{cancelable:r});return i.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}function f_(t,e){return Ra().$$.context.set(t,e),e}function Bo(t){return Ra().$$.context.get(t)}function wn(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Oo=[],$t=[];let Do=[];const Oc=[],td=Promise.resolve();let Dc=!1;function nd(){Dc||(Dc=!0,td.then(rd))}function Rr(){return nd(),td}function Cs(t){Do.push(t)}function Kn(t){Oc.push(t)}const Nc=new Set;let No=0;function rd(){if(No!==0)return;const t=Ca;do{try{for(;No<Oo.length;){const e=Oo[No];No++,Ma(e),d_(e.$$)}}catch(e){throw Oo.length=0,No=0,e}for(Ma(null),Oo.length=0,No=0;$t.length;)$t.pop()();for(let e=0;e<Do.length;e+=1){const n=Do[e];Nc.has(n)||(Nc.add(n),n())}Do.length=0}while(Oo.length);for(;Oc.length;)Oc.pop()();Dc=!1,Nc.clear(),Ma(t)}function d_(t){if(t.fragment!==null){t.update(),vn(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Cs)}}function h_(t){const e=[],n=[];Do.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Do=e}const zl=new Set;let Ys;function Wt(){Ys={r:0,c:[],p:Ys}}function jt(){Ys.r||vn(Ys.c),Ys=Ys.p}function J(t,e){t&&t.i&&(zl.delete(t),t.i(e))}function ne(t,e,n,r){if(t&&t.o){if(zl.has(t))return;zl.add(t),Ys.c.push(()=>{zl.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Kr(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Pa(t,e){t.d(1),e.delete(t.key)}function id(t,e){ne(t,1,1,()=>{e.delete(t.key)})}function Ks(t,e,n,r,i,s,o,a,l,c,u,f){let p=t.length,y=s.length,m=p;const g={};for(;m--;)g[t[m].key]=m;const w=[],_=new Map,b=new Map,E=[];for(m=y;m--;){const L=f(i,s,m),$=n(L);let P=o.get($);P?r&&E.push(()=>P.p(L,e)):(P=c($,L),P.c()),_.set($,w[m]=P),$ in g&&b.set($,Math.abs(m-g[$]))}const R=new Set,h=new Set;function k(L){J(L,1),L.m(a,u),o.set(L.key,L),u=L.first,y--}for(;p&&y;){const L=w[y-1],$=t[p-1],P=L.key,I=$.key;L===$?(u=L.first,p--,y--):_.has(I)?!o.has(P)||R.has(P)?k(L):h.has(I)?p--:b.get(P)>b.get(I)?(h.add(P),k(L)):(R.add(I),p--):(l($,o),p--)}for(;p--;){const L=t[p];_.has(L.key)||l(L,o)}for(;y;)k(w[y-1]);return vn(E),w}function or(t,e){const n={},r={},i={$$scope:1};let s=t.length;for(;s--;){const o=t[s],a=e[s];if(a){for(const l in o)l in a||(r[l]=1);for(const l in a)i[l]||(n[l]=a[l],i[l]=1);t[s]=a}else for(const l in o)i[l]=1}for(const o in r)o in n||(n[o]=void 0);return n}function ar(t){return typeof t=="object"&&t!==null?t:{}}function qn(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ve(t){t&&t.c()}function we(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Cs(()=>{const s=t.$$.on_mount.map(Ta).filter(Ai);t.$$.on_destroy?t.$$.on_destroy.push(...s):vn(s),t.$$.on_mount=[]}),i.forEach(Cs)}function ye(t,e){const n=t.$$;n.fragment!==null&&(h_(n.after_update),vn(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function p_(t,e){t.$$.dirty[0]===-1&&(Oo.push(t),nd(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Pn(t,e,n,r,i,s,o=null,a=[-1]){const l=Ca;Ma(t);const c=t.$$={fragment:null,ctx:[],props:s,update:wt,not_equal:i,bound:q1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:q1(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(f,p,...y)=>{const m=y.length?y[0]:p;return c.ctx&&i(c.ctx[f],c.ctx[f]=m)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](m),u&&p_(t,f)),p}):[],c.update(),u=!0,vn(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const f=l_(e.target);c.fragment&&c.fragment.l(f),f.forEach(ce)}else c.fragment&&c.fragment.c();e.intro&&J(t.$$.fragment),we(t,e.target,e.anchor),rd()}Ma(l)}class In{constructor(){Qn(this,"$$");Qn(this,"$$set")}$destroy(){ye(this,1),this.$destroy=wt}$on(e,n){if(!Ai(n))return wt;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!a_(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const m_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(m_);function __(t){let e,n,r,i,s,o;return{c(){e=Xs("svg"),n=Xs("path"),re(n,"d",t[1]),re(e,"tabindex","0"),re(e,"role","button"),re(e,"style",r="width: "+t[2]+"; height: "+t[3]+";"+t[4]),re(e,"viewBox","0 0 24 24"),re(e,"fill","currentColor"),re(e,"class",i=`icon ${t[5]}`)},m(a,l){de(a,e,l),oe(e,n),t[8](e),s||(o=[Ke(e,"click",t[6]),Ke(e,"keyup",t[7])],s=!0)},p(a,[l]){l&2&&re(n,"d",a[1]),l&28&&r!==(r="width: "+a[2]+"; height: "+a[3]+";"+a[4])&&re(e,"style",r),l&32&&i!==(i=`icon ${a[5]}`)&&re(e,"class",i)},i:wt,o:wt,d(a){a&&ce(e),t[8](null),s=!1,vn(o)}}}function g_(t,e,n){let{path:r}=e,{width:i="1.4rem"}=e,{height:s="1.4rem"}=e,{element:o=void 0}=e,{iconStyles:a=""}=e,{class:l=""}=e;function c(p){wn.call(this,t,p)}function u(p){wn.call(this,t,p)}function f(p){$t[p?"unshift":"push"](()=>{o=p,n(0,o)})}return t.$$set=p=>{"path"in p&&n(1,r=p.path),"width"in p&&n(2,i=p.width),"height"in p&&n(3,s=p.height),"element"in p&&n(0,o=p.element),"iconStyles"in p&&n(4,a=p.iconStyles),"class"in p&&n(5,l=p.class)},[o,r,i,s,a,l,c,u,f]}class Tt extends In{constructor(e){super(),Pn(this,e,g_,__,Tn,{path:1,width:2,height:3,element:0,iconStyles:4,class:5})}}var sd={},Xl={};Xl.byteLength=y_,Xl.toByteArray=E_,Xl.fromByteArray=k_;for(var Vi=[],wi=[],b_=typeof Uint8Array<"u"?Uint8Array:Array,Fc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fo=0,w_=Fc.length;Fo<w_;++Fo)Vi[Fo]=Fc[Fo],wi[Fc.charCodeAt(Fo)]=Fo;wi[45]=62,wi[95]=63;function od(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function y_(t){var e=od(t),n=e[0],r=e[1];return(n+r)*3/4-r}function v_(t,e,n){return(e+n)*3/4-n}function E_(t){var e,n=od(t),r=n[0],i=n[1],s=new b_(v_(t,r,i)),o=0,a=i>0?r-4:r,l;for(l=0;l<a;l+=4)e=wi[t.charCodeAt(l)]<<18|wi[t.charCodeAt(l+1)]<<12|wi[t.charCodeAt(l+2)]<<6|wi[t.charCodeAt(l+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=wi[t.charCodeAt(l)]<<2|wi[t.charCodeAt(l+1)]>>4,s[o++]=e&255),i===1&&(e=wi[t.charCodeAt(l)]<<10|wi[t.charCodeAt(l+1)]<<4|wi[t.charCodeAt(l+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function S_(t){return Vi[t>>18&63]+Vi[t>>12&63]+Vi[t>>6&63]+Vi[t&63]}function T_(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(S_(r));return i.join("")}function k_(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(T_(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Vi[e>>2]+Vi[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Vi[e>>10]+Vi[e>>4&63]+Vi[e<<2&63]+"=")),i.join("")}var $c={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */$c.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,l=(1<<a)-1,c=l>>1,u=-7,f=n?i-1:0,p=n?-1:1,y=t[e+f];for(f+=p,s=y&(1<<-u)-1,y>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+f],f+=p,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(y?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(y?-1:1)*o*Math.pow(2,s-r)},$c.write=function(t,e,n,r,i,s){var o,a,l,c=s*8-i-1,u=(1<<c)-1,f=u>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=r?0:s-1,m=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?e+=p/l:e+=p*Math.pow(2,1-f),e*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*l-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[n+y]=a&255,y+=m,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[n+y]=o&255,y+=m,o/=256,c-=8);t[n+y-m]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Xl,n=$c,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=h,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=l(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const U=new s(1),T={foo:function(){return 42}};return Object.setPrototypeOf(T,s.prototype),Object.setPrototypeOf(U,T),U.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function c(U){if(U>i)throw new RangeError('The value "'+U+'" is invalid for option "size"');const T=new s(U);return Object.setPrototypeOf(T,u.prototype),T}function u(U,T,d){if(typeof U=="number"){if(typeof T=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(U)}return f(U,T,d)}u.poolSize=8192;function f(U,T,d){if(typeof U=="string")return g(U,T);if(o.isView(U))return _(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(Pe(U,o)||U&&Pe(U.buffer,o)||typeof a<"u"&&(Pe(U,a)||U&&Pe(U.buffer,a)))return b(U,T,d);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const A=U.valueOf&&U.valueOf();if(A!=null&&A!==U)return u.from(A,T,d);const N=E(U);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return u.from(U[Symbol.toPrimitive]("string"),T,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}u.from=function(U,T,d){return f(U,T,d)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function p(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}function y(U,T,d){return p(U),U<=0?c(U):T!==void 0?typeof d=="string"?c(U).fill(T,d):c(U).fill(T):c(U)}u.alloc=function(U,T,d){return y(U,T,d)};function m(U){return p(U),c(U<0?0:R(U)|0)}u.allocUnsafe=function(U){return m(U)},u.allocUnsafeSlow=function(U){return m(U)};function g(U,T){if((typeof T!="string"||T==="")&&(T="utf8"),!u.isEncoding(T))throw new TypeError("Unknown encoding: "+T);const d=k(U,T)|0;let A=c(d);const N=A.write(U,T);return N!==d&&(A=A.slice(0,N)),A}function w(U){const T=U.length<0?0:R(U.length)|0,d=c(T);for(let A=0;A<T;A+=1)d[A]=U[A]&255;return d}function _(U){if(Pe(U,s)){const T=new s(U);return b(T.buffer,T.byteOffset,T.byteLength)}return w(U)}function b(U,T,d){if(T<0||U.byteLength<T)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<T+(d||0))throw new RangeError('"length" is outside of buffer bounds');let A;return T===void 0&&d===void 0?A=new s(U):d===void 0?A=new s(U,T):A=new s(U,T,d),Object.setPrototypeOf(A,u.prototype),A}function E(U){if(u.isBuffer(U)){const T=R(U.length)|0,d=c(T);return d.length===0||U.copy(d,0,0,T),d}if(U.length!==void 0)return typeof U.length!="number"||Xe(U.length)?c(0):w(U);if(U.type==="Buffer"&&Array.isArray(U.data))return w(U.data)}function R(U){if(U>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return U|0}function h(U){return+U!=U&&(U=0),u.alloc(+U)}u.isBuffer=function(T){return T!=null&&T._isBuffer===!0&&T!==u.prototype},u.compare=function(T,d){if(Pe(T,s)&&(T=u.from(T,T.offset,T.byteLength)),Pe(d,s)&&(d=u.from(d,d.offset,d.byteLength)),!u.isBuffer(T)||!u.isBuffer(d))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(T===d)return 0;let A=T.length,N=d.length;for(let j=0,ee=Math.min(A,N);j<ee;++j)if(T[j]!==d[j]){A=T[j],N=d[j];break}return A<N?-1:N<A?1:0},u.isEncoding=function(T){switch(String(T).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(T,d){if(!Array.isArray(T))throw new TypeError('"list" argument must be an Array of Buffers');if(T.length===0)return u.alloc(0);let A;if(d===void 0)for(d=0,A=0;A<T.length;++A)d+=T[A].length;const N=u.allocUnsafe(d);let j=0;for(A=0;A<T.length;++A){let ee=T[A];if(Pe(ee,s))j+ee.length>N.length?(u.isBuffer(ee)||(ee=u.from(ee)),ee.copy(N,j)):s.prototype.set.call(N,ee,j);else if(u.isBuffer(ee))ee.copy(N,j);else throw new TypeError('"list" argument must be an Array of Buffers');j+=ee.length}return N};function k(U,T){if(u.isBuffer(U))return U.length;if(o.isView(U)||Pe(U,o))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);const d=U.length,A=arguments.length>2&&arguments[2]===!0;if(!A&&d===0)return 0;let N=!1;for(;;)switch(T){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return x(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d*2;case"hex":return d>>>1;case"base64":return tt(U).length;default:if(N)return A?-1:x(U).length;T=(""+T).toLowerCase(),N=!0}}u.byteLength=k;function L(U,T,d){let A=!1;if((T===void 0||T<0)&&(T=0),T>this.length||((d===void 0||d>this.length)&&(d=this.length),d<=0)||(d>>>=0,T>>>=0,d<=T))return"";for(U||(U="utf8");;)switch(U){case"hex":return C(this,T,d);case"utf8":case"utf-8":return Y(this,T,d);case"ascii":return W(this,T,d);case"latin1":case"binary":return O(this,T,d);case"base64":return F(this,T,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,T,d);default:if(A)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),A=!0}}u.prototype._isBuffer=!0;function $(U,T,d){const A=U[T];U[T]=U[d],U[d]=A}u.prototype.swap16=function(){const T=this.length;if(T%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let d=0;d<T;d+=2)$(this,d,d+1);return this},u.prototype.swap32=function(){const T=this.length;if(T%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let d=0;d<T;d+=4)$(this,d,d+3),$(this,d+1,d+2);return this},u.prototype.swap64=function(){const T=this.length;if(T%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let d=0;d<T;d+=8)$(this,d,d+7),$(this,d+1,d+6),$(this,d+2,d+5),$(this,d+3,d+4);return this},u.prototype.toString=function(){const T=this.length;return T===0?"":arguments.length===0?Y(this,0,T):L.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(T){if(!u.isBuffer(T))throw new TypeError("Argument must be a Buffer");return this===T?!0:u.compare(this,T)===0},u.prototype.inspect=function(){let T="";const d=t.INSPECT_MAX_BYTES;return T=this.toString("hex",0,d).replace(/(.{2})/g,"$1 ").trim(),this.length>d&&(T+=" ... "),"<Buffer "+T+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(T,d,A,N,j){if(Pe(T,s)&&(T=u.from(T,T.offset,T.byteLength)),!u.isBuffer(T))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof T);if(d===void 0&&(d=0),A===void 0&&(A=T?T.length:0),N===void 0&&(N=0),j===void 0&&(j=this.length),d<0||A>T.length||N<0||j>this.length)throw new RangeError("out of range index");if(N>=j&&d>=A)return 0;if(N>=j)return-1;if(d>=A)return 1;if(d>>>=0,A>>>=0,N>>>=0,j>>>=0,this===T)return 0;let ee=j-N,te=A-d;const se=Math.min(ee,te),be=this.slice(N,j),he=T.slice(d,A);for(let Ce=0;Ce<se;++Ce)if(be[Ce]!==he[Ce]){ee=be[Ce],te=he[Ce];break}return ee<te?-1:te<ee?1:0};function P(U,T,d,A,N){if(U.length===0)return-1;if(typeof d=="string"?(A=d,d=0):d>2147483647?d=2147483647:d<-2147483648&&(d=-2147483648),d=+d,Xe(d)&&(d=N?0:U.length-1),d<0&&(d=U.length+d),d>=U.length){if(N)return-1;d=U.length-1}else if(d<0)if(N)d=0;else return-1;if(typeof T=="string"&&(T=u.from(T,A)),u.isBuffer(T))return T.length===0?-1:I(U,T,d,A,N);if(typeof T=="number")return T=T&255,typeof s.prototype.indexOf=="function"?N?s.prototype.indexOf.call(U,T,d):s.prototype.lastIndexOf.call(U,T,d):I(U,[T],d,A,N);throw new TypeError("val must be string, number or Buffer")}function I(U,T,d,A,N){let j=1,ee=U.length,te=T.length;if(A!==void 0&&(A=String(A).toLowerCase(),A==="ucs2"||A==="ucs-2"||A==="utf16le"||A==="utf-16le")){if(U.length<2||T.length<2)return-1;j=2,ee/=2,te/=2,d/=2}function se(he,Ce){return j===1?he[Ce]:he.readUInt16BE(Ce*j)}let be;if(N){let he=-1;for(be=d;be<ee;be++)if(se(U,be)===se(T,he===-1?0:be-he)){if(he===-1&&(he=be),be-he+1===te)return he*j}else he!==-1&&(be-=be-he),he=-1}else for(d+te>ee&&(d=ee-te),be=d;be>=0;be--){let he=!0;for(let Ce=0;Ce<te;Ce++)if(se(U,be+Ce)!==se(T,Ce)){he=!1;break}if(he)return be}return-1}u.prototype.includes=function(T,d,A){return this.indexOf(T,d,A)!==-1},u.prototype.indexOf=function(T,d,A){return P(this,T,d,A,!0)},u.prototype.lastIndexOf=function(T,d,A){return P(this,T,d,A,!1)};function H(U,T,d,A){d=Number(d)||0;const N=U.length-d;A?(A=Number(A),A>N&&(A=N)):A=N;const j=T.length;A>j/2&&(A=j/2);let ee;for(ee=0;ee<A;++ee){const te=parseInt(T.substr(ee*2,2),16);if(Xe(te))return ee;U[d+ee]=te}return ee}function ae(U,T,d,A){return ke(x(T,U.length-d),U,d,A)}function V(U,T,d,A){return ke(Ne(T),U,d,A)}function v(U,T,d,A){return ke(tt(T),U,d,A)}function D(U,T,d,A){return ke(We(T,U.length-d),U,d,A)}u.prototype.write=function(T,d,A,N){if(d===void 0)N="utf8",A=this.length,d=0;else if(A===void 0&&typeof d=="string")N=d,A=this.length,d=0;else if(isFinite(d))d=d>>>0,isFinite(A)?(A=A>>>0,N===void 0&&(N="utf8")):(N=A,A=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const j=this.length-d;if((A===void 0||A>j)&&(A=j),T.length>0&&(A<0||d<0)||d>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let ee=!1;for(;;)switch(N){case"hex":return H(this,T,d,A);case"utf8":case"utf-8":return ae(this,T,d,A);case"ascii":case"latin1":case"binary":return V(this,T,d,A);case"base64":return v(this,T,d,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,T,d,A);default:if(ee)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),ee=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function F(U,T,d){return T===0&&d===U.length?e.fromByteArray(U):e.fromByteArray(U.slice(T,d))}function Y(U,T,d){d=Math.min(U.length,d);const A=[];let N=T;for(;N<d;){const j=U[N];let ee=null,te=j>239?4:j>223?3:j>191?2:1;if(N+te<=d){let se,be,he,Ce;switch(te){case 1:j<128&&(ee=j);break;case 2:se=U[N+1],(se&192)===128&&(Ce=(j&31)<<6|se&63,Ce>127&&(ee=Ce));break;case 3:se=U[N+1],be=U[N+2],(se&192)===128&&(be&192)===128&&(Ce=(j&15)<<12|(se&63)<<6|be&63,Ce>2047&&(Ce<55296||Ce>57343)&&(ee=Ce));break;case 4:se=U[N+1],be=U[N+2],he=U[N+3],(se&192)===128&&(be&192)===128&&(he&192)===128&&(Ce=(j&15)<<18|(se&63)<<12|(be&63)<<6|he&63,Ce>65535&&Ce<1114112&&(ee=Ce))}}ee===null?(ee=65533,te=1):ee>65535&&(ee-=65536,A.push(ee>>>10&1023|55296),ee=56320|ee&1023),A.push(ee),N+=te}return Q(A)}const K=4096;function Q(U){const T=U.length;if(T<=K)return String.fromCharCode.apply(String,U);let d="",A=0;for(;A<T;)d+=String.fromCharCode.apply(String,U.slice(A,A+=K));return d}function W(U,T,d){let A="";d=Math.min(U.length,d);for(let N=T;N<d;++N)A+=String.fromCharCode(U[N]&127);return A}function O(U,T,d){let A="";d=Math.min(U.length,d);for(let N=T;N<d;++N)A+=String.fromCharCode(U[N]);return A}function C(U,T,d){const A=U.length;(!T||T<0)&&(T=0),(!d||d<0||d>A)&&(d=A);let N="";for(let j=T;j<d;++j)N+=qe[U[j]];return N}function S(U,T,d){const A=U.slice(T,d);let N="";for(let j=0;j<A.length-1;j+=2)N+=String.fromCharCode(A[j]+A[j+1]*256);return N}u.prototype.slice=function(T,d){const A=this.length;T=~~T,d=d===void 0?A:~~d,T<0?(T+=A,T<0&&(T=0)):T>A&&(T=A),d<0?(d+=A,d<0&&(d=0)):d>A&&(d=A),d<T&&(d=T);const N=this.subarray(T,d);return Object.setPrototypeOf(N,u.prototype),N};function M(U,T,d){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+T>d)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(T,d,A){T=T>>>0,d=d>>>0,A||M(T,d,this.length);let N=this[T],j=1,ee=0;for(;++ee<d&&(j*=256);)N+=this[T+ee]*j;return N},u.prototype.readUintBE=u.prototype.readUIntBE=function(T,d,A){T=T>>>0,d=d>>>0,A||M(T,d,this.length);let N=this[T+--d],j=1;for(;d>0&&(j*=256);)N+=this[T+--d]*j;return N},u.prototype.readUint8=u.prototype.readUInt8=function(T,d){return T=T>>>0,d||M(T,1,this.length),this[T]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(T,d){return T=T>>>0,d||M(T,2,this.length),this[T]|this[T+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(T,d){return T=T>>>0,d||M(T,2,this.length),this[T]<<8|this[T+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(T,d){return T=T>>>0,d||M(T,4,this.length),(this[T]|this[T+1]<<8|this[T+2]<<16)+this[T+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(T,d){return T=T>>>0,d||M(T,4,this.length),this[T]*16777216+(this[T+1]<<16|this[T+2]<<8|this[T+3])},u.prototype.readBigUInt64LE=it(function(T){T=T>>>0,Le(T,"offset");const d=this[T],A=this[T+7];(d===void 0||A===void 0)&&Ie(T,this.length-8);const N=d+this[++T]*2**8+this[++T]*2**16+this[++T]*2**24,j=this[++T]+this[++T]*2**8+this[++T]*2**16+A*2**24;return BigInt(N)+(BigInt(j)<<BigInt(32))}),u.prototype.readBigUInt64BE=it(function(T){T=T>>>0,Le(T,"offset");const d=this[T],A=this[T+7];(d===void 0||A===void 0)&&Ie(T,this.length-8);const N=d*2**24+this[++T]*2**16+this[++T]*2**8+this[++T],j=this[++T]*2**24+this[++T]*2**16+this[++T]*2**8+A;return(BigInt(N)<<BigInt(32))+BigInt(j)}),u.prototype.readIntLE=function(T,d,A){T=T>>>0,d=d>>>0,A||M(T,d,this.length);let N=this[T],j=1,ee=0;for(;++ee<d&&(j*=256);)N+=this[T+ee]*j;return j*=128,N>=j&&(N-=Math.pow(2,8*d)),N},u.prototype.readIntBE=function(T,d,A){T=T>>>0,d=d>>>0,A||M(T,d,this.length);let N=d,j=1,ee=this[T+--N];for(;N>0&&(j*=256);)ee+=this[T+--N]*j;return j*=128,ee>=j&&(ee-=Math.pow(2,8*d)),ee},u.prototype.readInt8=function(T,d){return T=T>>>0,d||M(T,1,this.length),this[T]&128?(255-this[T]+1)*-1:this[T]},u.prototype.readInt16LE=function(T,d){T=T>>>0,d||M(T,2,this.length);const A=this[T]|this[T+1]<<8;return A&32768?A|4294901760:A},u.prototype.readInt16BE=function(T,d){T=T>>>0,d||M(T,2,this.length);const A=this[T+1]|this[T]<<8;return A&32768?A|4294901760:A},u.prototype.readInt32LE=function(T,d){return T=T>>>0,d||M(T,4,this.length),this[T]|this[T+1]<<8|this[T+2]<<16|this[T+3]<<24},u.prototype.readInt32BE=function(T,d){return T=T>>>0,d||M(T,4,this.length),this[T]<<24|this[T+1]<<16|this[T+2]<<8|this[T+3]},u.prototype.readBigInt64LE=it(function(T){T=T>>>0,Le(T,"offset");const d=this[T],A=this[T+7];(d===void 0||A===void 0)&&Ie(T,this.length-8);const N=this[T+4]+this[T+5]*2**8+this[T+6]*2**16+(A<<24);return(BigInt(N)<<BigInt(32))+BigInt(d+this[++T]*2**8+this[++T]*2**16+this[++T]*2**24)}),u.prototype.readBigInt64BE=it(function(T){T=T>>>0,Le(T,"offset");const d=this[T],A=this[T+7];(d===void 0||A===void 0)&&Ie(T,this.length-8);const N=(d<<24)+this[++T]*2**16+this[++T]*2**8+this[++T];return(BigInt(N)<<BigInt(32))+BigInt(this[++T]*2**24+this[++T]*2**16+this[++T]*2**8+A)}),u.prototype.readFloatLE=function(T,d){return T=T>>>0,d||M(T,4,this.length),n.read(this,T,!0,23,4)},u.prototype.readFloatBE=function(T,d){return T=T>>>0,d||M(T,4,this.length),n.read(this,T,!1,23,4)},u.prototype.readDoubleLE=function(T,d){return T=T>>>0,d||M(T,8,this.length),n.read(this,T,!0,52,8)},u.prototype.readDoubleBE=function(T,d){return T=T>>>0,d||M(T,8,this.length),n.read(this,T,!1,52,8)};function X(U,T,d,A,N,j){if(!u.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if(T>N||T<j)throw new RangeError('"value" argument is out of bounds');if(d+A>U.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(T,d,A,N){if(T=+T,d=d>>>0,A=A>>>0,!N){const te=Math.pow(2,8*A)-1;X(this,T,d,A,te,0)}let j=1,ee=0;for(this[d]=T&255;++ee<A&&(j*=256);)this[d+ee]=T/j&255;return d+A},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(T,d,A,N){if(T=+T,d=d>>>0,A=A>>>0,!N){const te=Math.pow(2,8*A)-1;X(this,T,d,A,te,0)}let j=A-1,ee=1;for(this[d+j]=T&255;--j>=0&&(ee*=256);)this[d+j]=T/ee&255;return d+A},u.prototype.writeUint8=u.prototype.writeUInt8=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,1,255,0),this[d]=T&255,d+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,2,65535,0),this[d]=T&255,this[d+1]=T>>>8,d+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,2,65535,0),this[d]=T>>>8,this[d+1]=T&255,d+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,4,4294967295,0),this[d+3]=T>>>24,this[d+2]=T>>>16,this[d+1]=T>>>8,this[d]=T&255,d+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,4,4294967295,0),this[d]=T>>>24,this[d+1]=T>>>16,this[d+2]=T>>>8,this[d+3]=T&255,d+4};function ie(U,T,d,A,N){Te(T,A,N,U,d,7);let j=Number(T&BigInt(4294967295));U[d++]=j,j=j>>8,U[d++]=j,j=j>>8,U[d++]=j,j=j>>8,U[d++]=j;let ee=Number(T>>BigInt(32)&BigInt(4294967295));return U[d++]=ee,ee=ee>>8,U[d++]=ee,ee=ee>>8,U[d++]=ee,ee=ee>>8,U[d++]=ee,d}function G(U,T,d,A,N){Te(T,A,N,U,d,7);let j=Number(T&BigInt(4294967295));U[d+7]=j,j=j>>8,U[d+6]=j,j=j>>8,U[d+5]=j,j=j>>8,U[d+4]=j;let ee=Number(T>>BigInt(32)&BigInt(4294967295));return U[d+3]=ee,ee=ee>>8,U[d+2]=ee,ee=ee>>8,U[d+1]=ee,ee=ee>>8,U[d]=ee,d+8}u.prototype.writeBigUInt64LE=it(function(T,d=0){return ie(this,T,d,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=it(function(T,d=0){return G(this,T,d,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(T,d,A,N){if(T=+T,d=d>>>0,!N){const se=Math.pow(2,8*A-1);X(this,T,d,A,se-1,-se)}let j=0,ee=1,te=0;for(this[d]=T&255;++j<A&&(ee*=256);)T<0&&te===0&&this[d+j-1]!==0&&(te=1),this[d+j]=(T/ee>>0)-te&255;return d+A},u.prototype.writeIntBE=function(T,d,A,N){if(T=+T,d=d>>>0,!N){const se=Math.pow(2,8*A-1);X(this,T,d,A,se-1,-se)}let j=A-1,ee=1,te=0;for(this[d+j]=T&255;--j>=0&&(ee*=256);)T<0&&te===0&&this[d+j+1]!==0&&(te=1),this[d+j]=(T/ee>>0)-te&255;return d+A},u.prototype.writeInt8=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,1,127,-128),T<0&&(T=255+T+1),this[d]=T&255,d+1},u.prototype.writeInt16LE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,2,32767,-32768),this[d]=T&255,this[d+1]=T>>>8,d+2},u.prototype.writeInt16BE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,2,32767,-32768),this[d]=T>>>8,this[d+1]=T&255,d+2},u.prototype.writeInt32LE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,4,2147483647,-2147483648),this[d]=T&255,this[d+1]=T>>>8,this[d+2]=T>>>16,this[d+3]=T>>>24,d+4},u.prototype.writeInt32BE=function(T,d,A){return T=+T,d=d>>>0,A||X(this,T,d,4,2147483647,-2147483648),T<0&&(T=4294967295+T+1),this[d]=T>>>24,this[d+1]=T>>>16,this[d+2]=T>>>8,this[d+3]=T&255,d+4},u.prototype.writeBigInt64LE=it(function(T,d=0){return ie(this,T,d,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=it(function(T,d=0){return G(this,T,d,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function z(U,T,d,A,N,j){if(d+A>U.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("Index out of range")}function le(U,T,d,A,N){return T=+T,d=d>>>0,N||z(U,T,d,4),n.write(U,T,d,A,23,4),d+4}u.prototype.writeFloatLE=function(T,d,A){return le(this,T,d,!0,A)},u.prototype.writeFloatBE=function(T,d,A){return le(this,T,d,!1,A)};function Me(U,T,d,A,N){return T=+T,d=d>>>0,N||z(U,T,d,8),n.write(U,T,d,A,52,8),d+8}u.prototype.writeDoubleLE=function(T,d,A){return Me(this,T,d,!0,A)},u.prototype.writeDoubleBE=function(T,d,A){return Me(this,T,d,!1,A)},u.prototype.copy=function(T,d,A,N){if(!u.isBuffer(T))throw new TypeError("argument should be a Buffer");if(A||(A=0),!N&&N!==0&&(N=this.length),d>=T.length&&(d=T.length),d||(d=0),N>0&&N<A&&(N=A),N===A||T.length===0||this.length===0)return 0;if(d<0)throw new RangeError("targetStart out of bounds");if(A<0||A>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),T.length-d<N-A&&(N=T.length-d+A);const j=N-A;return this===T&&typeof s.prototype.copyWithin=="function"?this.copyWithin(d,A,N):s.prototype.set.call(T,this.subarray(A,N),d),j},u.prototype.fill=function(T,d,A,N){if(typeof T=="string"){if(typeof d=="string"?(N=d,d=0,A=this.length):typeof A=="string"&&(N=A,A=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!u.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(T.length===1){const ee=T.charCodeAt(0);(N==="utf8"&&ee<128||N==="latin1")&&(T=ee)}}else typeof T=="number"?T=T&255:typeof T=="boolean"&&(T=Number(T));if(d<0||this.length<d||this.length<A)throw new RangeError("Out of range index");if(A<=d)return this;d=d>>>0,A=A===void 0?this.length:A>>>0,T||(T=0);let j;if(typeof T=="number")for(j=d;j<A;++j)this[j]=T;else{const ee=u.isBuffer(T)?T:u.from(T,N),te=ee.length;if(te===0)throw new TypeError('The value "'+T+'" is invalid for argument "value"');for(j=0;j<A-d;++j)this[j+d]=ee[j%te]}return this};const _e={};function Ae(U,T,d){_e[U]=class extends d{constructor(){super(),Object.defineProperty(this,"message",{value:T.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${U}]`,this.stack,delete this.name}get code(){return U}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${U}]: ${this.message}`}}}Ae("ERR_BUFFER_OUT_OF_BOUNDS",function(U){return U?`${U} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ae("ERR_INVALID_ARG_TYPE",function(U,T){return`The "${U}" argument must be of type number. Received type ${typeof T}`},TypeError),Ae("ERR_OUT_OF_RANGE",function(U,T,d){let A=`The value of "${U}" is out of range.`,N=d;return Number.isInteger(d)&&Math.abs(d)>2**32?N=Ee(String(d)):typeof d=="bigint"&&(N=String(d),(d>BigInt(2)**BigInt(32)||d<-(BigInt(2)**BigInt(32)))&&(N=Ee(N)),N+="n"),A+=` It must be ${T}. Received ${N}`,A},RangeError);function Ee(U){let T="",d=U.length;const A=U[0]==="-"?1:0;for(;d>=A+4;d-=3)T=`_${U.slice(d-3,d)}${T}`;return`${U.slice(0,d)}${T}`}function Ve(U,T,d){Le(T,"offset"),(U[T]===void 0||U[T+d]===void 0)&&Ie(T,U.length-(d+1))}function Te(U,T,d,A,N,j){if(U>d||U<T){const ee=typeof T=="bigint"?"n":"";let te;throw j>3?T===0||T===BigInt(0)?te=`>= 0${ee} and < 2${ee} ** ${(j+1)*8}${ee}`:te=`>= -(2${ee} ** ${(j+1)*8-1}${ee}) and < 2 ** ${(j+1)*8-1}${ee}`:te=`>= ${T}${ee} and <= ${d}${ee}`,new _e.ERR_OUT_OF_RANGE("value",te,U)}Ve(A,N,j)}function Le(U,T){if(typeof U!="number")throw new _e.ERR_INVALID_ARG_TYPE(T,"number",U)}function Ie(U,T,d){throw Math.floor(U)!==U?(Le(U,d),new _e.ERR_OUT_OF_RANGE(d||"offset","an integer",U)):T<0?new _e.ERR_BUFFER_OUT_OF_BOUNDS:new _e.ERR_OUT_OF_RANGE(d||"offset",`>= ${d?1:0} and <= ${T}`,U)}const et=/[^+/0-9A-Za-z-_]/g;function B(U){if(U=U.split("=")[0],U=U.trim().replace(et,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}function x(U,T){T=T||1/0;let d;const A=U.length;let N=null;const j=[];for(let ee=0;ee<A;++ee){if(d=U.charCodeAt(ee),d>55295&&d<57344){if(!N){if(d>56319){(T-=3)>-1&&j.push(239,191,189);continue}else if(ee+1===A){(T-=3)>-1&&j.push(239,191,189);continue}N=d;continue}if(d<56320){(T-=3)>-1&&j.push(239,191,189),N=d;continue}d=(N-55296<<10|d-56320)+65536}else N&&(T-=3)>-1&&j.push(239,191,189);if(N=null,d<128){if((T-=1)<0)break;j.push(d)}else if(d<2048){if((T-=2)<0)break;j.push(d>>6|192,d&63|128)}else if(d<65536){if((T-=3)<0)break;j.push(d>>12|224,d>>6&63|128,d&63|128)}else if(d<1114112){if((T-=4)<0)break;j.push(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}else throw new Error("Invalid code point")}return j}function Ne(U){const T=[];for(let d=0;d<U.length;++d)T.push(U.charCodeAt(d)&255);return T}function We(U,T){let d,A,N;const j=[];for(let ee=0;ee<U.length&&!((T-=2)<0);++ee)d=U.charCodeAt(ee),A=d>>8,N=d%256,j.push(N),j.push(A);return j}function tt(U){return e.toByteArray(B(U))}function ke(U,T,d,A){let N;for(N=0;N<A&&!(N+d>=T.length||N>=U.length);++N)T[N+d]=U[N];return N}function Pe(U,T){return U instanceof T||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===T.name}function Xe(U){return U!==U}const qe=function(){const U="0123456789abcdef",T=new Array(256);for(let d=0;d<16;++d){const A=d*16;for(let N=0;N<16;++N)T[A+N]=U[d]+U[N]}return T}();function it(U){return typeof BigInt>"u"?Je:U}function Je(){throw new Error("BigInt not supported")}})(sd);const Vc=sd.Buffer,ad=new Map([["Copy subtitle",!0],["Toggle playback",!0],["Restart playback",!0],["Toggle play and pause",!0],["Toggle playback loop",!0],["Toggle bookmark",!0],["Toggle for merge",!0],["Edit subtitle",!0],["Restore original text and time",!0],["Create new card",!0],["Update last created card",!0],["Open last exported card",!0]]),ld=new Map([["Restart playback",!0],["Toggle bookmark",!0],["Restore original text and time",!0],["Toggle play and pause",!0],["Toggle for merge",!0],["Create new card",!0],["Toggle playback loop",!0],["Edit subtitle",!0],["Update last created card",!0]]),xc=new Map([["Toggle playback",!0],["Rewind #2",!1],["Rewind",!1],["Fast-Forward",!1],["Fast-Forward #2",!1],["Go to previous subtitle",!1],["Go to next subtitle",!1],["Restart playback",!1],["Toggle play and pause",!1],["Toggle playback loop",!1],["Toggle bookmark",!1],["Toggle for merge",!1],["Edit subtitle",!1],["Restore original text and time",!1],["Copy subtitle",!1],["Create new card",!1],["Update last created card",!1],["Open last exported card",!1]]);var li=(t=>(t.NONE="none",t.READER="Reader",t.SUBTITLES="Subtitles",t.PLAYER="Player",t.EXPORT="Export",t.ANKI="Anki",t.KEYBINDINGS="Keybindings",t.READER_ACTIONS="Reader actions",t.SUBTITLE_ACTIONS="Subtitle actions",t.FOOTER_ACTIONS="Footer actions",t))(li||{}),Ia=(t=>(t.CREATE="Create card",t.UPDATE="Update card",t))(Ia||{}),Yl=(t=>(t.ALWAYS="Always",t.PAGE="Page",t))(Yl||{}),Kl=(t=>(t.AUTO="auto",t.INSTANT="instant",t.SMOOTH="smooth",t))(Kl||{}),er=(t=>(t.DISABLED="Disabled",t.CLICK="On click",t.HOLD="On hold",t))(er||{}),ql=(t=>(t.DISABLED="Disabled",t.PAUSE="Pause on open",t))(ql||{}),Sr=(t=>(t.HIDDEN="Hidden",t.ALWAYS="Always visible",t.HOVER="On hover",t.TOGGLE="Toggle on hold",t))(Sr||{}),ui=(t=>(t.DISABLED="Disabled",t.MODERATE="Moderate",t.STRICT="Strict",t))(ui||{}),Tr=(t=>(t.RECORDER="Recorder",t.FFMPEG="FFMPEG",t))(Tr||{}),Ms=(t=>(t.MP3="mp3",t.OGG="ogg",t.OPUS="opus",t))(Ms||{}),$o=(t=>(t.AUTO="auto",t.JPEG="jpeg",t.PNG="png",t.WEBP="webp",t))($o||{}),Rs=(t=>(t.BEFORE="Insert before",t.AFTER="Insert after",t.REPLACE="Replace",t))(Rs||{}),ci=(t=>(t.DISABLED="Disabled",t.DECK="Deck",t.SUBDECK="Deck and children",t.COLLECTION="Collection",t))(ci||{});function A_(){return{"ttu-whispersync-reader-line-highlight-color":"#fffa82","ttu-whispersync-reader-line-text-highlight-color":"#000000","ttu-whispersync-reader-enable-line-highlight":!0,"ttu-whispersync-reader-enable-line-text-highlight":!0,"ttu-whispersync-reader-enable-auto-reload":!0,"ttu-whispersync-reader-enable-filesystem-api":!0,"ttu-whispersync-reader-enable-auto-scroll":!0,"ttu-whispersync-reader-enable-tracker-auto-pause":!0,"ttu-whispersync-reader-prevent-action-on-selection":!0,"ttu-whispersync-reader-enable-menu-target":!0,"ttu-whispersync-reader-scroll-mode":"Always","ttu-whispersync-reader-scroll-behavior":"instant","ttu-whispersync-reader-click-action":"None","ttu-whispersync-reader-menu-open-mode":"On click","ttu-whispersync-reader-menu-pause-mode":"Pause on open","ttu-whispersync-reader-menu-open-time":500,"ttu-whispersync-subtitles-enable-persist":!1,"ttu-whispersync-subtitles-enable-auto-scroll":!0,"ttu-whispersync-subtitles-copy-font-family":!0,"ttu-whispersync-subtitles-copy-font-size":!1,"ttu-whispersync-subtitles-copy-line-height":!1,"ttu-whispersync-subtitles-prevent-action-on-selection":!0,"ttu-whispersync-subtitles-click-action":"Restart playback","ttu-whispersync-subtitles-actions-visibility":"On hover","ttu-whispersync-subtitles-actions-visibility-time":500,"ttu-whispersync-subtitles-global-start-padding":0,"ttu-whispersync-subtitles-global-end-padding":0,"ttu-whispersync-subtitles-font-family":"Noto Serif JP","ttu-whispersync-subtitles-font-size":20,"ttu-whispersync-subtitles-line-height":1.65,"ttu-whispersync-player-enable-cover":!0,"ttu-whispersync-player-enable-chapters":!0,"ttu-whispersync-player-enable-wake-lock":!1,"ttu-whispersync-player-enable-subtitle-copy":!1,"ttu-whispersync-player-enable-dictionary-detection":!1,"ttu-whispersync-player-auto-pause-mode":"Disabled","ttu-whispersync-player-rewind-time":5,"ttu-whispersync-player-alt-rewind-time":10,"ttu-whispersync-player-fast-forward-time":5,"ttu-whispersync-player-alt-fast-forward-time":10,"ttu-whispersync-player-playback-rate-decrease-time":.05,"ttu-whispersync-player-playback-rate-increase-time":.05,"ttu-whispersync-export-field-mode":"Insert after","ttu-whispersync-export-audio-processor":"Recorder","ttu-whispersync-export-audio-format":"mp3","ttu-whispersync-export-audio-bitrate":128,"ttu-whispersync-export-cover-format":"auto","ttu-whispersync-enable-ffmpeg-log":!1,"ttu-whispersync-anki-add-subtitle-tag":!1,"ttu-whispersync-anki-add-audio-tag":!1,"ttu-whispersync-anki-enable-open-in-browser":!1,"ttu-whispersync-anki-allow-empty-key-field":!1,"ttu-whispersync-anki-tag-list":"","ttu-whispersync-anki-duplicate-mode":"Disabled","ttu-whispersync-anki-url":"http://localhost:8765","ttu-whispersync-anki-key":"","ttu-whispersync-anki-deck":"","ttu-whispersync-anki-update-deck":"","ttu-whispersync-anki-model":"","ttu-whispersync-anki-update-model":"","ttu-whispersync-anki-sentence-field":"","ttu-whispersync-anki-update-sentence-field":"","ttu-whispersync-anki-sound-field":"","ttu-whispersync-anki-update-sound-field":"","ttu-whispersync-anki-cover-field":"","ttu-whispersync-anki-update-cover-field":"","ttu-whispersync-keybindings-enable-time-fallback":!1,"ttu-whispersync-action-list-of-reader":Hc(ad),"ttu-whispersync-action-list-of-subtitles":Hc(ld),"ttu-whispersync-action-list-of-footer":Hc(xc),"ttu-whispersync-match-line-ignore-rp":!1,"ttu-whispersync-match-line-similarity-threshold":.9,"ttu-whispersync-match-line-max-attempts":50}}function Zl(t){return C_[t]}const C_=A_();function Hc(t){const e=[],n=[...t.entries()];for(let r=0,{length:i}=n;r<i;r+=1){const[s,o]=n[r];e.push({action:s,enabled:o})}return e}var $n;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})($n||($n={}));const M_=(()=>{let t=0;return()=>t++})(),R_=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L_=new Error("called FFmpeg.terminate()");class P_{constructor(){zs(this,gi,null);zs(this,Us,{});zs(this,Ts,{});zs(this,Eo,[]);zs(this,So,[]);Qn(this,"loaded",!1);zs(this,Cc,()=>{cn(this,gi)&&(cn(this,gi).onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case $n.LOAD:this.loaded=!0,cn(this,Us)[e](r);break;case $n.MOUNT:case $n.UNMOUNT:case $n.EXEC:case $n.WRITE_FILE:case $n.READ_FILE:case $n.DELETE_FILE:case $n.RENAME:case $n.CREATE_DIR:case $n.LIST_DIR:case $n.DELETE_DIR:cn(this,Us)[e](r);break;case $n.LOG:cn(this,Eo).forEach(i=>i(r));break;case $n.PROGRESS:cn(this,So).forEach(i=>i(r));break;case $n.ERROR:cn(this,Ts)[e](r);break}delete cn(this,Us)[e],delete cn(this,Ts)[e]})});zs(this,ni,({type:e,data:n},r=[],i)=>cn(this,gi)?new Promise((s,o)=>{const a=M_();cn(this,gi)&&cn(this,gi).postMessage({id:a,type:e,data:n},r),cn(this,Us)[a]=s,cn(this,Ts)[a]=o,i==null||i.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(R_));Qn(this,"load",({classWorkerURL:e,...n}={},{signal:r}={})=>(cn(this,gi)||(Hl(this,gi,e?new Worker(new URL(e,Gn&&Gn.src||new URL("ttu-whispersync.user.js",document.baseURI).href),{type:"module"}):new Worker(new URL(""+new URL("worker-lPYB70QI.js",document.currentScript&&document.currentScript.src||document.baseURI).href,Gn&&Gn.src||new URL("ttu-whispersync.user.js",document.baseURI).href),{type:"module"})),cn(this,Cc).call(this)),cn(this,ni).call(this,{type:$n.LOAD,data:n},void 0,r)));Qn(this,"exec",(e,n=-1,{signal:r}={})=>cn(this,ni).call(this,{type:$n.EXEC,data:{args:e,timeout:n}},void 0,r));Qn(this,"terminate",()=>{const e=Object.keys(cn(this,Ts));for(const n of e)cn(this,Ts)[n](L_),delete cn(this,Ts)[n],delete cn(this,Us)[n];cn(this,gi)&&(cn(this,gi).terminate(),Hl(this,gi,null),this.loaded=!1)});Qn(this,"writeFile",(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),cn(this,ni).call(this,{type:$n.WRITE_FILE,data:{path:e,data:n}},i,r)});Qn(this,"mount",(e,n,r)=>{const i=[];return cn(this,ni).call(this,{type:$n.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)});Qn(this,"unmount",e=>{const n=[];return cn(this,ni).call(this,{type:$n.UNMOUNT,data:{mountPoint:e}},n)});Qn(this,"readFile",(e,n="binary",{signal:r}={})=>cn(this,ni).call(this,{type:$n.READ_FILE,data:{path:e,encoding:n}},void 0,r));Qn(this,"deleteFile",(e,{signal:n}={})=>cn(this,ni).call(this,{type:$n.DELETE_FILE,data:{path:e}},void 0,n));Qn(this,"rename",(e,n,{signal:r}={})=>cn(this,ni).call(this,{type:$n.RENAME,data:{oldPath:e,newPath:n}},void 0,r));Qn(this,"createDir",(e,{signal:n}={})=>cn(this,ni).call(this,{type:$n.CREATE_DIR,data:{path:e}},void 0,n));Qn(this,"listDir",(e,{signal:n}={})=>cn(this,ni).call(this,{type:$n.LIST_DIR,data:{path:e}},void 0,n));Qn(this,"deleteDir",(e,{signal:n}={})=>cn(this,ni).call(this,{type:$n.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?cn(this,Eo).push(n):e==="progress"&&cn(this,So).push(n)}off(e,n){e==="log"?Hl(this,Eo,cn(this,Eo).filter(r=>r!==n)):e==="progress"&&Hl(this,So,cn(this,So).filter(r=>r!==n))}}gi=new WeakMap,Us=new WeakMap,Ts=new WeakMap,Eo=new WeakMap,So=new WeakMap,Cc=new WeakMap,ni=new WeakMap;const Vo=[];function I_(t,e){return{subscribe:hn(t,e).subscribe}}function hn(t,e=wt){let n;const r=new Set;function i(a){if(Tn(t,a)&&(t=a,n)){const l=!Vo.length;for(const c of r)c[1](),Vo.push(c,t);if(l){for(let c=0;c<Vo.length;c+=2)Vo[c][0](Vo[c+1]);Vo.length=0}}}function s(a){i(a(t))}function o(a,l=wt){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||wt),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function B_(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return I_(n,(o,a)=>{let l=!1;const c=[];let u=0,f=wt;const p=()=>{if(u)return;f();const m=e(r?c[0]:c,o,a);s?o(m):f=Ai(m)?m:wt},y=i.map((m,g)=>ts(m,w=>{c[g]=w,u&=~(1<<g),l&&p()},()=>{u|=1<<g}));return l=!0,p(),function(){vn(y),f(),l=!1}})}var pn=(t=>(t.AUDIOBOOK="Audiobook",t.MATCH="Match",t.CHAPTERS="Chapters",t.SETTINGS="Settings",t))(pn||{});function O_(){const{subscribe:t,set:e,update:n}=hn([]);return{subscribe:t,set:e,add:r=>{n(i=>(i.push(r),i))}}}function mn(t,e=0){return{id:"-1",originalStartSeconds:t,startSeconds:t,startTime:"",originalEndSeconds:e,endSeconds:e,endTime:"",originalText:"",text:"",subIndex:-1}}function Jl(t,e){return(n,r)=>{const i=r??Zl(n),s=D_()(n,i,t),{subscribe:o,set:a}=hn(s);function l(p){window.localStorage.setItem(n,e(p)),a(p)}function c(){let p=i;return o(m=>p=m)(),p}function u(){return n}function f(){return l(i),i}return{subscribe:o,set:l,get:c,key:u,reset:f}}}function D_(){return(t,e,n)=>{const r=window.localStorage.getItem(t);return r?n(r):e}}function Vn(){return Jl(t=>!!+t,t=>t?"1":"0")}function Nr(){return Jl(t=>+t,t=>`${t}`)}function N_(t){return Jl(e=>JSON.parse(e||t),e=>JSON.stringify(e))}function Uc(){return N_("[]")}function F_(t,e){t(e)}function lr(t){return hn(t,e=>F_(e,t))}function Mn(){return Jl(t=>t,t=>t)}const Ba=hn(!1),Ql=hn(!1),kt=lr(!0),Ct=lr(""),xo=O_(),En=lr(!1),Ho=hn(),Ri=lr({id:0,title:"",elementHtml:"",lastBookModified:0}),Uo=lr({matchedBy:"",matchedOn:0}),Lr=lr({title:""}),ns=lr(),Pr=lr(new Map),Oa=hn(),qs=hn(""),Da=hn(""),Zs=hn([]),Ls=hn(!1),eu=hn(!1),Na=hn(!1),Fa=hn(0),tu=lr(0),yi=lr(),xi=hn(!1),$a=hn(""),Va=hn(""),xa=hn(""),Ha=hn(""),Ua=hn(""),Wo=hn(""),jo=hn(""),Go=hn(""),zo=hn(""),Xo=hn(""),nu=hn(""),ru=hn(""),Wa=hn(""),ja=hn(""),rs=hn(""),is=hn(""),ss=hn(""),Yo=hn(""),ud=Mn()("ttu-whispersync-menu-position","left"),iu=Vn()("ttu-whispersync-hide-footer-actions",!1),Js=lr(pn.AUDIOBOOK),su=lr(new Set),ou=lr(new Set),os=lr({previous:"",current:"",useTimeFallback:!0}),Ga=lr(),kn=lr(!0),Hi=lr(0),as=lr(0),za=lr(!1),Ko=Nr()("ttu-whispersync-player-playback-rate",1),au=lr(),Xa=lr(),_t={readerLineHighlightColor$:Mn()("ttu-whispersync-reader-line-highlight-color"),readerLineTextHighlightColor$:Mn()("ttu-whispersync-reader-line-text-highlight-color"),readerEnableLineHighlight$:Vn()("ttu-whispersync-reader-enable-line-highlight"),readerEnableLineTextHighlight$:Vn()("ttu-whispersync-reader-enable-line-text-highlight"),readerEnableAutoReload$:Vn()("ttu-whispersync-reader-enable-auto-reload"),readerEnableFilesystemApi$:Vn()("ttu-whispersync-reader-enable-filesystem-api"),readerEnableAutoScroll$:Vn()("ttu-whispersync-reader-enable-auto-scroll"),readerEnableTrackerAutoPause$:Vn()("ttu-whispersync-reader-enable-tracker-auto-pause"),readerPreventActionOnSelection$:Vn()("ttu-whispersync-reader-prevent-action-on-selection"),readerEnableMenuTarget$:Vn()("ttu-whispersync-reader-enable-menu-target"),readerScrollMode$:Mn()("ttu-whispersync-reader-scroll-mode"),readerScrollBehavior$:Mn()("ttu-whispersync-reader-scroll-behavior"),readerClickAction$:Mn()("ttu-whispersync-reader-click-action"),readerMenuOpenMode$:Mn()("ttu-whispersync-reader-menu-open-mode"),readerMenuPauseMode$:Mn()("ttu-whispersync-reader-menu-pause-mode"),readerMenuOpenTime$:Nr()("ttu-whispersync-reader-menu-open-time"),readerTrackerPauseThreshold$:Nr()("ttu-whispersync-reader-tracker-pause-threshold"),subtitlesEnablePersist$:Vn()("ttu-whispersync-subtitles-enable-persist"),subtitlesEnableAutoScroll$:Vn()("ttu-whispersync-subtitles-enable-auto-scroll"),subtitlesCopyFontFamily$:Vn()("ttu-whispersync-subtitles-copy-font-family"),subtitlesCopyFontSize$:Vn()("ttu-whispersync-subtitles-copy-font-size"),subtitlesCopyLineHeight$:Vn()("ttu-whispersync-subtitles-copy-line-height"),subtitlePreventActionOnSelection$:Vn()("ttu-whispersync-subtitles-prevent-action-on-selection"),subtitlesClickAction$:Mn()("ttu-whispersync-subtitles-click-action"),subtitlesActionsVisibility$:Mn()("ttu-whispersync-subtitles-actions-visibility"),subtitlesActionsVisibilityTime$:Nr()("ttu-whispersync-subtitles-actions-visibility-time"),subtitlesGlobalStartPadding$:Nr()("ttu-whispersync-subtitles-global-start-padding"),subtitlesGlobalEndPadding$:Nr()("ttu-whispersync-subtitles-global-end-padding"),subtitlesFontFamily$:Mn()("ttu-whispersync-subtitles-font-family"),subtitlesFontSize$:Nr()("ttu-whispersync-subtitles-font-size"),subtitlesLineHeight$:Nr()("ttu-whispersync-subtitles-line-height"),playerEnableCover$:Vn()("ttu-whispersync-player-enable-cover"),playerEnableChapters$:Vn()("ttu-whispersync-player-enable-chapters"),playerEnableWakeLock$:Vn()("ttu-whispersync-player-enable-wake-lock"),playerEnableSubtitleCopy$:Vn()("ttu-whispersync-player-enable-subtitle-copy"),playerEnableDictionaryDetection$:Vn()("ttu-whispersync-player-enable-dictionary-detection"),playerAutoPauseMode$:Mn()("ttu-whispersync-player-auto-pause-mode"),playerRewindTime$:Nr()("ttu-whispersync-player-rewind-time"),playerAltRewindTime$:Nr()("ttu-whispersync-player-alt-rewind-time"),playerFastForwardTime$:Nr()("ttu-whispersync-player-fast-forward-time"),playerAltFastForwardTime$:Nr()("ttu-whispersync-player-alt-fast-forward-time"),playerPlaybackRateDecreaseTime$:Nr()("ttu-whispersync-player-playback-rate-decrease-time"),playerPlaybackRateIncreaseTime$:Nr()("ttu-whispersync-player-playback-rate-increase-time"),exportFieldMode$:Mn()("ttu-whispersync-export-field-mode"),exportAudioProcessor$:Mn()("ttu-whispersync-export-audio-processor"),exportAudioFormat$:Mn()("ttu-whispersync-export-audio-format"),exportAudioBitrate$:Nr()("ttu-whispersync-export-audio-bitrate"),exportCoverFormat$:Mn()("ttu-whispersync-export-cover-format"),enableFFMPEGLog$:Vn()("ttu-whispersync-enable-ffmpeg-log"),ankiAddSubtitleTag$:Vn()("ttu-whispersync-anki-add-subtitle-tag"),ankiAddAudioTag$:Vn()("ttu-whispersync-anki-add-audio-tag"),ankiAllowEmptyKeyField$:Vn()("ttu-whispersync-anki-allow-empty-key-field"),ankiTagList$:Mn()("ttu-whispersync-anki-tag-list"),ankiDuplicateMode$:Mn()("ttu-whispersync-anki-duplicate-mode"),ankiUrl$:Mn()("ttu-whispersync-anki-url"),ankiKey$:Mn()("ttu-whispersync-anki-key"),ankiDeck$:Mn()("ttu-whispersync-anki-deck"),ankiUpdateDeck$:Mn()("ttu-whispersync-anki-update-deck"),ankiModel$:Mn()("ttu-whispersync-anki-model"),ankiUpdateModel$:Mn()("ttu-whispersync-anki-update-model"),ankiSentenceField$:Mn()("ttu-whispersync-anki-sentence-field"),ankiUpdateSentenceField$:Mn()("ttu-whispersync-anki-update-sentence-field"),ankiSoundField$:Mn()("ttu-whispersync-anki-sound-field"),ankiUpdateSoundField$:Mn()("ttu-whispersync-anki-update-sound-field"),ankiCoverField$:Mn()("ttu-whispersync-anki-cover-field"),ankiUpdateCoverField$:Mn()("ttu-whispersync-anki-update-cover-field"),ankiEnableOpenInBrowser$:Vn()("ttu-whispersync-anki-enable-open-in-browser"),actionListOfReader$:Uc()("ttu-whispersync-action-list-of-reader"),actionListOfSubtitles$:Uc()("ttu-whispersync-action-list-of-subtitles"),actionListOfFooter$:Uc()("ttu-whispersync-action-list-of-footer"),keybindingsEnableTimeFallback$:Vn()("ttu-whispersync-keybindings-enable-time-fallback"),matchLineIgnoreRp$:Vn()("ttu-whispersync-match-line-ignore-rp"),matchLineSimilarityThreshold$:Nr()("ttu-whispersync-match-line-similarity-threshold"),matchLineMaxAttempts$:Nr()("ttu-whispersync-match-line-max-attempts")};async function cd({currentTarget:t},e,n){const r=t.hasAttribute("min"),i=t.hasAttribute("max"),s=r?Number.parseFloat(t.min):0,o=i?Number.parseFloat(t.max):0;let a=Number.parseFloat(t.value);(Number.isNaN(a)||r&&a<s||i&&a>o)&&(a=e),await new Promise(l=>setTimeout(l)),n==null||n.set(a),await Rr(),t.value=`${a}`}async function $_({currentTarget:t},e,n){let r=t.value||"";r||(r=e),n==null||n.set(r),await Rr(),t.value=r}class fd extends Error{constructor(){super(...arguments);Qn(this,"name","AbortError")}}const Ya="ttu-whispersync-line-highlight-",lu=new Set(["rp","rt"]);function uu(t,e){let{body:n}=t.parseFromString(e,"text/html");if(n.childNodes.length||({body:n}=t.parseFromString(e,"text/xml")),!n.childNodes.length)throw new Error("Failed to parse html");return n}function Wc(t,e){if(!t.contentWindow)throw new Error("Sandbox has no content window");const n=new MessageChannel;return n.port1.start(),new Promise((r,i)=>{n.port1.addEventListener("message",({data:s})=>{if(n.port1.close(),s.error)return i(new Error(s.error));r(s)},!1),t.contentWindow.postMessage(e,"*",[n.port2])})}function ls(t){const e=Math.floor(t/3600),n=t-e*3600,r=Math.floor(n/60),i=n-r*60,s=Math.floor(i),o=Math.round((i-s)*1e3);return[e,r,s,o]}function qr(t){const[e,n,r,i]=ls(t);return`${`${e}`.padStart(2,"0")}:${`${n}`.padStart(2,"0")}:${`${r}`.padStart(2,"0")},${`${i}`.padStart(3,"0")}`}function cu(){return`span[class^='${Ya}']`}function jc(t){var e;return((e=[...t.classList].find(n=>n.startsWith(Ya)))==null?void 0:e.replace(Ya,""))||"not existing"}function Qs(t){return`span.${Ya}${t}`}function V_(t){return`${Ya}${t}`}function x_(t,e){return cd(t,e,void 0)}function dd(t,e){return cd(t,Zl(e.key()),e)}function H_(t,e){return $_(t,Zl(e.key()),e)}function Ui(t,e,n){return Math.min(e,Math.max(n,t))}function fu(t){if(t){if(typeof t.throwIfAborted=="function")t.throwIfAborted();else if(t.aborted)throw new fd("user aborted")}}function du(t,e,n,r=!1){const i=t.createElement("a");i.href=URL.createObjectURL(e),r?i.target="_blank":(i.rel="noopener",i.download=n),setTimeout(()=>{URL.revokeObjectURL(i.href)},1e4),setTimeout(()=>{i.click()})}function eo(t){const[e,n,r]=ls(t);return`${`${e}`.padStart(2,"0")}:${`${n}`.padStart(2,"0")}:${`${r}`.padStart(2,"0")}`}function Ka(t,e,n=!0){return!t||!e?0:n?Math.floor(t/e*100):Math.round((t/e*100+Number.EPSILON)*100)/100}function U_(t){const e=t.split(":"),n=Number.parseInt(e[0],10),r=Number.parseInt(e[1],10),i=Number.parseInt(e[2],10);return Math.floor(n*3600)+Math.floor(r*60)+i}function hd(t){return`${t.getFullYear()}-${`${t.getMonth()+1}`.padStart(2,"0")}-${`${t.getDate()}`.padStart(2,"0")}`}const Gc="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NvbnN0IFI9Imh0dHBzOi8vdW5wa2cuY29tL0BmZm1wZWcvY29yZUAwLjEyLjYvZGlzdC91bWQvZmZtcGVnLWNvcmUuanMiO3ZhciBFOyhmdW5jdGlvbih0KXt0LkxPQUQ9IkxPQUQiLHQuRVhFQz0iRVhFQyIsdC5XUklURV9GSUxFPSJXUklURV9GSUxFIix0LlJFQURfRklMRT0iUkVBRF9GSUxFIix0LkRFTEVURV9GSUxFPSJERUxFVEVfRklMRSIsdC5SRU5BTUU9IlJFTkFNRSIsdC5DUkVBVEVfRElSPSJDUkVBVEVfRElSIix0LkxJU1RfRElSPSJMSVNUX0RJUiIsdC5ERUxFVEVfRElSPSJERUxFVEVfRElSIix0LkVSUk9SPSJFUlJPUiIsdC5ET1dOTE9BRD0iRE9XTkxPQUQiLHQuUFJPR1JFU1M9IlBST0dSRVNTIix0LkxPRz0iTE9HIix0Lk1PVU5UPSJNT1VOVCIsdC5VTk1PVU5UPSJVTk1PVU5UIn0pKEV8fChFPXt9KSk7Y29uc3QgYT1uZXcgRXJyb3IoInVua25vd24gbWVzc2FnZSB0eXBlIiksZj1uZXcgRXJyb3IoImZmbXBlZyBpcyBub3QgbG9hZGVkLCBjYWxsIGBhd2FpdCBmZm1wZWcubG9hZCgpYCBmaXJzdCIpLHU9bmV3IEVycm9yKCJmYWlsZWQgdG8gaW1wb3J0IGZmbXBlZy1jb3JlLmpzIik7bGV0IHI7Y29uc3QgTz1hc3luYyh7Y29yZVVSTDp0LHdhc21VUkw6bix3b3JrZXJVUkw6ZX0pPT57Y29uc3Qgbz0hcjt0cnl7dHx8KHQ9UiksaW1wb3J0U2NyaXB0cyh0KX1jYXRjaHtpZih0fHwodD1SLnJlcGxhY2UoIi91bWQvIiwiL2VzbS8iKSksc2VsZi5jcmVhdGVGRm1wZWdDb3JlPShhd2FpdCBpbXBvcnQodCkpLmRlZmF1bHQsIXNlbGYuY3JlYXRlRkZtcGVnQ29yZSl0aHJvdyB1fWNvbnN0IHM9dCxjPW58fHQucmVwbGFjZSgvLmpzJC9nLCIud2FzbSIpLGI9ZXx8dC5yZXBsYWNlKC8uanMkL2csIi53b3JrZXIuanMiKTtyZXR1cm4gcj1hd2FpdCBzZWxmLmNyZWF0ZUZGbXBlZ0NvcmUoe21haW5TY3JpcHRVcmxPckJsb2I6YCR7c30jJHtidG9hKEpTT04uc3RyaW5naWZ5KHt3YXNtVVJMOmMsd29ya2VyVVJMOmJ9KSl9YH0pLHIuc2V0TG9nZ2VyKGk9PnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6RS5MT0csZGF0YTppfSkpLHIuc2V0UHJvZ3Jlc3MoaT0+c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpFLlBST0dSRVNTLGRhdGE6aX0pKSxvfSxsPSh7YXJnczp0LHRpbWVvdXQ6bj0tMX0pPT57ci5zZXRUaW1lb3V0KG4pLHIuZXhlYyguLi50KTtjb25zdCBlPXIucmV0O3JldHVybiByLnJlc2V0KCksZX0sbT0oe3BhdGg6dCxkYXRhOm59KT0+KHIuRlMud3JpdGVGaWxlKHQsbiksITApLEQ9KHtwYXRoOnQsZW5jb2Rpbmc6bn0pPT5yLkZTLnJlYWRGaWxlKHQse2VuY29kaW5nOm59KSxTPSh7cGF0aDp0fSk9PihyLkZTLnVubGluayh0KSwhMCksST0oe29sZFBhdGg6dCxuZXdQYXRoOm59KT0+KHIuRlMucmVuYW1lKHQsbiksITApLEw9KHtwYXRoOnR9KT0+KHIuRlMubWtkaXIodCksITApLE49KHtwYXRoOnR9KT0+e2NvbnN0IG49ci5GUy5yZWFkZGlyKHQpLGU9W107Zm9yKGNvbnN0IG8gb2Ygbil7Y29uc3Qgcz1yLkZTLnN0YXQoYCR7dH0vJHtvfWApLGM9ci5GUy5pc0RpcihzLm1vZGUpO2UucHVzaCh7bmFtZTpvLGlzRGlyOmN9KX1yZXR1cm4gZX0sQT0oe3BhdGg6dH0pPT4oci5GUy5ybWRpcih0KSwhMCksdz0oe2ZzVHlwZTp0LG9wdGlvbnM6bixtb3VudFBvaW50OmV9KT0+e2NvbnN0IG89dCxzPXIuRlMuZmlsZXN5c3RlbXNbb107cmV0dXJuIHM/KHIuRlMubW91bnQocyxuLGUpLCEwKTohMX0saz0oe21vdW50UG9pbnQ6dH0pPT4oci5GUy51bm1vdW50KHQpLCEwKTtzZWxmLm9ubWVzc2FnZT1hc3luYyh7ZGF0YTp7aWQ6dCx0eXBlOm4sZGF0YTplfX0pPT57Y29uc3Qgbz1bXTtsZXQgczt0cnl7aWYobiE9PUUuTE9BRCYmIXIpdGhyb3cgZjtzd2l0Y2gobil7Y2FzZSBFLkxPQUQ6cz1hd2FpdCBPKGUpO2JyZWFrO2Nhc2UgRS5FWEVDOnM9bChlKTticmVhaztjYXNlIEUuV1JJVEVfRklMRTpzPW0oZSk7YnJlYWs7Y2FzZSBFLlJFQURfRklMRTpzPUQoZSk7YnJlYWs7Y2FzZSBFLkRFTEVURV9GSUxFOnM9UyhlKTticmVhaztjYXNlIEUuUkVOQU1FOnM9SShlKTticmVhaztjYXNlIEUuQ1JFQVRFX0RJUjpzPUwoZSk7YnJlYWs7Y2FzZSBFLkxJU1RfRElSOnM9TihlKTticmVhaztjYXNlIEUuREVMRVRFX0RJUjpzPUEoZSk7YnJlYWs7Y2FzZSBFLk1PVU5UOnM9dyhlKTticmVhaztjYXNlIEUuVU5NT1VOVDpzPWsoZSk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBhfX1jYXRjaChjKXtzZWxmLnBvc3RNZXNzYWdlKHtpZDp0LHR5cGU6RS5FUlJPUixkYXRhOmMudG9TdHJpbmcoKX0pO3JldHVybn1zIGluc3RhbmNlb2YgVWludDhBcnJheSYmby5wdXNoKHMuYnVmZmVyKSxzZWxmLnBvc3RNZXNzYWdlKHtpZDp0LHR5cGU6bixkYXRhOnN9LG8pfX0pKCk7Cg==",Ir=new P_,W_=!!window.chrome&&!!chrome.runtime&&chrome.runtime.id,pd=new Map([["ogg","libvorbis"],["opus","opus"],["mp3","libmp3lame"]]),j_=/chapter.+start (\d+\.\d+), end/i,G_=/title.+:(.+)/i;let qa={key:"",label:"",startSeconds:0,startText:""},hu=[],pu=!0;function md(t,e){return fetch(t).then(n=>{if(!n.ok)throw new Error(`Failed to download from ${t}`);return n.arrayBuffer()}).then(n=>{const r=new Blob([n],{type:e});return URL.createObjectURL(r)})}function zc(t,e="text/javascript"){return t===Gc?md(Gc,e):W_?md(chrome.runtime.getURL(`src/assets/js/${t}`),e):window.GM_getResourceURL(t)}function _d(t){try{if(pu){const e=t.message.match(j_);if((e==null?void 0:e.length)===2){const n=Number.parseFloat(e[1]);qa.startSeconds=n,pu=!1}}else if(!pu){const e=t.message.match(G_);if((e==null?void 0:e.length)===2){const n=e[1].trim(),{startSeconds:r}=qa;qa={key:`${n}_${r}`,label:n,startSeconds:r,startText:eo(r)},hu.push(qa),Xc()}}}catch{Xc()}}function Xc(t=!1){qa={key:"",label:"",startSeconds:0,startText:""},pu=!0,t&&(hu=[])}function gd(t){console.log(t.type,t.message)}async function bd(){if(Ir.loaded)return;const t=[];try{const e=[],n=await Promise.allSettled([zc("ffmpeg-core.js"),zc("ffmpeg-core.wasm","application/wasm"),zc(Gc)]);for(let r=0,{length:i}=n;r<i;r+=1){const s=n[r];s.status==="rejected"?e.push(s.reason.message):t.push(s.value)}if(e.length)throw new Error(e.join("; "));await Ir.load({coreURL:t[0],wasmURL:t[1],classWorkerURL:t[2]})}catch({message:e}){throw _t.exportAudioProcessor$.set(Tr.RECORDER),new Error(`Error loading FFMPEG - ${e}`)}finally{for(let e=0,{length:n}=t;e<n;e+=1)URL.revokeObjectURL(t[e])}}async function wd(t){if(Ir.loaded)try{if(await Yc(!0),t){const e=t.name.split(".").pop(),n=await t.arrayBuffer();await Ir.writeFile(`audio_input.${e}`,new Uint8Array(n))}}catch({message:e}){throw new Error(`Failed to update files in FFMPEG - ${e}`)}}async function Yc(t=!1){if(!Ir.loaded)return;const n=(await Ir.listDir("/")).filter(r=>!r.isDir&&(t&&r.name.startsWith("audio_input")||r.name.startsWith("audio_output")));return Promise.allSettled(n.map(r=>Ir.deleteFile(r.name)))}async function Kc(t){if(Xc(!0),!Ir.loaded)return hu;try{const n=["-hide_banner","-y","-i",`audio_input.${t.name.split(".").pop()}`];Ir.on("log",_d),await Ir.exec(n)}catch({message:e}){console.log(`Failed to get chapter data with ffmpeg: ${e}`)}return Ir.off("log",_d),hu}async function yd(t,e,n=!0,r=void 0,i="mp3",s=128,o=!1){const a=t.name.split(".").pop(),l=Mt(_t.enableFFMPEGLog$),c=e.length===1?`audio_output_0.${i}`:`audio_output.${i}`;let u="",f="",p=[],y;try{l&&Ir.on("log",gd);for(let g=0,{length:w}=e;g<w;g+=1){fu(r);const _=e[g],b=`audio_output_${g}.${i}`,E=["-hide_banner","-y","-ss",`${_.startSeconds}`,"-i",`audio_input.${a}`,"-t",`${_.endSeconds-_.startSeconds}`,...i===Ms.OPUS?["-strict","-2"]:[],"-vn","-acodec",pd.get(i)||"libmp3lame",...o?["-b:a",`${s}k`]:[],"-write_xing","0",b];l&&console.log(E),p.push("-i",b),f+=`[${g}:a]`,await Ir.exec(E)}if(e.length>1){p.push("-filter_complex"),f=`${f}concat=n=${e.length}:v=0:a=1`;const g=["-hide_banner","-y",...p,f,...i===Ms.OPUS?["-strict","-2"]:[],"-vn","-acodec",pd.get(i)||"libmp3lame",...o?["-b:a",`${s}k`]:[],"-write_xing","0",c];l&&console.log(g),await Ir.exec(g)}y=(await Ir.readFile(c)).buffer}catch(m){!(r&&r.aborted)&&m.name!=="AbortError"&&(u=typeof m=="string"?`Audio creation failed - ${m}`:`Audio creation failed${m.message?` - ${m.message}`:""}`)}if(n&&await Yc(),l&&Ir.off("log",gd),u)throw new Error(u);return fu(r),y}function z_(){Ir.loaded&&Ir.terminate()}let qc=!1,Za="";async function Gr(t,e,n=!0){if(n&&await X_(t),(e==null?void 0:e.action)==="multi"&&Za)for(let r=0,{length:i}=e.params.actions;r<i;r+=1)e.params.actions[r].key=Za;return fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({...e,version:6,...Za?{key:Za}:{}})}).then(r=>{if(!r.ok)throw new Error(`Request failed with status ${r.status}`);return r.json()}).then(r=>{let i=new Set;if(r.error&&i.add(r.error),(e==null?void 0:e.action)==="multi"&&Array.isArray(r.result))for(let s=0,{length:o}=r.result;s<o;s+=1){const{error:a}=r.result[s];a&&i.add(a)}if(i.size)throw new Error([...i].join("; "));return r.result})}async function X_(t){if(qc)return;const e=await Gr(t,{action:"requestPermission"},!1).catch(n=>{if(n.message.includes("com.google.gson.stream.MalformedJsonException"))return Na.set(!0),{permission:"granted",requireApikey:!1,version:6};throw n});if(typeof e!="string"&&e.permission!=="granted")throw new Error("Anki permission not granted");return qc=!0,e}async function Y_(t,e,n,r,i,s,o,a,l,c,u,f){if(!t||!e||!r||!s&&!a)return{isOutdatedVersion:!1,isAnkiConfigValid:!1,ankiFields:[]};let p=[],y=!1,m=!0;try{y=await Gr(t,{action:"apiReflect",params:{scopes:["actions"],actions:["updateNote"]}}).then(()=>!1).catch(()=>!0);const[g,w]=await Ed(t);g.find(_=>e===_)||(n.set(""),m=!1),w.find(_=>r===_)||(i.set(""),m=!1),m&&(p=await Sd(t,r),s&&!p.find(_=>_===s)&&(o.set(""),m=!1),a&&!p.find(_=>_===a)&&(l.set(""),m=!1),c&&!p.find(_=>_===c)&&(u.set(""),m=!1))}catch({message:g}){Td(f),Ct.set(`Failed to verify Anki settings for card ${f?"update":"creation"}: ${g}`),m=!1,p=[]}return{isOutdatedVersion:y,isAnkiConfigValid:m,ankiFields:p}}async function K_(t,e,n){if(e)return;const r=await Gr(t,{action:"guiSelectedNotes"}).catch(()=>[]);return r.length&&n?await Gr(t,{action:"guiBrowse",params:{query:"nid:1"}}):r.length&&await Gr(t,{action:"guiSelectNote",params:{note:"1"}}),r[r.length-1]}async function vd(t,e){const n=t.encode(e),r=await window.crypto.subtle.digest("SHA-1",n);return Array.from(new Uint8Array(r)).map(s=>s.toString(16).padStart(2,"0")).join("").trim()}function q_(t){return new Promise((e,n)=>{var l,c;const r=document.createElement("canvas"),i=document.querySelector("#ttu-whispersync-cover");if(!i)return n(new Error("cover element not found"));r.width=i.naturalWidth,r.height=i.naturalHeight;const s=r.getContext("2d");if(!s)return n(new Error("canvas context undefined"));s.drawImage(i,0,0);const o=r.toDataURL(t),a=((c=(l=o.match(/data:image\/(?<ext>.+);/))==null?void 0:l.groups)==null?void 0:c.ext)||"jpeg";e([o.split(",")[1],a])})}function mu(t,e,n){let r="";return t===Rs.BEFORE?r=`${n}${n&&e?"<br/>":""}${e}`:t===Rs.AFTER?r=`${e}${n&&e?"<br/>":""}${n}`:r=n,r}async function Z_(t,e,n){if(e)return n?Gr(t,{action:"guiBrowse",params:{query:`"note:${n}"`}}).catch(()=>{}):Gr(t,{action:"guiSelectNote",params:{note:e}}).catch(()=>{})}function J_(t){Za=t}function Ed(t){return Gr(t,{action:"multi",params:{actions:[{action:"deckNames"},{action:"modelNames"}]}})}function Sd(t,e){return Gr(t,{action:"modelFieldNames",params:{modelName:e}})}function Td(t){t?(_t.ankiUpdateDeck$.set(""),_t.ankiUpdateModel$.set(""),_t.ankiUpdateSentenceField$.set(""),_t.ankiUpdateSoundField$.set("")):(_t.ankiDeck$.set(""),_t.ankiModel$.set(""),_t.ankiSentenceField$.set(""),_t.ankiSoundField$.set(""),_t.ankiCoverField$.set("")),qc=!1}async function Q_(t,e){var le,Me;const n=new AbortController,r=Mt(ns),i=Mt(_t.exportAudioProcessor$)===Tr.FFMPEG;if(!r)return;i||kn.set(!0),Ct.set(""),tu.set(0),yi.set(n);const s=Mt(Oa),o=Mt(qs),a=Mt(_t.exportAudioFormat$),l=Mt(_t.exportAudioBitrate$),c=Mt(_t.exportCoverFormat$),u=Mt(_t.exportFieldMode$),f=Mt(_t.ankiAddSubtitleTag$),p=Mt(_t.ankiAddAudioTag$),y=Mt(_t.ankiTagList$).trim(),m=y?y.split(",").map(_e=>_e.trim().replaceAll(" ","_").trim()):[],g=Mt(_t.ankiDuplicateMode$),w=e&&(!!Mt(_t.ankiUpdateSentenceField$)||!!Mt(_t.ankiUpdateSoundField$)),_=w?_t.ankiUpdateDeck$:_t.ankiDeck$,b=w?_t.ankiUpdateModel$:_t.ankiModel$,E=w?_t.ankiUpdateSentenceField$:_t.ankiSentenceField$,R=w?_t.ankiUpdateSoundField$:_t.ankiSoundField$,h=w?_t.ankiUpdateCoverField$:_t.ankiCoverField$,k=Mt(_t.ankiUrl$),L=Mt(_),$=Mt(b),P=Mt(E),I=Mt(R),H=Mt(h),ae=Mt(_t.ankiEnableOpenInBrowser$),{isOutdatedVersion:V,isAnkiConfigValid:v,ankiFields:D}=await Y_(k,L,_,$,b,P,E,I,R,H,h,e),F=Mt(Na),Y=g===ci.DISABLED&&Mt(_t.ankiAllowEmptyKeyField$);let K;if(!v){const _e=Mt(Ct);return Ct.set(`${_e?`${_e}; `:""}${v?"":`Anki ${e?"update":"create"} settings are invalid`}`)}if(e)try{const _e=await Gr(k,{action:"findNotes",params:{query:`added:1 "deck:${L}" "note:${$}"`}}),Ae=_e[_e.length-1];if(!Ae)throw new Error("No card added today");if([K]=await Gr(k,{action:"notesInfo",params:{notes:[Ae]}}),!K)throw new Error("Data for last added card not available")}catch({message:_e}){return Ct.set(`Failed to get card for update: ${_e}`)}const Q=await K_(k,F,V),W=r.name.split(/\.(?=[^\.]+$)/)[0],O=s?s.name.split(/\.(?=[^\.]+$)/)[0]:"";let C=0,S="",M="",X="",ie="",G=0;try{const _e=new TextEncoder;S=await vd(_e,O),M=await vd(_e,`${O}_cover`)}catch{S=W}try{o&&H&&(c===$o.AUTO?ie=await fetch(o).then(_e=>{if(!_e.ok)throw new Error("Failed to fetch cover");return _e.blob()}).then(_e=>(X=_e.type.replace("image/","")||"jpeg",_e.arrayBuffer())).then(_e=>Vc.from(_e).toString("base64")):[ie,X]=await q_(`image/${c}`))}catch({message:_e}){return Ct.set(`Failed to get cover: ${_e}`)}Fa.set(0);for(let _e=0,{length:Ae}=t;_e<Ae;_e+=1){fu(n.signal);const Ee=t[_e],Ve=`${S}-${Ee[0].id}${Ee.length>1?`-${Ee[Ee.length-1].id}`:""}.${a}`,Te=Ee.map(Ne=>Ne.text.trim()).join("<br/>")||"",Le=new Set(K?K.tags:[]),Ie={note:{fields:{},tags:[]}};let et="",B="",x;try{if(I&&s){if(i?x=await yd(s,Ee,!1,n.signal,a,l,!0):x=await new Promise((Pe,Xe)=>au.set({subtitles:Ee,action:Be.TOGGLE_PLAY_PAUSE,recorderSuccess:Pe,recorderFailure:Xe})),!x)throw new Error("No audio file returned");B=Vc.from(x).toString("base64")}f&&Le.add(W.trim().replaceAll(" ","_").trim()),p&&O&&Le.add(O.trim().replaceAll(" ","_").trim());const Ne=[...new Set([...Le,...m])],We=g!==ci.DISABLED?{allowDuplicate:!1,duplicateScope:g===ci.DECK||g===ci.SUBDECK?"deck":"collection",duplicateScopeOptions:{checkChildren:g===ci.SUBDECK}}:{allowDuplicate:!0};We.duplicateScopeOptions&&g===ci.DECK&&(We.duplicateScopeOptions.deckName=L),Ie.note=K?{...Ie.note,id:K.noteId,tags:Ne}:{...Ie.note,deckName:L,modelName:$,options:We,tags:Ne};for(let Pe=0,{length:Xe}=D;Pe<Xe;Pe+=1){const qe=D[Pe],it=qe===P&&Te,Je=qe===I&&B,U=qe===H&&ie,T=K&&((le=K.fields[qe])==null?void 0:le.value)||"";if(it||Je||U){let d="";if(it&&(d+=Te),U){const A=await Gr(k,{action:"storeMediaFile",params:{data:ie,filename:`${M}.${X}`}});d=mu(Rs.AFTER,d,`<img src="${A}">`)}if(Je){const A=await Gr(k,{action:"storeMediaFile",params:{data:B,filename:Ve}});d=mu(Rs.AFTER,d,`[sound:${A}]`)}Ie.note.fields[qe]=mu(u,T,d)}else Ie.note.fields[qe]=T}const tt=!((Me=Ie.note.fields[D[0]])!=null&&Me.trim());if(tt&&Y)Ie.note.fields[D[0]]=mu(u,"","&#8203;");else if(tt)throw new Error("cannot process note because it is empty");e?et=F||V?"updateNoteFields":"updateNote":et="addNote";const ke=await Gr(k,{action:et,params:Ie});if(!e&&!ke)throw new Error("Got failure response");K?G=K.noteId:typeof ke=="number"&&(G=ke)}catch(Ne){if(!n.signal.aborted&&Ne.name!=="AbortError")console.log(`Failed to create card for subtitle(s) ${Ee.map(We=>We.id).join(", ")}: ${Ne.message}`),C+=1;else break}tu.set(Math.min(100,Ka(_e+1,Ae)))}const z=G&&!F;await Yc(),z&&Fa.set(G),z&&ae?await kd(k,G):await Z_(k,Q,V?$:void 0),C&&Ct.set(`${C} Export(s) failed`)}function kd(t,e=0){return e||Mt(Fa)?Gr(t,{action:"guiBrowse",params:{query:`nid:${e||Mt(Fa)}`}}).catch(({message:r})=>console.log(`Failed to open Anki browser: ${r}`)):Promise.resolve([0])}const eg=t=>({}),Ad=t=>({}),tg=t=>({}),Cd=t=>({}),ng=t=>({}),Md=t=>({});function rg(t){let e,n,r,i,s,o,a;const l=t[1].header,c=Ro(l,t,t[0],Md),u=t[1].content,f=Ro(u,t,t[0],Cd),p=t[1].footer,y=Ro(p,t,t[0],Ad);return{c(){e=ge("section"),n=ge("h2"),c&&c.c(),r=me(),i=ge("div"),f&&f.c(),s=me(),o=ge("footer"),y&&y.c(),re(n,"class","weight-medium mb-5 text-xl"),re(i,"class","slot-content"),re(o,"class","flex flex-wrap items-center justify-end pt-5"),re(e,"class","mdc-elevation--z24 p-6 rounded")},m(m,g){de(m,e,g),oe(e,n),c&&c.m(n,null),oe(e,r),oe(e,i),f&&f.m(i,null),oe(e,s),oe(e,o),y&&y.m(o,null),a=!0},p(m,[g]){c&&c.p&&(!a||g&1)&&Po(c,l,m,m[0],a?Lo(l,m[0],g,ng):Io(m[0]),Md),f&&f.p&&(!a||g&1)&&Po(f,u,m,m[0],a?Lo(u,m[0],g,tg):Io(m[0]),Cd),y&&y.p&&(!a||g&1)&&Po(y,p,m,m[0],a?Lo(p,m[0],g,eg):Io(m[0]),Ad)},i(m){a||(J(c,m),J(f,m),J(y,m),a=!0)},o(m){ne(c,m),ne(f,m),ne(y,m),a=!1},d(m){m&&ce(e),c&&c.d(m),f&&f.d(m),y&&y.d(m)}}}function ig(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class _u extends In{constructor(e){super(),Pn(this,e,ig,rg,Tn,{})}}var sg="M18,16V13H15V22H13V2H15V11H18V8L22,12L18,16M2,12L6,16V13H9V22H11V2H9V11H6V8L2,12Z",og="M13 20.5C13 21.03 13.09 21.53 13.26 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H7V9L9.5 7.5L12 9V2H18C19.1 2 20 2.89 20 4V11H16.5V16.11C14.5 16.57 13 18.36 13 20.5M20 13H18.5V18.21C18.19 18.07 17.86 18 17.5 18C16.12 18 15 19.12 15 20.5S16.12 23 17.5 23 20 21.88 20 20.5V15H22V13H20Z",Ja="M12 2C17.5 2 22 6.5 22 12S17.5 22 12 22 2 17.5 2 12 6.5 2 12 2M12 4C10.1 4 8.4 4.6 7.1 5.7L18.3 16.9C19.3 15.5 20 13.8 20 12C20 7.6 16.4 4 12 4M16.9 18.3L5.7 7.1C4.6 8.4 4 10.1 4 12C4 16.4 7.6 20 12 20C13.9 20 15.6 19.4 16.9 18.3Z",Rd="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z",ag="M0.41,13.41L6,19L7.41,17.58L1.83,12M22.24,5.58L11.66,16.17L7.5,12L6.07,13.41L11.66,19L23.66,7M18,7L16.59,5.58L10.24,11.93L11.66,13.34L18,7Z",Ld="M21 13.1C20.9 13.1 20.7 13.2 20.6 13.3L19.6 14.3L21.7 16.4L22.7 15.4C22.9 15.2 22.9 14.8 22.7 14.6L21.4 13.3C21.3 13.2 21.2 13.1 21 13.1M19.1 14.9L13 20.9V23H15.1L21.2 16.9L19.1 14.9M11 21.9C5.9 21.4 2 17.1 2 12C2 6.5 6.5 2 12 2C17.3 2 21.6 6.1 22 11.3C21.7 11.2 21.4 11.1 21 11.1C20.2 11.1 19.6 11.5 19.2 11.9L16.5 14.6L12.5 12.2V7H11V13L15.4 15.7L11 20.1V21.9Z",Pd="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",gu="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z",Qa="M18,14H20V17H23V19H20V22H18V19H15V17H18V14M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C16.42,13 20,11.21 20,9V9L20,12.08L19,12C16.41,12 14.2,13.64 13.36,15.94L12,16C7.58,16 4,14.21 4,12V9M4,14C4,16.21 7.58,18 12,18H13C13,19.05 13.27,20.04 13.75,20.9L12,21C7.58,21 4,19.21 4,17V14Z",lg="M15.46,15.88L16.88,14.46L19,16.59L21.12,14.47L22.53,15.88L20.41,18L22.54,20.12L21.12,21.54L19,19.41L16.88,21.53L15.47,20.12L17.59,18L15.46,15.88M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C16.42,13 20,11.21 20,9V12.08L19,12C16.41,12 14.2,13.64 13.36,15.94L12,16C7.58,16 4,14.21 4,12V9M4,14C4,16.21 7.58,18 12,18H13C13,19.05 13.27,20.04 13.75,20.9L12,21C7.58,21 4,19.21 4,17V14Z",el="M19,12V13.5A4,4 0 0,1 23,17.5C23,18.32 22.75,19.08 22.33,19.71L21.24,18.62C21.41,18.28 21.5,17.9 21.5,17.5A2.5,2.5 0 0,0 19,15V16.5L16.75,14.25L19,12M19,23V21.5A4,4 0 0,1 15,17.5C15,16.68 15.25,15.92 15.67,15.29L16.76,16.38C16.59,16.72 16.5,17.1 16.5,17.5A2.5,2.5 0 0,0 19,20V18.5L21.25,20.75L19,23M12,3C16.42,3 20,4.79 20,7C20,9.21 16.42,11 12,11C7.58,11 4,9.21 4,7C4,4.79 7.58,3 12,3M4,9C4,11.21 7.58,13 12,13C13.11,13 14.17,12.89 15.14,12.68C14.19,13.54 13.5,14.67 13.18,15.96L12,16C7.58,16 4,14.21 4,12V9M20,9V11H19.5L18.9,11.03C19.6,10.43 20,9.74 20,9M4,14C4,16.21 7.58,18 12,18L13,17.97C13.09,19.03 13.42,20 13.95,20.88L12,21C7.58,21 4,19.21 4,17V14Z",ug="M12,14A2,2 0 0,1 14,16A2,2 0 0,1 12,18A2,2 0 0,1 10,16A2,2 0 0,1 12,14M23.46,8.86L21.87,15.75L15,14.16L18.8,11.78C17.39,9.5 14.87,8 12,8C8.05,8 4.77,10.86 4.12,14.63L2.15,14.28C2.96,9.58 7.06,6 12,6C15.58,6 18.73,7.89 20.5,10.72L23.46,8.86Z",cg="M15 13H16.5V15.82L18.94 17.23L18.19 18.53L15 16.69V13M23 16C23 19.87 19.87 23 16 23C14.09 23 12.36 22.24 11.1 21H8C6.9 21 6 20.1 6 19V7H18V9.29C20.89 10.15 23 12.83 23 16M16 11C13.24 11 11 13.24 11 16C11 18.76 13.24 21 16 21C18.76 21 21 18.76 21 16C21 13.24 18.76 11 16 11M19 4V6H5V4H8.5L9.5 3H14.5L15.5 4H19Z",fg="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z",dg="M15,16H19V18H15V16M15,8H22V10H15V8M15,12H21V14H15V12M3,18A2,2 0 0,0 5,20H11A2,2 0 0,0 13,18V8H3V18M14,5H11L10,4H6L5,5H2V7H14V5Z",Zc="M19,10H5V8H19V10M19,16H5V14H19V16Z",Id="M2,5.27L3.28,4L20,20.72L18.73,22L15.65,18.92C14.5,19.3 13.28,19.5 12,19.5C7,19.5 2.73,16.39 1,12C1.69,10.24 2.79,8.69 4.19,7.46L2,5.27M12,9A3,3 0 0,1 15,12C15,12.35 14.94,12.69 14.83,13L11,9.17C11.31,9.06 11.65,9 12,9M12,4.5C17,4.5 21.27,7.61 23,12C22.18,14.08 20.79,15.88 19,17.19L17.58,15.76C18.94,14.82 20.06,13.54 20.82,12C19.17,8.64 15.76,6.5 12,6.5C10.91,6.5 9.84,6.68 8.84,7L7.3,5.47C8.74,4.85 10.33,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C12.69,17.5 13.37,17.43 14,17.29L11.72,15C10.29,14.85 9.15,13.71 9,12.28L5.6,8.87C4.61,9.72 3.78,10.78 3.18,12Z",Bd="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z",bu="M13.09 20C13.21 20.72 13.46 21.39 13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13C18.66 13 18.33 13.04 18 13.09V9H13V4H6V20H13.09M23 17L20 14.5V16H16V18H20V19.5L23 17M18 18.5L15 21L18 23.5V22H22V20H18V18.5Z",wu="M13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13S18.33 13.04 18 13.09V9H13V4H6V20H13.09C13.21 20.72 13.46 21.39 13.81 22M23 18H20V15H18V18H15V20H18V23H20V20H23V18Z",tl="M5,3A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5.5L18.5,3H17V9A1,1 0 0,1 16,10H8A1,1 0 0,1 7,9V3H5M12,4V9H15V4H12M7,12H17A1,1 0 0,1 18,13V19H6V13A1,1 0 0,1 7,12Z",to="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",Od="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",hg="M19,13H5V11H19V13Z",nl="M12,10L8,14H11V20H13V14H16M19,4H5C3.89,4 3,4.9 3,6V18A2,2 0 0,0 5,20H9V18H5V8H19V18H15V20H19A2,2 0 0,0 21,18V6A2,2 0 0,0 19,4Z",Dd="M22,3H5A2,2 0 0,0 3,5V9H5V5H22V19H5V15H3V19A2,2 0 0,0 5,21H22A2,2 0 0,0 24,19V5A2,2 0 0,0 22,3M7,15V13H0V11H7V9L11,12L7,15M20,13H13V11H20V13M20,9H13V7H20V9M17,17H13V15H17V17Z",Nd="M2,3H19A2,2 0 0,1 21,5V9H19V5H2V19H19V15H21V19A2,2 0 0,1 19,21H2A2,2 0 0,1 0,19V5A2,2 0 0,1 2,3M17,15V13H24V11H17V9L13,12L17,15M4,13H11V11H4V13M4,9H11V7H4V9M4,17H8V15H4V17Z",rl="M14,19H18V5H14M6,19H10V5H6V19Z",Fd="M13,16V8H15V16H13M9,16V8H11V16H9M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z",yu="M8,5.14V19.14L19,12.14L8,5.14Z",$d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z",Jc="M3,5V19L11,12M13,19H16V5H13M18,5V19H21V5",pg="M15,6V8H3V6H15M15,10V12H3V10H15M3,16V14H11V16H3M17,6H22V8H19V17A3,3 0 0,1 16,20A3,3 0 0,1 13,17A3,3 0 0,1 16,14C16.35,14 16.69,14.07 17,14.18V6M16,16A1,1 0 0,0 15,17A1,1 0 0,0 16,18A1,1 0 0,0 17,17A1,1 0 0,0 16,16Z",Vd="M3 10H14V12H3V10M3 6H14V8H3V6M3 14H10V16H3V14M16 13V21L22 17L16 13Z",mg="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",Qc="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",xd="M17,17H7V14L3,18L7,22V19H19V13H17M7,7H17V10L21,6L17,2V5H5V11H7V7Z",_g="M2,5.27L3.28,4L20,20.72L18.73,22L15.73,19H7V22L3,18L7,14V17H13.73L7,10.27V11H5V8.27L2,5.27M17,13H19V17.18L17,15.18V13M17,5V2L21,6L17,10V7H8.82L6.82,5H17Z",Hd="M6,5.75L10.25,10H7V16H13.5L15.5,18H7A2,2 0 0,1 5,16V10H1.75L6,5.75M18,18.25L13.75,14H17V8H10.5L8.5,6H17A2,2 0 0,1 19,8V14H22.25L18,18.25Z",qo="M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z",ef="M4,3H5V5H3V4A1,1 0 0,1 4,3M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M21,20A1,1 0 0,1 20,21H19V19H21V20M15,21V19H17V21H15M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M3,7H5V9H3V7M21,7V9H19V7H21Z",tf="M21 20C21 20.55 20.55 21 20 21H19V19H21V20M15 21V19H17V21H15M11 21V19H13V21H11M7 21V19H9V21H7M4 21C3.45 21 3 20.55 3 20V19H5V21H4M3 15H5V17H3V15M21 15V17H19V15H21M14.59 8L12 10.59L9.41 8L8 9.41L10.59 12L8 14.59L9.41 16L12 13.41L14.59 16L16 14.59L13.41 12L16 9.41L14.59 8M3 11H5V13H3V11M21 11V13H19V11H21M3 7H5V9H3V7M21 7V9H19V7H21M4 3H5V5H3V4C3 3.45 3.45 3 4 3M20 3C20.55 3 21 3.45 21 4V5H19V3H20M15 5V3H17V5H15M11 5V3H13V5H11M7 5V3H9V5H7Z",nf="M20,5V19L13,12M6,5V19H4V5M13,5V19L6,12",rf="M4,5V19L11,12M18,5V19H20V5M11,5V19L18,12",sf="M16,18H18V6H16M6,18L14.5,12L6,6V18Z",of="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z",gg="M12,16A3,3 0 0,1 9,13C9,11.88 9.61,10.9 10.5,10.39L20.21,4.77L14.68,14.35C14.18,15.33 13.17,16 12,16M12,3C13.81,3 15.5,3.5 16.97,4.32L14.87,5.53C14,5.19 13,5 12,5A8,8 0 0,0 4,13C4,15.21 4.89,17.21 6.34,18.65H6.35C6.74,19.04 6.74,19.67 6.35,20.06C5.96,20.45 5.32,20.45 4.93,20.07V20.07C3.12,18.26 2,15.76 2,13A10,10 0 0,1 12,3M22,13C22,15.76 20.88,18.26 19.07,20.07V20.07C18.68,20.45 18.05,20.45 17.66,20.06C17.27,19.67 17.27,19.04 17.66,18.65V18.65C19.11,17.2 20,15.21 20,13C20,12 19.81,11 19.46,10.1L20.67,8C21.5,9.5 22,11.18 22,13Z",af="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z",lf="M12,15.39L8.24,17.66L9.23,13.38L5.91,10.5L10.29,10.13L12,6.09L13.71,10.13L18.09,10.5L14.77,13.38L15.76,17.66M22,9.24L14.81,8.63L12,2L9.19,8.63L2,9.24L7.45,13.97L5.82,21L12,17.27L18.18,21L16.54,13.97L22,9.24Z",bg="M21,9L17,5V8H10V10H17V13M7,11L3,15L7,19V16H14V14H7V11Z",Ud="M11,2V4.07C7.38,4.53 4.53,7.38 4.07,11H2V13H4.07C4.53,16.62 7.38,19.47 11,19.93V22H13V19.93C16.62,19.47 19.47,16.62 19.93,13H22V11H19.93C19.47,7.38 16.62,4.53 13,4.07V2M11,6.08V8H13V6.09C15.5,6.5 17.5,8.5 17.92,11H16V13H17.91C17.5,15.5 15.5,17.5 13,17.92V16H11V17.91C8.5,17.5 6.5,15.5 6.08,13H8V11H6.09C6.5,8.5 8.5,6.5 11,6.08M12,11A1,1 0 0,0 11,12A1,1 0 0,0 12,13A1,1 0 0,0 13,12A1,1 0 0,0 12,11Z",wg="M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z",yg="M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z",Zo="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z",Wd="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z",jd="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z",Gd="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z";/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */function kr(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(u){s(u)}}function a(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?i(c.value):(u=c.value,u instanceof n?u:new n(function(f){f(u)})).then(o,a)}l((r=r.apply(t,e||[])).next())})}let il=class{constructor(){this.listeners={}}on(e,n,r){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(n),r==null?void 0:r.once){const i=()=>{this.un(e,i),this.un(e,n)};return this.on(e,i),i}return()=>this.un(e,n)}un(e,n){var r;(r=this.listeners[e])===null||r===void 0||r.delete(n)}once(e,n){return this.on(e,n,{once:!0})}unAll(){this.listeners={}}emit(e,...n){this.listeners[e]&&this.listeners[e].forEach(r=>r(...n))}};const zd={decode:function(t,e){return kr(this,void 0,void 0,function*(){const n=new AudioContext({sampleRate:e});return n.decodeAudioData(t).finally(()=>n.close())})},createBuffer:function(t,e){return typeof t[0]=="number"&&(t=[t]),function(n){const r=n[0];if(r.some(i=>i>1||i<-1)){const i=r.length;let s=0;for(let o=0;o<i;o++){const a=Math.abs(r[o]);a>s&&(s=a)}for(const o of n)for(let a=0;a<i;a++)o[a]/=s}}(t),{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:n=>t==null?void 0:t[n],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Xd(t,e){const n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[r,i]of Object.entries(e))if(r==="children")for(const[s,o]of Object.entries(e))typeof o=="string"?n.appendChild(document.createTextNode(o)):n.appendChild(Xd(s,o));else r==="style"?Object.assign(n.style,i):r==="textContent"?n.textContent=i:n.setAttribute(r,i.toString());return n}function Yd(t,e,n){const r=Xd(t,e||{});return n==null||n.appendChild(r),r}var vg=Object.freeze({__proto__:null,createElement:Yd,default:Yd});const Eg={fetchBlob:function(t,e,n){return kr(this,void 0,void 0,function*(){const r=yield fetch(t,n);if(r.status>=400)throw new Error(`Failed to fetch ${t}: ${r.status} (${r.statusText})`);return function(i,s){kr(this,void 0,void 0,function*(){if(!i.body||!i.headers)return;const o=i.body.getReader(),a=Number(i.headers.get("Content-Length"))||0;let l=0;const c=f=>kr(this,void 0,void 0,function*(){l+=(f==null?void 0:f.length)||0;const p=Math.round(l/a*100);s(p)}),u=()=>kr(this,void 0,void 0,function*(){let f;try{f=yield o.read()}catch{return}f.done||(c(f.value),yield u())});u()})}(r.clone(),e),r.blob()})}};class Sg extends il{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)},{once:!0})}onMediaEvent(e,n,r){return this.media.addEventListener(e,n,r),()=>this.media.removeEventListener(e,n,r)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,n){if(this.getSrc()===e)return;this.revokeSrc();const r=n instanceof Blob&&this.canPlayType(n.type)?URL.createObjectURL(n):e;this.media.src=r}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(e){this.media=e}play(){return kr(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,n){n!=null&&(this.media.preservesPitch=n),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}class vu extends il{constructor(e,n){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.options=e;const r=this.parentFromOptionsContainer(e.container);this.parent=r;const[i,s]=this.initHtml();r.appendChild(i),this.container=i,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),n&&s.appendChild(n),this.initEvents()}parentFromOptionsContainer(e){let n;if(typeof e=="string"?n=document.querySelector(e):e instanceof HTMLElement&&(n=e),!n)throw new Error("Container not found");return n}initEvents(){const e=r=>{const i=this.wrapper.getBoundingClientRect(),s=r.clientX-i.left,o=r.clientX-i.left;return[s/i.width,o/i.height]};this.wrapper.addEventListener("click",r=>{const[i,s]=e(r);this.emit("click",i,s)}),this.wrapper.addEventListener("dblclick",r=>{const[i,s]=e(r);this.emit("dblclick",i,s)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:r,scrollWidth:i,clientWidth:s}=this.scrollContainer,o=r/i,a=(r+s)/i;this.emit("scroll",o,a)});const n=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{n().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender())}initDrag(){(function(e,n,r,i,s=3,o=0){if(!e)return()=>{};let a=()=>{};const l=c=>{if(c.button!==o)return;c.preventDefault(),c.stopPropagation();let u=c.clientX,f=c.clientY,p=!1;const y=b=>{b.preventDefault(),b.stopPropagation();const E=b.clientX,R=b.clientY,h=E-u,k=R-f;if(p||Math.abs(h)>s||Math.abs(k)>s){const L=e.getBoundingClientRect(),{left:$,top:P}=L;p||(r==null||r(u-$,f-P),p=!0),n(h,k,E-$,R-P),u=E,f=R}},m=b=>{if(p){const E=b.clientX,R=b.clientY,h=e.getBoundingClientRect(),{left:k,top:L}=h;i==null||i(E-k,R-L)}a()},g=b=>{b.relatedTarget&&b.relatedTarget!==document.documentElement||m(b)},w=b=>{p&&(b.stopPropagation(),b.preventDefault())},_=b=>{p&&b.preventDefault()};document.addEventListener("pointermove",y),document.addEventListener("pointerup",m),document.addEventListener("pointerout",g),document.addEventListener("pointercancel",g),document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("click",w,{capture:!0}),a=()=>{document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",m),document.removeEventListener("pointerout",g),document.removeEventListener("pointercancel",g),document.removeEventListener("touchmove",_),setTimeout(()=>{document.removeEventListener("click",w,{capture:!0})},10)}};e.addEventListener("pointerdown",l)})(this.wrapper,(e,n,r)=>{this.emit("drag",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))})}getHeight(e){return e==null?128:isNaN(Number(e))?e==="auto"&&this.parent.clientHeight||128:Number(e)}initHtml(){const e=document.createElement("div"),n=e.attachShadow({mode:"open"});return n.innerHTML=`
      <style>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,n]}setOptions(e){if(this.options.container!==e.container){const n=this.parentFromOptionsContainer(e.container);n.appendChild(this.container),this.parent=n}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:n}=this.scrollContainer,r=n*e;this.setScroll(r)}destroy(){var e;this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect()}createDelay(e=10){let n,r;const i=()=>{n&&clearTimeout(n),r&&r()};return this.timeouts.push(i),()=>new Promise((s,o)=>{i(),r=o,n=setTimeout(()=>{n=void 0,r=void 0,s()},e)})}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const n=document.createElement("canvas"),r=n.getContext("2d"),i=n.height*(window.devicePixelRatio||1),s=r.createLinearGradient(0,0,0,i),o=1/(e.length-1);return e.forEach((a,l)=>{const c=l*o;s.addColorStop(c,a)}),s}renderBarWaveform(e,n,r,i){const s=e[0],o=e[1]||e[0],a=s.length,{width:l,height:c}=r.canvas,u=c/2,f=window.devicePixelRatio||1,p=n.barWidth?n.barWidth*f:1,y=n.barGap?n.barGap*f:n.barWidth?p/2:0,m=n.barRadius||0,g=l/(p+y)/a,w=m&&"roundRect"in r?"roundRect":"rect";r.beginPath();let _=0,b=0,E=0;for(let R=0;R<=a;R++){const h=Math.round(R*g);if(h>_){const $=Math.round(b*u*i),P=$+Math.round(E*u*i)||1;let I=u-$;n.barAlign==="top"?I=0:n.barAlign==="bottom"&&(I=c-P),r[w](_*(p+y),I,p,P,m),_=h,b=0,E=0}const k=Math.abs(s[R]||0),L=Math.abs(o[R]||0);k>b&&(b=k),L>E&&(E=L)}r.fill(),r.closePath()}renderLineWaveform(e,n,r,i){const s=o=>{const a=e[o]||e[0],l=a.length,{height:c}=r.canvas,u=c/2,f=r.canvas.width/l;r.moveTo(0,u);let p=0,y=0;for(let m=0;m<=l;m++){const g=Math.round(m*f);if(g>p){const _=u+(Math.round(y*u*i)||1)*(o===0?-1:1);r.lineTo(p,_),p=g,y=0}const w=Math.abs(a[m]||0);w>y&&(y=w)}r.lineTo(p,u)};r.beginPath(),s(0),s(1),r.fill(),r.closePath()}renderWaveform(e,n,r){if(r.fillStyle=this.convertColorValues(n.waveColor),n.renderFunction)return void n.renderFunction(e,r);let i=n.barHeight||1;if(n.normalize){const s=Array.from(e[0]).reduce((o,a)=>Math.max(o,Math.abs(a)),0);i=s?1/s:1}n.barWidth||n.barGap||n.barAlign?this.renderBarWaveform(e,n,r,i):this.renderLineWaveform(e,n,r,i)}renderSingleCanvas(e,n,r,i,s,o,a,l){const c=window.devicePixelRatio||1,u=document.createElement("canvas"),f=e[0].length;u.width=Math.round(r*(o-s)/f),u.height=i*c,u.style.width=`${Math.floor(u.width/c)}px`,u.style.height=`${i}px`,u.style.left=`${Math.floor(s*r/c/f)}px`,a.appendChild(u);const p=u.getContext("2d");if(this.renderWaveform(e.map(y=>y.slice(s,o)),n,p),u.width>0&&u.height>0){const y=u.cloneNode(),m=y.getContext("2d");m.drawImage(u,0,0),m.globalCompositeOperation="source-in",m.fillStyle=this.convertColorValues(n.progressColor),m.fillRect(0,0,u.width,u.height),l.appendChild(y)}}renderChannel(e,n,r){return kr(this,void 0,void 0,function*(){const i=document.createElement("div"),s=this.getHeight(n.height);i.style.height=`${s}px`,this.canvasWrapper.style.minHeight=`${s}px`,this.canvasWrapper.appendChild(i);const o=i.cloneNode();this.progressWrapper.appendChild(o);const a=e[0].length,l=(_,b)=>{this.renderSingleCanvas(e,n,r,s,Math.max(0,_),Math.min(b,a),i,o)};if(!this.isScrollable)return void l(0,a);const{scrollLeft:c,scrollWidth:u,clientWidth:f}=this.scrollContainer,p=a/u;let y=Math.min(vu.MAX_CANVAS_WIDTH,f);if(n.barWidth||n.barGap){const _=n.barWidth||.5,b=_+(n.barGap||_/2);y%b!=0&&(y=Math.floor(y/b)*b)}const m=Math.floor(Math.abs(c)*p),g=Math.floor(m+y*p),w=g-m;w<=0||(l(m,g),yield Promise.all([kr(this,void 0,void 0,function*(){if(m===0)return;const _=this.createDelay();for(let b=m;b>=0;b-=w)yield _(),l(Math.max(0,b-w),b)}),kr(this,void 0,void 0,function*(){if(g===a)return;const _=this.createDelay();for(let b=g;b<a;b+=w)yield _(),l(b,Math.min(a,b+w))})]))})}render(e){return kr(this,void 0,void 0,function*(){this.timeouts.forEach(a=>a()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const n=window.devicePixelRatio||1,r=this.scrollContainer.clientWidth,i=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrollable=i>r;const s=this.options.fillParent&&!this.isScrollable,o=(s?r:i)*n;this.wrapper.style.width=s?"100%":`${i}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render");try{if(this.options.splitChannels)yield Promise.all(Array.from({length:e.numberOfChannels}).map((a,l)=>{var c;const u=Object.assign(Object.assign({},this.options),(c=this.options.splitChannels)===null||c===void 0?void 0:c[l]);return this.renderChannel([e.getChannelData(l)],u,o)}));else{const a=[e.getChannelData(0)];e.numberOfChannels>1&&a.push(e.getChannelData(1)),yield this.renderChannel(a,this.options,o)}}catch{return}this.emit("rendered")})}reRender(){if(!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:n}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let i=r-n;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,n=!1){const{scrollLeft:r,scrollWidth:i,clientWidth:s}=this.scrollContainer,o=e*i,a=r,l=r+s,c=s/2;if(this.isDragging)o+30>l?this.scrollContainer.scrollLeft+=30:o-30<a&&(this.scrollContainer.scrollLeft-=30);else{(o<a||o>l)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?c:0));const u=o-r-c;n&&this.options.autoCenter&&u>0&&(this.scrollContainer.scrollLeft+=Math.min(u,10))}{const u=this.scrollContainer.scrollLeft,f=u/i,p=(u+s)/i;this.emit("scroll",f,p)}}renderProgress(e,n){if(isNaN(e))return;const r=100*e;this.canvasWrapper.style.clipPath=`polygon(${r}% 0, 100% 0, 100% 100%, ${r}% 100%)`,this.progressWrapper.style.width=`${r}%`,this.cursor.style.left=`${r}%`,this.cursor.style.transform=`translateX(-${Math.round(r)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,n)}exportImage(e,n,r){return kr(this,void 0,void 0,function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(r==="dataURL"){const s=Array.from(i).map(o=>o.toDataURL(e,n));return Promise.resolve(s)}return Promise.all(Array.from(i).map(s=>new Promise((o,a)=>{s.toBlob(l=>{l?o(l):a(new Error("Could not export image"))},e,n)})))})}}vu.MAX_CANVAS_WIDTH=4e3;class Tg extends il{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class Kd extends il{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return kr(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then(n=>{if(n.status>=400)throw new Error(`Failed to fetch ${e}: ${n.status} (${n.statusText})`);return n.arrayBuffer()}).then(n=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(n)).then(n=>{this.currentSrc===e&&(this.buffer=n,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var e;if(!this.paused)return;this.paused=!1,(e=this.bufferNode)===null||e===void 0||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let n=this.playedDuration*this._playbackRate;n>=this.duration&&(n=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,n),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return kr(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){var n,r;const i=e-this.currentTime;(n=this.bufferNode)===null||n===void 0||n.stop(this.audioContext.currentTime+i),(r=this.bufferNode)===null||r===void 0||r.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(e){return kr(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const n=!this.paused;n&&this._pause(),this.playedDuration=e/this._playbackRate,n&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,n;return(e=this._duration)!==null&&e!==void 0?e:((n=this.buffer)===null||n===void 0?void 0:n.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const n=this.buffer.numberOfChannels;for(let r=0;r<n;r++)e.push(this.buffer.getChannelData(r));return e}}const kg={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class sl extends Sg{static create(e){return new sl(e)}constructor(e){const n=e.media||(e.backend==="WebAudio"?new Kd:void 0);super({media:n,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.options=Object.assign({},kg,e),this.timer=new Tg;const r=n?void 0:this.getMediaElement();this.renderer=new vu(this.options,r),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins(),Promise.resolve().then(()=>{this.emit("init");const i=this.options.url||this.getSrc()||"";(i||this.options.peaks&&this.options.duration)&&this.load(i,this.options.peaks,this.options.duration).catch(()=>null)})}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e)}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.updateProgress();this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",e=>{this.emit("error",e.error)}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,n)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,n))}),this.renderer.on("dblclick",(e,n)=>{this.emit("dblclick",e,n)}),this.renderer.on("scroll",(e,n)=>{const r=this.getDuration();this.emit("scroll",e*r,n*r)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",e=>{this.emit("dragstart",e)}),this.renderer.on("dragend",e=>{this.emit("dragend",e)}));{let e;this.subscriptions.push(this.renderer.on("drag",n=>{if(!this.options.interact)return;let r;this.renderer.renderProgress(n),clearTimeout(e),this.isPlaying()?r=0:this.options.dragToSeek===!0?r=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(r=this.options.dragToSeek.debounceTime),e=setTimeout(()=>{this.seekTo(n)},r),this.emit("interaction",n*this.getDuration()),this.emit("drag",n)}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(n=>{this.registerPlugin(n)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e._init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(n=>n!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}setScrollTime(e){const n=e/this.getDuration();this.renderer.setScrollPercentage(n)}getActivePlugins(){return this.plugins}loadAudio(e,n,r,i){return kr(this,void 0,void 0,function*(){if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!n&&!r){const o=a=>this.emit("loading",a);n=yield Eg.fetchBlob(e,o,this.options.fetchParams)}this.setSrc(e,n);const s=i||this.getDuration()||(yield new Promise(o=>{this.onMediaEvent("loadedmetadata",()=>o(this.getDuration()),{once:!0})}));if(!e&&!n){const o=this.getMediaElement();o instanceof Kd&&(o.duration=s)}if(r)this.decodedData=zd.createBuffer(r,s||0);else if(n){const o=yield n.arrayBuffer();this.decodedData=yield zd.decode(o,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(e,n,r){return kr(this,void 0,void 0,function*(){try{return yield this.loadAudio(e,void 0,n,r)}catch(i){throw this.emit("error",i),i}})}loadBlob(e,n,r){return kr(this,void 0,void 0,function*(){try{return yield this.loadAudio("blob",e,n,r)}catch(i){throw this.emit("error",i),i}})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:n=8e3,precision:r=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(e,this.decodedData.numberOfChannels),s=[];for(let o=0;o<i;o++){const a=this.decodedData.getChannelData(o),l=[],c=Math.round(a.length/n);for(let u=0;u<n;u++){const f=a.slice(u*c,(u+1)*c);let p=0;for(let y=0;y<f.length;y++){const m=f[y];Math.abs(m)>Math.abs(p)&&(p=m)}l.push(Math.round(p*r)/r)}s.push(l)}return s}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const n=this.getDuration()*e;this.setTime(n)}playPause(){return kr(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(e="image/png",n=1,r="dataURL"){return kr(this,void 0,void 0,function*(){return this.renderer.exportImage(e,n,r)})}destroy(){this.emit("destroy"),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}sl.BasePlugin=class extends il{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}},sl.dom=vg;class qd{constructor(){this.listeners={}}on(e,n,r){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(n),r==null?void 0:r.once){const i=()=>{this.un(e,i),this.un(e,n)};return this.on(e,i),i}return()=>this.un(e,n)}un(e,n){var r;(r=this.listeners[e])===null||r===void 0||r.delete(n)}once(e,n){return this.on(e,n,{once:!0})}unAll(){this.listeners={}}emit(e,...n){this.listeners[e]&&this.listeners[e].forEach(r=>r(...n))}}class Ag extends qd{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}function Eu(t,e,n,r,i=3,s=0){if(!t)return()=>{};let o=()=>{};const a=l=>{if(l.button!==s)return;l.preventDefault(),l.stopPropagation();let c=l.clientX,u=l.clientY,f=!1;const p=_=>{_.preventDefault(),_.stopPropagation();const b=_.clientX,E=_.clientY,R=b-c,h=E-u;if(f||Math.abs(R)>i||Math.abs(h)>i){const k=t.getBoundingClientRect(),{left:L,top:$}=k;f||(n==null||n(c-L,u-$),f=!0),e(R,h,b-L,E-$),c=b,u=E}},y=_=>{if(f){const b=_.clientX,E=_.clientY,R=t.getBoundingClientRect(),{left:h,top:k}=R;r==null||r(b-h,E-k)}o()},m=_=>{_.relatedTarget&&_.relatedTarget!==document.documentElement||y(_)},g=_=>{f&&(_.stopPropagation(),_.preventDefault())},w=_=>{f&&_.preventDefault()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",y),document.addEventListener("pointerout",m),document.addEventListener("pointercancel",m),document.addEventListener("touchmove",w,{passive:!1}),document.addEventListener("click",g,{capture:!0}),o=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",y),document.removeEventListener("pointerout",m),document.removeEventListener("pointercancel",m),document.removeEventListener("touchmove",w),setTimeout(()=>{document.removeEventListener("click",g,{capture:!0})},10)}};return t.addEventListener("pointerdown",a),()=>{o(),t.removeEventListener("pointerdown",a)}}function Zd(t,e){const n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[r,i]of Object.entries(e))if(r==="children")for(const[s,o]of Object.entries(e))typeof o=="string"?n.appendChild(document.createTextNode(o)):n.appendChild(Zd(s,o));else r==="style"?Object.assign(n.style,i):r==="textContent"?n.textContent=i:n.setAttribute(r,i.toString());return n}function ol(t,e,n){const r=Zd(t,e||{});return n==null||n.appendChild(r),r}class Jd extends qd{constructor(e,n,r=0){var i,s,o,a,l,c,u,f;super(),this.totalDuration=n,this.numberOfChannels=r,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((i=e.end)!==null&&i!==void 0?i:e.start),this.drag=(s=e.drag)===null||s===void 0||s,this.resize=(o=e.resize)===null||o===void 0||o,this.color=(a=e.color)!==null&&a!==void 0?a:"rgba(0, 0, 0, 0.1)",this.minLength=(l=e.minLength)!==null&&l!==void 0?l:this.minLength,this.maxLength=(c=e.maxLength)!==null&&c!==void 0?c:this.maxLength,this.channelIdx=(u=e.channelIdx)!==null&&u!==void 0?u:-1,this.contentEditable=(f=e.contentEditable)!==null&&f!==void 0?f:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){const e=this.start===this.end;this.element.setAttribute("part",`${e?"marker":"region"} ${this.id}`)}addResizeHandles(e){const n={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},r=ol("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},n),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),i=ol("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},n),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);Eu(r,s=>this.onResize(s,"start"),()=>null,()=>this.onEndResizing(),1),Eu(i,s=>this.onResize(s,"end"),()=>null,()=>this.onEndResizing(),1)}removeResizeHandles(e){const n=e.querySelector('[part*="region-handle-left"]'),r=e.querySelector('[part*="region-handle-right"]');n&&e.removeChild(n),r&&e.removeChild(r)}initElement(){const e=this.start===this.end;let n=0,r=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(r=100/this.numberOfChannels,n=r*this.channelIdx);const i=ol("div",{style:{position:"absolute",top:`${n}%`,height:`${r}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(i),i}renderPosition(){const e=this.start/this.totalDuration,n=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*n+"%"}toggleCursor(e){var n;this.drag&&(!((n=this.element)===null||n===void 0)&&n.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",n=>this.emit("click",n)),e.addEventListener("mouseenter",n=>this.emit("over",n)),e.addEventListener("mouseleave",n=>this.emit("leave",n)),e.addEventListener("dblclick",n=>this.emit("dblclick",n)),e.addEventListener("pointerdown",()=>this.toggleCursor(!0)),e.addEventListener("pointerup",()=>this.toggleCursor(!1)),Eu(e,n=>this.onMove(n),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}),this.contentEditable&&this.content&&(this.content.addEventListener("click",n=>this.onContentClick(n)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(e,n){if(!this.element.parentElement)return;const{width:r}=this.element.parentElement.getBoundingClientRect(),i=e/r*this.totalDuration,s=n&&n!=="start"?this.start:this.start+i,o=n&&n!=="end"?this.end:this.end+i,a=o-s;s>=0&&o<=this.totalDuration&&s<=o&&a>=this.minLength&&a<=this.maxLength&&(this.start=s,this.end=o,this.renderPosition(),this.emit("update",n))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,n){this.resize&&this._onUpdate(e,n)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(){this.emit("play")}setContent(e){var n;if((n=this.content)===null||n===void 0||n.remove(),e){if(typeof e=="string"){const r=this.start===this.end;this.content=ol("div",{style:{padding:`0.2em ${r?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(e){var n,r;if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const i=this.start===this.end;this.start=this.clampPosition((n=e.start)!==null&&n!==void 0?n:this.start),this.end=this.clampPosition((r=e.end)!==null&&r!==void 0?r:i?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const i=this.start===this.end;this.resize=e.resize,this.resize&&!i?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class uf extends Ag{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new uf(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",n=>{const r=this.regions.filter(i=>i.start<=n&&(i.end===i.start?i.start+.05:i.end)>=n);r.forEach(i=>{e.includes(i)||this.emit("region-in",i)}),e.forEach(i=>{r.includes(i)||this.emit("region-out",i)}),e=r}))}initRegionsContainer(){return ol("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"3",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){if(!e.content)return;const n=e.content,r=n.getBoundingClientRect(),i=this.regions.map(s=>{if(s===e||!s.content)return 0;const o=s.content.getBoundingClientRect();return r.left<o.left+o.width&&o.left<r.left+r.width?o.height:0}).reduce((s,o)=>s+o,0);n.style.marginTop=`${i}px`}adjustScroll(e){var n,r;const i=(r=(n=this.wavesurfer)===null||n===void 0?void 0:n.getWrapper())===null||r===void 0?void 0:r.parentElement;if(!i)return;const{clientWidth:s,scrollWidth:o}=i;if(o<=s)return;const a=i.getBoundingClientRect(),l=e.element.getBoundingClientRect(),c=l.left-a.left,u=l.right-a.left;c<0?i.scrollLeft+=c:u>s&&(i.scrollLeft+=u-s)}saveRegion(e){this.regionsContainer.appendChild(e.element),this.avoidOverlapping(e),this.regions.push(e);const n=[e.on("update",r=>{r||this.adjustScroll(e)}),e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",()=>{var r,i;(r=this.wavesurfer)===null||r===void 0||r.play(),(i=this.wavesurfer)===null||i===void 0||i.setTime(e.start)}),e.on("click",r=>{this.emit("region-clicked",e,r)}),e.on("dblclick",r=>{this.emit("region-double-clicked",e,r)}),e.once("remove",()=>{n.forEach(r=>r()),this.regions=this.regions.filter(r=>r!==e),this.emit("region-removed",e)})];this.subscriptions.push(...n),this.emit("region-created",e)}addRegion(e){var n,r;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),s=(r=(n=this.wavesurfer)===null||n===void 0?void 0:n.getDecodedData())===null||r===void 0?void 0:r.numberOfChannels,o=new Jd(e,i,s);return i?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",a=>{o._setTotalDuration(a),this.saveRegion(o)})),o}enableDragSelection(e,n=3){var r;const i=(r=this.wavesurfer)===null||r===void 0?void 0:r.getWrapper();if(!(i&&i instanceof HTMLElement))return()=>{};let s=null,o=0;return Eu(i,(a,l,c)=>{s&&s._onUpdate(a,c>o?"end":"start")},a=>{var l,c;if(o=a,!this.wavesurfer)return;const u=this.wavesurfer.getDuration(),f=(c=(l=this.wavesurfer)===null||l===void 0?void 0:l.getDecodedData())===null||c===void 0?void 0:c.numberOfChannels,{width:p}=this.wavesurfer.getWrapper().getBoundingClientRect(),y=a/p*u,m=(a+5)/p*u;s=new Jd(Object.assign(Object.assign({},e),{start:y,end:m}),u,f),this.regionsContainer.appendChild(s.element)},()=>{s&&(this.saveRegion(s),s=null)},n)}clearRegions(){this.regions.forEach(e=>e.remove())}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}function Cg(t){let e;return{c(){e=Ft("Edit Subtitle")},m(n,r){de(n,e,r)},d(n){n&&ce(e)}}}function Qd(t){let e,n;return e=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"match-btns m-l-s",path:Ja,title:t[10],action:Be.CANCEL_EXPORT,subtitle:t[0]}}),e.$on("executed",t[29]),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i[0]&1024&&(s.title=r[10]),i[0]&1&&(s.subtitle=r[0]),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function eh(t){let e,n,r,i,s;return n=new Tt({props:{path:Zc}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title",Be.ALIGN_SUBTITLE),re(e,"class","m-l-s")},m(o,a){de(o,e,a),we(n,e,null),r=!0,i||(s=Ke(e,"click",t[18]),i=!0)},p:wt,i(o){r||(J(n.$$.fragment,o),r=!0)},o(o){ne(n.$$.fragment,o),r=!1},d(o){o&&ce(e),ye(n),i=!1,s()}}}function Mg(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P=t[0].text+"",I,H,ae,V,v,D,F;i=new Tt({props:{path:rl}}),c=new Tt({props:{path:xd}}),p=new Tt({props:{path:qo}}),m=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:Qa,title:t[6],action:Be.EXPORT_NEW,subtitle:t[0],clickHandler:t[19]}}),m.$on("executed",t[20]),w=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:el,title:t[7],action:Be.EXPORT_UPDATE,subtitle:t[0],clickHandler:t[19]}}),w.$on("executed",t[20]),b=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:nl,title:t[8],action:Be.OPEN_LAST_EXPORTED_CARD,subtitle:t[0]}});let Y=t[9]&&Qd(t),K=!t[13]&&t[11].matchedBy&&eh(t);return V=new Rn({props:{path:gu,title:Be.COPY_SUBTITLE,action:Be.COPY_SUBTITLE,subtitle:t[0],ignoreSkipKeyListener:!0,buttonClasses:"match-btns m-l-s"}}),{c(){e=ge("div"),n=ge("div"),r=ge("button"),ve(i.$$.fragment),a=me(),l=ge("button"),ve(c.$$.fragment),u=me(),f=ge("button"),ve(p.$$.fragment),y=me(),ve(m.$$.fragment),g=me(),ve(w.$$.fragment),_=me(),ve(b.$$.fragment),E=me(),Y&&Y.c(),R=me(),h=ge("div"),k=me(),L=ge("div"),$=ge("div"),I=Ft(P),H=me(),K&&K.c(),ae=me(),ve(V.$$.fragment),re(r,"title",s=t[4]?"Pause playback":"Already paused"),r.disabled=o=!t[4],re(l,"title","Play active subtitle"),re(l,"class","m-l-s"),re(f,"title","Restore time"),re(f,"class","m-l-s"),re(h,"class","waveform w-full h-full"),re(L,"class","flex items-center"),re(e,"class","w-full p-x-xs"),re(e,"slot","content")},m(Q,W){de(Q,e,W),oe(e,n),oe(n,r),we(i,r,null),oe(n,a),oe(n,l),we(c,l,null),oe(n,u),oe(n,f),we(p,f,null),oe(n,y),we(m,n,null),oe(n,g),we(w,n,null),oe(n,_),we(b,n,null),oe(n,E),Y&&Y.m(n,null),oe(e,R),oe(e,h),t[30](h),oe(e,k),oe(e,L),oe(L,$),oe($,I),oe(L,H),K&&K.m(L,null),oe(L,ae),we(V,L,null),v=!0,D||(F=[Ke(r,"click",t[16]),Ke(l,"click",t[17]),Ke(f,"click",t[28]),Ke(e,"touchstart",Aa(t[27]))],D=!0)},p(Q,W){(!v||W[0]&16&&s!==(s=Q[4]?"Pause playback":"Already paused"))&&re(r,"title",s),(!v||W[0]&16&&o!==(o=!Q[4]))&&(r.disabled=o);const O={};W[0]&64&&(O.title=Q[6]),W[0]&1&&(O.subtitle=Q[0]),m.$set(O);const C={};W[0]&128&&(C.title=Q[7]),W[0]&1&&(C.subtitle=Q[0]),w.$set(C);const S={};W[0]&256&&(S.title=Q[8]),W[0]&1&&(S.subtitle=Q[0]),b.$set(S),Q[9]?Y?(Y.p(Q,W),W[0]&512&&J(Y,1)):(Y=Qd(Q),Y.c(),J(Y,1),Y.m(n,null)):Y&&(Wt(),ne(Y,1,1,()=>{Y=null}),jt()),(!v||W[0]&1)&&P!==(P=Q[0].text+"")&&ln(I,P),!Q[13]&&Q[11].matchedBy?K?(K.p(Q,W),W[0]&2048&&J(K,1)):(K=eh(Q),K.c(),J(K,1),K.m(L,ae)):K&&(Wt(),ne(K,1,1,()=>{K=null}),jt());const M={};W[0]&1&&(M.subtitle=Q[0]),V.$set(M)},i(Q){v||(J(i.$$.fragment,Q),J(c.$$.fragment,Q),J(p.$$.fragment,Q),J(m.$$.fragment,Q),J(w.$$.fragment,Q),J(b.$$.fragment,Q),J(Y),J(K),J(V.$$.fragment,Q),v=!0)},o(Q){ne(i.$$.fragment,Q),ne(c.$$.fragment,Q),ne(p.$$.fragment,Q),ne(m.$$.fragment,Q),ne(w.$$.fragment,Q),ne(b.$$.fragment,Q),ne(Y),ne(K),ne(V.$$.fragment,Q),v=!1},d(Q){Q&&ce(e),ye(i),ye(c),ye(p),ye(m),ye(w),ye(b),Y&&Y.d(),t[30](null),K&&K.d(),ye(V),D=!1,vn(F)}}}function Rg(t){let e,n,r,i,s,o;return{c(){e=ge("div"),n=ge("button"),n.textContent="Cancel",r=me(),i=ge("button"),i.textContent="Save",re(e,"class","flex grow justify-between p-x-xs"),re(e,"slot","footer")},m(a,l){de(a,e,l),oe(e,n),oe(e,r),oe(e,i),s||(o=[Ke(n,"click",t[21]),Ke(i,"click",t[22])],s=!0)},p:wt,d(a){a&&ce(e),s=!1,vn(o)}}}function Lg(t){let e,n,r,i,s,o;return e=new _u({props:{$$slots:{footer:[Rg],content:[Mg],header:[Cg]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment),n=me(),r=ge("div"),r.innerHTML='<span class="spinner"></span>',re(r,"class","backdrop"),ht(r,"hidden",!t[2]&&!t[9])},m(a,l){we(e,a,l),de(a,n,l),de(a,r,l),i=!0,s||(o=Ke(window,"keydown",t[15]),s=!0)},p(a,l){const c={};l[0]&4091|l[1]&32768&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),(!i||l[0]&516)&&ht(r,"hidden",!a[2]&&!a[9])},i(a){i||(J(e.$$.fragment,a),i=!0)},o(a){ne(e.$$.fragment,a),i=!1},d(a){a&&(ce(n),ce(r)),ye(e,a),s=!1,o()}}}function Pg(t,e,n){let r,i,s,o,a,l,c,u,f,p;fe(t,Oa,Ee=>n(36,r=Ee)),fe(t,Na,Ee=>n(38,s=Ee)),fe(t,Pr,Ee=>n(39,o=Ee)),fe(t,rs,Ee=>n(6,a=Ee)),fe(t,is,Ee=>n(7,l=Ee)),fe(t,ss,Ee=>n(8,c=Ee)),fe(t,yi,Ee=>n(9,u=Ee)),fe(t,Yo,Ee=>n(10,f=Ee)),fe(t,Uo,Ee=>n(11,p=Ee));let{activeSubtitle:y}=e,{subtitleRegions:m}=e,{resolver:g}=e;const w=m[0].startSeconds,_=getComputedStyle(document.documentElement).getPropertyValue("--ttu-whispersync-color"),b=Mi(),E=JSON.parse(JSON.stringify(y)),R=y.text!==y.originalText,{ankiEnableOpenInBrowser$:h}=_t;fe(t,h,Ee=>n(37,i=Ee));let k,L,$,P=!0,I,H,ae=!1,V=!1,v=-1,D;La(X),Gl(()=>{D==null||D(),L==null||L.destroy(),URL.revokeObjectURL(I)});function F(Ee){if(P||Ee.repeat||!(Ee.ctrlKey||Ee.metaKey||Ee.altKey))return;const Ve=(Ee.code||Ee.key||"").toLowerCase();let Te=Be.NONE,Le=!0;if(Ee.altKey)switch(Ve){case"keyd":case"d":Te=Be.TOGGLE_PLAY_PAUSE;break;case"keye":case"e":Te=Be.EXPORT_UPDATE;break;case"keyz":case"z":Te=Be.COPY_SUBTITLE;break;case"keyj":case"j":Y();break;default:Le=!1;break}else switch(Ve){case"space":case" ":Y();break;case"keyd":case"d":Te=Be.TOGGLE_PLAY_PAUSE;break;case"keye":case"e":Te=Be.EXPORT_NEW;break;case"keyo":case"o":Te=Be.OPEN_LAST_EXPORTED_CARD;break;default:Le=!1;break}Le&&(Ee.preventDefault(),Ee.stopPropagation()),Te===Be.TOGGLE_PLAY_PAUSE?K():Bn(Te,y,{ignoreSkipKeyListener:!0})}function Y(){L.pause(),D==null||D(),v=-1}function K(){D==null||D(),v=H.end,D=L.on("timeupdate",Q),L.setTime(H.start),L.play()}function Q(Ee){Ee>v&&Y()}async function W(){n(2,P=!0),await Bn(Be.ALIGN_SUBTITLE,E,{persistAlignment:!1,ignoreSkipKeyListener:!0}),n(0,y.text=o.get(y.id).text,y),n(2,P=!1)}function O(){n(5,V=!1)}function C(){if(V||!s&&!i)return;const Ee=H.start+w,Ve=H.end+w;return!R&&y.text!==y.originalText||Ee!==E.startSeconds||Ve!==E.endSeconds?M():z({wasCanceled:!0})}function S(){if(!R&&y.text!==y.originalText)return z({wasCanceled:!1,subtitle:E});z({wasCanceled:!0})}function M(){G(),z({wasCanceled:!1,subtitle:y})}async function X(){try{if(!r)throw new Error("Audio file required");const Ee=await yd(r,[mn(m[0].startSeconds,m[m.length-1].endSeconds)]);if(!Ee)throw new Error("No audio file returned");I=URL.createObjectURL(new Blob([Ee],{type:"audio/mpeg"})),L=sl.create({container:k,waveColor:_,url:I}),$=L.registerPlugin(uf.create()),L.once("decode",()=>{for(let Ve=0,{length:Te}=m;Ve<Te;Ve+=1){const Le=m[Ve];if(Le.subIndex===-1)continue;const Ie=y.id===Le.id,et=$.addRegion(ie(Le,Ie));Ie?(et.element.part.add("active"),et.on("update",Y),et.on("update-end",G),n(3,H=et),G()):et.element.part.add("inactive")}}),L.on("interaction",Ve=>{D==null||D(),Ve>=H.start&&Ve<=H.end&&(v=H.end,D=L.on("timeupdate",Q)),L.play()}),L.on("play",()=>n(4,ae=!0)),L.on("pause",()=>n(4,ae=!1)),L.once("ready",()=>{n(2,P=!1)})}catch({message:Ee}){n(2,P=!1),z({wasCanceled:!1,error:`Failed to create waveform: ${Ee}`})}}function ie(Ee,Ve=!0){return{start:Ee.startSeconds-w,end:Ee.endSeconds-w,color:_,drag:Ve,resize:Ve,id:Ee.id}}function G(){const Ee=H.start+w,Ve=H.end+w;n(0,y={...y,adjustedStartSeconds:Ee,startSeconds:Ee,startTime:qr(Ee),adjustedEndSeconds:Ve,endSeconds:Ve,endTime:qr(Ve)})}function z(Ee){g==null||g(Ee),b("close")}function le(Ee){wn.call(this,t,Ee)}const Me=()=>{Y(),H.setOptions(ie(E)),H.element.part.add("active"),G()},_e=()=>n(5,V=!0);function Ae(Ee){$t[Ee?"unshift":"push"](()=>{k=Ee,n(1,k)})}return t.$$set=Ee=>{"activeSubtitle"in Ee&&n(0,y=Ee.activeSubtitle),"subtitleRegions"in Ee&&n(25,m=Ee.subtitleRegions),"resolver"in Ee&&n(26,g=Ee.resolver)},[y,k,P,H,ae,V,a,l,c,u,f,p,E,R,h,F,Y,K,W,O,C,S,M,ie,G,m,g,le,Me,_e,Ae]}class Ig extends In{constructor(e){super(),Pn(this,e,Pg,Lg,Tn,{activeSubtitle:0,subtitleRegions:25,resolver:26},null,[-1,-1])}}function Bg(t){let e,n,r,i;return{c(){e=ge("input"),re(e,"type","number"),re(e,"class","time-input"),re(e,"min",t[1]),re(e,"max",t[2]),re(e,"step",t[3])},m(s,o){de(s,e,o),Ci(e,t[0]),r||(i=[Ke(e,"input",t[7]),Ke(e,"change",t[5]),ka(n=Su.call(null,e,{document,isSkipped:t[4]}))],r=!0)},p(s,[o]){o&2&&re(e,"min",s[1]),o&4&&re(e,"max",s[2]),o&8&&re(e,"step",s[3]),o&1&&Bc(e.value)!==s[0]&&Ci(e,s[0]),n&&Ai(n.update)&&o&16&&n.update.call(null,{document,isSkipped:s[4]})},i:wt,o:wt,d(s){s&&ce(e),r=!1,vn(i)}}}function Og(t,e,n){let r;fe(t,En,p=>n(4,r=p));let{value:i}=e,{defaultValue:s}=e,{min:o=0}=e,{max:a=59}=e,{step:l=1}=e;const c=Mi();async function u(p){await x_(p,s),c("changed")}function f(){i=Bc(this.value),n(0,i)}return t.$$set=p=>{"value"in p&&n(0,i=p.value),"defaultValue"in p&&n(6,s=p.defaultValue),"min"in p&&n(1,o=p.min),"max"in p&&n(2,a=p.max),"step"in p&&n(3,l=p.step)},[i,o,a,l,r,u,s,f]}class Li extends In{constructor(e){super(),Pn(this,e,Og,Bg,Tn,{value:0,defaultValue:6,min:1,max:2,step:3})}}function th(t){let e,n,r=!1,i,s=!0,o,a;function l(){cancelAnimationFrame(i),e.paused||(i=J1(l),r=!0),t[46].call(e)}return{c(){e=ge("audio"),e.controls=!0,re(e,"class","hidden"),Mo(e.src,n=t[10])||re(e,"src",n),t[1]===void 0&&Cs(()=>t[45].call(e))},m(c,u){de(c,e,u),t[48](e),o||(a=[Ke(e,"durationchange",t[45]),Ke(e,"timeupdate",l),Ke(e,"play",t[47]),Ke(e,"pause",t[47]),Ke(e,"loadedmetadata",t[34]),Ke(e,"timeupdate",t[35])],o=!0)},p(c,u){u[0]&1024&&!Mo(e.src,n=c[10])&&re(e,"src",n),!r&&u[0]&8192&&!isNaN(c[13])&&(e.currentTime=c[13]),r=!1,u[0]&16384&&s!==(s=c[14])&&e[s?"pause":"play"]()},d(c){c&&ce(e),t[48](null),o=!1,vn(a)}}}function Dg(t){let e;return{c(){e=Ft("Edit Subtitle")},m(n,r){de(n,e,r)},d(n){n&&ce(e)}}}function nh(t){let e,n,r,i,s,o,a,l;return n=new Tt({props:{path:t[14]?yu:rl}}),s=new Tt({props:{path:xd}}),{c(){e=ge("button"),ve(n.$$.fragment),r=me(),i=ge("button"),ve(s.$$.fragment),re(e,"title","Toggle playback"),re(i,"title","Replay"),re(i,"class","m-l-s")},m(c,u){de(c,e,u),we(n,e,null),de(c,r,u),de(c,i,u),we(s,i,null),o=!0,a||(l=[Ke(e,"click",t[49]),Ke(i,"click",t[36])],a=!0)},p(c,u){const f={};u[0]&16384&&(f.path=c[14]?yu:rl),n.$set(f)},i(c){o||(J(n.$$.fragment,c),J(s.$$.fragment,c),o=!0)},o(c){ne(n.$$.fragment,c),ne(s.$$.fragment,c),o=!1},d(c){c&&(ce(e),ce(r),ce(i)),ye(n),ye(s),a=!1,vn(l)}}}function rh(t){let e,n;return e=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"match-btns m-l-s",path:Ja,title:t[21],action:Be.CANCEL_EXPORT,subtitle:t[0]}}),e.$on("executed",t[51]),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i[0]&2097152&&(s.title=r[21]),i[0]&1&&(s.subtitle=r[0]),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function ih(t){let e,n,r,i,s;return n=new Tt({props:{path:Zc}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title",Be.ALIGN_SUBTITLE),re(e,"class","m-l-s")},m(o,a){de(o,e,a),we(n,e,null),r=!0,i||(s=Ke(e,"click",t[38]),i=!0)},p:wt,i(o){r||(J(n.$$.fragment,o),r=!0)},o(o){ne(n.$$.fragment,o),r=!1},d(o){o&&ce(e),ye(n),i=!1,s()}}}function Ng(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We=t[0].text+"",tt,ke,Pe,Xe,qe,it,Je,U=t[10]&&nh(t);s=new Tt({props:{path:qo}}),a=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:Qa,title:t[17],action:Be.EXPORT_NEW,subtitle:t[0],clickHandler:t[39]}}),a.$on("executed",t[40]),c=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:el,title:t[18],action:Be.EXPORT_UPDATE,subtitle:t[0],clickHandler:t[39]}}),c.$on("executed",t[40]),f=new Rn({props:{ignoreSkipKeyListener:!0,buttonClasses:"m-l-s",path:nl,title:t[19],action:Be.OPEN_LAST_EXPORTED_CARD,subtitle:t[0]}});let T=t[20]&&rh(t);function d($e){t[52]($e)}let A={defaultValue:t[24],max:t[16]};t[2]!==void 0&&(A.value=t[2]),_=new Li({props:A}),$t.push(()=>qn(_,"value",d)),_.$on("changed",t[37]);function N($e){t[53]($e)}let j={defaultValue:t[25]};t[3]!==void 0&&(j.value=t[3]),k=new Li({props:j}),$t.push(()=>qn(k,"value",N)),k.$on("changed",t[37]);function ee($e){t[54]($e)}let te={defaultValue:t[26]};t[4]!==void 0&&(te.value=t[4]),H=new Li({props:te}),$t.push(()=>qn(H,"value",ee)),H.$on("changed",t[37]);function se($e){t[55]($e)}let be={defaultValue:t[27],max:999,step:100};t[5]!==void 0&&(be.value=t[5]),F=new Li({props:be}),$t.push(()=>qn(F,"value",se)),F.$on("changed",t[37]);function he($e){t[56]($e)}let Ce={defaultValue:t[28],max:t[16]};t[6]!==void 0&&(Ce.value=t[6]),C=new Li({props:Ce}),$t.push(()=>qn(C,"value",he)),C.$on("changed",t[37]);function Re($e){t[57]($e)}let Fe={defaultValue:t[29]};t[7]!==void 0&&(Fe.value=t[7]),G=new Li({props:Fe}),$t.push(()=>qn(G,"value",Re)),G.$on("changed",t[37]);function nt($e){t[58]($e)}let pt={defaultValue:t[30]};t[8]!==void 0&&(pt.value=t[8]),Ae=new Li({props:pt}),$t.push(()=>qn(Ae,"value",nt)),Ae.$on("changed",t[37]);function je($e){t[59]($e)}let ft={defaultValue:t[31],max:999,step:100};t[9]!==void 0&&(ft.value=t[9]),Ie=new Li({props:ft}),$t.push(()=>qn(Ie,"value",je)),Ie.$on("changed",t[37]);let Oe=!t[32]&&t[22].matchedBy&&ih(t);return Xe=new Rn({props:{path:gu,title:Be.COPY_SUBTITLE,action:Be.COPY_SUBTITLE,subtitle:t[0],ignoreSkipKeyListener:!0,buttonClasses:"match-btns m-l-s"}}),{c(){e=ge("div"),n=ge("div"),U&&U.c(),r=me(),i=ge("button"),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),ve(c.$$.fragment),u=me(),ve(f.$$.fragment),p=me(),T&&T.c(),y=me(),m=ge("div"),g=ge("div"),w=ge("div"),ve(_.$$.fragment),E=me(),R=ge("span"),R.textContent=":",h=me(),ve(k.$$.fragment),$=me(),P=ge("span"),P.textContent=":",I=me(),ve(H.$$.fragment),V=me(),v=ge("span"),v.textContent=",",D=me(),ve(F.$$.fragment),K=me(),Q=ge("span"),Q.textContent="-",W=me(),O=ge("div"),ve(C.$$.fragment),M=me(),X=ge("span"),X.textContent=":",ie=me(),ve(G.$$.fragment),le=me(),Me=ge("span"),Me.textContent=":",_e=me(),ve(Ae.$$.fragment),Ve=me(),Te=ge("span"),Te.textContent=",",Le=me(),ve(Ie.$$.fragment),B=me(),x=ge("div"),Ne=ge("div"),tt=Ft(We),ke=me(),Oe&&Oe.c(),Pe=me(),ve(Xe.$$.fragment),re(i,"title","Restore time"),ht(i,"m-l-s",t[10]),re(n,"class","m-b-s"),re(w,"class","flex"),re(Q,"class","m-b"),re(O,"class","flex"),re(g,"class","flex items-center time-edit m-b-s"),re(x,"class","flex items-center m-t-b"),re(m,"class","flex flex-col"),re(e,"slot","content")},m($e,at){de($e,e,at),oe(e,n),U&&U.m(n,null),oe(n,r),oe(n,i),we(s,i,null),oe(n,o),we(a,n,null),oe(n,l),we(c,n,null),oe(n,u),we(f,n,null),oe(n,p),T&&T.m(n,null),oe(e,y),oe(e,m),oe(m,g),oe(g,w),we(_,w,null),oe(w,E),oe(w,R),oe(w,h),we(k,w,null),oe(w,$),oe(w,P),oe(w,I),we(H,w,null),oe(w,V),oe(w,v),oe(w,D),we(F,w,null),oe(g,K),oe(g,Q),oe(g,W),oe(g,O),we(C,O,null),oe(O,M),oe(O,X),oe(O,ie),we(G,O,null),oe(O,le),oe(O,Me),oe(O,_e),we(Ae,O,null),oe(O,Ve),oe(O,Te),oe(O,Le),we(Ie,O,null),oe(m,B),oe(m,x),oe(x,Ne),oe(Ne,tt),oe(x,ke),Oe&&Oe.m(x,null),oe(x,Pe),we(Xe,x,null),qe=!0,it||(Je=Ke(i,"click",t[50]),it=!0)},p($e,at){$e[10]?U?(U.p($e,at),at[0]&1024&&J(U,1)):(U=nh($e),U.c(),J(U,1),U.m(n,r)):U&&(Wt(),ne(U,1,1,()=>{U=null}),jt()),(!qe||at[0]&1024)&&ht(i,"m-l-s",$e[10]);const Ge={};at[0]&131072&&(Ge.title=$e[17]),at[0]&1&&(Ge.subtitle=$e[0]),a.$set(Ge);const mt={};at[0]&262144&&(mt.title=$e[18]),at[0]&1&&(mt.subtitle=$e[0]),c.$set(mt);const Qe={};at[0]&524288&&(Qe.title=$e[19]),at[0]&1&&(Qe.subtitle=$e[0]),f.$set(Qe),$e[20]?T?(T.p($e,at),at[0]&1048576&&J(T,1)):(T=rh($e),T.c(),J(T,1),T.m(n,null)):T&&(Wt(),ne(T,1,1,()=>{T=null}),jt());const vt={};at[0]&65536&&(vt.max=$e[16]),!b&&at[0]&4&&(b=!0,vt.value=$e[2],Kn(()=>b=!1)),_.$set(vt);const Lt={};!L&&at[0]&8&&(L=!0,Lt.value=$e[3],Kn(()=>L=!1)),k.$set(Lt);const lt={};!ae&&at[0]&16&&(ae=!0,lt.value=$e[4],Kn(()=>ae=!1)),H.$set(lt);const Et={};!Y&&at[0]&32&&(Y=!0,Et.value=$e[5],Kn(()=>Y=!1)),F.$set(Et);const dt={};at[0]&65536&&(dt.max=$e[16]),!S&&at[0]&64&&(S=!0,dt.value=$e[6],Kn(()=>S=!1)),C.$set(dt);const Gt={};!z&&at[0]&128&&(z=!0,Gt.value=$e[7],Kn(()=>z=!1)),G.$set(Gt);const Qt={};!Ee&&at[0]&256&&(Ee=!0,Qt.value=$e[8],Kn(()=>Ee=!1)),Ae.$set(Qt);const Kt={};!et&&at[0]&512&&(et=!0,Kt.value=$e[9],Kn(()=>et=!1)),Ie.$set(Kt),(!qe||at[0]&1)&&We!==(We=$e[0].text+"")&&ln(tt,We),!$e[32]&&$e[22].matchedBy?Oe?(Oe.p($e,at),at[0]&4194304&&J(Oe,1)):(Oe=ih($e),Oe.c(),J(Oe,1),Oe.m(x,Pe)):Oe&&(Wt(),ne(Oe,1,1,()=>{Oe=null}),jt());const zt={};at[0]&1&&(zt.subtitle=$e[0]),Xe.$set(zt)},i($e){qe||(J(U),J(s.$$.fragment,$e),J(a.$$.fragment,$e),J(c.$$.fragment,$e),J(f.$$.fragment,$e),J(T),J(_.$$.fragment,$e),J(k.$$.fragment,$e),J(H.$$.fragment,$e),J(F.$$.fragment,$e),J(C.$$.fragment,$e),J(G.$$.fragment,$e),J(Ae.$$.fragment,$e),J(Ie.$$.fragment,$e),J(Oe),J(Xe.$$.fragment,$e),qe=!0)},o($e){ne(U),ne(s.$$.fragment,$e),ne(a.$$.fragment,$e),ne(c.$$.fragment,$e),ne(f.$$.fragment,$e),ne(T),ne(_.$$.fragment,$e),ne(k.$$.fragment,$e),ne(H.$$.fragment,$e),ne(F.$$.fragment,$e),ne(C.$$.fragment,$e),ne(G.$$.fragment,$e),ne(Ae.$$.fragment,$e),ne(Ie.$$.fragment,$e),ne(Oe),ne(Xe.$$.fragment,$e),qe=!1},d($e){$e&&ce(e),U&&U.d(),ye(s),ye(a),ye(c),ye(f),T&&T.d(),ye(_),ye(k),ye(H),ye(F),ye(C),ye(G),ye(Ae),ye(Ie),Oe&&Oe.d(),ye(Xe),it=!1,Je()}}}function Fg(t){let e,n,r,i,s,o;return{c(){e=ge("div"),n=ge("button"),n.textContent="Cancel",r=me(),i=ge("button"),i.textContent="Save",re(e,"class","flex grow justify-between"),re(e,"slot","footer")},m(a,l){de(a,e,l),oe(e,n),oe(e,r),oe(e,i),s||(o=[Ke(n,"click",t[41]),Ke(i,"click",t[42])],s=!0)},p:wt,d(a){a&&ce(e),s=!1,vn(o)}}}function $g(t){let e,n,r,i,s,o,a,l=t[10]&&th(t);return n=new _u({props:{$$slots:{footer:[Fg],content:[Ng],header:[Dg]},$$scope:{ctx:t}}}),{c(){l&&l.c(),e=me(),ve(n.$$.fragment),r=me(),i=ge("div"),i.innerHTML='<span class="spinner"></span>',re(i,"class","backdrop"),ht(i,"hidden",!t[12]&&!t[20])},m(c,u){l&&l.m(c,u),de(c,e,u),we(n,c,u),de(c,r,u),de(c,i,u),s=!0,o||(a=Ke(window,"keydown",t[33]),o=!0)},p(c,u){c[10]?l?l.p(c,u):(l=th(c),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null);const f={};u[0]&8374269|u[2]&512&&(f.$$scope={dirty:u,ctx:c}),n.$set(f),(!s||u[0]&1052672)&&ht(i,"hidden",!c[12]&&!c[20])},i(c){s||(J(n.$$.fragment,c),s=!0)},o(c){ne(n.$$.fragment,c),s=!1},d(c){c&&(ce(e),ce(r),ce(i)),l&&l.d(c),ye(n,c),o=!1,a()}}}function Vg(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w;fe(t,Na,se=>n(63,a=se)),fe(t,Pr,se=>n(64,l=se)),fe(t,Da,se=>n(10,c=se)),fe(t,xi,se=>n(65,u=se)),fe(t,rs,se=>n(17,f=se)),fe(t,is,se=>n(18,p=se)),fe(t,ss,se=>n(19,y=se)),fe(t,yi,se=>n(20,m=se)),fe(t,Yo,se=>n(21,g=se)),fe(t,Uo,se=>n(22,w=se));let{activeSubtitle:_}=e,{resolver:b}=e;const{isIOS:E}=Bo("context"),{ankiEnableOpenInBrowser$:R}=_t;fe(t,R,se=>n(62,o=se));const[h,k,L,$]=ls(_.startSeconds),[P,I,H,ae]=ls(_.endSeconds),V=JSON.parse(JSON.stringify(_)),v=_.text!==_.originalText,D=Mi();let F,Y=!!c,K=_.startSeconds,Q=0,W=!0,O=!1,[C,S,M,X]=[h,k,L,$],[ie,G,z,le]=[P,I,H,ae];function Me(se){if(Y||u||se.repeat||!(se.ctrlKey||se.metaKey||se.altKey))return;const be=(se.code||se.key||"").toLowerCase();let he=Be.NONE,Ce=!0;if(se.altKey)switch(be){case"keyd":case"d":he=c?Be.TOGGLE_PLAY_PAUSE:Be.NONE;break;case"keye":case"e":x(),he=Be.EXPORT_UPDATE;break;case"keyz":case"z":he=Be.COPY_SUBTITLE;break;case"keyj":case"j":c&&n(14,W=!W);break;default:Ce=!1;break}else switch(be){case"space":case" ":c&&n(14,W=!W);break;case"keyd":case"d":he=c?Be.TOGGLE_PLAY_PAUSE:Be.NONE;break;case"keye":case"e":x(),he=Be.EXPORT_NEW;break;case"keyo":case"o":he=Be.OPEN_LAST_EXPORTED_CARD;break;default:Ce=!1;break}Ce&&(se.preventDefault(),se.stopPropagation()),he===Be.TOGGLE_PLAY_PAUSE?Ee():Bn(he,_,{ignoreSkipKeyListener:!0})}async function _e(){if(!E){n(11,F.currentTime=_.startSeconds,F),n(12,Y=!1);return}let se=0,be;const he=new Promise(Re=>{be=Re,F.addEventListener("loadeddata",Re,{once:!0,capture:!1})});await new Promise(Re=>{const Fe=setInterval(async()=>{try{se+=1,F.play(),setTimeout(be,1e4),await he,F.pause(),clearInterval(Fe),Re()}catch{}se>20&&(clearInterval(Fe),be(void 0),Re())},500)}),n(11,F.currentTime=_.startSeconds,F),await Rr(),n(12,Y=!1)}function Ae(){K>i&&x()}function Ee(){n(13,K=r),n(14,W=!1)}async function Ve(){n(14,W=!0),c&&r>Q&&n(2,[C,S,M,X]=ls(i),C,n(3,S),n(4,M),n(5,X)),c&&i>Q&&n(6,[ie,G,z,le]=ls(Q),ie,n(7,G),n(8,z),n(9,le)),await Rr(),r>i&&(n(2,[C,S,M,X]=ls(i),C,n(3,S),n(4,M),n(5,X)),n(6,[ie,G,z,le]=ls(r),ie,n(7,G),n(8,z),n(9,le)),await Rr()),n(13,K=r),Ne()}async function Te(){n(12,Y=!0),await Bn(Be.ALIGN_SUBTITLE,V,{persistAlignment:!1,ignoreSkipKeyListener:!0}),n(0,_.text=l.get(_.id).text,_),n(12,Y=!1)}function Le(){x(),n(15,O=!1)}function Ie(){if(!(O||!a&&!o))return!v&&_.text!==_.originalText||r!==V.startSeconds||i!==V.endSeconds?B():We({wasCanceled:!0})}function et(){if(!v&&_.text!==_.originalText)return We({wasCanceled:!1,subtitle:V});We({wasCanceled:!0})}async function B(){await Rr(),Ne(),We({wasCanceled:!1,subtitle:_})}function x(){n(14,W=!0),n(13,K=r)}function Ne(){n(0,_={..._,adjustedStartSeconds:r,startSeconds:r,startTime:qr(r),adjustedEndSeconds:i,endSeconds:i,endTime:qr(i)})}function We(se){b==null||b(se),D("close")}function tt(){Q=this.duration,n(1,Q)}function ke(){K=this.currentTime,n(13,K)}function Pe(){W=this.paused,n(14,W)}function Xe(se){$t[se?"unshift":"push"](()=>{F=se,n(11,F)})}const qe=()=>n(14,W=!W),it=()=>{n(14,W=!0),n(2,[C,S,M,X]=[h,k,L,$],C,n(3,S),n(4,M),n(5,X)),n(6,[ie,G,z,le]=[P,I,H,ae],ie,n(7,G),n(8,z),n(9,le)),Rr().then(Ne)},Je=()=>n(15,O=!0);function U(se){C=se,n(2,C)}function T(se){S=se,n(3,S)}function d(se){M=se,n(4,M)}function A(se){X=se,n(5,X)}function N(se){ie=se,n(6,ie)}function j(se){G=se,n(7,G)}function ee(se){z=se,n(8,z)}function te(se){le=se,n(9,le)}return t.$$set=se=>{"activeSubtitle"in se&&n(0,_=se.activeSubtitle),"resolver"in se&&n(44,b=se.resolver)},t.$$.update=()=>{t.$$.dirty[0]&60&&(r=C*3600+S*60+M+X/1e3),t.$$.dirty[0]&960&&(i=ie*3600+G*60+z+le/1e3),t.$$.dirty[0]&1026&&n(16,s=c?Math.floor(Q/3600):999)},[_,Q,C,S,M,X,ie,G,z,le,c,F,Y,K,W,O,s,f,p,y,m,g,w,R,h,k,L,$,P,I,H,ae,v,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,Ne,b,tt,ke,Pe,Xe,qe,it,Je,U,T,d,A,N,j,ee,te]}class xg extends In{constructor(e){super(),Pn(this,e,Vg,$g,Tn,{activeSubtitle:0,resolver:44},null,[-1,-1,-1])}}function cf(t,e){t.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"skipKeyDownListener",params:{value:e}}})),En.set(e)}function sh(t,e){const n=Mt(t);n.has(e)?n.delete(e):n.add(e),t.set(n)}async function Hg(t){kn.set(!0);const e=Mt(Ls)&&Mt(_t.exportAudioProcessor$)===Tr.FFMPEG,n=e?Ig:xg,r=Mt(Pr),i=[...r.values()],s={activeSubtitle:JSON.parse(JSON.stringify(t))};if(e){const a=i.slice(Math.max(0,t.subIndex-1),t.subIndex+2);if(t.subIndex===0){const l=Math.max(0,t.startSeconds-10);a.unshift(mn(l))}else if(t.subIndex===r.size-1){const l=Ui(0,Mt(as),t.endSeconds+10);a.push(mn(l,l))}s.subtitleRegions=JSON.parse(JSON.stringify(a))}const o=await new Promise(a=>{xo.add({component:n,props:{...s,resolver:a}})});if(o.error)return Ct.set(o.error);o.wasCanceled||!o.subtitle||(r.set(t.id,o.subtitle),Pr.set(r),Xa.set({subtitles:[o.subtitle]}),Mt(_t.subtitlesEnablePersist$)&&(Ct.set(""),i[o.subtitle.subIndex]=o.subtitle,await Ps({name:Mt(ns).name,subtitles:i}).catch(({message:a})=>Ct.set(a))))}async function Ug(t,e){var n;try{Ct.set(""),await new Promise(o=>window.setTimeout(o,100));const r=uu(new DOMParser,Mt(Ri).elementHtml),i=Mt(Pr);let s=!1;for(let o=0,{length:a}=t;o<a;o+=1){const l=i.get(t[o].id),c=r.querySelectorAll(Qs(l.id));let u="";for(let f=0,{length:p}=c;f<p;f+=1){const y=c[f],m=(((n=y.parentElement)==null?void 0:n.tagName)||"").toLowerCase();lu.has(m)||(u+=y.innerText.trim())}u!==l.originalText&&(l.text=u,i.set(l.id,l),s=!0)}if(!s||(Pr.set(i),!e||!Mt(_t.subtitlesEnablePersist$)))return;Ct.set(""),await Ps({name:Mt(ns).name,subtitles:[...i.values()]})}catch({message:r}){Ct.set(`Failed to align: ${r}`)}}async function Wg(t){const e=[],n=Mt(Pr),r=Mt(as),i=Mt(_t.subtitlesGlobalStartPadding$)/1e3,s=Mt(_t.subtitlesGlobalEndPadding$)/1e3;let o=!1;for(let a=0,{length:l}=t;a<l;a+=1){const c=t[a],u=Math.max(0,c.originalStartSeconds+i),f=r?Ui(0,r,c.originalEndSeconds+s):Math.max(0,c.originalEndSeconds+s),p=c.text!==c.originalText,y=Number.isFinite(c.adjustedStartSeconds)&&c.adjustedStartSeconds!==u||Number.isFinite(c.adjustedEndSeconds)&&c.adjustedEndSeconds!==f;if(delete c.adjustedStartSeconds,delete c.adjustedEndSeconds,p||y){const m={...c,startSeconds:u,startTime:qr(u),endSeconds:f,endTime:qr(f),text:c.originalText};n.set(c.id,m),o=!0,y&&e.push(m)}}o&&(Pr.set(n),Xa.set({subtitles:e}),Mt(_t.subtitlesEnablePersist$)&&(Ct.set(""),await Ps({name:Mt(ns).name,subtitles:[...n.values()]}).catch(({message:a})=>Ct.set(a))))}function jg(t,e){if(e)return JSON.parse(JSON.stringify([t]));const n=[];for(let r=0,{length:i}=t;r<i;r+=1)n.push([t[r]]);return JSON.parse(JSON.stringify(n))}var Be=(t=>(t.NONE="None",t.TOGGLE_PLAYBACK="Toggle playback",t.REWIND="Rewind",t.REWIND_ALT="Rewind #2",t.FAST_FORWARD="Fast-Forward",t.FAST_FORWARD_ALT="Fast-Forward #2",t.RESTART_PLAYBACK="Restart playback",t.TOGGLE_PLAY_PAUSE="Toggle play and pause",t.TOGGLE_PLAYBACK_LOOP="Toggle playback loop",t.TOGGLE_BOOKMARK="Toggle bookmark",t.TOGGLE_MERGE="Toggle for merge",t.ALIGN_SUBTITLE="Align with book text",t.EDIT_SUBTITLE="Edit subtitle",t.RESTORE_SUBTITLE="Restore original text and time",t.COPY_SUBTITLE="Copy subtitle",t.PREVIOUS_SUBTITLE="Go to previous subtitle",t.NEXT_SUBTITLE="Go to next subtitle",t.EXPORT_NEW="Create new card",t.EXPORT_UPDATE="Update last created card",t.OPEN_LAST_EXPORTED_CARD="Open last exported card",t.CANCEL_EXPORT="Cancel Export",t))(Be||{});function Gg(t,e){const n=r=>{!r.defaultPrevented&&!t.contains(r.target)&&e(r)};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}function Su(t,{document:e,isSkipped:n}){const r=()=>cf(e,!0),i=()=>cf(e,!1);return n||(t.addEventListener("focus",r,!1),t.addEventListener("blur",i,!1)),{destroy(){t.removeEventListener("focus",r,!1),t.removeEventListener("blur",i,!1),n||cf(e,!1)}}}async function Bn(t,e,n={mergeSubtitles:!1,skipUpdates:!1,keepPauseState:!1,persistAlignment:!0,ignoreSkipKeyListener:!1}){if(t==="None"||!e||!n.ignoreSkipKeyListener&&Mt(En))return;const r=Array.isArray(e)?e:[e],i=Mt(yi),s=Mt(xi);if(r.length)if(!s&&t==="Toggle playback"){const o=Mt(kn);kn.set(!o)}else if(!s&&(t==="Restart playback"||t==="Toggle play and pause"||t==="Toggle playback loop"))au.set({action:t,subtitles:r,skipUpdates:n.skipUpdates,keepPauseState:n.keepPauseState});else if(t==="Toggle bookmark")sh(su,r[0].id);else if(t==="Toggle for merge")sh(ou,r[0].id);else if(!i&&t==="Edit subtitle")await Hg(r[0]);else if(!i&&t==="Align with book text"&&Mt(Uo).matchedBy)await Ug(r,n.persistAlignment);else if(!i&&t==="Restore original text and time")await Wg(r);else if(t==="Copy subtitle")await navigator.clipboard.writeText(r[0].text).catch(({message:o})=>console.log(`failed to copy subtitle: ${o}`));else if(!s&&(t==="Go to previous subtitle"||t==="Go to next subtitle")){const o=[...Mt(Pr).values()];let a;t==="Go to previous subtitle"?a=o[Math.max(r[0].subIndex-1,0)]:a=o[Math.min(r[0].subIndex+1,o.length-1)],au.set({action:"Restart playback",subtitles:[a],skipUpdates:n.skipUpdates,keepPauseState:!0})}else!i&&(t==="Create new card"||t==="Update last created card")&&Mt(eu)?await Q_(jg(r,n.mergeSubtitles),t==="Update last created card").finally(()=>{tu.set(0),yi.set(void 0)}):i?i&&!i.signal.aborted&&t==="Cancel Export"&&(i.abort("user aborted"),yi.set(i)):await kd(Mt(_t.ankiUrl$))}async function Ps(t){const e=Mt(Lr);try{await Mt(Ho).put("subtitle",{subtitleData:t,title:e.title,lastSubtitleDataModified:Date.now()}),e.subtitleData=t,document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"subtitle"}}))}catch({message:n}){throw new Error(`Failed to persist subtitles - ${n}`)}finally{Lr.set(e)}}function zg(t){let e,n,r,i,s,o;return n=new Tt({props:{path:t[0],iconStyles:t[7]}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title",t[1]),re(e,"style",t[6]),re(e,"class",t[5]),e.disabled=r=t[1]!==t[2]},m(a,l){de(a,e,l),we(n,e,null),i=!0,s||(o=Ke(e,"click",t[11]),s=!0)},p(a,[l]){const c={};l&1&&(c.path=a[0]),l&128&&(c.iconStyles=a[7]),n.$set(c),(!i||l&2)&&re(e,"title",a[1]),(!i||l&64)&&re(e,"style",a[6]),(!i||l&32)&&re(e,"class",a[5]),(!i||l&6&&r!==(r=a[1]!==a[2]))&&(e.disabled=r)},i(a){i||(J(n.$$.fragment,a),i=!0)},o(a){ne(n.$$.fragment,a),i=!1},d(a){a&&ce(e),ye(n),s=!1,o()}}}function Xg(t,e,n){let{path:r}=e,{title:i}=e,{action:s}=e,{skipUpdates:o=!1}=e,{ignoreSkipKeyListener:a=!1}=e,{buttonClasses:l="m-y-xs"}=e,{buttonStyles:c=""}=e,{iconStyles:u=""}=e,{subtitle:f=void 0}=e,{clickHandler:p=void 0}=e;const y=Mi(),m=()=>{p==null||p(),Bn(s,f,{skipUpdates:o,ignoreSkipKeyListener:a,mergeSubtitles:!1,keepPauseState:!1,persistAlignment:!0}).finally(()=>y("executed",s))};return t.$$set=g=>{"path"in g&&n(0,r=g.path),"title"in g&&n(1,i=g.title),"action"in g&&n(2,s=g.action),"skipUpdates"in g&&n(3,o=g.skipUpdates),"ignoreSkipKeyListener"in g&&n(4,a=g.ignoreSkipKeyListener),"buttonClasses"in g&&n(5,l=g.buttonClasses),"buttonStyles"in g&&n(6,c=g.buttonStyles),"iconStyles"in g&&n(7,u=g.iconStyles),"subtitle"in g&&n(8,f=g.subtitle),"clickHandler"in g&&n(9,p=g.clickHandler)},[r,i,s,o,a,l,c,u,f,p,y,m]}class Rn extends In{constructor(e){super(),Pn(this,e,Xg,zg,Tn,{path:0,title:1,action:2,skipUpdates:3,ignoreSkipKeyListener:4,buttonClasses:5,buttonStyles:6,iconStyles:7,subtitle:8,clickHandler:9})}}function oh(t,e,n){const r=t.slice();return r[57]=e[n],r}function ah(t){let e,n,r,i;const s=[fb,cb,ub,lb,ab,ob,sb,ib,rb,nb,tb,eb,Qg,Jg,Zg,qg,Kg,Yg],o=[];function a(l,c){return l[57].action===Be.TOGGLE_PLAYBACK?0:l[57].action===Be.REWIND_ALT?1:l[57].action===Be.REWIND?2:l[57].action===Be.FAST_FORWARD?3:l[57].action===Be.FAST_FORWARD_ALT?4:l[57].action===Be.PREVIOUS_SUBTITLE?5:l[57].action===Be.NEXT_SUBTITLE?6:l[57].action===Be.RESTART_PLAYBACK?7:l[57].action===Be.TOGGLE_PLAY_PAUSE?8:l[57].action===Be.TOGGLE_PLAYBACK_LOOP?9:l[57].action===Be.TOGGLE_BOOKMARK?10:l[57].action===Be.TOGGLE_MERGE?11:l[57].action===Be.EDIT_SUBTITLE?12:l[57].action===Be.RESTORE_SUBTITLE?13:l[57].action===Be.COPY_SUBTITLE?14:l[57].action===Be.EXPORT_NEW?15:l[57].action===Be.EXPORT_UPDATE?16:l[57].action===Be.OPEN_LAST_EXPORTED_CARD?17:-1}return~(e=a(t))&&(n=o[e]=s[e](t)),{c(){n&&n.c(),r=Dr()},m(l,c){~e&&o[e].m(l,c),de(l,r,c),i=!0},p(l,c){let u=e;e=a(l),e===u?~e&&o[e].p(l,c):(n&&(Wt(),ne(o[u],1,1,()=>{o[u]=null}),jt()),~e?(n=o[e],n?n.p(l,c):(n=o[e]=s[e](l),n.c()),J(n,1),n.m(r.parentNode,r)):n=null)},i(l){i||(J(n),i=!0)},o(l){ne(n),i=!1},d(l){l&&ce(r),~e&&o[e].d(l)}}}function Yg(t){let e,n;const r=[t[28](Be.OPEN_LAST_EXPORTED_CARD,t[24],nl,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[52]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&285212672?or(r,[ar(s[28](Be.OPEN_LAST_EXPORTED_CARD,s[24],nl,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function Kg(t){let e,n;const r=[t[28](Be.EXPORT_UPDATE,t[23],el,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[51]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&276824066?or(r,[ar(s[28](Be.EXPORT_UPDATE,s[23],el,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function qg(t){let e,n;const r=[t[28](Be.EXPORT_NEW,t[22],Qa,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[50]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&272629762?or(r,[ar(s[28](Be.EXPORT_NEW,s[22],Qa,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function Zg(t){let e,n;const r=[t[28](Be.COPY_SUBTITLE,Be.COPY_SUBTITLE,gu,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[49]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268435458?or(r,[ar(s[28](Be.COPY_SUBTITLE,Be.COPY_SUBTITLE,gu,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function Jg(t){let e,n;const r=[t[28](Be.RESTORE_SUBTITLE,t[6],qo,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[48]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268435522?or(r,[ar(s[28](Be.RESTORE_SUBTITLE,s[6],qo,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function Qg(t){let e,n;const r=[t[28](Be.EDIT_SUBTITLE,t[21],Ld,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[47]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&270532610?or(r,[ar(s[28](Be.EDIT_SUBTITLE,s[21],Ld,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function eb(t){let e,n;const r=[t[28](Be.TOGGLE_MERGE,t[20],t[4],t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[46]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&269484050?or(r,[ar(s[28](Be.TOGGLE_MERGE,s[20],s[4],s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function tb(t){let e,n;const r=[t[28](Be.TOGGLE_BOOKMARK,t[19],t[5],t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[45]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268959778?or(r,[ar(s[28](Be.TOGGLE_BOOKMARK,s[19],s[5],s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function nb(t){let e,n;const r=[{skipUpdates:t[2]},t[28](Be.TOGGLE_PLAYBACK_LOOP,t[18],Qc,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[44]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268697606?or(r,[o[0]&4&&{skipUpdates:s[2]},o[0]&268697602&&ar(s[28](Be.TOGGLE_PLAYBACK_LOOP,s[18],Qc,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function rb(t){let e,n;const r=[{skipUpdates:t[2]},t[28](Be.TOGGLE_PLAY_PAUSE,t[17],Jc,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[43]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268566534?or(r,[o[0]&4&&{skipUpdates:s[2]},o[0]&268566530&&ar(s[28](Be.TOGGLE_PLAY_PAUSE,s[17],Jc,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function ib(t){let e,n;const r=[{skipUpdates:t[2]},t[28](Be.RESTART_PLAYBACK,t[16],Vd,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[42]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268500998?or(r,[o[0]&4&&{skipUpdates:s[2]},o[0]&268500994&&ar(s[28](Be.RESTART_PLAYBACK,s[16],Vd,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function sb(t){let e,n;const r=[t[28](Be.NEXT_SUBTITLE,t[15],Dd,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[41]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268468226?or(r,[ar(s[28](Be.NEXT_SUBTITLE,s[15],Dd,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function ob(t){let e,n;const r=[t[28](Be.PREVIOUS_SUBTITLE,t[14],Nd,t[1])];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[40]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268451842?or(r,[ar(s[28](Be.PREVIOUS_SUBTITLE,s[14],Nd,s[1]))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function ab(t){let e,n;const r=[t[28](Be.FAST_FORWARD_ALT,t[13],rf,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[39]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268443648?or(r,[ar(s[28](Be.FAST_FORWARD_ALT,s[13],rf,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function lb(t){let e,n;const r=[t[28](Be.FAST_FORWARD,t[12],sf,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[38]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268439552?or(r,[ar(s[28](Be.FAST_FORWARD,s[12],sf,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function ub(t){let e,n;const r=[t[28](Be.REWIND,t[11],of,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[37]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268437504?or(r,[ar(s[28](Be.REWIND,s[11],of,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function cb(t){let e,n;const r=[t[28](Be.REWIND_ALT,t[10],nf,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[36]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268436480?or(r,[ar(s[28](Be.REWIND_ALT,s[10],nf,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function fb(t){let e,n;const r=[t[28](Be.TOGGLE_PLAYBACK,t[7],t[8]||t[9]?$d:Fd,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[35]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&268436352?or(r,[ar(s[28](Be.TOGGLE_PLAYBACK,s[7],s[8]||s[9]?$d:Fd,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function lh(t,e){let n,r,i,s=e[57].enabled&&ah(e);return{key:t,first:null,c(){n=Dr(),s&&s.c(),r=Dr(),this.first=n},m(o,a){de(o,n,a),s&&s.m(o,a),de(o,r,a),i=!0},p(o,a){e=o,e[57].enabled?s?(s.p(e,a),a[0]&1&&J(s,1)):(s=ah(e),s.c(),J(s,1),s.m(r.parentNode,r)):s&&(Wt(),ne(s,1,1,()=>{s=null}),jt())},i(o){i||(J(s),i=!0)},o(o){ne(s),i=!1},d(o){o&&(ce(n),ce(r)),s&&s.d(o)}}}function uh(t){let e,n;const r=[t[28](Be.CANCEL_EXPORT,t[25],Ja,mn(0))];let i={};for(let s=0;s<r.length;s+=1)i=an(i,r[s]);return e=new Rn({props:i}),e.$on("executed",t[53]),{c(){ve(e.$$.fragment)},m(s,o){we(e,s,o),n=!0},p(s,o){const a=o[0]&301989888?or(r,[ar(s[28](Be.CANCEL_EXPORT,s[25],Ja,mn(0)))]):{};e.$set(a)},i(s){n||(J(e.$$.fragment,s),n=!0)},o(s){ne(e.$$.fragment,s),n=!1},d(s){ye(e,s)}}}function db(t){let e=[],n=new Map,r,i,s,o=Kr(t[0]);const a=c=>c[57].action;for(let c=0;c<o.length;c+=1){let u=oh(t,o,c),f=a(u);n.set(f,e[c]=lh(f,u))}let l=t[3]&&uh(t);return{c(){for(let c=0;c<e.length;c+=1)e[c].c();r=me(),l&&l.c(),i=Dr()},m(c,u){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(c,u);de(c,r,u),l&&l.m(c,u),de(c,i,u),s=!0},p(c,u){u[0]&301989879&&(o=Kr(c[0]),Wt(),e=Ks(e,u,a,1,c,o,n,r.parentNode,id,lh,r,oh),jt()),c[3]?l?(l.p(c,u),u[0]&8&&J(l,1)):(l=uh(c),l.c(),J(l,1),l.m(i.parentNode,i)):l&&(Wt(),ne(l,1,1,()=>{l=null}),jt())},i(c){if(!s){for(let u=0;u<o.length;u+=1)J(e[u]);J(l),s=!0}},o(c){for(let u=0;u<e.length;u+=1)ne(e[u]);ne(l),s=!1},d(c){c&&(ce(r),ce(i));for(let u=0;u<e.length;u+=1)e[u].d(c);l&&l.d(c)}}}function hb(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D;fe(t,as,ke=>n(54,o=ke)),fe(t,ja,ke=>n(6,c=ke)),fe(t,yi,ke=>n(32,u=ke)),fe(t,ou,ke=>n(33,f=ke)),fe(t,su,ke=>n(34,p=ke)),fe(t,$a,ke=>n(7,y=ke)),fe(t,xi,ke=>n(8,m=ke)),fe(t,kn,ke=>n(9,g=ke)),fe(t,xa,ke=>n(10,w=ke)),fe(t,Va,ke=>n(11,_=ke)),fe(t,Ha,ke=>n(12,b=ke)),fe(t,Ua,ke=>n(13,E=ke)),fe(t,Wo,ke=>n(14,R=ke)),fe(t,jo,ke=>n(15,h=ke)),fe(t,Go,ke=>n(16,k=ke)),fe(t,zo,ke=>n(17,L=ke)),fe(t,Xo,ke=>n(18,$=ke)),fe(t,nu,ke=>n(19,P=ke)),fe(t,ru,ke=>n(20,I=ke)),fe(t,Wa,ke=>n(21,H=ke)),fe(t,rs,ke=>n(22,ae=ke)),fe(t,is,ke=>n(23,V=ke)),fe(t,ss,ke=>n(24,v=ke)),fe(t,Yo,ke=>n(25,D=ke));let{listItems:F}=e,{subtitle:Y}=e,{hideCancelAction:K=!1}=e,{skipUpdates:Q=!1}=e,{isFooter:W=!1}=e,{buttonClasses:O=""}=e;const{subtitlesGlobalStartPadding$:C,subtitlesGlobalEndPadding$:S}=_t;fe(t,C,ke=>n(56,l=ke)),fe(t,S,ke=>n(55,a=ke));function M(ke,Pe,Xe,qe){let it=qe?"":"No matching subtitle";if(Pe===c&&qe){const T=l/1e3,d=a/1e3,A=Math.max(0,qe.originalStartSeconds+T),N=o?Ui(0,o,qe.originalEndSeconds+d):Math.max(0,qe.originalEndSeconds+d);it=qe.text!==qe.originalText||Number.isFinite(qe.adjustedStartSeconds)&&qe.adjustedStartSeconds!==A||Number.isFinite(qe.adjustedEndSeconds)&&qe.adjustedEndSeconds!==N?Pe:"No data to restore"}const Je=ke===Pe&&it||Pe,U=Je!==ke;return{path:Xe,action:ke,buttonClasses:O,title:Je,subtitle:qe,buttonStyles:W?`margin-left: 0.5rem;${U?"opacity: 0.4;":""}`:"",iconStyles:W&&U?"cursor: not-allowed;":""}}function X(ke){wn.call(this,t,ke)}function ie(ke){wn.call(this,t,ke)}function G(ke){wn.call(this,t,ke)}function z(ke){wn.call(this,t,ke)}function le(ke){wn.call(this,t,ke)}function Me(ke){wn.call(this,t,ke)}function _e(ke){wn.call(this,t,ke)}function Ae(ke){wn.call(this,t,ke)}function Ee(ke){wn.call(this,t,ke)}function Ve(ke){wn.call(this,t,ke)}function Te(ke){wn.call(this,t,ke)}function Le(ke){wn.call(this,t,ke)}function Ie(ke){wn.call(this,t,ke)}function et(ke){wn.call(this,t,ke)}function B(ke){wn.call(this,t,ke)}function x(ke){wn.call(this,t,ke)}function Ne(ke){wn.call(this,t,ke)}function We(ke){wn.call(this,t,ke)}function tt(ke){wn.call(this,t,ke)}return t.$$set=ke=>{"listItems"in ke&&n(0,F=ke.listItems),"subtitle"in ke&&n(1,Y=ke.subtitle),"hideCancelAction"in ke&&n(29,K=ke.hideCancelAction),"skipUpdates"in ke&&n(2,Q=ke.skipUpdates),"isFooter"in ke&&n(30,W=ke.isFooter),"buttonClasses"in ke&&n(31,O=ke.buttonClasses)},t.$$.update=()=>{t.$$.dirty[0]&2|t.$$.dirty[1]&8&&n(5,r=Y&&p.has(Y.id)?af:lf),t.$$.dirty[0]&2|t.$$.dirty[1]&4&&n(4,i=Y&&f.has(Y.id)?tf:ef),t.$$.dirty[0]&536870913|t.$$.dirty[1]&2&&n(3,s=!K&&!!u&&!!F.find(({action:ke})=>ke===Be.EXPORT_NEW||ke===Be.EXPORT_UPDATE))},[F,Y,Q,s,i,r,c,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,C,S,M,K,W,O,u,f,p,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,tt]}class ff extends In{constructor(e){super(),Pn(this,e,hb,db,Tn,{listItems:0,subtitle:1,hideCancelAction:29,skipUpdates:2,isFooter:30,buttonClasses:31},null,[-1,-1])}}function pb(t){let e,n,r,i,s,o,a;return{c(){e=ge("button"),n=ge("div"),r=Ft(t[1]),i=me(),s=ge("input"),re(n,"class","pointer-events-none whitespace-pre-wrap p-4"),re(e,"class",t[7]),re(e,"style",t[6]),re(s,"class","hidden"),re(s,"type","file"),s.multiple=t[2],re(s,"accept",t[5])},m(l,c){de(l,e,c),oe(e,n),oe(n,r),de(l,i,c),de(l,s,c),t[28](s),o||(a=[Ke(e,"dragenter",t[26]),Ke(e,"dragleave",t[27]),Ke(e,"dragover",Wl(t[25])),Ke(e,"drop",Wl(t[10])),Ke(e,"click",t[8]),Ke(s,"change",t[9])],o=!0)},p(l,c){c[0]&2&&ln(r,l[1]),c[0]&128&&re(e,"class",l[7]),c[0]&64&&re(e,"style",l[6]),c[0]&4&&(s.multiple=l[2]),c[0]&32&&re(s,"accept",l[5])},i:wt,o:wt,d(l){l&&(ce(e),ce(i),ce(s)),t[28](null),o=!1,vn(a)}}}function df(t,e){const n=t,r=e.split("/");return n.filePath=e,n.parentFolder=r.length>2?r[r.length-2]:"/",n}function mb(t){return t.isFile}function _b(t){return t.isDirectory}function gb(t){return new Promise((e,n)=>{t.file(r=>e(r),n)})}function ch(t){return new Promise((e,n)=>{t.readEntries(e,n)})}function bb(t,e,n){let r,i,s,o,a,{disabled:l=!1}=e,{width:c="100%"}=e,{height:u="120px"}=e,{classes:f=""}=e,{dragClasses:p=""}=e,{label:y="Drag-and-drop files / folders to this zone or click it to select them"}=e,{allowRootFiles:m=!1}=e,{multiple:g=!1}=e,{preferNativeFilesystem:w=!1}=e,{fileFormatsDescription:_="Allowed files"}=e,{filePickerId:b="Dropzone"}=e,{fileFormats:E=[]}=e,{oldHandles:R=[]}=e,{oldFiles:h=[]}=e,{accepts:k=""}=e,{types:L=""}=e;const $=Mi(),P="showOpenFilePicker"in window&&w;let I,H=!1;function ae(){if(!l){if(P)return $("start"),D();I.click()}}async function V({currentTarget:M}){var G;if(l||!((G=M.files)!=null&&G.length))return;const X=[...M.files],ie={files:[],errors:[]};for(let z=0,{length:le}=X;z<le;z+=1){const Me=df(X[z],"/"),_e=`.${Me.name.split(".").pop()}`;try{(!s.size||s.has(_e))&&(!a||a.test(Me.type))&&!h.find(Ae=>Ae===Me)&&ie.files.push({file:Me,extension:_e})}catch({message:Ae}){ie.errors.push(`Error on file ${Me.name} - ${Ae}`)}}M.value="",Q(ie)}function v({dataTransfer:M}){if(n(3,H=!1),l||!M)return;const X=M.items,ie=[];$("start");for(let G=0,{length:z}=X;G<z;G+=1){const le=X[G];if(le.kind==="file"){const Me=P?le.getAsFileSystemHandle():le.webkitGetAsEntry();Me&&ie.push(Promise.resolve(Me))}}F(ie)}async function D(){try{const M=[...s],X=await window.showOpenFilePicker({multiple:g,id:b,excludeAcceptAllOption:!!s.size,...s.size?{types:[{description:_,accept:{"*/*":M}}]}:{}});F(X.map(ie=>Promise.resolve(ie)))}catch(M){M.name==="AbortError"?Q():Q({files:[],errors:[`Error selecting file(s) - ${M.message}`]})}}async function F(M){const X={files:[],errors:[]};for(let ie=0,{length:G}=M;ie<G;ie+=1){try{const z=await M[ie];if(z){const le=await Y(z);X.files.push(...le.files),X.errors.push(...le.errors)}}catch({message:z}){X.errors.push(`Error processing entry - ${z}`)}if(X.files.length&&!g)break}Q(X)}async function Y(M,X="/"){const ie={files:[],errors:[]};if(M instanceof FileSystemFileHandle){const G=`.${M.name.split(".").pop()}`;let z=!1;if(s.size&&!s.has(G))return ie;for(let le=0,{length:Me}=R;le<Me&&!z;le+=1)z=await R[le].isSameEntry(M).catch(()=>!1);return z||await M.getFile().then(le=>{const Me=df(le,X);(m||Me.filePath!=="/")&&(!a||a.test(Me.type))&&!h.find(_e=>_e===Me)&&ie.files.push({file:Me,handle:M,extension:G})}).catch(({message:le})=>ie.errors.push(`Error reading file ${M.name} - ${le}`)),ie}else if(mb(M)){const G=`.${M.name.split(".").pop()}`;return s.size&&!s.has(G)||await gb(M).then(z=>{const le=df(z,M.fullPath);(m||le.filePath!=="/")&&(!a||a.test(le.type))&&!h.find(Me=>Me===le)&&ie.files.push({file:le,extension:G})}).catch(({message:z})=>ie.errors.push(`Error reading file ${M.name} - ${z}`)),ie}else if(M instanceof FileSystemDirectoryHandle){const G=M.entries();let z=await G.next().catch(({message:le})=>(ie.errors.push(`Error reading directory ${M.name} - ${le}`),{done:!0,value:[]}));for(;!z.done;){const[le,Me]=z.value,_e=await Y(Me,`${X}${X==="/"?"":"/"}${M.name}${Me.kind==="file"?`/${le}`:""}`);if(ie.errors.push(..._e.errors),!ie.files.length||g){const Ae=g?_e.files.length:1;for(let Ee=0;Ee<Ae;Ee++)ie.files.push(_e.files[Ee])}z=!ie.files.length||g?await G.next().catch(({message:Ae})=>(ie.errors.push(`Error reading directory ${M.name} - ${Ae}`),{done:!0,value:[]})):{done:!0,value:[]}}return ie}else if(_b(M))return K(M.createReader(),M.fullPath||M.name);return ie}async function K(M,X){const ie={files:[],errors:[]};let G=await ch(M).catch(({message:z})=>(ie.errors.push(`Error reading directory ${X} - ${z}`),[]));for(;G.length;){for(let z=0,le=G.length;z<le;z+=1){const Me=G[z];try{const _e=await Y(G[z],Me.fullPath);if(ie.errors.push(..._e.errors),!ie.files.length||g){const Ae=g?_e.files.length:1;for(let Ee=0;Ee<Ae;Ee++)ie.files.push(_e.files[Ee])}}catch({message:_e}){ie.errors.push(`Error reading file ${Me.name} - ${_e}`)}if(ie.files.length&&!g)break}G=!ie.files.length||g?await ch(M).catch(({message:z})=>(ie.errors.push(`Error reading directory ${X} - ${z}`),[])):[]}return ie}function Q(M={files:[],errors:[]}){M.files.length||M.errors.length?$("result",M):$("stop")}function W(M){wn.call(this,t,M)}const O=()=>{l||n(3,H=!0)},C=()=>{l||n(3,H=!1)};function S(M){$t[M?"unshift":"push"](()=>{I=M,n(4,I)})}return t.$$set=M=>{"disabled"in M&&n(0,l=M.disabled),"width"in M&&n(11,c=M.width),"height"in M&&n(12,u=M.height),"classes"in M&&n(13,f=M.classes),"dragClasses"in M&&n(14,p=M.dragClasses),"label"in M&&n(1,y=M.label),"allowRootFiles"in M&&n(15,m=M.allowRootFiles),"multiple"in M&&n(2,g=M.multiple),"preferNativeFilesystem"in M&&n(16,w=M.preferNativeFilesystem),"fileFormatsDescription"in M&&n(17,_=M.fileFormatsDescription),"filePickerId"in M&&n(18,b=M.filePickerId),"fileFormats"in M&&n(19,E=M.fileFormats),"oldHandles"in M&&n(20,R=M.oldHandles),"oldFiles"in M&&n(21,h=M.oldFiles),"accepts"in M&&n(22,k=M.accepts),"types"in M&&n(23,L=M.types)},t.$$.update=()=>{t.$$.dirty[0]&24584&&n(7,r=`dropzone flex justify-center items-center relative ${f||""} ${H?p:""}`),t.$$.dirty[0]&6144&&n(6,i=`width: ${c}; height: ${u};`),t.$$.dirty[0]&524288&&n(24,s=E.length?new Set(E):new Set),t.$$.dirty[0]&20971520&&n(5,o=k||[...s].join(",")||"*"),t.$$.dirty[0]&8388608&&(a=L?new RegExp(L):void 0)},[l,y,g,H,I,o,i,r,ae,V,v,c,u,f,p,m,w,_,b,E,R,h,k,L,s,W,O,C,S]}class wb extends In{constructor(e){super(),Pn(this,e,bb,pb,Tn,{disabled:0,width:11,height:12,classes:13,dragClasses:14,label:1,allowRootFiles:15,multiple:2,preferNativeFilesystem:16,fileFormatsDescription:17,filePickerId:18,fileFormats:19,oldHandles:20,oldFiles:21,accepts:22,types:23},null,[-1,-1])}}function yb(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}function fh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function fi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fh(Object(n),!0).forEach(function(r){Tu(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function vb(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mh(r.key),r)}}function Eb(t,e,n){return e&&dh(t.prototype,e),n&&dh(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tu(t,e,n){return e=mh(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Sb(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Tb(t,e){if(t==null)return{};var n=Sb(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function kb(t,e){return Ab(t)||yb(t,e)||hh(t,e)||Cb()}function Ab(t){if(Array.isArray(t))return t}function hh(t,e){if(t){if(typeof t=="string")return ph(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ph(t,e)}}function ph(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Cb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mb(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=hh(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function Rb(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mh(t){var e=Rb(t,"string");return typeof e=="symbol"?e:String(e)}var Lb=["AudioCount","Audio_Channels_Total","BitDepth_Detected","BitDepth","BitDepth_Stored","Channels","Channels_Original","Chapters_Pos_Begin","Chapters_Pos_End","Comic_Position_Total","Count","DataSize","ElementCount","EPG_Positions_Begin","EPG_Positions_End","FirstPacketOrder","FooterSize","Format_Settings_GMC","Format_Settings_RefFrames","FrameCount","FrameRate_Den","FrameRate_Num","GeneralCount","HeaderSize","Height_CleanAperture","Height","Height_Offset","Height_Original","ImageCount","Matrix_Channels","MenuCount","OtherCount","Part_Position","Part_Position_Total","Played_Count","Reel_Position","Reel_Position_Total","Resolution","Sampled_Height","Sampled_Width","SamplingCount","Season_Position","Season_Position_Total","Source_FrameCount","Source_SamplingCount","Source_StreamSize_Encoded","Source_StreamSize","Status","Stored_Height","Stored_Width","StreamCount","StreamKindID","StreamKindPos","StreamOrder","StreamSize_Demuxed","StreamSize_Encoded","StreamSize","TextCount","Track_Position","Track_Position_Total","Video0_Delay","VideoCount","Width_CleanAperture","Width","Width_Offset","Width_Original"],Pb=["BitRate_Encoded","BitRate_Maximum","BitRate_Minimum","BitRate","BitRate_Nominal","Bits-Pixel_Frame","BitsPixel_Frame","Compression_Ratio","Delay","Delay_Original","DisplayAspectRatio_CleanAperture","DisplayAspectRatio","DisplayAspectRatio_Original","Duration_End_Command","Duration_End","Duration_FirstFrame","Duration_LastFrame","Duration","Duration_Start2End","Duration_Start_Command","Duration_Start","Events_MinDuration","FrameRate_Maximum","FrameRate_Minimum","FrameRate","FrameRate_Nominal","FrameRate_Original_Den","FrameRate_Original","FrameRate_Original_Num","FrameRate_Real","Interleave_Duration","Interleave_Preload","Interleave_VideoFrames","OverallBitRate_Maximum","OverallBitRate_Minimum","OverallBitRate","OverallBitRate_Nominal","PixelAspectRatio_CleanAperture","PixelAspectRatio","PixelAspectRatio_Original","SamplesPerFrame","SamplingRate","Source_Duration_FirstFrame","Source_Duration_LastFrame","Source_Duration","TimeStamp_FirstFrame","Video_Delay"],hf={coverData:!1,chunkSize:256*1024,format:"object",full:!1},Ib=function(){function t(e,n){vb(this,t),this.mediainfoModule=e,this.options=n,this.mediainfoModuleInstance=new e.MediaInfo(n.format==="object"?"JSON":n.format,n.coverData,n.full)}return Eb(t,[{key:"analyzeData",value:function(n,r,i){var s=this;if(i===void 0)return new Promise(function(c,u){var f=function(y,m){return m?u(m):c(y)};s.analyzeData(n,r,f)});var o=0,a=function(u){var f=function m(){var g=function(R){p(R)?m():y()},w;try{var _,b=Math.min((_=s.options.chunkSize)!==null&&_!==void 0?_:hf.chunkSize,u-o);w=r(b,o)}catch(E){if(E instanceof Error)return i("",E);if(typeof E=="string")return i("",new Error(E))}w instanceof Promise?w.then(g).catch(function(E){return i("",E)}):w!==void 0&&g(w)},p=function(g){if(g.length===0||s.openBufferContinue(g,g.length))return!1;var w=s.openBufferContinueGotoGet();return w===-1?o+=g.length:(o=w,s.openBufferInit(u,w)),!0},y=function(){s.openBufferFinalize();var g=s.inform();s.options.format==="object"?i(s.parseResultJson(g)):i(g)};s.openBufferInit(u,o),f()},l=n();l instanceof Promise?l.then(a).catch(function(c){return i(null,c)}):a(l)}},{key:"close",value:function(){var n;this.mediainfoModuleInstance&&this.mediainfoModuleInstance.close(),this.mediainfoModule&&typeof((n=this.mediainfoModule)===null||n===void 0?void 0:n.destroy)=="function"&&this.mediainfoModule.destroy(this.mediainfoModuleInstance)}},{key:"inform",value:function(){return this.mediainfoModuleInstance.inform()}},{key:"openBufferContinue",value:function(n,r){return!!(this.mediainfoModuleInstance.open_buffer_continue(n,r)&8)}},{key:"openBufferContinueGotoGet",value:function(){var n=-1,r=this.mediainfoModuleInstance.open_buffer_continue_goto_get_lower(),i=this.mediainfoModuleInstance.open_buffer_continue_goto_get_upper();return r==-1&&i==-1?n=-1:r<0?n=r+4294967296+i*4294967296:n=r+i*4294967296,n}},{key:"openBufferFinalize",value:function(){this.mediainfoModuleInstance.open_buffer_finalize()}},{key:"openBufferInit",value:function(n,r){this.mediainfoModuleInstance.open_buffer_init(n,r)}},{key:"parseResultJson",value:function(n){var r=Lb,i=Pb,s=JSON.parse(n);if(s.media){var o=fi(fi({},s.media),{},{track:[]});if(s.media.track&&Array.isArray(s.media.track)){var a=Mb(s.media.track),l;try{for(a.s();!(l=a.n()).done;){for(var c=l.value,u={"@type":c["@type"]},f=0,p=Object.entries(c);f<p.length;f++){var y=kb(p[f],2),m=y[0],g=y[1];m!=="@type"&&(typeof g=="string"&&r.includes(m)?u=fi(fi({},u),{},Tu({},m,parseInt(g,10))):typeof g=="string"&&i.includes(m)?u=fi(fi({},u),{},Tu({},m,parseFloat(g))):u=fi(fi({},u),{},Tu({},m,g)))}o.track.push(u)}}catch(w){a.e(w)}finally{a.f()}}return fi(fi({},s),{},{media:o})}return s}}]),t}(),Bb=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return function(e={}){var n=e,r,i;n.ready=new Promise((q,Z)=>{r=q,i=Z});var s=Object.assign({},n),o="./this.program",a=!0,l="";function c(q){return n.locateFile?n.locateFile(q,l):l+q}typeof document<"u"&&document.currentScript&&(l=document.currentScript.src),t&&(l=t),l.indexOf("blob:")!==0?l=l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):l="",n.print||console.log.bind(console);var u=n.printErr||console.error.bind(console);Object.assign(n,s),s=null,n.arguments&&n.arguments,n.thisProgram&&(o=n.thisProgram),n.quit&&n.quit;var f;n.wasmBinary&&(f=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&C("no native wasm support detected");var p,y,m=!1,g,w,_,b,E,R,h,k;function L(){var q=p.buffer;n.HEAP8=g=new Int8Array(q),n.HEAP16=_=new Int16Array(q),n.HEAP32=E=new Int32Array(q),n.HEAPU8=w=new Uint8Array(q),n.HEAPU16=b=new Uint16Array(q),n.HEAPU32=R=new Uint32Array(q),n.HEAPF32=h=new Float32Array(q),n.HEAPF64=k=new Float64Array(q)}var $,P=[],I=[],H=[];function ae(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)D(n.preRun.shift());_e(P)}function V(){_e(I)}function v(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Y(n.postRun.shift());_e(H)}function D(q){P.unshift(q)}function F(q){I.unshift(q)}function Y(q){H.unshift(q)}var K=0,Q=null;function W(q){K++,n.monitorRunDependencies&&n.monitorRunDependencies(K)}function O(q){if(K--,n.monitorRunDependencies&&n.monitorRunDependencies(K),K==0&&Q){var Z=Q;Q=null,Z()}}function C(q){n.onAbort&&n.onAbort(q),q="Aborted("+q+")",u(q),m=!0,q+=". Build with -sASSERTIONS for more info.";var Z=new WebAssembly.RuntimeError(q);throw i(Z),Z}var S="data:application/octet-stream;base64,";function M(q){return q.startsWith(S)}var X;X="MediaInfoModule.wasm",M(X)||(X=c(X));function ie(q){if(q==X&&f)return new Uint8Array(f);throw"both async and sync fetching of the wasm failed"}function G(q){return!f&&a&&typeof fetch=="function"?fetch(q,{credentials:"same-origin"}).then(Z=>{if(!Z.ok)throw"failed to load wasm binary file at '"+q+"'";return Z.arrayBuffer()}).catch(()=>ie(q)):Promise.resolve().then(()=>ie(q))}function z(q,Z,ue){return G(q).then(De=>WebAssembly.instantiate(De,Z)).then(De=>De).then(ue,De=>{u("failed to asynchronously prepare wasm: "+De),C(De)})}function le(q,Z,ue,De){return!q&&typeof WebAssembly.instantiateStreaming=="function"&&!M(Z)&&typeof fetch=="function"?fetch(Z,{credentials:"same-origin"}).then(ze=>{var rt=WebAssembly.instantiateStreaming(ze,ue);return rt.then(De,function(st){return u("wasm streaming compile failed: "+st),u("falling back to ArrayBuffer instantiation"),z(Z,ue,De)})}):z(Z,ue,De)}function Me(){var q={a:c7};function Z(De,ze){var rt=De.exports;return y=rt,p=y.u,L(),$=y.x,F(y.v),O(),rt}W();function ue(De){Z(De.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(q,Z)}catch(De){u("Module.instantiateWasm callback failed with error: "+De),i(De)}return le(f,X,q,ue).catch(i),{}}var _e=q=>{for(;q.length>0;)q.shift()(n)};function Ae(q,Z,ue,De,ze){}function Ee(q){switch(q){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${q}`)}}function Ve(){for(var q=new Array(256),Z=0;Z<256;++Z)q[Z]=String.fromCharCode(Z);Te=q}var Te=void 0;function Le(q){for(var Z="",ue=q;w[ue];)Z+=Te[w[ue++]];return Z}var Ie={},et={},B={},x=void 0;function Ne(q){throw new x(q)}var We=void 0;function tt(q){throw new We(q)}function ke(q,Z,ue){q.forEach(function(ot){B[ot]=Z});function De(ot){var St=ue(ot);St.length!==q.length&&tt("Mismatched type converter count");for(var bt=0;bt<q.length;++bt)Xe(q[bt],St[bt])}var ze=new Array(Z.length),rt=[],st=0;Z.forEach((ot,St)=>{et.hasOwnProperty(ot)?ze[St]=et[ot]:(rt.push(ot),Ie.hasOwnProperty(ot)||(Ie[ot]=[]),Ie[ot].push(()=>{ze[St]=et[ot],++st,st===rt.length&&De(ze)}))}),rt.length===0&&De(ze)}function Pe(q,Z,ue={}){var De=Z.name;if(q||Ne(`type "${De}" must have a positive integer typeid pointer`),et.hasOwnProperty(q)){if(ue.ignoreDuplicateRegistrations)return;Ne(`Cannot register type '${De}' twice`)}if(et[q]=Z,delete B[q],Ie.hasOwnProperty(q)){var ze=Ie[q];delete Ie[q],ze.forEach(rt=>rt())}}function Xe(q,Z,ue={}){if(!("argPackAdvance"in Z))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Pe(q,Z,ue)}function qe(q,Z,ue,De,ze){var rt=Ee(ue);Z=Le(Z),Xe(q,{name:Z,fromWireType:function(st){return!!st},toWireType:function(st,ot){return ot?De:ze},argPackAdvance:8,readValueFromPointer:function(st){var ot;if(ue===1)ot=g;else if(ue===2)ot=_;else if(ue===4)ot=E;else throw new TypeError("Unknown boolean type size: "+Z);return this.fromWireType(ot[st>>rt])},destructorFunction:null})}function it(q){if(!(this instanceof Lt)||!(q instanceof Lt))return!1;for(var Z=this.$$.ptrType.registeredClass,ue=this.$$.ptr,De=q.$$.ptrType.registeredClass,ze=q.$$.ptr;Z.baseClass;)ue=Z.upcast(ue),Z=Z.baseClass;for(;De.baseClass;)ze=De.upcast(ze),De=De.baseClass;return Z===De&&ue===ze}function Je(q){return{count:q.count,deleteScheduled:q.deleteScheduled,preservePointerOnDelete:q.preservePointerOnDelete,ptr:q.ptr,ptrType:q.ptrType,smartPtr:q.smartPtr,smartPtrType:q.smartPtrType}}function U(q){function Z(ue){return ue.$$.ptrType.registeredClass.name}Ne(Z(q)+" instance already deleted")}var T=!1;function d(q){}function A(q){q.smartPtr?q.smartPtrType.rawDestructor(q.smartPtr):q.ptrType.registeredClass.rawDestructor(q.ptr)}function N(q){q.count.value-=1;var Z=q.count.value===0;Z&&A(q)}function j(q,Z,ue){if(Z===ue)return q;if(ue.baseClass===void 0)return null;var De=j(q,Z,ue.baseClass);return De===null?null:ue.downcast(De)}var ee={};function te(){return Object.keys(nt).length}function se(){var q=[];for(var Z in nt)nt.hasOwnProperty(Z)&&q.push(nt[Z]);return q}var be=[];function he(){for(;be.length;){var q=be.pop();q.$$.deleteScheduled=!1,q.delete()}}var Ce=void 0;function Re(q){Ce=q,be.length&&Ce&&Ce(he)}function Fe(){n.getInheritedInstanceCount=te,n.getLiveInheritedInstances=se,n.flushPendingDeletes=he,n.setDelayFunction=Re}var nt={};function pt(q,Z){for(Z===void 0&&Ne("ptr should not be undefined");q.baseClass;)Z=q.upcast(Z),q=q.baseClass;return Z}function je(q,Z){return Z=pt(q,Z),nt[Z]}function ft(q,Z){(!Z.ptrType||!Z.ptr)&&tt("makeClassHandle requires ptr and ptrType");var ue=!!Z.smartPtrType,De=!!Z.smartPtr;return ue!==De&&tt("Both smartPtrType and smartPtr must be specified"),Z.count={value:1},$e(Object.create(q,{$$:{value:Z}}))}function Oe(q){var Z=this.getPointee(q);if(!Z)return this.destructor(q),null;var ue=je(this.registeredClass,Z);if(ue!==void 0){if(ue.$$.count.value===0)return ue.$$.ptr=Z,ue.$$.smartPtr=q,ue.clone();var De=ue.clone();return this.destructor(q),De}function ze(){return this.isSmartPointer?ft(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:Z,smartPtrType:this,smartPtr:q}):ft(this.registeredClass.instancePrototype,{ptrType:this,ptr:q})}var rt=this.registeredClass.getActualType(Z),st=ee[rt];if(!st)return ze.call(this);var ot;this.isConst?ot=st.constPointerType:ot=st.pointerType;var St=j(Z,this.registeredClass,ot.registeredClass);return St===null?ze.call(this):this.isSmartPointer?ft(ot.registeredClass.instancePrototype,{ptrType:ot,ptr:St,smartPtrType:this,smartPtr:q}):ft(ot.registeredClass.instancePrototype,{ptrType:ot,ptr:St})}var $e=function(q){return typeof FinalizationRegistry>"u"?($e=Z=>Z,q):(T=new FinalizationRegistry(Z=>{N(Z.$$)}),$e=Z=>{var ue=Z.$$,De=!!ue.smartPtr;if(De){var ze={$$:ue};T.register(Z,ze,Z)}return Z},d=Z=>T.unregister(Z),$e(q))};function at(){if(this.$$.ptr||U(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var q=$e(Object.create(Object.getPrototypeOf(this),{$$:{value:Je(this.$$)}}));return q.$$.count.value+=1,q.$$.deleteScheduled=!1,q}function Ge(){this.$$.ptr||U(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ne("Object already scheduled for deletion"),d(this),N(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function mt(){return!this.$$.ptr}function Qe(){return this.$$.ptr||U(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ne("Object already scheduled for deletion"),be.push(this),be.length===1&&Ce&&Ce(he),this.$$.deleteScheduled=!0,this}function vt(){Lt.prototype.isAliasOf=it,Lt.prototype.clone=at,Lt.prototype.delete=Ge,Lt.prototype.isDeleted=mt,Lt.prototype.deleteLater=Qe}function Lt(){}var lt=48,Et=57;function dt(q){if(q===void 0)return"_unknown";q=q.replace(/[^a-zA-Z0-9_]/g,"$");var Z=q.charCodeAt(0);return Z>=lt&&Z<=Et?`_${q}`:q}function Gt(q,Z){return q=dt(q),{[q]:function(){return Z.apply(this,arguments)}}[q]}function Qt(q,Z,ue){if(q[Z].overloadTable===void 0){var De=q[Z];q[Z]=function(){return q[Z].overloadTable.hasOwnProperty(arguments.length)||Ne(`Function '${ue}' called with an invalid number of arguments (${arguments.length}) - expects one of (${q[Z].overloadTable})!`),q[Z].overloadTable[arguments.length].apply(this,arguments)},q[Z].overloadTable=[],q[Z].overloadTable[De.argCount]=De}}function Kt(q,Z,ue){n.hasOwnProperty(q)?((ue===void 0||n[q].overloadTable!==void 0&&n[q].overloadTable[ue]!==void 0)&&Ne(`Cannot register public name '${q}' twice`),Qt(n,q,q),n.hasOwnProperty(ue)&&Ne(`Cannot register multiple overloads of a function with the same number of arguments (${ue})!`),n[q].overloadTable[ue]=Z):(n[q]=Z,ue!==void 0&&(n[q].numArguments=ue))}function zt(q,Z,ue,De,ze,rt,st,ot){this.name=q,this.constructor=Z,this.instancePrototype=ue,this.rawDestructor=De,this.baseClass=ze,this.getActualType=rt,this.upcast=st,this.downcast=ot,this.pureVirtualFunctions=[]}function nn(q,Z,ue){for(;Z!==ue;)Z.upcast||Ne(`Expected null or instance of ${ue.name}, got an instance of ${Z.name}`),q=Z.upcast(q),Z=Z.baseClass;return q}function Ln(q,Z){if(Z===null)return this.isReference&&Ne(`null is not a valid ${this.name}`),0;Z.$$||Ne(`Cannot pass "${Dn(Z)}" as a ${this.name}`),Z.$$.ptr||Ne(`Cannot pass deleted object as a pointer of type ${this.name}`);var ue=Z.$$.ptrType.registeredClass,De=nn(Z.$$.ptr,ue,this.registeredClass);return De}function On(q,Z){var ue;if(Z===null)return this.isReference&&Ne(`null is not a valid ${this.name}`),this.isSmartPointer?(ue=this.rawConstructor(),q!==null&&q.push(this.rawDestructor,ue),ue):0;Z.$$||Ne(`Cannot pass "${Dn(Z)}" as a ${this.name}`),Z.$$.ptr||Ne(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&Z.$$.ptrType.isConst&&Ne(`Cannot convert argument of type ${Z.$$.smartPtrType?Z.$$.smartPtrType.name:Z.$$.ptrType.name} to parameter type ${this.name}`);var De=Z.$$.ptrType.registeredClass;if(ue=nn(Z.$$.ptr,De,this.registeredClass),this.isSmartPointer)switch(Z.$$.smartPtr===void 0&&Ne("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:Z.$$.smartPtrType===this?ue=Z.$$.smartPtr:Ne(`Cannot convert argument of type ${Z.$$.smartPtrType?Z.$$.smartPtrType.name:Z.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:ue=Z.$$.smartPtr;break;case 2:if(Z.$$.smartPtrType===this)ue=Z.$$.smartPtr;else{var ze=Z.clone();ue=this.rawShare(ue,At.toHandle(function(){ze.delete()})),q!==null&&q.push(this.rawDestructor,ue)}break;default:Ne("Unsupporting sharing policy")}return ue}function xn(q,Z){if(Z===null)return this.isReference&&Ne(`null is not a valid ${this.name}`),0;Z.$$||Ne(`Cannot pass "${Dn(Z)}" as a ${this.name}`),Z.$$.ptr||Ne(`Cannot pass deleted object as a pointer of type ${this.name}`),Z.$$.ptrType.isConst&&Ne(`Cannot convert argument of type ${Z.$$.ptrType.name} to parameter type ${this.name}`);var ue=Z.$$.ptrType.registeredClass,De=nn(Z.$$.ptr,ue,this.registeredClass);return De}function Ut(q){return this.fromWireType(E[q>>2])}function Nt(q){return this.rawGetPointee&&(q=this.rawGetPointee(q)),q}function en(q){this.rawDestructor&&this.rawDestructor(q)}function on(q){q!==null&&q.delete()}function Ye(){ct.prototype.getPointee=Nt,ct.prototype.destructor=en,ct.prototype.argPackAdvance=8,ct.prototype.readValueFromPointer=Ut,ct.prototype.deleteObject=on,ct.prototype.fromWireType=Oe}function ct(q,Z,ue,De,ze,rt,st,ot,St,bt,qt){this.name=q,this.registeredClass=Z,this.isReference=ue,this.isConst=De,this.isSmartPointer=ze,this.pointeeType=rt,this.sharingPolicy=st,this.rawGetPointee=ot,this.rawConstructor=St,this.rawShare=bt,this.rawDestructor=qt,!ze&&Z.baseClass===void 0?De?(this.toWireType=Ln,this.destructorFunction=null):(this.toWireType=xn,this.destructorFunction=null):this.toWireType=On}function br(q,Z,ue){n.hasOwnProperty(q)||tt("Replacing nonexistant public symbol"),n[q].overloadTable!==void 0&&ue!==void 0?n[q].overloadTable[ue]=Z:(n[q]=Z,n[q].argCount=ue)}var Un=(q,Z,ue)=>{var De=n["dynCall_"+q];return ue&&ue.length?De.apply(null,[Z].concat(ue)):De.call(null,Z)},tn=q=>$.get(q),Yn=(q,Z,ue)=>{if(q.includes("j"))return Un(q,Z,ue);var De=tn(Z).apply(null,ue);return De},wr=(q,Z)=>{var ue=[];return function(){return ue.length=0,Object.assign(ue,arguments),Yn(q,Z,ue)}};function Wn(q,Z){q=Le(q);function ue(){return q.includes("j")?wr(q,Z):tn(Z)}var De=ue();return typeof De!="function"&&Ne(`unknown function pointer with signature ${q}: ${Z}`),De}function Jn(q,Z){var ue=Gt(Z,function(De){this.name=Z,this.message=De;var ze=new Error(De).stack;ze!==void 0&&(this.stack=this.toString()+`
`+ze.replace(/^Error(:[^\n]*)?\n/,""))});return ue.prototype=Object.create(q.prototype),ue.prototype.constructor=ue,ue.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},ue}var fn=void 0;function Ar(q){var Z=r_(q),ue=Le(Z);return As(Z),ue}function yr(q,Z){var ue=[],De={};function ze(rt){if(!De[rt]&&!et[rt]){if(B[rt]){B[rt].forEach(ze);return}ue.push(rt),De[rt]=!0}}throw Z.forEach(ze),new fn(`${q}: `+ue.map(Ar).join([", "]))}function dn(q,Z,ue,De,ze,rt,st,ot,St,bt,qt,bn,Jt){qt=Le(qt),rt=Wn(ze,rt),ot&&(ot=Wn(st,ot)),bt&&(bt=Wn(St,bt)),Jt=Wn(bn,Jt);var Sn=dt(qt);Kt(Sn,function(){yr(`Cannot construct ${qt} due to unbound types`,[De])}),ke([q,Z,ue],De?[De]:[],function(Er){Er=Er[0];var Or,$r;De?(Or=Er.registeredClass,$r=Or.instancePrototype):$r=Lt.prototype;var ki=Gt(Sn,function(){if(Object.getPrototypeOf(this)!==gt)throw new x("Use 'new' to construct "+qt);if(Dt.constructor_body===void 0)throw new x(qt+" has no accessible constructor");var Pc=Dt.constructor_body[arguments.length];if(Pc===void 0)throw new x(`Tried to invoke ctor of ${qt} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Dt.constructor_body).toString()}) parameters instead!`);return Pc.apply(this,arguments)}),gt=Object.create($r,{constructor:{value:ki}});ki.prototype=gt;var Dt=new zt(qt,ki,gt,Jt,Or,rt,ot,bt);Dt.baseClass&&(Dt.baseClass.__derivedClasses===void 0&&(Dt.baseClass.__derivedClasses=[]),Dt.baseClass.__derivedClasses.push(Dt));var ai=new ct(qt,Dt,!0,!1,!1),Vr=new ct(qt+"*",Dt,!1,!1,!1),Co=new ct(qt+" const*",Dt,!1,!0,!1);return ee[q]={pointerType:Vr,constPointerType:Co},br(Sn,ki),[ai,Vr,Co]})}function fr(q,Z){for(var ue=[],De=0;De<q;De++)ue.push(R[Z+De*4>>2]);return ue}function ri(q){for(;q.length;){var Z=q.pop(),ue=q.pop();ue(Z)}}function bi(q,Z){if(!(q instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof q} which is not a function`);var ue=Gt(q.name||"unknownFunctionName",function(){});ue.prototype=q.prototype;var De=new ue,ze=q.apply(De,Z);return ze instanceof Object?ze:De}function jn(q,Z,ue,De,ze,rt){var st=Z.length;st<2&&Ne("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var ot=Z[1]!==null&&ue!==null,St=!1,bt=1;bt<Z.length;++bt)if(Z[bt]!==null&&Z[bt].destructorFunction===void 0){St=!0;break}for(var qt=Z[0].name!=="void",bn="",Jt="",bt=0;bt<st-2;++bt)bn+=(bt!==0?", ":"")+"arg"+bt,Jt+=(bt!==0?", ":"")+"arg"+bt+"Wired";var Sn=`
        return function ${dt(q)}(${bn}) {
        if (arguments.length !== ${st-2}) {
          throwBindingError('function ${q} called with ${arguments.length} arguments, expected ${st-2} args!');
        }`;St&&(Sn+=`var destructors = [];
`);var Er=St?"destructors":"null",Or=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],$r=[Ne,De,ze,ri,Z[0],Z[1]];ot&&(Sn+="var thisWired = classParam.toWireType("+Er+`, this);
`);for(var bt=0;bt<st-2;++bt)Sn+="var arg"+bt+"Wired = argType"+bt+".toWireType("+Er+", arg"+bt+"); // "+Z[bt+2].name+`
`,Or.push("argType"+bt),$r.push(Z[bt+2]);if(ot&&(Jt="thisWired"+(Jt.length>0?", ":"")+Jt),Sn+=(qt||rt?"var rv = ":"")+"invoker(fn"+(Jt.length>0?", ":"")+Jt+`);
`,St)Sn+=`runDestructors(destructors);
`;else for(var bt=ot?1:2;bt<Z.length;++bt){var ki=bt===1?"thisWired":"arg"+(bt-2)+"Wired";Z[bt].destructorFunction!==null&&(Sn+=ki+"_dtor("+ki+"); // "+Z[bt].name+`
`,Or.push(ki+"_dtor"),$r.push(Z[bt].destructorFunction))}return qt&&(Sn+=`var ret = retType.fromWireType(rv);
return ret;
`),Sn+=`}
`,Or.push(Sn),bi(Function,Or).apply(null,$r)}function Wr(q,Z,ue,De,ze,rt){var st=fr(Z,ue);ze=Wn(De,ze),ke([],[q],function(ot){ot=ot[0];var St=`constructor ${ot.name}`;if(ot.registeredClass.constructor_body===void 0&&(ot.registeredClass.constructor_body=[]),ot.registeredClass.constructor_body[Z-1]!==void 0)throw new x(`Cannot register multiple constructors with identical number of parameters (${Z-1}) for class '${ot.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return ot.registeredClass.constructor_body[Z-1]=()=>{yr(`Cannot construct ${ot.name} due to unbound types`,st)},ke([],st,function(bt){return bt.splice(1,0,null),ot.registeredClass.constructor_body[Z-1]=jn(St,bt,null,ze,rt),[]}),[]})}function He(q,Z,ue,De,ze,rt,st,ot,St){var bt=fr(ue,De);Z=Le(Z),rt=Wn(ze,rt),ke([],[q],function(qt){qt=qt[0];var bn=`${qt.name}.${Z}`;Z.startsWith("@@")&&(Z=Symbol[Z.substring(2)]),ot&&qt.registeredClass.pureVirtualFunctions.push(Z);function Jt(){yr(`Cannot call ${bn} due to unbound types`,bt)}var Sn=qt.registeredClass.instancePrototype,Er=Sn[Z];return Er===void 0||Er.overloadTable===void 0&&Er.className!==qt.name&&Er.argCount===ue-2?(Jt.argCount=ue-2,Jt.className=qt.name,Sn[Z]=Jt):(Qt(Sn,Z,bn),Sn[Z].overloadTable[ue-2]=Jt),ke([],bt,function(Or){var $r=jn(bn,Or,qt,rt,st,St);return Sn[Z].overloadTable===void 0?($r.argCount=ue-2,Sn[Z]=$r):Sn[Z].overloadTable[ue-2]=$r,[]}),[]})}function Bt(){Object.assign(Pt.prototype,{get(q){return this.allocated[q]},has(q){return this.allocated[q]!==void 0},allocate(q){var Z=this.freelist.pop()||this.allocated.length;return this.allocated[Z]=q,Z},free(q){this.allocated[q]=void 0,this.freelist.push(q)}})}function Pt(){this.allocated=[void 0],this.freelist=[]}var xt=new Pt;function rn(q){q>=xt.reserved&&--xt.get(q).refcount===0&&xt.free(q)}function xe(){for(var q=0,Z=xt.reserved;Z<xt.allocated.length;++Z)xt.allocated[Z]!==void 0&&++q;return q}function Rt(){xt.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),xt.reserved=xt.allocated.length,n.count_emval_handles=xe}var At={toValue:q=>(q||Ne("Cannot use deleted val. handle = "+q),xt.get(q).value),toHandle:q=>{switch(q){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return xt.allocate({refcount:1,value:q})}}};function sn(q,Z){Z=Le(Z),Xe(q,{name:Z,fromWireType:function(ue){var De=At.toValue(ue);return rn(ue),De},toWireType:function(ue,De){return At.toHandle(De)},argPackAdvance:8,readValueFromPointer:Ut,destructorFunction:null})}function Dn(q){if(q===null)return"null";var Z=typeof q;return Z==="object"||Z==="array"||Z==="function"?q.toString():""+q}function It(q,Z){switch(Z){case 2:return function(ue){return this.fromWireType(h[ue>>2])};case 3:return function(ue){return this.fromWireType(k[ue>>3])};default:throw new TypeError("Unknown float type: "+q)}}function Xt(q,Z,ue){var De=Ee(ue);Z=Le(Z),Xe(q,{name:Z,fromWireType:function(ze){return ze},toWireType:function(ze,rt){return rt},argPackAdvance:8,readValueFromPointer:It(Z,De),destructorFunction:null})}function Nn(q,Z,ue){switch(Z){case 0:return ue?function(ze){return g[ze]}:function(ze){return w[ze]};case 1:return ue?function(ze){return _[ze>>1]}:function(ze){return b[ze>>1]};case 2:return ue?function(ze){return E[ze>>2]}:function(ze){return R[ze>>2]};default:throw new TypeError("Unknown integer type: "+q)}}function Cr(q,Z,ue,De,ze){Z=Le(Z);var rt=Ee(ue),st=bn=>bn;if(De===0){var ot=32-8*ue;st=bn=>bn<<ot>>>ot}var St=Z.includes("unsigned"),bt=(bn,Jt)=>{},qt;St?qt=function(bn,Jt){return bt(Jt,this.name),Jt>>>0}:qt=function(bn,Jt){return bt(Jt,this.name),Jt},Xe(q,{name:Z,fromWireType:st,toWireType:qt,argPackAdvance:8,readValueFromPointer:Nn(Z,rt,De!==0),destructorFunction:null})}function Ws(q,Z,ue){var De=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ze=De[Z];function rt(st){st=st>>2;var ot=R,St=ot[st],bt=ot[st+1];return new ze(ot.buffer,bt,St)}ue=Le(ue),Xe(q,{name:ue,fromWireType:rt,argPackAdvance:8,readValueFromPointer:rt},{ignoreDuplicateRegistrations:!0})}var ii=(q,Z,ue,De)=>{if(!(De>0))return 0;for(var ze=ue,rt=ue+De-1,st=0;st<q.length;++st){var ot=q.charCodeAt(st);if(ot>=55296&&ot<=57343){var St=q.charCodeAt(++st);ot=65536+((ot&1023)<<10)|St&1023}if(ot<=127){if(ue>=rt)break;Z[ue++]=ot}else if(ot<=2047){if(ue+1>=rt)break;Z[ue++]=192|ot>>6,Z[ue++]=128|ot&63}else if(ot<=65535){if(ue+2>=rt)break;Z[ue++]=224|ot>>12,Z[ue++]=128|ot>>6&63,Z[ue++]=128|ot&63}else{if(ue+3>=rt)break;Z[ue++]=240|ot>>18,Z[ue++]=128|ot>>12&63,Z[ue++]=128|ot>>6&63,Z[ue++]=128|ot&63}}return Z[ue]=0,ue-ze},To=(q,Z,ue)=>ii(q,w,Z,ue),js=q=>{for(var Z=0,ue=0;ue<q.length;++ue){var De=q.charCodeAt(ue);De<=127?Z++:De<=2047?Z+=2:De>=55296&&De<=57343?(Z+=4,++ue):Z+=3}return Z},Ea=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Ol=(q,Z,ue)=>{for(var De=Z+ue,ze=Z;q[ze]&&!(ze>=De);)++ze;if(ze-Z>16&&q.buffer&&Ea)return Ea.decode(q.subarray(Z,ze));for(var rt="";Z<ze;){var st=q[Z++];if(!(st&128)){rt+=String.fromCharCode(st);continue}var ot=q[Z++]&63;if((st&224)==192){rt+=String.fromCharCode((st&31)<<6|ot);continue}var St=q[Z++]&63;if((st&240)==224?st=(st&15)<<12|ot<<6|St:st=(st&7)<<18|ot<<12|St<<6|q[Z++]&63,st<65536)rt+=String.fromCharCode(st);else{var bt=st-65536;rt+=String.fromCharCode(55296|bt>>10,56320|bt&1023)}}return rt},ko=(q,Z)=>q?Ol(w,q,Z):"";function Dl(q,Z){Z=Le(Z);var ue=Z==="std::string";Xe(q,{name:Z,fromWireType:function(De){var ze=R[De>>2],rt=De+4,st;if(ue)for(var ot=rt,St=0;St<=ze;++St){var bt=rt+St;if(St==ze||w[bt]==0){var qt=bt-ot,bn=ko(ot,qt);st===void 0?st=bn:(st+="\0",st+=bn),ot=bt+1}}else{for(var Jt=new Array(ze),St=0;St<ze;++St)Jt[St]=String.fromCharCode(w[rt+St]);st=Jt.join("")}return As(De),st},toWireType:function(De,ze){ze instanceof ArrayBuffer&&(ze=new Uint8Array(ze));var rt,st=typeof ze=="string";st||ze instanceof Uint8Array||ze instanceof Uint8ClampedArray||ze instanceof Int8Array||Ne("Cannot pass non-string to std::string"),ue&&st?rt=js(ze):rt=ze.length;var ot=Rc(4+rt+1),St=ot+4;if(R[ot>>2]=rt,ue&&st)To(ze,St,rt+1);else if(st)for(var bt=0;bt<rt;++bt){var qt=ze.charCodeAt(bt);qt>255&&(As(St),Ne("String has UTF-16 code units that do not fit in 8 bits")),w[St+bt]=qt}else for(var bt=0;bt<rt;++bt)w[St+bt]=ze[bt];return De!==null&&De.push(As,ot),ot},argPackAdvance:8,readValueFromPointer:Ut,destructorFunction:function(De){As(De)}})}var Sa=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Nl=(q,Z)=>{for(var ue=q,De=ue>>1,ze=De+Z/2;!(De>=ze)&&b[De];)++De;if(ue=De<<1,ue-q>32&&Sa)return Sa.decode(w.subarray(q,ue));for(var rt="",st=0;!(st>=Z/2);++st){var ot=_[q+st*2>>1];if(ot==0)break;rt+=String.fromCharCode(ot)}return rt},Fl=(q,Z,ue)=>{if(ue===void 0&&(ue=2147483647),ue<2)return 0;ue-=2;for(var De=Z,ze=ue<q.length*2?ue/2:q.length,rt=0;rt<ze;++rt){var st=q.charCodeAt(rt);_[Z>>1]=st,Z+=2}return _[Z>>1]=0,Z-De},Ue=q=>q.length*2,dr=(q,Z)=>{for(var ue=0,De="";!(ue>=Z/4);){var ze=E[q+ue*4>>2];if(ze==0)break;if(++ue,ze>=65536){var rt=ze-65536;De+=String.fromCharCode(55296|rt>>10,56320|rt&1023)}else De+=String.fromCharCode(ze)}return De},ir=(q,Z,ue)=>{if(ue===void 0&&(ue=2147483647),ue<4)return 0;for(var De=Z,ze=De+ue-4,rt=0;rt<q.length;++rt){var st=q.charCodeAt(rt);if(st>=55296&&st<=57343){var ot=q.charCodeAt(++rt);st=65536+((st&1023)<<10)|ot&1023}if(E[Z>>2]=st,Z+=4,Z+4>ze)break}return E[Z>>2]=0,Z-De},si=q=>{for(var Z=0,ue=0;ue<q.length;++ue){var De=q.charCodeAt(ue);De>=55296&&De<=57343&&++ue,Z+=4}return Z},hr=function(q,Z,ue){ue=Le(ue);var De,ze,rt,st,ot;Z===2?(De=Nl,ze=Fl,st=Ue,rt=()=>b,ot=1):Z===4&&(De=dr,ze=ir,st=si,rt=()=>R,ot=2),Xe(q,{name:ue,fromWireType:function(St){for(var bt=R[St>>2],qt=rt(),bn,Jt=St+4,Sn=0;Sn<=bt;++Sn){var Er=St+4+Sn*Z;if(Sn==bt||qt[Er>>ot]==0){var Or=Er-Jt,$r=De(Jt,Or);bn===void 0?bn=$r:(bn+="\0",bn+=$r),Jt=Er+Z}}return As(St),bn},toWireType:function(St,bt){typeof bt!="string"&&Ne(`Cannot pass non-string to C++ string type ${ue}`);var qt=st(bt),bn=Rc(4+qt+Z);return R[bn>>2]=qt>>ot,ze(bt,bn+4,qt+Z),St!==null&&St.push(As,bn),bn},argPackAdvance:8,readValueFromPointer:Ut,destructorFunction:function(St){As(St)}})};function jr(q,Z){Z=Le(Z),Xe(q,{isVoid:!0,name:Z,argPackAdvance:0,fromWireType:function(){},toWireType:function(ue,De){}})}function Qi(q,Z){return Z+2097152>>>0<4194305-!!q?(q>>>0)+Z*4294967296:NaN}function $l(q,Z,ue){var De=Qi(q,Z),ze=new Date(De*1e3);E[ue>>2]=ze.getUTCSeconds(),E[ue+4>>2]=ze.getUTCMinutes(),E[ue+8>>2]=ze.getUTCHours(),E[ue+12>>2]=ze.getUTCDate(),E[ue+16>>2]=ze.getUTCMonth(),E[ue+20>>2]=ze.getUTCFullYear()-1900,E[ue+24>>2]=ze.getUTCDay();var rt=Date.UTC(ze.getUTCFullYear(),0,1,0,0,0,0),st=(ze.getTime()-rt)/(1e3*60*60*24)|0;E[ue+28>>2]=st}var Ao=q=>{var Z=js(q)+1,ue=Rc(Z);return ue&&To(q,ue,Z),ue},ks=(q,Z,ue)=>{var De=new Date().getFullYear(),ze=new Date(De,0,1),rt=new Date(De,6,1),st=ze.getTimezoneOffset(),ot=rt.getTimezoneOffset(),St=Math.max(st,ot);R[q>>2]=St*60,E[Z>>2]=+(st!=ot);function bt(Er){var Or=Er.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Or?Or[1]:"GMT"}var qt=bt(ze),bn=bt(rt),Jt=Ao(qt),Sn=Ao(bn);ot<st?(R[ue>>2]=Jt,R[ue+4>>2]=Sn):(R[ue>>2]=Sn,R[ue+4>>2]=Jt)},Vl=()=>{C("")};function xl(){return Date.now()}var Se=()=>2147483648,Ot=q=>{var Z=p.buffer,ue=q-Z.byteLength+65535>>>16;try{return p.grow(ue),L(),1}catch{}},Cn=q=>{var Z=w.length;q>>>=0;var ue=Se();if(q>ue)return!1;for(var De=(St,bt)=>St+(bt-St%bt)%bt,ze=1;ze<=4;ze*=2){var rt=Z*(1+.2/ze);rt=Math.min(rt,q+100663296);var st=Math.min(ue,De(Math.max(q,rt),65536)),ot=Ot(st);if(ot)return!0}return!1},un={},Fn=()=>o||"./this.program",sr=()=>{if(!sr.strings){var q=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",Z={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:q,_:Fn()};for(var ue in un)un[ue]===void 0?delete Z[ue]:Z[ue]=un[ue];var De=[];for(var ue in Z)De.push(`${ue}=${Z[ue]}`);sr.strings=De}return sr.strings},oi=(q,Z)=>{for(var ue=0;ue<q.length;++ue)g[Z++>>0]=q.charCodeAt(ue);g[Z>>0]=0},vr=(q,Z)=>{var ue=0;return sr().forEach(function(De,ze){var rt=Z+ue;R[q+ze*4>>2]=rt,oi(De,rt),ue+=De.length+1}),0},Gs=(q,Z)=>{var ue=sr();R[q>>2]=ue.length;var De=0;return ue.forEach(function(ze){De+=ze.length+1}),R[Z>>2]=De,0},es=q=>q%4===0&&(q%100!==0||q%400===0),Mc=(q,Z)=>{for(var ue=0,De=0;De<=Z;ue+=q[De++]);return ue},t_=[31,29,31,30,31,30,31,31,30,31,30,31],n_=[31,28,31,30,31,30,31,31,30,31,30,31],s7=(q,Z)=>{for(var ue=new Date(q.getTime());Z>0;){var De=es(ue.getFullYear()),ze=ue.getMonth(),rt=(De?t_:n_)[ze];if(Z>rt-ue.getDate())Z-=rt-ue.getDate()+1,ue.setDate(1),ze<11?ue.setMonth(ze+1):(ue.setMonth(0),ue.setFullYear(ue.getFullYear()+1));else return ue.setDate(ue.getDate()+Z),ue}return ue};function o7(q,Z,ue){var De=ue>0?ue:js(q)+1,ze=new Array(De),rt=ii(q,ze,0,ze.length);return Z&&(ze.length=rt),ze}var a7=(q,Z)=>{g.set(q,Z)},l7=(q,Z,ue,De)=>{var ze=E[De+40>>2],rt={tm_sec:E[De>>2],tm_min:E[De+4>>2],tm_hour:E[De+8>>2],tm_mday:E[De+12>>2],tm_mon:E[De+16>>2],tm_year:E[De+20>>2],tm_wday:E[De+24>>2],tm_yday:E[De+28>>2],tm_isdst:E[De+32>>2],tm_gmtoff:E[De+36>>2],tm_zone:ze?ko(ze):""},st=ko(ue),ot={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var St in ot)st=st.replace(new RegExp(St,"g"),ot[St]);var bt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],qt=["January","February","March","April","May","June","July","August","September","October","November","December"];function bn(gt,Dt,ai){for(var Vr=typeof gt=="number"?gt.toString():gt||"";Vr.length<Dt;)Vr=ai[0]+Vr;return Vr}function Jt(gt,Dt){return bn(gt,Dt,"0")}function Sn(gt,Dt){function ai(Co){return Co<0?-1:Co>0?1:0}var Vr;return(Vr=ai(gt.getFullYear()-Dt.getFullYear()))===0&&(Vr=ai(gt.getMonth()-Dt.getMonth()))===0&&(Vr=ai(gt.getDate()-Dt.getDate())),Vr}function Er(gt){switch(gt.getDay()){case 0:return new Date(gt.getFullYear()-1,11,29);case 1:return gt;case 2:return new Date(gt.getFullYear(),0,3);case 3:return new Date(gt.getFullYear(),0,2);case 4:return new Date(gt.getFullYear(),0,1);case 5:return new Date(gt.getFullYear()-1,11,31);case 6:return new Date(gt.getFullYear()-1,11,30)}}function Or(gt){var Dt=s7(new Date(gt.tm_year+1900,0,1),gt.tm_yday),ai=new Date(Dt.getFullYear(),0,4),Vr=new Date(Dt.getFullYear()+1,0,4),Co=Er(ai),Pc=Er(Vr);return Sn(Co,Dt)<=0?Sn(Pc,Dt)<=0?Dt.getFullYear()+1:Dt.getFullYear():Dt.getFullYear()-1}var $r={"%a":gt=>bt[gt.tm_wday].substring(0,3),"%A":gt=>bt[gt.tm_wday],"%b":gt=>qt[gt.tm_mon].substring(0,3),"%B":gt=>qt[gt.tm_mon],"%C":gt=>{var Dt=gt.tm_year+1900;return Jt(Dt/100|0,2)},"%d":gt=>Jt(gt.tm_mday,2),"%e":gt=>bn(gt.tm_mday,2," "),"%g":gt=>Or(gt).toString().substring(2),"%G":gt=>Or(gt),"%H":gt=>Jt(gt.tm_hour,2),"%I":gt=>{var Dt=gt.tm_hour;return Dt==0?Dt=12:Dt>12&&(Dt-=12),Jt(Dt,2)},"%j":gt=>Jt(gt.tm_mday+Mc(es(gt.tm_year+1900)?t_:n_,gt.tm_mon-1),3),"%m":gt=>Jt(gt.tm_mon+1,2),"%M":gt=>Jt(gt.tm_min,2),"%n":()=>`
`,"%p":gt=>gt.tm_hour>=0&&gt.tm_hour<12?"AM":"PM","%S":gt=>Jt(gt.tm_sec,2),"%t":()=>"	","%u":gt=>gt.tm_wday||7,"%U":gt=>{var Dt=gt.tm_yday+7-gt.tm_wday;return Jt(Math.floor(Dt/7),2)},"%V":gt=>{var Dt=Math.floor((gt.tm_yday+7-(gt.tm_wday+6)%7)/7);if((gt.tm_wday+371-gt.tm_yday-2)%7<=2&&Dt++,Dt){if(Dt==53){var Vr=(gt.tm_wday+371-gt.tm_yday)%7;Vr!=4&&(Vr!=3||!es(gt.tm_year))&&(Dt=1)}}else{Dt=52;var ai=(gt.tm_wday+7-gt.tm_yday-1)%7;(ai==4||ai==5&&es(gt.tm_year%400-1))&&Dt++}return Jt(Dt,2)},"%w":gt=>gt.tm_wday,"%W":gt=>{var Dt=gt.tm_yday+7-(gt.tm_wday+6)%7;return Jt(Math.floor(Dt/7),2)},"%y":gt=>(gt.tm_year+1900).toString().substring(2),"%Y":gt=>gt.tm_year+1900,"%z":gt=>{var Dt=gt.tm_gmtoff,ai=Dt>=0;return Dt=Math.abs(Dt)/60,Dt=Dt/60*100+Dt%60,(ai?"+":"-")+("0000"+Dt).slice(-4)},"%Z":gt=>gt.tm_zone,"%%":()=>"%"};st=st.replace(/%%/g,"\0\0");for(var St in $r)st.includes(St)&&(st=st.replace(new RegExp(St,"g"),$r[St](rt)));st=st.replace(/\0\0/g,"%");var ki=o7(st,!1);return ki.length>Z?0:(a7(ki,q),ki.length-1)},u7=(q,Z,ue,De,ze)=>l7(q,Z,ue,De);Ve(),x=n.BindingError=class extends Error{constructor(Z){super(Z),this.name="BindingError"}},We=n.InternalError=class extends Error{constructor(Z){super(Z),this.name="InternalError"}},vt(),Fe(),Ye(),fn=n.UnboundTypeError=Jn(Error,"UnboundTypeError"),Bt(),Rt();var c7={k:Ae,h:qe,t:dn,s:Wr,d:He,r:sn,g:Xt,c:Cr,b:Ws,f:Dl,e:hr,i:jr,j:$l,p:ks,a:Vl,q:xl,o:Cn,m:vr,n:Gs,l:u7};Me();var Rc=q=>(Rc=y.w)(q),As=q=>(As=y.y)(q),r_=q=>(r_=y.z)(q);n.__embind_initialize_bindings=()=>(n.__embind_initialize_bindings=y.A)(),n.dynCall_iiijj=(q,Z,ue,De,ze,rt,st)=>(n.dynCall_iiijj=y.B)(q,Z,ue,De,ze,rt,st),n.dynCall_viijii=(q,Z,ue,De,ze,rt,st)=>(n.dynCall_viijii=y.C)(q,Z,ue,De,ze,rt,st),n.dynCall_iiiiij=(q,Z,ue,De,ze,rt,st)=>(n.dynCall_iiiiij=y.D)(q,Z,ue,De,ze,rt,st),n.dynCall_iiiiijj=(q,Z,ue,De,ze,rt,st,ot,St)=>(n.dynCall_iiiiijj=y.E)(q,Z,ue,De,ze,rt,st,ot,St),n.dynCall_iiiiiijj=(q,Z,ue,De,ze,rt,st,ot,St,bt)=>(n.dynCall_iiiiiijj=y.F)(q,Z,ue,De,ze,rt,st,ot,St,bt);var Lc;Q=function q(){Lc||i_(),Lc||(Q=q)};function i_(){if(K>0||(ae(),K>0))return;function q(){Lc||(Lc=!0,n.calledRun=!0,!m&&(V(),r(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),v()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),q()},1)):q()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return i_(),e.ready}})(),Ob=["locateFile"],_h=function(){};function Db(t,e){try{var n=new URL(e);if(n.pathname==="/")return"".concat(e,"mediainfo.js/dist/").concat(t)}catch{}return"".concat(e,"../").concat(t)}function gh(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(n===void 0)return new Promise(function(l,c){return gh(e,l,c)});var i=fi(fi(fi({},hf),e),{},{format:(t=e.format)!==null&&t!==void 0?t:hf.format}),s=i.locateFile,o=Tb(i,Ob),a={print:_h,printErr:_h,locateFile:s||Db,onAbort:function(c){r&&r(c)}};Bb(a).then(function(l){return n(new Ib(l,o))}).catch(function(l){r&&r(l)})}const bh=new Map([["/9j/","image/jpg"],["iVBORw0KGgo","image/png"],["UklGR","image/webp"],["R0lGODdh","image/gif"],["R0lGODlh","image/gif"]]);let al;function Nb(t){if(!t)return;const n=[...bh.keys()].find(r=>t.startsWith(r))||"";return bh.get(n)}function pf(t,e,n){return new Promise((r,i)=>{if(al&&!e)return r();gh({coverData:t,format:"object",locateFile:()=>n||window.GM_getResourceURL("mediaInfo")},s=>{if(al)try{al.close()}catch{}al=s,r()},({message:s})=>i(new Error(`Failed to create MediaInfo instance - ${s}`)))})}async function Fb(t,e,n=""){return await pf(e,!1,n),new Promise((r,i)=>{const s=()=>t.size,o=(a,l)=>new Promise((c,u)=>{const f=new FileReader;f.addEventListener("loadend",p=>{if(p.target){if(p.target.error)return u(new Error(`Error reading file - ${p.target.error.message}`))}else return u(new Error("No FileReader data"));c(new Uint8Array(p.target.result))}),f.addEventListener("error",()=>{u(new Error("Error reading file"))}),f.readAsArrayBuffer(t.slice(l,l+a))});al.analyzeData(s,o).then(a=>r(a)).catch(({message:a})=>i(new Error(`Failed to get audio metadata - ${a}`)))})}function $b(t){if(!t)return"";const e=Nb(t);return e?URL.createObjectURL(new Blob([Vc.from(t,"base64")],{type:e})):""}class Vb{constructor(){Qn(this,"seperator",",")}timestampToSeconds(e){const[n,r]=e.split(","),i=parseInt(r),[s,o,a]=n.split(":").map(c=>parseInt(c)),l=i*.001+a+60*o+3600*s;return Math.round(l*1e3)/1e3}correctFormat(e){let n=e.replace(".",",");var r=null,i=null,s=null,o=null,[a,l]=n.split(",");o=this.fixed_str_digit(3,l);var[c,u,f]=a.split(":");return r=this.fixed_str_digit(2,c,!1),i=this.fixed_str_digit(2,u,!1),s=this.fixed_str_digit(2,f,!1),`${r}:${i}:${s},${o}`}fixed_str_digit(e,n,r=!0){if(n.length==e)return n;if(n.length>e)return n.slice(0,e);if(n.length<e)return r?n.padEnd(e,"0"):n.padStart(e,"0")}tryComma(e){e=e.replace(/\r/g,"");var n=/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g;let r=e.split(n);return r.shift(),r}tryDot(e){e=e.replace(/\r/g,"");var n=/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g;let r=e.split(n);return r.shift(),this.seperator=".",r}fromSrt(e){var n=e,r=this.tryComma(n);r.length==0&&(r=this.tryDot(n));for(var i=[],s=0;s<r.length;s+=4){const a=this.correctFormat(r[s+1].trim()),l=this.correctFormat(r[s+2].trim());var o={id:r[s].trim(),startTime:a,startSeconds:this.timestampToSeconds(a),endTime:l,endSeconds:this.timestampToSeconds(l),text:r[s+3].trim()};i.push(o)}return i}toSrt(e){var n="";const r=`\r
`;for(var i=0;i<e.length;i++){var s=e[i];n+=s.id+r,n+=s.startTime+" --> "+s.endTime+r,n+=s.text.replace(`
`,r)+r+r}return n}}async function wh(t,e={mode:"read"}){if(await t.queryPermission(e)==="granted"||await t.requestPermission(e)==="granted")return!0;throw new Error("File access not granted")}function xb(t){return new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",i=>{if(i.target){if(i.target.error)return n(new Error(`Error reading file - ${i.target.error.message}`))}else return n(new Error("No FileReader data"));e(i.target.result)}),r.addEventListener("error",()=>{n(new Error("Error reading file"))}),r.readAsText(t)})}function Hb(t,e){const n=e.createElement("audio"),r=e.createElement("track");return r.default=!0,n.append(r),new Promise((i,s)=>{r.addEventListener("load",()=>i([...n.textTracks[0].cues||[]])),r.addEventListener("error",()=>s(new Error("Failed to load vtt track"))),r.src=t})}async function yh(t,e={mode:"read"}){const n=[];for(let i=0,{length:s}=t;i<s;i+=1){const o=t[i];o&&n.push(wh(o,e))}if((await Promise.all(n)).some(i=>!i))throw new Error("File access not granted");return!0}async function ku(t,e,n=!1){const r=new Map;let i="";try{kn.set(!0);const s=Mt(_t.subtitlesGlobalStartPadding$)/1e3,o=Mt(_t.subtitlesGlobalEndPadding$)/1e3,a=Mt(as);if(t.name.endsWith(".srt")||t.name.endsWith(".txt")){const l=new Vb,c=await xb(t),u=[...l.fromSrt(c)];for(let f=0,{length:p}=u;f<p;f+=1){const y=u[f],m=Math.max(0,y.startSeconds+s),g=a?Ui(0,a,y.endSeconds+o):Math.max(0,y.endSeconds+o),w=y.text.trim();r.set(y.id,{id:y.id,originalStartSeconds:y.startSeconds,startSeconds:m,startTime:qr(m),originalEndSeconds:y.endSeconds,endSeconds:g,endTime:qr(g),originalText:w,text:w,subIndex:f})}}else if(t.name.endsWith(".vtt")){i=URL.createObjectURL(t);const l=await Hb(i,e);for(let c=0,{length:u}=l;c<u;c+=1){const f=l[c],p=`${c+1}`,y=Math.max(0,f.startTime+s),m=a?Ui(0,a,f.endTime+o):Math.max(0,f.endTime+o),g=f.text.trim();r.set(p,{id:p,originalStartSeconds:f.startTime,startSeconds:y,startTime:qr(y),originalEndSeconds:f.endTime,endSeconds:m,endTime:qr(m),originalText:g,text:g,subIndex:c})}}else throw new Error("File needs to be .srt,.txt or .vtt");return n&&us(t,r),r}finally{URL.revokeObjectURL(i)}}function us(t=void 0,e=new Map){su.set(new Set),ou.set(new Set),ns.set(t),Pr.set(e),Xa.set({subtitles:[...e.values()],replaceTrack:!0})}async function Jo(t,e,n=!1,r=!1,i="",s=""){const o=Mt(_t.playerEnableCover$),a=Mt(_t.playerEnableChapters$),l=t.name.split(".").pop(),c=[];let u="",f=!1,p="",y=[],m;if(r||(kn.set(!0),Mt(_t.exportAudioProcessor$)===Tr.FFMPEG&&await bd().catch(({message:g})=>c.push(`FFMEPG failure: ${g}`))),o||a)try{if(m=await(e?Wc(e,{action:"getAudioMetadata",url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm"),file:t,enableCover:o}):Fb(t,o)),!(m!=null&&m.media))throw new Error("No media metadata found");const g=m.media.track.find(w=>w["@type"]==="General");if(!g)throw new Error("No general track found");if(f=l==="mp3"&&(g.OverallBitRate_Mode==="VBR"||g.OverallBitRate_Mode_String==="VBR"),a)for(let w=0,{length:_}=m.media.track;w<_;w+=1){const b=m.media.track[w],E=Object.keys(b.extra||{});if(!(b["@type"]!=="Menu"||!E.length||!E[0].match(/_(\d{2}_\d{2}_\d{2}_\d{3})/)))for(let R=0,{length:h}=E;R<h;R+=1){const k=E[R],L=k.split("_"),$=b.extra[k],P=Number.parseInt(L[1],10)*3600+Number.parseInt(L[2],10)*60+Number.parseInt(L[3],10)+Number.parseInt(L[4],10)/1e3;y.push({key:`${$}_${P}`,label:$,startSeconds:P,startText:eo(P)})}}o&&(u=$b(g.Cover_Data))}catch({message:g}){c.push(`MediaInfo failure: ${g}`)}if(!r&&!f)try{p=URL.createObjectURL(t),n&&await Is(i,s,t,{coverUrl:u,chapters:y,audioSourceUrl:p})}catch({message:g}){URL.revokeObjectURL(u),URL.revokeObjectURL(p),c.push(g)}if(f&&c.push("MP3 files with variable bitrates are not supported"),c.length)throw new Error(c.join("; "));return{coverUrl:u,audioSourceUrl:p,chapters:y}}async function Is(t,e,n=void 0,r={coverUrl:"",chapters:[],audioSourceUrl:""}){await wd(n);const i=await(n&&!r.chapters.length?Kc(n):Promise.resolve(r.chapters));Ls.set(!1),Oa.set(n),qs.set(r.coverUrl),Da.set(r.audioSourceUrl),Zs.set(i),n||os.set({previous:"",current:"",useTimeFallback:!1}),URL.revokeObjectURL(t),URL.revokeObjectURL(e)}async function vh(t,e,n,r){const[i]=await t.showOpenFilePicker({excludeAcceptAllOption:!0,id:"ttu-whispersync-file",types:[{description:e,accept:{"*/*":n}}]});if(!await wh(i))throw new Error("File access not granted");const o=await(r?r.isSameEntry(i):Promise.resolve(!1));let a;return o||(a=await i.getFile()),{handle:i,file:a}}function Ub(t){let e;return{c(){e=Ft(t[0])},m(n,r){de(n,e,r)},p(n,r){r&1&&ln(e,n[0])},d(n){n&&ce(e)}}}function Eh(t){let e,n,r,i,s,o;return{c(){e=ge("div"),n=ge("label"),n.textContent="Enable filesystem api",r=me(),i=ge("input"),re(n,"for","fs-state"),re(i,"id","fs-state"),re(i,"type","checkbox"),re(e,"class","mt-4")},m(a,l){de(a,e,l),oe(e,n),oe(e,r),oe(e,i),i.checked=t[5],s||(o=Ke(i,"change",t[11]),s=!0)},p(a,l){l&32&&(i.checked=a[5])},d(a){a&&ce(e),s=!1,o()}}}function Wb(t){let e,n,r,i,s=t[4]&&Eh(t);return{c(){e=ge("p"),n=Ft(t[1]),r=me(),s&&s.c(),i=Dr(),re(e,"style",t[2])},m(o,a){de(o,e,a),oe(e,n),de(o,r,a),s&&s.m(o,a),de(o,i,a)},p(o,a){a&2&&ln(n,o[1]),a&4&&re(e,"style",o[2]),o[4]?s?s.p(o,a):(s=Eh(o),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},d(o){o&&(ce(e),ce(r),ce(i)),s&&s.d(o)}}}function jb(t){let e,n,r,i,s,o;return{c(){e=ge("div"),n=ge("button"),n.textContent="Cancel",r=me(),i=ge("button"),i.textContent="Confirm",ht(n,"invisible",!t[3]),re(e,"class","flex grow justify-between"),re(e,"slot","footer")},m(a,l){de(a,e,l),oe(e,n),oe(e,r),oe(e,i),s||(o=[Ke(n,"click",t[9]),Ke(i,"click",t[10])],s=!0)},p(a,l){l&8&&ht(n,"invisible",!a[3])},d(a){a&&ce(e),s=!1,vn(o)}}}function Gb(t){let e,n;return e=new _u({props:{$$slots:{footer:[jb],content:[Wb],header:[Ub]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,[i]){const s={};i&8255&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function zb(t,e,n){let r,{dialogHeader:i}=e,{dialogMessage:s}=e,{contentStyles:o}=e,{showCancel:a=!0}=e,{isFileReopen:l=!1}=e,{resolver:c}=e;const{readerEnableFilesystemApi$:u}=_t;fe(t,u,w=>n(5,r=w));const f=Mi();function p(w=!1){c(w),f("close")}const y=()=>p(!0),m=()=>p();function g(){r=this.checked,u.set(r)}return t.$$set=w=>{"dialogHeader"in w&&n(0,i=w.dialogHeader),"dialogMessage"in w&&n(1,s=w.dialogMessage),"contentStyles"in w&&n(2,o=w.contentStyles),"showCancel"in w&&n(3,a=w.showCancel),"isFileReopen"in w&&n(4,l=w.isFileReopen),"resolver"in w&&n(8,c=w.resolver)},[i,s,o,a,l,r,u,p,c,y,m,g]}class Sh extends In{constructor(e){super(),Pn(this,e,zb,Gb,Tn,{dialogHeader:0,dialogMessage:1,contentStyles:2,showCancel:3,isFileReopen:4,resolver:8})}}function Xb(t){return new Int8Array(t)}function Th(t){return new Int16Array(t)}function kh(t){return new Int32Array(t)}function Ah(t){return new Float32Array(t)}function Yb(t){return new Float64Array(t)}function Ch(t){if(t.length==1)return Ah(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Ch(t));return n}function Mh(t){if(t.length==1)return kh(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Mh(t));return n}function Rh(t){if(t.length==1)return Th(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Rh(t));return n}function Lh(t){if(t.length==1)return new Array(t[0]);var e=t[0];t=t.slice(1);for(var n=[],r=0;r<e;r++)n.push(Lh(t));return n}var Ph={};Ph.fill=function(t,e,n,r){if(arguments.length==2)for(var i=0;i<t.length;i++)t[i]=arguments[1];else for(var i=e;i<n;i++)t[i]=r};var ll={};ll.arraycopy=function(t,e,n,r,i){for(var s=e+i;e<s;)n[r++]=t[e++]},ll.out={},ll.out.println=function(t){console.log(t)},ll.out.printf=function(){console.log.apply(console,arguments)};var Au={};Au.SQRT2=1.4142135623730951,Au.FAST_LOG10=function(t){return Math.log10(t)},Au.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function cs(t){this.ordinal=t}cs.short_block_allowed=new cs(0),cs.short_block_coupled=new cs(1),cs.short_block_dispensed=new cs(2),cs.short_block_forced=new cs(3);var Ih={};Ih.MAX_VALUE=34028235e31;function di(t){this.ordinal=t}di.vbr_off=new di(0),di.vbr_mt=new di(1),di.vbr_rh=new di(2),di.vbr_abr=new di(3),di.vbr_mtrh=new di(4),di.vbr_default=di.vbr_mtrh;var Kb=function(t){},zn={System:ll,VbrMode:di,Float:Ih,ShortBlock:cs,Util:Au,Arrays:Ph,new_array_n:Lh,new_byte:Xb,new_double:Yb,new_float:Ah,new_float_n:Ch,new_int:kh,new_int_n:Mh,new_short:Th,new_short_n:Rh,assert:Kb},mf,Bh;function qb(){if(Bh)return mf;Bh=1;var t=zn,e=t.System,n=t.Util,r=t.Arrays,i=t.new_float,s=xr();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],l=12,c=36,u=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],f=u[s.SHORT_TYPE],p=u[s.SHORT_TYPE],y=u[s.SHORT_TYPE],m=u[s.SHORT_TYPE],g=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function w(E,R,h){for(var k=10,L=R+238-14-286,$=-15;$<0;$++){var P,I,H;P=a[k+-10],I=E[L+-224]*P,H=E[R+224]*P,P=a[k+-9],I+=E[L+-160]*P,H+=E[R+160]*P,P=a[k+-8],I+=E[L+-96]*P,H+=E[R+96]*P,P=a[k+-7],I+=E[L+-32]*P,H+=E[R+32]*P,P=a[k+-6],I+=E[L+32]*P,H+=E[R+-32]*P,P=a[k+-5],I+=E[L+96]*P,H+=E[R+-96]*P,P=a[k+-4],I+=E[L+160]*P,H+=E[R+-160]*P,P=a[k+-3],I+=E[L+224]*P,H+=E[R+-224]*P,P=a[k+-2],I+=E[R+-256]*P,H-=E[L+256]*P,P=a[k+-1],I+=E[R+-192]*P,H-=E[L+192]*P,P=a[k+0],I+=E[R+-128]*P,H-=E[L+128]*P,P=a[k+1],I+=E[R+-64]*P,H-=E[L+64]*P,P=a[k+2],I+=E[R+0]*P,H-=E[L+0]*P,P=a[k+3],I+=E[R+64]*P,H-=E[L+-64]*P,P=a[k+4],I+=E[R+128]*P,H-=E[L+-128]*P,P=a[k+5],I+=E[R+192]*P,H-=E[L+-192]*P,I*=a[k+6],P=H-I,h[30+$*2]=H+I,h[31+$*2]=a[k+7]*P,k+=18,R--,L++}{var I,H,ae,V;H=E[R+-16]*a[k+-10],I=E[R+-32]*a[k+-2],H+=(E[R+-48]-E[R+16])*a[k+-9],I+=E[R+-96]*a[k+-1],H+=(E[R+-80]+E[R+48])*a[k+-8],I+=E[R+-160]*a[k+0],H+=(E[R+-112]-E[R+80])*a[k+-7],I+=E[R+-224]*a[k+1],H+=(E[R+-144]+E[R+112])*a[k+-6],I-=E[R+32]*a[k+2],H+=(E[R+-176]-E[R+144])*a[k+-5],I-=E[R+96]*a[k+3],H+=(E[R+-208]+E[R+176])*a[k+-4],I-=E[R+160]*a[k+4],H+=(E[R+-240]-E[R+208])*a[k+-3],I-=E[R+224],ae=I-H,V=I+H,H=h[14],I=h[15]-H,h[31]=V+H,h[30]=ae+I,h[15]=ae-I,h[14]=V-H}{var v;v=h[28]-h[0],h[0]+=h[28],h[28]=v*a[k+-2*18+7],v=h[29]-h[1],h[1]+=h[29],h[29]=v*a[k+-2*18+7],v=h[26]-h[2],h[2]+=h[26],h[26]=v*a[k+-4*18+7],v=h[27]-h[3],h[3]+=h[27],h[27]=v*a[k+-4*18+7],v=h[24]-h[4],h[4]+=h[24],h[24]=v*a[k+-6*18+7],v=h[25]-h[5],h[5]+=h[25],h[25]=v*a[k+-6*18+7],v=h[22]-h[6],h[6]+=h[22],h[22]=v*n.SQRT2,v=h[23]-h[7],h[7]+=h[23],h[23]=v*n.SQRT2-h[7],h[7]-=h[6],h[22]-=h[7],h[23]-=h[22],v=h[6],h[6]=h[31]-v,h[31]=h[31]+v,v=h[7],h[7]=h[30]-v,h[30]=h[30]+v,v=h[22],h[22]=h[15]-v,h[15]=h[15]+v,v=h[23],h[23]=h[14]-v,h[14]=h[14]+v,v=h[20]-h[8],h[8]+=h[20],h[20]=v*a[k+-10*18+7],v=h[21]-h[9],h[9]+=h[21],h[21]=v*a[k+-10*18+7],v=h[18]-h[10],h[10]+=h[18],h[18]=v*a[k+-12*18+7],v=h[19]-h[11],h[11]+=h[19],h[19]=v*a[k+-12*18+7],v=h[16]-h[12],h[12]+=h[16],h[16]=v*a[k+-14*18+7],v=h[17]-h[13],h[13]+=h[17],h[17]=v*a[k+-14*18+7],v=-h[20]+h[24],h[20]+=h[24],h[24]=v*a[k+-12*18+7],v=-h[21]+h[25],h[21]+=h[25],h[25]=v*a[k+-12*18+7],v=h[4]-h[8],h[4]+=h[8],h[8]=v*a[k+-12*18+7],v=h[5]-h[9],h[5]+=h[9],h[9]=v*a[k+-12*18+7],v=h[0]-h[12],h[0]+=h[12],h[12]=v*a[k+-4*18+7],v=h[1]-h[13],h[1]+=h[13],h[13]=v*a[k+-4*18+7],v=h[16]-h[28],h[16]+=h[28],h[28]=v*a[k+-4*18+7],v=-h[17]+h[29],h[17]+=h[29],h[29]=v*a[k+-4*18+7],v=n.SQRT2*(h[2]-h[10]),h[2]+=h[10],h[10]=v,v=n.SQRT2*(h[3]-h[11]),h[3]+=h[11],h[11]=v,v=n.SQRT2*(-h[18]+h[26]),h[18]+=h[26],h[26]=v-h[18],v=n.SQRT2*(-h[19]+h[27]),h[19]+=h[27],h[27]=v-h[19],v=h[2],h[19]-=h[3],h[3]-=v,h[2]=h[31]-v,h[31]+=v,v=h[3],h[11]-=h[19],h[18]-=v,h[3]=h[30]-v,h[30]+=v,v=h[18],h[27]-=h[11],h[19]-=v,h[18]=h[15]-v,h[15]+=v,v=h[19],h[10]-=v,h[19]=h[14]-v,h[14]+=v,v=h[10],h[11]-=v,h[10]=h[23]-v,h[23]+=v,v=h[11],h[26]-=v,h[11]=h[22]-v,h[22]+=v,v=h[26],h[27]-=v,h[26]=h[7]-v,h[7]+=v,v=h[27],h[27]=h[6]-v,h[6]+=v,v=n.SQRT2*(h[0]-h[4]),h[0]+=h[4],h[4]=v,v=n.SQRT2*(h[1]-h[5]),h[1]+=h[5],h[5]=v,v=n.SQRT2*(h[16]-h[20]),h[16]+=h[20],h[20]=v,v=n.SQRT2*(h[17]-h[21]),h[17]+=h[21],h[21]=v,v=-n.SQRT2*(h[8]-h[12]),h[8]+=h[12],h[12]=v-h[8],v=-n.SQRT2*(h[9]-h[13]),h[9]+=h[13],h[13]=v-h[9],v=-n.SQRT2*(h[25]-h[29]),h[25]+=h[29],h[29]=v-h[25],v=-n.SQRT2*(h[24]+h[28]),h[24]-=h[28],h[28]=v-h[24],v=h[24]-h[16],h[24]=v,v=h[20]-v,h[20]=v,v=h[28]-v,h[28]=v,v=h[25]-h[17],h[25]=v,v=h[21]-v,h[21]=v,v=h[29]-v,h[29]=v,v=h[17]-h[1],h[17]=v,v=h[9]-v,h[9]=v,v=h[25]-v,h[25]=v,v=h[5]-v,h[5]=v,v=h[21]-v,h[21]=v,v=h[13]-v,h[13]=v,v=h[29]-v,h[29]=v,v=h[1]-h[0],h[1]=v,v=h[16]-v,h[16]=v,v=h[17]-v,h[17]=v,v=h[8]-v,h[8]=v,v=h[9]-v,h[9]=v,v=h[24]-v,h[24]=v,v=h[25]-v,h[25]=v,v=h[4]-v,h[4]=v,v=h[5]-v,h[5]=v,v=h[20]-v,h[20]=v,v=h[21]-v,h[21]=v,v=h[12]-v,h[12]=v,v=h[13]-v,h[13]=v,v=h[28]-v,h[28]=v,v=h[29]-v,h[29]=v,v=h[0],h[0]+=h[31],h[31]-=v,v=h[1],h[1]+=h[30],h[30]-=v,v=h[16],h[16]+=h[15],h[15]-=v,v=h[17],h[17]+=h[14],h[14]-=v,v=h[8],h[8]+=h[23],h[23]-=v,v=h[9],h[9]+=h[22],h[22]-=v,v=h[24],h[24]+=h[7],h[7]-=v,v=h[25],h[25]+=h[6],h[6]-=v,v=h[4],h[4]+=h[27],h[27]-=v,v=h[5],h[5]+=h[26],h[26]-=v,v=h[20],h[20]+=h[11],h[11]-=v,v=h[21],h[21]+=h[10],h[10]-=v,v=h[12],h[12]+=h[19],h[19]-=v,v=h[13],h[13]+=h[18],h[18]-=v,v=h[28],h[28]+=h[3],h[3]-=v,v=h[29],h[29]+=h[2],h[2]-=v}}function _(E,R){for(var h=0;h<3;h++){var k,L,$,P,I,H;P=E[R+2*3]*u[s.SHORT_TYPE][0]-E[R+5*3],k=E[R+0*3]*u[s.SHORT_TYPE][2]-E[R+3*3],L=P+k,$=P-k,P=E[R+5*3]*u[s.SHORT_TYPE][0]+E[R+2*3],k=E[R+3*3]*u[s.SHORT_TYPE][2]+E[R+0*3],I=P+k,H=-P+k,k=(E[R+1*3]*u[s.SHORT_TYPE][1]-E[R+4*3])*2069978111953089e-26,P=(E[R+4*3]*u[s.SHORT_TYPE][1]+E[R+1*3])*2069978111953089e-26,E[R+3*0]=L*190752519173728e-25+k,E[R+3*5]=-I*190752519173728e-25+P,$=$*.8660254037844387*1907525191737281e-26,I=I*.5*1907525191737281e-26+P,E[R+3*1]=$-I,E[R+3*2]=$+I,L=L*.5*1907525191737281e-26-k,H=H*.8660254037844387*1907525191737281e-26,E[R+3*3]=L+H,E[R+3*4]=L-H,R++}}function b(E,R,h){var k,L;{var $,P,I,H,ae,V,v,D;$=h[17]-h[9],I=h[15]-h[11],H=h[14]-h[12],ae=h[0]+h[8],V=h[1]+h[7],v=h[2]+h[6],D=h[3]+h[5],E[R+17]=ae+v-D-(V-h[4]),L=(ae+v-D)*p[19]+(V-h[4]),k=($-I-H)*p[18],E[R+5]=k+L,E[R+6]=k-L,P=(h[16]-h[10])*p[18],V=V*p[19]+h[4],k=$*p[12]+P+I*p[13]+H*p[14],L=-ae*p[16]+V-v*p[17]+D*p[15],E[R+1]=k+L,E[R+2]=k-L,k=$*p[13]-P-I*p[14]+H*p[12],L=-ae*p[17]+V-v*p[15]+D*p[16],E[R+9]=k+L,E[R+10]=k-L,k=$*p[14]-P+I*p[12]-H*p[13],L=ae*p[15]-V+v*p[16]-D*p[17],E[R+13]=k+L,E[R+14]=k-L}{var F,Y,K,Q,W,O,C,S;F=h[8]-h[0],K=h[6]-h[2],Q=h[5]-h[3],W=h[17]+h[9],O=h[16]+h[10],C=h[15]+h[11],S=h[14]+h[12],E[R+0]=W+C+S+(O+h[13]),k=(W+C+S)*p[19]-(O+h[13]),L=(F-K+Q)*p[18],E[R+11]=k+L,E[R+12]=k-L,Y=(h[7]-h[1])*p[18],O=h[13]-O*p[19],k=W*p[15]-O+C*p[16]+S*p[17],L=F*p[14]+Y+K*p[12]+Q*p[13],E[R+3]=k+L,E[R+4]=k-L,k=-W*p[17]+O-C*p[15]-S*p[16],L=F*p[13]+Y-K*p[14]-Q*p[12],E[R+7]=k+L,E[R+8]=k-L,k=-W*p[16]+O-C*p[17]-S*p[15],L=F*p[12]-Y+K*p[13]-Q*p[14],E[R+15]=k+L,E[R+16]=k-L}}this.mdct_sub48=function(E,R,h){for(var k=R,L=286,$=0;$<E.channels_out;$++){for(var P=0;P<E.mode_gr;P++){for(var I,H=E.l3_side.tt[P][$],ae=H.xr,V=0,v=E.sb_sample[$][1-P],D=0,F=0;F<18/2;F++)for(w(k,L,v[D]),w(k,L+32,v[D+1]),D+=2,L+=64,I=1;I<32;I+=2)v[D-1][I]*=-1;for(I=0;I<32;I++,V+=18){var Y=H.block_type,K=E.sb_sample[$][P],Q=E.sb_sample[$][1-P];if(H.mixed_block_flag!=0&&I<2&&(Y=0),E.amp_filter[I]<1e-12)r.fill(ae,V+0,V+18,0);else{if(E.amp_filter[I]<1)for(var F=0;F<18;F++)Q[F][g[I]]*=E.amp_filter[I];if(Y==s.SHORT_TYPE){for(var F=-l/4;F<0;F++){var W=u[s.SHORT_TYPE][F+3];ae[V+F*3+9]=K[9+F][g[I]]*W-K[8-F][g[I]],ae[V+F*3+18]=K[14-F][g[I]]*W+K[15+F][g[I]],ae[V+F*3+10]=K[15+F][g[I]]*W-K[14-F][g[I]],ae[V+F*3+19]=Q[2-F][g[I]]*W+Q[3+F][g[I]],ae[V+F*3+11]=Q[3+F][g[I]]*W-Q[2-F][g[I]],ae[V+F*3+20]=Q[8-F][g[I]]*W+Q[9+F][g[I]]}_(ae,V)}else{for(var O=i(18),F=-c/4;F<0;F++){var C,S;C=u[Y][F+27]*Q[F+9][g[I]]+u[Y][F+36]*Q[8-F][g[I]],S=u[Y][F+9]*K[F+9][g[I]]-u[Y][F+18]*K[8-F][g[I]],O[F+9]=C-S*f[3+F+9],O[F+18]=C*f[3+F+9]+S}b(ae,V,O)}}if(Y!=s.SHORT_TYPE&&I!=0)for(var F=7;F>=0;--F){var M,X;M=ae[V+F]*y[20+F]+ae[V+-1-F]*m[28+F],X=ae[V+F]*m[28+F]-ae[V+-1-F]*y[20+F],ae[V+-1-F]=M,ae[V+F]=X}}}if(k=h,L=286,E.mode_gr==1)for(var ie=0;ie<18;ie++)e.arraycopy(E.sb_sample[$][1][ie],0,E.sb_sample[$][0][ie],0,32)}}}return mf=o,mf}var _f,Oh;function Dh(){if(Oh)return _f;Oh=1;var t=xr(),e=zn,n=e.System,r=e.new_float,i=e.new_float_n;function s(){this.l=r(t.SBMAX_l),this.s=i([t.SBMAX_s,3]);var o=this;this.assign=function(a){n.arraycopy(a.l,0,o.l,0,t.SBMAX_l);for(var l=0;l<t.SBMAX_s;l++)for(var c=0;c<3;c++)o.s[l][c]=a.s[l][c]}}return _f=s,_f}var gf,Nh;function Zb(){if(Nh)return gf;Nh=1;var t=Dh();function e(){this.thm=new t,this.en=new t}return gf=e,gf}function Pi(t){var e=t;this.ordinal=function(){return e}}Pi.STEREO=new Pi(0),Pi.JOINT_STEREO=new Pi(1),Pi.DUAL_CHANNEL=new Pi(2),Pi.MONO=new Pi(3),Pi.NOT_SET=new Pi(4);var ul=Pi,bf,Fh;function xr(){if(Fh)return bf;Fh=1;var t=zn,e=t.System,n=t.VbrMode,r=t.new_array_n,i=t.new_float,s=t.new_float_n,o=t.new_int,a=t.assert;l.ENCDELAY=576,l.POSTDELAY=1152,l.MDCTDELAY=48,l.FFTOFFSET=224+l.MDCTDELAY,l.DECDELAY=528,l.SBLIMIT=32,l.CBANDS=64,l.SBPSY_l=21,l.SBPSY_s=12,l.SBMAX_l=22,l.SBMAX_s=13,l.PSFB21=6,l.PSFB12=6,l.BLKSIZE=1024,l.HBLKSIZE=l.BLKSIZE/2+1,l.BLKSIZE_s=256,l.HBLKSIZE_s=l.BLKSIZE_s/2+1,l.NORM_TYPE=0,l.START_TYPE=1,l.SHORT_TYPE=2,l.STOP_TYPE=3,l.MPG_MD_LR_LR=0,l.MPG_MD_LR_I=1,l.MPG_MD_MS_LR=2,l.MPG_MD_MS_I=3,l.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function l(){var c=qb(),u=Zb(),f=ul,p=l.FFTOFFSET,y=l.MPG_MD_MS_LR,m=null;this.psy=null;var g=null,w=null,_=null;this.setModules=function(k,L,$,P){m=k,this.psy=L,g=L,w=P,_=$};var b=new c;function E(k){var L,$;if(k.ATH.useAdjust==0){k.ATH.adjust=1;return}if($=k.loudness_sq[0][0],L=k.loudness_sq[1][0],k.channels_out==2?($+=k.loudness_sq[0][1],L+=k.loudness_sq[1][1]):($+=$,L+=L),k.mode_gr==2&&($=Math.max($,L)),$*=.5,$*=k.ATH.aaSensitivityP,$>.03125)k.ATH.adjust>=1?k.ATH.adjust=1:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=1;else{var P=31.98*$+625e-6;k.ATH.adjust>=P?(k.ATH.adjust*=P*.075+.925,k.ATH.adjust<P&&(k.ATH.adjust=P)):k.ATH.adjustLimit>=P?k.ATH.adjust=P:k.ATH.adjust<k.ATH.adjustLimit&&(k.ATH.adjust=k.ATH.adjustLimit),k.ATH.adjustLimit=P}}function R(k){var L,$;for(a(0<=k.bitrate_index&&k.bitrate_index<16),a(0<=k.mode_ext&&k.mode_ext<4),k.bitrate_stereoMode_Hist[k.bitrate_index][4]++,k.bitrate_stereoMode_Hist[15][4]++,k.channels_out==2&&(k.bitrate_stereoMode_Hist[k.bitrate_index][k.mode_ext]++,k.bitrate_stereoMode_Hist[15][k.mode_ext]++),L=0;L<k.mode_gr;++L)for($=0;$<k.channels_out;++$){var P=k.l3_side.tt[L][$].block_type|0;k.l3_side.tt[L][$].mixed_block_flag!=0&&(P=4),k.bitrate_blockType_Hist[k.bitrate_index][P]++,k.bitrate_blockType_Hist[k.bitrate_index][5]++,k.bitrate_blockType_Hist[15][P]++,k.bitrate_blockType_Hist[15][5]++}}function h(k,L){var $=k.internal_flags,P,I;if($.lame_encode_frame_init==0){var H,ae,V=i(2014),v=i(2014);for($.lame_encode_frame_init=1,H=0,ae=0;H<286+576*(1+$.mode_gr);++H)H<576*$.mode_gr?(V[H]=0,$.channels_out==2&&(v[H]=0)):(V[H]=L[0][ae],$.channels_out==2&&(v[H]=L[1][ae]),++ae);for(I=0;I<$.mode_gr;I++)for(P=0;P<$.channels_out;P++)$.l3_side.tt[I][P].block_type=l.SHORT_TYPE;b.mdct_sub48($,V,v),a(576>=l.FFTOFFSET),a($.mf_size>=l.BLKSIZE+k.framesize-l.FFTOFFSET),a($.mf_size>=512+k.framesize-32)}}this.lame_encode_mp3_frame=function(k,L,$,P,I,H){var ae,V=r([2,2]);V[0][0]=new u,V[0][1]=new u,V[1][0]=new u,V[1][1]=new u;var v=r([2,2]);v[0][0]=new u,v[0][1]=new u,v[1][0]=new u,v[1][1]=new u;var D,F=[null,null],Y=k.internal_flags,K=s([2,4]),Q=[.5,.5],W=[[0,0],[0,0]],O=[[0,0],[0,0]],C,S,M;if(F[0]=L,F[1]=$,Y.lame_encode_frame_init==0&&h(k,F),Y.padding=0,(Y.slot_lag-=Y.frac_SpF)<0&&(Y.slot_lag+=k.out_samplerate,Y.padding=1),Y.psymodel!=0){var X,ie=[null,null],G=0,z=o(2);for(M=0;M<Y.mode_gr;M++){for(S=0;S<Y.channels_out;S++)ie[S]=F[S],G=576+M*576-l.FFTOFFSET;if(k.VBR==n.vbr_mtrh||k.VBR==n.vbr_mt?X=g.L3psycho_anal_vbr(k,ie,G,M,V,v,W[M],O[M],K[M],z):X=g.L3psycho_anal_ns(k,ie,G,M,V,v,W[M],O[M],K[M],z),X!=0)return-4;for(k.mode==f.JOINT_STEREO&&(Q[M]=K[M][2]+K[M][3],Q[M]>0&&(Q[M]=K[M][3]/Q[M])),S=0;S<Y.channels_out;S++){var le=Y.l3_side.tt[M][S];le.block_type=z[S],le.mixed_block_flag=0}}}else for(M=0;M<Y.mode_gr;M++)for(S=0;S<Y.channels_out;S++)Y.l3_side.tt[M][S].block_type=l.NORM_TYPE,Y.l3_side.tt[M][S].mixed_block_flag=0,O[M][S]=W[M][S]=700;if(E(Y),b.mdct_sub48(Y,F[0],F[1]),Y.mode_ext=l.MPG_MD_LR_LR,k.force_ms)Y.mode_ext=l.MPG_MD_MS_LR;else if(k.mode==f.JOINT_STEREO){var Me=0,_e=0;for(M=0;M<Y.mode_gr;M++)for(S=0;S<Y.channels_out;S++)Me+=O[M][S],_e+=W[M][S];if(Me<=1*_e){var Ae=Y.l3_side.tt[0],Ee=Y.l3_side.tt[Y.mode_gr-1];Ae[0].block_type==Ae[1].block_type&&Ee[0].block_type==Ee[1].block_type&&(Y.mode_ext=l.MPG_MD_MS_LR)}}if(Y.mode_ext==y?(D=v,C=O):(D=V,C=W),k.analysis&&Y.pinfo!=null)for(M=0;M<Y.mode_gr;M++)for(S=0;S<Y.channels_out;S++)Y.pinfo.ms_ratio[M]=Y.ms_ratio[M],Y.pinfo.ms_ener_ratio[M]=Q[M],Y.pinfo.blocktype[M][S]=Y.l3_side.tt[M][S].block_type,Y.pinfo.pe[M][S]=C[M][S],e.arraycopy(Y.l3_side.tt[M][S].xr,0,Y.pinfo.xr[M][S],0,576),Y.mode_ext==y&&(Y.pinfo.ers[M][S]=Y.pinfo.ers[M][S+2],e.arraycopy(Y.pinfo.energy[M][S+2],0,Y.pinfo.energy[M][S],0,Y.pinfo.energy[M][S].length));if(k.VBR==n.vbr_off||k.VBR==n.vbr_abr){var Ve,Te;for(Ve=0;Ve<18;Ve++)Y.nsPsy.pefirbuf[Ve]=Y.nsPsy.pefirbuf[Ve+1];for(Te=0,M=0;M<Y.mode_gr;M++)for(S=0;S<Y.channels_out;S++)Te+=C[M][S];for(Y.nsPsy.pefirbuf[18]=Te,Te=Y.nsPsy.pefirbuf[9],Ve=0;Ve<9;Ve++)Te+=(Y.nsPsy.pefirbuf[Ve]+Y.nsPsy.pefirbuf[18-Ve])*l.fircoef[Ve];for(Te=670*5*Y.mode_gr*Y.channels_out/Te,M=0;M<Y.mode_gr;M++)for(S=0;S<Y.channels_out;S++)C[M][S]*=Te}if(Y.iteration_loop.iteration_loop(k,C,Q,D),m.format_bitstream(k),ae=m.copy_buffer(Y,P,I,H,1),k.bWriteVbrTag&&w.addVbrFrame(k),k.analysis&&Y.pinfo!=null){for(S=0;S<Y.channels_out;S++){var Le;for(Le=0;Le<p;Le++)Y.pinfo.pcmdata[S][Le]=Y.pinfo.pcmdata[S][Le+k.framesize];for(Le=p;Le<1600;Le++)Y.pinfo.pcmdata[S][Le]=F[S][Le-p]}_.set_frame_pinfo(k,D)}return R(Y),ae}}return bf=l,bf}var $h=zn,Vh=$h.Util,xh=$h.new_float,ur=xr();function Jb(){var t=xh(ur.BLKSIZE),e=xh(ur.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var l=0,c,u,f;a<<=1;var p=o+a;c=4;do{var y,m,g,w,_,b,E;E=c>>1,w=c,_=c<<1,b=_+w,c=_<<1,u=o,f=u+E;do{var R,h,k,L;h=s[u+0]-s[u+w],R=s[u+0]+s[u+w],L=s[u+_]-s[u+b],k=s[u+_]+s[u+b],s[u+_]=R-k,s[u+0]=R+k,s[u+b]=h-L,s[u+w]=h+L,h=s[f+0]-s[f+w],R=s[f+0]+s[f+w],L=Vh.SQRT2*s[f+b],k=Vh.SQRT2*s[f+_],s[f+_]=R-k,s[f+0]=R+k,s[f+b]=h-L,s[f+w]=h+L,f+=c,u+=c}while(u<p);for(m=n[l+0],y=n[l+1],g=1;g<E;g++){var $,P;$=1-2*y*y,P=2*y*m,u=o+g,f=o+w-g;do{var I,H,ae,R,h,V,k,v,L,D;H=P*s[u+w]-$*s[f+w],I=$*s[u+w]+P*s[f+w],h=s[u+0]-I,R=s[u+0]+I,V=s[f+0]-H,ae=s[f+0]+H,H=P*s[u+b]-$*s[f+b],I=$*s[u+b]+P*s[f+b],L=s[u+_]-I,k=s[u+_]+I,D=s[f+_]-H,v=s[f+_]+H,H=y*k-m*D,I=m*k+y*D,s[u+_]=R-I,s[u+0]=R+I,s[f+b]=V-H,s[f+w]=V+H,H=m*v-y*L,I=y*v+m*L,s[f+_]=ae-I,s[f+0]=ae+I,s[u+b]=h-H,s[u+w]=h+H,f+=c,u+=c}while(u<p);$=m,m=$*n[l+0]-y*n[l+1],y=$*n[l+1]+y*n[l+0]}l+=2}while(c<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,l,c){for(var u=0;u<3;u++){var f=ur.BLKSIZE_s/2,p=65535&576/3*(u+1),y=ur.BLKSIZE_s/8-1;do{var m,g,w,_,b,E=i[y<<2]&255;m=e[E]*l[a][c+E+p],b=e[127-E]*l[a][c+E+p+128],g=m-b,m=m+b,w=e[E+64]*l[a][c+E+p+64],b=e[63-E]*l[a][c+E+p+192],_=w-b,w=w+b,f-=4,o[u][f+0]=m+w,o[u][f+2]=m-w,o[u][f+1]=g+_,o[u][f+3]=g-_,m=e[E+1]*l[a][c+E+p+1],b=e[126-E]*l[a][c+E+p+129],g=m-b,m=m+b,w=e[E+65]*l[a][c+E+p+65],b=e[62-E]*l[a][c+E+p+193],_=w-b,w=w+b,o[u][f+ur.BLKSIZE_s/2+0]=m+w,o[u][f+ur.BLKSIZE_s/2+2]=m-w,o[u][f+ur.BLKSIZE_s/2+1]=g+_,o[u][f+ur.BLKSIZE_s/2+3]=g-_}while(--y>=0);r(o[u],f,ur.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,l,c){var u=ur.BLKSIZE/8-1,f=ur.BLKSIZE/2;do{var p,y,m,g,w,_=i[u]&255;p=t[_]*l[a][c+_],w=t[_+512]*l[a][c+_+512],y=p-w,p=p+w,m=t[_+256]*l[a][c+_+256],w=t[_+768]*l[a][c+_+768],g=m-w,m=m+w,f-=4,o[f+0]=p+m,o[f+2]=p-m,o[f+1]=y+g,o[f+3]=y-g,p=t[_+1]*l[a][c+_+1],w=t[_+513]*l[a][c+_+513],y=p-w,p=p+w,m=t[_+257]*l[a][c+_+257],w=t[_+769]*l[a][c+_+769],g=m-w,m=m+w,o[f+ur.BLKSIZE/2+0]=p+m,o[f+ur.BLKSIZE/2+2]=p-m,o[f+ur.BLKSIZE/2+1]=y+g,o[f+ur.BLKSIZE/2+3]=y-g}while(--u>=0);r(o,f,ur.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<ur.BLKSIZE;o++)t[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/ur.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/ur.BLKSIZE);for(var o=0;o<ur.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/ur.BLKSIZE_s))}}var Qb=Jb,fs=zn,Qo=fs.VbrMode,Hh=fs.Float,ea=fs.ShortBlock,Zr=fs.Util,e3=fs.Arrays,pr=fs.new_float,vi=fs.new_float_n,no=fs.new_int,Yt=fs.assert,t3=Qb,Ze=xr();function n3(){var t=ul,e=new t3,n=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,l=1/(14752*14752)/(Ze.BLKSIZE/2),c=.01,u=.8,f=.6,p=.3,y=3.5,m=21,g=.2302585093;function w(d,A){for(var N=0,j=0;j<Ze.BLKSIZE/2;++j)N+=d[j]*A.ATH.eql_w[j];return N*=l,N}function _(d,A,N,j,ee,te,se,be,he,Ce,Re){var Fe=d.internal_flags;if(he<2)e.fft_long(Fe,j[ee],he,Ce,Re),e.fft_short(Fe,te[se],he,Ce,Re);else if(he==2){for(var nt=Ze.BLKSIZE-1;nt>=0;--nt){var pt=j[ee+0][nt],je=j[ee+1][nt];j[ee+0][nt]=(pt+je)*Zr.SQRT2*.5,j[ee+1][nt]=(pt-je)*Zr.SQRT2*.5}for(var ft=2;ft>=0;--ft)for(var nt=Ze.BLKSIZE_s-1;nt>=0;--nt){var pt=te[se+0][ft][nt],je=te[se+1][ft][nt];te[se+0][ft][nt]=(pt+je)*Zr.SQRT2*.5,te[se+1][ft][nt]=(pt-je)*Zr.SQRT2*.5}}A[0]=j[ee+0][0],A[0]*=A[0];for(var nt=Ze.BLKSIZE/2-1;nt>=0;--nt){var Oe=j[ee+0][Ze.BLKSIZE/2-nt],$e=j[ee+0][Ze.BLKSIZE/2+nt];A[Ze.BLKSIZE/2-nt]=(Oe*Oe+$e*$e)*.5}for(var ft=2;ft>=0;--ft){N[ft][0]=te[se+0][ft][0],N[ft][0]*=N[ft][0];for(var nt=Ze.BLKSIZE_s/2-1;nt>=0;--nt){var Oe=te[se+0][ft][Ze.BLKSIZE_s/2-nt],$e=te[se+0][ft][Ze.BLKSIZE_s/2+nt];N[ft][Ze.BLKSIZE_s/2-nt]=(Oe*Oe+$e*$e)*.5}}{for(var at=0,nt=11;nt<Ze.HBLKSIZE;nt++)at+=A[nt];Fe.tot_ener[he]=at}if(d.analysis){for(var nt=0;nt<Ze.HBLKSIZE;nt++)Fe.pinfo.energy[be][he][nt]=Fe.pinfo.energy_save[he][nt],Fe.pinfo.energy_save[he][nt]=A[nt];Fe.pinfo.pe[be][he]=Fe.pe[he]}d.athaa_loudapprox==2&&he<2&&(Fe.loudness_sq[be][he]=Fe.loudness_sq_save[he],Fe.loudness_sq_save[he]=w(A,Fe))}var b=8,E=23,R=15,h,k,L,$=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function P(){h=Math.pow(10,(b+1)/16),k=Math.pow(10,(E+1)/16),L=Math.pow(10,R/10)}var I=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],H=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],ae=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function V(d,A,N,j,ee,te){var se;if(A>d)if(A<d*k)se=A/d;else return d+A;else{if(d>=A*k)return d+A;se=d/A}if(d+=A,j+3<=6){if(se>=h)return d;var be=0|Zr.FAST_LOG10_X(se,16);return d*H[be]}var be=0|Zr.FAST_LOG10_X(se,16);if(te!=0?A=ee.ATH.cb_s[N]*ee.ATH.adjust:A=ee.ATH.cb_l[N]*ee.ATH.adjust,d<L*A){if(d>A){var he,Ce;return he=1,be<=13&&(he=ae[be]),Ce=Zr.FAST_LOG10_X(d/A,10/15),d*((I[be]-he)*Ce+he)}return be>13?d:d*ae[be]}return d*I[be]}var v=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function D(d,A,N){var j;if(d<0&&(d=0),A<0&&(A=0),d<=0)return A;if(A<=0)return d;if(A>d?j=A/d:j=d/A,-2<=N&&N<=2){if(j>=h)return d+A;var ee=0|Zr.FAST_LOG10_X(j,16);return(d+A)*v[ee]}return j<k?d+A:(d<A&&(d=A),d)}function F(d,A){var N=d.internal_flags;if(N.channels_out>1){for(var j=0;j<Ze.SBMAX_l;j++){var ee=N.thm[0].l[j],te=N.thm[1].l[j];N.thm[0].l[j]+=te*A,N.thm[1].l[j]+=ee*A}for(var j=0;j<Ze.SBMAX_s;j++)for(var se=0;se<3;se++){var ee=N.thm[0].s[j][se],te=N.thm[1].s[j][se];N.thm[0].s[j][se]+=te*A,N.thm[1].s[j][se]+=ee*A}}}function Y(d){for(var A=0;A<Ze.SBMAX_l;A++)if(!(d.thm[0].l[A]>1.58*d.thm[1].l[A]||d.thm[1].l[A]>1.58*d.thm[0].l[A])){var N=d.mld_l[A]*d.en[3].l[A],j=Math.max(d.thm[2].l[A],Math.min(d.thm[3].l[A],N));N=d.mld_l[A]*d.en[2].l[A];var ee=Math.max(d.thm[3].l[A],Math.min(d.thm[2].l[A],N));d.thm[2].l[A]=j,d.thm[3].l[A]=ee}for(var A=0;A<Ze.SBMAX_s;A++)for(var te=0;te<3;te++)if(!(d.thm[0].s[A][te]>1.58*d.thm[1].s[A][te]||d.thm[1].s[A][te]>1.58*d.thm[0].s[A][te])){var N=d.mld_s[A]*d.en[3].s[A][te],j=Math.max(d.thm[2].s[A][te],Math.min(d.thm[3].s[A][te],N));N=d.mld_s[A]*d.en[2].s[A][te];var ee=Math.max(d.thm[3].s[A][te],Math.min(d.thm[2].s[A][te],N));d.thm[2].s[A][te]=j,d.thm[3].s[A][te]=ee}}function K(d,A,N){var j=A,ee=Math.pow(10,N);A*=2,j*=2;for(var te=0;te<Ze.SBMAX_l;te++){var se,be,he,Ce;if(Ce=d.ATH.cb_l[d.bm_l[te]]*ee,se=Math.min(Math.max(d.thm[0].l[te],Ce),Math.max(d.thm[1].l[te],Ce)),be=Math.max(d.thm[2].l[te],Ce),he=Math.max(d.thm[3].l[te],Ce),se*A<be+he){var Re=se*j/(be+he);be*=Re,he*=Re}d.thm[2].l[te]=Math.min(be,d.thm[2].l[te]),d.thm[3].l[te]=Math.min(he,d.thm[3].l[te])}ee*=Ze.BLKSIZE_s/Ze.BLKSIZE;for(var te=0;te<Ze.SBMAX_s;te++)for(var Fe=0;Fe<3;Fe++){var se,be,he,Ce;if(Ce=d.ATH.cb_s[d.bm_s[te]]*ee,se=Math.min(Math.max(d.thm[0].s[te][Fe],Ce),Math.max(d.thm[1].s[te][Fe],Ce)),be=Math.max(d.thm[2].s[te][Fe],Ce),he=Math.max(d.thm[3].s[te][Fe],Ce),se*A<be+he){var Re=se*A/(be+he);be*=Re,he*=Re}d.thm[2].s[te][Fe]=Math.min(d.thm[2].s[te][Fe],be),d.thm[3].s[te][Fe]=Math.min(d.thm[3].s[te][Fe],he)}}function Q(d,A,N,j,ee){var te,se,be=0,he=0;for(te=se=0;te<Ze.SBMAX_s;++se,++te){for(var Ce=d.bo_s[te],Re=d.npart_s,Fe=Ce<Re?Ce:Re;se<Fe;)Yt(A[se]>=0),Yt(N[se]>=0),be+=A[se],he+=N[se],se++;if(d.en[j].s[te][ee]=be,d.thm[j].s[te][ee]=he,se>=Re){++te;break}Yt(A[se]>=0),Yt(N[se]>=0);{var nt=d.PSY.bo_s_weight[te],pt=1-nt;be=nt*A[se],he=nt*N[se],d.en[j].s[te][ee]+=be,d.thm[j].s[te][ee]+=he,be=pt*A[se],he=pt*N[se]}}for(;te<Ze.SBMAX_s;++te)d.en[j].s[te][ee]=0,d.thm[j].s[te][ee]=0}function W(d,A,N,j){var ee,te,se=0,be=0;for(ee=te=0;ee<Ze.SBMAX_l;++te,++ee){for(var he=d.bo_l[ee],Ce=d.npart_l,Re=he<Ce?he:Ce;te<Re;)Yt(A[te]>=0),Yt(N[te]>=0),se+=A[te],be+=N[te],te++;if(d.en[j].l[ee]=se,d.thm[j].l[ee]=be,te>=Ce){++ee;break}Yt(A[te]>=0),Yt(N[te]>=0);{var Fe=d.PSY.bo_l_weight[ee],nt=1-Fe;se=Fe*A[te],be=Fe*N[te],d.en[j].l[ee]+=se,d.thm[j].l[ee]+=be,se=nt*A[te],be=nt*N[te]}}for(;ee<Ze.SBMAX_l;++ee)d.en[j].l[ee]=0,d.thm[j].l[ee]=0}function O(d,A,N,j,ee,te){var se=d.internal_flags,be,he;for(he=be=0;he<se.npart_s;++he){for(var Ce=0,Re=se.numlines_s[he],Fe=0;Fe<Re;++Fe,++be){var nt=A[te][be];Ce+=nt}N[he]=Ce}for(Yt(he==se.npart_s),be=he=0;he<se.npart_s;he++){var pt=se.s3ind_s[he][0],je=se.s3_ss[be++]*N[pt];for(++pt;pt<=se.s3ind_s[he][1];)je+=se.s3_ss[be]*N[pt],++be,++pt;{var ft=s*se.nb_s1[ee][he];j[he]=Math.min(je,ft)}if(se.blocktype_old[ee&1]==Ze.SHORT_TYPE){var ft=o*se.nb_s2[ee][he],Oe=j[he];j[he]=Math.min(ft,Oe)}se.nb_s2[ee][he]=se.nb_s1[ee][he],se.nb_s1[ee][he]=je,Yt(j[he]>=0)}for(;he<=Ze.CBANDS;++he)N[he]=0,j[he]=0}function C(d,A,N,j){var ee=d.internal_flags;d.short_blocks==ea.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var te=0;te<ee.channels_out;te++)j[te]=Ze.NORM_TYPE,d.short_blocks==ea.short_block_dispensed&&(A[te]=1),d.short_blocks==ea.short_block_forced&&(A[te]=0),A[te]!=0?(Yt(ee.blocktype_old[te]!=Ze.START_TYPE),ee.blocktype_old[te]==Ze.SHORT_TYPE&&(j[te]=Ze.STOP_TYPE)):(j[te]=Ze.SHORT_TYPE,ee.blocktype_old[te]==Ze.NORM_TYPE&&(ee.blocktype_old[te]=Ze.START_TYPE),ee.blocktype_old[te]==Ze.STOP_TYPE&&(ee.blocktype_old[te]=Ze.SHORT_TYPE)),N[te]=ee.blocktype_old[te],ee.blocktype_old[te]=j[te]}function S(d,A,N){return N>=1?d:N<=0?A:A>0?Math.pow(d/A,N)*A:0}var M=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function X(d,A){for(var N=309.07,j=0;j<Ze.SBMAX_s-1;j++)for(var ee=0;ee<3;ee++){var te=d.thm.s[j][ee];if(te>0){var se=te*A,be=d.en.s[j][ee];be>se&&(be>se*1e10?N+=M[j]*(10*n):N+=M[j]*Zr.FAST_LOG10(be/se))}}return N}var ie=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function G(d,A){for(var N=281.0575,j=0;j<Ze.SBMAX_l-1;j++){var ee=d.thm.l[j];if(ee>0){var te=ee*A,se=d.en.l[j];se>te&&(se>te*1e10?N+=ie[j]*(10*n):N+=ie[j]*Zr.FAST_LOG10(se/te))}}return N}function z(d,A,N,j,ee){var te,se;for(te=se=0;te<d.npart_l;++te){var be=0,he=0,Ce;for(Ce=0;Ce<d.numlines_l[te];++Ce,++se){var Re=A[se];be+=Re,he<Re&&(he=Re)}N[te]=be,j[te]=he,ee[te]=be*d.rnumlines_l[te],Yt(d.rnumlines_l[te]>=0),Yt(N[te]>=0),Yt(j[te]>=0),Yt(ee[te]>=0)}}function le(d,A,N,j){var ee=$.length-1,te=0,se=N[te]+N[te+1];if(se>0){var be=A[te];be<A[te+1]&&(be=A[te+1]),Yt(d.numlines_l[te]+d.numlines_l[te+1]-1>0),se=20*(be*2-se)/(se*(d.numlines_l[te]+d.numlines_l[te+1]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;for(te=1;te<d.npart_l-1;te++)if(se=N[te-1]+N[te]+N[te+1],se>0){var be=A[te-1];be<A[te]&&(be=A[te]),be<A[te+1]&&(be=A[te+1]),Yt(d.numlines_l[te-1]+d.numlines_l[te]+d.numlines_l[te+1]-1>0),se=20*(be*3-se)/(se*(d.numlines_l[te-1]+d.numlines_l[te]+d.numlines_l[te+1]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;if(Yt(te==d.npart_l-1),se=N[te-1]+N[te],se>0){var be=A[te-1];be<A[te]&&(be=A[te]),Yt(d.numlines_l[te-1]+d.numlines_l[te]-1>0),se=20*(be*2-se)/(se*(d.numlines_l[te-1]+d.numlines_l[te]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;Yt(te==d.npart_l-1)}var Me=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(d,A,N,j,ee,te,se,be,he,Ce){var Re=d.internal_flags,Fe=vi([2,Ze.BLKSIZE]),nt=vi([2,3,Ze.BLKSIZE_s]),pt=pr(Ze.CBANDS+1),je=pr(Ze.CBANDS+1),ft=pr(Ze.CBANDS+2),Oe=no(2),$e=no(2),at,Ge,mt,Qe,vt,Lt,lt,Et,dt=vi([2,576]),Gt,Qt=no(Ze.CBANDS+2),Kt=no(Ze.CBANDS+2);for(e3.fill(Kt,0),at=Re.channels_out,d.mode==t.JOINT_STEREO&&(at=4),d.VBR==Qo.vbr_off?Gt=Re.ResvMax==0?0:Re.ResvSize/Re.ResvMax*.5:d.VBR==Qo.vbr_rh||d.VBR==Qo.vbr_mtrh||d.VBR==Qo.vbr_mt?Gt=.6:Gt=1,Ge=0;Ge<Re.channels_out;Ge++){var zt=A[Ge],nn=N+576-350-m+192;for(Qe=0;Qe<576;Qe++){var Ln,On;for(Ln=zt[nn+Qe+10],On=0,vt=0;vt<(m-1)/2-1;vt+=2)Ln+=Me[vt]*(zt[nn+Qe+vt]+zt[nn+Qe+m-vt]),On+=Me[vt+1]*(zt[nn+Qe+vt+1]+zt[nn+Qe+m-vt-1]);dt[Ge][Qe]=Ln+On}ee[j][Ge].en.assign(Re.en[Ge]),ee[j][Ge].thm.assign(Re.thm[Ge]),at>2&&(te[j][Ge].en.assign(Re.en[Ge+2]),te[j][Ge].thm.assign(Re.thm[Ge+2]))}for(Ge=0;Ge<at;Ge++){var xn,Ut,Nt=pr(12),en=[0,0,0,0],on=pr(12),Ye=1,ct,br=pr(Ze.CBANDS),Un=pr(Ze.CBANDS),tn=[0,0,0,0],Yn=pr(Ze.HBLKSIZE),wr=vi([3,Ze.HBLKSIZE_s]);for(Yt(Re.npart_s<=Ze.CBANDS),Yt(Re.npart_l<=Ze.CBANDS),Qe=0;Qe<3;Qe++)Nt[Qe]=Re.nsPsy.last_en_subshort[Ge][Qe+6],Yt(Re.nsPsy.last_en_subshort[Ge][Qe+4]>0),on[Qe]=Nt[Qe]/Re.nsPsy.last_en_subshort[Ge][Qe+4],en[0]+=Nt[Qe];if(Ge==2)for(Qe=0;Qe<576;Qe++){var Wn,Jn;Wn=dt[0][Qe],Jn=dt[1][Qe],dt[0][Qe]=Wn+Jn,dt[1][Qe]=Wn-Jn}{var fn=dt[Ge&1],Ar=0;for(Qe=0;Qe<9;Qe++){for(var yr=Ar+64,dn=1;Ar<yr;Ar++)dn<Math.abs(fn[Ar])&&(dn=Math.abs(fn[Ar]));Re.nsPsy.last_en_subshort[Ge][Qe]=Nt[Qe+3]=dn,en[1+Qe/3]+=dn,dn>Nt[Qe+3-2]?(Yt(Nt[Qe+3-2]>0),dn=dn/Nt[Qe+3-2]):Nt[Qe+3-2]>dn*10?dn=Nt[Qe+3-2]/(dn*10):dn=0,on[Qe+3]=dn}}if(d.analysis){var fr=on[0];for(Qe=1;Qe<12;Qe++)fr<on[Qe]&&(fr=on[Qe]);Re.pinfo.ers[j][Ge]=Re.pinfo.ers_save[Ge],Re.pinfo.ers_save[Ge]=fr}for(ct=Ge==3?Re.nsPsy.attackthre_s:Re.nsPsy.attackthre,Qe=0;Qe<12;Qe++)tn[Qe/3]==0&&on[Qe]>ct&&(tn[Qe/3]=Qe%3+1);for(Qe=1;Qe<4;Qe++){var ri;en[Qe-1]>en[Qe]?(Yt(en[Qe]>0),ri=en[Qe-1]/en[Qe]):(Yt(en[Qe-1]>0),ri=en[Qe]/en[Qe-1]),ri<1.7&&(tn[Qe]=0,Qe==1&&(tn[0]=0))}for(tn[0]!=0&&Re.nsPsy.lastAttacks[Ge]!=0&&(tn[0]=0),(Re.nsPsy.lastAttacks[Ge]==3||tn[0]+tn[1]+tn[2]+tn[3]!=0)&&(Ye=0,tn[1]!=0&&tn[0]!=0&&(tn[1]=0),tn[2]!=0&&tn[1]!=0&&(tn[2]=0),tn[3]!=0&&tn[2]!=0&&(tn[3]=0)),Ge<2?$e[Ge]=Ye:Ye==0&&($e[0]=$e[1]=0),he[Ge]=Re.tot_ener[Ge],Ut=nt,xn=Fe,_(d,Yn,wr,xn,Ge&1,Ut,Ge&1,j,Ge,A,N),z(Re,Yn,pt,br,Un),le(Re,br,Un,Qt),Et=0;Et<3;Et++){var bi,jn;for(O(d,wr,je,ft,Ge,Et),Q(Re,je,ft,Ge,Et),lt=0;lt<Ze.SBMAX_s;lt++){if(jn=Re.thm[Ge].s[lt][Et],jn*=u,tn[Et]>=2||tn[Et+1]==1){var Wr=Et!=0?Et-1:2,dn=S(Re.thm[Ge].s[lt][Wr],jn,f*Gt);jn=Math.min(jn,dn)}if(tn[Et]==1){var Wr=Et!=0?Et-1:2,dn=S(Re.thm[Ge].s[lt][Wr],jn,p*Gt);jn=Math.min(jn,dn)}else if(Et!=0&&tn[Et-1]==3||Et==0&&Re.nsPsy.lastAttacks[Ge]==3){var Wr=Et!=2?Et+1:0,dn=S(Re.thm[Ge].s[lt][Wr],jn,p*Gt);jn=Math.min(jn,dn)}bi=Nt[Et*3+3]+Nt[Et*3+4]+Nt[Et*3+5],Nt[Et*3+5]*6<bi&&(jn*=.5,Nt[Et*3+4]*6<bi&&(jn*=.5)),Re.thm[Ge].s[lt][Et]=jn}}for(Re.nsPsy.lastAttacks[Ge]=tn[2],Lt=0,mt=0;mt<Re.npart_l;mt++){for(var He=Re.s3ind[mt][0],Bt=pt[He]*$[Qt[He]],Pt=Re.s3_ll[Lt++]*Bt;++He<=Re.s3ind[mt][1];)Bt=pt[He]*$[Qt[He]],Pt=V(Pt,Re.s3_ll[Lt++]*Bt,He,He-mt,Re,0);Pt*=.158489319246111,Re.blocktype_old[Ge&1]==Ze.SHORT_TYPE?ft[mt]=Pt:ft[mt]=S(Math.min(Pt,Math.min(r*Re.nb_1[Ge][mt],i*Re.nb_2[Ge][mt])),Pt,Gt),Re.nb_2[Ge][mt]=Re.nb_1[Ge][mt],Re.nb_1[Ge][mt]=Pt}for(;mt<=Ze.CBANDS;++mt)pt[mt]=0,ft[mt]=0;W(Re,pt,ft,Ge)}if((d.mode==t.STEREO||d.mode==t.JOINT_STEREO)&&d.interChRatio>0&&F(d,d.interChRatio),d.mode==t.JOINT_STEREO){var xt;Y(Re),xt=d.msfix,Math.abs(xt)>0&&K(Re,xt,d.ATHlower*Re.ATH.adjust)}for(C(d,$e,Ce,Oe),Ge=0;Ge<at;Ge++){var rn,xe=0,Rt,At;Ge>1?(rn=be,xe=-2,Rt=Ze.NORM_TYPE,(Ce[0]==Ze.SHORT_TYPE||Ce[1]==Ze.SHORT_TYPE)&&(Rt=Ze.SHORT_TYPE),At=te[j][Ge-2]):(rn=se,xe=0,Rt=Ce[Ge],At=ee[j][Ge]),Rt==Ze.SHORT_TYPE?rn[xe+Ge]=X(At,Re.masking_lower):rn[xe+Ge]=G(At,Re.masking_lower),d.analysis&&(Re.pinfo.pe[j][Ge]=rn[xe+Ge])}return 0};function _e(d,A,N,j,ee,te,se,be){var he=d.internal_flags;if(j<2)e.fft_long(he,se[be],j,A,N);else if(j==2)for(var Ce=Ze.BLKSIZE-1;Ce>=0;--Ce){var Re=se[be+0][Ce],Fe=se[be+1][Ce];se[be+0][Ce]=(Re+Fe)*Zr.SQRT2*.5,se[be+1][Ce]=(Re-Fe)*Zr.SQRT2*.5}te[0]=se[be+0][0],te[0]*=te[0];for(var Ce=Ze.BLKSIZE/2-1;Ce>=0;--Ce){var nt=se[be+0][Ze.BLKSIZE/2-Ce],pt=se[be+0][Ze.BLKSIZE/2+Ce];te[Ze.BLKSIZE/2-Ce]=(nt*nt+pt*pt)*.5}{for(var je=0,Ce=11;Ce<Ze.HBLKSIZE;Ce++)je+=te[Ce];he.tot_ener[j]=je}if(d.analysis){for(var Ce=0;Ce<Ze.HBLKSIZE;Ce++)he.pinfo.energy[ee][j][Ce]=he.pinfo.energy_save[j][Ce],he.pinfo.energy_save[j][Ce]=te[Ce];he.pinfo.pe[ee][j]=he.pe[j]}}function Ae(d,A,N,j,ee,te,se,be){var he=d.internal_flags;if(ee==0&&j<2&&e.fft_short(he,se[be],j,A,N),j==2)for(var Ce=Ze.BLKSIZE_s-1;Ce>=0;--Ce){var Re=se[be+0][ee][Ce],Fe=se[be+1][ee][Ce];se[be+0][ee][Ce]=(Re+Fe)*Zr.SQRT2*.5,se[be+1][ee][Ce]=(Re-Fe)*Zr.SQRT2*.5}te[ee][0]=se[be+0][ee][0],te[ee][0]*=te[ee][0];for(var Ce=Ze.BLKSIZE_s/2-1;Ce>=0;--Ce){var nt=se[be+0][ee][Ze.BLKSIZE_s/2-Ce],pt=se[be+0][ee][Ze.BLKSIZE_s/2+Ce];te[ee][Ze.BLKSIZE_s/2-Ce]=(nt*nt+pt*pt)*.5}}function Ee(d,A,N,j){var ee=d.internal_flags;d.athaa_loudapprox==2&&N<2&&(ee.loudness_sq[A][N]=ee.loudness_sq_save[N],ee.loudness_sq_save[N]=w(j,ee))}var Ve=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Te(d,A,N,j,ee,te,se,be,he,Ce){for(var Re=vi([2,576]),Fe=d.internal_flags,nt=Fe.channels_out,pt=d.mode==t.JOINT_STEREO?4:nt,je=0;je<nt;je++){firbuf=A[je];for(var ft=N+576-350-m+192,Oe=0;Oe<576;Oe++){var $e,at;$e=firbuf[ft+Oe+10],at=0;for(var Ge=0;Ge<(m-1)/2-1;Ge+=2)$e+=Ve[Ge]*(firbuf[ft+Oe+Ge]+firbuf[ft+Oe+m-Ge]),at+=Ve[Ge+1]*(firbuf[ft+Oe+Ge+1]+firbuf[ft+Oe+m-Ge-1]);Re[je][Oe]=$e+at}ee[j][je].en.assign(Fe.en[je]),ee[j][je].thm.assign(Fe.thm[je]),pt>2&&(te[j][je].en.assign(Fe.en[je+2]),te[j][je].thm.assign(Fe.thm[je+2]))}for(var je=0;je<pt;je++){var mt=pr(12),Qe=pr(12),vt=[0,0,0,0],Lt=Re[je&1],lt=0,Et=je==3?Fe.nsPsy.attackthre_s:Fe.nsPsy.attackthre,dt=1;if(je==2)for(var Oe=0,Ge=576;Ge>0;++Oe,--Ge){var Gt=Re[0][Oe],Qt=Re[1][Oe];Re[0][Oe]=Gt+Qt,Re[1][Oe]=Gt-Qt}for(var Oe=0;Oe<3;Oe++)Qe[Oe]=Fe.nsPsy.last_en_subshort[je][Oe+6],Yt(Fe.nsPsy.last_en_subshort[je][Oe+4]>0),mt[Oe]=Qe[Oe]/Fe.nsPsy.last_en_subshort[je][Oe+4],vt[0]+=Qe[Oe];for(var Oe=0;Oe<9;Oe++){for(var Kt=lt+64,zt=1;lt<Kt;lt++)zt<Math.abs(Lt[lt])&&(zt=Math.abs(Lt[lt]));Fe.nsPsy.last_en_subshort[je][Oe]=Qe[Oe+3]=zt,vt[1+Oe/3]+=zt,zt>Qe[Oe+3-2]?(Yt(Qe[Oe+3-2]>0),zt=zt/Qe[Oe+3-2]):Qe[Oe+3-2]>zt*10?zt=Qe[Oe+3-2]/(zt*10):zt=0,mt[Oe+3]=zt}for(var Oe=0;Oe<3;++Oe){var nn=Qe[Oe*3+3]+Qe[Oe*3+4]+Qe[Oe*3+5],Ln=1;Qe[Oe*3+5]*6<nn&&(Ln*=.5,Qe[Oe*3+4]*6<nn&&(Ln*=.5)),be[je][Oe]=Ln}if(d.analysis){for(var On=mt[0],Oe=1;Oe<12;Oe++)On<mt[Oe]&&(On=mt[Oe]);Fe.pinfo.ers[j][je]=Fe.pinfo.ers_save[je],Fe.pinfo.ers_save[je]=On}for(var Oe=0;Oe<12;Oe++)he[je][Oe/3]==0&&mt[Oe]>Et&&(he[je][Oe/3]=Oe%3+1);for(var Oe=1;Oe<4;Oe++){var xn=vt[Oe-1],Ut=vt[Oe],Nt=Math.max(xn,Ut);Nt<4e4&&xn<1.7*Ut&&Ut<1.7*xn&&(Oe==1&&he[je][0]<=he[je][Oe]&&(he[je][0]=0),he[je][Oe]=0)}he[je][0]<=Fe.nsPsy.lastAttacks[je]&&(he[je][0]=0),(Fe.nsPsy.lastAttacks[je]==3||he[je][0]+he[je][1]+he[je][2]+he[je][3]!=0)&&(dt=0,he[je][1]!=0&&he[je][0]!=0&&(he[je][1]=0),he[je][2]!=0&&he[je][1]!=0&&(he[je][2]=0),he[je][3]!=0&&he[je][2]!=0&&(he[je][3]=0)),je<2?Ce[je]=dt:dt==0&&(Ce[0]=Ce[1]=0),se[je]=Fe.tot_ener[je]}}function Le(d,A,N){if(N==0)for(var j=0;j<d.npart_s;j++)d.nb_s2[A][j]=d.nb_s1[A][j],d.nb_s1[A][j]=0}function Ie(d,A){for(var N=0;N<d.npart_l;N++)d.nb_2[A][N]=d.nb_1[A][N],d.nb_1[A][N]=0}function et(d,A,N,j){var ee=$.length-1,te=0,se=N[te]+N[te+1];if(se>0){var be=A[te];be<A[te+1]&&(be=A[te+1]),Yt(d.numlines_s[te]+d.numlines_s[te+1]-1>0),se=20*(be*2-se)/(se*(d.numlines_s[te]+d.numlines_s[te+1]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;for(te=1;te<d.npart_s-1;te++)if(se=N[te-1]+N[te]+N[te+1],Yt(te+1<d.npart_s),se>0){var be=A[te-1];be<A[te]&&(be=A[te]),be<A[te+1]&&(be=A[te+1]),Yt(d.numlines_s[te-1]+d.numlines_s[te]+d.numlines_s[te+1]-1>0),se=20*(be*3-se)/(se*(d.numlines_s[te-1]+d.numlines_s[te]+d.numlines_s[te+1]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;if(Yt(te==d.npart_s-1),se=N[te-1]+N[te],se>0){var be=A[te-1];be<A[te]&&(be=A[te]),Yt(d.numlines_s[te-1]+d.numlines_s[te]-1>0),se=20*(be*2-se)/(se*(d.numlines_s[te-1]+d.numlines_s[te]-1));var he=0|se;he>ee&&(he=ee),j[te]=he}else j[te]=0;Yt(te==d.npart_s-1)}function B(d,A,N,j,ee,te){var se=d.internal_flags,be=new float[Ze.CBANDS],he=pr(Ze.CBANDS),Ce,Re,Fe,nt=new int[Ze.CBANDS];for(Fe=Re=0;Fe<se.npart_s;++Fe){var pt=0,je=0,ft=se.numlines_s[Fe];for(Ce=0;Ce<ft;++Ce,++Re){var Oe=A[te][Re];pt+=Oe,je<Oe&&(je=Oe)}N[Fe]=pt,be[Fe]=je,he[Fe]=pt/ft,Yt(he[Fe]>=0)}for(Yt(Fe==se.npart_s);Fe<Ze.CBANDS;++Fe)be[Fe]=0,he[Fe]=0;for(et(se,be,he,nt),Re=Fe=0;Fe<se.npart_s;Fe++){var $e=se.s3ind_s[Fe][0],at=se.s3ind_s[Fe][1],Ge,mt,Qe,vt,Lt;for(Ge=nt[$e],mt=1,vt=se.s3_ss[Re]*N[$e]*$[nt[$e]],++Re,++$e;$e<=at;)Ge+=nt[$e],mt+=1,Qe=se.s3_ss[Re]*N[$e]*$[nt[$e]],vt=D(vt,Qe,$e-Fe),++Re,++$e;Ge=(1+2*Ge)/(2*mt),Lt=$[Ge]*.5,vt*=Lt,j[Fe]=vt,se.nb_s2[ee][Fe]=se.nb_s1[ee][Fe],se.nb_s1[ee][Fe]=vt,Qe=be[Fe],Qe*=se.minval_s[Fe],Qe*=Lt,j[Fe]>Qe&&(j[Fe]=Qe),se.masking_lower>1&&(j[Fe]*=se.masking_lower),j[Fe]>N[Fe]&&(j[Fe]=N[Fe]),se.masking_lower<1&&(j[Fe]*=se.masking_lower),Yt(j[Fe]>=0)}for(;Fe<Ze.CBANDS;++Fe)N[Fe]=0,j[Fe]=0}function x(d,A,N,j,ee){var te=pr(Ze.CBANDS),se=pr(Ze.CBANDS),be=no(Ze.CBANDS+2),he;z(d,A,N,te,se),le(d,te,se,be);var Ce=0;for(he=0;he<d.npart_l;he++){var Re,Fe,nt,pt,je=d.s3ind[he][0],ft=d.s3ind[he][1],Oe=0,$e=0;for(Oe=be[je],$e+=1,Fe=d.s3_ll[Ce]*N[je]*$[be[je]],++Ce,++je;je<=ft;)Oe+=be[je],$e+=1,Re=d.s3_ll[Ce]*N[je]*$[be[je]],pt=D(Fe,Re,je-he),Fe=pt,++Ce,++je;if(Oe=(1+2*Oe)/(2*$e),nt=$[Oe]*.5,Fe*=nt,d.blocktype_old[ee&1]==Ze.SHORT_TYPE){var at=r*d.nb_1[ee][he];at>0?j[he]=Math.min(Fe,at):j[he]=Math.min(Fe,N[he]*p)}else{var Ge=i*d.nb_2[ee][he],mt=r*d.nb_1[ee][he],at;Ge<=0&&(Ge=Fe),mt<=0&&(mt=Fe),d.blocktype_old[ee&1]==Ze.NORM_TYPE?at=Math.min(mt,Ge):at=mt,j[he]=Math.min(Fe,at)}d.nb_2[ee][he]=d.nb_1[ee][he],d.nb_1[ee][he]=Fe,Re=te[he],Re*=d.minval_l[he],Re*=nt,j[he]>Re&&(j[he]=Re),d.masking_lower>1&&(j[he]*=d.masking_lower),j[he]>N[he]&&(j[he]=N[he]),d.masking_lower<1&&(j[he]*=d.masking_lower),Yt(j[he]>=0)}for(;he<Ze.CBANDS;++he)N[he]=0,j[he]=0}function Ne(d,A){var N=d.internal_flags;d.short_blocks==ea.short_block_coupled&&!(A[0]!=0&&A[1]!=0)&&(A[0]=A[1]=0);for(var j=0;j<N.channels_out;j++)d.short_blocks==ea.short_block_dispensed&&(A[j]=1),d.short_blocks==ea.short_block_forced&&(A[j]=0)}function We(d,A,N){for(var j=d.internal_flags,ee=0;ee<j.channels_out;ee++){var te=Ze.NORM_TYPE;A[ee]!=0?(Yt(j.blocktype_old[ee]!=Ze.START_TYPE),j.blocktype_old[ee]==Ze.SHORT_TYPE&&(te=Ze.STOP_TYPE)):(te=Ze.SHORT_TYPE,j.blocktype_old[ee]==Ze.NORM_TYPE&&(j.blocktype_old[ee]=Ze.START_TYPE),j.blocktype_old[ee]==Ze.STOP_TYPE&&(j.blocktype_old[ee]=Ze.SHORT_TYPE)),N[ee]=j.blocktype_old[ee],j.blocktype_old[ee]=te}}function tt(d,A,N,j,ee,te,se){for(var be=te*2,he=te>0?Math.pow(10,ee):1,Ce,Re,Fe=0;Fe<se;++Fe){var nt=d[2][Fe],pt=d[3][Fe],je=A[0][Fe],ft=A[1][Fe],Oe=A[2][Fe],$e=A[3][Fe];if(je<=1.58*ft&&ft<=1.58*je){var at=N[Fe]*pt,Ge=N[Fe]*nt;Re=Math.max(Oe,Math.min($e,at)),Ce=Math.max($e,Math.min(Oe,Ge))}else Re=Oe,Ce=$e;if(te>0){var mt,Qe,vt=j[Fe]*he;if(mt=Math.min(Math.max(je,vt),Math.max(ft,vt)),Oe=Math.max(Re,vt),$e=Math.max(Ce,vt),Qe=Oe+$e,Qe>0&&mt*be<Qe){var Lt=mt*be/Qe;Oe*=Lt,$e*=Lt}Re=Math.min(Oe,Re),Ce=Math.min($e,Ce)}Re>nt&&(Re=nt),Ce>pt&&(Ce=pt),A[2][Fe]=Re,A[3][Fe]=Ce}}this.L3psycho_anal_vbr=function(d,A,N,j,ee,te,se,be,he,Ce){var Re=d.internal_flags,Fe,nt,pt=pr(Ze.HBLKSIZE),je=vi([3,Ze.HBLKSIZE_s]),ft=vi([2,Ze.BLKSIZE]),Oe=vi([2,3,Ze.BLKSIZE_s]),$e=vi([4,Ze.CBANDS]),at=vi([4,Ze.CBANDS]),Ge=vi([4,3]),mt=.6,Qe=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],vt=no(2),Lt=d.mode==t.JOINT_STEREO?4:Re.channels_out;Te(d,A,N,j,ee,te,he,Ge,Qe,vt),Ne(d,vt);{for(var lt=0;lt<Lt;lt++){var Et=lt&1;Fe=ft,_e(d,A,N,lt,j,pt,Fe,Et),Ee(d,j,lt,pt),vt[Et]!=0?x(Re,pt,$e[lt],at[lt],lt):Ie(Re,lt)}vt[0]+vt[1]==2&&d.mode==t.JOINT_STEREO&&tt($e,at,Re.mld_cb_l,Re.ATH.cb_l,d.ATHlower*Re.ATH.adjust,d.msfix,Re.npart_l);for(var lt=0;lt<Lt;lt++){var Et=lt&1;vt[Et]!=0&&W(Re,$e[lt],at[lt],lt)}}{for(var dt=0;dt<3;dt++){for(var lt=0;lt<Lt;++lt){var Et=lt&1;vt[Et]!=0?Le(Re,lt,dt):(nt=Oe,Ae(d,A,N,lt,dt,je,nt,Et),B(d,je,$e[lt],at[lt],lt,dt))}vt[0]+vt[1]==0&&d.mode==t.JOINT_STEREO&&tt($e,at,Re.mld_cb_s,Re.ATH.cb_s,d.ATHlower*Re.ATH.adjust,d.msfix,Re.npart_s);for(var lt=0;lt<Lt;++lt){var Et=lt&1;vt[Et]==0&&Q(Re,$e[lt],at[lt],lt,dt)}}for(var lt=0;lt<Lt;lt++){var Et=lt&1;if(vt[Et]==0)for(var Gt=0;Gt<Ze.SBMAX_s;Gt++){for(var Qt=pr(3),dt=0;dt<3;dt++){var Kt=Re.thm[lt].s[Gt][dt];if(Kt*=u,Qe[lt][dt]>=2||Qe[lt][dt+1]==1){var zt=dt!=0?dt-1:2,nn=S(Re.thm[lt].s[Gt][zt],Kt,f*mt);Kt=Math.min(Kt,nn)}else if(Qe[lt][dt]==1){var zt=dt!=0?dt-1:2,nn=S(Re.thm[lt].s[Gt][zt],Kt,p*mt);Kt=Math.min(Kt,nn)}else if(dt!=0&&Qe[lt][dt-1]==3||dt==0&&Re.nsPsy.lastAttacks[lt]==3){var zt=dt!=2?dt+1:0,nn=S(Re.thm[lt].s[Gt][zt],Kt,p*mt);Kt=Math.min(Kt,nn)}Kt*=Ge[lt][dt],Qt[dt]=Kt}for(var dt=0;dt<3;dt++)Re.thm[lt].s[Gt][dt]=Qt[dt]}}}for(var lt=0;lt<Lt;lt++)Re.nsPsy.lastAttacks[lt]=Qe[lt][2];We(d,vt,Ce);for(var lt=0;lt<Lt;lt++){var Ln,On,xn,Ut;lt>1?(Ln=be,On=-2,xn=Ze.NORM_TYPE,(Ce[0]==Ze.SHORT_TYPE||Ce[1]==Ze.SHORT_TYPE)&&(xn=Ze.SHORT_TYPE),Ut=te[j][lt-2]):(Ln=se,On=0,xn=Ce[lt],Ut=ee[j][lt]),xn==Ze.SHORT_TYPE?Ln[On+lt]=X(Ut,Re.masking_lower):Ln[On+lt]=G(Ut,Re.masking_lower),d.analysis&&(Re.pinfo.pe[j][lt]=Ln[On+lt])}return 0};function ke(d,A){var N=d,j;return N>=0?j=-N*27:j=N*A,j<=-72?0:Math.exp(j*g)}function Pe(d){var A=0,N=0;{var j=0,ee,te;for(j=0;ke(j,d)>1e-20;j-=1);for(ee=j,te=0;Math.abs(te-ee)>1e-12;)j=(te+ee)/2,ke(j,d)>0?te=j:ee=j;A=ee}{var j=0,ee,te;for(j=0;ke(j,d)>1e-20;j+=1);for(ee=0,te=j;Math.abs(te-ee)>1e-12;)j=(te+ee)/2,ke(j,d)>0?ee=j:te=j;N=te}{var se=0,be=1e3,he;for(he=0;he<=be;++he){var j=A+he*(N-A)/be,Ce=ke(j,d);se+=Ce}{var Re=(be+1)/(se*(N-A));return Re}}}function Xe(d){var A,N,j,ee;return A=d,A>=0?A*=3:A*=1.5,A>=.5&&A<=2.5?(ee=A-.5,N=8*(ee*ee-2*ee)):N=0,A+=.474,j=15.811389+7.5*A-17.5*Math.sqrt(1+A*A),j<=-60?0:(A=Math.exp((N+j)*g),A/=.6609193,A)}function qe(d){return d<0&&(d=0),d=d*.001,13*Math.atan(.76*d)+3.5*Math.atan(d*d/(7.5*7.5))}function it(d,A,N,j,ee,te,se,be,he,Ce,Re,Fe){var nt=pr(Ze.CBANDS+1),pt=be/(Fe>15?2*576:2*192),je=no(Ze.HBLKSIZE),ft;be/=he;var Oe=0,$e=0;for(ft=0;ft<Ze.CBANDS;ft++){var at,Ge;for(at=qe(be*Oe),nt[ft]=be*Oe,Ge=Oe;qe(be*Ge)-at<a&&Ge<=he/2;Ge++);for(d[ft]=Ge-Oe,$e=ft+1;Oe<Ge;)Yt(Oe<Ze.HBLKSIZE),je[Oe++]=ft;if(Oe>he/2){Oe=he/2,++ft;break}}Yt(ft<Ze.CBANDS),nt[ft]=be*Oe;for(var mt=0;mt<Fe;mt++){var Qe,vt,Lt,lt,Et;Lt=Ce[mt],lt=Ce[mt+1],Qe=0|Math.floor(.5+Re*(Lt-.5)),Qe<0&&(Qe=0),vt=0|Math.floor(.5+Re*(lt-.5)),vt>he/2&&(vt=he/2),N[mt]=(je[Qe]+je[vt])/2,A[mt]=je[vt];var dt=pt*lt;se[mt]=(dt-nt[A[mt]])/(nt[A[mt]+1]-nt[A[mt]]),se[mt]<0?se[mt]=0:se[mt]>1&&(se[mt]=1),Et=qe(be*Ce[mt]*Re),Et=Math.min(Et,15.5)/15.5,te[mt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Et))-2.5)}Oe=0;for(var Gt=0;Gt<$e;Gt++){var Qt=d[Gt],at,Kt;at=qe(be*Oe),Kt=qe(be*(Oe+Qt-1)),j[Gt]=.5*(at+Kt),at=qe(be*(Oe-.5)),Kt=qe(be*(Oe+Qt-.5)),ee[Gt]=Kt-at,Oe+=Qt}return $e}function Je(d,A,N,j,ee,te){var se=vi([Ze.CBANDS,Ze.CBANDS]),be,he=0;if(te)for(var Ce=0;Ce<A;Ce++)for(be=0;be<A;be++){var Re=Xe(N[Ce]-N[be])*j[be];se[Ce][be]=Re*ee[Ce]}else for(be=0;be<A;be++)for(var Fe=15+Math.min(21/N[be],12),nt=Pe(Fe),Ce=0;Ce<A;Ce++){var Re=nt*ke(N[Ce]-N[be],Fe)*j[be];se[Ce][be]=Re*ee[Ce]}for(var Ce=0;Ce<A;Ce++){for(be=0;be<A&&!(se[Ce][be]>0);be++);for(d[Ce][0]=be,be=A-1;be>0&&!(se[Ce][be]>0);be--);d[Ce][1]=be,he+=d[Ce][1]-d[Ce][0]+1}for(var pt=pr(he),je=0,Ce=0;Ce<A;Ce++)for(be=d[Ce][0];be<=d[Ce][1];be++)pt[je++]=se[Ce][be];return pt}function U(d){var A=qe(d);return A=Math.min(A,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*A))-2.5)}this.psymodel_init=function(d){var A=d.internal_flags,N,j=!0,ee=13,te=24,se=0,be=0,he=-8.25,Ce=-4.5,Re=pr(Ze.CBANDS),Fe=pr(Ze.CBANDS),nt=pr(Ze.CBANDS),pt=d.out_samplerate;switch(d.experimentalZ){default:case 0:j=!0;break;case 1:j=!(d.VBR==Qo.vbr_mtrh||d.VBR==Qo.vbr_mt);break;case 2:j=!1;break;case 3:ee=8,se=-1.75,be=-.0125,he=-8.25,Ce=-2.25;break}for(A.ms_ener_ratio_old=.25,A.blocktype_old[0]=A.blocktype_old[1]=Ze.NORM_TYPE,N=0;N<4;++N){for(var Oe=0;Oe<Ze.CBANDS;++Oe)A.nb_1[N][Oe]=1e20,A.nb_2[N][Oe]=1e20,A.nb_s1[N][Oe]=A.nb_s2[N][Oe]=1;for(var je=0;je<Ze.SBMAX_l;je++)A.en[N].l[je]=1e20,A.thm[N].l[je]=1e20;for(var Oe=0;Oe<3;++Oe){for(var je=0;je<Ze.SBMAX_s;je++)A.en[N].s[je][Oe]=1e20,A.thm[N].s[je][Oe]=1e20;A.nsPsy.lastAttacks[N]=0}for(var Oe=0;Oe<9;Oe++)A.nsPsy.last_en_subshort[N][Oe]=10}for(A.loudness_sq_save[0]=A.loudness_sq_save[1]=0,A.npart_l=it(A.numlines_l,A.bo_l,A.bm_l,Re,Fe,A.mld_l,A.PSY.bo_l_weight,pt,Ze.BLKSIZE,A.scalefac_band.l,Ze.BLKSIZE/(2*576),Ze.SBMAX_l),Yt(A.npart_l<Ze.CBANDS),N=0;N<A.npart_l;N++){var ft=se;Re[N]>=ee&&(ft=be*(Re[N]-ee)/(te-ee)+se*(te-Re[N])/(te-ee)),nt[N]=Math.pow(10,ft/10),A.numlines_l[N]>0?A.rnumlines_l[N]=1/A.numlines_l[N]:A.rnumlines_l[N]=0}A.s3_ll=Je(A.s3ind,A.npart_l,Re,Fe,nt,j);var Oe=0;for(N=0;N<A.npart_l;N++){var $e;$e=Hh.MAX_VALUE;for(var at=0;at<A.numlines_l[N];at++,Oe++){var Ge=pt*Oe/(1e3*Ze.BLKSIZE),mt;mt=this.ATHformula(Ge*1e3,d)-20,mt=Math.pow(10,.1*mt),mt*=A.numlines_l[N],$e>mt&&($e=mt)}A.ATH.cb_l[N]=$e,$e=-20+Re[N]*20/10,$e>6&&($e=100),$e<-15&&($e=-15),$e-=8,A.minval_l[N]=Math.pow(10,$e/10)*A.numlines_l[N]}for(A.npart_s=it(A.numlines_s,A.bo_s,A.bm_s,Re,Fe,A.mld_s,A.PSY.bo_s_weight,pt,Ze.BLKSIZE_s,A.scalefac_band.s,Ze.BLKSIZE_s/(2*192),Ze.SBMAX_s),Yt(A.npart_s<Ze.CBANDS),Oe=0,N=0;N<A.npart_s;N++){var $e,ft=he;Re[N]>=ee&&(ft=Ce*(Re[N]-ee)/(te-ee)+he*(te-Re[N])/(te-ee)),nt[N]=Math.pow(10,ft/10),$e=Hh.MAX_VALUE;for(var at=0;at<A.numlines_s[N];at++,Oe++){var Ge=pt*Oe/(1e3*Ze.BLKSIZE_s),mt;mt=this.ATHformula(Ge*1e3,d)-20,mt=Math.pow(10,.1*mt),mt*=A.numlines_s[N],$e>mt&&($e=mt)}A.ATH.cb_s[N]=$e,$e=-7+Re[N]*7/12,Re[N]>12&&($e*=1+Math.log(1+$e)*3.1),Re[N]<12&&($e*=1+Math.log(1-$e)*2.3),$e<-15&&($e=-15),$e-=8,A.minval_s[N]=Math.pow(10,$e/10)*A.numlines_s[N]}A.s3_ss=Je(A.s3ind_s,A.npart_s,Re,Fe,nt,j),P(),e.init_fft(A),A.decay=Math.exp(-1*n/(c*pt/192));{var Qe;Qe=y,d.exp_nspsytune&2&&(Qe=1),Math.abs(d.msfix)>0&&(Qe=d.msfix),d.msfix=Qe;for(var vt=0;vt<A.npart_l;vt++)A.s3ind[vt][1]>A.npart_l-1&&(A.s3ind[vt][1]=A.npart_l-1)}var Lt=576*A.mode_gr/pt;if(A.ATH.decay=Math.pow(10,-12/10*Lt),A.ATH.adjust=.01,A.ATH.adjustLimit=1,Yt(A.bo_l[Ze.SBMAX_l-1]<=A.npart_l),Yt(A.bo_s[Ze.SBMAX_s-1]<=A.npart_s),d.ATHtype!=-1){var Ge,lt=d.out_samplerate/Ze.BLKSIZE,Et=0;for(Ge=0,N=0;N<Ze.BLKSIZE/2;++N)Ge+=lt,A.ATH.eql_w[N]=1/Math.pow(10,this.ATHformula(Ge,d)/10),Et+=A.ATH.eql_w[N];for(Et=1/Et,N=Ze.BLKSIZE/2;--N>=0;)A.ATH.eql_w[N]*=Et}{for(var vt=Oe=0;vt<A.npart_s;++vt)for(N=0;N<A.numlines_s[vt];++N)++Oe;for(var vt=Oe=0;vt<A.npart_l;++vt)for(N=0;N<A.numlines_l[vt];++N)++Oe}for(Oe=0,N=0;N<A.npart_l;N++){var Ge=pt*(Oe+A.numlines_l[N]/2)/(1*Ze.BLKSIZE);A.mld_cb_l[N]=U(Ge),Oe+=A.numlines_l[N]}for(;N<Ze.CBANDS;++N)A.mld_cb_l[N]=1;for(Oe=0,N=0;N<A.npart_s;N++){var Ge=pt*(Oe+A.numlines_s[N]/2)/(1*Ze.BLKSIZE_s);A.mld_cb_s[N]=U(Ge),Oe+=A.numlines_s[N]}for(;N<Ze.CBANDS;++N)A.mld_cb_s[N]=1;return 0};function T(d,A){d<-.3&&(d=3410),d/=1e3,d=Math.max(.1,d);var N=3.64*Math.pow(d,-.8)-6.8*Math.exp(-.6*Math.pow(d-3.4,2))+6*Math.exp(-.15*Math.pow(d-8.7,2))+(.6+.04*A)*.001*Math.pow(d,4);return N}this.ATHformula=function(d,A){var N;switch(A.ATHtype){case 0:N=T(d,9);break;case 1:N=T(d,-1);break;case 2:N=T(d,0);break;case 3:N=T(d,1)+6;break;case 4:N=T(d,A.ATHcurve);break;default:N=T(d,0);break}return N}}var r3=n3,i3=ul;function s3(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=i3.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var o3=s3,a3=xr(),Uh={};Uh.SFBMAX=a3.SBMAX_s*3;var Cu=Uh,Wh=zn,l3=Wh.new_float,ro=Wh.new_int,wf=Cu;function u3(){this.xr=l3(576),this.l3_enc=ro(576),this.scalefac=ro(wf.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=ro(3),this.subblock_gain=ro(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=ro(wf.SFBMAX),this.window=ro(wf.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=ro(4),this.max_nonzero_coeff=0;var t=this;function e(r){return new Int32Array(r)}function n(r){return new Float32Array(r)}this.assign=function(r){t.xr=n(r.xr),t.l3_enc=e(r.l3_enc),t.scalefac=e(r.scalefac),t.xrpow_max=r.xrpow_max,t.part2_3_length=r.part2_3_length,t.big_values=r.big_values,t.count1=r.count1,t.global_gain=r.global_gain,t.scalefac_compress=r.scalefac_compress,t.block_type=r.block_type,t.mixed_block_flag=r.mixed_block_flag,t.table_select=e(r.table_select),t.subblock_gain=e(r.subblock_gain),t.region0_count=r.region0_count,t.region1_count=r.region1_count,t.preflag=r.preflag,t.scalefac_scale=r.scalefac_scale,t.count1table_select=r.count1table_select,t.part2_length=r.part2_length,t.sfb_lmax=r.sfb_lmax,t.sfb_smin=r.sfb_smin,t.psy_lmax=r.psy_lmax,t.sfbmax=r.sfbmax,t.psymax=r.psymax,t.sfbdivide=r.sfbdivide,t.width=e(r.width),t.window=e(r.window),t.count1bits=r.count1bits,t.sfb_partition_table=r.sfb_partition_table.slice(0),t.slen=e(r.slen),t.max_nonzero_coeff=r.max_nonzero_coeff}}var yf=u3,c3=zn,jh=c3.new_int,f3=yf;function d3(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[jh(4),jh(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new f3}var h3=d3,Gh=zn,Mu=Gh.System,Ru=Gh.new_int,Lu=xr();function p3(t,e,n,r){this.l=Ru(1+Lu.SBMAX_l),this.s=Ru(1+Lu.SBMAX_s),this.psfb21=Ru(1+Lu.PSFB21),this.psfb12=Ru(1+Lu.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Mu.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),Mu.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Mu.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Mu.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var zh=p3,vf=zn,Ef=vf.new_float,m3=vf.new_float_n,_3=vf.new_int,Xh=xr();function g3(){this.last_en_subshort=m3([4,9]),this.lastAttacks=_3(4),this.pefirbuf=Ef(19),this.longfact=Ef(Xh.SBMAX_l),this.shortfact=Ef(Xh.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var b3=g3;function w3(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var y3=w3,ta=zn,v3=ta.new_byte,E3=ta.new_double,Ei=ta.new_float,io=ta.new_float_n,Ii=ta.new_int,Pu=ta.new_int_n,S3=h3,T3=zh,k3=b3,A3=y3,Yh=Dh(),tr=xr(),C3=Cu;ds.MFSIZE=3*1152+tr.ENCDELAY-tr.MDCTDELAY,ds.MAX_HEADER_BUF=256,ds.MAX_BITS_PER_CHANNEL=4095,ds.MAX_BITS_PER_GRANULE=7680,ds.BPC=320;function ds(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=io([2,ds.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new S3,this.ms_ratio=Ei(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Ii(2),this.CurrentStep=Ii(2),this.masking_lower=0,this.bv_scf=Ii(576),this.pseudohalf=Ii(C3.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*ds.BPC+1),this.itime=E3(2),this.sideinfo_len=0,this.sb_sample=io([2,2,18,tr.SBLIMIT]),this.amp_filter=Ei(32);function e(){this.write_timing=0,this.ptr=0,this.buf=v3(t)}this.header=new Array(ds.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new T3,this.minval_l=Ei(tr.CBANDS),this.minval_s=Ei(tr.CBANDS),this.nb_1=io([4,tr.CBANDS]),this.nb_2=io([4,tr.CBANDS]),this.nb_s1=io([4,tr.CBANDS]),this.nb_s2=io([4,tr.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ei(4),this.loudness_sq=io([2,2]),this.loudness_sq_save=Ei(2),this.mld_l=Ei(tr.SBMAX_l),this.mld_s=Ei(tr.SBMAX_s),this.bm_l=Ii(tr.SBMAX_l),this.bo_l=Ii(tr.SBMAX_l),this.bm_s=Ii(tr.SBMAX_s),this.bo_s=Ii(tr.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Pu([tr.CBANDS,2]),this.s3ind_s=Pu([tr.CBANDS,2]),this.numlines_s=Ii(tr.CBANDS),this.numlines_l=Ii(tr.CBANDS),this.rnumlines_l=Ei(tr.CBANDS),this.mld_cb_l=Ei(tr.CBANDS),this.mld_cb_s=Ei(tr.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ei(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Ii(2),this.nsPsy=new k3,this.VBR_seek_table=new A3,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Pu([16,5]),this.bitrate_blockType_Hist=Pu([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new Yh;for(var n=0;n<this.thm.length;n++)this.thm[n]=new Yh;for(var n=0;n<this.header.length;n++)this.header[n]=new e}var Iu=ds,M3=zn,so=M3.new_float,oo=xr();function R3(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=so(oo.SBMAX_l),this.s=so(oo.SBMAX_s),this.psfb21=so(oo.PSFB21),this.psfb12=so(oo.PSFB12),this.cb_l=so(oo.CBANDS),this.cb_s=so(oo.CBANDS),this.eql_w=so(oo.BLKSIZE/2)}var L3=R3,Kh=zn,Jr=Kh.System,qh=Kh.Arrays;nr.STEPS_per_dB=100,nr.MAX_dB=120,nr.GAIN_NOT_ENOUGH_SAMPLES=-24601,nr.GAIN_ANALYSIS_ERROR=0,nr.GAIN_ANALYSIS_OK=1,nr.INIT_GAIN_ANALYSIS_ERROR=0,nr.INIT_GAIN_ANALYSIS_OK=1,nr.YULE_ORDER=10,nr.MAX_ORDER=nr.YULE_ORDER,nr.MAX_SAMP_FREQ=48e3,nr.RMS_WINDOW_TIME_NUMERATOR=1,nr.RMS_WINDOW_TIME_DENOMINATOR=20,nr.MAX_SAMPLES_PER_WINDOW=nr.MAX_SAMP_FREQ*nr.RMS_WINDOW_TIME_NUMERATOR/nr.RMS_WINDOW_TIME_DENOMINATOR+1;function nr(){var t=64.82,e=.95,n=nr.RMS_WINDOW_TIME_NUMERATOR,r=nr.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(f,p,y,m,g,w){for(;g--!=0;)y[m]=1e-10+f[p+0]*w[0]-y[m-1]*w[1]+f[p-1]*w[2]-y[m-2]*w[3]+f[p-2]*w[4]-y[m-3]*w[5]+f[p-3]*w[6]-y[m-4]*w[7]+f[p-4]*w[8]-y[m-5]*w[9]+f[p-5]*w[10]-y[m-6]*w[11]+f[p-6]*w[12]-y[m-7]*w[13]+f[p-7]*w[14]-y[m-8]*w[15]+f[p-8]*w[16]-y[m-9]*w[17]+f[p-9]*w[18]-y[m-10]*w[19]+f[p-10]*w[20],++m,++p}function a(f,p,y,m,g,w){for(;g--!=0;)y[m]=f[p+0]*w[0]-y[m-1]*w[1]+f[p-1]*w[2]-y[m-2]*w[3]+f[p-2]*w[4],++m,++p}function l(f,p){for(var y=0;y<MAX_ORDER;y++)f.linprebuf[y]=f.lstepbuf[y]=f.loutbuf[y]=f.rinprebuf[y]=f.rstepbuf[y]=f.routbuf[y]=0;switch(0|p){case 48e3:f.reqindex=0;break;case 44100:f.reqindex=1;break;case 32e3:f.reqindex=2;break;case 24e3:f.reqindex=3;break;case 22050:f.reqindex=4;break;case 16e3:f.reqindex=5;break;case 12e3:f.reqindex=6;break;case 11025:f.reqindex=7;break;case 8e3:f.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return f.sampleWindow=0|(p*n+r-1)/r,f.lsum=0,f.rsum=0,f.totsamp=0,qh.ill(f.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(f,p){return l(f,p)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(f.linpre=MAX_ORDER,f.rinpre=MAX_ORDER,f.lstep=MAX_ORDER,f.rstep=MAX_ORDER,f.lout=MAX_ORDER,f.rout=MAX_ORDER,qh.fill(f.B,0),INIT_GAIN_ANALYSIS_OK)};function c(f){return f*f}this.AnalyzeSamples=function(f,p,y,m,g,w,_){var b,E,R,h,k,L,$;if(w==0)return GAIN_ANALYSIS_OK;switch($=0,k=w,_){case 1:m=p,g=y;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(w<MAX_ORDER?(Jr.arraycopy(p,y,f.linprebuf,MAX_ORDER,w),Jr.arraycopy(m,g,f.rinprebuf,MAX_ORDER,w)):(Jr.arraycopy(p,y,f.linprebuf,MAX_ORDER,MAX_ORDER),Jr.arraycopy(m,g,f.rinprebuf,MAX_ORDER,MAX_ORDER));k>0;){L=k>f.sampleWindow-f.totsamp?f.sampleWindow-f.totsamp:k,$<MAX_ORDER?(b=f.linpre+$,E=f.linprebuf,R=f.rinpre+$,h=f.rinprebuf,L>MAX_ORDER-$&&(L=MAX_ORDER-$)):(b=y+$,E=p,R=g+$,h=m),o(E,b,f.lstepbuf,f.lstep+f.totsamp,L,i[f.reqindex]),o(h,R,f.rstepbuf,f.rstep+f.totsamp,L,i[f.reqindex]),a(f.lstepbuf,f.lstep+f.totsamp,f.loutbuf,f.lout+f.totsamp,L,s[f.reqindex]),a(f.rstepbuf,f.rstep+f.totsamp,f.routbuf,f.rout+f.totsamp,L,s[f.reqindex]),b=f.lout+f.totsamp,E=f.loutbuf,R=f.rout+f.totsamp,h=f.routbuf;for(var P=L%8;P--!=0;)f.lsum+=c(E[b++]),f.rsum+=c(h[R++]);for(P=L/8;P--!=0;)f.lsum+=c(E[b+0])+c(E[b+1])+c(E[b+2])+c(E[b+3])+c(E[b+4])+c(E[b+5])+c(E[b+6])+c(E[b+7]),b+=8,f.rsum+=c(h[R+0])+c(h[R+1])+c(h[R+2])+c(h[R+3])+c(h[R+4])+c(h[R+5])+c(h[R+6])+c(h[R+7]),R+=8;if(k-=L,$+=L,f.totsamp+=L,f.totsamp==f.sampleWindow){var I=nr.STEPS_per_dB*10*Math.log10((f.lsum+f.rsum)/f.totsamp*.5+1e-37),H=I<=0?0:0|I;H>=f.A.length&&(H=f.A.length-1),f.A[H]++,f.lsum=f.rsum=0,Jr.arraycopy(f.loutbuf,f.totsamp,f.loutbuf,0,MAX_ORDER),Jr.arraycopy(f.routbuf,f.totsamp,f.routbuf,0,MAX_ORDER),Jr.arraycopy(f.lstepbuf,f.totsamp,f.lstepbuf,0,MAX_ORDER),Jr.arraycopy(f.rstepbuf,f.totsamp,f.rstepbuf,0,MAX_ORDER),f.totsamp=0}if(f.totsamp>f.sampleWindow)return GAIN_ANALYSIS_ERROR}return w<MAX_ORDER?(Jr.arraycopy(f.linprebuf,w,f.linprebuf,0,MAX_ORDER-w),Jr.arraycopy(f.rinprebuf,w,f.rinprebuf,0,MAX_ORDER-w),Jr.arraycopy(p,y,f.linprebuf,MAX_ORDER-w,w),Jr.arraycopy(m,g,f.rinprebuf,MAX_ORDER-w,w)):(Jr.arraycopy(p,y+w-MAX_ORDER,f.linprebuf,0,MAX_ORDER),Jr.arraycopy(m,g+w-MAX_ORDER,f.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(f,p){var y,m=0;for(y=0;y<p;y++)m+=f[y];if(m==0)return GAIN_NOT_ENOUGH_SAMPLES;var g=0|Math.ceil(m*(1-e));for(y=p;y-- >0&&!((g-=f[y])<=0););return t-y/nr.STEPS_per_dB}this.GetTitleGain=function(f){for(var p=u(f.A,f.A.length),y=0;y<f.A.length;y++)f.B[y]+=f.A[y],f.A[y]=0;for(var y=0;y<MAX_ORDER;y++)f.linprebuf[y]=f.lstepbuf[y]=f.loutbuf[y]=f.rinprebuf[y]=f.rstepbuf[y]=f.routbuf[y]=0;return f.totsamp=0,f.lsum=f.rsum=0,p}}var Zh=nr,Jh=zn,na=Jh.new_float,Qh=Jh.new_int,Qr=Zh;function P3(){this.linprebuf=na(Qr.MAX_ORDER*2),this.linpre=0,this.lstepbuf=na(Qr.MAX_SAMPLES_PER_WINDOW+Qr.MAX_ORDER),this.lstep=0,this.loutbuf=na(Qr.MAX_SAMPLES_PER_WINDOW+Qr.MAX_ORDER),this.lout=0,this.rinprebuf=na(Qr.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=na(Qr.MAX_SAMPLES_PER_WINDOW+Qr.MAX_ORDER),this.rstep=0,this.routbuf=na(Qr.MAX_SAMPLES_PER_WINDOW+Qr.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Qh(0|Qr.STEPS_per_dB*Qr.MAX_dB),this.B=Qh(0|Qr.STEPS_per_dB*Qr.MAX_dB)}var I3=P3;function B3(t){this.bits=t}var e0=B3,Sf=zn,t0=Sf.new_float,O3=Sf.new_int,n0=Sf.assert,D3=e0,r0=xr(),N3=Cu,F3=Iu;function $3(t){var e=t;this.quantize=e,this.iteration_loop=function(n,r,i,s){var o=n.internal_flags,a=t0(N3.SFBMAX),l=t0(576),c=O3(2),u=0,f,p=o.l3_side,y=new D3(u);this.quantize.rv.ResvFrameBegin(n,y),u=y.bits;for(var m=0;m<o.mode_gr;m++){f=this.quantize.qupvt.on_pe(n,r,c,u,m,m),o.mode_ext==r0.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,m),this.quantize.qupvt.reduce_side(c,i[m],u,f));for(var g=0;g<o.channels_out;g++){var w,_,b=p.tt[m][g];b.block_type!=r0.SHORT_TYPE?(w=0,_=o.PSY.mask_adjust-w):(w=0,_=o.PSY.mask_adjust_short-w),o.masking_lower=Math.pow(10,_*.1),this.quantize.init_outer_loop(o,b),this.quantize.init_xrpow(o,b,l)&&(this.quantize.qupvt.calc_xmin(n,s[m][g],b,a),this.quantize.outer_loop(n,b,a,l,g,c[g])),this.quantize.iteration_finish_one(o,m,g),n0(b.part2_3_length<=F3.MAX_BITS_PER_CHANNEL),n0(b.part2_3_length<=c[g])}}this.quantize.rv.ResvFrameEnd(o,u)}}var V3=$3;function _n(t,e,n,r){this.xlen=t,this.linmax=e,this.table=n,this.hlen=r}var ut={};ut.t1HB=[1,1,1,0],ut.t2HB=[1,2,1,3,1,1,3,2,0],ut.t3HB=[3,2,1,1,1,1,3,2,0],ut.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ut.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ut.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ut.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ut.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ut.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ut.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ut.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ut.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ut.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ut.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ut.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ut.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],ut.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],ut.t1l=[1,4,3,5],ut.t2l=[1,4,7,4,5,7,6,7,8],ut.t3l=[2,3,7,4,4,7,6,7,8],ut.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ut.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ut.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ut.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ut.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ut.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ut.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ut.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ut.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ut.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ut.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ut.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ut.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ut.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],ut.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],ut.ht=[new _n(0,0,null,null),new _n(2,0,ut.t1HB,ut.t1l),new _n(3,0,ut.t2HB,ut.t2l),new _n(3,0,ut.t3HB,ut.t3l),new _n(0,0,null,null),new _n(4,0,ut.t5HB,ut.t5l),new _n(4,0,ut.t6HB,ut.t6l),new _n(6,0,ut.t7HB,ut.t7l),new _n(6,0,ut.t8HB,ut.t8l),new _n(6,0,ut.t9HB,ut.t9l),new _n(8,0,ut.t10HB,ut.t10l),new _n(8,0,ut.t11HB,ut.t11l),new _n(8,0,ut.t12HB,ut.t12l),new _n(16,0,ut.t13HB,ut.t13l),new _n(0,0,null,ut.t16_5l),new _n(16,0,ut.t15HB,ut.t15l),new _n(1,1,ut.t16HB,ut.t16l),new _n(2,3,ut.t16HB,ut.t16l),new _n(3,7,ut.t16HB,ut.t16l),new _n(4,15,ut.t16HB,ut.t16l),new _n(6,63,ut.t16HB,ut.t16l),new _n(8,255,ut.t16HB,ut.t16l),new _n(10,1023,ut.t16HB,ut.t16l),new _n(13,8191,ut.t16HB,ut.t16l),new _n(4,15,ut.t24HB,ut.t24l),new _n(5,31,ut.t24HB,ut.t24l),new _n(6,63,ut.t24HB,ut.t24l),new _n(7,127,ut.t24HB,ut.t24l),new _n(8,255,ut.t24HB,ut.t24l),new _n(9,511,ut.t24HB,ut.t24l),new _n(11,2047,ut.t24HB,ut.t24l),new _n(13,8191,ut.t24HB,ut.t24l),new _n(0,0,ut.t32HB,ut.t32l),new _n(0,0,ut.t33HB,ut.t33l)],ut.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ut.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ut.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ut.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ut.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ut.scfsi_band=[0,6,11,16,21];var Tf=ut,kf,i0;function s0(){if(i0)return kf;i0=1;var t=zh,e=zn,n=e.VbrMode,r=e.Float,i=e.Util,s=e.new_float,o=e.new_int,a=e.assert,l=xr(),c=e0,u=Iu;f.Q_MAX=257,f.Q_MAX2=116,f.LARGE_BITS=1e5,f.IXMAX_VAL=8206;function f(){var p=Mf(),y=null,m=null,g=null;this.setModules=function(D,F,Y){y=D,m=F,g=Y};function w(D){return a(0<=D+f.Q_MAX2&&D<f.Q_MAX),$[D+f.Q_MAX2]}this.IPOW20=function(D){return a(0<=D&&D<f.Q_MAX),P[D]};var _=2220446049250313e-31,b=f.IXMAX_VAL,E=b+2,R=f.Q_MAX,h=f.Q_MAX2;f.LARGE_BITS;var k=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var L=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=L,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var $=s(R+h+1),P=s(R),I=s(E),H=s(E);this.adj43=H;function ae(D,F){var Y=g.ATHformula(F,D);return Y-=k,Y=Math.pow(10,Y/10+D.ATHlower),Y}function V(D){for(var F=D.internal_flags.ATH.l,Y=D.internal_flags.ATH.psfb21,K=D.internal_flags.ATH.s,Q=D.internal_flags.ATH.psfb12,W=D.internal_flags,O=D.out_samplerate,C=0;C<l.SBMAX_l;C++){var S=W.scalefac_band.l[C],M=W.scalefac_band.l[C+1];F[C]=r.MAX_VALUE;for(var X=S;X<M;X++){var ie=X*O/1152,G=ae(D,ie);F[C]=Math.min(F[C],G)}}for(var C=0;C<l.PSFB21;C++){var S=W.scalefac_band.psfb21[C],M=W.scalefac_band.psfb21[C+1];Y[C]=r.MAX_VALUE;for(var X=S;X<M;X++){var ie=X*O/1152,G=ae(D,ie);Y[C]=Math.min(Y[C],G)}}for(var C=0;C<l.SBMAX_s;C++){var S=W.scalefac_band.s[C],M=W.scalefac_band.s[C+1];K[C]=r.MAX_VALUE;for(var X=S;X<M;X++){var ie=X*O/384,G=ae(D,ie);K[C]=Math.min(K[C],G)}K[C]*=W.scalefac_band.s[C+1]-W.scalefac_band.s[C]}for(var C=0;C<l.PSFB12;C++){var S=W.scalefac_band.psfb12[C],M=W.scalefac_band.psfb12[C+1];Q[C]=r.MAX_VALUE;for(var X=S;X<M;X++){var ie=X*O/384,G=ae(D,ie);Q[C]=Math.min(Q[C],G)}Q[C]*=W.scalefac_band.s[13]-W.scalefac_band.s[12]}if(D.noATH){for(var C=0;C<l.SBMAX_l;C++)F[C]=1e-20;for(var C=0;C<l.PSFB21;C++)Y[C]=1e-20;for(var C=0;C<l.SBMAX_s;C++)K[C]=1e-20;for(var C=0;C<l.PSFB12;C++)Q[C]=1e-20}W.ATH.floor=10*Math.log10(ae(D,-1))}this.iteration_init=function(D){var F=D.internal_flags,Y=F.l3_side,K;if(F.iteration_init_init==0){for(F.iteration_init_init=1,Y.main_data_begin=0,V(D),I[0]=0,K=1;K<E;K++)I[K]=Math.pow(K,4/3);for(K=0;K<E-1;K++)H[K]=K+1-Math.pow(.5*(I[K]+I[K+1]),.75);for(H[K]=.5,K=0;K<R;K++)P[K]=Math.pow(2,(K-210)*-.1875);for(K=0;K<=R+h;K++)$[K]=Math.pow(2,(K-210-h)*.25);y.huffman_init(F);{var Q,W,O,C;for(K=D.exp_nspsytune>>2&63,K>=32&&(K-=64),Q=Math.pow(10,K/4/10),K=D.exp_nspsytune>>8&63,K>=32&&(K-=64),W=Math.pow(10,K/4/10),K=D.exp_nspsytune>>14&63,K>=32&&(K-=64),O=Math.pow(10,K/4/10),K=D.exp_nspsytune>>20&63,K>=32&&(K-=64),C=O*Math.pow(10,K/4/10),K=0;K<l.SBMAX_l;K++){var S;K<=6?S=Q:K<=13?S=W:K<=20?S=O:S=C,F.nsPsy.longfact[K]=S}for(K=0;K<l.SBMAX_s;K++){var S;K<=5?S=Q:K<=10?S=W:K<=11?S=O:S=C,F.nsPsy.shortfact[K]=S}}}},this.on_pe=function(D,F,Y,K,Q,W){var O=D.internal_flags,C=0,S,M=o(2),X,ie=new c(C),G=m.ResvMaxBits(D,K,ie,W);C=ie.bits;var z=C+G;for(z>u.MAX_BITS_PER_GRANULE&&(z=u.MAX_BITS_PER_GRANULE),S=0,X=0;X<O.channels_out;++X)Y[X]=Math.min(u.MAX_BITS_PER_CHANNEL,C/O.channels_out),M[X]=0|Y[X]*F[Q][X]/700-Y[X],M[X]>K*3/4&&(M[X]=K*3/4),M[X]<0&&(M[X]=0),M[X]+Y[X]>u.MAX_BITS_PER_CHANNEL&&(M[X]=Math.max(0,u.MAX_BITS_PER_CHANNEL-Y[X])),S+=M[X];if(S>G)for(X=0;X<O.channels_out;++X)M[X]=G*M[X]/S;for(X=0;X<O.channels_out;++X)Y[X]+=M[X],G-=M[X];for(S=0,X=0;X<O.channels_out;++X)S+=Y[X];if(S>u.MAX_BITS_PER_GRANULE){var le=0;for(X=0;X<O.channels_out;++X)Y[X]*=u.MAX_BITS_PER_GRANULE,Y[X]/=S,le+=Y[X]}return z},this.reduce_side=function(D,F,Y,K){a(D[0]+D[1]<=u.MAX_BITS_PER_GRANULE);var Q=.33*(.5-F)/.5;Q<0&&(Q=0),Q>.5&&(Q=.5);var W=0|Q*.5*(D[0]+D[1]);W>u.MAX_BITS_PER_CHANNEL-D[0]&&(W=u.MAX_BITS_PER_CHANNEL-D[0]),W<0&&(W=0),D[1]>=125&&(D[1]-W>125?(D[0]<Y&&(D[0]+=W),D[1]-=W):(D[0]+=D[1]-125,D[1]=125)),W=D[0]+D[1],W>K&&(D[0]=K*D[0]/W,D[1]=K*D[1]/W),a(D[0]<=u.MAX_BITS_PER_CHANNEL),a(D[1]<=u.MAX_BITS_PER_CHANNEL),a(D[0]+D[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(D,F,Y){var K=90.30873362,Q=94.82444863,W=i.FAST_LOG10_X(F,10),O=D*D,C=0;return W-=Y,O>1e-20&&(C=1+i.FAST_LOG10_X(O,10/K)),C<0&&(C=0),W*=C,W+=Y+K-Q,Math.pow(10,.1*W)},this.calc_xmin=function(D,F,Y,K){var Q=0,W=D.internal_flags,O,C=0,S=0,M=W.ATH,X=Y.xr,ie=D.VBR==n.vbr_mtrh?1:0,G=W.masking_lower;for((D.VBR==n.vbr_mtrh||D.VBR==n.vbr_mt)&&(G=1),O=0;O<Y.psy_lmax;O++){var z,le,Me,_e,Ae,Ee;D.VBR==n.vbr_rh||D.VBR==n.vbr_mtrh?le=athAdjust(M.adjust,M.l[O],M.floor):le=M.adjust*M.l[O],Ae=Y.width[O],Me=le/Ae,_e=_,Ee=Ae>>1,z=0;do{var Ve,Te;Ve=X[C]*X[C],z+=Ve,_e+=Ve<Me?Ve:Me,C++,Te=X[C]*X[C],z+=Te,_e+=Te<Me?Te:Me,C++}while(--Ee>0);if(z>le&&S++,O==l.SBPSY_l){var Le=le*W.nsPsy.longfact[O];_e<Le&&(_e=Le)}if(ie!=0&&(le=_e),!D.ATHonly){var Ie=F.en.l[O];if(Ie>0){var Le;Le=z*F.thm.l[O]*G/Ie,ie!=0&&(Le*=W.nsPsy.longfact[O]),le<Le&&(le=Le)}}ie!=0?K[Q++]=le:K[Q++]=le*W.nsPsy.longfact[O]}var et=575;if(Y.block_type!=l.SHORT_TYPE)for(var B=576;B--!=0&&p.EQ(X[B],0);)et=B;Y.max_nonzero_coeff=et;for(var x=Y.sfb_smin;O<Y.psymax;x++,O+=3){var Ae,Ne,We;for(D.VBR==n.vbr_rh||D.VBR==n.vbr_mtrh?We=athAdjust(M.adjust,M.s[x],M.floor):We=M.adjust*M.s[x],Ae=Y.width[O],Ne=0;Ne<3;Ne++){var z=0,le,Me,_e,Ee=Ae>>1;Me=We/Ae,_e=_;do{var Ve,Te;Ve=X[C]*X[C],z+=Ve,_e+=Ve<Me?Ve:Me,C++,Te=X[C]*X[C],z+=Te,_e+=Te<Me?Te:Me,C++}while(--Ee>0);if(z>We&&S++,x==l.SBPSY_s){var Le=We*W.nsPsy.shortfact[x];_e<Le&&(_e=Le)}if(ie!=0?le=_e:le=We,!D.ATHonly&&!D.ATHshort){var Ie=F.en.s[x][Ne];if(Ie>0){var Le;Le=z*F.thm.s[x][Ne]*G/Ie,ie!=0&&(Le*=W.nsPsy.shortfact[x]),le<Le&&(le=Le)}}ie!=0?K[Q++]=le:K[Q++]=le*W.nsPsy.shortfact[x]}D.useTemporal&&(K[Q-3]>K[Q-3+1]&&(K[Q-3+1]+=(K[Q-3]-K[Q-3+1])*W.decay),K[Q-3+1]>K[Q-3+2]&&(K[Q-3+2]+=(K[Q-3+1]-K[Q-3+2])*W.decay))}return S};function v(D){this.s=D}this.calc_noise_core=function(D,F,Y,K){var Q=0,W=F.s,O=D.l3_enc;if(W>D.count1)for(;Y--!=0;){var C;C=D.xr[W],W++,Q+=C*C,C=D.xr[W],W++,Q+=C*C}else if(W>D.big_values){var S=s(2);for(S[0]=0,S[1]=K;Y--!=0;){var C;C=Math.abs(D.xr[W])-S[O[W]],W++,Q+=C*C,C=Math.abs(D.xr[W])-S[O[W]],W++,Q+=C*C}}else for(;Y--!=0;){var C;C=Math.abs(D.xr[W])-I[O[W]]*K,W++,Q+=C*C,C=Math.abs(D.xr[W])-I[O[W]]*K,W++,Q+=C*C}return F.s=W,Q},this.calc_noise=function(D,F,Y,K,Q){var W=0,O=0,C,S,M=0,X=0,ie=0,G=-20,z=0,le=D.scalefac,Me=0;for(K.over_SSD=0,C=0;C<D.psymax;C++){var _e=D.global_gain-(le[Me++]+(D.preflag!=0?L[C]:0)<<D.scalefac_scale+1)-D.subblock_gain[D.window[C]]*8,Ae=0;if(Q!=null&&Q.step[C]==_e)Ae=Q.noise[C],z+=D.width[C],Y[W++]=Ae/F[O++],Ae=Q.noise_log[C];else{var Ee=w(_e);if(S=D.width[C]>>1,z+D.width[C]>D.max_nonzero_coeff){var Ve;Ve=D.max_nonzero_coeff-z+1,Ve>0?S=Ve>>1:S=0}var Te=new v(z);Ae=this.calc_noise_core(D,Te,S,Ee),z=Te.s,Q!=null&&(Q.step[C]=_e,Q.noise[C]=Ae),Ae=Y[W++]=Ae/F[O++],Ae=i.FAST_LOG10(Math.max(Ae,1e-20)),Q!=null&&(Q.noise_log[C]=Ae)}if(Q!=null&&(Q.global_gain=D.global_gain),ie+=Ae,Ae>0){var Le;Le=Math.max(0|Ae*10+.5,1),K.over_SSD+=Le*Le,M++,X+=Ae}G=Math.max(G,Ae)}return K.over_count=M,K.tot_noise=ie,K.over_noise=X,K.max_noise=G,M},this.set_pinfo=function(D,F,Y,K,Q){var W=D.internal_flags,O,C,S,M,X,ie=F.scalefac_scale==0?.5:1,G=F.scalefac,z=s(L3Side.SFBMAX),le=s(L3Side.SFBMAX),Me=new CalcNoiseResult;calc_xmin(D,Y,F,z),calc_noise(F,z,le,Me,null);var _e=0;for(C=F.sfb_lmax,F.block_type!=l.SHORT_TYPE&&F.mixed_block_flag==0&&(C=22),O=0;O<C;O++){var Ae=W.scalefac_band.l[O],Ee=W.scalefac_band.l[O+1],Ve=Ee-Ae;for(M=0;_e<Ee;_e++)M+=F.xr[_e]*F.xr[_e];M/=Ve,X=1e15,W.pinfo.en[K][Q][O]=X*M,W.pinfo.xfsf[K][Q][O]=X*z[O]*le[O]/Ve,Y.en.l[O]>0&&!D.ATHonly?M=M/Y.en.l[O]:M=0,W.pinfo.thr[K][Q][O]=X*Math.max(M*Y.thm.l[O],W.ATH.l[O]),W.pinfo.LAMEsfb[K][Q][O]=0,F.preflag!=0&&O>=11&&(W.pinfo.LAMEsfb[K][Q][O]=-ie*L[O]),O<l.SBPSY_l&&(a(G[O]>=0),W.pinfo.LAMEsfb[K][Q][O]-=ie*G[O])}if(F.block_type==l.SHORT_TYPE)for(C=O,O=F.sfb_smin;O<l.SBMAX_s;O++)for(var Ae=W.scalefac_band.s[O],Ee=W.scalefac_band.s[O+1],Ve=Ee-Ae,Te=0;Te<3;Te++){for(M=0,S=Ae;S<Ee;S++)M+=F.xr[_e]*F.xr[_e],_e++;M=Math.max(M/Ve,1e-20),X=1e15,W.pinfo.en_s[K][Q][3*O+Te]=X*M,W.pinfo.xfsf_s[K][Q][3*O+Te]=X*z[C]*le[C]/Ve,Y.en.s[O][Te]>0?M=M/Y.en.s[O][Te]:M=0,(D.ATHonly||D.ATHshort)&&(M=0),W.pinfo.thr_s[K][Q][3*O+Te]=X*Math.max(M*Y.thm.s[O][Te],W.ATH.s[O]),W.pinfo.LAMEsfb_s[K][Q][3*O+Te]=-2*F.subblock_gain[Te],O<l.SBPSY_s&&(W.pinfo.LAMEsfb_s[K][Q][3*O+Te]-=ie*G[C]),C++}W.pinfo.LAMEqss[K][Q]=F.global_gain,W.pinfo.LAMEmainbits[K][Q]=F.part2_3_length+F.part2_length,W.pinfo.LAMEsfbits[K][Q]=F.part2_length,W.pinfo.over[K][Q]=Me.over_count,W.pinfo.max_noise[K][Q]=Me.max_noise*10,W.pinfo.over_noise[K][Q]=Me.over_noise*10,W.pinfo.tot_noise[K][Q]=Me.tot_noise*10,W.pinfo.over_SSD[K][Q]=Me.over_SSD}}return kf=f,kf}var Af,o0;function a0(){if(o0)return Af;o0=1;var t=zn,e=t.System,n=t.Arrays,r=t.new_int,i=t.assert,s=xr(),o=Tf,a=yf,l=s0();function c(){var u=null;this.qupvt=null,this.setModules=function(W){this.qupvt=W,u=W};function f(W){this.bits=0|W}var p=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function y(W,O,C,S,M,X){var ie=.5946/O;for(W=W>>1;W--!=0;)M[X++]=ie>C[S++]?0:1,M[X++]=ie>C[S++]?0:1}function m(W,O,C,S,M,X){W=W>>1;var ie=W%2;for(W=W>>1;W--!=0;){var G,z,le,Me,_e,Ae,Ee,Ve;G=C[S++]*O,z=C[S++]*O,_e=0|G,le=C[S++]*O,Ae=0|z,Me=C[S++]*O,Ee=0|le,G+=u.adj43[_e],Ve=0|Me,z+=u.adj43[Ae],M[X++]=0|G,le+=u.adj43[Ee],M[X++]=0|z,Me+=u.adj43[Ve],M[X++]=0|le,M[X++]=0|Me}if(ie!=0){var G,z,_e,Ae;G=C[S++]*O,z=C[S++]*O,_e=0|G,Ae=0|z,G+=u.adj43[_e],z+=u.adj43[Ae],M[X++]=0|G,M[X++]=0|z}}function g(W,O,C,S,M){var X,ie,G=0,z,le=0,Me=0,_e=0,Ae=O,Ee=0,Ve=Ae,Te=0,Le=W,Ie=0;for(z=M!=null&&S.global_gain==M.global_gain,S.block_type==s.SHORT_TYPE?ie=38:ie=21,X=0;X<=ie;X++){var et=-1;if((z||S.block_type==s.NORM_TYPE)&&(et=S.global_gain-(S.scalefac[X]+(S.preflag!=0?u.pretab[X]:0)<<S.scalefac_scale+1)-S.subblock_gain[S.window[X]]*8),i(S.width[X]>=0),z&&M.step[X]==et)le!=0&&(m(le,C,Le,Ie,Ve,Te),le=0),Me!=0&&(y(Me,C,Le,Ie,Ve,Te),Me=0);else{var B=S.width[X];if(G+S.width[X]>S.max_nonzero_coeff){var x;x=S.max_nonzero_coeff-G+1,n.fill(O,S.max_nonzero_coeff,576,0),B=x,B<0&&(B=0),X=ie+1}if(le==0&&Me==0&&(Ve=Ae,Te=Ee,Le=W,Ie=_e),M!=null&&M.sfb_count1>0&&X>=M.sfb_count1&&M.step[X]>0&&et>=M.step[X]?(le!=0&&(m(le,C,Le,Ie,Ve,Te),le=0,Ve=Ae,Te=Ee,Le=W,Ie=_e),Me+=B):(Me!=0&&(y(Me,C,Le,Ie,Ve,Te),Me=0,Ve=Ae,Te=Ee,Le=W,Ie=_e),le+=B),B<=0){Me!=0&&(y(Me,C,Le,Ie,Ve,Te),Me=0),le!=0&&(m(le,C,Le,Ie,Ve,Te),le=0);break}}X<=ie&&(Ee+=S.width[X],_e+=S.width[X],G+=S.width[X])}le!=0&&(m(le,C,Le,Ie,Ve,Te),le=0),Me!=0&&(y(Me,C,Le,Ie,Ve,Te),Me=0)}function w(W,O,C){var S=0,M=0;do{var X=W[O++],ie=W[O++];S<X&&(S=X),M<ie&&(M=ie)}while(O<C);return S<M&&(S=M),S}function _(W,O,C,S,M,X){var ie=o.ht[S].xlen*65536+o.ht[M].xlen,G=0,z;do{var le=W[O++],Me=W[O++];le!=0&&(le>14&&(le=15,G+=ie),le*=16),Me!=0&&(Me>14&&(Me=15,G+=ie),le+=Me),G+=o.largetbl[le]}while(O<C);return z=G&65535,G>>=16,G>z&&(G=z,S=M),X.bits+=G,S}function b(W,O,C,S){var M=0,X=o.ht[1].hlen;do{var ie=W[O+0]*2+W[O+1];O+=2,M+=X[ie]}while(O<C);return S.bits+=M,1}function E(W,O,C,S,M){var X=0,ie,G=o.ht[S].xlen,z;S==2?z=o.table23:z=o.table56;do{var le=W[O+0]*G+W[O+1];O+=2,X+=z[le]}while(O<C);return ie=X&65535,X>>=16,X>ie&&(X=ie,S++),M.bits+=X,S}function R(W,O,C,S,M){var X=0,ie=0,G=0,z=o.ht[S].xlen,le=o.ht[S].hlen,Me=o.ht[S+1].hlen,_e=o.ht[S+2].hlen;do{var Ae=W[O+0]*z+W[O+1];O+=2,X+=le[Ae],ie+=Me[Ae],G+=_e[Ae]}while(O<C);var Ee=S;return X>ie&&(X=ie,Ee++),X>G&&(X=G,Ee=S+2),M.bits+=X,Ee}var h=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function k(W,O,C,S){var M=w(W,O,C);switch(M){case 0:return M;case 1:return b(W,O,C,S);case 2:case 3:return E(W,O,C,h[M-1],S);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return R(W,O,C,h[M-1],S);default:if(M>l.IXMAX_VAL)return S.bits=l.LARGE_BITS,-1;M-=15;var X;for(X=24;X<32&&!(o.ht[X].linmax>=M);X++);var ie;for(ie=X-8;ie<24&&!(o.ht[ie].linmax>=M);ie++);return _(W,O,C,ie,X,S)}}this.noquant_count_bits=function(W,O,C){var S=O.l3_enc,M=Math.min(576,O.max_nonzero_coeff+2>>1<<1);for(C!=null&&(C.sfb_count1=0);M>1&&!(S[M-1]|S[M-2]);M-=2);O.count1=M;for(var X=0,ie=0;M>3;M-=4){var G;if(((S[M-1]|S[M-2]|S[M-3]|S[M-4])&2147483647)>1)break;G=((S[M-4]*2+S[M-3])*2+S[M-2])*2+S[M-1],X+=o.t32l[G],ie+=o.t33l[G]}var z=X;if(O.count1table_select=0,X>ie&&(z=ie,O.count1table_select=1),O.count1bits=z,O.big_values=M,M==0)return z;if(O.block_type==s.SHORT_TYPE)X=3*W.scalefac_band.s[3],X>O.big_values&&(X=O.big_values),ie=O.big_values;else if(O.block_type==s.NORM_TYPE){if(X=O.region0_count=W.bv_scf[M-2],ie=O.region1_count=W.bv_scf[M-1],i(X+ie+2<s.SBPSY_l),ie=W.scalefac_band.l[X+ie+2],X=W.scalefac_band.l[X+1],ie<M){var le=new f(z);O.table_select[2]=k(S,ie,M,le),z=le.bits}}else O.region0_count=7,O.region1_count=s.SBMAX_l-1-7-1,X=W.scalefac_band.l[8],ie=M,X>ie&&(X=ie);if(X=Math.min(X,M),ie=Math.min(ie,M),0<X){var le=new f(z);O.table_select[0]=k(S,0,X,le),z=le.bits}if(X<ie){var le=new f(z);O.table_select[1]=k(S,X,ie,le),z=le.bits}if(W.use_best_huffman==2&&(O.part2_3_length=z,best_huffman_divide(W,O),z=O.part2_3_length),C!=null&&O.block_type==s.NORM_TYPE){for(var Me=0;W.scalefac_band.l[Me]<O.big_values;)Me++;C.sfb_count1=Me}return z},this.count_bits=function(W,O,C,S){var M=C.l3_enc,X=l.IXMAX_VAL/u.IPOW20(C.global_gain);if(C.xrpow_max>X)return l.LARGE_BITS;if(g(O,M,u.IPOW20(C.global_gain),C,S),W.substep_shaping&2)for(var ie=0,G=C.global_gain+C.scalefac_scale,z=.634521682242439/u.IPOW20(G),le=0;le<C.sfbmax;le++){var Me=C.width[le];if(W.pseudohalf[le]==0)ie+=Me;else{var _e;for(_e=ie,ie+=Me;_e<ie;++_e)M[_e]=O[_e]>=z?M[_e]:0}}return this.noquant_count_bits(W,C,S)};function L(W,O,C,S,M,X,ie){for(var G=O.big_values,z=0;z<=22;z++)S[z]=l.LARGE_BITS;for(var z=0;z<16;z++){var le=W.scalefac_band.l[z+1];if(le>=G)break;var Me=0,_e=new f(Me),Ae=k(C,0,le,_e);Me=_e.bits;for(var Ee=0;Ee<8;Ee++){var Ve=W.scalefac_band.l[z+Ee+2];if(Ve>=G)break;var Te=Me;_e=new f(Te);var Le=k(C,le,Ve,_e);Te=_e.bits,S[z+Ee]>Te&&(S[z+Ee]=Te,M[z+Ee]=z,X[z+Ee]=Ae,ie[z+Ee]=Le)}}}function $(W,O,C,S,M,X,ie,G){for(var z=O.big_values,le=2;le<s.SBMAX_l+1;le++){var Me=W.scalefac_band.l[le];if(Me>=z)break;var _e=M[le-2]+O.count1bits;if(C.part2_3_length<=_e)break;var Ae=new f(_e),Ee=k(S,Me,z,Ae);_e=Ae.bits,!(C.part2_3_length<=_e)&&(C.assign(O),C.part2_3_length=_e,C.region0_count=X[le-2],C.region1_count=le-2-X[le-2],C.table_select[0]=ie[le-2],C.table_select[1]=G[le-2],C.table_select[2]=Ee)}}this.best_huffman_divide=function(W,O){var C=new a,S=O.l3_enc,M=r(23),X=r(23),ie=r(23),G=r(23);if(!(O.block_type==s.SHORT_TYPE&&W.mode_gr==1)){C.assign(O),O.block_type==s.NORM_TYPE&&(L(W,O,S,M,X,ie,G),$(W,C,O,S,M,X,ie,G));var z=C.big_values;if(!(z==0||(S[z-2]|S[z-1])>1)&&(z=O.count1+2,!(z>576))){C.assign(O),C.count1=z;for(var le=0,Me=0;z>C.big_values;z-=4){var _e=((S[z-4]*2+S[z-3])*2+S[z-2])*2+S[z-1];le+=o.t32l[_e],Me+=o.t33l[_e]}if(C.big_values=z,C.count1table_select=0,le>Me&&(le=Me,C.count1table_select=1),C.count1bits=le,C.block_type==s.NORM_TYPE)$(W,C,O,S,M,X,ie,G);else{if(C.part2_3_length=le,le=W.scalefac_band.l[8],le>z&&(le=z),le>0){var Ae=new f(C.part2_3_length);C.table_select[0]=k(S,0,le,Ae),C.part2_3_length=Ae.bits}if(z>le){var Ae=new f(C.part2_3_length);C.table_select[1]=k(S,le,z,Ae),C.part2_3_length=Ae.bits}O.part2_3_length>C.part2_3_length&&O.assign(C)}}}};var P=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],I=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],H=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],ae=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];c.slen1_tab=H,c.slen2_tab=ae;function V(W,O){for(var C,S=O.tt[1][W],M=O.tt[0][W],X=0;X<o.scfsi_band.length-1;X++){for(C=o.scfsi_band[X];C<o.scfsi_band[X+1]&&!(M.scalefac[C]!=S.scalefac[C]&&S.scalefac[C]>=0);C++);if(C==o.scfsi_band[X+1]){for(C=o.scfsi_band[X];C<o.scfsi_band[X+1];C++)S.scalefac[C]=-1;O.scfsi[W][X]=1}}var ie=0,G=0;for(C=0;C<11;C++)S.scalefac[C]!=-1&&(G++,ie<S.scalefac[C]&&(ie=S.scalefac[C]));for(var z=0,le=0;C<s.SBPSY_l;C++)S.scalefac[C]!=-1&&(le++,z<S.scalefac[C]&&(z=S.scalefac[C]));for(var X=0;X<16;X++)if(ie<P[X]&&z<I[X]){var Me=H[X]*G+ae[X]*le;S.part2_length>Me&&(S.part2_length=Me,S.scalefac_compress=X)}}this.best_scalefac_store=function(W,O,C,S){var M=S.tt[O][C],X,ie,G,z,le=0;for(G=0,X=0;X<M.sfbmax;X++){var Me=M.width[X];for(G+=Me,z=-Me;z<0&&M.l3_enc[z+G]==0;z++);z==0&&(M.scalefac[X]=le=-2)}if(M.scalefac_scale==0&&M.preflag==0){var _e=0;for(X=0;X<M.sfbmax;X++)M.scalefac[X]>0&&(_e|=M.scalefac[X]);if(!(_e&1)&&_e!=0){for(X=0;X<M.sfbmax;X++)M.scalefac[X]>0&&(M.scalefac[X]>>=1);M.scalefac_scale=le=1}}if(M.preflag==0&&M.block_type!=s.SHORT_TYPE&&W.mode_gr==2){for(X=11;X<s.SBPSY_l&&!(M.scalefac[X]<u.pretab[X]&&M.scalefac[X]!=-2);X++);if(X==s.SBPSY_l){for(X=11;X<s.SBPSY_l;X++)M.scalefac[X]>0&&(M.scalefac[X]-=u.pretab[X]);M.preflag=le=1}}for(ie=0;ie<4;ie++)S.scfsi[C][ie]=0;for(W.mode_gr==2&&O==1&&S.tt[0][C].block_type!=s.SHORT_TYPE&&S.tt[1][C].block_type!=s.SHORT_TYPE&&(V(C,S),le=0),X=0;X<M.sfbmax;X++)M.scalefac[X]==-2&&(M.scalefac[X]=0);le!=0&&(W.mode_gr==2?this.scale_bitcount(M):this.scale_bitcount_lsf(W,M))};function v(W,O){for(var C=0;C<O;++C)if(W[C]<0)return!1;return!0}var D=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],F=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],Y=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(W){var O,C,S=0,M=0,X,ie=W.scalefac;if(i(v(ie,W.sfbmax)),W.block_type==s.SHORT_TYPE)X=D,W.mixed_block_flag!=0&&(X=F);else if(X=Y,W.preflag==0){for(C=11;C<s.SBPSY_l&&!(ie[C]<u.pretab[C]);C++);if(C==s.SBPSY_l)for(W.preflag=1,C=11;C<s.SBPSY_l;C++)ie[C]-=u.pretab[C]}for(C=0;C<W.sfbdivide;C++)S<ie[C]&&(S=ie[C]);for(;C<W.sfbmax;C++)M<ie[C]&&(M=ie[C]);for(W.part2_length=l.LARGE_BITS,O=0;O<16;O++)S<P[O]&&M<I[O]&&W.part2_length>X[O]&&(W.part2_length=X[O],W.scalefac_compress=O);return W.part2_length==l.LARGE_BITS};var K=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(W,O){var C,S,M,X,ie,G,z,le,Me=r(4),_e=O.scalefac;for(O.preflag!=0?C=2:C=0,z=0;z<4;z++)Me[z]=0;if(O.block_type==s.SHORT_TYPE){S=1;var Ae=u.nr_of_sfb_block[C][S];for(le=0,M=0;M<4;M++)for(X=Ae[M]/3,z=0;z<X;z++,le++)for(ie=0;ie<3;ie++)_e[le*3+ie]>Me[M]&&(Me[M]=_e[le*3+ie])}else{S=0;var Ae=u.nr_of_sfb_block[C][S];for(le=0,M=0;M<4;M++)for(X=Ae[M],z=0;z<X;z++,le++)_e[le]>Me[M]&&(Me[M]=_e[le])}for(G=!1,M=0;M<4;M++)Me[M]>K[C][M]&&(G=!0);if(!G){var Ee,Ve,Te,Le;for(O.sfb_partition_table=u.nr_of_sfb_block[C][S],M=0;M<4;M++)O.slen[M]=Q[Me[M]];switch(Ee=O.slen[0],Ve=O.slen[1],Te=O.slen[2],Le=O.slen[3],C){case 0:O.scalefac_compress=(Ee*5+Ve<<4)+(Te<<2)+Le;break;case 1:O.scalefac_compress=400+(Ee*5+Ve<<2)+Te;break;case 2:O.scalefac_compress=500+Ee*3+Ve;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!G)for(i(O.sfb_partition_table!=null),O.part2_length=0,M=0;M<4;M++)O.part2_length+=O.slen[M]*O.sfb_partition_table[M];return G};var Q=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(W){for(var O=2;O<=576;O+=2){for(var C=0,S;W.scalefac_band.l[++C]<O;);for(S=p[C][0];W.scalefac_band.l[S+1]>O;)S--;for(S<0&&(S=p[C][0]),W.bv_scf[O-2]=S,S=p[C][1];W.scalefac_band.l[S+W.bv_scf[O-2]+2]>O;)S--;S<0&&(S=p[C][1]),W.bv_scf[O-1]=S}}}return Af=c,Af}var Cf,l0;function Mf(){if(l0)return Cf;l0=1;var t=zn,e=t.System,n=t.Arrays,r=t.new_byte,i=t.new_float_n,s=t.new_int,o=t.assert,a=a0(),l=Tf,c=xr(),u=Iu;f.EQ=function(p,y){return Math.abs(p)>Math.abs(y)?Math.abs(p-y)<=Math.abs(p)*1e-6:Math.abs(p-y)<=Math.abs(y)*1e-6},f.NEQ=function(p,y){return!f.EQ(p,y)};function f(){var p=Lf(),y=this,m=32773,g=null,w=null,_=null,b=null;this.setModules=function(O,C,S,M){g=O,w=C,_=S,b=M};var E=null,R=0,h=0,k=0;this.getframebits=function(O){var C=O.internal_flags,S;C.bitrate_index!=0?S=l.bitrate_table[O.version][C.bitrate_index]:S=O.brate;var M=0|(O.version+1)*72e3*S/O.out_samplerate+C.padding;return 8*M};function L(O){e.arraycopy(O.header[O.w_ptr].buf,0,E,h,O.sideinfo_len),h+=O.sideinfo_len,R+=O.sideinfo_len*8,O.w_ptr=O.w_ptr+1&u.MAX_HEADER_BUF-1}function $(O,C,S){for(;S>0;){var M;k==0&&(k=8,h++,o(h<p.LAME_MAXMP3BUFFER),o(O.header[O.w_ptr].write_timing>=R),O.header[O.w_ptr].write_timing==R&&L(O),E[h]=0),M=Math.min(S,k),S-=M,k-=M,E[h]|=C>>S<<k,R+=M}}function P(O,C,S){for(;S>0;){var M;k==0&&(k=8,h++,o(h<p.LAME_MAXMP3BUFFER),E[h]=0),M=Math.min(S,k),S-=M,k-=M,E[h]|=C>>S<<k,R+=M}}function I(O,C){var S=O.internal_flags,M;if(C>=8&&($(S,76,8),C-=8),C>=8&&($(S,65,8),C-=8),C>=8&&($(S,77,8),C-=8),C>=8&&($(S,69,8),C-=8),C>=32){var X=_.getLameShortVersion();if(C>=32)for(M=0;M<X.length&&C>=8;++M)C-=8,$(S,X.charAt(M),8)}for(;C>=1;C-=1)$(S,S.ancillary_flag,1),S.ancillary_flag^=O.disable_reservoir?0:1}function H(O,C,S){for(var M=O.header[O.h_ptr].ptr;S>0;){var X=Math.min(S,8-(M&7));S-=X,O.header[O.h_ptr].buf[M>>3]|=C>>S<<8-(M&7)-X,M+=X}O.header[O.h_ptr].ptr=M}function ae(O,C){O<<=8;for(var S=0;S<8;S++)O<<=1,C<<=1,(C^O)&65536&&(C^=m);return C}this.CRC_writeheader=function(O,C){var S=65535;S=ae(C[2]&255,S),S=ae(C[3]&255,S);for(var M=6;M<O.sideinfo_len;M++)S=ae(C[M]&255,S);C[4]=byte(S>>8),C[5]=byte(S&255)};function V(O,C){var S=O.internal_flags,M,X,ie;if(M=S.l3_side,S.header[S.h_ptr].ptr=0,n.fill(S.header[S.h_ptr].buf,0,S.sideinfo_len,0),O.out_samplerate<16e3?H(S,4094,12):H(S,4095,12),H(S,O.version,1),H(S,1,2),H(S,O.error_protection?0:1,1),H(S,S.bitrate_index,4),H(S,S.samplerate_index,2),H(S,S.padding,1),H(S,O.extension,1),H(S,O.mode.ordinal(),2),H(S,S.mode_ext,2),H(S,O.copyright,1),H(S,O.original,1),H(S,O.emphasis,2),O.error_protection&&H(S,0,16),O.version==1){for(o(M.main_data_begin>=0),H(S,M.main_data_begin,9),S.channels_out==2?H(S,M.private_bits,3):H(S,M.private_bits,5),ie=0;ie<S.channels_out;ie++){var G;for(G=0;G<4;G++)H(S,M.scfsi[ie][G],1)}for(X=0;X<2;X++)for(ie=0;ie<S.channels_out;ie++){var z=M.tt[X][ie];H(S,z.part2_3_length+z.part2_length,12),H(S,z.big_values/2,9),H(S,z.global_gain,8),H(S,z.scalefac_compress,4),z.block_type!=c.NORM_TYPE?(H(S,1,1),H(S,z.block_type,2),H(S,z.mixed_block_flag,1),z.table_select[0]==14&&(z.table_select[0]=16),H(S,z.table_select[0],5),z.table_select[1]==14&&(z.table_select[1]=16),H(S,z.table_select[1],5),H(S,z.subblock_gain[0],3),H(S,z.subblock_gain[1],3),H(S,z.subblock_gain[2],3)):(H(S,0,1),z.table_select[0]==14&&(z.table_select[0]=16),H(S,z.table_select[0],5),z.table_select[1]==14&&(z.table_select[1]=16),H(S,z.table_select[1],5),z.table_select[2]==14&&(z.table_select[2]=16),H(S,z.table_select[2],5),o(0<=z.region0_count&&z.region0_count<16),o(0<=z.region1_count&&z.region1_count<8),H(S,z.region0_count,4),H(S,z.region1_count,3)),H(S,z.preflag,1),H(S,z.scalefac_scale,1),H(S,z.count1table_select,1)}}else for(o(M.main_data_begin>=0),H(S,M.main_data_begin,8),H(S,M.private_bits,S.channels_out),X=0,ie=0;ie<S.channels_out;ie++){var z=M.tt[X][ie];H(S,z.part2_3_length+z.part2_length,12),H(S,z.big_values/2,9),H(S,z.global_gain,8),H(S,z.scalefac_compress,9),z.block_type!=c.NORM_TYPE?(H(S,1,1),H(S,z.block_type,2),H(S,z.mixed_block_flag,1),z.table_select[0]==14&&(z.table_select[0]=16),H(S,z.table_select[0],5),z.table_select[1]==14&&(z.table_select[1]=16),H(S,z.table_select[1],5),H(S,z.subblock_gain[0],3),H(S,z.subblock_gain[1],3),H(S,z.subblock_gain[2],3)):(H(S,0,1),z.table_select[0]==14&&(z.table_select[0]=16),H(S,z.table_select[0],5),z.table_select[1]==14&&(z.table_select[1]=16),H(S,z.table_select[1],5),z.table_select[2]==14&&(z.table_select[2]=16),H(S,z.table_select[2],5),o(0<=z.region0_count&&z.region0_count<16),o(0<=z.region1_count&&z.region1_count<8),H(S,z.region0_count,4),H(S,z.region1_count,3)),H(S,z.scalefac_scale,1),H(S,z.count1table_select,1)}O.error_protection&&CRC_writeheader(S,S.header[S.h_ptr].buf);{var le=S.h_ptr;o(S.header[le].ptr==S.sideinfo_len*8),S.h_ptr=le+1&u.MAX_HEADER_BUF-1,S.header[S.h_ptr].write_timing=S.header[le].write_timing+C,S.h_ptr==S.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function v(O,C){var S=l.ht[C.count1table_select+32],M,X=0,ie=C.big_values,G=C.big_values;for(o(C.count1table_select<2),M=(C.count1-C.big_values)/4;M>0;--M){var z=0,le=0,Me;Me=C.l3_enc[ie+0],Me!=0&&(le+=8,C.xr[G+0]<0&&z++),Me=C.l3_enc[ie+1],Me!=0&&(le+=4,z*=2,C.xr[G+1]<0&&z++),Me=C.l3_enc[ie+2],Me!=0&&(le+=2,z*=2,C.xr[G+2]<0&&z++),Me=C.l3_enc[ie+3],Me!=0&&(le++,z*=2,C.xr[G+3]<0&&z++),ie+=4,G+=4,$(O,z+S.table[le],S.hlen[le]),X+=S.hlen[le]}return X}function D(O,C,S,M,X){var ie=l.ht[C],G=0;if(C==0)return G;for(var z=S;z<M;z+=2){var le=0,Me=0,_e=ie.xlen,Ae=ie.xlen,Ee=0,Ve=X.l3_enc[z],Te=X.l3_enc[z+1];if(Ve!=0&&(X.xr[z]<0&&Ee++,le--),C>15){if(Ve>14){var Le=Ve-15;o(Le<=ie.linmax),Ee|=Le<<1,Me=_e,Ve=15}if(Te>14){var Ie=Te-15;o(Ie<=ie.linmax),Ee<<=_e,Ee|=Ie,Me+=_e,Te=15}Ae=16}Te!=0&&(Ee<<=1,X.xr[z+1]<0&&Ee++,le--),Ve=Ve*Ae+Te,Me-=le,le+=ie.hlen[Ve],$(O,ie.table[Ve],le),$(O,Ee,Me),G+=le+Me}return G}function F(O,C){var S=3*O.scalefac_band.s[3];S>C.big_values&&(S=C.big_values);var M=D(O,C.table_select[0],0,S,C);return M+=D(O,C.table_select[1],S,C.big_values,C),M}function Y(O,C){var S,M,X,ie;S=C.big_values;var G=C.region0_count+1;return o(G<O.scalefac_band.l.length),X=O.scalefac_band.l[G],G+=C.region1_count+1,o(G<O.scalefac_band.l.length),ie=O.scalefac_band.l[G],X>S&&(X=S),ie>S&&(ie=S),M=D(O,C.table_select[0],0,X,C),M+=D(O,C.table_select[1],X,ie,C),M+=D(O,C.table_select[2],ie,S,C),M}function K(O){var C,S,M,X,ie=0,G=O.internal_flags,z=G.l3_side;if(O.version==1)for(C=0;C<2;C++)for(S=0;S<G.channels_out;S++){var le=z.tt[C][S],Me=a.slen1_tab[le.scalefac_compress],_e=a.slen2_tab[le.scalefac_compress];for(X=0,M=0;M<le.sfbdivide;M++)le.scalefac[M]!=-1&&($(G,le.scalefac[M],Me),X+=Me);for(;M<le.sfbmax;M++)le.scalefac[M]!=-1&&($(G,le.scalefac[M],_e),X+=_e);o(X==le.part2_length),le.block_type==c.SHORT_TYPE?X+=F(G,le):X+=Y(G,le),X+=v(G,le),o(X==le.part2_3_length+le.part2_length),ie+=X}else for(C=0,S=0;S<G.channels_out;S++){var le=z.tt[C][S],Ae,Ee,Ve=0;if(o(le.sfb_partition_table!=null),X=0,M=0,Ee=0,le.block_type==c.SHORT_TYPE){for(;Ee<4;Ee++){var Te=le.sfb_partition_table[Ee]/3,Le=le.slen[Ee];for(Ae=0;Ae<Te;Ae++,M++)$(G,Math.max(le.scalefac[M*3+0],0),Le),$(G,Math.max(le.scalefac[M*3+1],0),Le),$(G,Math.max(le.scalefac[M*3+2],0),Le),Ve+=3*Le}X+=F(G,le)}else{for(;Ee<4;Ee++){var Te=le.sfb_partition_table[Ee],Le=le.slen[Ee];for(Ae=0;Ae<Te;Ae++,M++)$(G,Math.max(le.scalefac[M],0),Le),Ve+=Le}X+=Y(G,le)}X+=v(G,le),o(X==le.part2_3_length),o(Ve==le.part2_length),ie+=Ve+X}return ie}function Q(){this.total=0}function W(O,C){var S=O.internal_flags,M,X,ie,G,z;return z=S.w_ptr,G=S.h_ptr-1,G==-1&&(G=u.MAX_HEADER_BUF-1),M=S.header[G].write_timing-R,C.total=M,M>=0&&(X=1+G-z,G<z&&(X=1+G-z+u.MAX_HEADER_BUF),M-=X*8*S.sideinfo_len),ie=y.getframebits(O),M+=ie,C.total+=ie,C.total%8!=0?C.total=1+C.total/8:C.total=C.total/8,C.total+=h+1,M<0&&e.err.println(`strange error flushing buffer ... 
`),M}this.flush_bitstream=function(O){var C=O.internal_flags,S,M,X=C.h_ptr-1;if(X==-1&&(X=u.MAX_HEADER_BUF-1),S=C.l3_side,!((M=W(O,new Q))<0)){if(I(O,M),o(C.header[X].write_timing+this.getframebits(O)==R),C.ResvSize=0,S.main_data_begin=0,C.findReplayGain){var ie=g.GetTitleGain(C.rgdata);o(NEQ(ie,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),C.RadioGain=Math.floor(ie*10+.5)|0}C.findPeakSample&&(C.noclipGainChange=Math.ceil(Math.log10(C.PeakSample/32767)*20*10)|0,C.noclipGainChange>0&&(EQ(O.scale,1)||EQ(O.scale,0))?C.noclipScale=Math.floor(32767/C.PeakSample*100)/100:C.noclipScale=-1)}},this.add_dummy_byte=function(O,C,S){for(var M=O.internal_flags,X;S-- >0;)for(P(M,C,8),X=0;X<u.MAX_HEADER_BUF;++X)M.header[X].write_timing+=8},this.format_bitstream=function(O){var C=O.internal_flags,S;S=C.l3_side;var M=this.getframebits(O);I(O,S.resvDrain_pre),V(O,M);var X=8*C.sideinfo_len;if(X+=K(O),I(O,S.resvDrain_post),X+=S.resvDrain_post,S.main_data_begin+=(M-X)/8,W(O,new Q)!=C.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),S.main_data_begin*8!=C.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*S.main_data_begin,C.ResvSize,S.resvDrain_post,S.resvDrain_pre,8*C.sideinfo_len,X-S.resvDrain_post-8*C.sideinfo_len,X,X%8,M),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),C.ResvSize=S.main_data_begin*8),R>1e9){var ie;for(ie=0;ie<u.MAX_HEADER_BUF;++ie)C.header[ie].write_timing-=R;R=0}return 0},this.copy_buffer=function(O,C,S,M,X){var ie=h+1;if(ie<=0)return 0;if(M!=0&&ie>M)return-1;if(e.arraycopy(E,0,C,S,ie),h=-1,k=0,X!=0){var G=s(1);if(G[0]=O.nMusicCRC,b.updateMusicCRC(G,C,S,ie),O.nMusicCRC=G[0],ie>0&&(O.VBR_seek_table.nBytesWritten+=ie),O.decode_on_the_fly){for(var z=i([2,1152]),le=ie,Me=-1,_e;Me!=0;)if(Me=w.hip_decode1_unclipped(O.hip,C,S,le,z[0],z[1]),le=0,Me==-1&&(Me=0),Me>0){if(O.findPeakSample){for(_e=0;_e<Me;_e++)z[0][_e]>O.PeakSample?O.PeakSample=z[0][_e]:-z[0][_e]>O.PeakSample&&(O.PeakSample=-z[0][_e]);if(O.channels_out>1)for(_e=0;_e<Me;_e++)z[1][_e]>O.PeakSample?O.PeakSample=z[1][_e]:-z[1][_e]>O.PeakSample&&(O.PeakSample=-z[1][_e])}if(O.findReplayGain&&g.AnalyzeSamples(O.rgdata,z[0],0,z[1],0,Me,O.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return ie},this.init_bit_stream_w=function(O){E=r(p.LAME_MAXMP3BUFFER),O.h_ptr=O.w_ptr=0,O.header[O.h_ptr].write_timing=0,h=-1,k=0,R=0}}return Cf=f,Cf}var Rf,u0;function Lf(){if(u0)return Rf;u0=1;var t=zn,e=t.System,n=t.VbrMode,r=t.ShortBlock,i=t.new_float,s=t.new_int_n,o=t.new_short_n,a=t.assert,l=r3,c=o3,u=Iu,f=L3,p=I3,y=V3,m=Mf(),g=Tf,w=xr();function _(){var b=ul,E=this,R=128*1024;_.V9=410,_.V8=420,_.V7=430,_.V6=440,_.V5=450,_.V4=460,_.V3=470,_.V2=480,_.V1=490,_.V0=500,_.R3MIX=1e3,_.STANDARD=1001,_.EXTREME=1002,_.INSANE=1003,_.STANDARD_FAST=1004,_.EXTREME_FAST=1005,_.MEDIUM=1006,_.MEDIUM_FAST=1007;var h=16384+R;_.LAME_MAXMP3BUFFER=h;var k,L,$,P,I,H=new l,ae,V,v;this.enc=new w,this.setModules=function(B,x,Ne,We,tt,ke,Pe,Xe,qe){k=B,L=x,$=Ne,P=We,I=tt,ae=ke,V=Xe,v=qe,this.enc.setModules(L,H,P,ae)};function D(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(w.SBMAX_l),this.bo_s_weight=i(w.SBMAX_s)}function F(){this.lowerlimit=0}function Y(B,x){this.lowpass=x}var K=4294479419;function Q(B){var x;return B.class_id=K,x=B.internal_flags=new u,B.mode=b.NOT_SET,B.original=1,B.in_samplerate=44100,B.num_channels=2,B.num_samples=-1,B.bWriteVbrTag=!0,B.quality=-1,B.short_blocks=null,x.subblock_gain=-1,B.lowpassfreq=0,B.highpassfreq=0,B.lowpasswidth=-1,B.highpasswidth=-1,B.VBR=n.vbr_off,B.VBR_q=4,B.ATHcurve=-1,B.VBR_mean_bitrate_kbps=128,B.VBR_min_bitrate_kbps=0,B.VBR_max_bitrate_kbps=0,B.VBR_hard_min=0,x.VBR_min_bitrate=1,x.VBR_max_bitrate=13,B.quant_comp=-1,B.quant_comp_short=-1,B.msfix=-1,x.resample_ratio=1,x.OldValue[0]=180,x.OldValue[1]=180,x.CurrentStep[0]=4,x.CurrentStep[1]=4,x.masking_lower=1,x.nsPsy.attackthre=-1,x.nsPsy.attackthre_s=-1,B.scale=-1,B.athaa_type=-1,B.ATHtype=-1,B.athaa_loudapprox=-1,B.athaa_sensitivity=0,B.useTemporal=null,B.interChRatio=-1,x.mf_samples_to_encode=w.ENCDELAY+w.POSTDELAY,B.encoder_padding=0,x.mf_size=w.ENCDELAY-w.MDCTDELAY,B.findReplayGain=!1,B.decode_on_the_fly=!1,x.decode_on_the_fly=!1,x.findReplayGain=!1,x.findPeakSample=!1,x.RadioGain=0,x.AudiophileGain=0,x.noclipGainChange=0,x.noclipScale=-1,B.preset=0,B.write_id3tag_automatic=!0,0}this.lame_init=function(){var B=new c;return Q(B),B.lame_allocated_gfp=1,B};function W(B){return B>1?0:B<=0?1:Math.cos(Math.PI/2*B)}this.nearestBitrateFullIndex=function(B){var x=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ne=0,We=0,tt=0,ke=0;ke=x[16],tt=16,We=x[16],Ne=16;for(var Pe=0;Pe<16;Pe++)if(Math.max(B,x[Pe+1])!=B){ke=x[Pe+1],tt=Pe+1,We=x[Pe],Ne=Pe;break}return ke-B>B-We?Ne:tt};function O(B,x){var Ne=44100;return x>=48e3?Ne=48e3:x>=44100?Ne=44100:x>=32e3?Ne=32e3:x>=24e3?Ne=24e3:x>=22050?Ne=22050:x>=16e3?Ne=16e3:x>=12e3?Ne=12e3:x>=11025?Ne=11025:x>=8e3&&(Ne=8e3),B==-1?Ne:(B<=15960&&(Ne=44100),B<=15250&&(Ne=32e3),B<=11220&&(Ne=24e3),B<=9970&&(Ne=22050),B<=7230&&(Ne=16e3),B<=5420&&(Ne=12e3),B<=4510&&(Ne=11025),B<=3970&&(Ne=8e3),x<Ne?x>44100?48e3:x>32e3?44100:x>24e3?32e3:x>22050?24e3:x>16e3?22050:x>12e3?16e3:x>11025?12e3:x>8e3?11025:8e3:Ne)}function C(B,x){switch(B){case 44100:return x.version=1,0;case 48e3:return x.version=1,1;case 32e3:return x.version=1,2;case 22050:return x.version=0,0;case 24e3:return x.version=0,1;case 16e3:return x.version=0,2;case 11025:return x.version=0,0;case 12e3:return x.version=0,1;case 8e3:return x.version=0,2;default:return x.version=0,-1}}function S(B,x,Ne){Ne<16e3&&(x=2);for(var We=g.bitrate_table[x][1],tt=2;tt<=14;tt++)g.bitrate_table[x][tt]>0&&Math.abs(g.bitrate_table[x][tt]-B)<Math.abs(We-B)&&(We=g.bitrate_table[x][tt]);return We}function M(B,x,Ne){Ne<16e3&&(x=2);for(var We=0;We<=14;We++)if(g.bitrate_table[x][We]>0&&g.bitrate_table[x][We]==B)return We;return-1}function X(B,x){var Ne=[new Y(8,2e3),new Y(16,3700),new Y(24,3900),new Y(32,5500),new Y(40,7e3),new Y(48,7500),new Y(56,1e4),new Y(64,11e3),new Y(80,13500),new Y(96,15100),new Y(112,15600),new Y(128,17e3),new Y(160,17500),new Y(192,18600),new Y(224,19400),new Y(256,19700),new Y(320,20500)],We=E.nearestBitrateFullIndex(x);B.lowerlimit=Ne[We].lowpass}function ie(B){var x=B.internal_flags,Ne=32,We=-1;if(x.lowpass1>0){for(var tt=999,ke=0;ke<=31;ke++){var Pe=ke/31;Pe>=x.lowpass2&&(Ne=Math.min(Ne,ke)),x.lowpass1<Pe&&Pe<x.lowpass2&&(tt=Math.min(tt,ke))}tt==999?x.lowpass1=(Ne-.75)/31:x.lowpass1=(tt-.75)/31,x.lowpass2=Ne/31}if(x.highpass2>0&&x.highpass2<.9*(.75/31)&&(x.highpass1=0,x.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),x.highpass2>0){for(var Xe=-1,ke=0;ke<=31;ke++){var Pe=ke/31;Pe<=x.highpass1&&(We=Math.max(We,ke)),x.highpass1<Pe&&Pe<x.highpass2&&(Xe=Math.max(Xe,ke))}x.highpass1=We/31,Xe==-1?x.highpass2=(We+.75)/31:x.highpass2=(Xe+.75)/31}for(var ke=0;ke<32;ke++){var qe,it,Pe=ke/31;x.highpass2>x.highpass1?qe=W((x.highpass2-Pe)/(x.highpass2-x.highpass1+1e-20)):qe=1,x.lowpass2>x.lowpass1?it=W((Pe-x.lowpass1)/(x.lowpass2-x.lowpass1+1e-20)):it=1,x.amp_filter[ke]=qe*it}}function G(B){var x=B.internal_flags;switch(B.quality){default:case 9:x.psymodel=0,x.noise_shaping=0,x.noise_shaping_amp=0,x.noise_shaping_stop=0,x.use_best_huffman=0,x.full_outer_loop=0;break;case 8:B.quality=7;case 7:x.psymodel=1,x.noise_shaping=0,x.noise_shaping_amp=0,x.noise_shaping_stop=0,x.use_best_huffman=0,x.full_outer_loop=0;break;case 6:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.noise_shaping_amp=0,x.noise_shaping_stop=0,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=0,x.full_outer_loop=0;break;case 5:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.noise_shaping_amp=0,x.noise_shaping_stop=0,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=0,x.full_outer_loop=0;break;case 4:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.noise_shaping_amp=0,x.noise_shaping_stop=0,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=1,x.full_outer_loop=0;break;case 3:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.noise_shaping_amp=1,x.noise_shaping_stop=1,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=1,x.full_outer_loop=0;break;case 2:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.substep_shaping==0&&(x.substep_shaping=2),x.noise_shaping_amp=1,x.noise_shaping_stop=1,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=1,x.full_outer_loop=0;break;case 1:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.substep_shaping==0&&(x.substep_shaping=2),x.noise_shaping_amp=2,x.noise_shaping_stop=1,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=1,x.full_outer_loop=0;break;case 0:x.psymodel=1,x.noise_shaping==0&&(x.noise_shaping=1),x.substep_shaping==0&&(x.substep_shaping=2),x.noise_shaping_amp=2,x.noise_shaping_stop=1,x.subblock_gain==-1&&(x.subblock_gain=1),x.use_best_huffman=1,x.full_outer_loop=0;break}}function z(B){var x=B.internal_flags;B.frameNum=0,B.write_id3tag_automatic&&V.id3tag_write_v2(B),x.bitrate_stereoMode_Hist=s([16,5]),x.bitrate_blockType_Hist=s([16,6]),x.PeakSample=0,B.bWriteVbrTag&&ae.InitVbrTag(B)}this.lame_init_params=function(B){var x=B.internal_flags;if(x.Class_ID=0,x.ATH==null&&(x.ATH=new f),x.PSY==null&&(x.PSY=new D),x.rgdata==null&&(x.rgdata=new p),x.channels_in=B.num_channels,x.channels_in==1&&(B.mode=b.MONO),x.channels_out=B.mode==b.MONO?1:2,x.mode_ext=w.MPG_MD_MS_LR,B.mode==b.MONO&&(B.force_ms=!1),B.VBR==n.vbr_off&&B.VBR_mean_bitrate_kbps!=128&&B.brate==0&&(B.brate=B.VBR_mean_bitrate_kbps),B.VBR==n.vbr_off||B.VBR==n.vbr_mtrh||B.VBR==n.vbr_mt||(B.free_format=!1),B.VBR==n.vbr_off&&B.brate==0&&m.EQ(B.compression_ratio,0)&&(B.compression_ratio=11.025),B.VBR==n.vbr_off&&B.compression_ratio>0&&(B.out_samplerate==0&&(B.out_samplerate=map2MP3Frequency(int(.97*B.in_samplerate))),B.brate=0|B.out_samplerate*16*x.channels_out/(1e3*B.compression_ratio),x.samplerate_index=C(B.out_samplerate,B),B.free_format||(B.brate=S(B.brate,B.version,B.out_samplerate))),B.out_samplerate!=0&&(B.out_samplerate<16e3?(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,8),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,64)):B.out_samplerate<32e3?(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,8),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,160)):(B.VBR_mean_bitrate_kbps=Math.max(B.VBR_mean_bitrate_kbps,32),B.VBR_mean_bitrate_kbps=Math.min(B.VBR_mean_bitrate_kbps,320))),B.lowpassfreq==0){var Ne=16e3;switch(B.VBR){case n.vbr_off:{var We=new F;X(We,B.brate),Ne=We.lowerlimit;break}case n.vbr_abr:{var We=new F;X(We,B.VBR_mean_bitrate_kbps),Ne=We.lowerlimit;break}case n.vbr_rh:{var tt=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=B.VBR_q&&B.VBR_q<=9){var ke=tt[B.VBR_q],Pe=tt[B.VBR_q+1],Xe=B.VBR_q_frac;Ne=linear_int(ke,Pe,Xe)}else Ne=19500;break}default:{var tt=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=B.VBR_q&&B.VBR_q<=9){var ke=tt[B.VBR_q],Pe=tt[B.VBR_q+1],Xe=B.VBR_q_frac;Ne=linear_int(ke,Pe,Xe)}else Ne=19500}}B.mode==b.MONO&&(B.VBR==n.vbr_off||B.VBR==n.vbr_abr)&&(Ne*=1.5),B.lowpassfreq=Ne|0}if(B.out_samplerate==0&&(2*B.lowpassfreq>B.in_samplerate&&(B.lowpassfreq=B.in_samplerate/2),B.out_samplerate=O(B.lowpassfreq|0,B.in_samplerate)),B.lowpassfreq=Math.min(20500,B.lowpassfreq),B.lowpassfreq=Math.min(B.out_samplerate/2,B.lowpassfreq),B.VBR==n.vbr_off&&(B.compression_ratio=B.out_samplerate*16*x.channels_out/(1e3*B.brate)),B.VBR==n.vbr_abr&&(B.compression_ratio=B.out_samplerate*16*x.channels_out/(1e3*B.VBR_mean_bitrate_kbps)),B.bWriteVbrTag||(B.findReplayGain=!1,B.decode_on_the_fly=!1,x.findPeakSample=!1),x.findReplayGain=B.findReplayGain,x.decode_on_the_fly=B.decode_on_the_fly,x.decode_on_the_fly&&(x.findPeakSample=!0),x.findReplayGain&&k.InitGainAnalysis(x.rgdata,B.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return B.internal_flags=null,-6;switch(x.decode_on_the_fly&&!B.decode_only&&(x.hip!=null&&v.hip_decode_exit(x.hip),x.hip=v.hip_decode_init()),x.mode_gr=B.out_samplerate<=24e3?1:2,B.framesize=576*x.mode_gr,B.encoder_delay=w.ENCDELAY,x.resample_ratio=B.in_samplerate/B.out_samplerate,B.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:{var qe=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];B.compression_ratio=qe[B.VBR_q]}break;case n.vbr_abr:B.compression_ratio=B.out_samplerate*16*x.channels_out/(1e3*B.VBR_mean_bitrate_kbps);break;default:B.compression_ratio=B.out_samplerate*16*x.channels_out/(1e3*B.brate);break}if(B.mode==b.NOT_SET&&(B.mode=b.JOINT_STEREO),B.highpassfreq>0?(x.highpass1=2*B.highpassfreq,B.highpasswidth>=0?x.highpass2=2*(B.highpassfreq+B.highpasswidth):x.highpass2=1*2*B.highpassfreq,x.highpass1/=B.out_samplerate,x.highpass2/=B.out_samplerate):(x.highpass1=0,x.highpass2=0),B.lowpassfreq>0?(x.lowpass2=2*B.lowpassfreq,B.lowpasswidth>=0?(x.lowpass1=2*(B.lowpassfreq-B.lowpasswidth),x.lowpass1<0&&(x.lowpass1=0)):x.lowpass1=1*2*B.lowpassfreq,x.lowpass1/=B.out_samplerate,x.lowpass2/=B.out_samplerate):(x.lowpass1=0,x.lowpass2=0),ie(B),x.samplerate_index=C(B.out_samplerate,B),x.samplerate_index<0)return B.internal_flags=null,-1;if(B.VBR==n.vbr_off){if(B.free_format)x.bitrate_index=0;else if(B.brate=S(B.brate,B.version,B.out_samplerate),x.bitrate_index=M(B.brate,B.version,B.out_samplerate),x.bitrate_index<=0)return B.internal_flags=null,-1}else x.bitrate_index=1;B.analysis&&(B.bWriteVbrTag=!1),x.pinfo!=null&&(B.bWriteVbrTag=!1),L.init_bit_stream_w(x);for(var it=x.samplerate_index+3*B.version+6*(B.out_samplerate<16e3?1:0),Je=0;Je<w.SBMAX_l+1;Je++)x.scalefac_band.l[Je]=P.sfBandIndex[it].l[Je];for(var Je=0;Je<w.PSFB21+1;Je++){var U=(x.scalefac_band.l[22]-x.scalefac_band.l[21])/w.PSFB21,T=x.scalefac_band.l[21]+Je*U;x.scalefac_band.psfb21[Je]=T}x.scalefac_band.psfb21[w.PSFB21]=576;for(var Je=0;Je<w.SBMAX_s+1;Je++)x.scalefac_band.s[Je]=P.sfBandIndex[it].s[Je];for(var Je=0;Je<w.PSFB12+1;Je++){var U=(x.scalefac_band.s[13]-x.scalefac_band.s[12])/w.PSFB12,T=x.scalefac_band.s[12]+Je*U;x.scalefac_band.psfb12[Je]=T}x.scalefac_band.psfb12[w.PSFB12]=192,B.version==1?x.sideinfo_len=x.channels_out==1?21:36:x.sideinfo_len=x.channels_out==1?13:21,B.error_protection&&(x.sideinfo_len+=2),z(B),x.Class_ID=K;{var d;for(d=0;d<19;d++)x.nsPsy.pefirbuf[d]=700*x.mode_gr*x.channels_out;B.ATHtype==-1&&(B.ATHtype=4)}switch(a(B.VBR_q<=9),a(B.VBR_q>=0),B.VBR){case n.vbr_mt:B.VBR=n.vbr_mtrh;case n.vbr_mtrh:{B.useTemporal==null&&(B.useTemporal=!1),$.apply_preset(B,500-B.VBR_q*10,0),B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),B.quality<5&&(B.quality=0),B.quality>5&&(B.quality=5),x.PSY.mask_adjust=B.maskingadjust,x.PSY.mask_adjust_short=B.maskingadjust_short,B.experimentalY?x.sfb21_extra=!1:x.sfb21_extra=B.out_samplerate>44e3,x.iteration_loop=new VBRNewIterationLoop(I);break}case n.vbr_rh:{$.apply_preset(B,500-B.VBR_q*10,0),x.PSY.mask_adjust=B.maskingadjust,x.PSY.mask_adjust_short=B.maskingadjust_short,B.experimentalY?x.sfb21_extra=!1:x.sfb21_extra=B.out_samplerate>44e3,B.quality>6&&(B.quality=6),B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),x.iteration_loop=new VBROldIterationLoop(I);break}default:{var A;x.sfb21_extra=!1,B.quality<0&&(B.quality=LAME_DEFAULT_QUALITY),A=B.VBR,A==n.vbr_off&&(B.VBR_mean_bitrate_kbps=B.brate),$.apply_preset(B,B.VBR_mean_bitrate_kbps,0),B.VBR=A,x.PSY.mask_adjust=B.maskingadjust,x.PSY.mask_adjust_short=B.maskingadjust_short,A==n.vbr_off?x.iteration_loop=new y(I):x.iteration_loop=new ABRIterationLoop(I);break}}if(a(B.scale>=0),B.VBR!=n.vbr_off){if(x.VBR_min_bitrate=1,x.VBR_max_bitrate=14,B.out_samplerate<16e3&&(x.VBR_max_bitrate=8),B.VBR_min_bitrate_kbps!=0&&(B.VBR_min_bitrate_kbps=S(B.VBR_min_bitrate_kbps,B.version,B.out_samplerate),x.VBR_min_bitrate=M(B.VBR_min_bitrate_kbps,B.version,B.out_samplerate),x.VBR_min_bitrate<0)||B.VBR_max_bitrate_kbps!=0&&(B.VBR_max_bitrate_kbps=S(B.VBR_max_bitrate_kbps,B.version,B.out_samplerate),x.VBR_max_bitrate=M(B.VBR_max_bitrate_kbps,B.version,B.out_samplerate),x.VBR_max_bitrate<0))return-1;B.VBR_min_bitrate_kbps=g.bitrate_table[B.version][x.VBR_min_bitrate],B.VBR_max_bitrate_kbps=g.bitrate_table[B.version][x.VBR_max_bitrate],B.VBR_mean_bitrate_kbps=Math.min(g.bitrate_table[B.version][x.VBR_max_bitrate],B.VBR_mean_bitrate_kbps),B.VBR_mean_bitrate_kbps=Math.max(g.bitrate_table[B.version][x.VBR_min_bitrate],B.VBR_mean_bitrate_kbps)}return B.tune&&(x.PSY.mask_adjust+=B.tune_value_a,x.PSY.mask_adjust_short+=B.tune_value_a),G(B),a(B.scale>=0),B.athaa_type<0?x.ATH.useAdjust=3:x.ATH.useAdjust=B.athaa_type,x.ATH.aaSensitivityP=Math.pow(10,B.athaa_sensitivity/-10),B.short_blocks==null&&(B.short_blocks=r.short_block_allowed),B.short_blocks==r.short_block_allowed&&(B.mode==b.JOINT_STEREO||B.mode==b.STEREO)&&(B.short_blocks=r.short_block_coupled),B.quant_comp<0&&(B.quant_comp=1),B.quant_comp_short<0&&(B.quant_comp_short=0),B.msfix<0&&(B.msfix=0),B.exp_nspsytune=B.exp_nspsytune|1,B.internal_flags.nsPsy.attackthre<0&&(B.internal_flags.nsPsy.attackthre=l.NSATTACKTHRE),B.internal_flags.nsPsy.attackthre_s<0&&(B.internal_flags.nsPsy.attackthre_s=l.NSATTACKTHRE_S),a(B.scale>=0),B.scale<0&&(B.scale=1),B.ATHtype<0&&(B.ATHtype=4),B.ATHcurve<0&&(B.ATHcurve=4),B.athaa_loudapprox<0&&(B.athaa_loudapprox=2),B.interChRatio<0&&(B.interChRatio=0),B.useTemporal==null&&(B.useTemporal=!0),x.slot_lag=x.frac_SpF=0,B.VBR==n.vbr_off&&(x.slot_lag=x.frac_SpF=(B.version+1)*72e3*B.brate%B.out_samplerate|0),P.iteration_init(B),H.psymodel_init(B),a(B.scale>=0),0};function le(B,x){(B.in_buffer_0==null||B.in_buffer_nsamples<x)&&(B.in_buffer_0=i(x),B.in_buffer_1=i(x),B.in_buffer_nsamples=x)}this.lame_encode_flush=function(B,x,Ne,We){var tt=B.internal_flags,ke=o([2,1152]),Pe=0,Xe,qe,it,Je,U=tt.mf_samples_to_encode-w.POSTDELAY,T=Me(B);if(tt.mf_samples_to_encode<1)return 0;for(Xe=0,B.in_samplerate!=B.out_samplerate&&(U+=16*B.out_samplerate/B.in_samplerate),it=B.framesize-U%B.framesize,it<576&&(it+=B.framesize),B.encoder_padding=it,Je=(U+it)/B.framesize;Je>0&&Pe>=0;){var d=T-tt.mf_size,A=B.frameNum;d*=B.in_samplerate,d/=B.out_samplerate,d>1152&&(d=1152),d<1&&(d=1),qe=We-Xe,We==0&&(qe=0),Pe=this.lame_encode_buffer(B,ke[0],ke[1],d,x,Ne,qe),Ne+=Pe,Xe+=Pe,Je-=A!=B.frameNum?1:0}if(tt.mf_samples_to_encode=0,Pe<0||(qe=We-Xe,We==0&&(qe=0),L.flush_bitstream(B),Pe=L.copy_buffer(tt,x,Ne,qe,1),Pe<0))return Pe;if(Ne+=Pe,Xe+=Pe,qe=We-Xe,We==0&&(qe=0),B.write_id3tag_automatic){if(V.id3tag_write_v1(B),Pe=L.copy_buffer(tt,x,Ne,qe,0),Pe<0)return Pe;Xe+=Pe}return Xe},this.lame_encode_buffer=function(B,x,Ne,We,tt,ke,Pe){var Xe=B.internal_flags,qe=[null,null];if(Xe.Class_ID!=K)return-3;if(We==0)return 0;le(Xe,We),qe[0]=Xe.in_buffer_0,qe[1]=Xe.in_buffer_1;for(var it=0;it<We;it++)qe[0][it]=x[it],Xe.channels_in>1&&(qe[1][it]=Ne[it]);return _e(B,qe[0],qe[1],We,tt,ke,Pe)};function Me(B){var x=w.BLKSIZE+B.framesize-w.FFTOFFSET;return x=Math.max(x,512+B.framesize-32),x}function _e(B,x,Ne,We,tt,ke,Pe){var Xe=B.internal_flags,qe=0,it,Je,U,T,d,A=[null,null],N=[null,null];if(Xe.Class_ID!=K)return-3;if(We==0)return 0;if(d=L.copy_buffer(Xe,tt,ke,Pe,0),d<0)return d;if(ke+=d,qe+=d,N[0]=x,N[1]=Ne,m.NEQ(B.scale,0)&&m.NEQ(B.scale,1))for(Je=0;Je<We;++Je)N[0][Je]*=B.scale,Xe.channels_out==2&&(N[1][Je]*=B.scale);if(m.NEQ(B.scale_left,0)&&m.NEQ(B.scale_left,1))for(Je=0;Je<We;++Je)N[0][Je]*=B.scale_left;if(m.NEQ(B.scale_right,0)&&m.NEQ(B.scale_right,1))for(Je=0;Je<We;++Je)N[1][Je]*=B.scale_right;if(B.num_channels==2&&Xe.channels_out==1)for(Je=0;Je<We;++Je)N[0][Je]=.5*(N[0][Je]+N[1][Je]),N[1][Je]=0;T=Me(B),A[0]=Xe.mfbuf[0],A[1]=Xe.mfbuf[1];for(var j=0;We>0;){var ee=[null,null],te=0,se=0;ee[0]=N[0],ee[1]=N[1];var be=new Ee;if(et(B,A,ee,j,We,be),te=be.n_in,se=be.n_out,Xe.findReplayGain&&!Xe.decode_on_the_fly&&k.AnalyzeSamples(Xe.rgdata,A[0],Xe.mf_size,A[1],Xe.mf_size,se,Xe.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(We-=te,j+=te,Xe.channels_out==2,Xe.mf_size+=se,a(Xe.mf_size<=u.MFSIZE),Xe.mf_samples_to_encode<1&&(Xe.mf_samples_to_encode=w.ENCDELAY+w.POSTDELAY),Xe.mf_samples_to_encode+=se,Xe.mf_size>=T){var he=Pe-qe;if(Pe==0&&(he=0),it=Ae(B,A[0],A[1],tt,ke,he),it<0)return it;for(ke+=it,qe+=it,Xe.mf_size-=B.framesize,Xe.mf_samples_to_encode-=B.framesize,U=0;U<Xe.channels_out;U++)for(Je=0;Je<Xe.mf_size;Je++)A[U][Je]=A[U][Je+B.framesize]}}return qe}function Ae(B,x,Ne,We,tt,ke){var Pe=E.enc.lame_encode_mp3_frame(B,x,Ne,We,tt,ke);return B.frameNum++,Pe}function Ee(){this.n_in=0,this.n_out=0}function Ve(){this.num_used=0}function Te(B,x){return x!=0?Te(x,B%x):B}function Le(B,x,Ne){var We=Math.PI*x;B/=Ne,B<0&&(B=0),B>1&&(B=1);var tt=B-.5,ke=.42-.5*Math.cos(2*B*Math.PI)+.08*Math.cos(4*B*Math.PI);return Math.abs(tt)<1e-9?We/Math.PI:ke*Math.sin(Ne*We*tt)/(Math.PI*Ne*tt)}function Ie(B,x,Ne,We,tt,ke,Pe,Xe,qe){var it=B.internal_flags,Je,U=0,T,d=B.out_samplerate/Te(B.out_samplerate,B.in_samplerate);d>u.BPC&&(d=u.BPC);var A=Math.abs(it.resample_ratio-Math.floor(.5+it.resample_ratio))<1e-4?1:0,N=1/it.resample_ratio;N>1&&(N=1);var j=31;j%2==0&&--j,j+=A;var ee=j+1;if(it.fill_buffer_resample_init==0){for(it.inbuf_old[0]=i(ee),it.inbuf_old[1]=i(ee),Je=0;Je<=2*d;++Je)it.blackfilt[Je]=i(ee);for(it.itime[0]=0,it.itime[1]=0,U=0;U<=2*d;U++){var te=0,se=(U-d)/(2*d);for(Je=0;Je<=j;Je++)te+=it.blackfilt[U][Je]=Le(Je-se,N,j);for(Je=0;Je<=j;Je++)it.blackfilt[U][Je]/=te}it.fill_buffer_resample_init=1}var be=it.inbuf_old[qe];for(T=0;T<We;T++){var he,Ce;if(he=T*it.resample_ratio,U=0|Math.floor(he-it.itime[qe]),j+U-j/2>=Pe)break;var se=he-it.itime[qe]-(U+.5*(j%2));Ce=0|Math.floor(se*2*d+d+.5);var Re=0;for(Je=0;Je<=j;++Je){var Fe=0|Je+U-j/2,nt;nt=Fe<0?be[ee+Fe]:tt[ke+Fe],Re+=nt*it.blackfilt[Ce][Je]}x[Ne+T]=Re}if(Xe.num_used=Math.min(Pe,j+U-j/2),it.itime[qe]+=Xe.num_used-T*it.resample_ratio,Xe.num_used>=ee)for(Je=0;Je<ee;Je++)be[Je]=tt[ke+Xe.num_used+Je-ee];else{var pt=ee-Xe.num_used;for(Je=0;Je<pt;++Je)be[Je]=be[Je+Xe.num_used];for(U=0;Je<ee;++Je,++U)be[Je]=tt[ke+U];a(U==Xe.num_used)}return T}function et(B,x,Ne,We,tt,ke){var Pe=B.internal_flags;if(Pe.resample_ratio<.9999||Pe.resample_ratio>1.0001)for(var Xe=0;Xe<Pe.channels_out;Xe++){var qe=new Ve;ke.n_out=Ie(B,x[Xe],Pe.mf_size,B.framesize,Ne[Xe],We,tt,qe,Xe),ke.n_in=qe.num_used}else{ke.n_out=Math.min(B.framesize,tt),ke.n_in=ke.n_out;for(var it=0;it<ke.n_out;++it)x[0][Pe.mf_size+it]=Ne[0][We+it],Pe.channels_out==2&&(x[1][Pe.mf_size+it]=Ne[1][We+it])}}}return Rf=_,Rf}var x3=zn,Wi=x3.VbrMode;function H3(){var t=Lf();function e(u,f,p,y,m,g,w,_,b,E,R,h,k,L,$){this.vbr_q=u,this.quant_comp=f,this.quant_comp_s=p,this.expY=y,this.st_lrm=m,this.st_s=g,this.masking_adj=w,this.masking_adj_short=_,this.ath_lower=b,this.ath_curve=E,this.ath_sensitivity=R,this.interch=h,this.safejoint=k,this.sfb21mod=L,this.msfix=$}function n(u,f,p,y,m,g,w,_,b,E,R,h,k,L){this.quant_comp=f,this.quant_comp_s=p,this.safejoint=y,this.nsmsfix=m,this.st_lrm=g,this.st_s=w,this.nsbass=_,this.scale=b,this.masking_adj=E,this.ath_lower=R,this.ath_curve=h,this.interch=k,this.sfscale=L}var r;this.setModules=function(u){r=u};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,f,p){var y=u.VBR==Wi.vbr_rh?i:s,m=u.VBR_q_frac,g=y[f],w=y[f+1],_=g;g.st_lrm=g.st_lrm+m*(w.st_lrm-g.st_lrm),g.st_s=g.st_s+m*(w.st_s-g.st_s),g.masking_adj=g.masking_adj+m*(w.masking_adj-g.masking_adj),g.masking_adj_short=g.masking_adj_short+m*(w.masking_adj_short-g.masking_adj_short),g.ath_lower=g.ath_lower+m*(w.ath_lower-g.ath_lower),g.ath_curve=g.ath_curve+m*(w.ath_curve-g.ath_curve),g.ath_sensitivity=g.ath_sensitivity+m*(w.ath_sensitivity-g.ath_sensitivity),g.interch=g.interch+m*(w.interch-g.interch),g.msfix=g.msfix+m*(w.msfix-g.msfix),c(u,_.vbr_q),p!=0?u.quant_comp=_.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=_.quant_comp),p!=0?u.quant_comp_short=_.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=_.quant_comp_s),_.expY!=0&&(u.experimentalY=_.expY!=0),p!=0?u.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=_.st_lrm),p!=0?u.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=_.st_s),p!=0?u.maskingadjust=_.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=_.masking_adj),p!=0?u.maskingadjust_short=_.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=_.masking_adj_short),p!=0?u.ATHlower=-_.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-_.ath_lower/10),p!=0?u.ATHcurve=_.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=_.ath_curve),p!=0?u.athaa_sensitivity=_.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(p!=0?u.interChRatio=_.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=_.interch)),_.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|_.sfb21mod<<20),p!=0?u.msfix=_.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=_.msfix),p==0&&(u.VBR_q=f,u.VBR_q_frac=m)}var a=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function l(u,f,p){var y=f,m=r.nearestBitrateFullIndex(f);if(u.VBR=Wi.vbr_abr,u.VBR_mean_bitrate_kbps=y,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[m].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[m].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[m].nsbass)>0){var g=int(a[m].nsbass*4);g<0&&(g+=64),u.exp_nspsytune=u.exp_nspsytune|g<<2}return p!=0?u.quant_comp=a[m].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[m].quant_comp),p!=0?u.quant_comp_short=a[m].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[m].quant_comp_s),p!=0?u.msfix=a[m].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[m].nsmsfix),p!=0?u.internal_flags.nsPsy.attackthre=a[m].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[m].st_lrm),p!=0?u.internal_flags.nsPsy.attackthre_s=a[m].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[m].st_s),p!=0?u.scale=a[m].scale:Math.abs(u.scale- -1)>0||(u.scale=a[m].scale),p!=0?u.maskingadjust=a[m].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[m].masking_adj),a[m].masking_adj>0?p!=0?u.maskingadjust_short=a[m].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[m].masking_adj*.9):p!=0?u.maskingadjust_short=a[m].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[m].masking_adj*1.1),p!=0?u.ATHlower=-a[m].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[m].ath_lower/10),p!=0?u.ATHcurve=a[m].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[m].ath_curve),p!=0?u.interChRatio=a[m].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[m].interch),f}this.apply_preset=function(u,f,p){switch(f){case t.R3MIX:{f=t.V3,u.VBR=Wi.vbr_mtrh;break}case t.MEDIUM:{f=t.V4,u.VBR=Wi.vbr_rh;break}case t.MEDIUM_FAST:{f=t.V4,u.VBR=Wi.vbr_mtrh;break}case t.STANDARD:{f=t.V2,u.VBR=Wi.vbr_rh;break}case t.STANDARD_FAST:{f=t.V2,u.VBR=Wi.vbr_mtrh;break}case t.EXTREME:{f=t.V0,u.VBR=Wi.vbr_rh;break}case t.EXTREME_FAST:{f=t.V0,u.VBR=Wi.vbr_mtrh;break}case t.INSANE:return f=320,u.preset=f,l(u,f,p),u.VBR=Wi.vbr_off,f}switch(u.preset=f,f){case t.V9:return o(u,9,p),f;case t.V8:return o(u,8,p),f;case t.V7:return o(u,7,p),f;case t.V6:return o(u,6,p),f;case t.V5:return o(u,5,p),f;case t.V4:return o(u,4,p),f;case t.V3:return o(u,3,p),f;case t.V2:return o(u,2,p),f;case t.V1:return o(u,1,p),f;case t.V0:return o(u,0,p),f}return 8<=f&&f<=320?l(u,f,p):(u.preset=0,f)};function c(u,f){var p=0;return 0>f&&(p=-1,f=0),9<f&&(p=-1,f=9),u.VBR_q=f,u.VBR_q_frac=0,p}}var U3=H3;function W3(){this.setModules=function(t,e){}}var j3=W3;function G3(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var z3=G3,c0=zn,f0=c0.new_float,X3=c0.new_int;function Y3(){this.global_gain=0,this.sfb_count1=0,this.step=X3(39),this.noise=f0(39),this.noise_log=f0(39)}var K3=Y3,ra=zn,Bs=ra.System,d0=ra.VbrMode,Pf=ra.Util,ia=ra.Arrays,cl=ra.new_float,fl=ra.assert,q3=j3,If=z3,Z3=K3,gn=xr(),h0=yf,p0=Cu;function J3(){var t;this.rv=null;var e;this.qupvt=null;var n,r=new q3,i;this.setModules=function(_,b,E,R){t=_,e=b,this.rv=b,n=E,this.qupvt=E,i=R,r.setModules(n,i)},this.ms_convert=function(_,b){for(var E=0;E<576;++E){var R=_.tt[b][0].xr[E],h=_.tt[b][1].xr[E];_.tt[b][0].xr[E]=(R+h)*(Pf.SQRT2*.5),_.tt[b][1].xr[E]=(R-h)*(Pf.SQRT2*.5)}};function s(_,b,E,R){R=0;for(var h=0;h<=E;++h){var k=Math.abs(_.xr[h]);R+=k,b[h]=Math.sqrt(k*Math.sqrt(k)),b[h]>_.xrpow_max&&(_.xrpow_max=b[h])}return R}this.init_xrpow=function(_,b,E){var R=0,h=0|b.max_nonzero_coeff;if(b.xrpow_max=0,ia.fill(E,h,576,0),R=s(b,E,h,R),R>1e-20){var k=0;_.substep_shaping&2&&(k=1);for(var L=0;L<b.psymax;L++)_.pseudohalf[L]=k;return!0}return ia.fill(b.l3_enc,0,576,0),!1};function o(_,b){var E=_.ATH,R=b.xr;if(b.block_type!=gn.SHORT_TYPE)for(var h=!1,k=gn.PSFB21-1;k>=0&&!h;k--){var L=_.scalefac_band.psfb21[k],$=_.scalefac_band.psfb21[k+1],P=n.athAdjust(E.adjust,E.psfb21[k],E.floor);_.nsPsy.longfact[21]>1e-12&&(P*=_.nsPsy.longfact[21]);for(var I=$-1;I>=L;I--)if(Math.abs(R[I])<P)R[I]=0;else{h=!0;break}}else for(var H=0;H<3;H++)for(var h=!1,k=gn.PSFB12-1;k>=0&&!h;k--){var L=_.scalefac_band.s[12]*3+(_.scalefac_band.s[13]-_.scalefac_band.s[12])*H+(_.scalefac_band.psfb12[k]-_.scalefac_band.psfb12[0]),$=L+(_.scalefac_band.psfb12[k+1]-_.scalefac_band.psfb12[k]),ae=n.athAdjust(E.adjust,E.psfb12[k],E.floor);_.nsPsy.shortfact[12]>1e-12&&(ae*=_.nsPsy.shortfact[12]);for(var I=$-1;I>=L;I--)if(Math.abs(R[I])<ae)R[I]=0;else{h=!0;break}}}this.init_outer_loop=function(_,b){b.part2_3_length=0,b.big_values=0,b.count1=0,b.global_gain=210,b.scalefac_compress=0,b.table_select[0]=0,b.table_select[1]=0,b.table_select[2]=0,b.subblock_gain[0]=0,b.subblock_gain[1]=0,b.subblock_gain[2]=0,b.subblock_gain[3]=0,b.region0_count=0,b.region1_count=0,b.preflag=0,b.scalefac_scale=0,b.count1table_select=0,b.part2_length=0,b.sfb_lmax=gn.SBPSY_l,b.sfb_smin=gn.SBPSY_s,b.psy_lmax=_.sfb21_extra?gn.SBMAX_l:gn.SBPSY_l,b.psymax=b.psy_lmax,b.sfbmax=b.sfb_lmax,b.sfbdivide=11;for(var E=0;E<gn.SBMAX_l;E++)b.width[E]=_.scalefac_band.l[E+1]-_.scalefac_band.l[E],b.window[E]=3;if(b.block_type==gn.SHORT_TYPE){var R=cl(576);b.sfb_smin=0,b.sfb_lmax=0,b.mixed_block_flag!=0&&(b.sfb_smin=3,b.sfb_lmax=_.mode_gr*2+4),b.psymax=b.sfb_lmax+3*((_.sfb21_extra?gn.SBMAX_s:gn.SBPSY_s)-b.sfb_smin),b.sfbmax=b.sfb_lmax+3*(gn.SBPSY_s-b.sfb_smin),b.sfbdivide=b.sfbmax-18,b.psy_lmax=b.sfb_lmax;var h=_.scalefac_band.l[b.sfb_lmax];Bs.arraycopy(b.xr,0,R,0,576);for(var E=b.sfb_smin;E<gn.SBMAX_s;E++)for(var k=_.scalefac_band.s[E],L=_.scalefac_band.s[E+1],$=0;$<3;$++)for(var P=k;P<L;P++)b.xr[h++]=R[3*P+$];for(var I=b.sfb_lmax,E=b.sfb_smin;E<gn.SBMAX_s;E++)b.width[I]=b.width[I+1]=b.width[I+2]=_.scalefac_band.s[E+1]-_.scalefac_band.s[E],b.window[I]=0,b.window[I+1]=1,b.window[I+2]=2,I+=3}b.count1bits=0,b.sfb_partition_table=n.nr_of_sfb_block[0][0],b.slen[0]=0,b.slen[1]=0,b.slen[2]=0,b.slen[3]=0,b.max_nonzero_coeff=575,ia.fill(b.scalefac,0),o(_,b)};function a(_){this.ordinal=_}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function l(_,b,E,R,h){var k,L=_.CurrentStep[R],$=!1,P=_.OldValue[R],I=a.BINSEARCH_NONE;for(b.global_gain=P,E-=b.part2_length;;){var H;if(k=i.count_bits(_,h,b,null),L==1||k==E)break;k>E?(I==a.BINSEARCH_DOWN&&($=!0),$&&(L/=2),I=a.BINSEARCH_UP,H=L):(I==a.BINSEARCH_UP&&($=!0),$&&(L/=2),I=a.BINSEARCH_DOWN,H=-L),b.global_gain+=H,b.global_gain<0&&(b.global_gain=0,$=!0),b.global_gain>255&&(b.global_gain=255,$=!0)}for(fl(b.global_gain>=0),fl(b.global_gain<256);k>E&&b.global_gain<255;)b.global_gain++,k=i.count_bits(_,h,b,null);return _.CurrentStep[R]=P-b.global_gain>=4?4:2,_.OldValue[R]=b.global_gain,b.part2_3_length=k,k}this.trancate_smallspectrums=function(_,b,E,R){var h=cl(p0.SFBMAX);if(!(!(_.substep_shaping&4)&&b.block_type==gn.SHORT_TYPE||_.substep_shaping&128)){n.calc_noise(b,E,h,new If,null);for(var L=0;L<576;L++){var k=0;b.l3_enc[L]!=0&&(k=Math.abs(b.xr[L])),R[L]=k}var L=0,$=8;b.block_type==gn.SHORT_TYPE&&($=6);do{var P,I,H,ae,V=b.width[$];if(L+=V,!(h[$]>=1)&&(ia.sort(R,L-V,V),!BitStream.EQ(R[L-1],0))){P=(1-h[$])*E[$],I=0,ae=0;do{var v;for(H=1;ae+H<V&&!BitStream.NEQ(R[ae+L-V],R[ae+L+H-V]);H++);if(v=R[ae+L-V]*R[ae+L-V]*H,P<v){ae!=0&&(I=R[ae+L-V-1]);break}P-=v,ae+=H}while(ae<V);if(!BitStream.EQ(I,0))do Math.abs(b.xr[L-V])<=I&&(b.l3_enc[L-V]=0);while(--V>0)}}while(++$<b.psymax);b.part2_3_length=i.noquant_count_bits(_,b,null)}};function c(_){for(var b=0;b<_.sfbmax;b++)if(_.scalefac[b]+_.subblock_gain[_.window[b]]==0)return!1;return!0}function u(_){return Pf.FAST_LOG10(.368+.632*_*_*_)}function f(_,b){for(var E=1e-37,R=0;R<b.psymax;R++)E+=u(_[R]);return Math.max(1e-20,E)}function p(_,b,E,R,h){var k;switch(_){default:case 9:{b.over_count>0?(k=E.over_SSD<=b.over_SSD,E.over_SSD==b.over_SSD&&(k=E.bits<b.bits)):k=E.max_noise<0&&E.max_noise*10+E.bits<=b.max_noise*10+b.bits;break}case 0:k=E.over_count<b.over_count||E.over_count==b.over_count&&E.over_noise<b.over_noise||E.over_count==b.over_count&&BitStream.EQ(E.over_noise,b.over_noise)&&E.tot_noise<b.tot_noise;break;case 8:E.max_noise=f(h,R);case 1:k=E.max_noise<b.max_noise;break;case 2:k=E.tot_noise<b.tot_noise;break;case 3:k=E.tot_noise<b.tot_noise&&E.max_noise<b.max_noise;break;case 4:k=E.max_noise<=0&&b.max_noise>.2||E.max_noise<=0&&b.max_noise<0&&b.max_noise>E.max_noise-.2&&E.tot_noise<b.tot_noise||E.max_noise<=0&&b.max_noise>0&&b.max_noise>E.max_noise-.2&&E.tot_noise<b.tot_noise+b.over_noise||E.max_noise>0&&b.max_noise>-.05&&b.max_noise>E.max_noise-.1&&E.tot_noise+E.over_noise<b.tot_noise+b.over_noise||E.max_noise>0&&b.max_noise>-.1&&b.max_noise>E.max_noise-.15&&E.tot_noise+E.over_noise+E.over_noise<b.tot_noise+b.over_noise+b.over_noise;break;case 5:k=E.over_noise<b.over_noise||BitStream.EQ(E.over_noise,b.over_noise)&&E.tot_noise<b.tot_noise;break;case 6:k=E.over_noise<b.over_noise||BitStream.EQ(E.over_noise,b.over_noise)&&(E.max_noise<b.max_noise||BitStream.EQ(E.max_noise,b.max_noise)&&E.tot_noise<=b.tot_noise);break;case 7:k=E.over_count<b.over_count||E.over_noise<b.over_noise;break}return b.over_count==0&&(k=k&&E.bits<b.bits),k}function y(_,b,E,R,h){var k=_.internal_flags,L;b.scalefac_scale==0?L=1.2968395546510096:L=1.6817928305074292;for(var $=0,P=0;P<b.sfbmax;P++)$<E[P]&&($=E[P]);var I=k.noise_shaping_amp;switch(I==3&&(h?I=2:I=1),I){case 2:break;case 1:$>1?$=Math.pow($,.5):$*=.95;break;case 0:default:$>1?$=1:$*=.95;break}for(var H=0,P=0;P<b.sfbmax;P++){var ae=b.width[P],V;if(H+=ae,!(E[P]<$)){if(k.substep_shaping&2&&(k.pseudohalf[P]=k.pseudohalf[P]==0?1:0,k.pseudohalf[P]==0&&k.noise_shaping_amp==2))return;for(b.scalefac[P]++,V=-ae;V<0;V++)R[H+V]*=L,R[H+V]>b.xrpow_max&&(b.xrpow_max=R[H+V]);if(k.noise_shaping_amp==2)return}}}function m(_,b){for(var E=1.2968395546510096,R=0,h=0;h<_.sfbmax;h++){var k=_.width[h],L=_.scalefac[h];if(_.preflag!=0&&(L+=n.pretab[h]),R+=k,L&1){L++;for(var $=-k;$<0;$++)b[R+$]*=E,b[R+$]>_.xrpow_max&&(_.xrpow_max=b[R+$])}_.scalefac[h]=L>>1}_.preflag=0,_.scalefac_scale=1}function g(_,b,E){var R,h=b.scalefac;for(R=0;R<b.sfb_lmax;R++)if(h[R]>=16)return!0;for(var k=0;k<3;k++){var L=0,$=0;for(R=b.sfb_lmax+k;R<b.sfbdivide;R+=3)L<h[R]&&(L=h[R]);for(;R<b.sfbmax;R+=3)$<h[R]&&($=h[R]);if(!(L<16&&$<8)){if(b.subblock_gain[k]>=7)return!0;b.subblock_gain[k]++;var P=_.scalefac_band.l[b.sfb_lmax];for(R=b.sfb_lmax+k;R<b.sfbmax;R+=3){var I,H=b.width[R],ae=h[R];if(ae=ae-(4>>b.scalefac_scale),ae>=0){h[R]=ae,P+=H*3;continue}h[R]=0;{var V=210+(ae<<b.scalefac_scale+1);I=n.IPOW20(V)}P+=H*(k+1);for(var v=-H;v<0;v++)E[P+v]*=I,E[P+v]>b.xrpow_max&&(b.xrpow_max=E[P+v]);P+=H*(3-k-1)}{var I=n.IPOW20(202);P+=b.width[R]*(k+1);for(var v=-b.width[R];v<0;v++)E[P+v]*=I,E[P+v]>b.xrpow_max&&(b.xrpow_max=E[P+v])}}}return!1}function w(_,b,E,R,h){var k=_.internal_flags;y(_,b,E,R,h);var L=c(b);return L?!1:(k.mode_gr==2?L=i.scale_bitcount(b):L=i.scale_bitcount_lsf(k,b),L?(k.noise_shaping>1&&(ia.fill(k.pseudohalf,0),b.scalefac_scale==0?(m(b,R),L=!1):b.block_type==gn.SHORT_TYPE&&k.subblock_gain>0&&(L=g(k,b,R)||c(b))),L||(k.mode_gr==2?L=i.scale_bitcount(b):L=i.scale_bitcount_lsf(k,b)),!L):!0)}this.outer_loop=function(_,b,E,R,h,k){var L=_.internal_flags,$=new h0,P=cl(576),I=cl(p0.SFBMAX),H=new If,ae,V=new Z3,v=9999999,D=!1,F=!1,Y=0;if(l(L,b,k,h,R),L.noise_shaping==0)return 100;n.calc_noise(b,E,I,H,V),H.bits=b.part2_3_length,$.assign(b);var K=0;for(Bs.arraycopy(R,0,P,0,576);!D;){do{var Q=new If,W,O=255;if(L.substep_shaping&2?W=20:W=3,L.sfb21_extra&&(I[$.sfbmax]>1||$.block_type==gn.SHORT_TYPE&&(I[$.sfbmax+1]>1||I[$.sfbmax+2]>1))||!w(_,$,I,R,F))break;$.scalefac_scale!=0&&(O=254);var C=k-$.part2_length;if(C<=0)break;for(;($.part2_3_length=i.count_bits(L,R,$,V))>C&&$.global_gain<=O;)$.global_gain++;if($.global_gain>O)break;if(H.over_count==0){for(;($.part2_3_length=i.count_bits(L,R,$,V))>v&&$.global_gain<=O;)$.global_gain++;if($.global_gain>O)break}if(n.calc_noise($,E,I,Q,V),Q.bits=$.part2_3_length,b.block_type!=gn.SHORT_TYPE?ae=_.quant_comp:ae=_.quant_comp_short,ae=p(ae,H,Q,$,I)?1:0,ae!=0)v=b.part2_3_length,H=Q,b.assign($),K=0,Bs.arraycopy(R,0,P,0,576);else if(L.full_outer_loop==0&&(++K>W&&H.over_count==0||L.noise_shaping_amp==3&&F&&K>30||L.noise_shaping_amp==3&&F&&$.global_gain-Y>15))break}while($.global_gain+$.scalefac_scale<255);L.noise_shaping_amp==3?F?D=!0:($.assign(b),Bs.arraycopy(P,0,R,0,576),K=0,Y=$.global_gain,F=!0):D=!0}return fl(b.global_gain+b.scalefac_scale<=255),_.VBR==d0.vbr_rh||_.VBR==d0.vbr_mtrh?Bs.arraycopy(P,0,R,0,576):L.substep_shaping&1&&trancate_smallspectrums(L,b,E,R),H.over_count},this.iteration_finish_one=function(_,b,E){var R=_.l3_side,h=R.tt[b][E];i.best_scalefac_store(_,b,E,R),_.use_best_huffman==1&&i.best_huffman_divide(_,h),e.ResvAdjust(_,h)},this.VBR_encode_granule=function(_,b,E,R,h,k,L){var $=_.internal_flags,P=new h0,I=cl(576),H=L,ae=L+1,V=(L+k)/2,v,D,F=0,Y=$.sfb21_extra;fl(H<=LameInternalFlags.MAX_BITS_PER_CHANNEL),ia.fill(P.l3_enc,0);do V>H-42?$.sfb21_extra=!1:$.sfb21_extra=Y,D=outer_loop(_,b,E,R,h,V),D<=0?(F=1,ae=b.part2_3_length,P.assign(b),Bs.arraycopy(R,0,I,0,576),L=ae-32,v=L-k,V=(L+k)/2):(k=V+32,v=L-k,V=(L+k)/2,F!=0&&(F=2,b.assign(P),Bs.arraycopy(I,0,R,0,576)));while(v>12);$.sfb21_extra=Y,F==2&&Bs.arraycopy(P.l3_enc,0,b.l3_enc,0,576),fl(b.part2_3_length<=H)},this.get_framebits=function(_,b){var E=_.internal_flags;E.bitrate_index=E.VBR_min_bitrate;var R=t.getframebits(_);E.bitrate_index=1,R=t.getframebits(_);for(var h=1;h<=E.VBR_max_bitrate;h++){E.bitrate_index=h;var k=new MeanBits(R);b[h]=e.ResvFrameBegin(_,k),R=k.bits}},this.VBR_old_prepare=function(_,b,E,R,h,k,L,$,P){var I=_.internal_flags,H,ae=0,V=1,v=0;I.bitrate_index=I.VBR_max_bitrate;var D=e.ResvFrameBegin(_,new MeanBits(0))/I.mode_gr;get_framebits(_,k);for(var F=0;F<I.mode_gr;F++){var Y=n.on_pe(_,b,$[F],D,F,0);I.mode_ext==gn.MPG_MD_MS_LR&&(ms_convert(I.l3_side,F),n.reduce_side($[F],E[F],D,Y));for(var K=0;K<I.channels_out;++K){var Q=I.l3_side.tt[F][K];Q.block_type!=gn.SHORT_TYPE?(ae=1.28/(1+Math.exp(3.5-b[F][K]/300))-.05,H=I.PSY.mask_adjust-ae):(ae=2.56/(1+Math.exp(3.5-b[F][K]/300))-.14,H=I.PSY.mask_adjust_short-ae),I.masking_lower=Math.pow(10,H*.1),init_outer_loop(I,Q),P[F][K]=n.calc_xmin(_,R[F][K],Q,h[F][K]),P[F][K]!=0&&(V=0),L[F][K]=126,v+=$[F][K]}}for(var F=0;F<I.mode_gr;F++)for(var K=0;K<I.channels_out;K++)v>k[I.VBR_max_bitrate]&&($[F][K]*=k[I.VBR_max_bitrate],$[F][K]/=v),L[F][K]>$[F][K]&&(L[F][K]=$[F][K]);return V},this.bitpressure_strategy=function(_,b,E,R){for(var h=0;h<_.mode_gr;h++)for(var k=0;k<_.channels_out;k++){for(var L=_.l3_side.tt[h][k],$=b[h][k],P=0,I=0;I<L.psy_lmax;I++)$[P++]*=1+.029*I*I/gn.SBMAX_l/gn.SBMAX_l;if(L.block_type==gn.SHORT_TYPE)for(var I=L.sfb_smin;I<gn.SBMAX_s;I++)$[P++]*=1+.029*I*I/gn.SBMAX_s/gn.SBMAX_s,$[P++]*=1+.029*I*I/gn.SBMAX_s/gn.SBMAX_s,$[P++]*=1+.029*I*I/gn.SBMAX_s/gn.SBMAX_s;R[h][k]=0|Math.max(E[h][k],.9*R[h][k])}},this.VBR_new_prepare=function(_,b,E,R,h,k){var L=_.internal_flags,$=1,P=0,I=0,H;if(_.free_format){L.bitrate_index=0;var ae=new MeanBits(P);H=e.ResvFrameBegin(_,ae),P=ae.bits,h[0]=H}else{L.bitrate_index=L.VBR_max_bitrate;var ae=new MeanBits(P);e.ResvFrameBegin(_,ae),P=ae.bits,get_framebits(_,h),H=h[L.VBR_max_bitrate]}for(var V=0;V<L.mode_gr;V++){n.on_pe(_,b,k[V],P,V,0),L.mode_ext==gn.MPG_MD_MS_LR&&ms_convert(L.l3_side,V);for(var v=0;v<L.channels_out;++v){var D=L.l3_side.tt[V][v];L.masking_lower=Math.pow(10,L.PSY.mask_adjust*.1),init_outer_loop(L,D),n.calc_xmin(_,E[V][v],D,R[V][v])!=0&&($=0),I+=k[V][v]}}for(var V=0;V<L.mode_gr;V++)for(var v=0;v<L.channels_out;v++)I>H&&(k[V][v]*=H,k[V][v]/=I);return $},this.calc_target_bits=function(_,b,E,R,h,k){var L=_.internal_flags,$=L.l3_side,P,I,H,ae,V=0;L.bitrate_index=L.VBR_max_bitrate;var v=new MeanBits(V);for(k[0]=e.ResvFrameBegin(_,v),V=v.bits,L.bitrate_index=1,V=t.getframebits(_)-L.sideinfo_len*8,h[0]=V/(L.mode_gr*L.channels_out),V=_.VBR_mean_bitrate_kbps*_.framesize*1e3,L.substep_shaping&1&&(V*=1.09),V/=_.out_samplerate,V-=L.sideinfo_len*8,V/=L.mode_gr*L.channels_out,P=.93+.07*(11-_.compression_ratio)/(11-5.5),P<.9&&(P=.9),P>1&&(P=1),I=0;I<L.mode_gr;I++){var D=0;for(H=0;H<L.channels_out;H++){if(R[I][H]=int(P*V),b[I][H]>700){var F=int((b[I][H]-700)/1.4),Y=$.tt[I][H];R[I][H]=int(P*V),Y.block_type==gn.SHORT_TYPE&&F<V/2&&(F=V/2),F>V*3/2?F=V*3/2:F<0&&(F=0),R[I][H]+=F}R[I][H]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(R[I][H]=LameInternalFlags.MAX_BITS_PER_CHANNEL),D+=R[I][H]}if(D>LameInternalFlags.MAX_BITS_PER_GRANULE)for(H=0;H<L.channels_out;++H)R[I][H]*=LameInternalFlags.MAX_BITS_PER_GRANULE,R[I][H]/=D}if(L.mode_ext==gn.MPG_MD_MS_LR)for(I=0;I<L.mode_gr;I++)n.reduce_side(R[I],E[I],V*L.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(ae=0,I=0;I<L.mode_gr;I++)for(H=0;H<L.channels_out;H++)R[I][H]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(R[I][H]=LameInternalFlags.MAX_BITS_PER_CHANNEL),ae+=R[I][H];if(ae>k[0])for(I=0;I<L.mode_gr;I++)for(H=0;H<L.channels_out;H++)R[I][H]*=k[0],R[I][H]/=ae}}var Q3=J3,e4=zn,m0=e4.assert;function t4(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,n){var r=e.internal_flags,i,s=r.l3_side,o=t.getframebits(e);n.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||e.disable_reservoir)&&(r.ResvMax=0);var l=n.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return l>i&&(l=i),m0(r.ResvMax%8==0),m0(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=n.bits/2,r.pinfo.resvsize=r.ResvSize),l},this.ResvMaxBits=function(e,n,r,i){var s=e.internal_flags,o,a=s.ResvSize,l=s.ResvMax;i!=0&&(a+=n),s.substep_shaping&1&&(l*=.9),r.bits=n,a*10>l*9?(o=a-l*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!e.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*n));var c=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return c-=o,c<0&&(c=0),c},this.ResvAdjust=function(e,n){e.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(e,n){var r,i=e.l3_side;e.ResvSize+=n*e.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=e.ResvSize%8)!=0&&(s+=r),r=e.ResvSize-s-e.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,e.ResvSize-=s}}var n4=t4;function r4(){var t="http://www.mp3dev.org/",e=3,n=98,r=4,i=0,s=93;this.getLameVersion=function(){return e+"."+n+"."+r},this.getLameShortVersion=function(){return e+"."+n+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+n+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var i4=r4,sa=zn,s4=sa.System,Bf=sa.VbrMode,_0=sa.ShortBlock,o4=sa.Arrays,Bu=sa.new_byte,a4=sa.assert;dl.NUMTOCENTRIES=100,dl.MAXFRAMESIZE=2880;function dl(){var t,e,n;this.setModules=function(V,v,D){t=V,e=v,n=D};var r=1,i=2,s=4,o=8,a=dl.NUMTOCENTRIES,l=dl.MAXFRAMESIZE,c=a+4+4+4+4+4,u=c+9+1+1+8+1+1+3+1+1+2+4+2+2,f=128,p=64,y=32,m=null,g="Xing",w="Info",_=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function b(V,v){if(V.nVbrNumFrames++,V.sum+=v,V.seen++,!(V.seen<V.want)&&(V.pos<V.size&&(V.bag[V.pos]=V.sum,V.pos++,V.seen=0),V.pos==V.size)){for(var D=1;D<V.size;D+=2)V.bag[D/2]=V.bag[D];V.want*=2,V.pos/=2}}function E(V,v){if(!(V.pos<=0))for(var D=1;D<a;++D){var F=D/a,Y,K,Q=0|Math.floor(F*V.pos);Q>V.pos-1&&(Q=V.pos-1),Y=V.bag[Q],K=V.sum;var W=0|256*Y/K;W>255&&(W=255),v[D]=255&W}}this.addVbrFrame=function(V){var v=V.internal_flags,D=Tables.bitrate_table[V.version][v.bitrate_index];a4(v.VBR_seek_table.bag!=null),b(v.VBR_seek_table,D)};function R(V,v){var D=V[v+0]&255;return D<<=8,D|=V[v+1]&255,D<<=8,D|=V[v+2]&255,D<<=8,D|=V[v+3]&255,D}function h(V,v,D){V[v+0]=255&(D>>24&255),V[v+1]=255&(D>>16&255),V[v+2]=255&(D>>8&255),V[v+3]=255&(D&255)}function k(V,v,D){V[v+0]=255&(D>>8&255),V[v+1]=255&(D&255)}function L(V,v){return new String(V,v,g.length(),m).equals(g)||new String(V,v,w.length(),m).equals(w)}function $(V,v,D){return 255&(V<<v|D&~(-1<<v))}function P(V,v){var D=V.internal_flags;v[0]=$(v[0],8,255),v[1]=$(v[1],3,7),v[1]=$(v[1],1,V.out_samplerate<16e3?0:1),v[1]=$(v[1],1,V.version),v[1]=$(v[1],2,1),v[1]=$(v[1],1,V.error_protection?0:1),v[2]=$(v[2],4,D.bitrate_index),v[2]=$(v[2],2,D.samplerate_index),v[2]=$(v[2],1,0),v[2]=$(v[2],1,V.extension),v[3]=$(v[3],2,V.mode.ordinal()),v[3]=$(v[3],2,D.mode_ext),v[3]=$(v[3],1,V.copyright),v[3]=$(v[3],1,V.original),v[3]=$(v[3],2,V.emphasis),v[0]=255;var F=255&(v[1]&241),Y;V.version==1?Y=f:V.out_samplerate<16e3?Y=y:Y=p,V.VBR==Bf.vbr_off&&(Y=V.brate);var K;V.free_format?K=0:K=255&16*t.BitrateIndex(Y,V.version,V.out_samplerate),V.version==1?(v[1]=255&(F|10),F=255&(v[2]&13),v[2]=255&(K|F)):(v[1]=255&(F|2),F=255&(v[2]&13),v[2]=255&(K|F))}this.getVbrTag=function(V){var v=new VBRTagData,D=0;v.flags=0;var F=V[D+1]>>3&1,Y=V[D+2]>>2&3,K=V[D+3]>>6&3,Q=V[D+2]>>4&15;if(Q=Tables.bitrate_table[F][Q],V[D+1]>>4==14?v.samprate=Tables.samplerate_table[2][Y]:v.samprate=Tables.samplerate_table[F][Y],F!=0?K!=3?D+=36:D+=21:K!=3?D+=21:D+=13,!L(V,D))return null;D+=4,v.hId=F;var W=v.flags=R(V,D);if(D+=4,W&r&&(v.frames=R(V,D),D+=4),W&i&&(v.bytes=R(V,D),D+=4),W&s){if(v.toc!=null)for(var O=0;O<a;O++)v.toc[O]=V[D+O];D+=a}v.vbrScale=-1,W&o&&(v.vbrScale=R(V,D),D+=4),v.headersize=(F+1)*72e3*Q/v.samprate,D+=21;var C=V[D+0]<<4;C+=V[D+1]>>4;var S=(V[D+1]&15)<<8;return S+=V[D+2]&255,(C<0||C>3e3)&&(C=-1),(S<0||S>3e3)&&(S=-1),v.encDelay=C,v.encPadding=S,v},this.InitVbrTag=function(V){var v=V.internal_flags,D;V.version==1?D=f:V.out_samplerate<16e3?D=y:D=p,V.VBR==Bf.vbr_off&&(D=V.brate);var F=(V.version+1)*72e3*D/V.out_samplerate,Y=v.sideinfo_len+u;if(v.VBR_seek_table.TotalFrameSize=F,F<Y||F>l){V.bWriteVbrTag=!1;return}v.VBR_seek_table.nVbrNumFrames=0,v.VBR_seek_table.nBytesWritten=0,v.VBR_seek_table.sum=0,v.VBR_seek_table.seen=0,v.VBR_seek_table.want=1,v.VBR_seek_table.pos=0,v.VBR_seek_table.bag==null&&(v.VBR_seek_table.bag=new int[400],v.VBR_seek_table.size=400);var K=Bu(l);P(V,K);for(var Q=v.VBR_seek_table.TotalFrameSize,W=0;W<Q;++W)e.add_dummy_byte(V,K[W]&255,1)};function I(V,v){var D=v^V;return v=v>>8^_[D&255],v}this.updateMusicCRC=function(V,v,D,F){for(var Y=0;Y<F;++Y)V[0]=I(v[D+Y],V[0])};function H(V,v,D,F,Y){var K=V.internal_flags,Q=0,W=V.encoder_delay,O=V.encoder_padding,C=100-10*V.VBR_q-V.quality,S=n.getLameVeryShortVersion(),M,X=0,ie,G=[1,5,3,2,4,0,3],z=0|(V.lowpassfreq/100+.5>255?255:V.lowpassfreq/100+.5),le=0,Me=0,_e=0,Ae=V.internal_flags.noise_shaping,Ee=0,Ve=0,Te=0,Le=0,Ie=0,et=(V.exp_nspsytune&1)!=0,B=(V.exp_nspsytune&2)!=0,x=!1,Ne=!1,We=V.internal_flags.nogap_total,tt=V.internal_flags.nogap_current,ke=V.ATHtype,Pe=0,Xe;switch(V.VBR){case vbr_abr:Xe=V.VBR_mean_bitrate_kbps;break;case vbr_off:Xe=V.brate;break;default:Xe=V.VBR_min_bitrate_kbps}switch(V.VBR.ordinal()<G.length?M=G[V.VBR.ordinal()]:M=0,ie=16*X+M,K.findReplayGain&&(K.RadioGain>510&&(K.RadioGain=510),K.RadioGain<-510&&(K.RadioGain=-510),Me=8192,Me|=3072,K.RadioGain>=0?Me|=K.RadioGain:(Me|=512,Me|=-K.RadioGain)),K.findPeakSample&&(le=Math.abs(0|K.PeakSample/32767*Math.pow(2,23)+.5)),We!=-1&&(tt>0&&(Ne=!0),tt<We-1&&(x=!0)),Pe=ke+((et?1:0)<<4)+((B?1:0)<<5)+((x?1:0)<<6)+((Ne?1:0)<<7),C<0&&(C=0),V.mode){case MONO:Ee=0;break;case STEREO:Ee=1;break;case DUAL_CHANNEL:Ee=2;break;case JOINT_STEREO:V.force_ms?Ee=4:Ee=3;break;case NOT_SET:default:Ee=7;break}V.in_samplerate<=32e3?Te=0:V.in_samplerate==48e3?Te=2:V.in_samplerate>48e3?Te=3:Te=1,(V.short_blocks==_0.short_block_forced||V.short_blocks==_0.short_block_dispensed||V.lowpassfreq==-1&&V.highpassfreq==-1||V.scale_left<V.scale_right||V.scale_left>V.scale_right||V.disable_reservoir&&V.brate<320||V.noATH||V.ATHonly||ke==0||V.in_samplerate<=32e3)&&(Ve=1),Le=Ae+(Ee<<2)+(Ve<<5)+(Te<<6),Ie=K.nMusicCRC,h(D,F+Q,C),Q+=4;for(var qe=0;qe<9;qe++)D[F+Q+qe]=255&S.charAt(qe);Q+=9,D[F+Q]=255&ie,Q++,D[F+Q]=255&z,Q++,h(D,F+Q,le),Q+=4,k(D,F+Q,Me),Q+=2,k(D,F+Q,_e),Q+=2,D[F+Q]=255&Pe,Q++,Xe>=255?D[F+Q]=255:D[F+Q]=255&Xe,Q++,D[F+Q]=255&W>>4,D[F+Q+1]=255&(W<<4)+(O>>8),D[F+Q+2]=255&O,Q+=3,D[F+Q]=255&Le,Q++,D[F+Q++]=0,k(D,F+Q,V.preset),Q+=2,h(D,F+Q,v),Q+=4,k(D,F+Q,Ie),Q+=2;for(var it=0;it<Q;it++)Y=I(D[F+it],Y);return k(D,F+Q,Y),Q+=2,Q}function ae(V){V.seek(0);var v=Bu(10);V.readFully(v);var D;return new String(v,"ISO-8859-1").startsWith("ID3")?D=0:D=((v[6]&127)<<21|(v[7]&127)<<14|(v[8]&127)<<7|v[9]&127)+v.length,D}this.getLameTagFrame=function(V,v){var D=V.internal_flags;if(!V.bWriteVbrTag||D.Class_ID!=Lame.LAME_ID||D.VBR_seek_table.pos<=0)return 0;if(v.length<D.VBR_seek_table.TotalFrameSize)return D.VBR_seek_table.TotalFrameSize;o4.fill(v,0,D.VBR_seek_table.TotalFrameSize,0),P(V,v);var F=Bu(a);if(V.free_format)for(var Y=1;Y<a;++Y)F[Y]=255&255*Y/100;else E(D.VBR_seek_table,F);var K=D.sideinfo_len;V.error_protection&&(K-=2),V.VBR==Bf.vbr_off?(v[K++]=255&w.charAt(0),v[K++]=255&w.charAt(1),v[K++]=255&w.charAt(2),v[K++]=255&w.charAt(3)):(v[K++]=255&g.charAt(0),v[K++]=255&g.charAt(1),v[K++]=255&g.charAt(2),v[K++]=255&g.charAt(3)),h(v,K,r+i+s+o),K+=4,h(v,K,D.VBR_seek_table.nVbrNumFrames),K+=4;var Q=D.VBR_seek_table.nBytesWritten+D.VBR_seek_table.TotalFrameSize;h(v,K,0|Q),K+=4,s4.arraycopy(F,0,v,K,F.length),K+=F.length,V.error_protection&&e.CRC_writeheader(D,v);for(var W=0,Y=0;Y<K;Y++)W=I(v[Y],W);return K+=H(V,Q,v,K,W),D.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(V,v){var D=V.internal_flags;if(D.VBR_seek_table.pos<=0||(v.seek(v.length()),v.length()==0))return-1;var F=ae(v);v.seek(F);var Y=Bu(l),K=getLameTagFrame(V,Y);return K>Y.length?-1:(K<1||v.write(Y,0,K),0)}}var l4=dl,g0=zn,b0=g0.new_byte,u4=g0.assert,c4=Lf(),f4=U3,d4=Zh,h4=s0(),p4=Q3,m4=a0(),_4=n4,g4=ul,b4=Mf();xr();var w4=i4,y4=l4;function v4(){this.setModules=function(t,e){}}function E4(){this.setModules=function(t,e,n){}}function S4(){}function T4(){this.setModules=function(t,e){}}function k4(t,e,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,n=128);var r=new c4,i=new v4,s=new d4,o=new b4,a=new f4,l=new h4,c=new p4,u=new y4,f=new w4,p=new T4,y=new _4,m=new m4,g=new E4,w=new S4;r.setModules(s,o,a,l,c,u,f,p,w),o.setModules(s,w,f,u),p.setModules(o,f),a.setModules(r),c.setModules(o,y,l,m),l.setModules(m,y,r.enc.psy),y.setModules(o),m.setModules(l),u.setModules(r,o,f),i.setModules(g,w),g.setModules(f,p,a);var _=r.lame_init();_.num_channels=t,_.in_samplerate=e,_.brate=n,_.mode=g4.STEREO,_.quality=3,_.bWriteVbrTag=!1,_.disable_reservoir=!0,_.write_id3tag_automatic=!1,r.lame_init_params(_);var b=1152,E=0|1.25*b+7200,R=b0(E);this.encodeBuffer=function(h,k){t==1&&(k=h),u4(h.length==k.length),h.length>b&&(b=h.length,E=0|1.25*b+7200,R=b0(E));var L=r.lame_encode_buffer(_,h,k,h.length,R,0,E);return new Int8Array(R.subarray(0,L))},this.flush=function(){var h=r.lame_encode_flush(_,R,0,E);return new Int8Array(R.subarray(0,h))}}function ji(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Ou(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}ji.RIFF=Ou("RIFF"),ji.WAVE=Ou("WAVE"),ji.fmt_=Ou("fmt "),ji.data=Ou("data"),ji.readHeader=function(t){var e=new ji,n=t.getUint32(0,!1);if(ji.RIFF==n&&(t.getUint32(4,!0),ji.WAVE==t.getUint32(8,!1)&&ji.fmt_==t.getUint32(12,!1))){var r=t.getUint32(16,!0),i=20;switch(r){case 16:case 18:e.channels=t.getUint16(i+2,!0),e.sampleRate=t.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=ji.data,o=0;s!=n&&(n=t.getUint32(i,!1),o=t.getUint32(i+4,!0),s!=n);)i+=o+8;return e.dataLen=o,e.dataOffset=i+8,e}};var A4=k4;const C4=t=>e=>{const n=t(e);return e.add(n),n},M4=t=>(e,n)=>(t.set(e,n),n),w0=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,y0=536870912,v0=y0*2,R4=(t,e)=>n=>{const r=e.get(n);let i=r===void 0?n.size:r<v0?r+1:0;if(!n.has(i))return t(n,i);if(n.size<y0){for(;n.has(i);)i=Math.floor(Math.random()*v0);return t(n,i)}if(n.size>w0)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;n.has(i);)i=Math.floor(Math.random()*w0);return t(n,i)},E0=new WeakMap,L4=M4(E0),Of=R4(L4,E0),P4=C4(Of),I4=t=>typeof t.start=="function",S0=new WeakMap,B4=t=>({...t,connect:({call:e})=>async()=>{const{port1:n,port2:r}=new MessageChannel,i=await e("connect",{port:n},[n]);return S0.set(r,i),r},disconnect:({call:e})=>async n=>{const r=S0.get(n);if(r===void 0)throw new Error("The given port is not connected.");await e("disconnect",{portId:r})},isSupported:({call:e})=>()=>e("isSupported")}),Df=new WeakMap,O4=t=>{if(Df.has(t))return Df.get(t);const e=new Map;return Df.set(t,e),e},T0=t=>{const e=B4(t);return n=>{const r=O4(n);n.addEventListener("message",({data:a})=>{const{id:l}=a;if(l!==null&&r.has(l)){const{reject:c,resolve:u}=r.get(l);r.delete(l),a.error===void 0?u(a.result):c(new Error(a.error.message))}}),I4(n)&&n.start();const i=(a,l=null,c=[])=>new Promise((u,f)=>{const p=Of(r);r.set(p,{reject:f,resolve:u}),l===null?n.postMessage({id:p,method:a},c):n.postMessage({id:p,method:a,params:l},c)}),s=(a,l,c=[])=>{n.postMessage({id:null,method:a,params:l},c)};let o={};for(const[a,l]of Object.entries(e))o={...o,[a]:l({call:i,notify:s})};return{...o}}},k0=new Set,D4=T0({encode:({call:t})=>async(e,n)=>{const r=await t("encode",{encoderId:e,timeslice:n});return k0.delete(e),r},instantiate:({call:t})=>async(e,n)=>{const r=P4(k0),i=await t("instantiate",{encoderId:r,mimeType:e,sampleRate:n});return{encoderId:r,port:i}},register:({call:t})=>e=>t("register",{port:e},[e])}),N4=t=>{const e=new Worker(t);return D4(e)},F4=`(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,s=2*o,a=function(e,t){return function(r){var a=t.get(r),c=void 0===a?r.size:a<s?a+1:0;if(!r.has(c))return e(r,c);if(r.size<o){for(;r.has(c);)c=Math.floor(Math.random()*s);return e(r,c)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(c);)c=Math.floor(Math.random()*n);return e(r,c)}},c=new WeakMap,i=r(c),l=a(i,c),u=t(l);e.addUniqueNumber=u,e.generateUniqueNumber=l}(t)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,o=(e,t)=>Object.assign(new Error(e),{status:t}),s=t=>o('The handler of the method called "'.concat(t,'" returned an unexpected result.'),e),a=(t,r)=>async a=>{let{data:{id:c,method:i,params:l}}=a;const u=r[i];try{if(void 0===u)throw(e=>o('The requested method called "'.concat(e,'" is not supported.'),n))(i);const r=void 0===l?u():u(l);if(void 0===r)throw(t=>o('The handler of the method called "'.concat(t,'" returned no required result.'),e))(i);const a=r instanceof Promise?await r:r;if(null===c){if(void 0!==a.result)throw s(i)}else{if(void 0===a.result)throw s(i);const{result:e,transferables:r=[]}=a;t.postMessage({id:c,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:c})}};var c=r(455);const i=new Map,l=(e,r,n)=>({...r,connect:t=>{let{port:n}=t;n.start();const o=e(n,r),s=(0,c.generateUniqueNumber)(i);return i.set(s,(()=>{o(),n.close(),i.delete(s)})),{result:s}},disconnect:e=>{let{portId:r}=e;const n=i.get(r);if(void 0===n)throw(e=>o('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),t))(r);return n(),{result:null}},isSupported:async()=>{if(await new Promise((e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=t=>{let{data:r}=t;return e(null!==r)},n.postMessage(t,[t])}))){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),u=function(e,t){const r=l(u,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0),n=a(e,r);return e.addEventListener("message",n),()=>e.removeEventListener("message",n)},d=e=>{e.onmessage=null,e.close()},h=new WeakMap,f=new WeakMap,p=(e=>{const t=(r=e,{...r,connect:e=>{let{call:t}=e;return async()=>{const{port1:e,port2:r}=new MessageChannel,n=await t("connect",{port:e},[e]);return h.set(r,n),r}},disconnect:e=>{let{call:t}=e;return async e=>{const r=h.get(e);if(void 0===r)throw new Error("The given port is not connected.");await t("disconnect",{portId:r})}},isSupported:e=>{let{call:t}=e;return()=>t("isSupported")}});var r;return e=>{const r=(e=>{if(f.has(e))return f.get(e);const t=new Map;return f.set(e,t),t})(e);e.addEventListener("message",(e=>{let{data:t}=e;const{id:n}=t;if(null!==n&&r.has(n)){const{reject:e,resolve:o}=r.get(n);r.delete(n),void 0===t.error?o(t.result):e(new Error(t.error.message))}})),(e=>"function"==typeof e.start)(e)&&e.start();const n=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(((s,a)=>{const i=(0,c.generateUniqueNumber)(r);r.set(i,{reject:a,resolve:s}),null===n?e.postMessage({id:i,method:t},o):e.postMessage({id:i,method:t,params:n},o)}))},o=function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.postMessage({id:null,method:t,params:r},n)};let s={};for(const[e,r]of Object.entries(t))s={...s,[e]:r({call:n,notify:o})};return{...s}}})({characterize:e=>{let{call:t}=e;return()=>t("characterize")},encode:e=>{let{call:t}=e;return(e,r)=>t("encode",{recordingId:e,timeslice:r})},record:e=>{let{call:t}=e;return async(e,r,n)=>{await t("record",{recordingId:e,sampleRate:r,typedArrays:n},n.map((e=>{let{buffer:t}=e;return t})))}}}),w=async(e,t)=>{const r=p(t),n=await r.characterize(),o=n.toString();if(e.has(o))throw new Error("There is already an encoder stored which handles exactly the same mime types.");return e.set(o,[n,r]),n},m=new Map,g=(e=>t=>{const r=e.get(t);if(void 0===r)throw new Error("There was no instance of an encoder stored with the given id.");return r})(m),v=((e,t)=>r=>{const n=t(r);return e.delete(r),n})(m,g),y=new Map,M=((e,t)=>r=>{const[n,o,s,a]=t(r);return s?new Promise((t=>{o.onmessage=s=>{let{data:c}=s;0===c.length?(e(o),t(n.encode(r,null))):n.record(r,a,c)}})):n.encode(r,null)})(d,v),E=(e=>t=>{for(const[r,n]of Array.from(e.values()))if(r.test(t))return n;throw new Error("There is no encoder registered which could handle the given mimeType.")})(y),b=((e,t,r)=>(n,o,s)=>{if(t.has(n))throw new Error('There is already an encoder registered with an id called "'.concat(n,'".'));const a=r(o),{port1:c,port2:i}=new MessageChannel,l=[a,c,!0,s];return t.set(n,l),c.onmessage=t=>{let{data:r}=t;0===r.length?(e(c),l[2]=!1):a.record(n,s,r.map((e=>"number"==typeof e?new Float32Array(e):e)))},i})(d,m,E),T=(e=>(t,r)=>{const[n]=e(t);return n.encode(t,r)})(g);u(self,{encode:async e=>{let{encoderId:t,timeslice:r}=e;const n=null===r?await M(t):await T(t,r);return{result:n,transferables:n}},instantiate:e=>{let{encoderId:t,mimeType:r,sampleRate:n}=e;const o=b(t,r,n);return{result:o,transferables:[o]}},register:async e=>{let{port:t}=e;return{result:await w(y,t)}}})})()})();`,$4=new Blob([F4],{type:"application/javascript; charset=utf-8"}),A0=URL.createObjectURL($4),Nf=N4(A0),Du=Nf.encode,C0=Nf.instantiate,V4=Nf.register;URL.revokeObjectURL(A0);const x4=t=>(e,n)=>{if(t===null)throw new Error("A native BlobEvent could not be created.");return new t(e,n)},H4=(t,e)=>(n,r,i)=>{const s=[];let o=r,a=0;for(;a<n.byteLength;)if(o===null){const l=e(n,a);if(l===null)break;const{length:c,type:u}=l;o=u,a+=c}else{const l=t(n,a,o,i);if(l===null)break;const{content:c,length:u}=l;o=null,a+=u,c!==null&&s.push(c)}return{contents:s,currentElementType:o,offset:a}},U4=(t,e)=>class{constructor(r=null){this._listeners=new WeakMap,this._nativeEventTarget=r===null?t():r}addEventListener(r,i,s){if(i!==null){let o=this._listeners.get(i);o===void 0&&(o=e(this,i),typeof i=="function"&&this._listeners.set(i,o)),this._nativeEventTarget.addEventListener(r,o,s)}}dispatchEvent(r){return this._nativeEventTarget.dispatchEvent(r)}removeEventListener(r,i,s){const o=i===null?void 0:this._listeners.get(i);this._nativeEventTarget.removeEventListener(r,o===void 0?null:o,s)}},W4=t=>()=>{if(t===null)throw new Error("A native EventTarget could not be created.");return t.document.createElement("p")},j4=(t="")=>{try{return new DOMException(t,"InvalidModificationError")}catch(e){return e.code=13,e.message=t,e.name="InvalidModificationError",e}},G4=()=>{try{return new DOMException("","InvalidStateError")}catch(t){return t.code=11,t.name="InvalidStateError",t}},z4=(t,e,n,r,i,s,o)=>class extends s{constructor(l,c={}){const{mimeType:u}=c;if(o!==null&&(u===void 0||o.isTypeSupported!==void 0&&o.isTypeSupported(u))){const f=t(o,l,c);super(f),this._internalMediaRecorder=f}else if(u!==void 0&&i.some(f=>f.test(u)))super(),o!==null&&o.isTypeSupported!==void 0&&o.isTypeSupported("audio/webm;codecs=pcm")?this._internalMediaRecorder=r(this,o,l,u):this._internalMediaRecorder=n(this,l,u);else throw o!==null&&t(o,l,c),e();this._ondataavailable=null,this._onerror=null,this._onpause=null,this._onresume=null,this._onstart=null,this._onstop=null}get mimeType(){return this._internalMediaRecorder.mimeType}get ondataavailable(){return this._ondataavailable===null?this._ondataavailable:this._ondataavailable[0]}set ondataavailable(l){if(this._ondataavailable!==null&&this.removeEventListener("dataavailable",this._ondataavailable[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("dataavailable",c),this._ondataavailable=[l,c]}else this._ondataavailable=null}get onerror(){return this._onerror===null?this._onerror:this._onerror[0]}set onerror(l){if(this._onerror!==null&&this.removeEventListener("error",this._onerror[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("error",c),this._onerror=[l,c]}else this._onerror=null}get onpause(){return this._onpause===null?this._onpause:this._onpause[0]}set onpause(l){if(this._onpause!==null&&this.removeEventListener("pause",this._onpause[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("pause",c),this._onpause=[l,c]}else this._onpause=null}get onresume(){return this._onresume===null?this._onresume:this._onresume[0]}set onresume(l){if(this._onresume!==null&&this.removeEventListener("resume",this._onresume[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("resume",c),this._onresume=[l,c]}else this._onresume=null}get onstart(){return this._onstart===null?this._onstart:this._onstart[0]}set onstart(l){if(this._onstart!==null&&this.removeEventListener("start",this._onstart[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("start",c),this._onstart=[l,c]}else this._onstart=null}get onstop(){return this._onstop===null?this._onstop:this._onstop[0]}set onstop(l){if(this._onstop!==null&&this.removeEventListener("stop",this._onstop[1]),typeof l=="function"){const c=l.bind(this);this.addEventListener("stop",c),this._onstop=[l,c]}else this._onstop=null}get state(){return this._internalMediaRecorder.state}pause(){return this._internalMediaRecorder.pause()}resume(){return this._internalMediaRecorder.resume()}start(l){return this._internalMediaRecorder.start(l)}stop(){return this._internalMediaRecorder.stop()}static isTypeSupported(l){return o!==null&&o.isTypeSupported!==void 0&&o.isTypeSupported(l)||i.some(c=>c.test(l))}},X4=t=>t!==null&&t.BlobEvent!==void 0?t.BlobEvent:null,Y4=t=>t===null||t.MediaRecorder===void 0?null:t.MediaRecorder,K4=t=>(e,n,r)=>{const i=new Map,s=new WeakMap,o=new WeakMap,a=[],l=new e(n,r),c=new WeakMap;return l.addEventListener("stop",({isTrusted:u})=>{u&&setTimeout(()=>a.shift())}),l.addEventListener=(u=>(f,p,y)=>{let m=p;if(typeof p=="function")if(f==="dataavailable"){const g=[];m=w=>{const[[_,b]=[!1,!1]]=a;_&&!b?g.push(w):p.call(l,w)},i.set(p,g),s.set(p,m)}else f==="error"?(m=g=>{g instanceof ErrorEvent?p.call(l,g):p.call(l,new ErrorEvent("error",{error:g.error}))},o.set(p,m)):f==="stop"&&(m=g=>{for(const[w,_]of i.entries())if(_.length>0){const[b]=_;_.length>1&&Object.defineProperty(b,"data",{value:new Blob(_.map(({data:E})=>E),{type:b.data.type})}),_.length=0,w.call(l,b)}p.call(l,g)},c.set(p,m));return u.call(l,f,m,y)})(l.addEventListener),l.removeEventListener=(u=>(f,p,y)=>{let m=p;if(typeof p=="function"){if(f==="dataavailable"){i.delete(p);const g=s.get(p);g!==void 0&&(m=g)}else if(f==="error"){const g=o.get(p);g!==void 0&&(m=g)}else if(f==="stop"){const g=c.get(p);g!==void 0&&(m=g)}}return u.call(l,f,m,y)})(l.removeEventListener),l.start=(u=>f=>{if(r.mimeType!==void 0&&r.mimeType.startsWith("audio/")&&n.getVideoTracks().length>0)throw t();return l.state==="inactive"&&a.push([f!==void 0,!0]),f===void 0?u.call(l):u.call(l,f)})(l.start),l.stop=(u=>()=>{l.state!=="inactive"&&(a[0][1]=!1),u.call(l)})(l.stop),l},Ff=()=>{try{return new DOMException("","NotSupportedError")}catch(t){return t.code=9,t.name="NotSupportedError",t}},q4=t=>(e,n,r,i=2)=>{const s=t(e,n);if(s===null)return s;const{length:o,value:a}=s;if(r==="master")return{content:null,length:o};if(n+o+a>e.byteLength)return null;if(r==="binary"){const l=(a/Float32Array.BYTES_PER_ELEMENT-1)/i,c=Array.from({length:i},()=>new Float32Array(l));for(let u=0;u<l;u+=1){const f=u*i+1;for(let p=0;p<i;p+=1)c[p][u]=e.getFloat32(n+o+(f+p)*Float32Array.BYTES_PER_ELEMENT,!0)}return{content:c,length:o+a}}return{content:null,length:o+a}},Z4=t=>(e,n)=>{const r=t(e,n);if(r===null)return r;const{length:i,value:s}=r;return s===35?{length:i,type:"binary"}:s===46||s===97||s===88713574||s===106212971||s===139690087||s===172351395||s===256095861?{length:i,type:"master"}:{length:i,type:"unknown"}},J4=t=>(e,n)=>{const r=t(e,n);if(r===null)return r;const i=n+Math.floor((r-1)/8);if(i+r>e.byteLength)return null;let o=e.getUint8(i)&(1<<8-r%8)-1;for(let a=1;a<r;a+=1)o=(o<<8)+e.getUint8(i+a);return{length:r,value:o}},M0=Symbol.observable||"@@observable";function Q4(t){return Symbol.observable||(typeof t=="function"&&t.prototype&&t.prototype[Symbol.observable]?(t.prototype[M0]=t.prototype[Symbol.observable],delete t.prototype[Symbol.observable]):(t[M0]=t[Symbol.observable],delete t[Symbol.observable])),t}const Nu=()=>{},R0=t=>{throw t};function e5(t){return t?t.next&&t.error&&t.complete?t:{complete:(t.complete??Nu).bind(t),error:(t.error??R0).bind(t),next:(t.next??Nu).bind(t)}:{complete:Nu,error:R0,next:Nu}}const t5=t=>(e,n,r)=>t(i=>{const s=o=>i.next(o);return e.addEventListener(n,s,r),()=>e.removeEventListener(n,s,r)}),n5=((t,e)=>{const n=()=>{},r=i=>typeof i[0]=="function";return i=>{const s=(...o)=>{const a=i(r(o)?e({next:o[0]}):e(...o));return a!==void 0?a:n};return s[Symbol.observable]=()=>({subscribe:(...o)=>({unsubscribe:s(...o)})}),t(s)}})(Q4,e5),L0=t5(n5),r5=(t,e,n)=>async r=>{const i=new t([n],{type:"application/javascript; charset=utf-8"}),s=e.createObjectURL(i);try{await r(s)}finally{e.revokeObjectURL(s)}},i5=t=>({data:e})=>{const{id:n}=e;if(n!==null){const r=t.get(n);if(r!==void 0){const{reject:i,resolve:s}=r;t.delete(n),e.error===void 0?s(e.result):i(new Error(e.error.message))}}},s5=t=>(e,n)=>(r,i=[])=>new Promise((s,o)=>{const a=t(e);e.set(a,{reject:o,resolve:s}),n.postMessage({id:a,...r},i)}),o5=(t,e,n,r)=>(i,s,o={})=>{const a=new i(s,"recorder-audio-worklet-processor",{...o,channelCountMode:"explicit",numberOfInputs:1,numberOfOutputs:0}),l=new Map,c=e(l,a.port),u=n(a.port,"message")(t(l));a.port.start();let f="inactive";return Object.defineProperties(a,{pause:{get(){return async()=>(r(["recording"],f),f="paused",c({method:"pause"}))}},port:{get(){throw new Error("The port of a RecorderAudioWorkletNode can't be accessed.")}},record:{get(){return async p=>(r(["inactive"],f),f="recording",c({method:"record",params:{encoderPort:p}},[p]))}},resume:{get(){return async()=>(r(["paused"],f),f="recording",c({method:"resume"}))}},stop:{get(){return async()=>{r(["paused","recording"],f),f="stopped";try{await c({method:"stop"})}finally{u()}}}}}),a},a5=(t,e)=>{if(!t.includes(e))throw new Error(`Expected the state to be ${t.map(n=>`"${n}"`).join(" or ")} but it was "${e}".`)},l5=r5(Blob,URL,'(()=>{"use strict";class e extends AudioWorkletProcessor{constructor(){super(),this._encoderPort=null,this._numberOfChannels=0,this._state="inactive",this.port.onmessage=e=>{let{data:t}=e;"pause"===t.method?"active"===this._state||"recording"===this._state?(this._state="paused",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"record"===t.method?"inactive"===this._state?(this._encoderPort=t.params.encoderPort,this._state="active",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"resume"===t.method?"paused"===this._state?(this._state="active",this._sendAcknowledgement(t.id)):this._sendUnexpectedStateError(t.id):"stop"===t.method?"active"!==this._state&&"paused"!==this._state&&"recording"!==this._state||null===this._encoderPort?this._sendUnexpectedStateError(t.id):(this._stop(this._encoderPort),this._sendAcknowledgement(t.id)):"number"==typeof t.id&&this.port.postMessage({error:{code:-32601,message:"The requested method is not supported."},id:t.id})}}process(e){let[t]=e;if("inactive"===this._state||"paused"===this._state)return!0;if("active"===this._state){if(void 0===t)throw new Error("No channelData was received for the first input.");if(0===t.length)return!0;this._state="recording"}if("recording"===this._state&&null!==this._encoderPort){if(void 0===t)throw new Error("No channelData was received for the first input.");return 0===t.length?this._encoderPort.postMessage(Array.from({length:this._numberOfChannels},(()=>128))):(this._encoderPort.postMessage(t,t.map((e=>{let{buffer:t}=e;return t}))),this._numberOfChannels=t.length),!0}return!1}_sendAcknowledgement(e){this.port.postMessage({id:e,result:null})}_sendUnexpectedStateError(e){this.port.postMessage({error:{code:-32603,message:"The internal state does not allow to process the given message."},id:e})}_stop(e){e.postMessage([]),e.close(),this._encoderPort=null,this._state="stopped"}}e.parameterDescriptors=[],registerProcessor("recorder-audio-worklet-processor",e)})();'),u5=o5(i5,s5(Of),L0,a5),P0=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),I0=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),$f=(t,e)=>({startTime:e,type:"setValue",value:t}),B0=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),O0=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),oa=t=>t.type==="exponentialRampToValue",Fu=t=>t.type==="linearRampToValue",Os=t=>oa(t)||Fu(t),Vf=t=>t.type==="setValue",hs=t=>t.type==="setValueCurve",$u=(t,e,n,r)=>{const i=t[e];return i===void 0?r:Os(i)||Vf(i)?i.value:hs(i)?i.values[i.values.length-1]:O0(n,$u(t,e-1,i.startTime,r),i)},D0=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:Os(n)?[n.endTime,n.value]:Vf(n)?[n.startTime,n.value]:hs(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,$u(t,e-1,n.startTime,i)],xf=t=>t.type==="cancelAndHold",Hf=t=>t.type==="cancelScheduledValues",Ds=t=>xf(t)||Hf(t)?t.cancelTime:oa(t)||Fu(t)?t.endTime:t.startTime,N0=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,F0=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),c5=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},f5=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return c5(r,i)},Vu=t=>t.type==="setTarget";class d5{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=Ds(e);if(xf(e)||Hf(e)){const r=this._automationEvents.findIndex(s=>Hf(e)&&hs(s)?s.startTime+s.duration>=n:Ds(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),xf(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Os(i)){if(s!==void 0&&Vu(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:hs(s)?s.startTime+s.duration:Ds(s),a=s===void 0?this._defaultValue:hs(s)?s.values[s.values.length-1]:s.value,l=oa(i)?N0(n,o,a,i):F0(n,o,a,i),c=oa(i)?P0(l,n,this._currenTime):I0(l,n,this._currenTime);this._automationEvents.push(c)}if(s!==void 0&&Vu(s)&&this._automationEvents.push($f(this.getValue(n),n)),s!==void 0&&hs(s)&&s.startTime+s.duration>n){const o=n-s.startTime,a=(s.values.length-1)/s.duration,l=Math.max(2,1+Math.ceil(o*a)),c=o/(l-1)*a,u=s.values.slice(0,l);if(c<1)for(let f=1;f<l;f+=1){const p=c*f%1;u[f]=s.values[f-1]*(1-p)+s.values[f]*p}this._automationEvents[this._automationEvents.length-1]=B0(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>Ds(o)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&hs(i)&&Ds(i)+i.duration>n)return!1;const s=oa(e)?P0(e.value,e.endTime,this._currenTime):Fu(e)?I0(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(hs(e)&&n+e.duration>Ds(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>Ds(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];Vu(i)&&r.unshift($f($u(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(o=>Ds(o)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&Vu(s)&&(r===void 0||!Os(r)||r.insertTime>e))return O0(e,$u(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&Vf(s)&&(r===void 0||!Os(r)))return s.value;if(s!==void 0&&hs(s)&&(r===void 0||!Os(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?f5(e,s):s.values[s.values.length-1];if(s!==void 0&&Os(s)&&(r===void 0||!Os(r)))return s.value;if(r!==void 0&&oa(r)){const[o,a]=D0(this._automationEvents,i,s,r,this._defaultValue);return N0(e,o,a,r)}if(r!==void 0&&Fu(r)){const[o,a]=D0(this._automationEvents,i,s,r,this._defaultValue);return F0(e,o,a,r)}return this._defaultValue}}const h5=t=>({cancelTime:t,type:"cancelAndHold"}),p5=t=>({cancelTime:t,type:"cancelScheduledValues"}),m5=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),_5=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),g5=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),b5=()=>new DOMException("","AbortError"),w5=t=>(e,n,[r,i,s],o)=>{t(e[i],[n,r,s],a=>a[0]===n&&a[1]===r,o)},y5=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},v5=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},aa=new WeakSet,$0=new WeakMap,V0=new WeakMap,x0=new WeakMap,H0=new WeakMap,U0=new WeakMap,W0=new WeakMap,Uf=new WeakMap,Wf=new WeakMap,jf=new WeakMap,j0={construct(){return j0}},E5=t=>{try{const e=new Proxy(t,j0);new e}catch{return!1}return!0},G0=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,z0=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(G0);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(G0)}return[n.join(";"),r]},X0=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Y0=t=>{if(!E5(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},S5=(t,e,n,r,i,s,o,a,l,c,u,f,p)=>{let y=0;return(m,g,w={credentials:"omit"})=>{const _=u.get(m);if(_!==void 0&&_.has(g))return Promise.resolve();const b=c.get(m);if(b!==void 0){const h=b.get(g);if(h!==void 0)return h}const E=s(m),R=E.audioWorklet===void 0?i(g).then(([h,k])=>{const[L,$]=z0(h,k),P=`${L};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${$}
})})(window,'_AWGS')`;return n(P)}).then(()=>{const h=p._AWGS.pop();if(h===void 0)throw new SyntaxError;r(E.currentTime,E.sampleRate,()=>h(class{},void 0,(k,L)=>{if(k.trim()==="")throw e();const $=Wf.get(E);if($!==void 0){if($.has(k))throw e();Y0(L),X0(L.parameterDescriptors),$.set(k,L)}else Y0(L),X0(L.parameterDescriptors),Wf.set(E,new Map([[k,L]]))},E.sampleRate,void 0,void 0))}):Promise.all([i(g),Promise.resolve(t(f,f))]).then(([[h,k],L])=>{const $=y+1;y=$;const[P,I]=z0(h,k),v=`${P};((AudioWorkletProcessor,registerProcessor)=>{${I}
})(${L?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${L?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${L?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${$}',class extends AudioWorkletProcessor{process(){return !1}})`,D=new Blob([v],{type:"application/javascript; charset=utf-8"}),F=URL.createObjectURL(D);return E.audioWorklet.addModule(F,w).then(()=>{if(a(E))return E;const Y=o(E);return Y.audioWorklet.addModule(F,w).then(()=>Y)}).then(Y=>{if(l===null)throw new SyntaxError;try{new l(Y,`__sac${$}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(F))});return b===void 0?c.set(m,new Map([[g,R]])):b.set(g,R),R.then(()=>{const h=u.get(m);h===void 0?u.set(m,new Set([g])):h.add(g)}).finally(()=>{const h=c.get(m);h!==void 0&&h.delete(g)}),R}},Bi=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},xu=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},K0=(t,e,n,r)=>{const i=Bi(t,e),s=xu(i,o=>o[0]===n&&o[1]===r);return i.size===0&&t.delete(e),s},hl=t=>Bi(W0,t),Hu=t=>{if(aa.has(t))throw new Error("The AudioNode is already stored.");aa.add(t),hl(t).forEach(e=>e(!0))},q0=t=>"port"in t,Gf=t=>{if(!aa.has(t))throw new Error("The AudioNode is not stored.");aa.delete(t),hl(t).forEach(e=>e(!1))},zf=(t,e)=>{!q0(t)&&e.every(n=>n.size===0)&&Gf(t)},T5=(t,e,n,r,i,s,o,a,l,c,u,f,p)=>{const y=new WeakMap;return(m,g,w,_,b)=>{const{activeInputs:E,passiveInputs:R}=s(g),{outputs:h}=s(m),k=a(m),L=$=>{const P=l(g),I=l(m);if($){const H=K0(R,m,w,_);t(E,m,H,!1),!b&&!f(m)&&n(I,P,w,_),p(g)&&Hu(g)}else{const H=r(E,m,w,_);e(R,_,H,!1),!b&&!f(m)&&i(I,P,w,_);const ae=o(g);if(ae===0)u(g)&&zf(g,E);else{const V=y.get(g);V!==void 0&&clearTimeout(V),y.set(g,setTimeout(()=>{u(g)&&zf(g,E)},ae*1e3))}}};return c(h,[g,w,_],$=>$[0]===g&&$[1]===w&&$[2]===_,!0)?(k.add(L),u(m)?t(E,m,[w,_,L],!0):e(R,_,[m,w,L],!0),!0):!1}},k5=t=>(e,n,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],l=>l[0]===i&&l[1]===n,o)},A5=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},C5=t=>(e,n)=>{t(e).add(n)},Z0=(t,e)=>t.context===e,J0=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},ao=()=>new DOMException("","IndexSizeError"),M5=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?ao():r}})(t.getChannelData)},R5={numberOfChannels:1},L5=(t,e,n,r,i,s,o,a)=>{let l=null;return class o_{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:f,numberOfChannels:p,sampleRate:y}={...R5,...u};l===null&&(l=new i(1,1,44100));const m=r!==null&&e(s,s)?new r({length:f,numberOfChannels:p,sampleRate:y}):l.createBuffer(p,f,y);if(m.numberOfChannels===0)throw n();return typeof m.copyFromChannel!="function"?(o(m),M5(m)):e(J0,()=>J0(m))||a(m),t.add(m),m}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===o_.prototype||t.has(u)}}},Uu=-34028234663852886e22,Xf=-Uu,lo=t=>aa.has(t),P5={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},I5=(t,e,n,r,i,s,o,a)=>class extends t{constructor(c,u){const f=s(c),p={...P5,...u},y=i(f,p),m=o(f),g=m?e():null;super(c,!1,y,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=p.buffer!==null,this._nativeAudioBufferSourceNode=y,this._onended=null,this._playbackRate=n(this,m,y.playbackRate,Xf,Uu)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeAudioBufferSourceNode.onended=u;const f=this._nativeAudioBufferSourceNode.onended;this._onended=f!==null&&f===u?c:f}get playbackRate(){return this._playbackRate}start(c=0,u=0,f){if(this._nativeAudioBufferSourceNode.start(c,u,f),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=f===void 0?[c,u]:[c,u,f]),this.context.state!=="closed"){Hu(this);const p=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",p),lo(this)&&Gf(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",p)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},B5=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const l=async(c,u)=>{let f=n(c);const p=Z0(f,u);if(!p){const y={buffer:f.buffer,channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,loop:f.loop,loopEnd:f.loopEnd,loopStart:f.loopStart,playbackRate:f.playbackRate.value};f=e(u,y),o!==null&&f.start(...o),a!==null&&f.stop(a)}return s.set(u,f),p?await t(u,c.playbackRate,f.playbackRate):await r(u,c.playbackRate,f.playbackRate),await i(c,u,f),f};return{set start(c){o=c},set stop(c){a=c},render(c,u){const f=s.get(u);return f!==void 0?Promise.resolve(f):l(c,u)}}},O5=t=>"playbackRate"in t,D5=t=>"frequency"in t&&"gain"in t,N5=t=>"offset"in t,F5=t=>!("frequency"in t)&&"gain"in t,$5=t=>"detune"in t&&"frequency"in t,V5=t=>"pan"in t,zr=t=>Bi($0,t),pl=t=>Bi(x0,t),Yf=(t,e)=>{const{activeInputs:n}=zr(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||Yf(s,[...e,t])}));const r=O5(t)?[t.playbackRate]:q0(t)?Array.from(t.parameters.values()):D5(t)?[t.Q,t.detune,t.frequency,t.gain]:N5(t)?[t.offset]:F5(t)?[t.gain]:$5(t)?[t.detune,t.frequency]:V5(t)?[t.pan]:[];for(const i of r){const s=pl(i);s!==void 0&&s.activeInputs.forEach(([o])=>Yf(o,e))}lo(t)&&Gf(t)},x5=t=>{Yf(t.destination,[])},H5=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),U5=(t,e,n,r,i,s,o,a)=>class extends t{constructor(c,u){const f=s(c),p=o(f),y=i(f,u,p),m=p?e(a):null;super(c,!1,y,m),this._isNodeOfNativeOfflineAudioContext=p,this._nativeAudioDestinationNode=y}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},W5=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},j5=(t,e,n,r,i,s,o,a)=>(l,c)=>{const u=c.listener,f=()=>{const h=new Float32Array(1),k=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),L=o(c);let $=!1,P=[0,0,-1,0,1,0],I=[0,0,0];const H=()=>{if($)return;$=!0;const D=r(c,256,9,0);D.onaudioprocess=({inputBuffer:F})=>{const Y=[s(F,h,0),s(F,h,1),s(F,h,2),s(F,h,3),s(F,h,4),s(F,h,5)];Y.some((Q,W)=>Q!==P[W])&&(u.setOrientation(...Y),P=Y);const K=[s(F,h,6),s(F,h,7),s(F,h,8)];K.some((Q,W)=>Q!==I[W])&&(u.setPosition(...K),I=K)},k.connect(D)},ae=D=>F=>{F!==P[D]&&(P[D]=F,u.setOrientation(...P))},V=D=>F=>{F!==I[D]&&(I[D]=F,u.setPosition(...I))},v=(D,F,Y)=>{const K=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F});K.connect(k,0,D),K.start(),Object.defineProperty(K.offset,"defaultValue",{get(){return F}});const Q=t({context:l},L,K.offset,Xf,Uu);return a(Q,"value",W=>()=>W.call(Q),W=>O=>{try{W.call(Q,O)}catch(C){if(C.code!==9)throw C}H(),L&&Y(O)}),Q.cancelAndHoldAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.cancelAndHoldAtTime),Q.cancelScheduledValues=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.cancelScheduledValues),Q.exponentialRampToValueAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.exponentialRampToValueAtTime),Q.linearRampToValueAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.linearRampToValueAtTime),Q.setTargetAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.setTargetAtTime),Q.setValueAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.setValueAtTime),Q.setValueCurveAtTime=(W=>L?()=>{throw i()}:(...O)=>{const C=W.apply(Q,O);return H(),C})(Q.setValueCurveAtTime),Q};return{forwardX:v(0,0,ae(0)),forwardY:v(1,0,ae(1)),forwardZ:v(2,-1,ae(2)),positionX:v(6,0,V(0)),positionY:v(7,0,V(1)),positionZ:v(8,0,V(2)),upX:v(3,0,ae(3)),upY:v(4,1,ae(4)),upZ:v(5,0,ae(5))}},{forwardX:p,forwardY:y,forwardZ:m,positionX:g,positionY:w,positionZ:_,upX:b,upY:E,upZ:R}=u.forwardX===void 0?f():u;return{get forwardX(){return p},get forwardY(){return y},get forwardZ(){return m},get positionX(){return g},get positionY(){return w},get positionZ(){return _},get upX(){return b},get upY(){return E},get upZ(){return R}}},Wu=t=>"context"in t,ml=t=>Wu(t[0]),uo=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Q0=(t,e,[n,r],i)=>{uo(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},ep=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):uo(s,[n,r],o=>o[0]===n,i)},tp=t=>"inputs"in t,Kf=(t,e,n,r)=>{if(tp(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},np=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},G5=(t,e,n)=>xu(t,r=>r[0]===e&&r[1]===n),rp=(t,e)=>{if(!hl(t).delete(e))throw new Error("Missing the expected event listener.")},ip=(t,e,n)=>{const r=Bi(t,e),i=xu(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},qf=(t,e,n,r)=>{tp(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},Oi=t=>Bi(V0,t),_l=t=>Bi(H0,t),co=t=>Uf.has(t),ju=t=>!aa.has(t),sp=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(t.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=l=>{const c=l.inputBuffer.getChannelData(0);Array.prototype.some.call(c,u=>u===1)?n(!0):n(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(t.destination)},a.start()}}),Zf=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},Gu=t=>"context"in t,z5=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const o=Gu(r)?n(r,i,s):n(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(l=>l.input!==s||l.output!==i)&&a.push({input:s,output:i}),o})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const l=a.filter(c=>c.output!==r);l.length===0?e.delete(o):e.set(o,l)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(l=>l.output!==i&&(l.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(l=>{Gu(o)?t.connect(o,l.output,l.input):t.connect(o,l.output)})})(t.disconnect)},X5=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=pl(e),{outputs:o}=zr(t),a=hl(t),l=c=>{const u=Oi(t),f=_l(e);if(c){const p=ip(s,t,n);Q0(i,t,p,!1),!r&&!co(t)&&u.connect(f,n)}else{const p=G5(i,t,n);ep(s,p,!1),!r&&!co(t)&&u.disconnect(f,n)}};return uo(o,[e,n],c=>c[0]===e&&c[1]===n,!0)?(a.add(l),lo(t)?Q0(i,t,[n,l],!0):ep(s,[t,n,l],!0),!0):!1},Y5=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=zr(e),o=np(i[r],t,n);return o===null?[K0(s,t,n,r)[2],!1]:[o[2],!0]},K5=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=pl(e),s=np(r,t,n);return s===null?[ip(i,t,n)[1],!1]:[s[2],!0]},Jf=(t,e,n,r,i)=>{const[s,o]=Y5(t,n,r,i);if(s!==null&&(rp(t,s),o&&!e&&!co(t)&&qf(Oi(t),Oi(n),r,i)),lo(n)){const{activeInputs:a}=zr(n);zf(n,a)}},Qf=(t,e,n,r)=>{const[i,s]=K5(t,n,r);i!==null&&(rp(t,i),s&&!e&&!co(t)&&Oi(t).disconnect(_l(n),r))},q5=(t,e)=>{const n=zr(t),r=[];for(const i of n.outputs)ml(i)?Jf(t,e,...i):Qf(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},Z5=(t,e,n)=>{const r=zr(t),i=[];for(const s of r.outputs)s[1]===n&&(ml(s)?Jf(t,e,...s):Qf(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},J5=(t,e,n,r,i)=>{const s=zr(t);return Array.from(s.outputs).filter(o=>o[0]===n&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(ml(o)?Jf(t,e,...o):Qf(t,e,...o),s.outputs.delete(o),o[0]))},Q5=(t,e,n,r,i,s,o,a,l,c,u,f,p,y,m,g)=>class extends c{constructor(_,b,E,R){super(E),this._context=_,this._nativeAudioNode=E;const h=u(_);f(h)&&n(sp,()=>sp(h,g))!==!0&&z5(E),V0.set(this,E),W0.set(this,new Set),_.state!=="closed"&&b&&Hu(this),t(this,R,E)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(_){this._nativeAudioNode.channelCount=_}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(_){this._nativeAudioNode.channelCountMode=_}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(_){this._nativeAudioNode.channelInterpretation=_}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(_,b=0,E=0){if(b<0||b>=this._nativeAudioNode.numberOfOutputs)throw i();const R=u(this._context),h=m(R);if(p(_)||y(_))throw s();if(Wu(_)){const $=Oi(_);try{const I=Kf(this._nativeAudioNode,$,b,E),H=ju(this);(h||H)&&this._nativeAudioNode.disconnect(...I),this.context.state!=="closed"&&!H&&ju(_)&&Hu(_)}catch(I){throw I.code===12?s():I}if(e(this,_,b,E,h)){const I=l([this],_);Zf(I,r(h))}return _}const k=_l(_);if(k.name==="playbackRate"&&k.maxValue===1024)throw o();try{this._nativeAudioNode.connect(k,b),(h||ju(this))&&this._nativeAudioNode.disconnect(k,b)}catch($){throw $.code===12?s():$}if(X5(this,_,b,h)){const $=l([this],_);Zf($,r(h))}}disconnect(_,b,E){let R;const h=u(this._context),k=m(h);if(_===void 0)R=q5(this,k);else if(typeof _=="number"){if(_<0||_>=this.numberOfOutputs)throw i();R=Z5(this,k,_)}else{if(b!==void 0&&(b<0||b>=this.numberOfOutputs)||Wu(_)&&E!==void 0&&(E<0||E>=_.numberOfInputs))throw i();if(R=J5(this,k,_,b,E),R.length===0)throw s()}for(const L of R){const $=l([this],L);Zf($,a)}}},ew=(t,e,n,r,i,s,o,a,l,c,u,f,p)=>(y,m,g,w=null,_=null)=>{const b=g.value,E=new d5(b),R=m?r(E):null,h={get defaultValue(){return b},get maxValue(){return w===null?g.maxValue:w},get minValue(){return _===null?g.minValue:_},get value(){return g.value},set value(k){g.value=k,h.setValueAtTime(k,y.context.currentTime)},cancelAndHoldAtTime(k){if(typeof g.cancelAndHoldAtTime=="function")R===null&&E.flush(y.context.currentTime),E.add(i(k)),g.cancelAndHoldAtTime(k);else{const L=Array.from(E).pop();R===null&&E.flush(y.context.currentTime),E.add(i(k));const $=Array.from(E).pop();g.cancelScheduledValues(k),L!==$&&$!==void 0&&($.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime($.value,$.endTime):$.type==="linearRampToValue"?g.linearRampToValueAtTime($.value,$.endTime):$.type==="setValue"?g.setValueAtTime($.value,$.startTime):$.type==="setValueCurve"&&g.setValueCurveAtTime($.values,$.startTime,$.duration))}return h},cancelScheduledValues(k){return R===null&&E.flush(y.context.currentTime),E.add(s(k)),g.cancelScheduledValues(k),h},exponentialRampToValueAtTime(k,L){if(k===0)throw new RangeError;if(!Number.isFinite(L)||L<0)throw new RangeError;const $=y.context.currentTime;return R===null&&E.flush($),Array.from(E).length===0&&(E.add(c(b,$)),g.setValueAtTime(b,$)),E.add(o(k,L)),g.exponentialRampToValueAtTime(k,L),h},linearRampToValueAtTime(k,L){const $=y.context.currentTime;return R===null&&E.flush($),Array.from(E).length===0&&(E.add(c(b,$)),g.setValueAtTime(b,$)),E.add(a(k,L)),g.linearRampToValueAtTime(k,L),h},setTargetAtTime(k,L,$){return R===null&&E.flush(y.context.currentTime),E.add(l(k,L,$)),g.setTargetAtTime(k,L,$),h},setValueAtTime(k,L){return R===null&&E.flush(y.context.currentTime),E.add(c(k,L)),g.setValueAtTime(k,L),h},setValueCurveAtTime(k,L,$){const P=k instanceof Float32Array?k:new Float32Array(k);if(f!==null&&f.name==="webkitAudioContext"){const I=L+$,H=y.context.sampleRate,ae=Math.ceil(L*H),V=Math.floor(I*H),v=V-ae,D=new Float32Array(v);for(let Y=0;Y<v;Y+=1){const K=(P.length-1)/$*((ae+Y)/H-L),Q=Math.floor(K),W=Math.ceil(K);D[Y]=Q===W?P[Q]:(1-(K-Q))*P[Q]+(1-(W-K))*P[W]}R===null&&E.flush(y.context.currentTime),E.add(u(D,L,$)),g.setValueCurveAtTime(D,L,$);const F=V/H;F<I&&p(h,D[D.length-1],F),p(h,P[P.length-1],I)}else R===null&&E.flush(y.context.currentTime),E.add(u(P,L,$)),g.setValueCurveAtTime(P,L,$);return h}};return n.set(h,g),e.set(h,y),t(h,R),h},tw=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class op{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const nw={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},rw=(t,e,n,r,i,s,o,a,l,c,u,f,p,y)=>class extends e{constructor(g,w,_){var b;const E=a(g),R=l(E),h=u({...nw,..._});p(h);const k=Wf.get(E),L=k==null?void 0:k.get(w),$=R||E.state!=="closed"?E:(b=o(E))!==null&&b!==void 0?b:E,P=i($,R?null:g.baseLatency,c,w,L,h),I=R?r(w,h,L):null;super(g,!0,P,I);const H=[];P.parameters.forEach((V,v)=>{const D=n(this,R,V);H.push([v,D])}),this._nativeAudioWorkletNode=P,this._onprocessorerror=null,this._parameters=new op(H),R&&t(E,this);const{activeInputs:ae}=s(this);f(P,ae)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){const w=typeof g=="function"?y(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=w;const _=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=_!==null&&_===w?g:_}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function zu(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(o)}}}const ap=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},Xu=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));n.push(i)}return n},iw=(t,e)=>{const n=Bi(jf,t),r=Oi(e);return Bi(n,r)},sw=async(t,e,n,r,i,s,o)=>{const a=e===null?Math.ceil(t.context.length/128)*128:e.length,l=r.channelCount*r.numberOfInputs,c=i.reduce((w,_)=>w+_,0),u=c===0?null:n.createBuffer(c,a,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const f=zr(t),p=await iw(n,t),y=Xu(r.numberOfInputs,r.channelCount),m=Xu(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce((w,_)=>({...w,[_]:new Float32Array(128)}),{});for(let w=0;w<a;w+=128){if(r.numberOfInputs>0&&e!==null)for(let _=0;_<r.numberOfInputs;_+=1)for(let b=0;b<r.channelCount;b+=1)zu(e,y[_],b,b,w);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:_},b)=>{zu(e,g,_,l+b,w)});for(let _=0;_<r.numberOfInputs;_+=1)for(let b=0;b<i[_];b+=1)m[_][b].byteLength===0&&(m[_][b]=new Float32Array(128));try{const _=y.map((E,R)=>f.activeInputs[R].size===0?[]:E),b=o(w/n.sampleRate,n.sampleRate,()=>p.process(_,m,g));if(u!==null)for(let E=0,R=0;E<r.numberOfOutputs;E+=1){for(let h=0;h<i[E];h+=1)ap(u,m[E],h,R+h,w);R+=i[E]}if(!b)break}catch(_){t.dispatchEvent(new ErrorEvent("processorerror",{colno:_.colno,filename:_.filename,lineno:_.lineno,message:_.message}));break}}return u},ow=(t,e,n,r,i,s,o,a,l,c,u,f,p,y,m,g)=>(w,_,b)=>{const E=new WeakMap;let R=null;const h=async(k,L)=>{let $=u(k),P=null;const I=Z0($,L),H=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(f===null){const ae=H.reduce((F,Y)=>F+Y,0),V=i(L,{channelCount:Math.max(1,ae),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,ae)}),v=[];for(let F=0;F<k.numberOfOutputs;F+=1)v.push(r(L,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:H[F]}));const D=o(L,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});D.connect=e.bind(null,v),D.disconnect=l.bind(null,v),P=[V,v,D]}else I||($=new f(L,w));if(E.set(L,P===null?$:P[2]),P!==null){if(R===null){if(b===void 0)throw new Error("Missing the processor constructor.");if(p===null)throw new Error("Missing the native OfflineAudioContext constructor.");const Y=k.channelCount*k.numberOfInputs,K=b.parameterDescriptors===void 0?0:b.parameterDescriptors.length,Q=Y+K;R=sw(k,Q===0?null:await(async()=>{const O=new p(Q,Math.ceil(k.context.length/128)*128,L.sampleRate),C=[],S=[];for(let ie=0;ie<_.numberOfInputs;ie+=1)C.push(o(O,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),S.push(i(O,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const M=await Promise.all(Array.from(k.parameters.values()).map(async ie=>{const G=s(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ie.value});return await y(O,ie,G.offset),G})),X=r(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Y+K)});for(let ie=0;ie<_.numberOfInputs;ie+=1){C[ie].connect(S[ie]);for(let G=0;G<_.channelCount;G+=1)S[ie].connect(X,G,ie*_.channelCount+G)}for(const[ie,G]of M.entries())G.connect(X,0,Y+ie),G.start(0);return X.connect(O.destination),await Promise.all(C.map(ie=>m(k,O,ie))),g(O)})(),L,_,H,b,c)}const ae=await R,V=n(L,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[v,D,F]=P;ae!==null&&(V.buffer=ae,V.start(0)),V.connect(v);for(let Y=0,K=0;Y<k.numberOfOutputs;Y+=1){const Q=D[Y];for(let W=0;W<H[Y];W+=1)v.connect(Q,K+W,W);K+=H[Y]}return F}if(I)for(const[ae,V]of k.parameters.entries())await t(L,V,$.parameters.get(ae));else for(const[ae,V]of k.parameters.entries())await y(L,V,$.parameters.get(ae));return await m(k,L,$),$};return{render(k,L){a(L,k);const $=E.get(L);return $!==void 0?Promise.resolve($):h(k,L)}}},aw=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(t.set(n,o),o.catch(()=>!1).then(a=>(t.delete(n),e.set(n,a),a))):(e.set(n,o),o)}catch{return e.set(n,!1),!1}},lw=t=>(e,n,r)=>t(n,e,r),uw=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return Gu(n)?s.connect(n,0,i):s.connect(n,0)},cw=t=>e=>(t[0]=e,t[0]),fw=(t,e,n,r,i,s,o,a)=>(l,c)=>{const u=e.get(l);if(u===void 0)throw new Error("Missing the expected cycle count.");const f=s(l.context),p=a(f);if(u===c){if(e.delete(l),!p&&o(l)){const y=r(l),{outputs:m}=n(l);for(const g of m)if(ml(g)){const w=r(g[0]);t(y,w,g[1],g[2])}else{const w=i(g[0]);y.connect(w,g[1])}}}else e.set(l,u-c)},dw=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),hw=t=>(e,n)=>{t(e).delete(n)},pw=t=>"delayTime"in t,mw=(t,e,n)=>function r(i,s){const o=Wu(s)?s:n(t,s);if(pw(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(l=>r([...i,o],l[0])).reduce((l,c)=>l.concat(c),[])},Yu=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},_w=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?Yu(t,e,n).disconnect():Gu(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?Yu(t,e,r).disconnect(n,0):Yu(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):Yu(t,e,r).disconnect(n,0),gw=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=t.onerror,c=()=>{t.onerror=l,URL.revokeObjectURL(a)};t.onerror=(u,f,p,y,m)=>{if(f===a||f===t.location.href&&p===1&&y===1)return c(),r(m),!1;if(l!==null)return l(u,f,p,y,m)},s.onerror=()=>{c(),r(new SyntaxError)},s.onload=()=>{c(),n()},s.src=a,s.type="module",i.appendChild(s)}}),bw=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},ww=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},yw=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},vw=(t,e)=>n=>e(t,n),Ew=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},Sw=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},Tw=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},kw=t=>e=>t.get(e),Di=()=>new DOMException("","InvalidStateError"),Aw=t=>e=>{const n=t.get(e);if(n===void 0)throw Di();return n},Cw=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},Mw=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},Rw=()=>new DOMException("","InvalidAccessError"),Lw=(t,e,n,r,i,s)=>o=>(a,l)=>{const c=t.get(a);if(c===void 0){if(!o&&s(a)){const u=r(a),{outputs:f}=n(a);for(const p of f)if(ml(p)){const y=r(p[0]);e(u,y,p[1],p[2])}else{const y=i(p[0]);u.disconnect(y,p[1])}}t.set(a,l)}else t.set(a,c+l)},Pw=t=>e=>t!==null&&e instanceof t,Iw=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,Bw=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,Ow=t=>e=>t!==null&&e instanceof t,Dw=t=>t!==null&&t.isSecureContext,Nw=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),l=e(a,o);if(r(a))throw new TypeError;super(s,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Fw=(t,e,n,r,i)=>class extends r{constructor(o={}){if(i===null)throw new Error("Missing the native AudioContext constructor.");let a;try{a=new i(o)}catch(u){throw u.code===12&&u.message==="sampleRate is not in range"?e():u}if(a===null)throw n();if(!H5(o.latencyHint))throw new TypeError(`The provided value '${o.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(o.sampleRate!==void 0&&a.sampleRate!==o.sampleRate)throw e();super(a,2);const{latencyHint:l}=o,{sampleRate:c}=a;if(this._baseLatency=typeof a.baseLatency=="number"?a.baseLatency:l==="balanced"?512/c:l==="interactive"||l===void 0?256/c:l==="playback"?1024/c:Math.max(2,Math.min(128,Math.round(l*c/128)))*128/c,this._nativeAudioContext=a,i.name==="webkitAudioContext"?(this._nativeGainNode=a.createGain(),this._nativeOscillatorNode=a.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(a.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,a.state==="running"){this._state="suspended";const u=()=>{this._state==="suspended"&&(this._state=null),a.removeEventListener("statechange",u)};a.addEventListener("statechange",u)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),x5(this)}))}resume(){return this._state==="suspended"?new Promise((o,a)=>{const l=()=>{this._nativeAudioContext.removeEventListener("statechange",l),this._nativeAudioContext.state==="running"?o():this.resume().then(o,a)};this._nativeAudioContext.addEventListener("statechange",l)}):this._nativeAudioContext.resume().catch(o=>{throw o===void 0||o.code===15?t():o})}suspend(){return this._nativeAudioContext.suspend().catch(o=>{throw o===void 0?t():o})}},$w=(t,e,n,r,i,s)=>class extends n{constructor(a,l){super(a),this._nativeContext=a,U0.set(this,a),r(a)&&i.set(a,new Set),this._destination=new t(this,l),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const l=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=l;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===l?a:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},lp=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},Vw=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(o=>(a,l=0,c=0)=>{const u=s.size===0;if(e(a))return o.call(n,a,l,c),t(s,[a,l,c],f=>f[0]===a&&f[1]===l&&f[2]===c,!0),u&&r(),a;o.call(n,a,l),t(s,[a,l],f=>f[0]===a&&f[1]===l,!0),u&&r()})(n.connect),n.disconnect=(o=>(a,l,c)=>{const u=s.size>0;if(a===void 0)o.apply(n),s.clear();else if(typeof a=="number"){o.call(n,a);for(const p of s)p[1]===a&&s.delete(p)}else{e(a)?o.call(n,a,l,c):o.call(n,a,l);for(const p of s)p[0]===a&&(l===void 0||p[1]===l)&&(c===void 0||p[2]===c)&&s.delete(p)}const f=s.size===0;u&&f&&i()})(n.disconnect),n},fo=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},gl=(t,e)=>{fo(t,e,"channelCount"),fo(t,e,"channelCountMode"),fo(t,e,"channelInterpretation")},xw=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,e1=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},Hw=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw Di();e.call(t,r,i,s),n=!0}})(t.start)},up=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},cp=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},Uw=(t,e,n,r,i,s,o,a,l,c,u)=>(f,p)=>{const y=f.createBufferSource();return gl(y,p),e1(y,p,"playbackRate"),fo(y,p,"buffer"),fo(y,p,"loop"),fo(y,p,"loopEnd"),fo(y,p,"loopStart"),e(n,()=>n(f))||Hw(y),e(r,()=>r(f))||l(y),e(i,()=>i(f))||c(y,f),e(s,()=>s(f))||up(y),e(o,()=>o(f))||u(y,f),e(a,()=>a(f))||cp(y),t(f,y),y},Ww=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,jw=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>l=>{a.call(o,l);try{s.channelCount=l}catch(c){if(l>s.maxChannelCount)throw c}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>l=>{a.call(o,l),s.channelCountMode=l}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>l=>{a.call(o,l),s.channelInterpretation=l}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},Gw=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,zw=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},Xw=(t,e,n,r,i)=>(s,o,a,l,c,u)=>{if(a!==null)try{const f=new a(s,l,u),p=new Map;let y=null;if(Object.defineProperties(f,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>y,set:m=>{typeof y=="function"&&f.removeEventListener("processorerror",y),y=typeof m=="function"?m:null,typeof y=="function"&&f.addEventListener("processorerror",y)}}}),f.addEventListener=(m=>(...g)=>{if(g[0]==="processorerror"){const w=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(w!==null){const _=p.get(g[1]);_!==void 0?g[1]=_:(g[1]=b=>{b.type==="error"?(Object.defineProperties(b,{type:{value:"processorerror"}}),w(b)):w(new ErrorEvent(g[0],{...b}))},p.set(w,g[1]))}}return m.call(f,"error",g[1],g[2]),m.call(f,...g)})(f.addEventListener),f.removeEventListener=(m=>(...g)=>{if(g[0]==="processorerror"){const w=p.get(g[1]);w!==void 0&&(p.delete(g[1]),g[1]=w)}return m.call(f,"error",g[1],g[2]),m.call(f,g[0],g[1],g[2])})(f.removeEventListener),u.numberOfOutputs!==0){const m=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return f.connect(m).connect(s.destination),i(f,()=>m.disconnect(),()=>m.connect(s.destination))}return f}catch(f){throw f.code===11?r():f}if(c===void 0)throw r();return zw(u),e(s,o,c,u)},Yw=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Kw=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),qw=async(t,e)=>{const n=await Kw(e);return new t(n)},Zw=(t,e,n,r)=>{let i=jf.get(t);i===void 0&&(i=new WeakMap,jf.set(t,i));const s=qw(n,r);return i.set(e,s),s},Jw=(t,e,n,r,i,s,o,a,l,c,u,f,p)=>(y,m,g,w)=>{if(w.numberOfInputs===0&&w.numberOfOutputs===0)throw l();const _=Array.isArray(w.outputChannelCount)?w.outputChannelCount:Array.from(w.outputChannelCount);if(_.some(Te=>Te<1))throw l();if(_.length!==w.numberOfOutputs)throw e();if(w.channelCountMode!=="explicit")throw l();const b=w.channelCount*w.numberOfInputs,E=_.reduce((Te,Le)=>Te+Le,0),R=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(b+R>6||E>6)throw l();const h=new MessageChannel,k=[],L=[];for(let Te=0;Te<w.numberOfInputs;Te+=1)k.push(o(y,{channelCount:w.channelCount,channelCountMode:w.channelCountMode,channelInterpretation:w.channelInterpretation,gain:1})),L.push(i(y,{channelCount:w.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:w.channelCount}));const $=[];if(g.parameterDescriptors!==void 0)for(const{defaultValue:Te,maxValue:Le,minValue:Ie,name:et}of g.parameterDescriptors){const B=s(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:w.parameterData[et]!==void 0?w.parameterData[et]:Te===void 0?0:Te});Object.defineProperties(B.offset,{defaultValue:{get:()=>Te===void 0?0:Te},maxValue:{get:()=>Le===void 0?Xf:Le},minValue:{get:()=>Ie===void 0?Uu:Ie}}),$.push(B)}const P=r(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+R)}),I=Yw(m,y.sampleRate),H=a(y,I,b+R,Math.max(1,E)),ae=i(y,{channelCount:Math.max(1,E),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,E)}),V=[];for(let Te=0;Te<w.numberOfOutputs;Te+=1)V.push(r(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[Te]}));for(let Te=0;Te<w.numberOfInputs;Te+=1){k[Te].connect(L[Te]);for(let Le=0;Le<w.channelCount;Le+=1)L[Te].connect(P,Le,Te*w.channelCount+Le)}const v=new op(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:Te},Le)=>{const Ie=$[Le];return Ie.connect(P,0,b+Le),Ie.start(0),[Te,Ie.offset]}));P.connect(H);let D=w.channelInterpretation,F=null;const Y=w.numberOfOutputs===0?[H]:V,K={get bufferSize(){return I},get channelCount(){return w.channelCount},set channelCount(Te){throw n()},get channelCountMode(){return w.channelCountMode},set channelCountMode(Te){throw n()},get channelInterpretation(){return D},set channelInterpretation(Te){for(const Le of k)Le.channelInterpretation=Te;D=Te},get context(){return H.context},get inputs(){return k},get numberOfInputs(){return w.numberOfInputs},get numberOfOutputs(){return w.numberOfOutputs},get onprocessorerror(){return F},set onprocessorerror(Te){typeof F=="function"&&K.removeEventListener("processorerror",F),F=typeof Te=="function"?Te:null,typeof F=="function"&&K.addEventListener("processorerror",F)},get parameters(){return v},get port(){return h.port2},addEventListener(...Te){return H.addEventListener(Te[0],Te[1],Te[2])},connect:t.bind(null,Y),disconnect:c.bind(null,Y),dispatchEvent(...Te){return H.dispatchEvent(Te[0])},removeEventListener(...Te){return H.removeEventListener(Te[0],Te[1],Te[2])}},Q=new Map;h.port1.addEventListener=(Te=>(...Le)=>{if(Le[0]==="message"){const Ie=typeof Le[1]=="function"?Le[1]:typeof Le[1]=="object"&&Le[1]!==null&&typeof Le[1].handleEvent=="function"?Le[1].handleEvent:null;if(Ie!==null){const et=Q.get(Le[1]);et!==void 0?Le[1]=et:(Le[1]=B=>{u(y.currentTime,y.sampleRate,()=>Ie(B))},Q.set(Ie,Le[1]))}}return Te.call(h.port1,Le[0],Le[1],Le[2])})(h.port1.addEventListener),h.port1.removeEventListener=(Te=>(...Le)=>{if(Le[0]==="message"){const Ie=Q.get(Le[1]);Ie!==void 0&&(Q.delete(Le[1]),Le[1]=Ie)}return Te.call(h.port1,Le[0],Le[1],Le[2])})(h.port1.removeEventListener);let W=null;Object.defineProperty(h.port1,"onmessage",{get:()=>W,set:Te=>{typeof W=="function"&&h.port1.removeEventListener("message",W),W=typeof Te=="function"?Te:null,typeof W=="function"&&(h.port1.addEventListener("message",W),h.port1.start())}}),g.prototype.port=h.port1;let O=null;Zw(y,K,g,w).then(Te=>O=Te);const S=Xu(w.numberOfInputs,w.channelCount),M=Xu(w.numberOfOutputs,_),X=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((Te,{name:Le})=>({...Te,[Le]:new Float32Array(128)}),{});let ie=!0;const G=()=>{w.numberOfOutputs>0&&H.disconnect(ae);for(let Te=0,Le=0;Te<w.numberOfOutputs;Te+=1){const Ie=V[Te];for(let et=0;et<_[Te];et+=1)ae.disconnect(Ie,Le+et,et);Le+=_[Te]}},z=new Map;H.onaudioprocess=({inputBuffer:Te,outputBuffer:Le})=>{if(O!==null){const Ie=f(K);for(let et=0;et<I;et+=128){for(let B=0;B<w.numberOfInputs;B+=1)for(let x=0;x<w.channelCount;x+=1)zu(Te,S[B],x,x,et);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:B},x)=>{zu(Te,X,B,b+x,et)});for(let B=0;B<w.numberOfInputs;B+=1)for(let x=0;x<_[B];x+=1)M[B][x].byteLength===0&&(M[B][x]=new Float32Array(128));try{const B=S.map((Ne,We)=>{if(Ie[We].size>0)return z.set(We,I/128),Ne;const ke=z.get(We);return ke===void 0?[]:(Ne.every(Pe=>Pe.every(Xe=>Xe===0))&&(ke===1?z.delete(We):z.set(We,ke-1)),Ne)});ie=u(y.currentTime+et/y.sampleRate,y.sampleRate,()=>O.process(B,M,X));for(let Ne=0,We=0;Ne<w.numberOfOutputs;Ne+=1){for(let tt=0;tt<_[Ne];tt+=1)ap(Le,M[Ne],tt,We+tt,et);We+=_[Ne]}}catch(B){ie=!1,K.dispatchEvent(new ErrorEvent("processorerror",{colno:B.colno,filename:B.filename,lineno:B.lineno,message:B.message}))}if(!ie){for(let B=0;B<w.numberOfInputs;B+=1){k[B].disconnect(L[B]);for(let x=0;x<w.channelCount;x+=1)L[et].disconnect(P,x,B*w.channelCount+x)}if(g.parameterDescriptors!==void 0){const B=g.parameterDescriptors.length;for(let x=0;x<B;x+=1){const Ne=$[x];Ne.disconnect(P,0,b+x),Ne.stop()}}P.disconnect(H),H.onaudioprocess=null,le?G():Ae();break}}}};let le=!1;const Me=o(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),_e=()=>H.connect(Me).connect(y.destination),Ae=()=>{H.disconnect(Me),Me.disconnect()},Ee=()=>{if(ie){Ae(),w.numberOfOutputs>0&&H.connect(ae);for(let Te=0,Le=0;Te<w.numberOfOutputs;Te+=1){const Ie=V[Te];for(let et=0;et<_[Te];et+=1)ae.connect(Ie,Le+et,et);Le+=_[Te]}}le=!0},Ve=()=>{ie&&(_e(),G()),le=!1};return _e(),p(K,Ee,Ve)},Qw=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),gl(i,r),i},e6=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw Di()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw Di()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw Di()}})},fp=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return gl(n,e),e6(n),n},t6=(t,e,n,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return n(s,o);const a=s.createConstantSource();return gl(a,o),e1(a,o,"offset"),e(r,()=>r(s))||up(a),e(i,()=>i(s))||cp(a),t(s,a),a},dp=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),n6=(t,e,n,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),l=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const f={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(m){c.channelCount=m},get channelCountMode(){return c.channelCountMode},set channelCountMode(m){c.channelCountMode=m},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(m){c.channelInterpretation=m},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(m){l.onended=m},addEventListener(...m){return l.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return l.dispatchEvent(m[0])},removeEventListener(...m){return l.removeEventListener(m[0],m[1],m[2])},start(m=0){l.start.call(l,m)},stop(m=0){l.stop.call(l,m)}},p=()=>l.connect(c),y=()=>l.disconnect(c);return t(i,l),r(dp(f,c),p,y)},Ns=(t,e)=>{const n=t.createGain();return gl(n,e),e1(n,e,"gain"),n},r6=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},i6=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,t1=(t,e,n,r)=>t.createScriptProcessor(e,n,r),ho=()=>new DOMException("","NotSupportedError"),s6=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),o6=(t,e,n)=>async(r,i,s)=>{const o=t(r);await Promise.all(o.activeInputs.map((a,l)=>Array.from(a).map(async([c,u])=>{const p=await e(c).render(c,i),y=r.context.destination;!n(c)&&(r!==y||!n(r))&&p.connect(s,u,l)})).reduce((a,l)=>[...a,...l],[]))},a6=(t,e,n)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,l])=>{const u=await t(a).render(a,i);n(a)||u.connect(s,l)}))},l6=(t,e,n,r)=>i=>t(lp,()=>lp(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const o=n(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),u6=t=>(e,n)=>{t.set(e,n)},c6=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},f6=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new t(r,"a",{numberOfOutputs:0}),l=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,l.connect(a),l.start(0),await r.startRendering(),await new Promise(c=>setTimeout(c))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},d6=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},h6=()=>new DOMException("","UnknownError"),p6=()=>typeof window>"u"?null:window,m6=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=r.length;for(let f=o<0?-o:0;f+o<l&&f<u;f+=1)r[f]=c[f+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=r.length;for(let f=o<0?-o:0;f+o<l&&f<u;f+=1)c[f+o]=r[f]}},_6=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyToChannel)},g6=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},b6=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let l=0;l<a;l+=1)i.connect(r,0,l)},()=>i.disconnect(r))},w6=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),n1=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},y6=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),hp=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;hp(t,e,n+1e-7)}},v6=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},E6=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},S6=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},pp=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},T6=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},mp=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},k6=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},A6=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},C6=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),dp(t,n),t.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else i.call(t,o),s=!0}})(t.stop)},Ku=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},M6=w5(uo),R6=k5(uo),L6=dw(xu),P6=Sw(new WeakMap),la=aw(new Map,new WeakMap),Gi=p6(),_p=Ew(zr),r1=o6(zr,_p,co),po=Aw(U0),ua=i6(Gi),ps=Ow(ua),gp=new WeakMap,bp=bw(Ku),qu=Ww(Gi),I6=Pw(qu),wp=Iw(Gi),B6=Bw(Gi),bl=Gw(Gi),Zu=Q5(y5($0),T5(M6,R6,Kf,L6,qf,zr,P6,hl,Oi,uo,lo,co,ju),la,Lw(Uf,qf,zr,Oi,_l,lo),ao,Rw,ho,fw(Kf,Uf,zr,Oi,_l,po,lo,ps),mw(gp,zr,Bi),bp,po,I6,wp,B6,ps,bl),O6=new WeakSet,yp=xw(Gi),vp=cw(new Uint32Array(1)),D6=m6(vp,ao),N6=_6(vp),F6=L5(O6,la,ho,yp,ua,c6(yp),D6,N6),i1=A5(Ns),Ep=a6(_p,pl,co),Sp=lw(Ep),Ju=Uw(i1,la,v6,E6,S6,pp,T6,mp,A6,g6(n1),C6),Tp=s6(Tw(pl),Ep),$6=B5(Sp,Ju,Oi,Tp,r1),s1=ew(v5(x0),gp,H0,tw,h5,p5,m5,_5,g5,$f,B0,qu,hp),V6=I5(Zu,$6,s1,Di,Ju,po,ps,Ku),x6=U5(Zu,W5,ao,Di,jw(Ns,n1),po,ps,r1),Qu=Vw(uo,wp),H6=b6(Di,Qu),o1=Qw(qu,H6),U6=n6(i1,Ju,Ns,Qu),a1=t6(i1,la,U6,pp,mp),W6=l6(la,Ns,t1,d6(Ns,ua)),j6=j5(s1,o1,a1,t1,ho,w6,ps,n1),kp=new WeakMap,G6=$w(x6,j6,bp,ps,kp,Ku),Ap=Dw(Gi),l1=ww(Gi),Cp=new WeakMap,z6=Cw(Cp,ua),Mp=Ap?S5(la,ho,gw(Gi),l1,yw(b5),po,z6,ps,bl,new WeakMap,new WeakMap,f6(bl,ua),Gi):void 0,X6=Nw(Zu,r6,po,ps),Rp=Mw(kp),Y6=C5(Rp),Lp=uw(ao),K6=hw(Rp),Pp=_w(ao),Ip=new WeakMap,q6=vw(Ip,Bi),Z6=Jw(Lp,ao,Di,o1,fp,a1,Ns,t1,ho,Pp,l1,q6,Qu),J6=Xw(Di,Z6,Ns,ho,Qu),Q6=ow(Sp,Lp,Ju,o1,fp,a1,Ns,K6,Pp,l1,Oi,bl,ua,Tp,r1,W6),e8=kw(Cp),t8=u6(Ip),Bp=Ap?rw(Y6,Zu,s1,Q6,J6,zr,e8,po,ps,bl,y6,t8,k6,Ku):void 0,n8=Fw(Di,ho,h6,G6,qu),Op="Missing AudioWorklet support. Maybe this is not running in a secure context.",r8=async(t,e,n,r,i)=>{const{encoderId:s,port:o}=await C0(i,e.sampleRate);if(Bp===void 0)throw new Error(Op);const a=new V6(e,{buffer:t}),l=new X6(e,{mediaStream:r}),c=u5(Bp,e,{channelCount:n});return{audioBufferSourceNode:a,encoderId:s,mediaStreamAudioSourceNode:l,port:o,recorderAudioWorkletNode:c}},i8=(t,e,n,r)=>(i,s,o)=>{var a;const l=(a=s.getAudioTracks()[0])===null||a===void 0?void 0:a.getSettings().sampleRate,c=new n8({latencyHint:"playback",sampleRate:l}),u=Math.max(1024,Math.ceil(c.baseLatency*c.sampleRate)),f=new F6({length:u,sampleRate:c.sampleRate}),p=[],y=l5($=>{if(Mp===void 0)throw new Error(Op);return Mp(c,$)});let m=null,g=null,w=null,_=null,b=!0;const E=$=>{i.dispatchEvent(t("dataavailable",{data:new Blob($,{type:o})}))},R=async($,P)=>{const I=await Du($,P);w===null?p.push(...I):(E(I),_=R($,P))},h=()=>(b=!0,c.resume()),k=()=>{w!==null&&(m!==null&&(s.removeEventListener("addtrack",m),s.removeEventListener("removetrack",m)),g!==null&&clearTimeout(g),w.then(async({encoderId:$,mediaStreamAudioSourceNode:P,recorderAudioWorkletNode:I})=>{_!==null&&(_.catch(()=>{}),_=null),await I.stop(),P.disconnect(I);const H=await Du($,null);w===null&&await L(),E([...p,...H]),p.length=0,i.dispatchEvent(new Event("stop"))}),w=null)},L=()=>(b=!1,c.suspend());return L(),{get mimeType(){return o},get state(){return w===null?"inactive":b?"recording":"paused"},pause(){if(w===null)throw n();b&&(L(),i.dispatchEvent(new Event("pause")))},resume(){if(w===null)throw n();b||(h(),i.dispatchEvent(new Event("resume")))},start($){var P;if(w!==null)throw n();if(s.getVideoTracks().length>0)throw r();i.dispatchEvent(new Event("start"));const I=s.getAudioTracks(),H=I.length===0?2:(P=I[0].getSettings().channelCount)!==null&&P!==void 0?P:2;w=Promise.all([h(),y.then(()=>r8(f,c,H,s,o))]).then(async([,{audioBufferSourceNode:V,encoderId:v,mediaStreamAudioSourceNode:D,port:F,recorderAudioWorkletNode:Y}])=>(D.connect(Y),await new Promise(K=>{V.onended=K,V.connect(Y),V.start(c.currentTime+u/c.sampleRate)}),V.disconnect(Y),await Y.record(F),$!==void 0&&(_=R(v,$)),{encoderId:v,mediaStreamAudioSourceNode:D,recorderAudioWorkletNode:Y}));const ae=s.getTracks();m=()=>{k(),i.dispatchEvent(new ErrorEvent("error",{error:e()}))},s.addEventListener("addtrack",m),s.addEventListener("removetrack",m),g=setInterval(()=>{const V=s.getTracks();(V.length!==ae.length||V.some((v,D)=>v!==ae[D]))&&m!==null&&m()},1e3)},stop:k}};class u1{constructor(e,n=0,r){if(n<0||r!==void 0&&r<0)throw new RangeError;const i=e.reduce((u,f)=>u+f.byteLength,0);if(n>i||r!==void 0&&n+r>i)throw new RangeError;const s=[],o=r===void 0?i-n:r,a=[];let l=0,c=n;for(const u of e)if(a.length===0)if(u.byteLength>c){l=u.byteLength-c;const f=l>o?o:l;s.push(new DataView(u,c,f)),a.push(u)}else c-=u.byteLength;else if(l<o){l+=u.byteLength;const f=l>o?u.byteLength-l+o:u.byteLength;s.push(new DataView(u,0,f)),a.push(u)}this._buffers=a,this._byteLength=o,this._byteOffset=c,this._dataViews=s,this._internalBuffer=new DataView(new ArrayBuffer(8))}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get byteOffset(){return this._byteOffset}getFloat32(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.setUint8(2,this.getUint8(e+2)),this._internalBuffer.setUint8(3,this.getUint8(e+3)),this._internalBuffer.getFloat32(0,n)}getFloat64(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.setUint8(2,this.getUint8(e+2)),this._internalBuffer.setUint8(3,this.getUint8(e+3)),this._internalBuffer.setUint8(4,this.getUint8(e+4)),this._internalBuffer.setUint8(5,this.getUint8(e+5)),this._internalBuffer.setUint8(6,this.getUint8(e+6)),this._internalBuffer.setUint8(7,this.getUint8(e+7)),this._internalBuffer.getFloat64(0,n)}getInt16(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.getInt16(0,n)}getInt32(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.setUint8(2,this.getUint8(e+2)),this._internalBuffer.setUint8(3,this.getUint8(e+3)),this._internalBuffer.getInt32(0,n)}getInt8(e){const[n,r]=this._findDataViewWithOffset(e);return n.getInt8(e-r)}getUint16(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.getUint16(0,n)}getUint32(e,n){return this._internalBuffer.setUint8(0,this.getUint8(e+0)),this._internalBuffer.setUint8(1,this.getUint8(e+1)),this._internalBuffer.setUint8(2,this.getUint8(e+2)),this._internalBuffer.setUint8(3,this.getUint8(e+3)),this._internalBuffer.getUint32(0,n)}getUint8(e){const[n,r]=this._findDataViewWithOffset(e);return n.getUint8(e-r)}setFloat32(e,n,r){this._internalBuffer.setFloat32(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1)),this.setUint8(e+2,this._internalBuffer.getUint8(2)),this.setUint8(e+3,this._internalBuffer.getUint8(3))}setFloat64(e,n,r){this._internalBuffer.setFloat64(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1)),this.setUint8(e+2,this._internalBuffer.getUint8(2)),this.setUint8(e+3,this._internalBuffer.getUint8(3)),this.setUint8(e+4,this._internalBuffer.getUint8(4)),this.setUint8(e+5,this._internalBuffer.getUint8(5)),this.setUint8(e+6,this._internalBuffer.getUint8(6)),this.setUint8(e+7,this._internalBuffer.getUint8(7))}setInt16(e,n,r){this._internalBuffer.setInt16(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1))}setInt32(e,n,r){this._internalBuffer.setInt32(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1)),this.setUint8(e+2,this._internalBuffer.getUint8(2)),this.setUint8(e+3,this._internalBuffer.getUint8(3))}setInt8(e,n){const[r,i]=this._findDataViewWithOffset(e);r.setInt8(e-i,n)}setUint16(e,n,r){this._internalBuffer.setUint16(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1))}setUint32(e,n,r){this._internalBuffer.setUint32(0,n,r),this.setUint8(e,this._internalBuffer.getUint8(0)),this.setUint8(e+1,this._internalBuffer.getUint8(1)),this.setUint8(e+2,this._internalBuffer.getUint8(2)),this.setUint8(e+3,this._internalBuffer.getUint8(3))}setUint8(e,n){const[r,i]=this._findDataViewWithOffset(e);r.setUint8(e-i,n)}_findDataViewWithOffset(e){let n=0;for(const r of this._dataViews){const i=n+r.byteLength;if(e>=n&&e<i)return[r,n];n=i}throw new RangeError}}const s8=(t,e,n)=>(r,i,s,o)=>{const a=[],l=new i(s,{mimeType:"audio/webm;codecs=pcm"});let c=null,u=()=>{};const f=m=>{r.dispatchEvent(t("dataavailable",{data:new Blob(m,{type:o})}))},p=async(m,g)=>{const w=await Du(m,g);l.state==="inactive"?a.push(...w):(f(w),c=p(m,g))},y=()=>{l.state!=="inactive"&&(c!==null&&(c.catch(()=>{}),c=null),u(),u=()=>{},l.stop())};return l.addEventListener("error",m=>{y(),r.dispatchEvent(new ErrorEvent("error",{error:m.error}))}),l.addEventListener("pause",()=>r.dispatchEvent(new Event("pause"))),l.addEventListener("resume",()=>r.dispatchEvent(new Event("resume"))),l.addEventListener("start",()=>r.dispatchEvent(new Event("start"))),{get mimeType(){return o},get state(){return l.state},pause(){return l.pause()},resume(){return l.resume()},start(m){const[g]=s.getAudioTracks();if(g!==void 0&&l.state==="inactive"){const{channelCount:w,sampleRate:_}=g.getSettings();if(w===void 0)throw new Error("The channelCount is not defined.");if(_===void 0)throw new Error("The sampleRate is not defined.");let b=!1,E=!1,R=0,h=C0(o,_);u=()=>{E=!0};const k=L0(l,"dataavailable")(({data:L})=>{R+=1;const $=L.arrayBuffer();h=h.then(async({dataView:P=null,elementType:I=null,encoderId:H,port:ae})=>{const V=await $;R-=1;const v=P===null?new u1([V]):new u1([...P.buffers,V],P.byteOffset);if(!b&&l.state==="recording"&&!E){const Q=n(v,0);if(Q===null)return{dataView:v,elementType:I,encoderId:H,port:ae};const{value:W}=Q;if(W!==172351395)return{dataView:P,elementType:I,encoderId:H,port:ae};b=!0}const{currentElementType:D,offset:F,contents:Y}=e(v,I,w),K=F<v.byteLength?new u1(v.buffers,v.byteOffset+F):null;return Y.forEach(Q=>ae.postMessage(Q,Q.map(({buffer:W})=>W))),R===0&&(l.state==="inactive"||E)&&(Du(H,null).then(Q=>{f([...a,...Q]),a.length=0,r.dispatchEvent(new Event("stop"))}),ae.postMessage([]),ae.close(),k()),{dataView:K,elementType:D,encoderId:H,port:ae}})});m!==void 0&&h.then(({encoderId:L})=>c=p(L,m))}l.start(100)},stop:y}},o8=()=>typeof window>"u"?null:window,Dp=(t,e)=>{if(e>=t.byteLength)return null;const n=t.getUint8(e);if(n>127)return 1;if(n>63)return 2;if(n>31)return 3;if(n>15)return 4;if(n>7)return 5;if(n>3)return 6;if(n>1)return 7;if(n>0)return 8;const r=Dp(t,e+1);return r===null?null:r+8},a8=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},Np=[],c1=o8(),l8=X4(c1),Fp=x4(l8),u8=i8(Fp,j4,G4,Ff),f1=J4(Dp),c8=q4(f1),f8=Z4(f1),d8=H4(c8,f8),h8=s8(Fp,d8,f1),p8=W4(c1),m8=Y4(c1),_8=z4(K4(Ff),Ff,u8,h8,Np,U4(p8,a8),m8),g8=async t=>{Np.push(await V4(t))},b8=T0({characterize:({call:t})=>()=>t("characterize"),encode:({call:t})=>(e,n)=>t("encode",{recordingId:e,timeslice:n}),record:({call:t})=>async(e,n,r)=>{await t("record",{recordingId:e,sampleRate:n,typedArrays:r},r.map(({buffer:i})=>i))}}),w8=t=>{const e=new Worker(t);return b8(e)},y8=`(()=>{var e={455:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,s=536870912,a=2*s,o=function(e,t){return function(r){var o=t.get(r),i=void 0===o?r.size:o<a?o+1:0;if(!r.has(i))return e(r,i);if(r.size<s){for(;r.has(i);)i=Math.floor(Math.random()*a);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,l=r(i),c=o(l,i),u=t(c);e.addUniqueNumber=u,e.generateUniqueNumber=c}(t)}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(()=>{"use strict";const e=-32603,t=-32602,n=-32601,s=(e,t)=>Object.assign(new Error(e),{status:t}),a=t=>s('The handler of the method called "'.concat(t,'" returned an unexpected result.'),e),o=(t,r)=>async o=>{let{data:{id:i,method:l,params:c}}=o;const u=r[l];try{if(void 0===u)throw(e=>s('The requested method called "'.concat(e,'" is not supported.'),n))(l);const r=void 0===c?u():u(c);if(void 0===r)throw(t=>s('The handler of the method called "'.concat(t,'" returned no required result.'),e))(l);const o=r instanceof Promise?await r:r;if(null===i){if(void 0!==o.result)throw a(l)}else{if(void 0===o.result)throw a(l);const{result:e,transferables:r=[]}=o;t.postMessage({id:i,result:e},r)}}catch(e){const{message:r,status:n=-32603}=e;t.postMessage({error:{code:n,message:r},id:i})}};var i=r(455);const l=new Map,c=(e,r,n)=>({...r,connect:t=>{let{port:n}=t;n.start();const s=e(n,r),a=(0,i.generateUniqueNumber)(l);return l.set(a,(()=>{s(),n.close(),l.delete(a)})),{result:a}},disconnect:e=>{let{portId:r}=e;const n=l.get(r);if(void 0===n)throw(e=>s('The specified parameter called "portId" with the given value "'.concat(e,'" does not identify a port connected to this worker.'),t))(r);return n(),{result:null}},isSupported:async()=>{if(await new Promise((e=>{const t=new ArrayBuffer(0),{port1:r,port2:n}=new MessageChannel;r.onmessage=t=>{let{data:r}=t;return e(null!==r)},n.postMessage(t,[t])}))){const e=n();return{result:e instanceof Promise?await e:e}}return{result:!1}}}),u=function(e,t){const r=c(u,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0),n=o(e,r);return e.addEventListener("message",n),()=>e.removeEventListener("message",n)},d=e=>e.reduce(((e,t)=>e+t.length),0),h=(e,t)=>{const r=[];let n=0;e:for(;n<t;){const t=e.length;for(let s=0;s<t;s+=1){const t=e[s];void 0===r[s]&&(r[s]=[]);const a=t.shift();if(void 0===a)break e;r[s].push(a),0===s&&(n+=a.length)}}if(n>t){const s=n-t;r.forEach(((t,r)=>{const n=t.pop(),a=n.length-s;t.push(n.subarray(0,a)),e[r].unshift(n.subarray(a))}))}return r},f=new Map,m=(e=>(t,r,n)=>{const s=e.get(t);if(void 0===s){const s={channelDataArrays:n.map((e=>[e])),isComplete:!0,sampleRate:r};return e.set(t,s),s}return s.channelDataArrays.forEach(((e,t)=>e.push(n[t]))),s})(f),p=((e,t)=>(r,n,s,a)=>{const o=s>>3,i="subsequent"===n?0:44,l=r.length,c=e(r[0]),u=new ArrayBuffer(c*l*o+i),d=new DataView(u);return"subsequent"!==n&&t(d,s,l,"complete"===n?c:Number.POSITIVE_INFINITY,a),r.forEach(((e,t)=>{let r=i+t*o;e.forEach((e=>{const t=e.length;for(let n=0;n<t;n+=1){const t=e[n];d.setInt16(r,t<0?32768*Math.max(-1,t):32767*Math.min(1,t),!0),r+=l*o}}))})),[u]})(d,((e,t,r,n,s)=>{const a=t>>3,o=Math.min(n*r*a,4294967251);e.setUint32(0,1380533830),e.setUint32(4,o+36,!0),e.setUint32(8,1463899717),e.setUint32(12,1718449184),e.setUint32(16,16,!0),e.setUint16(20,1,!0),e.setUint16(22,r,!0),e.setUint32(24,s,!0),e.setUint32(28,s*r*a,!0),e.setUint16(32,r*a,!0),e.setUint16(34,t,!0),e.setUint32(36,1684108385),e.setUint32(40,o,!0)})),v=new Map;u(self,{characterize:()=>({result:/^audio\\/wav$/}),encode:e=>{let{recordingId:t,timeslice:r}=e;const n=v.get(t);void 0!==n&&(v.delete(t),n.reject(new Error("Another request was made to initiate an encoding.")));const s=f.get(t);if(null!==r){if(void 0===s||d(s.channelDataArrays[0])*(1e3/s.sampleRate)<r)return new Promise(((e,n)=>{v.set(t,{reject:n,resolve:e,timeslice:r})}));const e=h(s.channelDataArrays,Math.ceil(r*(s.sampleRate/1e3))),n=p(e,s.isComplete?"initial":"subsequent",16,s.sampleRate);return s.isComplete=!1,{result:n,transferables:n}}if(void 0!==s){const e=p(s.channelDataArrays,s.isComplete?"complete":"subsequent",16,s.sampleRate);return f.delete(t),{result:e,transferables:e}}return{result:[],transferables:[]}},record:e=>{let{recordingId:t,sampleRate:r,typedArrays:n}=e;const s=m(t,r,n),a=v.get(t);if(void 0!==a&&d(s.channelDataArrays[0])*(1e3/r)>=a.timeslice){const e=h(s.channelDataArrays,Math.ceil(a.timeslice*(r/1e3))),n=p(e,s.isComplete?"initial":"subsequent",16,r);s.isComplete=!1,v.delete(t),a.resolve({result:n,transferables:n})}return{result:null}}})})()})();`,v8=new Blob([y8],{type:"application/javascript; charset=utf-8"}),$p=URL.createObjectURL(v8),E8=w8($p).connect;URL.revokeObjectURL($p);const Vp=new WeakMap;let xp=!1,ms,ec=[];function Hp(t){const e=t<0?t*32768:t*32767;return Math.max(-32768,Math.min(32768,e))}async function S8(t){if(!t)throw new Error("Audio element not defined");if(!xp){try{await g8(await E8())}catch({message:n}){throw new Error(`Failed to register recorder - ${n}`)}xp=!0}let e=Vp.get(t);if(!e){const n=new AudioContext,r=n.createMediaElementSource(t);r.connect(n.destination);const i=n.createMediaStreamDestination();r.connect(i),e=i.stream,Vp.set(t,e)}ms=new _8(e,{mimeType:"audio/wav"}),ms.addEventListener("dataavailable",n=>{ec.push(n.data)}),ms.start()}function Up(t,e=!1){return new Promise((n,r)=>{if(!ms)return n(void 0);ms.addEventListener("stop",async()=>{if(!ms||e||!ec.length)return n(void 0);try{const i=[],o=ms.mimeType,a=new AudioContext,c=await new Blob(ec,{type:o}).arrayBuffer(),u=await a.decodeAudioData(c),f=u.getChannelData(0),p=u.getChannelData(1),y=new Int16Array(f.length),m=new Int16Array(p.length),g=new A4(u.numberOfChannels,u.sampleRate,t);for(let _=0,{length:b}=y;_<b;_+=1)y[_]=Hp(f[_]),m[_]=Hp(p[_]);for(let _=0,{length:b}=y;_<b;_+=1152){const E=y.subarray(_,_+1152),R=m.subarray(_,_+1152),h=g.encodeBuffer(E,R);h.length&&i.push(h)}const w=g.flush();if(w.length&&i.push(w),i.length){const _=await new Blob(i,{type:"audio/mpeg"}).arrayBuffer();n(_)}else n(void 0)}catch({message:i}){r(new Error(`Failed to stop recorder - ${i}`))}}),ms.stop()}).finally(()=>{ms=void 0,ec=[]})}const mo=Math.min,zi=Math.max,tc=Math.round,nc=Math.floor,Fs=t=>({x:t,y:t}),T8={left:"right",right:"left",bottom:"top",top:"bottom"},k8={start:"end",end:"start"};function Wp(t,e,n){return zi(t,mo(e,n))}function wl(t,e){return typeof t=="function"?t(e):t}function _s(t){return t.split("-")[0]}function rc(t){return t.split("-")[1]}function jp(t){return t==="x"?"y":"x"}function Gp(t){return t==="y"?"height":"width"}function yl(t){return["top","bottom"].includes(_s(t))?"y":"x"}function zp(t){return jp(yl(t))}function A8(t,e,n){n===void 0&&(n=!1);const r=rc(t),i=zp(t),s=Gp(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=ic(o)),[o,ic(o)]}function C8(t){const e=ic(t);return[d1(t),e,d1(e)]}function d1(t){return t.replace(/start|end/g,e=>k8[e])}function M8(t,e,n){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function R8(t,e,n,r){const i=rc(t);let s=M8(_s(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(d1)))),s}function ic(t){return t.replace(/left|right|bottom|top/g,e=>T8[e])}function L8(t){return{top:0,right:0,bottom:0,left:0,...t}}function Xp(t){return typeof t!="number"?L8(t):{top:t,right:t,bottom:t,left:t}}function ca(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function Yp(t,e,n){let{reference:r,floating:i}=t;const s=yl(e),o=zp(e),a=Gp(o),l=_s(e),c=s==="y",u=r.x+r.width/2-i.width/2,f=r.y+r.height/2-i.height/2,p=r[a]/2-i[a]/2;let y;switch(l){case"top":y={x:u,y:r.y-i.height};break;case"bottom":y={x:u,y:r.y+r.height};break;case"right":y={x:r.x+r.width,y:f};break;case"left":y={x:r.x-i.width,y:f};break;default:y={x:r.x,y:r.y}}switch(rc(e)){case"start":y[o]-=p*(n&&c?-1:1);break;case"end":y[o]+=p*(n&&c?-1:1);break}return y}const P8=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:f}=Yp(c,r,l),p=r,y={},m=0;for(let g=0;g<a.length;g++){const{name:w,fn:_}=a[g],{x:b,y:E,data:R,reset:h}=await _({x:u,y:f,initialPlacement:r,placement:p,strategy:i,middlewareData:y,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,f=E??f,y={...y,[w]:{...y[w],...R}},h&&m<=50&&(m++,typeof h=="object"&&(h.placement&&(p=h.placement),h.rects&&(c=h.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):h.rects),{x:u,y:f}=Yp(c,p,l)),g=-1)}return{x:u,y:f,placement:p,strategy:i,middlewareData:y}};async function Kp(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:p=!1,padding:y=0}=wl(e,t),m=Xp(y),w=a[p?f==="floating"?"reference":"floating":f],_=ca(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(w)))==null||n?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=f==="floating"?{...o.floating,x:r,y:i}:o.reference,E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),R=await(s.isElement==null?void 0:s.isElement(E))?await(s.getScale==null?void 0:s.getScale(E))||{x:1,y:1}:{x:1,y:1},h=ca(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:E,strategy:l}):b);return{top:(_.top-h.top+m.top)/R.y,bottom:(h.bottom-_.bottom+m.bottom)/R.y,left:(_.left-h.left+m.left)/R.x,right:(h.right-_.right+m.right)/R.x}}const I8=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:p,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0,...w}=wl(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const _=_s(i),b=_s(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),R=p||(b||!g?[ic(a)]:C8(a));!p&&m!=="none"&&R.push(...R8(a,g,m,E));const h=[a,...R],k=await Kp(e,w),L=[];let $=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&L.push(k[_]),f){const ae=A8(i,o,E);L.push(k[ae[0]],k[ae[1]])}if($=[...$,{placement:i,overflows:L}],!L.every(ae=>ae<=0)){var P,I;const ae=(((P=s.flip)==null?void 0:P.index)||0)+1,V=h[ae];if(V)return{data:{index:ae,overflows:$},reset:{placement:V}};let v=(I=$.filter(D=>D.overflows[0]<=0).sort((D,F)=>D.overflows[1]-F.overflows[1])[0])==null?void 0:I.placement;if(!v)switch(y){case"bestFit":{var H;const D=(H=$.map(F=>[F.placement,F.overflows.filter(Y=>Y>0).reduce((Y,K)=>Y+K,0)]).sort((F,Y)=>F[1]-Y[1])[0])==null?void 0:H[0];D&&(v=D);break}case"initialPlacement":v=a;break}if(i!==v)return{reset:{placement:v}}}return{}}}};function qp(t){const e=mo(...t.map(s=>s.left)),n=mo(...t.map(s=>s.top)),r=zi(...t.map(s=>s.right)),i=zi(...t.map(s=>s.bottom));return{x:e,y:n,width:r-e,height:i-n}}function B8(t){const e=t.slice().sort((i,s)=>i.y-s.y),n=[];let r=null;for(let i=0;i<e.length;i++){const s=e[i];!r||s.y-r.y>r.height/2?n.push([s]):n[n.length-1].push(s),r=s}return n.map(i=>ca(qp(i)))}const O8=function(t){return t===void 0&&(t={}),{name:"inline",options:t,async fn(e){const{placement:n,elements:r,rects:i,platform:s,strategy:o}=e,{padding:a=2,x:l,y:c}=wl(t,e),u=Array.from(await(s.getClientRects==null?void 0:s.getClientRects(r.reference))||[]),f=B8(u),p=ca(qp(u)),y=Xp(a);function m(){if(f.length===2&&f[0].left>f[1].right&&l!=null&&c!=null)return f.find(w=>l>w.left-y.left&&l<w.right+y.right&&c>w.top-y.top&&c<w.bottom+y.bottom)||p;if(f.length>=2){if(yl(n)==="y"){const I=f[0],H=f[f.length-1],ae=_s(n)==="top",V=I.top,v=H.bottom,D=ae?I.left:H.left,F=ae?I.right:H.right,Y=F-D,K=v-V;return{top:V,bottom:v,left:D,right:F,width:Y,height:K,x:D,y:V}}const w=_s(n)==="left",_=zi(...f.map(I=>I.right)),b=mo(...f.map(I=>I.left)),E=f.filter(I=>w?I.left===b:I.right===_),R=E[0].top,h=E[E.length-1].bottom,k=b,L=_,$=L-k,P=h-R;return{top:R,bottom:h,left:k,right:L,width:$,height:P,x:k,y:R}}return p}const g=await s.getElementRects({reference:{getBoundingClientRect:m},floating:r.floating,strategy:o});return i.reference.x!==g.reference.x||i.reference.y!==g.reference.y||i.reference.width!==g.reference.width||i.reference.height!==g.reference.height?{reset:{rects:g}}:{}}}};async function D8(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=_s(n),a=rc(n),l=yl(n)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,f=wl(e,t);let{mainAxis:p,crossAxis:y,alignmentAxis:m}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...f};return a&&typeof m=="number"&&(y=a==="end"?m*-1:m),l?{x:y*u,y:p*c}:{x:p*c,y:y*u}}const Zp=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await D8(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},N8=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:w=>{let{x:_,y:b}=w;return{x:_,y:b}}},...l}=wl(t,e),c={x:n,y:r},u=await Kp(e,l),f=yl(_s(i)),p=jp(f);let y=c[p],m=c[f];if(s){const w=p==="y"?"top":"left",_=p==="y"?"bottom":"right",b=y+u[w],E=y-u[_];y=Wp(b,y,E)}if(o){const w=f==="y"?"top":"left",_=f==="y"?"bottom":"right",b=m+u[w],E=m-u[_];m=Wp(b,m,E)}const g=a.fn({...e,[p]:y,[f]:m});return{...g,data:{x:g.x-n,y:g.y-r}}}}};function $s(t){return Jp(t)?(t.nodeName||"").toLowerCase():"#document"}function hi(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function gs(t){var e;return(e=(Jp(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Jp(t){return t instanceof Node||t instanceof hi(t).Node}function bs(t){return t instanceof Element||t instanceof hi(t).Element}function Xi(t){return t instanceof HTMLElement||t instanceof hi(t).HTMLElement}function Qp(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof hi(t).ShadowRoot}function vl(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Si(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function F8(t){return["table","td","th"].includes($s(t))}function h1(t){const e=p1(),n=Si(t);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function $8(t){let e=fa(t);for(;Xi(e)&&!sc(e);){if(h1(e))return e;e=fa(e)}return null}function p1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function sc(t){return["html","body","#document"].includes($s(t))}function Si(t){return hi(t).getComputedStyle(t)}function oc(t){return bs(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function fa(t){if($s(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Qp(t)&&t.host||gs(t);return Qp(e)?e.host:e}function em(t){const e=fa(t);return sc(e)?t.ownerDocument?t.ownerDocument.body:t.body:Xi(e)&&vl(e)?e:em(e)}function El(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=em(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=hi(i);return s?e.concat(o,o.visualViewport||[],vl(i)?i:[],o.frameElement&&n?El(o.frameElement):[]):e.concat(i,El(i,[],n))}function tm(t){const e=Si(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Xi(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=tc(n)!==s||tc(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function m1(t){return bs(t)?t:t.contextElement}function da(t){const e=m1(t);if(!Xi(e))return Fs(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=tm(e);let o=(s?tc(n.width):n.width)/r,a=(s?tc(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const V8=Fs(0);function nm(t){const e=hi(t);return!p1()||!e.visualViewport?V8:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function x8(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==hi(t)?!1:e}function _o(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=m1(t);let o=Fs(1);e&&(r?bs(r)&&(o=da(r)):o=da(t));const a=x8(s,n,r)?nm(s):Fs(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,f=i.height/o.y;if(s){const p=hi(s),y=r&&bs(r)?hi(r):r;let m=p,g=m.frameElement;for(;g&&r&&y!==m;){const w=da(g),_=g.getBoundingClientRect(),b=Si(g),E=_.left+(g.clientLeft+parseFloat(b.paddingLeft))*w.x,R=_.top+(g.clientTop+parseFloat(b.paddingTop))*w.y;l*=w.x,c*=w.y,u*=w.x,f*=w.y,l+=E,c+=R,m=hi(g),g=m.frameElement}}return ca({width:u,height:f,x:l,y:c})}const H8=[":popover-open",":modal"];function rm(t){return H8.some(e=>{try{return t.matches(e)}catch{return!1}})}function U8(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=gs(r),a=e?rm(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Fs(1);const u=Fs(0),f=Xi(r);if((f||!f&&!s)&&(($s(r)!=="body"||vl(o))&&(l=oc(r)),Xi(r))){const p=_o(r);c=da(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x,y:n.y*c.y-l.scrollTop*c.y+u.y}}function W8(t){return Array.from(t.getClientRects())}function im(t){return _o(gs(t)).left+oc(t).scrollLeft}function j8(t){const e=gs(t),n=oc(t),r=t.ownerDocument.body,i=zi(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=zi(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+im(t);const a=-n.scrollTop;return Si(r).direction==="rtl"&&(o+=zi(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function G8(t,e){const n=hi(t),r=gs(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const c=p1();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function z8(t,e){const n=_o(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Xi(t)?da(t):Fs(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function sm(t,e,n){let r;if(e==="viewport")r=G8(t,n);else if(e==="document")r=j8(gs(t));else if(bs(e))r=z8(e,n);else{const i=nm(t);r={...e,x:e.x-i.x,y:e.y-i.y}}return ca(r)}function om(t,e){const n=fa(t);return n===e||!bs(n)||sc(n)?!1:Si(n).position==="fixed"||om(n,e)}function X8(t,e){const n=e.get(t);if(n)return n;let r=El(t,[],!1).filter(a=>bs(a)&&$s(a)!=="body"),i=null;const s=Si(t).position==="fixed";let o=s?fa(t):t;for(;bs(o)&&!sc(o);){const a=Si(o),l=h1(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||vl(o)&&!l&&om(t,o))?r=r.filter(u=>u!==o):i=a,o=fa(o)}return e.set(t,r),r}function Y8(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?X8(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const f=sm(e,u,i);return c.top=zi(f.top,c.top),c.right=mo(f.right,c.right),c.bottom=mo(f.bottom,c.bottom),c.left=zi(f.left,c.left),c},sm(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function K8(t){const{width:e,height:n}=tm(t);return{width:e,height:n}}function q8(t,e,n){const r=Xi(e),i=gs(e),s=n==="fixed",o=_o(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Fs(0);if(r||!r&&!s)if(($s(e)!=="body"||vl(i))&&(a=oc(e)),r){const f=_o(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&(l.x=im(i));const c=o.left+a.scrollLeft-l.x,u=o.top+a.scrollTop-l.y;return{x:c,y:u,width:o.width,height:o.height}}function am(t,e){return!Xi(t)||Si(t).position==="fixed"?null:e?e(t):t.offsetParent}function lm(t,e){const n=hi(t);if(!Xi(t)||rm(t))return n;let r=am(t,e);for(;r&&F8(r)&&Si(r).position==="static";)r=am(r,e);return r&&($s(r)==="html"||$s(r)==="body"&&Si(r).position==="static"&&!h1(r))?n:r||$8(t)||n}const Z8=async function(t){const e=this.getOffsetParent||lm,n=this.getDimensions;return{reference:q8(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,...await n(t.floating)}}};function J8(t){return Si(t).direction==="rtl"}const Q8={convertOffsetParentRelativeRectToViewportRelativeRect:U8,getDocumentElement:gs,getClippingRect:Y8,getOffsetParent:lm,getElementRects:Z8,getClientRects:W8,getDimensions:K8,getScale:da,isElement:bs,isRTL:J8};function ey(t,e){let n=null,r;const i=gs(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const{left:c,top:u,width:f,height:p}=t.getBoundingClientRect();if(a||e(),!f||!p)return;const y=nc(u),m=nc(i.clientWidth-(c+f)),g=nc(i.clientHeight-(u+p)),w=nc(c),b={rootMargin:-y+"px "+-m+"px "+-g+"px "+-w+"px",threshold:zi(0,mo(1,l))||1};let E=!0;function R(h){const k=h[0].intersectionRatio;if(k!==l){if(!E)return o();k?o(!1,k):r=setTimeout(()=>{o(!1,1e-7)},100)}E=!1}try{n=new IntersectionObserver(R,{...b,root:i.ownerDocument})}catch{n=new IntersectionObserver(R,b)}n.observe(t)}return o(!0),s}function um(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=m1(t),u=i||s?[...c?El(c):[],...El(e)]:[];u.forEach(_=>{i&&_.addEventListener("scroll",n,{passive:!0}),s&&_.addEventListener("resize",n)});const f=c&&a?ey(c,n):null;let p=-1,y=null;o&&(y=new ResizeObserver(_=>{let[b]=_;b&&b.target===c&&y&&(y.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var E;(E=y)==null||E.observe(e)})),n()}),c&&!l&&y.observe(c),y.observe(e));let m,g=l?_o(t):null;l&&w();function w(){const _=_o(t);g&&(_.x!==g.x||_.y!==g.y||_.width!==g.width||_.height!==g.height)&&n(),g=_,m=requestAnimationFrame(w)}return n(),()=>{var _;u.forEach(b=>{i&&b.removeEventListener("scroll",n),s&&b.removeEventListener("resize",n)}),f==null||f(),(_=y)==null||_.disconnect(),y=null,l&&cancelAnimationFrame(m)}}const ty=N8,cm=I8,ny=O8,fm=(t,e,n)=>{const r=new Map,i={platform:Q8,...n},s={...i.platform,_c:r};return P8(t,e,{...i,platform:s})},ry=t=>({}),dm=t=>({});function hm(t){let e,n,r,i,s;const o=t[8].default,a=Ro(o,t,t[7],null);return{c(){e=ge("div"),a&&a.c(),re(e,"class","ttu-whispersync-container popover")},m(l,c){de(l,e,c),a&&a.m(e,null),t[10](e),r=!0,i||(s=ka(n=Gg.call(null,e,t[11])),i=!0)},p(l,c){a&&a.p&&(!r||c&128)&&Po(a,o,l,l[7],r?Lo(o,l[7],c,null):Io(l[7]),null),n&&Ai(n.update)&&c&2&&n.update.call(null,l[11])},i(l){r||(J(a,l),r=!0)},o(l){ne(a,l),r=!1},d(l){l&&ce(e),a&&a.d(l),t[10](null),i=!1,s()}}}function iy(t){let e,n,r,i,s,o;const a=t[8].icon,l=Ro(a,t,t[7],dm);let c=t[3]&&hm(t);return{c(){e=ge("div"),n=ge("button"),l&&l.c(),r=me(),c&&c.c(),re(e,"class","flex")},m(u,f){de(u,e,f),oe(e,n),l&&l.m(n,null),t[9](n),oe(e,r),c&&c.m(e,null),i=!0,s||(o=Ke(n,"click",t[4]),s=!0)},p(u,[f]){l&&l.p&&(!i||f&128)&&Po(l,a,u,u[7],i?Lo(a,u[7],f,ry):Io(u[7]),dm),u[3]?c?(c.p(u,f),f&8&&J(c,1)):(c=hm(u),c.c(),J(c,1),c.m(e,null)):c&&(Wt(),ne(c,1,1,()=>{c=null}),jt())},i(u){i||(J(l,u),J(c),i=!0)},o(u){ne(l,u),ne(c),i=!1},d(u){u&&ce(e),l&&l.d(u),t[9](null),c&&c.d(),s=!1,o()}}}function sy(t,e,n){let{$$slots:r={},$$scope:i}=e,{placement:s="left"}=e,{fallbackPlacements:o=["right","top","left"]}=e;function a(){f==null||f(),n(3,u=!1)}let l,c,u=!1,f;async function p(){if(u)return a();n(3,u=!0),await Rr(),f=um(l,c,y)}function y(){fm(l,c,{placement:s,middleware:[Zp(5),cm({fallbackPlacements:o}),ty()]}).then(({x:_,y:b})=>{n(2,c.style.left=`${_}px`,c),n(2,c.style.top=`${b}px`,c)}).catch(()=>{})}function m(_){$t[_?"unshift":"push"](()=>{l=_,n(1,l)})}function g(_){$t[_?"unshift":"push"](()=>{c=_,n(2,c)})}const w=({target:_})=>{_ instanceof Element&&_!==l&&!l.contains(_)&&a()};return t.$$set=_=>{"placement"in _&&n(5,s=_.placement),"fallbackPlacements"in _&&n(6,o=_.fallbackPlacements),"$$scope"in _&&n(7,i=_.$$scope)},[a,l,c,u,p,s,o,i,r,m,g,w]}class pi extends In{constructor(e){super(),Pn(this,e,sy,iy,Tn,{placement:5,fallbackPlacements:6,hide:0})}get hide(){return this.$$.ctx[0]}}function oy(t){let e,n;return{c(){e=ge("div"),n=ge("div"),re(n,"class","opacity-70"),ht(n,"rounded-full",t[2]),Mr(n,"width",`${Math.min(100,t[0])}%`),Mr(n,"height",`${t[1]}rem`),re(e,"class","w-full bg-inverted"),ht(e,"rounded-full",t[2]),ht(e,"m-t-s",t[3]),Mr(e,"height",`${t[1]}rem`)},m(r,i){de(r,e,i),oe(e,n)},p(r,[i]){i&4&&ht(n,"rounded-full",r[2]),i&1&&Mr(n,"width",`${Math.min(100,r[0])}%`),i&2&&Mr(n,"height",`${r[1]}rem`),i&4&&ht(e,"rounded-full",r[2]),i&8&&ht(e,"m-t-s",r[3]),i&2&&Mr(e,"height",`${r[1]}rem`)},i:wt,o:wt,d(r){r&&ce(e)}}}function ay(t,e,n){let{currentProgress:r}=e,{height:i=.625}=e,{rounded:s=!1}=e,{margin:o=!1}=e;return t.$$set=a=>{"currentProgress"in a&&n(0,r=a.currentProgress),"height"in a&&n(1,i=a.height),"rounded"in a&&n(2,s=a.rounded),"margin"in a&&n(3,o=a.margin)},[r,i,s,o]}class _1 extends In{constructor(e){super(),Pn(this,e,ay,oy,Tn,{currentProgress:0,height:1,rounded:2,margin:3})}}const{document:pm,window:g1}=Ic;function mm(t){let e,n,r=!1,i,s=!0,o,a;function l(){cancelAnimationFrame(i),e.paused||(i=J1(l),r=!0),t[64].call(e)}return{c(){e=ge("audio"),e.controls=!0,re(e,"class","hidden"),Mo(e.src,n=t[24])||re(e,"src",n),t[4]===void 0&&Cs(()=>t[65].call(e))},m(c,u){de(c,e,u),e.muted=t[20],isNaN(t[18])||(e.playbackRate=t[18]),t[69](e),o||(a=[Ke(e,"timeupdate",l),Ke(e,"durationchange",t[65]),Ke(e,"volumechange",t[66]),Ke(e,"play",t[67]),Ke(e,"pause",t[67]),Ke(e,"ratechange",t[68]),Ke(e,"loadstart",t[62]),Ke(e,"loadedmetadata",t[46]),Ke(e,"timeupdate",t[47]),Ke(e,"pause",t[47]),Ke(e,"playing",t[51]),Ke(e,"error",t[63])],o=!0)},p(c,u){u[0]&16777216&&!Mo(e.src,n=c[24])&&re(e,"src",n),!r&&u[0]&8&&!isNaN(c[3])&&(e.currentTime=c[3]),r=!1,u[0]&1048576&&(e.muted=c[20]),u[0]&524288&&s!==(s=c[19])&&e[s?"pause":"play"](),u[0]&262144&&!isNaN(c[18])&&(e.playbackRate=c[18])},d(c){c&&ce(e),t[69](null),o=!1,vn(a)}}}function ly(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g;return o=new Tt({props:{path:hg}}),p=new Tt({props:{path:mg}}),{c(){e=ge("div"),n=ge("input"),r=me(),i=ge("div"),s=ge("button"),ve(o.$$.fragment),a=me(),l=ge("span"),c=Ft(t[12]),u=me(),f=ge("button"),ve(p.$$.fragment),re(n,"type","range"),re(n,"min","0.1"),re(n,"max","2"),re(n,"step","0.05"),n.disabled=t[2],s.disabled=t[2],re(l,"class","m-x-s"),f.disabled=t[2],re(i,"class","playback-display flex m-t-s"),re(e,"class","playback-rates")},m(w,_){de(w,e,_),oe(e,n),Ci(n,t[12]),oe(e,r),oe(e,i),oe(i,s),we(o,s,null),oe(i,a),oe(i,l),oe(l,c),oe(i,u),oe(i,f),we(p,f,null),y=!0,m||(g=[Ke(n,"change",t[77]),Ke(n,"input",t[77]),Ke(n,"change",t[50]),Ke(s,"click",t[78]),Ke(f,"click",t[79])],m=!0)},p(w,_){(!y||_[0]&4)&&(n.disabled=w[2]),_[0]&4096&&Ci(n,w[12]),(!y||_[0]&4)&&(s.disabled=w[2]),(!y||_[0]&4096)&&ln(c,w[12]),(!y||_[0]&4)&&(f.disabled=w[2])},i(w){y||(J(o.$$.fragment,w),J(p.$$.fragment,w),y=!0)},o(w){ne(o.$$.fragment,w),ne(p.$$.fragment,w),y=!1},d(w){w&&ce(e),ye(o),ye(p),m=!1,vn(g)}}}function uy(t){let e,n,r,i;return r=new Tt({props:{path:gg}}),{c(){e=ge("div"),n=ge("button"),ve(r.$$.fragment),re(n,"title","Change playback speed"),n.disabled=t[2],re(e,"class","flex m-x-xs"),re(e,"slot","icon")},m(s,o){de(s,e,o),oe(e,n),we(r,n,null),i=!0},p(s,o){(!i||o[0]&4)&&(n.disabled=s[2])},i(s){i||(J(r.$$.fragment,s),i=!0)},o(s){ne(r.$$.fragment,s),i=!1},d(s){s&&ce(e),ye(r)}}}function cy(t){let e=t[24],n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K=mm(t);Cs(t[70]),o=new Tt({props:{path:t[2]||t[19]?yu:rl}}),c=new Tt({props:{path:nf}}),p=new Tt({props:{path:of}}),g=new _1({props:{currentProgress:Math.min(100,t[13]),height:1.5}}),k=new Tt({props:{path:sf}}),P=new Tt({props:{path:rf}}),ae=new Tt({props:{path:t[2]||!t[20]?jd:Gd}});let Q={placement:"top",fallbackPlacements:["top-start","left-start"],$$slots:{icon:[uy],default:[ly]},$$scope:{ctx:t}};return v=new pi({props:Q}),t[80](v),{c(){K.c(),n=me(),r=me(),i=ge("div"),s=ge("button"),ve(o.$$.fragment),a=me(),l=ge("button"),ve(c.$$.fragment),u=me(),f=ge("button"),ve(p.$$.fragment),y=me(),m=ge("button"),ve(g.$$.fragment),w=me(),_=ge("span"),b=Ft(t[10]),R=me(),h=ge("button"),ve(k.$$.fragment),L=me(),$=ge("button"),ve(P.$$.fragment),I=me(),H=ge("button"),ve(ae.$$.fragment),V=me(),ve(v.$$.fragment),re(s,"title","Toggle playback"),re(s,"class","m-x-xs"),s.disabled=t[2],re(l,"class","m-x-xs"),re(l,"title",t[16]),l.disabled=t[2],re(f,"class","m-x-xs"),re(f,"title",t[17]),f.disabled=t[2],re(_,"class","w-full absolute left-0 player-progress-tooltip"),re(m,"class","w-full relative player-progress-tooltip-button m-x-xs"),m.disabled=t[2],re(m,"title",E=t[2]?"Recording in progress":null),ht(m,"recording",t[2]),re(h,"class","m-x-xs"),re(h,"title",t[15]),h.disabled=t[2],re($,"class","m-x-xs"),re($,"title",t[14]),$.disabled=t[2],re(H,"title","Toggle mute"),re(H,"class","m-x-xs"),H.disabled=t[2],re(i,"class","flex items-center w-full m-t-b"),ht(i,"invisible",!t[21])},m(W,O){K.m(W,O),de(W,n,O),de(W,r,O),de(W,i,O),oe(i,s),we(o,s,null),oe(i,a),oe(i,l),we(c,l,null),oe(i,u),oe(i,f),we(p,f,null),oe(i,y),oe(i,m),we(g,m,null),oe(m,w),oe(m,_),oe(_,b),oe(i,R),oe(i,h),we(k,h,null),oe(i,L),oe(i,$),we(P,$,null),oe(i,I),oe(i,H),we(ae,H,null),oe(i,V),we(v,i,null),D=!0,F||(Y=[Ke(g1,"blur",t[43]),Ke(g1,"focus",t[44]),Ke(g1,"keydown",t[45]),Ke(pm,"visibilitychange",t[70]),Ke(s,"click",t[71]),Ke(l,"click",t[72]),Ke(f,"click",t[73]),Ke(m,"pointerenter",t[48]),Ke(m,"pointermove",t[48]),Ke(m,"pointerout",t[48]),Ke(m,"click",t[49]),Ke(h,"click",t[74]),Ke($,"click",t[75]),Ke(H,"click",t[76])],F=!0)},p(W,O){O[0]&16777216&&Tn(e,e=W[24])?(K.d(1),K=mm(W),K.c(),K.m(n.parentNode,n)):K.p(W,O);const C={};O[0]&524292&&(C.path=W[2]||W[19]?yu:rl),o.$set(C),(!D||O[0]&4)&&(s.disabled=W[2]),(!D||O[0]&65536)&&re(l,"title",W[16]),(!D||O[0]&4)&&(l.disabled=W[2]),(!D||O[0]&131072)&&re(f,"title",W[17]),(!D||O[0]&4)&&(f.disabled=W[2]);const S={};O[0]&8192&&(S.currentProgress=Math.min(100,W[13])),g.$set(S),(!D||O[0]&1024)&&ln(b,W[10]),(!D||O[0]&4)&&(m.disabled=W[2]),(!D||O[0]&4&&E!==(E=W[2]?"Recording in progress":null))&&re(m,"title",E),(!D||O[0]&4)&&ht(m,"recording",W[2]),(!D||O[0]&32768)&&re(h,"title",W[15]),(!D||O[0]&4)&&(h.disabled=W[2]),(!D||O[0]&16384)&&re($,"title",W[14]),(!D||O[0]&4)&&($.disabled=W[2]);const M={};O[0]&1048580&&(M.path=W[2]||!W[20]?jd:Gd),ae.$set(M),(!D||O[0]&4)&&(H.disabled=W[2]);const X={};O[0]&12587012|O[4]&8&&(X.$$scope={dirty:O,ctx:W}),v.$set(X),(!D||O[0]&2097152)&&ht(i,"invisible",!W[21])},i(W){D||(J(o.$$.fragment,W),J(c.$$.fragment,W),J(p.$$.fragment,W),J(g.$$.fragment,W),J(k.$$.fragment,W),J(P.$$.fragment,W),J(ae.$$.fragment,W),J(v.$$.fragment,W),D=!0)},o(W){ne(o.$$.fragment,W),ne(c.$$.fragment,W),ne(p.$$.fragment,W),ne(g.$$.fragment,W),ne(k.$$.fragment,W),ne(P.$$.fragment,W),ne(ae.$$.fragment,W),ne(v.$$.fragment,W),D=!1},d(W){W&&(ce(n),ce(r),ce(i)),K.d(W),ye(o),ye(c),ye(p),ye(g),ye(k),ye(P),ye(ae),t[80](null),ye(v),F=!1,vn(Y)}}}function fy(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z;fe(t,Ko,xe=>n(18,l=xe)),fe(t,kn,xe=>n(19,c=xe)),fe(t,xi,xe=>n(2,u=xe)),fe(t,os,xe=>n(91,f=xe)),fe(t,Pr,xe=>n(92,p=xe)),fe(t,Hi,xe=>n(3,y=xe)),fe(t,za,xe=>n(20,b=xe)),fe(t,Ls,xe=>n(21,R=xe)),fe(t,as,xe=>n(4,$=xe)),fe(t,Lr,xe=>n(98,P=xe)),fe(t,Ct,xe=>n(99,I=xe)),fe(t,Ho,xe=>n(100,H=xe)),fe(t,kt,xe=>n(101,ae=xe)),fe(t,yi,xe=>n(103,v=xe)),fe(t,Ga,xe=>n(105,C=xe)),fe(t,En,xe=>n(108,X=xe)),fe(t,Xa,xe=>n(60,ie=xe)),fe(t,au,xe=>n(61,G=xe)),fe(t,Da,xe=>n(24,z=xe));let{imageLoaded:le}=e;async function Me(){if(u||!_)return;let xe=p.get(f.current||f.previous);xe||(xe=[...p.values()].findLast(At=>y>=At.startSeconds)),xe&&(E&&T&&document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"pauseTracker",scrollMode:w,scrollBehavior:g,selector:Qs(xe.id)}})),await new Promise(Rt=>setTimeout(Rt)),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"cue",scrollMode:w,scrollBehavior:g,selector:Qs(xe.id)}})))}const _e=Mi(),{readerEnableAutoScroll$:Ae,readerEnableTrackerAutoPause$:Ee,readerScrollMode$:Ve,readerScrollBehavior$:Te,readerEnableMenuTarget$:Le,readerMenuOpenMode$:Ie,playerEnableDictionaryDetection$:et,playerEnableWakeLock$:B,playerEnableSubtitleCopy$:x,playerAutoPauseMode$:Ne,playerRewindTime$:We,playerAltRewindTime$:tt,playerFastForwardTime$:ke,playerAltFastForwardTime$:Pe,playerPlaybackRateDecreaseTime$:Xe,playerPlaybackRateIncreaseTime$:qe,exportAudioBitrate$:it,keybindingsEnableTimeFallback$:Je}=_t;fe(t,Ae,xe=>n(96,_=xe)),fe(t,Ee,xe=>n(97,E=xe)),fe(t,Ve,xe=>n(95,w=xe)),fe(t,Te,xe=>n(94,g=xe)),fe(t,Le,xe=>n(107,M=xe)),fe(t,Ie,xe=>n(106,S=xe)),fe(t,et,xe=>n(57,h=xe)),fe(t,B,xe=>n(59,L=xe)),fe(t,x,xe=>n(93,m=xe)),fe(t,Ne,xe=>n(58,k=xe)),fe(t,We,xe=>n(8,K=xe)),fe(t,tt,xe=>n(7,Y=xe)),fe(t,ke,xe=>n(6,F=xe)),fe(t,Pe,xe=>n(5,D=xe)),fe(t,Xe,xe=>n(22,Q=xe)),fe(t,qe,xe=>n(23,W=xe)),fe(t,it,xe=>n(102,V=xe)),fe(t,Je,xe=>n(104,O=xe));const{isIOS:U}=Bo("context"),T=!!+`${window.localStorage.getItem("statisticsEnabled")||"0"}`,d=new MutationObserver(en),A=new MutationObserver(on);let N,j,ee,te,se,be,he="",Ce=[],Re=[],Fe=!1,nt=!1,pt=-1,je=-1,ft=-1,Oe,$e=l,at,Ge;La(()=>{document.addEventListener("ttsu:section.change",Nt,!1),n(56,ee=document.getElementById("jpdb-popup"))}),Gl(()=>{document.removeEventListener("ttsu:section.change",Nt,!1),d.disconnect(),A.disconnect(),br()});async function mt(){c||u||k!==ui.STRICT||h&&Ye()||(pe(kn,c=!0,c),n(11,Fe=!0))}function Qe(){!c||!Fe||k!==ui.STRICT||!h&&Ye()||(pe(kn,c=!1,c),n(11,Fe=!1))}function vt(xe){if(X||xe.repeat||!(xe.ctrlKey||xe.metaKey||xe.altKey)||!R||u)return;const Rt=(xe.code||xe.key||"").toLowerCase(),At=M&&S!==er.DISABLED?C:void 0;let sn=Be.NONE,Dn=!0,It=!1,Xt=At||p.get(f.current||f.previous),Nn;if(!Xt&&O&&(Nn=[...p.values()],Xt=Nn.findLast(Cr=>y>=Cr.startSeconds)),xe.altKey)switch(Rt){case"keyd":case"d":sn=Xt?Be.TOGGLE_PLAY_PAUSE:Be.NONE;break;case"keyq":case"q":sn=Be.NEXT_SUBTITLE;break;case"keyk":case"k":Un(W);break;case"keyj":case"j":pe(kn,c=!c,c);break;default:Dn=!1;break}else switch(Rt){case"space":case" ":pe(kn,c=!c,c);break;case"keyd":case"d":sn=Xt?Be.RESTART_PLAYBACK:Be.NONE;break;case"keyl":case"l":sn=Xt?Be.TOGGLE_PLAYBACK_LOOP:Be.NONE;break;case"keyq":case"q":sn=Be.PREVIOUS_SUBTITLE;break;case"keyk":case"k":Un(-Q);break;case"arrowleft":Xt=mn(Math.max(0,y-K)),sn=Be.RESTART_PLAYBACK,It=!0;break;case"arrowdown":Xt=mn(Math.max(0,y-Y)),sn=Be.RESTART_PLAYBACK,It=!0;break;case"arrowright":Xt=mn(Math.min($,y+F)),sn=Be.RESTART_PLAYBACK,It=!0;break;case"arrowup":Xt=mn(Math.min($,y+D)),sn=Be.RESTART_PLAYBACK,It=!0;break;default:Dn=!1;break}Dn&&(xe.preventDefault(),xe.stopPropagation()),Bn(sn,Xt,{keepPauseState:It})}async function Lt(){if(!U)return n(0,N.currentTime=y,N),_e("loaded");let xe=0,Rt;const At=y,sn=new Promise(It=>{Rt=It,N.addEventListener("loadeddata",It,{once:!0,capture:!1})});await new Promise(It=>xo.add({component:Sh,props:{dialogHeader:"Audio",dialogMessage:"Start audio session",showCancel:!1,resolver:It}})),await new Promise(It=>{const Xt=setInterval(async()=>{try{xe+=1,N.play(),setTimeout(Rt,1e4),await sn,N.pause(),clearInterval(Xt),It()}catch{}xe>20&&(clearInterval(Xt),Rt(void 0),It())},500)}),Qt(At),await Rr(),_e("loaded")}async function lt(){if(v!=null&&v.signal.aborted)return await Up(V,!0).catch(()=>{}),Ge==null||Ge(new fd("user aborted")),Ce=[],Re=[],pt=-1,nt=!1,pe(kn,c=!0,c),Kt();if(pt>-1&&y>Re[pt]){const Rt=pt===Re.length-1,At=nt&&Rt,sn=At||!Rt,Dn=pt;if(pt=-1,sn)return pt=At?0:Dn+1,Qt(Ce[pt]);if(Ce=[],Re=[],nt=!1,pe(kn,c=!0,c),at){const It=await Up(V).catch(Xt=>{Ge==null||Ge(Xt),Kt()});at(It)}return Kt()}let xe=R;if(R||(pe(Ls,R=!0,R),p.size&&On({subtitles:[...p.values()],replaceTrack:!0}),await Promise.all([Rr(),le()]),pe(kt,ae=!1,ae)),!(je>-1||!xe)){pe(Ct,I="",I);try{const Rt=y;await H.put("audioBook",{playbackPosition:Rt,title:P.title,lastAudioBookModified:Date.now()}),pe(Lr,P.playbackPosition=Rt,P),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"audioBook"}}))}catch({message:Rt}){pe(Ct,I=`Failed to update current time: ${Rt}`,I)}Lr.set(P)}}function Et(xe){n(10,he=eo(zt(xe)))}async function dt(){await Rr(),Bn(Be.RESTART_PLAYBACK,mn(U_(he)),{keepPauseState:!0})}function Gt({currentTarget:xe}){const Rt=Number.parseFloat(xe.value);pe(Ko,l=Rt,l),se.hide()}function Qt(xe){pe(Hi,y=xe,y),N&&n(0,N.currentTime=xe,N)}function Kt(){at=void 0,Ge=void 0,je>-1&&Qt(je),ft>-1&&pe(Ko,l=ft,l),Oe!==void 0&&pe(za,b=Oe,b),je=-1,ft=-1,Oe=void 0}function zt(xe){const Rt=xe.currentTarget.getBoundingClientRect();return Ui(0,$,Math.ceil((xe.clientX-Rt.left)/Rt.width*$+Number.EPSILON))}function nn(xe){xe==="visible"&&L&&setTimeout(ct,500),!(k!==ui.MODERATE||u)&&(xe==="hidden"&&!c&&(!h||!Ye())?(pe(kn,c=!0,c),n(11,Fe=!0)):c&&Fe&&xe==="visible"&&(h||!Ye())&&(pe(kn,c=!1,c),n(11,Fe=!1)))}async function Ln(xe){if(!R||!xe.subtitles.length)return;await Rr();const{action:Rt,subtitles:At,skipUpdates:sn,keepPauseState:Dn}=xe,{startSeconds:It}=At[0],Xt=Rt!==Be.RESTART_PLAYBACK;if({recorderSuccess:at,recorderFailure:Ge}=xe,sn||at?(je=je>-1?je:y,ft=ft>-1?ft:l,Oe=Oe!==void 0?Oe:b):(je=-1,ft=-1,Oe=void 0),!sn&&!u&&_&&E&&T){const Nn=[...p.values()].findLast(Cr=>It>=Cr.startSeconds);Nn&&Nn.id!==f.current&&document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"pauseTracker",scrollMode:w,scrollBehavior:g,selector:Qs(Nn.id)}}))}if(Ce=Xt?At.map(Nn=>Nn.startSeconds):[],Re=Xt?At.map(Nn=>Nn.endSeconds):[],pt=Xt?0:-1,nt=Xt?Rt===Be.TOGGLE_PLAYBACK_LOOP:!1,Qt(It),at&&Ge)return S8(N).then(()=>{pe(Ko,l=1,l),pe(za,b=!1,b),pe(kn,c=!1,c)}).catch(Nn=>{Ge==null||Ge(Nn),Kt()});Dn||pe(kn,c=!1,c)}function On(xe){var Dn;const{subtitles:Rt}=xe,At=[...N.textTracks],sn=At.findLast(It=>It.mode!=="disabled");if(xe.replaceTrack)for(let It=0,{length:Xt}=At;It<Xt;It+=1)At[It].mode="disabled";if(!Rt.length)return Nt();if(xe.replaceTrack){const It=N.addTextTrack("captions","Captions","jp");for(let Xt=0,{length:Nn}=Rt;Xt<Nn;Xt+=1)It.addCue(xn(Rt[Xt]));It.mode="hidden";return}if(sn){for(let It=0,{length:Xt}=Rt;It<Xt;It+=1){const Nn=Rt[It],Cr=(Dn=sn.cues)==null?void 0:Dn.getCueById(Nn.id);Cr&&(Cr.removeEventListener("enter",Ut,!1),Cr.removeEventListener("exit",Nt,!1),sn.removeCue(Cr)),sn.addCue(xn(Nn))}sn.mode="hidden"}}function xn(xe){const Rt=new VTTCue(xe.startSeconds,xe.endSeconds,"");return Rt.id=xe.id,Rt.addEventListener("enter",Ut,!1),Rt.addEventListener("exit",Nt,!1),Rt}function Ut(xe){var At;const{id:Rt}=xe.target;Nt(Rt),je===-1&&_&&document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"cue",scrollMode:w,scrollBehavior:g,selector:Qs(Rt)}})),m&&navigator.clipboard.writeText(((At=p.get(Rt))==null?void 0:At.text)||"").catch(({message:sn})=>console.log(`failed to copy subtitle: ${sn}`))}async function Nt(xe){var Dn;if(je>-1)return;const Rt=[...N.textTracks].findLast(It=>It.mode!=="disabled");let At=[...(Rt==null?void 0:Rt.activeCues)||[]].map(It=>It.id);if(Rt&&!At.length&&typeof xe=="string"&&U){const It=((Dn=[...p.values()].findLast(Xt=>y>=Xt.startSeconds))==null?void 0:Dn.id)||"";It&&At.push(It)}if(c&&At.length>1){const It=p.get(At[At.length-2]),Xt=p.get(At[At.length-1]);(It.startSeconds>=Xt.startSeconds&&It.startSeconds<=Xt.endSeconds||Xt.startSeconds>=It.startSeconds&&Xt.startSeconds<=It.endSeconds)&&(At=[Xt.id])}const sn=document.querySelectorAll(`${cu()}.active${At.length?`,${At.map(It=>Qs(It)).join(",")}`:""}`);for(let It=0,{length:Xt}=sn;It<Xt;It+=1){const Nn=sn[It],Cr=jc(Nn);Cr!=="not existing"&&At.find(Ws=>Ws===Cr)?Nn.classList.add("active"):Nn.classList.remove("active")}At.length?pe(os,f={previous:f.current,current:At[At.length-1],useTimeFallback:!1},f):pe(os,f={previous:f.current,current:"",useTimeFallback:!0},f)}function en(){n(55,j=document.querySelector(".yomichan-popup,.yomichan-float,.yomitan-popup,.yomitan-float")),j&&d.disconnect()}function on(){if(!ee&&!j||u)return;const xe=Ye();xe&&!c?(pe(kn,c=!0,c),n(11,Fe=!0)):!xe&&c&&Fe&&(pe(kn,c=!1,c),n(11,Fe=!1))}function Ye(){return j&&j.style.visibility!=="hidden"||ee&&ee.style.opacity!=="0"}async function ct(){te&&!te.released||(te=await navigator.wakeLock.request().catch(()=>{}),te&&te.addEventListener("release",br,!1))}async function br(){te&&!te.released&&await te.release().catch(()=>{}),te=void 0}function Un(xe){pe(Ko,l=Ui(.1,2,Math.round((l+xe)*100+Number.EPSILON)/100),l),n(12,$e=l)}function tn(xe){wn.call(this,t,xe)}function Yn(xe){wn.call(this,t,xe)}function wr(){y=this.currentTime,Hi.set(y)}function Wn(){$=this.duration,as.set($)}function Jn(){b=this.muted,za.set(b)}function fn(){c=this.paused,kn.set(c)}function Ar(){l=this.playbackRate,Ko.set(l)}function yr(xe){$t[xe?"unshift":"push"](()=>{N=xe,n(0,N)})}function dn(){n(1,be=pm.visibilityState)}const fr=()=>{pe(kn,c=!c,c),n(11,Fe=!1)},ri=()=>Bn(Be.RESTART_PLAYBACK,mn(Math.max(0,y-Y)),{keepPauseState:!0}),bi=()=>Bn(Be.RESTART_PLAYBACK,mn(Math.max(0,y-K)),{keepPauseState:!0}),jn=()=>Bn(Be.RESTART_PLAYBACK,mn(Math.min($,y+F)),{keepPauseState:!0}),Wr=()=>Bn(Be.RESTART_PLAYBACK,mn(Math.min($,y+D)),{keepPauseState:!0}),He=()=>pe(za,b=!b,b);function Bt(){$e=Bc(this.value),n(12,$e)}const Pt=()=>Un(-Q),xt=()=>Un(W);function rn(xe){$t[xe?"unshift":"push"](()=>{se=xe,n(9,se)})}return t.$$set=xe=>{"imageLoaded"in xe&&n(53,le=xe.imageLoaded)},t.$$.update=()=>{t.$$.dirty[0]&260&&n(17,r=u?"Recording in progress":`Rewind ${K} seconds`),t.$$.dirty[0]&132&&n(16,i=u?"Recording in progress":`Rewind ${Y} seconds`),t.$$.dirty[0]&68&&n(15,s=u?"Recording in progress":`Fast-Forward ${F} seconds`),t.$$.dirty[0]&36&&n(14,o=u?"Recording in progress":`Fast-Forward ${D} seconds`),t.$$.dirty[0]&24&&n(13,a=Math.min(100,Ka(y,$))),t.$$.dirty[0]&2&&nn(be),t.$$.dirty[1]&1073741824&&Ln(G),t.$$.dirty[0]&1|t.$$.dirty[1]&536870912&&N&&ie&&On(ie),t.$$.dirty[1]&150994944&&(k!==ui.DISABLED&&!j?(n(55,j=document.querySelector(".yomichan-popup,.yomichan-float,.yomitan-popup,.yomitan-float")),j||d.observe(document.body,{childList:!0,subtree:!1})):d.disconnect()),t.$$.dirty[1]&251658240&&(k!==ui.DISABLED&&!h?(j&&A.observe(j,{attributes:!0}),ee&&A.observe(ee,{attributes:!0})):A.disconnect()),t.$$.dirty[1]&268435456&&(L?ct():br())},[N,be,u,y,$,D,F,Y,K,se,he,Fe,$e,a,o,s,i,r,l,c,b,R,Q,W,z,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,tt,ke,Pe,Xe,qe,it,Je,mt,Qe,vt,Lt,lt,Et,dt,Gt,ct,Un,le,Me,j,ee,h,k,L,ie,G,tn,Yn,wr,Wn,Jn,fn,Ar,yr,dn,fr,ri,bi,jn,Wr,He,Bt,Pt,xt,rn]}class dy extends In{constructor(e){super(),Pn(this,e,fy,cy,Tn,{imageLoaded:53,onScrollToSubtitle:54},null,[-1,-1,-1,-1,-1])}get onScrollToSubtitle(){return this.$$.ctx[54]}}function hy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var _m={exports:{}},cr=_m.exports={},Yi,Ki;function b1(){throw new Error("setTimeout has not been defined")}function w1(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Yi=setTimeout:Yi=b1}catch{Yi=b1}try{typeof clearTimeout=="function"?Ki=clearTimeout:Ki=w1}catch{Ki=w1}})();function gm(t){if(Yi===setTimeout)return setTimeout(t,0);if((Yi===b1||!Yi)&&setTimeout)return Yi=setTimeout,setTimeout(t,0);try{return Yi(t,0)}catch{try{return Yi.call(null,t,0)}catch{return Yi.call(this,t,0)}}}function py(t){if(Ki===clearTimeout)return clearTimeout(t);if((Ki===w1||!Ki)&&clearTimeout)return Ki=clearTimeout,clearTimeout(t);try{return Ki(t)}catch{try{return Ki.call(null,t)}catch{return Ki.call(this,t)}}}var ws=[],ha=!1,go,ac=-1;function my(){!ha||!go||(ha=!1,go.length?ws=go.concat(ws):ac=-1,ws.length&&bm())}function bm(){if(!ha){var t=gm(my);ha=!0;for(var e=ws.length;e;){for(go=ws,ws=[];++ac<e;)go&&go[ac].run();ac=-1,e=ws.length}go=null,ha=!1,py(t)}}cr.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];ws.push(new wm(t,e)),ws.length===1&&!ha&&gm(bm)};function wm(t,e){this.fun=t,this.array=e}wm.prototype.run=function(){this.fun.apply(null,this.array)},cr.title="browser",cr.browser=!0,cr.env={},cr.argv=[],cr.version="",cr.versions={};function ys(){}cr.on=ys,cr.addListener=ys,cr.once=ys,cr.off=ys,cr.removeListener=ys,cr.removeAllListeners=ys,cr.emit=ys,cr.prependListener=ys,cr.prependOnceListener=ys,cr.listeners=function(t){return[]},cr.binding=function(t){throw new Error("process.binding is not supported")},cr.cwd=function(){return"/"},cr.chdir=function(t){throw new Error("process.chdir is not supported")},cr.umask=function(){return 0};var _y=_m.exports;const pa=hy(_y);function ma(t,e,n){let r=n.initialDeps??[],i;return()=>{var s,o,a,l;let c;n.key&&((s=n.debug)!=null&&s.call(n))&&(c=Date.now());const u=t();if(!(u.length!==r.length||u.some((y,m)=>r[m]!==y)))return i;r=u;let p;if(n.key&&((o=n.debug)!=null&&o.call(n))&&(p=Date.now()),i=e(...u),n.key&&((a=n.debug)!=null&&a.call(n))){const y=Math.round((Date.now()-c)*100)/100,m=Math.round((Date.now()-p)*100)/100,g=m/16,w=(_,b)=>{for(_=String(_);_.length<b;)_=" "+_;return _};console.info(`%c ${w(m,5)} /${w(y,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*g,120))}deg 100% 31%);`,n==null?void 0:n.key)}return(l=n==null?void 0:n.onChange)==null||l.call(n,i),i}}function y1(t,e){if(t===void 0)throw new Error(`Unexpected undefined${e?`: ${e}`:""}`);return t}const gy=(t,e)=>Math.abs(t-e)<1,by=t=>t,wy=t=>{const e=Math.max(t.startIndex-t.overscan,0),n=Math.min(t.endIndex+t.overscan,t.count-1),r=[];for(let i=e;i<=n;i++)r.push(i);return r},yy=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=s=>{const{width:o,height:a}=s;e({width:Math.round(o),height:Math.round(a)})};if(r(n.getBoundingClientRect()),typeof ResizeObserver>"u")return()=>{};const i=new ResizeObserver(s=>{const o=s[0];if(o!=null&&o.borderBoxSize){const a=o.borderBoxSize[0];if(a){r({width:a.inlineSize,height:a.blockSize});return}}r(n.getBoundingClientRect())});return i.observe(n,{box:"border-box"}),()=>{i.unobserve(n)}},vy=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=()=>{e(n[t.options.horizontal?"scrollLeft":"scrollTop"])};return r(),n.addEventListener("scroll",r,{passive:!0}),()=>{n.removeEventListener("scroll",r)}},Ey=(t,e,n)=>{if(e!=null&&e.borderBoxSize){const r=e.borderBoxSize[0];if(r)return Math.round(r[n.options.horizontal?"inlineSize":"blockSize"])}return Math.round(t.getBoundingClientRect()[n.options.horizontal?"width":"height"])},Sy=(t,{adjustments:e=0,behavior:n},r)=>{var i,s;const o=t+e;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})};class Ty{constructor(e){this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let n=null;const r=()=>n||(typeof ResizeObserver<"u"?n=new ResizeObserver(i=>{i.forEach(s=>{this._measureElement(s.target,s)})}):null);return{disconnect:()=>{var i;return(i=r())==null?void 0:i.disconnect()},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([r,i])=>{typeof i>"u"&&delete n[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:by,rangeExtractor:wy,onChange:()=>{},measureElement:Ey,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,...n}},this.notify=n=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,n)},this.maybeNotify=ma(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:pa.env.NODE_ENV!=="production"&&"maybeNotify",debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{const n=this.options.getScrollElement();this.scrollElement!==n&&(this.cleanup(),this.scrollElement=n,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,r=>{this.scrollAdjustments=0,this.scrollOffset!==r&&(this.isScrollingTimeoutId!==null&&(clearTimeout(this.isScrollingTimeoutId),this.isScrollingTimeoutId=null),this.isScrolling=!0,this.scrollDirection=this.scrollOffset<r?"forward":"backward",this.scrollOffset=r,this.maybeNotify(),this.isScrollingTimeoutId=setTimeout(()=>{this.isScrollingTimeoutId=null,this.isScrolling=!1,this.scrollDirection=null,this.maybeNotify()},this.options.scrollingDelay))})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.memoOptions=ma(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(n,r,i,s)=>(this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:r,scrollMargin:i,getItemKey:s}),{key:!1}),this.getFurthestMeasurement=(n,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const a=n[o];if(i.has(a.lane))continue;const l=s.get(a.lane);if(l==null||a.end>l.end?s.set(a.lane,a):a.end<l.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurements=ma(()=>[this.memoOptions(),this.itemSizeCache],({count:n,paddingStart:r,scrollMargin:i,getItemKey:s},o)=>{const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,a);for(let c=a;c<n;c++){const u=s(c),f=this.options.lanes===1?l[c-1]:this.getFurthestMeasurement(l,c),p=f?f.end:r+i,y=o.get(u),m=typeof y=="number"?y:this.options.estimateSize(c),g=p+m,w=f?f.lane:c%this.options.lanes;l[c]={index:c,start:p,size:m,end:g,key:u,lane:w}}return this.measurementsCache=l,l},{key:pa.env.NODE_ENV!=="production"&&"getMeasurements",debug:()=>this.options.debug}),this.calculateRange=ma(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(n,r,i)=>this.range=n.length>0&&r>0?ky({measurements:n,outerSize:r,scrollOffset:i}):null,{key:pa.env.NODE_ENV!=="production"&&"calculateRange",debug:()=>this.options.debug}),this.getIndexes=ma(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(n,r,i,s)=>r===null?[]:n({...r,overscan:i,count:s}),{key:pa.env.NODE_ENV!=="production"&&"getIndexes",debug:()=>this.options.debug}),this.indexFromElement=n=>{const r=this.options.indexAttribute,i=n.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(n,r)=>{const i=this.measurementsCache[this.indexFromElement(n)];if(!i||!n.isConnected){this.measureElementCache.forEach((a,l)=>{a===n&&(this.observer.unobserve(n),this.measureElementCache.delete(l))});return}const s=this.measureElementCache.get(i.key);s!==n&&(s&&this.observer.unobserve(s),this.observer.observe(n),this.measureElementCache.set(i.key,n));const o=this.options.measureElement(n,r,this);this.resizeItem(i,o)},this.resizeItem=(n,r)=>{const i=this.itemSizeCache.get(n.key)??n.size,s=r-i;s!==0&&(n.start<this.scrollOffset+this.scrollAdjustments&&(pa.env.NODE_ENV!=="production"&&this.options.debug&&console.info("correction",s),this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=s,behavior:void 0})),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,r)),this.notify(!1))},this.measureElement=n=>{n&&this._measureElement(n,void 0)},this.getVirtualItems=ma(()=>[this.getIndexes(),this.getMeasurements()],(n,r)=>{const i=[];for(let s=0,o=n.length;s<o;s++){const a=n[s],l=r[a];i.push(l)}return i},{key:pa.env.NODE_ENV!=="production"&&"getIndexes",debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const r=this.getMeasurements();return y1(r[ym(0,r.length-1,i=>y1(r[i]).start,n)])},this.getOffsetForAlignment=(n,r)=>{const i=this.getSize();r==="auto"&&(n<=this.scrollOffset?r="start":n>=this.scrollOffset+i?r="end":r="start"),r==="start"?n=n:r==="end"?n=n-i:r==="center"&&(n=n-i/2);const s=this.options.horizontal?"scrollWidth":"scrollHeight",a=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[s]:this.scrollElement[s]:0)-this.getSize();return Math.max(Math.min(a,n),0)},this.getOffsetForIndex=(n,r="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const i=y1(this.getMeasurements()[n]);if(r==="auto")if(i.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)r="end";else if(i.start<=this.scrollOffset+this.options.scrollPaddingStart)r="start";else return[this.scrollOffset,r];const s=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(s,r),r]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&(clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(n,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(n,{align:r="auto",behavior:i}={})=>{n=Math.max(0,Math.min(n,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[s,o]=this.getOffsetForIndex(n,r);this._scrollToOffset(s,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&(this.scrollToIndexTimeoutId=setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(n))){const[l]=this.getOffsetForIndex(n,o);gy(l,this.scrollOffset)||this.scrollToIndex(n,{align:o,behavior:i})}else this.scrollToIndex(n,{align:o,behavior:i})}))},this.scrollBy=(n,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+n,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var n;const r=this.getMeasurements();let i;return r.length===0?i=this.options.paddingStart:i=this.options.lanes===1?((n=r[r.length-1])==null?void 0:n.end)??0:Math.max(...r.slice(-this.options.lanes).map(s=>s.end)),i-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(n,{adjustments:r,behavior:i})=>{this.options.scrollToFn(n,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(n=>{this.itemSizeCache.set(n.key,n.size)}),this.maybeNotify()}}const ym=(t,e,n,r)=>{for(;t<=e;){const i=(t+e)/2|0,s=n(i);if(s<r)t=i+1;else if(s>r)e=i-1;else return i}return t>0?t-1:0};function ky({measurements:t,outerSize:e,scrollOffset:n}){const r=t.length-1,s=ym(0,r,a=>t[a].start,n);let o=s;for(;o<r&&t[o].end<n+e;)o++;return{startIndex:s,endIndex:o}}function Ay(t){const e=new Ty(t),n=e.setOptions;let r;const i=s=>{const o={...e.options,...s,onChange:s.onChange};n({...o,onChange:(a,l)=>{var c;r.set(a),(c=o.onChange)==null||c.call(o,a,l)}}),e._willUpdate()};return r=hn(e,()=>(i(t),e._didMount())),B_(r,s=>Object.assign(s,{setOptions:i}))}function Cy(t){return Ay({observeElementRect:yy,observeElementOffset:vy,scrollToFn:Sy,...t})}function vm(t,e,n){const r=t.slice();return r[56]=e[n],r[57]=e,r[58]=n,r}function Em(t){let e,n,r=[],i=new Map,s,o,a=Kr(t[9]);const l=c=>c[56].key;for(let c=0;c<a.length;c+=1){let u=vm(t,a,c),f=l(u);i.set(f,r[c]=Sm(f,u))}return{c(){var c;e=ge("div"),n=ge("div");for(let u=0;u<r.length;u+=1)r[u].c();re(n,"class","absolute top-0 left-0 w-full"),re(n,"style",s=`transform: translateY(${((c=t[9][0])==null?void 0:c.start)||0}px); font-family: "${t[25]}", "Lora", "Noto Serif JP", serif; font-size: ${t[26]}px; line-height: ${t[27]};`),re(e,"class","relative w-full"),Mr(e,"height",`${t[5].getTotalSize()}px`)},m(c,u){de(c,e,u),oe(e,n);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(n,null);o=!0},p(c,u){var f;u[0]&805314123&&(a=Kr(c[9]),Wt(),r=Ks(r,u,l,1,c,a,i,n,id,Sm,null,vm),jt()),(!o||u[0]&512&&s!==(s=`transform: translateY(${((f=c[9][0])==null?void 0:f.start)||0}px); font-family: "${c[25]}", "Lora", "Noto Serif JP", serif; font-size: ${c[26]}px; line-height: ${c[27]};`))&&re(n,"style",s),u[0]&32&&Mr(e,"height",`${c[5].getTotalSize()}px`)},i(c){if(!o){for(let u=0;u<a.length;u+=1)J(r[u]);o=!0}},o(c){for(let u=0;u<r.length;u+=1)ne(r[u]);o=!1},d(c){c&&ce(e);for(let u=0;u<r.length;u+=1)r[u].d()}}}function Sm(t,e){let n,r,i=e[0][e[56].index].text+"",s,o,a,l,c,u,f,p,y=e[58],m,g,w;u=new ff({props:{hideCancelAction:!0,listItems:e[12],subtitle:e[0][e[56].index],skipUpdates:e[1]}});const _=()=>e[33](n,y),b=()=>e[33](null,y);return{key:t,first:null,c(){n=ge("div"),r=ge("div"),s=Ft(i),a=me(),l=ge("div"),c=ge("div"),ve(u.$$.fragment),f=me(),re(r,"tabindex","0"),re(r,"role","button"),re(r,"class","flex-1 p-b"),re(r,"title",o=e[11]?"Recording in progress":null),ht(r,"cursor-not-allowed",e[11]),re(c,"class","grid"),re(l,"class","flex invisible m-x-xs m-y-b sub-action"),ht(l,"show",e[10]===Sr.ALWAYS),ht(l,"hidden",e[10]===Sr.HIDDEN),re(n,"class","flex items-center sub"),re(n,"data-index",p=e[56].index),ht(n,"active",e[6].current===e[56].key),ht(n,"on-hover",e[10]===Sr.HOVER),this.first=n},m(E,R){de(E,n,R),oe(n,r),oe(r,s),oe(n,a),oe(n,l),oe(l,c),we(u,c,null),oe(n,f),_(),m=!0,g||(w=[Ke(r,"click",e[28]),Ke(r,"pointerdown",e[29]),Ke(r,"keyup",Ry)],g=!0)},p(E,R){e=E,(!m||R[0]&513)&&i!==(i=e[0][e[56].index].text+"")&&ln(s,i),(!m||R[0]&2048&&o!==(o=e[11]?"Recording in progress":null))&&re(r,"title",o),(!m||R[0]&2048)&&ht(r,"cursor-not-allowed",e[11]);const h={};R[0]&4096&&(h.listItems=e[12]),R[0]&513&&(h.subtitle=e[0][e[56].index]),R[0]&2&&(h.skipUpdates=e[1]),u.$set(h),(!m||R[0]&1024)&&ht(l,"show",e[10]===Sr.ALWAYS),(!m||R[0]&1024)&&ht(l,"hidden",e[10]===Sr.HIDDEN),(!m||R[0]&512&&p!==(p=e[56].index))&&re(n,"data-index",p),y!==e[58]&&(b(),y=e[58],_()),(!m||R[0]&576)&&ht(n,"active",e[6].current===e[56].key),(!m||R[0]&1024)&&ht(n,"on-hover",e[10]===Sr.HOVER)},i(E){m||(J(u.$$.fragment,E),m=!0)},o(E){ne(u.$$.fragment,E),m=!1},d(E){E&&ce(n),ye(u),b(),g=!1,vn(w)}}}function My(t){let e,n,r,i,s=t[8]>0&&t[2]&&Em(t);return{c(){e=ge("div"),s&&s.c(),re(e,"class","ttu-whispersync-container subtitle-container h-full w-full"),Mr(e,"height",t[8]?`${t[8]}px`:null)},m(o,a){de(o,e,a),s&&s.m(e,null),t[34](e),n=!0,r||(i=[Ke(e,"pointerdown",t[35]),Ke(e,"pointerup",t[36])],r=!0)},p(o,a){o[8]>0&&o[2]?s?(s.p(o,a),a[0]&260&&J(s,1)):(s=Em(o),s.c(),J(s,1),s.m(e,null)):s&&(Wt(),ne(s,1,1,()=>{s=null}),jt()),a[0]&256&&Mr(e,"height",o[8]?`${o[8]}px`:null)},i(o){n||(J(s),n=!0)},o(o){ne(s),n=!1},d(o){o&&ce(e),s&&s.d(),t[34](null),r=!1,vn(i)}}}const Ry=()=>{};function Ly(t,e,n){let r,i,s=wt,o=()=>(s(),s=ts(z,Pe=>n(5,i=Pe)),z),a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$;fe(t,Ba,Pe=>n(41,u=Pe)),fe(t,os,Pe=>n(6,p=Pe)),fe(t,Ct,Pe=>n(32,y=Pe)),fe(t,Pr,Pe=>n(48,R=Pe)),fe(t,Hi,Pe=>n(49,h=Pe)),fe(t,xi,Pe=>n(11,L=Pe)),t.$$.on_destroy.push(()=>s());let{subtitles:P}=e,{skipUpdates:I=!1}=e;async function H(...Pe){le&&(n(8,Ee=0),await Rr(),z||o(n(2,z=Cy({count:P.length,overscan:10,estimateSize:()=>150,getScrollElement:()=>le,getItemKey:Xe=>P[Xe].id}))),i.measure(),n(8,Ee=Math.floor(le.getBoundingClientRect().height)),await Rr(),ae())}async function ae(Pe=!1){if(L||!i||!P.length||!Pe&&(!k||!p.previous&&!p.current&&!p.useTimeFallback))return;const{previous:Xe,current:qe,useTimeFallback:it}=p,Je=h;let U=-1;if(qe&&R.has(qe)?U=P.findIndex(T=>T.id===qe):Xe&&R.has(Xe)&&(U=P.findIndex(T=>T.id===Xe)),U===-1&&(Pe||it)&&(U=Je?P.findLastIndex(T=>Je>=T.startSeconds):0),U!==-1){for(;!i.itemSizeCache.has(P[U].id);)x(),i.scrollToIndex(U,{align:"auto"}),await new Promise(T=>setTimeout(T));x(),i.scrollToIndex(U,{align:"auto"})}}const{subtitlesEnableAutoScroll$:V,subtitlePreventActionOnSelection$:v,subtitlesCopyFontFamily$:D,subtitlesCopyFontSize$:F,subtitlesCopyLineHeight$:Y,subtitlesFontFamily$:K,subtitlesFontSize$:Q,subtitlesLineHeight$:W,subtitlesClickAction$:O,subtitlesActionsVisibility$:C,subtitlesActionsVisibilityTime$:S,actionListOfSubtitles$:M}=_t;fe(t,V,Pe=>n(50,k=Pe)),fe(t,v,Pe=>n(38,a=Pe)),fe(t,D,Pe=>n(47,E=Pe)),fe(t,F,Pe=>n(45,_=Pe)),fe(t,Y,Pe=>n(43,g=Pe)),fe(t,K,Pe=>n(46,b=Pe)),fe(t,Q,Pe=>n(44,w=Pe)),fe(t,W,Pe=>n(42,m=Pe)),fe(t,O,Pe=>n(39,l=Pe)),fe(t,C,Pe=>n(10,f=Pe)),fe(t,S,Pe=>n(40,c=Pe)),fe(t,M,Pe=>n(12,$=Pe));const X=E?window.localStorage.getItem("fontFamilyGroupOne")||"Noto Serif JP":b,ie=_?Number.parseInt(window.localStorage.getItem("fontSize")||"16",10):w,G=g?Number.parseFloat(window.localStorage.getItem("lineHeight")||"1.65"):m;let z,le,Me=[],_e,Ae=!1,Ee=0;La(H);function Ve(Pe){Pe.button!==0||l===Be.NONE||f===Sr.TOGGLE||Ie()||(et(),Bn(l,P[Number.parseInt(Pe.currentTarget.parentElement.dataset.index,10)]))}function Te(Pe){var qe;if(Pe.button!==0||f!==Sr.TOGGLE)return;a&&u&&((qe=window.getSelection())==null||qe.removeAllRanges(),document.body.style.userSelect="none");const{currentTarget:Xe}=Pe;Xe.addEventListener("pointerup",Le,!1),_e=window.setTimeout(()=>{var it;et(Xe),Ie()||(it=Xe.nextElementSibling)==null||it.classList.toggle("show")},c)}function Le(){et(this),!Ie()&&Bn(l,P[Number.parseInt(this.parentElement.dataset.index,10)])}function Ie(){var Xe;return a?!!((Xe=window.getSelection())==null?void 0:Xe.toString().trim()):!1}function et(Pe){clearTimeout(_e),Pe==null||Pe.removeEventListener("pointerup",Le,!1),document.body.style.userSelect="auto"}async function B(){i&&(i.setOptions({count:P.length}),i.scrollToOffset(0),n(9,r=i.getVirtualItems()),i.measure(),ae())}function x(){for(let Pe=0,{length:Xe}=Me;Pe<Xe;Pe+=1)i.measureElement(Me[Pe])}function Ne(Pe,Xe){$t[Pe?"unshift":"push"](()=>{Me[Xe]=Pe,n(3,Me)})}function We(Pe){$t[Pe?"unshift":"push"](()=>{le=Pe,n(7,le)})}const tt=()=>n(4,Ae=!0),ke=()=>n(4,Ae=!1);return t.$$set=Pe=>{"subtitles"in Pe&&n(0,P=Pe.subtitles),"skipUpdates"in Pe&&n(1,I=Pe.skipUpdates)},t.$$.update=()=>{t.$$.dirty[0]&36&&n(9,r=z?i.getVirtualItems():[]),t.$$.dirty[1]&2&&H(y),t.$$.dirty[0]&1&&P&&B(),t.$$.dirty[0]&64&&p&&ae(),t.$$.dirty[0]&24&&Me.length&&!Ae&&x()},[P,I,z,Me,Ae,i,p,le,Ee,r,f,L,$,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,Ve,Te,H,ae,y,Ne,We,tt,ke]}class Py extends In{constructor(e){super(),Pn(this,e,Ly,My,Tn,{subtitles:0,skipUpdates:1,onResetList:30,scrollToSubtitle:31},null,[-1,-1])}get onResetList(){return this.$$.ctx[30]}get scrollToSubtitle(){return this.$$.ctx[31]}}function Iy(t){let e,n,r,i,s,o,a;return{c(){e=ge("div"),n=Xs("svg"),r=Xs("g"),i=Xs("g"),s=Xs("path"),re(s,"d","M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"),re(s,"fill","currentColor"),re(s,"transform","translate(-256 -256)"),re(i,"transform","translate(0,0) scale(1,1)"),re(r,"transform","translate(256 256)"),re(r,"transform-origin","128 0"),re(n,"width","100%"),re(n,"height","100%"),re(n,"viewBox","0 0 512 512"),re(n,"aria-hidden","true"),re(n,"role","img"),re(n,"xmlns","http://www.w3.org/2000/svg"),re(e,"class","cover")},m(l,c){de(l,e,c),oe(e,n),oe(n,r),oe(r,i),oe(i,s),o||(a=Ke(n,"load",function(){Ai(t[44])&&t[44].apply(this,arguments)}),o=!0)},p(l,c){t=l},d(l){l&&ce(e),o=!1,a()}}}function By(t){let e,n,r,i;return{c(){e=ge("img"),re(e,"id","ttu-whispersync-cover"),re(e,"class","cover"),Mo(e.src,n=t[53])||re(e,"src",n),re(e,"alt","cover")},m(s,o){de(s,e,o),r||(i=Ke(e,"load",function(){Ai(t[44])&&t[44].apply(this,arguments)}),r=!0)},p(s,o){t=s,o[1]&4194304&&!Mo(e.src,n=t[53])&&re(e,"src",n)},d(s){s&&ce(e),r=!1,i()}}}function Tm(t){let e,n,r,i,s,o,a;return n=new Tt({props:{path:Wd}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"class","m-l-s"),re(e,"title",r=t[12]?"Export in progress":"Drop subtitle file"),e.disabled=i=!!t[12]},m(l,c){de(l,e,c),we(n,e,null),s=!0,o||(a=Ke(e,"click",t[85]),o=!0)},p(l,c){(!s||c[0]&4096&&r!==(r=l[12]?"Export in progress":"Drop subtitle file"))&&re(e,"title",r),(!s||c[0]&4096&&i!==(i=!!l[12]))&&(e.disabled=i)},i(l){s||(J(n.$$.fragment,l),s=!0)},o(l){ne(n.$$.fragment,l),s=!1},d(l){l&&ce(e),ye(n),o=!1,a()}}}function km(t){let e,n,r,i,s,o,a;return n=new Tt({props:{path:lg}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"class","m-l-s"),re(e,"title",r=t[12]?"Export in progress":"Drop persisted subtitles"),e.disabled=i=!!t[12]},m(l,c){de(l,e,c),we(n,e,null),s=!0,o||(a=Ke(e,"click",t[71]),o=!0)},p(l,c){(!s||c[0]&4096&&r!==(r=l[12]?"Export in progress":"Drop persisted subtitles"))&&re(e,"title",r),(!s||c[0]&4096&&i!==(i=!!l[12]))&&(e.disabled=i)},i(l){s||(J(n.$$.fragment,l),s=!0)},o(l){ne(n.$$.fragment,l),s=!1},d(l){l&&ce(e),ye(n),o=!1,a()}}}function Oy(t){var w,_;let e,n=(((w=t[11])==null?void 0:w.name)||"None selected")+"",r,i,s,o,a,l,c,u,f,p,y;o=new Tt({props:{path:t[11]?bu:wu}});let m=(t[7].lastSubtitle||((_=t[17])==null?void 0:_.value)||t[24])&&Tm(t),g=t[7].subtitleData&&t[7].subtitleData.subtitles.length&&km(t);return{c(){e=ge("div"),r=Ft(n),i=me(),s=ge("button"),ve(o.$$.fragment),l=me(),m&&m.c(),c=me(),g&&g.c(),u=Dr(),re(s,"title",t[26]),s.disabled=a=!!t[12]},m(b,E){de(b,e,E),oe(e,r),de(b,i,E),de(b,s,E),we(o,s,null),de(b,l,E),m&&m.m(b,E),de(b,c,E),g&&g.m(b,E),de(b,u,E),f=!0,p||(y=Ke(s,"click",t[67]),p=!0)},p(b,E){var h,k;(!f||E[0]&2048)&&n!==(n=(((h=b[11])==null?void 0:h.name)||"None selected")+"")&&ln(r,n);const R={};E[0]&2048&&(R.path=b[11]?bu:wu),o.$set(R),(!f||E[0]&67108864)&&re(s,"title",b[26]),(!f||E[0]&4096&&a!==(a=!!b[12]))&&(s.disabled=a),b[7].lastSubtitle||(k=b[17])!=null&&k.value||b[24]?m?(m.p(b,E),E[0]&16908416&&J(m,1)):(m=Tm(b),m.c(),J(m,1),m.m(c.parentNode,c)):m&&(Wt(),ne(m,1,1,()=>{m=null}),jt()),b[7].subtitleData&&b[7].subtitleData.subtitles.length?g?(g.p(b,E),E[0]&128&&J(g,1)):(g=km(b),g.c(),J(g,1),g.m(u.parentNode,u)):g&&(Wt(),ne(g,1,1,()=>{g=null}),jt())},i(b){f||(J(o.$$.fragment,b),J(m),J(g),f=!0)},o(b){ne(o.$$.fragment,b),ne(m),ne(g),f=!1},d(b){b&&(ce(e),ce(i),ce(s),ce(l),ce(c),ce(u)),ye(o),m&&m.d(b),g&&g.d(b),p=!1,y()}}}function Dy(t){let e,n,r;return n=new Tt({props:{path:wg}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon"),re(e,"title","Show subtitle file")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Ny(t){let e;return{c(){e=ge("div"),e.textContent="Book not matched yet"},m(n,r){de(n,e,r)},p:wt,d(n){n&&ce(e)}}}function Fy(t){let e,n,r,i=t[14].matchedBy+"",s,o,a,l=t[14].matchedOn&&Am(t);return{c(){e=ge("div"),e.textContent="Matched by",n=me(),r=ge("div"),s=Ft(i),o=me(),l&&l.c(),a=Dr()},m(c,u){de(c,e,u),de(c,n,u),de(c,r,u),oe(r,s),de(c,o,u),l&&l.m(c,u),de(c,a,u)},p(c,u){u[0]&16384&&i!==(i=c[14].matchedBy+"")&&ln(s,i),c[14].matchedOn?l?l.p(c,u):(l=Am(c),l.c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null)},d(c){c&&(ce(e),ce(n),ce(r),ce(o),ce(a)),l&&l.d(c)}}}function Am(t){let e,n,r=hd(new Date(t[14].matchedOn))+"",i;return{c(){e=ge("div"),n=Ft("On: "),i=Ft(r),re(e,"class","m-t-xs")},m(s,o){de(s,e,o),oe(e,n),oe(e,i)},p(s,o){o[0]&16384&&r!==(r=hd(new Date(s[14].matchedOn))+"")&&ln(i,r)},d(s){s&&ce(e)}}}function $y(t){let e;function n(s,o){return s[14].matchedBy?Fy:Ny}let r=n(t),i=r(t);return{c(){i.c(),e=Dr()},m(s,o){i.m(s,o),de(s,e,o)},p(s,o){r===(r=n(s))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){s&&ce(e),i.d(s)}}}function Vy(t){let e,n,r;return n=new Tt({props:{path:Od}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon"),re(e,"title","Show matched subtitle file")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Cm(t){let e,n,r,i,s,o,a;return n=new Tt({props:{path:Wd}}),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"class","m-l-s"),re(e,"title",r=t[12]?"Export in progress":"Drop audio file"),e.disabled=i=!!t[12]},m(l,c){de(l,e,c),we(n,e,null),s=!0,o||(a=Ke(e,"click",t[87]),o=!0)},p(l,c){(!s||c[0]&4096&&r!==(r=l[12]?"Export in progress":"Drop audio file"))&&re(e,"title",r),(!s||c[0]&4096&&i!==(i=!!l[12]))&&(e.disabled=i)},i(l){s||(J(n.$$.fragment,l),s=!0)},o(l){ne(n.$$.fragment,l),s=!1},d(l){l&&ce(e),ye(n),o=!1,a()}}}function xy(t){var m,g;let e,n=(((m=t[15])==null?void 0:m.name)||"None selected")+"",r,i,s,o,a,l,c,u,f,p;o=new Tt({props:{path:t[15]?bu:wu}});let y=(t[7].lastAudio||((g=t[18])==null?void 0:g.value)||t[25])&&Cm(t);return{c(){e=ge("div"),r=Ft(n),i=me(),s=ge("button"),ve(o.$$.fragment),l=me(),y&&y.c(),c=Dr(),re(s,"title",t[28]),s.disabled=a=!!t[12]},m(w,_){de(w,e,_),oe(e,r),de(w,i,_),de(w,s,_),we(o,s,null),de(w,l,_),y&&y.m(w,_),de(w,c,_),u=!0,f||(p=Ke(s,"click",t[68]),f=!0)},p(w,_){var E,R;(!u||_[0]&32768)&&n!==(n=(((E=w[15])==null?void 0:E.name)||"None selected")+"")&&ln(r,n);const b={};_[0]&32768&&(b.path=w[15]?bu:wu),o.$set(b),(!u||_[0]&268435456)&&re(s,"title",w[28]),(!u||_[0]&4096&&a!==(a=!!w[12]))&&(s.disabled=a),w[7].lastAudio||(R=w[18])!=null&&R.value||w[25]?y?(y.p(w,_),_[0]&33816704&&J(y,1)):(y=Cm(w),y.c(),J(y,1),y.m(c.parentNode,c)):y&&(Wt(),ne(y,1,1,()=>{y=null}),jt())},i(w){u||(J(o.$$.fragment,w),J(y),u=!0)},o(w){ne(o.$$.fragment,w),ne(y),u=!1},d(w){w&&(ce(e),ce(i),ce(s),ce(l),ce(c)),ye(o),y&&y.d(w),f=!1,p()}}}function Hy(t){let e,n,r;return n=new Tt({props:{path:og}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon"),re(e,"title","Show audio file")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Mm(t){let e,n,r,i,s,o,a,l,c;return o=new Tt({props:{path:Rd}}),{c(){e=ge("span"),e.textContent="Id:",n=me(),r=ge("input"),i=me(),s=ge("button"),ve(o.$$.fragment),re(e,"class","flex items-center m-r-s"),re(r,"class","m-b-s"),Mr(r,"width","70px"),Mr(r,"height","35px"),re(s,"title","Jump to time"),re(s,"class","m-x-s"),s.disabled=t[13]},m(u,f){de(u,e,f),de(u,n,f),de(u,r,f),Ci(r,t[43]),de(u,i,f),de(u,s,f),we(o,s,null),a=!0,l||(c=[Ke(r,"input",t[102]),Ke(s,"click",t[76])],l=!0)},p(u,f){f[1]&4096&&r.value!==u[43]&&Ci(r,u[43]),(!a||f[0]&8192)&&(s.disabled=u[13])},i(u){a||(J(o.$$.fragment,u),a=!0)},o(u){ne(o.$$.fragment,u),a=!1},d(u){u&&(ce(e),ce(n),ce(r),ce(i),ce(s)),ye(o),l=!1,vn(c)}}}function Uy(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L;function $(D){t[99](D)}let P={defaultValue:0,max:t[46]};t[40]!==void 0&&(P.value=t[40]),s=new Li({props:P}),$t.push(()=>qn(s,"value",$));function I(D){t[100](D)}let H={defaultValue:0};t[41]!==void 0&&(H.value=t[41]),u=new Li({props:H}),$t.push(()=>qn(u,"value",I));function ae(D){t[101](D)}let V={defaultValue:0};t[42]!==void 0&&(V.value=t[42]),g=new Li({props:V}),$t.push(()=>qn(g,"value",ae)),E=new Tt({props:{path:Rd}});let v=t[6].size&&Mm(t);return{c(){e=ge("div"),n=ge("span"),n.textContent="Time:",r=me(),i=ge("div"),ve(s.$$.fragment),a=me(),l=ge("span"),l.textContent=":",c=me(),ve(u.$$.fragment),p=me(),y=ge("span"),y.textContent=":",m=me(),ve(g.$$.fragment),_=me(),b=ge("button"),ve(E.$$.fragment),R=me(),v&&v.c(),re(n,"class","flex items-center m-r-s"),re(i,"class","flex items-center"),re(b,"title","Jump to time"),re(b,"class","m-x-s"),b.disabled=t[13],re(e,"class","pos-nav")},m(D,F){de(D,e,F),oe(e,n),oe(e,r),oe(e,i),we(s,i,null),oe(i,a),oe(i,l),oe(i,c),we(u,i,null),oe(i,p),oe(i,y),oe(i,m),we(g,i,null),oe(e,_),oe(e,b),we(E,b,null),oe(e,R),v&&v.m(e,null),h=!0,k||(L=Ke(b,"click",t[75]),k=!0)},p(D,F){const Y={};F[1]&32768&&(Y.max=D[46]),!o&&F[1]&512&&(o=!0,Y.value=D[40],Kn(()=>o=!1)),s.$set(Y);const K={};!f&&F[1]&1024&&(f=!0,K.value=D[41],Kn(()=>f=!1)),u.$set(K);const Q={};!w&&F[1]&2048&&(w=!0,Q.value=D[42],Kn(()=>w=!1)),g.$set(Q),(!h||F[0]&8192)&&(b.disabled=D[13]),D[6].size?v?(v.p(D,F),F[0]&64&&J(v,1)):(v=Mm(D),v.c(),J(v,1),v.m(e,null)):v&&(Wt(),ne(v,1,1,()=>{v=null}),jt())},i(D){h||(J(s.$$.fragment,D),J(u.$$.fragment,D),J(g.$$.fragment,D),J(E.$$.fragment,D),J(v),h=!0)},o(D){ne(s.$$.fragment,D),ne(u.$$.fragment,D),ne(g.$$.fragment,D),ne(E.$$.fragment,D),ne(v),h=!1},d(D){D&&ce(e),ye(s),ye(u),ye(g),ye(E),v&&v.d(),k=!1,L()}}}function Wy(t){let e,n,r=eo(t[48])+"",i,s,o=eo(t[8])+"",a,l,c,u;return{c(){e=ge("div"),n=ge("button"),i=Ft(r),s=Ft(" / "),a=Ft(o),re(n,"title",l=t[13]?"Recording in progress":"Change playback position"),n.disabled=t[13],re(e,"slot","icon")},m(f,p){de(f,e,p),oe(e,n),oe(n,i),oe(n,s),oe(n,a),c||(u=Ke(n,"click",t[98]),c=!0)},p(f,p){p[1]&131072&&r!==(r=eo(f[48])+"")&&ln(i,r),p[0]&256&&o!==(o=eo(f[8])+"")&&ln(a,o),p[0]&8192&&l!==(l=f[13]?"Recording in progress":"Change playback position")&&re(n,"title",l),p[0]&8192&&(n.disabled=f[13])},d(f){f&&ce(e),c=!1,u()}}}function Rm(t){let e,n,r,i;return n=new Tt({props:{path:ug}}),n.$on("click",t[104]),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"class","m-l-s"),re(e,"title",r=t[13]?"Recording in progress":"Scroll to current playback position"),e.disabled=t[13]},m(s,o){de(s,e,o),we(n,e,null),i=!0},p(s,o){(!i||o[0]&8192&&r!==(r=s[13]?"Recording in progress":"Scroll to current playback position"))&&re(e,"title",r),(!i||o[0]&8192)&&(e.disabled=s[13])},i(s){i||(J(n.$$.fragment,s),i=!0)},o(s){ne(n.$$.fragment,s),i=!1},d(s){s&&ce(e),ye(n)}}}function Lm(t){let e,n;return e=new wb({props:{multiple:!0,allowRootFiles:!0,preferNativeFilesystem:!0,height:"100%",dragClasses:"on-drag",filePickerId:"ttu-whispersync-file",label:t[55]?"Click this zone / above icons to select subtitle/audio files":"Click this zone / above icons or drag-and-drop to select subtitle/audio files",disabled:!!t[12],fileFormats:[...t[61],...t[62]],oldHandles:[...t[7].lastSubtitle?[]:[],...t[7].lastAudio?[]:[]],oldFiles:[...t[11]?[]:[],...t[15]?[]:[]]}}),e.$on("start",t[63]),e.$on("stop",t[105]),e.$on("result",t[64]),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i[1]&16777216&&(s.label=r[55]?"Click this zone / above icons to select subtitle/audio files":"Click this zone / above icons or drag-and-drop to select subtitle/audio files"),i[0]&4096&&(s.disabled=!!r[12]),i[0]&128&&(s.oldHandles=[...r[7].lastSubtitle?[]:[],...r[7].lastAudio?[]:[]]),i[0]&34816&&(s.oldFiles=[...r[11]?[]:[],...r[15]?[]:[]]),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function Pm(t){let e,n,r,i,s,o,a,l,c,u,f;n=new _1({props:{currentProgress:t[57],rounded:!0,margin:!0}}),s=new Tt({props:{path:Ja}});let p={skipUpdates:t[1]||t[2],subtitles:t[3]};return l=new Py({props:p}),t[107](l),{c(){var y;e=ge("div"),ve(n.$$.fragment),r=me(),i=ge("button"),ve(s.$$.fragment),a=me(),ve(l.$$.fragment),re(i,"class","m-l-s"),re(i,"title","Cancel export"),i.disabled=o=(y=t[12])==null?void 0:y.signal.aborted,re(e,"class","flex match-btns m-b-s"),ht(e,"invisible",!t[12])},m(y,m){de(y,e,m),we(n,e,null),oe(e,r),oe(e,i),we(s,i,null),de(y,a,m),we(l,y,m),c=!0,u||(f=Ke(i,"click",t[106]),u=!0)},p(y,m){var _;const g={};m[1]&67108864&&(g.currentProgress=y[57]),n.$set(g),(!c||m[0]&4096&&o!==(o=(_=y[12])==null?void 0:_.signal.aborted))&&(i.disabled=o),(!c||m[0]&4096)&&ht(e,"invisible",!y[12]);const w={};m[0]&6&&(w.skipUpdates=y[1]||y[2]),m[0]&8&&(w.subtitles=y[3]),l.$set(w)},i(y){c||(J(n.$$.fragment,y),J(s.$$.fragment,y),J(l.$$.fragment,y),c=!0)},o(y){ne(n.$$.fragment,y),ne(s.$$.fragment,y),ne(l.$$.fragment,y),c=!1},d(y){y&&(ce(e),ce(a)),ye(n),ye(s),t[107](null),ye(l,y),u=!1,f()}}}function Im(t){let e,n,r={imageLoaded:t[44]};return e=new dy({props:r}),t[108](e),e.$on("loadstart",t[77]),e.$on("loaded",t[109]),e.$on("error",t[110]),{c(){ve(e.$$.fragment)},m(i,s){we(e,i,s),n=!0},p(i,s){const o={};s[1]&8192&&(o.imageLoaded=i[44]),e.$set(o)},i(i){n||(J(e.$$.fragment,i),n=!0)},o(i){ne(e.$$.fragment,i),n=!1},d(i){t[108](null),ye(e,i)}}}function jy(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,tt,ke,Pe,Xe,qe,it,Je,U,T,d,A,N,j,ee,te,se,be,he,Ce,Re,Fe,nt,pt,je,ft,Oe,$e,at,Ge,mt,Qe,vt,Lt,lt,Et,dt,Gt,Qt;function Kt(Ye,ct){return Ye[53]?By:Iy}let zt=Kt(t),nn=zt(t);l=new Tt({props:{path:yg}}),f=new Tt({props:{path:tl}});let Ln={placement:"bottom",$$slots:{icon:[Dy],default:[Oy]},$$scope:{ctx:t}};g=new pi({props:Ln}),t[86](g),_=new pi({props:{placement:"bottom",$$slots:{icon:[Vy],default:[$y]},$$scope:{ctx:t}}}),R=new Tt({props:{path:dg}});let On={placement:"bottom",$$slots:{icon:[Hy],default:[xy]},$$scope:{ctx:t}};L=new pi({props:On}),t[88](L),I=new Tt({props:{path:Zo}}),F=new Tt({props:{path:cg}}),W=new Tt({props:{path:Zc}}),M=new Tt({props:{path:qo}}),z=new Tt({props:{path:t[1]?af:lf}}),Ae=new Tt({props:{path:t[2]?tf:ef}}),Le=new Tt({props:{path:Jc}}),x=new Tt({props:{path:Qc}}),Pe=new Tt({props:{path:t[16]?Bd:Id}}),it=new Tt({props:{path:Qa}}),d=new Tt({props:{path:el}}),j=new Rn({props:{title:t[54],action:Be.OPEN_LAST_EXPORTED_CARD,subtitle:mn(0),path:nl,buttonClasses:""}}),se=new Tt({props:{path:tl}}),Ce=new Tt({props:{path:tl}}),nt=new Tt({props:{path:tl}});let xn={placement:"bottom",$$slots:{icon:[Wy],default:[Uy]},$$scope:{ctx:t}};ft=new pi({props:xn}),t[103](ft);let Ut=t[6].size&&Rm(t),Nt=!t[6].size&&Lm(t),en=t[0]&&t[56]===pn.AUDIOBOOK&&t[6].size&&Pm(t),on=t[10]&&Im(t);return{c(){e=ge("div"),n=ge("button"),nn.c(),i=me(),s=ge("div"),o=ge("div"),a=ge("button"),ve(l.$$.fragment),c=me(),u=ge("button"),ve(f.$$.fragment),m=me(),ve(g.$$.fragment),w=me(),ve(_.$$.fragment),b=me(),E=ge("button"),ve(R.$$.fragment),k=me(),ve(L.$$.fragment),$=me(),P=ge("button"),ve(I.$$.fragment),V=me(),v=ge("div"),D=ge("button"),ve(F.$$.fragment),K=me(),Q=ge("button"),ve(W.$$.fragment),C=me(),S=ge("button"),ve(M.$$.fragment),ie=me(),G=ge("button"),ve(z.$$.fragment),Me=me(),_e=ge("button"),ve(Ae.$$.fragment),Ve=me(),Te=ge("button"),ve(Le.$$.fragment),et=me(),B=ge("button"),ve(x.$$.fragment),We=me(),tt=ge("div"),ke=ge("button"),ve(Pe.$$.fragment),Xe=me(),qe=ge("button"),ve(it.$$.fragment),U=me(),T=ge("button"),ve(d.$$.fragment),N=me(),ve(j.$$.fragment),ee=me(),te=ge("button"),ve(se.$$.fragment),be=me(),he=ge("button"),ve(Ce.$$.fragment),Re=me(),Fe=ge("button"),ve(nt.$$.fragment),pt=me(),je=ge("div"),ve(ft.$$.fragment),Oe=me(),Ut&&Ut.c(),$e=me(),at=ge("div"),Ge=ge("div"),Nt&&Nt.c(),mt=me(),en&&en.c(),Qe=me(),on&&on.c(),vt=me(),Lt=ge("input"),lt=me(),Et=ge("input"),re(n,"title",t[28]),n.disabled=r=!!t[12],re(a,"title","Export book to text file"),re(u,"title",p=t[6].size?"Save subtitles to file":"Subtitle file required"),u.disabled=y=!t[6].size,re(E,"title",t[27]),E.disabled=h=!!t[12]||!t[9].htmlBackup,re(P,"title",H=t[12]?"Export in progress":"Reset all & reload page"),P.disabled=ae=!!t[12],re(o,"class","flex justify-between w-full header-icons"),re(D,"title",t[29]),D.disabled=Y=t[29]!=="Reset playback position",re(Q,"title",t[30]),Q.disabled=O=t[13]||!t[4]||!t[14].matchedBy,re(S,"title",t[31]),S.disabled=X=t[13]||!t[4],re(G,"title",t[32]),G.disabled=le=!t[6].size,re(_e,"title",t[33]),_e.disabled=Ee=!t[6].size,re(Te,"title",t[34]),Te.disabled=Ie=!t[47]||!t[1]&&!t[2],re(B,"title",t[35]),B.disabled=Ne=!t[47]||!t[1]&&!t[2],re(v,"class","flex justify-between w-full m-t-s header-icons"),re(ke,"title",t[45]),re(qe,"title",t[36]),qe.disabled=Je=!t[38],re(T,"title",t[37]),T.disabled=A=!t[39],re(te,"class","invisible"),re(he,"class","invisible"),re(Fe,"class","invisible"),re(tt,"class","flex justify-between w-full m-t-s header-icons"),re(je,"class","flex flex-1"),Mr(je,"align-items","flex-end"),ht(je,"hidden",!t[5]&&!t[6].size),re(s,"class","flex flex-1 flex-col"),re(e,"class","flex m-y-s"),re(Ge,"class","flex flex-col flex-1"),re(at,"class","flex flex-col flex-1"),re(Lt,"type","file"),re(Lt,"class","hidden"),re(Lt,"accept",`application/x-subrip,text/vtt,text/plain,${t[61].join(",")}`),re(Et,"type","file"),re(Et,"class","hidden"),re(Et,"accept",`audio/mp4,audio/mpeg,${t[62].join(",")}`)},m(Ye,ct){de(Ye,e,ct),oe(e,n),nn.m(n,null),oe(e,i),oe(e,s),oe(s,o),oe(o,a),we(l,a,null),oe(o,c),oe(o,u),we(f,u,null),oe(o,m),we(g,o,null),oe(o,w),we(_,o,null),oe(o,b),oe(o,E),we(R,E,null),oe(o,k),we(L,o,null),oe(o,$),oe(o,P),we(I,P,null),oe(s,V),oe(s,v),oe(v,D),we(F,D,null),oe(v,K),oe(v,Q),we(W,Q,null),oe(v,C),oe(v,S),we(M,S,null),oe(v,ie),oe(v,G),we(z,G,null),oe(v,Me),oe(v,_e),we(Ae,_e,null),oe(v,Ve),oe(v,Te),we(Le,Te,null),oe(v,et),oe(v,B),we(x,B,null),oe(s,We),oe(s,tt),oe(tt,ke),we(Pe,ke,null),oe(tt,Xe),oe(tt,qe),we(it,qe,null),oe(tt,U),oe(tt,T),we(d,T,null),oe(tt,N),we(j,tt,null),oe(tt,ee),oe(tt,te),we(se,te,null),oe(tt,be),oe(tt,he),we(Ce,he,null),oe(tt,Re),oe(tt,Fe),we(nt,Fe,null),oe(s,pt),oe(s,je),we(ft,je,null),oe(je,Oe),Ut&&Ut.m(je,null),de(Ye,$e,ct),de(Ye,at,ct),oe(at,Ge),Nt&&Nt.m(Ge,null),oe(Ge,mt),en&&en.m(Ge,null),oe(at,Qe),on&&on.m(at,null),de(Ye,vt,ct),de(Ye,Lt,ct),t[111](Lt),de(Ye,lt,ct),de(Ye,Et,ct),t[112](Et),dt=!0,Gt||(Qt=[Ke(n,"click",t[68]),Ke(a,"click",t[65]),Ke(u,"click",t[66]),Ke(E,"click",t[72]),Ke(P,"click",t[74]),Ke(D,"click",t[73]),Ke(Q,"click",t[89]),Ke(S,"click",t[90]),Ke(G,"click",t[91]),Ke(_e,"click",t[92]),Ke(Te,"click",t[93]),Ke(B,"click",t[94]),Ke(ke,"click",t[95]),Ke(qe,"click",t[96]),Ke(T,"click",t[97]),Ke(Lt,"change",t[69]),Ke(Et,"change",t[69])],Gt=!0)},p(Ye,ct){zt===(zt=Kt(Ye))&&nn?nn.p(Ye,ct):(nn.d(1),nn=zt(Ye),nn&&(nn.c(),nn.m(n,null))),(!dt||ct[0]&268435456)&&re(n,"title",Ye[28]),(!dt||ct[0]&4096&&r!==(r=!!Ye[12]))&&(n.disabled=r),(!dt||ct[0]&64&&p!==(p=Ye[6].size?"Save subtitles to file":"Subtitle file required"))&&re(u,"title",p),(!dt||ct[0]&64&&y!==(y=!Ye[6].size))&&(u.disabled=y);const br={};ct[0]&84023424|ct[3]&536870912&&(br.$$scope={dirty:ct,ctx:Ye}),g.$set(br);const Un={};ct[0]&16384|ct[3]&536870912&&(Un.$$scope={dirty:ct,ctx:Ye}),_.$set(Un),(!dt||ct[0]&134217728)&&re(E,"title",Ye[27]),(!dt||ct[0]&4608&&h!==(h=!!Ye[12]||!Ye[9].htmlBackup))&&(E.disabled=h);const tn={};ct[0]&302289024|ct[3]&536870912&&(tn.$$scope={dirty:ct,ctx:Ye}),L.$set(tn),(!dt||ct[0]&4096&&H!==(H=Ye[12]?"Export in progress":"Reset all & reload page"))&&re(P,"title",H),(!dt||ct[0]&4096&&ae!==(ae=!!Ye[12]))&&(P.disabled=ae),(!dt||ct[0]&536870912)&&re(D,"title",Ye[29]),(!dt||ct[0]&536870912&&Y!==(Y=Ye[29]!=="Reset playback position"))&&(D.disabled=Y),(!dt||ct[0]&1073741824)&&re(Q,"title",Ye[30]),(!dt||ct[0]&24592&&O!==(O=Ye[13]||!Ye[4]||!Ye[14].matchedBy))&&(Q.disabled=O),(!dt||ct[1]&1)&&re(S,"title",Ye[31]),(!dt||ct[0]&8208&&X!==(X=Ye[13]||!Ye[4]))&&(S.disabled=X);const Yn={};ct[0]&2&&(Yn.path=Ye[1]?af:lf),z.$set(Yn),(!dt||ct[1]&2)&&re(G,"title",Ye[32]),(!dt||ct[0]&64&&le!==(le=!Ye[6].size))&&(G.disabled=le);const wr={};ct[0]&4&&(wr.path=Ye[2]?tf:ef),Ae.$set(wr),(!dt||ct[1]&4)&&re(_e,"title",Ye[33]),(!dt||ct[0]&64&&Ee!==(Ee=!Ye[6].size))&&(_e.disabled=Ee),(!dt||ct[1]&8)&&re(Te,"title",Ye[34]),(!dt||ct[0]&6|ct[1]&65536&&Ie!==(Ie=!Ye[47]||!Ye[1]&&!Ye[2]))&&(Te.disabled=Ie),(!dt||ct[1]&16)&&re(B,"title",Ye[35]),(!dt||ct[0]&6|ct[1]&65536&&Ne!==(Ne=!Ye[47]||!Ye[1]&&!Ye[2]))&&(B.disabled=Ne);const Wn={};ct[0]&65536&&(Wn.path=Ye[16]?Bd:Id),Pe.$set(Wn),(!dt||ct[1]&16384)&&re(ke,"title",Ye[45]),(!dt||ct[1]&32)&&re(qe,"title",Ye[36]),(!dt||ct[1]&128&&Je!==(Je=!Ye[38]))&&(qe.disabled=Je),(!dt||ct[1]&64)&&re(T,"title",Ye[37]),(!dt||ct[1]&256&&A!==(A=!Ye[39]))&&(T.disabled=A);const Jn={};ct[1]&8388608&&(Jn.title=Ye[54]),j.$set(Jn);const fn={};ct[0]&8512|ct[1]&2268672|ct[3]&536870912&&(fn.$$scope={dirty:ct,ctx:Ye}),ft.$set(fn),Ye[6].size?Ut?(Ut.p(Ye,ct),ct[0]&64&&J(Ut,1)):(Ut=Rm(Ye),Ut.c(),J(Ut,1),Ut.m(je,null)):Ut&&(Wt(),ne(Ut,1,1,()=>{Ut=null}),jt()),(!dt||ct[0]&96)&&ht(je,"hidden",!Ye[5]&&!Ye[6].size),Ye[6].size?Nt&&(Wt(),ne(Nt,1,1,()=>{Nt=null}),jt()):Nt?(Nt.p(Ye,ct),ct[0]&64&&J(Nt,1)):(Nt=Lm(Ye),Nt.c(),J(Nt,1),Nt.m(Ge,mt)),Ye[0]&&Ye[56]===pn.AUDIOBOOK&&Ye[6].size?en?(en.p(Ye,ct),ct[0]&65|ct[1]&33554432&&J(en,1)):(en=Pm(Ye),en.c(),J(en,1),en.m(Ge,null)):en&&(Wt(),ne(en,1,1,()=>{en=null}),jt()),Ye[10]?on?(on.p(Ye,ct),ct[0]&1024&&J(on,1)):(on=Im(Ye),on.c(),J(on,1),on.m(at,null)):on&&(Wt(),ne(on,1,1,()=>{on=null}),jt())},i(Ye){dt||(J(l.$$.fragment,Ye),J(f.$$.fragment,Ye),J(g.$$.fragment,Ye),J(_.$$.fragment,Ye),J(R.$$.fragment,Ye),J(L.$$.fragment,Ye),J(I.$$.fragment,Ye),J(F.$$.fragment,Ye),J(W.$$.fragment,Ye),J(M.$$.fragment,Ye),J(z.$$.fragment,Ye),J(Ae.$$.fragment,Ye),J(Le.$$.fragment,Ye),J(x.$$.fragment,Ye),J(Pe.$$.fragment,Ye),J(it.$$.fragment,Ye),J(d.$$.fragment,Ye),J(j.$$.fragment,Ye),J(se.$$.fragment,Ye),J(Ce.$$.fragment,Ye),J(nt.$$.fragment,Ye),J(ft.$$.fragment,Ye),J(Ut),J(Nt),J(en),J(on),dt=!0)},o(Ye){ne(l.$$.fragment,Ye),ne(f.$$.fragment,Ye),ne(g.$$.fragment,Ye),ne(_.$$.fragment,Ye),ne(R.$$.fragment,Ye),ne(L.$$.fragment,Ye),ne(I.$$.fragment,Ye),ne(F.$$.fragment,Ye),ne(W.$$.fragment,Ye),ne(M.$$.fragment,Ye),ne(z.$$.fragment,Ye),ne(Ae.$$.fragment,Ye),ne(Le.$$.fragment,Ye),ne(x.$$.fragment,Ye),ne(Pe.$$.fragment,Ye),ne(it.$$.fragment,Ye),ne(d.$$.fragment,Ye),ne(j.$$.fragment,Ye),ne(se.$$.fragment,Ye),ne(Ce.$$.fragment,Ye),ne(nt.$$.fragment,Ye),ne(ft.$$.fragment,Ye),ne(Ut),ne(Nt),ne(en),ne(on),dt=!1},d(Ye){Ye&&(ce(e),ce($e),ce(at),ce(vt),ce(Lt),ce(lt),ce(Et)),nn.d(),ye(l),ye(f),t[86](null),ye(g),ye(_),ye(R),t[88](null),ye(L),ye(I),ye(F),ye(W),ye(M),ye(z),ye(Ae),ye(Le),ye(x),ye(Pe),ye(it),ye(d),ye(j),ye(se),ye(Ce),ye(nt),t[103](null),ye(ft),Ut&&Ut.d(),Nt&&Nt.d(),en&&en.d(),on&&on.d(),t[111](null),t[112](null),Gt=!1,vn(Qt)}}}function Gy(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O;fe(t,Hi,He=>n(48,a=He)),fe(t,Ls,He=>n(5,l=He)),fe(t,ou,He=>n(80,c=He)),fe(t,su,He=>n(81,u=He)),fe(t,Pr,He=>n(6,f=He)),fe(t,Lr,He=>n(7,p=He)),fe(t,Ho,He=>n(113,y=He)),fe(t,as,He=>n(8,m=He)),fe(t,En,He=>n(49,g=He)),fe(t,kt,He=>n(50,w=He)),fe(t,Ri,He=>n(9,_=He)),fe(t,Ct,He=>n(51,b=He)),fe(t,kn,He=>n(114,E=He)),fe(t,os,He=>n(52,R=He)),fe(t,Da,He=>n(10,h=He)),fe(t,qs,He=>n(53,k=He)),fe(t,Ql,He=>n(115,L=He)),fe(t,ns,He=>n(11,P=He)),fe(t,yi,He=>n(12,ae=He)),fe(t,eu,He=>n(84,V=He)),fe(t,xi,He=>n(13,v=He)),fe(t,Uo,He=>n(14,D=He)),fe(t,Oa,He=>n(15,F=He)),fe(t,iu,He=>n(16,Y=He)),fe(t,ss,He=>n(54,K=He)),fe(t,Ba,He=>n(55,Q=He)),fe(t,Js,He=>n(56,W=He)),fe(t,tu,He=>n(57,O=He));let{showMenu:C}=e;function S(){Ie==null||Ie.onResetList()}function M(){et==null||et.onScrollToSubtitle()}const{subtitlesEnablePersist$:X,ankiSentenceField$:ie,ankiSoundField$:G}=_t;fe(t,X,He=>n(116,$=He)),fe(t,ie,He=>n(82,I=He)),fe(t,G,He=>n(83,H=He));const{sandboxElement:z,isIOS:le}=Bo("context"),Me=[".srt",".vtt",".txt"],_e=[".m4a",".m4b",".mp3"];let Ae,Ee,Ve,Te,Le,Ie,et,B=!1,x=!1,Ne="",We="",tt="",ke="",Pe="",Xe="",qe="",it="",Je="",U="",T="",d="",A=!1,N=!1,j=!1,ee=!1,te=0,se=0,be=0,he="",Ce,Re=[];function Fe(){pe(kn,E=!0,E),pe(kt,w=!0,w),pe(En,g=!0,g),pe(Ct,b="",b),Ve.hide(),Te.hide()}async function nt({detail:{files:He,errors:Bt}}){const Pt=[],xt=[];let rn,xe;Fe();for(let At=0,{length:sn}=He;At<sn;At+=1){const Dn=He[At];Dn.extension===".srt"||Dn.extension===".vtt"||Dn.extension===".txt"?Pt.push(Dn):xt.push(Dn)}let Rt=Pt.length>1||xt.length>1;Pt.length>1&&Bt.push("Only 1 subtitle file is allowed"),xt.length>1&&Bt.push("Only 1 audio file is allowed");try{if(Rt||!Pt.length&&!xt.length)throw new Error("Stop process");if([rn]=Pt,[xe]=xt,!await yh([rn==null?void 0:rn.handle,xe==null?void 0:xe.handle]).catch(({message:sn})=>(Bt.push(`Access check failed: ${sn}`),!1)))throw new Error("Stop process")}catch{pe(Ct,b=Bt.join("; "),b),pe(kt,w=!1,w),pe(En,g=!1,g);return}if(rn){try{const At=await ku(rn.file,document);rn.handle&&await Et(rn.handle,"lastSubtitle"),$&&await Ps({name:rn.file.name,subtitles:[...At.values()]}).catch(({message:sn})=>Bt.push(sn)),us(rn.file,At),n(24,B=!0)}catch({message:At}){Bt.push(`Failed to process subtitle: ${At}`)}xe||pe(kt,w=!1,w)}if(xe)try{const At=await Jo(xe.file,z);xe.handle&&await Et(xe.handle,"lastAudio"),await Is(k,h,xe.file,At),n(25,x=!0)}catch({message:At}){Bt.push(`Failed to process audio: ${At}`),pe(kt,w=!1,w)}pe(Ct,b=Bt.join("; "),b),pe(En,g=!1,g)}async function pt(){pe(kt,w=!0,w),pe(Ct,b="",b);try{await new Promise(xt=>setTimeout(xt,100));const He=uu(new DOMParser,_.htmlBackup||_.elementHtml);let Bt="";const Pt=document.createTreeWalker(He,NodeFilter.SHOW_TEXT,{acceptNode(xt){var Rt;const rn=(((Rt=xt.parentElement)==null?void 0:Rt.tagName)||"").toLowerCase(),xe=(xt.textContent||"").replace(/\s/g,"").trim();return!lu.has(rn)&&xe&&(Bt+=`${xt.textContent}
`),NodeFilter.FILTER_ACCEPT}});for(;Pt.nextNode(););Bt&&du(document,new Blob([Bt],{type:"text/plain;charset=utf-8"}),`${_.title}.txt`,le)}catch({message:He}){pe(Ct,b=`Failed to export text: ${He}`,b)}pe(kt,w=!1,w)}async function je(){pe(kt,w=!0,w),await new Promise(Pt=>setTimeout(Pt,100));const He=[...f.values()];let Bt="";for(let Pt=0,{length:xt}=He;Pt<xt;Pt+=1){const rn=He[Pt];Bt+=`${rn.id}
${rn.startTime} --> ${rn.endTime}
${rn.text}

`}Bt&&du(document,new Blob([Bt],{type:`${le?"text/plain":"application/x-subrip"};charset=utf-8`}),`${P.name.split(/\.(?=[^\.]+$)/)[0]}.srt`,le),pe(kt,w=!1,w)}async function ft(){if(Ve.hide(),L){pe(En,g=!0,g),pe(kt,w=!0,w),pe(Ct,b="",b);try{const{handle:He,file:Bt}=await vh(window,"Subtitle",Me,p.lastSubtitle);if(Bt){const Pt=await ku(Bt,document);await Et(He,"lastSubtitle"),$&&await Ps({name:He.name,subtitles:[...Pt.values()]}),us(Bt,Pt),n(24,B=!1)}}catch(He){He.name!=="AbortError"&&pe(Ct,b=`Failed to process subtitle: ${He.message}`,b)}pe(kt,w=!1,w),pe(En,g=!1,g)}else Ae.click()}async function Oe(){if(Te.hide(),L){pe(En,g=!0,g),pe(kt,w=!0,w),pe(Ct,b="",b);try{const{handle:He,file:Bt}=await vh(window,"Audio",_e,p.lastAudio);if(Bt){const Pt=await Jo(Bt,z);await Et(He,"lastAudio"),await Is(k,h,Bt,Pt),n(25,x=!1)}else pe(kt,w=!1,w)}catch(He){He.name!=="AbortError"&&pe(Ct,b=`Failed to process audio: ${He.message}`,b),pe(kt,w=!1,w)}pe(En,g=!1,g)}else Ee.click()}async function $e(He){const Bt=He.target,Pt=Bt.accept.includes(".srt"),[xt]=Bt.files||[];if(xt){pe(En,g=!0,g),pe(kt,w=!0,w),pe(Ct,b="",b);try{if(Pt){const rn=await ku(xt,document,!0);$&&await Ps({name:xt.name,subtitles:[...rn.values()]}),pe(kt,w=!1,w),n(24,B=!1)}else await Jo(xt,z,!0,!1,k,h),n(25,x=!1)}catch({message:rn}){pe(Ct,b=`Failed to process ${Pt?"subtitle":"audio"}: ${rn}`,b),pe(kt,w=!1,w)}pe(En,g=!1,g)}}async function at(He){if(He==="lastSubtitle"?Ve.hide():Te.hide(),pe(En,g=!0,g),pe(kt,w=!0,w),pe(Ct,b="",b),pe(kn,E=!0,E),L)try{He==="lastSubtitle"?(await y.delete("handle",[p.title,"subtitle"]),(!p.subtitleData||!p.subtitleData.subtitles.length)&&us(),n(24,B=!1)):He==="lastAudio"&&(await y.delete("handle",[p.title,"audioBook"]),await Is(k,h),n(25,x=!1)),delete p[He]}catch({message:Bt}){pe(Ct,b=`Failed to drop file: ${Bt}`,b)}else He==="lastSubtitle"?((!p.subtitleData||!p.subtitleData.subtitles.length)&&us(),n(17,Ae.value="",Ae),n(24,B=!1)):He==="lastAudio"&&(await Is(k,h),n(18,Ee.value="",Ee),n(25,x=!1));pe(kt,w=!1,w),pe(En,g=!1,g),Lr.set(p)}async function Ge(){Ve.hide(),pe(kt,w=!0,w),pe(En,g=!0,g),pe(Ct,b="",b);try{const He={name:p.subtitleData.name,subtitles:[]};await y.put("subtitle",{subtitleData:He,title:p.title,lastSubtitleDataModified:Date.now()}),!p.lastSubtitle&&!Ae.value&&!B&&(pe(kn,E=!0,E),us()),pe(Lr,p.subtitleData=He,p),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"sync",syncType:"subtitle"}}))}catch({message:He}){pe(Ct,b=`Failed to drop persisted subtitles: ${He}`,b)}pe(kt,w=!1,w),pe(En,g=!1,g),Lr.set(p)}async function mt(){pe(En,g=!0,g),pe(kt,w=!0,w),pe(kn,E=!0,E);const{elementHtml:He,htmlBackup:Bt,lastBookModified:Pt}=_;try{pe(Ri,_.elementHtml=Bt,_),pe(Ri,_.lastBookModified=Date.now(),_),delete _.htmlBackup,await y.put("data",_),window.location.reload()}catch({message:xt}){pe(Ct,b=`Failed to reset book: ${xt}`,b),pe(Ri,_={..._,elementHtml:He,htmlBackup:Bt,lastBookModified:Pt},_)}pe(kt,w=!1,w),pe(En,g=!1,g)}async function Qe(){pe(En,g=!0,g),pe(kt,w=!0,w),pe(kn,E=!0,E);try{await y.put("audioBook",{title:p.title,playbackPosition:0,lastAudioBookModified:Date.now()}),pe(Hi,a=0,a),pe(Lr,p.playbackPosition=0,p),pe(os,R={previous:"",current:"",useTimeFallback:!0},R)}catch({message:He}){pe(Ct,b=`Failed to reset playback position: ${He}`,b)}pe(kt,w=!1,w),pe(En,g=!1,g),Lr.set(p)}async function vt(){pe(En,g=!0,g),pe(kt,w=!0,w),pe(kn,E=!0,E);const He=y.transaction(["data","audioBook","subtitle","handle"],"readwrite"),{elementHtml:Bt,htmlBackup:Pt,lastBookModified:xt}=_,rn=Date.now(),xe=p.subtitleData,Rt=p.playbackPosition;try{if(Pt&&(pe(Ri,_.elementHtml=Pt,_),pe(Ri,_.lastBookModified=rn,_),delete _.htmlBackup,await He.objectStore("data").put(_)),xe){const At={name:xe.name,subtitles:[]};await He.objectStore("subtitle").put({subtitleData:At,title:_.title,lastSubtitleDataModified:rn}),pe(Lr,p.subtitleData=At,p)}await He.objectStore("audioBook").put({title:_.title,playbackPosition:0,lastAudioBookModified:rn}),await He.objectStore("handle").delete(IDBKeyRange.bound([_.title],[_.title,[]])),await He.done,pe(Lr,p.playbackPosition=0,p),window.location.reload()}catch({message:At}){try{He.abort(),await He.done}catch{}pe(Ct,b=`Failed to reset Data: ${At}`,b),pe(Ri,_={..._,elementHtml:Bt,htmlBackup:Pt,lastBookModified:xt},_),pe(Lr,p={...p,playbackPosition:Rt,subtitleData:xe},p)}pe(kt,w=!1,w),pe(En,g=!1,g)}async function Lt(){Le.hide();const He=(te||0)*3600+(se||0)*60+(be||0);await Bn(Be.RESTART_PLAYBACK,mn(l?Ui(0,m,He):Math.max(0,He)),{keepPauseState:!0}),Qt(He)}async function lt(){Le.hide();const He=f.get(he);He&&(await Bn(Be.RESTART_PLAYBACK,mn(He.startSeconds),{keepPauseState:!0}),Qt(He.startSeconds))}async function Et(He,Bt){try{await y.put("handle",{handle:He,title:p.title,lastHandleModified:Date.now(),dataType:Bt==="lastSubtitle"?"subtitle":"audioBook"}),pe(Lr,p[Bt]=He,p)}catch({message:Pt}){throw new Error(`Failed to update extension data - ${Pt}`)}finally{Lr.set(p)}}async function dt(...He){n(3,Re=[...f.values()].filter(Bt=>(!j||u.has(Bt.id))&&(!ee||c.has(Bt.id)))),await Rr(),n(4,r=Re.length>0)}function Gt(...He){pe(Ls,l=!1,l),new Promise(Pt=>n(44,Ce=Pt));const Bt=document.querySelectorAll(`${cu()}.active`);for(let Pt=0,{length:xt}=Bt;Pt<xt;Pt+=1)Bt[Pt].classList.remove("active")}function Qt(He){l||(pe(Hi,a=He,a),Ie==null||Ie.scrollToSubtitle(!0))}const Kt=()=>at("lastSubtitle");function zt(He){$t[He?"unshift":"push"](()=>{Ve=He,n(19,Ve)})}const nn=()=>at("lastAudio");function Ln(He){$t[He?"unshift":"push"](()=>{Te=He,n(20,Te)})}const On=async()=>{pe(kt,w=!0,w),await Bn(Be.ALIGN_SUBTITLE,Re),pe(kt,w=!1,w)},xn=async()=>{pe(kt,w=!0,w),await Bn(Be.RESTORE_SUBTITLE,Re),pe(kt,w=!1,w)},Ut=()=>n(1,j=!j),Nt=()=>n(2,ee=!ee),en=()=>Bn(Be.TOGGLE_PLAY_PAUSE,Re,{skipUpdates:!0}),on=()=>Bn(Be.TOGGLE_PLAYBACK_LOOP,Re,{skipUpdates:!0}),Ye=()=>pe(iu,Y=!Y,Y),ct=()=>Bn(Be.EXPORT_NEW,Re,{mergeSubtitles:ee}),br=()=>Bn(Be.EXPORT_UPDATE,Re,{mergeSubtitles:!0}),Un=()=>{n(40,[te,se,be]=ls(a),te,n(41,se),n(42,be)),n(43,he=R.current||R.previous)};function tn(He){te=He,n(40,te)}function Yn(He){se=He,n(41,se)}function wr(He){be=He,n(42,be)}function Wn(){he=this.value,n(43,he)}function Jn(He){$t[He?"unshift":"push"](()=>{Le=He,n(21,Le)})}const fn=()=>Ie==null?void 0:Ie.scrollToSubtitle(!0),Ar=()=>{pe(kt,w=!1,w),pe(En,g=!1,g)},yr=()=>Bn(Be.CANCEL_EXPORT,Re);function dn(He){$t[He?"unshift":"push"](()=>{Ie=He,n(22,Ie)})}function fr(He){$t[He?"unshift":"push"](()=>{et=He,n(23,et)})}const ri=()=>Ie==null?void 0:Ie.onResetList(),bi=()=>{Is(k,k).finally(()=>{pe(Ct,b="Unable to play audio - try a different codec/format",b),pe(kt,w=!1,w)})};function jn(He){$t[He?"unshift":"push"](()=>{Ae=He,n(17,Ae)})}function Wr(He){$t[He?"unshift":"push"](()=>{Ee=He,n(18,Ee)})}return t.$$set=He=>{"showMenu"in He&&n(0,C=He.showMenu)},t.$$.update=()=>{t.$$.dirty[0]&2048&&P&&(n(1,j=!1),n(2,ee=!1)),t.$$.dirty[0]&70&&dt(f,j,ee),t.$$.dirty[0]&8&&n(4,r=Re.length>0),t.$$.dirty[0]&8240&&n(47,i=l&&r&&!v),t.$$.dirty[0]&256&&n(46,s=m?Math.floor(m/3600):999),t.$$.dirty[0]&65536&&n(45,o=Y?"Show footer actions":"Hide footer actions"),t.$$.dirty[0]&39424&&(ae?(n(26,Ne="Export in progress"),n(27,We="Export in progress"),n(28,tt="Export in progress")):(n(26,Ne=`${P?"Change":"Set"} subtitle file`),n(27,We=_.htmlBackup?"Reset book & reload page":"No data to reset"),n(28,tt=`${F?"Change":"Set"} audio file`))),t.$$.dirty[0]&4224&&(!Number.isFinite(p.playbackPosition)||p.playbackPosition===0?n(29,ke="No data to reset"):ae?n(29,ke="Export in progress"):n(29,ke="Reset playback position")),t.$$.dirty[0]&24662&&(f.size?v?n(30,Pe="Recording in progress"):r?D.matchedBy?n(30,Pe=`Align${j||ee?" selected":" all"} subtitles with book text`):n(30,Pe="Matched book required"):n(30,Pe="No subtitle matches current filter"):n(30,Pe="Subtitle file required")),t.$$.dirty[0]&8278&&(f.size?v?n(31,Xe="Recording in progress"):r?n(31,Xe=`Restore original time and text for${j||ee?" selected":" all"} subtitles`):n(31,Xe="No subtitle matches current filter"):n(31,Xe="Subtitle file required")),t.$$.dirty[0]&70&&(f.size?(n(32,qe=j?"Show all subtitles":"Show only bookmarked subtitles"),n(33,it=ee?"Show all subtitles":"Show only subtitles for merge")):(n(32,qe="Subtitle file required"),n(33,it="Subtitle file required"))),t.$$.dirty[0]&8310&&(f.size?l?v?(n(34,Je="Recording in progress"),n(35,U="Recording in progress")):r?!j&&!ee?(n(34,Je="Bookmark or merge filter required"),n(35,U="Bookmark or merge filter required")):(n(34,Je="Toggle play and pause for selected subtitles"),n(35,U="Toggle playback loop for selected subtitles")):(n(34,Je="No subtitle matches current filter"),n(35,U="No subtitle matches current filter")):(n(34,Je="Audio file required"),n(35,U="Audio file required")):(n(34,Je="Subtitle file required"),n(35,U="Subtitle file required"))),t.$$.dirty[0]&4214|t.$$.dirty[2]&7340032&&(V?ae?(n(36,T="Export in progress"),n(37,d="Export in progress"),n(38,A=!1),n(39,N=!1)):f.size?H&&!l&&!I?(n(36,T="Audio file required"),n(37,d="Audio file required"),n(38,A=!1),n(39,N=!1)):r?(ee?(n(36,T="Merge selected subtitles and create new Card for selected subtitles"),n(38,A=!0)):j?(n(36,T="Create new cards for selected subtitles"),n(38,A=!0)):(n(36,T="Bookmark or merge filter required"),n(38,A=!1)),ee?(n(37,d="Merge selected subtitles and update last card"),n(39,N=!0)):(n(37,d="Merge filter required"),n(39,N=!1))):(n(36,T="No subtitle matches current filter"),n(37,d="No subtitle matches current filter"),n(38,A=!1),n(39,N=!1)):(n(36,T="Subtitle file required"),n(37,d="Subtitle file required"),n(38,A=!1),n(39,N=!1)):(n(36,T="Anki configuration required"),n(37,d="Anki configuration required"),n(38,A=!1),n(39,N=!1))),t.$$.dirty[0]&2|t.$$.dirty[2]&524288&&j&&dt(u),t.$$.dirty[0]&4|t.$$.dirty[2]&262144&&ee&&dt(c),t.$$.dirty[0]&1024&&(h||Gt())},[C,j,ee,Re,r,l,f,p,m,_,h,P,ae,v,D,F,Y,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,tt,ke,Pe,Xe,qe,it,Je,U,T,d,A,N,te,se,be,he,Ce,o,s,i,a,g,w,b,R,k,K,Q,W,O,X,ie,G,Me,_e,Fe,nt,pt,je,ft,Oe,$e,at,Ge,mt,Qe,vt,Lt,lt,Gt,S,M,c,u,I,H,V,Kt,zt,nn,Ln,On,xn,Ut,Nt,en,on,Ye,ct,br,Un,tn,Yn,wr,Wn,Jn,fn,Ar,yr,dn,fr,ri,bi,jn,Wr]}class zy extends In{constructor(e){super(),Pn(this,e,Gy,jy,Tn,{showMenu:0,resetSubtitleContainerHeight:78,scrollToSubtitle:79},null,[-1,-1,-1,-1])}get resetSubtitleContainerHeight(){return this.$$.ctx[78]}get scrollToSubtitle(){return this.$$.ctx[79]}}function Bm(t,e,n){const r=t.slice();return r[12]=e[n],r[13]=e,r[14]=n,r}function Om(t,e){let n,r,i=e[12].label+"",s,o,a,l=e[12].startText+"",c,u,f,p=e[14],y,m;const g=()=>e[8](n,p),w=()=>e[8](null,p);function _(){return e[9](e[12])}return{key:t,first:null,c(){n=ge("button"),r=ge("div"),s=Ft(i),o=me(),a=ge("div"),c=Ft(l),u=me(),re(a,"class","audio-time"),re(n,"class","m-y-xs p-b"),n.disabled=e[4],re(n,"title",f=e[4]?"Recording in progress":"Play from chapter"),ht(n,"inactive-chapter",e[2]>e[14]),ht(n,"recording",e[4]),this.first=n},m(b,E){de(b,n,E),oe(n,r),oe(r,s),oe(n,o),oe(n,a),oe(a,c),oe(n,u),g(),y||(m=Ke(n,"click",_),y=!0)},p(b,E){e=b,E&8&&i!==(i=e[12].label+"")&&ln(s,i),E&8&&l!==(l=e[12].startText+"")&&ln(c,l),E&16&&(n.disabled=e[4]),E&16&&f!==(f=e[4]?"Recording in progress":"Play from chapter")&&re(n,"title",f),p!==e[14]&&(w(),p=e[14],g()),E&12&&ht(n,"inactive-chapter",e[2]>e[14]),E&16&&ht(n,"recording",e[4])},d(b){b&&ce(n),w(),y=!1,m()}}}function Xy(t){let e,n=[],r=new Map,i=Kr(t[3]);const s=o=>o[12].key;for(let o=0;o<i.length;o+=1){let a=Bm(t,i,o),l=s(a);r.set(l,n[o]=Om(l,a))}return{c(){e=ge("div");for(let o=0;o<n.length;o+=1)n[o].c();re(e,"class","flex flex-col")},m(o,a){de(o,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);t[10](e)},p(o,[a]){a&62&&(i=Kr(o[3]),n=Ks(n,a,s,1,o,i,r,e,Pa,Om,null,Bm))},i:wt,o:wt,d(o){o&&ce(e);for(let a=0;a<n.length;a+=1)n[a].d();t[10](null)}}}function Yy(t,e,n){let r,i,s,o,a;fe(t,Hi,g=>n(11,r=g)),fe(t,Zs,g=>n(3,i=g)),fe(t,os,g=>n(6,s=g)),fe(t,Js,g=>n(7,o=g)),fe(t,xi,g=>n(4,a=g));let l,c=[],u=-1;function f(){n(2,u=i.findLastIndex(g=>r>=g.startSeconds)),!(u===-1||!c[u])&&(c[u].scrollIntoViewIfNeeded?c[u].scrollIntoViewIfNeeded():c[u].scrollIntoView())}function p(g,w){$t[g?"unshift":"push"](()=>{c[w]=g,n(1,c)})}const y=g=>{Bn(Be.RESTART_PLAYBACK,mn(g.startSeconds),{keepPauseState:!0}).then(Rr).then(f)};function m(g){$t[g?"unshift":"push"](()=>{l=g,n(0,l)})}return t.$$.update=()=>{t.$$.dirty&192&&o===pn.CHAPTERS&&s&&f()},[l,c,u,i,a,f,s,o,p,y,m]}class Ky extends In{constructor(e){super(),Pn(this,e,Yy,Xy,Tn,{})}}function Dm(t){let e,n,r,i,s,o,a,l,c;const u=[Zy,qy],f=[];function p(y,m){return typeof y[0].component=="string"?0:1}return s=p(t),o=f[s]=u[s](t),{c(){e=ge("div"),n=ge("div"),r=me(),i=ge("div"),o.c(),re(n,"tabindex","0"),re(n,"role","button"),re(n,"class","absolute inset-0 tap-highlight-transparent bg-black/[.32]"),re(i,"class","ttu-whispersync-container dialog-container relative top-1/2 left-1/2 inline-block -translate-x-1/2 -translate-y-1/2"),re(e,"class","ttu-whispersync-dialog writing-horizontal-tb fixed inset-0 w-full h-full"),Mr(e,"z-index",t[1])},m(y,m){de(y,e,m),oe(e,n),oe(e,r),oe(e,i),f[s].m(i,null),a=!0,l||(c=Ke(e,"wheel",Aa(t[4]),{passive:!0}),l=!0)},p(y,m){let g=s;s=p(y),s===g?f[s].p(y,m):(Wt(),ne(f[g],1,1,()=>{f[g]=null}),jt(),o=f[s],o?o.p(y,m):(o=f[s]=u[s](y),o.c()),J(o,1),o.m(i,null)),m&2&&Mr(e,"z-index",y[1])},i(y){a||(J(o),a=!0)},o(y){ne(o),a=!1},d(y){y&&ce(e),f[s].d(),l=!1,c()}}}function qy(t){let e,n,r;const i=[t[0].props];var s=t[0].component;function o(a,l){let c={};if(l!==void 0&&l&1)c=or(i,[ar(a[0].props)]);else for(let u=0;u<i.length;u+=1)c=an(c,i[u]);return{props:c}}return s&&(e=ed(s,o(t)),e.$on("close",t[2])),{c(){e&&ve(e.$$.fragment),n=Dr()},m(a,l){e&&we(e,a,l),de(a,n,l),r=!0},p(a,l){if(l&1&&s!==(s=a[0].component)){if(e){Wt();const c=e;ne(c.$$.fragment,1,0,()=>{ye(c,1)}),jt()}s?(e=ed(s,o(a,l)),e.$on("close",a[2]),ve(e.$$.fragment),J(e.$$.fragment,1),we(e,n.parentNode,n)):e=null}else if(s){const c=l&1?or(i,[ar(a[0].props)]):{};e.$set(c)}},i(a){r||(e&&J(e.$$.fragment,a),r=!0)},o(a){e&&ne(e.$$.fragment,a),r=!1},d(a){a&&ce(n),e&&ye(e,a)}}}function Zy(t){let e,n=t[0].component+"",r;return{c(){e=new c_(!1),r=Dr(),e.a=r},m(i,s){e.m(n,i,s),de(i,r,s)},p(i,s){s&1&&n!==(n=i[0].component+"")&&e.p(n)},i:wt,o:wt,d(i){i&&(ce(r),e.d())}}}function Jy(t){let e,n,r=t[0]&&Dm(t);return{c(){r&&r.c(),e=Dr()},m(i,s){r&&r.m(i,s),de(i,e,s),n=!0},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&J(r,1)):(r=Dm(i),r.c(),J(r,1),r.m(e.parentNode,e)):r&&(Wt(),ne(r,1,1,()=>{r=null}),jt())},i(i){n||(J(r),n=!0)},o(i){ne(r),n=!1},d(i){i&&ce(e),r&&r.d(i)}}}function Qy(t,e,n){let r,i;fe(t,En,u=>n(5,r=u)),fe(t,xo,u=>n(3,i=u));let s,o="";function a(){pe(xo,i=i.slice(0,-1),i),l()}function l(){var f;const u=i.length-1;n(0,s=i[u]),n(1,o=((f=i[u])==null?void 0:f.zIndex)||""),pe(En,r=!!s,r)}function c(u){wn.call(this,t,u)}return t.$$.update=()=>{t.$$.dirty&9&&i.length&&!s&&l()},[s,o,a,i,c]}class ev extends In{constructor(e){super(),Pn(this,e,Qy,Jy,Tn,{})}}const v1=(t,e)=>e.some(n=>t instanceof n);let Nm,Fm;function tv(){return Nm||(Nm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nv(){return Fm||(Fm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const E1=new WeakMap,S1=new WeakMap,lc=new WeakMap;function rv(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(bo(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return lc.set(e,t),e}function iv(t){if(E1.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});E1.set(t,e)}let T1={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return E1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return bo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function $m(t){T1=t(T1)}function sv(t){return nv().includes(t)?function(...e){return t.apply(k1(this),e),bo(this.request)}:function(...e){return bo(t.apply(k1(this),e))}}function ov(t){return typeof t=="function"?sv(t):(t instanceof IDBTransaction&&iv(t),v1(t,tv())?new Proxy(t,T1):t)}function bo(t){if(t instanceof IDBRequest)return rv(t);if(S1.has(t))return S1.get(t);const e=ov(t);return e!==t&&(S1.set(t,e),lc.set(e,t)),e}const k1=t=>lc.get(t);function av(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=bo(o);return r&&o.addEventListener("upgradeneeded",l=>{r(bo(o.result),l.oldVersion,l.newVersion,bo(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const lv=["get","getKey","getAll","getAllKeys","count"],uv=["put","add","delete","clear"],A1=new Map;function Vm(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(A1.get(e))return A1.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=uv.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lv.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return A1.set(e,s),s}$m(t=>({...t,get:(e,n,r)=>Vm(e,n)||t.get(e,n,r),has:(e,n)=>!!Vm(e,n)||t.has(e,n)}));const cv=["continue","continuePrimaryKey","advance"],xm={},C1=new WeakMap,Hm=new WeakMap,fv={get(t,e){if(!cv.includes(e))return t[e];let n=xm[e];return n||(n=xm[e]=function(...r){C1.set(this,Hm.get(this)[e](...r))}),n}};async function*dv(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,fv);for(Hm.set(n,e),lc.set(n,k1(e));e;)yield n,e=await(C1.get(n)||e.continue()),C1.delete(n)}function Um(t,e){return e===Symbol.asyncIterator&&v1(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&v1(t,[IDBIndex,IDBObjectStore])}$m(t=>({...t,get(e,n,r){return Um(e,n)?dv:t.get(e,n,r)},has(e,n){return Um(e,n)||t.has(e,n)}}));async function hv(t){try{const e=await av("books",t);if(!e)throw new Error("failed to open db");Ho.set(e)}catch({message:e}){throw new Error(`Error accessing books db - ${e}`)}}function Wm(t,e,n){const r=t.slice();return r[3]=e[n],r}function pv(t){let e;return{c(){e=Ft("Differences")},m(n,r){de(n,e,r)},d(n){n&&ce(e)}}}function jm(t,e){let n,r=e[3].id+"",i,s,o,a=e[3].original+"",l,c,u,f=e[3].adjusted+"",p;return{key:t,first:null,c(){n=ge("div"),i=Ft(r),s=me(),o=ge("div"),l=Ft(a),c=me(),u=ge("div"),p=Ft(f),this.first=n},m(y,m){de(y,n,m),oe(n,i),de(y,s,m),de(y,o,m),oe(o,l),de(y,c,m),de(y,u,m),oe(u,p)},p(y,m){e=y,m&1&&r!==(r=e[3].id+"")&&ln(i,r),m&1&&a!==(a=e[3].original+"")&&ln(l,a),m&1&&f!==(f=e[3].adjusted+"")&&ln(p,f)},d(y){y&&(ce(n),ce(s),ce(o),ce(c),ce(u))}}}function mv(t){let e,n,r,i,s,o,a,l,c=[],u=new Map,f=Kr(t[0]);const p=y=>y[3].id;for(let y=0;y<f.length;y+=1){let m=Wm(t,f,y),g=p(m);u.set(g,c[y]=jm(g,m))}return{c(){e=ge("div"),n=ge("div"),r=ge("div"),r.textContent="Id",i=me(),s=ge("div"),s.textContent="Original",o=me(),a=ge("div"),a.textContent="Adjusted",l=me();for(let y=0;y<c.length;y+=1)c[y].c();re(n,"class","diff-grid"),re(e,"class","overflow-auto p-s")},m(y,m){de(y,e,m),oe(e,n),oe(n,r),oe(n,i),oe(n,s),oe(n,o),oe(n,a),oe(n,l);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(n,null)},p(y,m){m&1&&(f=Kr(y[0]),c=Ks(c,m,p,1,y,f,u,n,Pa,jm,null,Wm))},d(y){y&&ce(e);for(let m=0;m<c.length;m+=1)c[m].d()}}}function _v(t){let e,n,r,i;return{c(){e=ge("div"),n=ge("button"),n.textContent="Close",re(e,"slot","footer")},m(s,o){de(s,e,o),oe(e,n),r||(i=Ke(n,"click",t[2]),r=!0)},p:wt,d(s){s&&ce(e),r=!1,i()}}}function gv(t){let e,n;return e=new _u({props:{$$slots:{footer:[_v],content:[mv],header:[pv]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,[i]){const s={};i&65&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function bv(t,e,n){let{subtitleDiffDetails:r}=e;const i=Mi(),s=()=>i("close");return t.$$set=o=>{"subtitleDiffDetails"in o&&n(0,r=o.subtitleDiffDetails)},[r,i,s]}class wv extends In{constructor(e){super(),Pn(this,e,bv,gv,Tn,{subtitleDiffDetails:0})}}function yv(t){let e,n;return{c(){e=ge("div"),n=Ft(t[2])},m(r,i){de(r,e,i),oe(e,n)},p(r,i){i&4&&ln(n,r[2])},d(r){r&&ce(e)}}}function vv(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Ev(t){let e,n,r,i,s,o,a,l,c;return o=new pi({props:{$$slots:{icon:[vv],default:[yv]},$$scope:{ctx:t}}}),{c(){e=ge("label"),n=Ft(t[1]),r=me(),i=ge("input"),s=me(),ve(o.$$.fragment),re(e,"for",t[4]),re(i,"type","checkbox"),re(i,"id",t[4])},m(u,f){de(u,e,f),oe(e,n),de(u,r,f),de(u,i,f),i.checked=t[3],de(u,s,f),we(o,u,f),a=!0,l||(c=[Ke(i,"change",t[6]),Ke(i,"change",t[5])],l=!0)},p(u,[f]){(!a||f&2)&&ln(n,u[1]),f&8&&(i.checked=u[3]);const p={};f&132&&(p.$$scope={dirty:f,ctx:u}),o.$set(p)},i(u){a||(J(o.$$.fragment,u),a=!0)},o(u){ne(o.$$.fragment,u),a=!1},d(u){u&&(ce(e),ce(r),ce(i),ce(s)),ye(o,u),l=!1,vn(c)}}}function Sv(t,e,n){let r,i=wt,s=()=>(i(),i=ts(o,p=>n(3,r=p)),o);t.$$.on_destroy.push(()=>i());let{targetStore$:o}=e;s();let{label:a}=e,{helpText:l}=e;const c=o.key();function u(p){wn.call(this,t,p)}function f(){r=this.checked,o.set(r)}return t.$$set=p=>{"targetStore$"in p&&s(n(0,o=p.targetStore$)),"label"in p&&n(1,a=p.label),"helpText"in p&&n(2,l=p.helpText)},[o,a,l,r,c,u,f]}class Hn extends In{constructor(e){super(),Pn(this,e,Sv,Ev,Tn,{targetStore$:0,label:1,helpText:2})}}function Tv(t){let e,n;return{c(){e=ge("div"),n=Ft(t[2])},m(r,i){de(r,e,i),oe(e,n)},p(r,i){i&4&&ln(n,r[2])},d(r){r&&ce(e)}}}function kv(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Av(t){let e,n,r,i,s,o,a,l,c,u;return a=new pi({props:{$$slots:{icon:[kv],default:[Tv]},$$scope:{ctx:t}}}),{c(){e=ge("label"),n=Ft(t[1]),r=me(),i=ge("input"),o=me(),ve(a.$$.fragment),re(e,"for",t[10]),re(i,"type","number"),i.value=t[8],re(i,"id",t[10]),i.disabled=t[3],re(i,"min",t[4]),re(i,"max",t[5]),re(i,"step",t[6])},m(f,p){de(f,e,p),oe(e,n),de(f,r,p),de(f,i,p),de(f,o,p),we(a,f,p),l=!0,c||(u=[Ke(i,"change",t[11]),Ke(i,"blur",t[12]),ka(s=Su.call(null,i,{document,isSkipped:t[9]}))],c=!0)},p(f,[p]){(!l||p&2)&&ln(n,f[1]),(!l||p&256&&i.value!==f[8])&&(i.value=f[8]),(!l||p&8)&&(i.disabled=f[3]),(!l||p&16)&&re(i,"min",f[4]),(!l||p&32)&&re(i,"max",f[5]),(!l||p&64)&&re(i,"step",f[6]),s&&Ai(s.update)&&p&512&&s.update.call(null,{document,isSkipped:f[9]});const y={};p&8196&&(y.$$scope={dirty:p,ctx:f}),a.$set(y)},i(f){l||(J(a.$$.fragment,f),l=!0)},o(f){ne(a.$$.fragment,f),l=!1},d(f){f&&(ce(e),ce(r),ce(i),ce(o)),ye(a,f),c=!1,vn(u)}}}function Cv(t,e,n){let r,i=wt,s=()=>(i(),i=ts(a,b=>n(8,r=b)),a),o;fe(t,En,b=>n(9,o=b)),t.$$.on_destroy.push(()=>i());let{targetStore$:a}=e;s();let{label:l}=e,{helpText:c}=e,{disabled:u=void 0}=e,{min:f=void 0}=e,{max:p=void 0}=e,{step:y=100}=e,{blurHandler:m=void 0}=e;const g=a.key(),w=b=>{m||dd(b,a)},_=b=>{m&&m(b,a)};return t.$$set=b=>{"targetStore$"in b&&s(n(0,a=b.targetStore$)),"label"in b&&n(1,l=b.label),"helpText"in b&&n(2,c=b.helpText),"disabled"in b&&n(3,u=b.disabled),"min"in b&&n(4,f=b.min),"max"in b&&n(5,p=b.max),"step"in b&&n(6,y=b.step),"blurHandler"in b&&n(7,m=b.blurHandler)},[a,l,c,u,f,p,y,m,r,o,g,w,_]}class Xr extends In{constructor(e){super(),Pn(this,e,Cv,Av,Tn,{targetStore$:0,label:1,helpText:2,disabled:3,min:4,max:5,step:6,blurHandler:7})}}function Gm(t){let e,n,r;return n=new Tt({props:{path:tl}}),n.$on("click",t[16]),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title","Download unmatched subtitle list")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Mv(t){let e;return{c(){e=ge("div"),e.textContent="Indicates # of lines which passed the similiarity check but are not equal to the book text"},m(n,r){de(n,e,r)},p:wt,d(n){n&&ce(e)}}}function Rv(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function zm(t){let e,n,r,i,s,o,a;return{c(){e=ge("button"),e.textContent="Show Diff",n=me(),r=ge("div"),i=me(),s=ge("div")},m(l,c){de(l,e,c),de(l,n,c),de(l,r,c),de(l,i,c),de(l,s,c),o||(a=Ke(e,"click",t[26]),o=!0)},p:wt,d(l){l&&(ce(e),ce(n),ce(r),ce(i),ce(s)),o=!1,a()}}}function Xm(t){let e,n,r,i,s;return{c(){e=ge("button"),n=Ft("Cancel"),re(e,"class","btn m-r-s"),e.disabled=r=t[1].aborted},m(o,a){de(o,e,a),oe(e,n),i||(s=Ke(e,"click",t[18]),i=!0)},p(o,a){a[0]&2&&r!==(r=o[1].aborted)&&(e.disabled=r)},d(o){o&&ce(e),i=!1,s()}}}function Ym(t){let e,n,r,i,s,o;return{c(){e=ge("button"),n=Ft("Save & reload page"),re(e,"class","btn m-r-s"),e.disabled=r=!!t[10],re(e,"title",i=t[10]?"Export in progress":null)},m(a,l){de(a,e,l),oe(e,n),s||(o=Ke(e,"click",t[20]),s=!0)},p(a,l){l[0]&1024&&r!==(r=!!a[10])&&(e.disabled=r),l[0]&1024&&i!==(i=a[10]?"Export in progress":null)&&re(e,"title",i)},d(a){a&&ce(e),s=!1,o()}}}function Km(t){let e,n,r;return{c(){e=ge("button"),e.textContent="Download",re(e,"class","btn m-r-s")},m(i,s){de(i,e,s),n||(r=Ke(e,"click",t[19]),n=!0)},p:wt,d(i){i&&ce(e),n=!1,r()}}}function Lv(t){let e;return{c(){e=ge("div"),e.textContent=`By matching the subtitles to the book you can enable extra functionality like the reader menu, auto scroll
			etc.`},m(n,r){de(n,e,r)},p:wt,d(n){n&&ce(e)}}}function Pv(t){let e,n,r;return n=new Tt({props:{path:Od}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Iv(t){let e,n,r,i,s,o=t[9].size+"",a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e;u=new Tt({props:{path:t[8]?Zo:Ud}}),u.$on("click",t[25]);let Ae=!t[3]&&t[7].length&&Gm(t);P=new pi({props:{$$slots:{icon:[Rv],default:[Mv]},$$scope:{ctx:t}}});let Ee=!t[3]&&t[6].length&&zm(t);ae=new Hn({props:{label:"Ignore rp elements",helpText:"If enabled the content of rp elements will be ignored for the similiarity check",targetStore$:t[11]}}),v=new Xr({props:{label:"Line similiarity %",helpText:"Determines the % threshold for which a book text line is considered a match (1 being identical)",min:.1,max:1,step:.1,targetStore$:t[12]}}),F=new Xr({props:{label:"Line match attempts",helpText:"Determines how many book text lines are tested before skipping the current subtitle line as unmatched",min:1,step:1,targetStore$:t[13]}});let Ve=t[3]&&Xm(t),Te=t[0]&&!t[3]&&Ym(t),Le=!t[3]&&t[6].length&&Km(t);return ie=new pi({props:{placement:"top",$$slots:{icon:[Pv],default:[Lv]},$$scope:{ctx:t}}}),z=new _1({props:{currentProgress:t[2],rounded:!0,margin:!0}}),{c(){e=ge("div"),n=ge("div"),r=ge("div"),r.textContent="Lines to match",i=me(),s=ge("div"),a=Ft(o),l=me(),c=ge("button"),ve(u.$$.fragment),p=me(),y=ge("div"),y.textContent="Line match rate",m=me(),g=ge("div"),w=Ft(t[4]),_=me(),b=ge("div"),Ae&&Ae.c(),E=me(),R=ge("div"),R.textContent="Book diff rate",h=me(),k=ge("div"),L=Ft(t[5]),$=me(),ve(P.$$.fragment),I=me(),Ee&&Ee.c(),H=me(),ve(ae.$$.fragment),V=me(),ve(v.$$.fragment),D=me(),ve(F.$$.fragment),Y=me(),K=ge("div"),Ve&&Ve.c(),Q=me(),Te&&Te.c(),W=me(),Le&&Le.c(),O=me(),C=ge("button"),S=Ft("Parse"),X=me(),ve(ie.$$.fragment),G=me(),ve(z.$$.fragment),re(c,"title",f=t[8]?"Delete start hint element":"Select start hint element"),re(n,"class","settings-grid"),re(e,"class","flex-1"),re(C,"class","btn m-r-s"),C.disabled=M=t[3]>0,re(K,"class","flex justify-end match-btns")},m(Ie,et){de(Ie,e,et),oe(e,n),oe(n,r),oe(n,i),oe(n,s),oe(s,a),oe(n,l),oe(n,c),we(u,c,null),oe(n,p),oe(n,y),oe(n,m),oe(n,g),oe(g,w),oe(n,_),oe(n,b),Ae&&Ae.m(b,null),oe(n,E),oe(n,R),oe(n,h),oe(n,k),oe(k,L),oe(n,$),we(P,n,null),oe(n,I),Ee&&Ee.m(n,null),oe(n,H),we(ae,n,null),oe(n,V),we(v,n,null),oe(n,D),we(F,n,null),de(Ie,Y,et),de(Ie,K,et),Ve&&Ve.m(K,null),oe(K,Q),Te&&Te.m(K,null),oe(K,W),Le&&Le.m(K,null),oe(K,O),oe(K,C),oe(C,S),oe(K,X),we(ie,K,null),de(Ie,G,et),we(z,Ie,et),le=!0,Me||(_e=Ke(C,"click",t[17]),Me=!0)},p(Ie,et){(!le||et[0]&512)&&o!==(o=Ie[9].size+"")&&ln(a,o);const B={};et[0]&256&&(B.path=Ie[8]?Zo:Ud),u.$set(B),(!le||et[0]&256&&f!==(f=Ie[8]?"Delete start hint element":"Select start hint element"))&&re(c,"title",f),(!le||et[0]&16)&&ln(w,Ie[4]),!Ie[3]&&Ie[7].length?Ae?(Ae.p(Ie,et),et[0]&136&&J(Ae,1)):(Ae=Gm(Ie),Ae.c(),J(Ae,1),Ae.m(b,null)):Ae&&(Wt(),ne(Ae,1,1,()=>{Ae=null}),jt()),(!le||et[0]&32)&&ln(L,Ie[5]);const x={};et[1]&8192&&(x.$$scope={dirty:et,ctx:Ie}),P.$set(x),!Ie[3]&&Ie[6].length?Ee?Ee.p(Ie,et):(Ee=zm(Ie),Ee.c(),Ee.m(n,H)):Ee&&(Ee.d(1),Ee=null),Ie[3]?Ve?Ve.p(Ie,et):(Ve=Xm(Ie),Ve.c(),Ve.m(K,Q)):Ve&&(Ve.d(1),Ve=null),Ie[0]&&!Ie[3]?Te?Te.p(Ie,et):(Te=Ym(Ie),Te.c(),Te.m(K,W)):Te&&(Te.d(1),Te=null),!Ie[3]&&Ie[6].length?Le?Le.p(Ie,et):(Le=Km(Ie),Le.c(),Le.m(K,O)):Le&&(Le.d(1),Le=null),(!le||et[0]&8&&M!==(M=Ie[3]>0))&&(C.disabled=M);const Ne={};et[1]&8192&&(Ne.$$scope={dirty:et,ctx:Ie}),ie.$set(Ne);const We={};et[0]&4&&(We.currentProgress=Ie[2]),z.$set(We)},i(Ie){le||(J(u.$$.fragment,Ie),J(Ae),J(P.$$.fragment,Ie),J(ae.$$.fragment,Ie),J(v.$$.fragment,Ie),J(F.$$.fragment,Ie),J(ie.$$.fragment,Ie),J(z.$$.fragment,Ie),le=!0)},o(Ie){ne(u.$$.fragment,Ie),ne(Ae),ne(P.$$.fragment,Ie),ne(ae.$$.fragment,Ie),ne(v.$$.fragment,Ie),ne(F.$$.fragment,Ie),ne(ie.$$.fragment,Ie),ne(z.$$.fragment,Ie),le=!1},d(Ie){Ie&&(ce(e),ce(Y),ce(K),ce(G)),ye(u),Ae&&Ae.d(),ye(P),Ee&&Ee.d(),ye(ae),ye(v),ye(F),Ve&&Ve.d(),Te&&Te.d(),Le&&Le.d(),ye(ie),ye(z,Ie),Me=!1,_e()}}}const Bv=/[\p{punct}\s]/u;function qm(t){if(t===null)return;if(t.nodeType===Node.TEXT_NODE&&Ni(t.textContent))return t;let e;for(let n=0,{length:r}=t.childNodes;n<r;n+=1){const i=t.childNodes[n];if(i.nodeType===Node.TEXT_NODE&&Ni(t.textContent)?e=i:e=qm(i),e)break}return e}function M1(t){return t.parentElement.closest('div[id^="ttu-"]')}function R1(t,e){const n=t[e].text,r=[...n].length;return{currentSubtitle:n,currentSubtitleLength:r}}function Zm(t){return[...Ni(t)].length}function Ni(t,e=!1){const n=(t||"").replace(/\s/g,"").trim();return e?n.toLowerCase():n}function Jm(t,e){const n=[...t];if(n.length===e)return t;let r="",i=0;for(let s=0,{length:o}=n;s<o;s+=1){let a=n[s];r+=a;const l=a.trim();if(l&&!Bv.test(l)&&(i+=1),i===e)break}return r}function L1(t,e){const n=Ni(t,!0),r=Ni(e,!0),i=[...n].length,s=[...r].length,o=i<5?1:2;if(n===r)return 1;if(i<o||s<o)return 0;const a=new Map;for(let c=0;c<i-(o-1);c+=1){const u=[...n].slice(c,c+o).join("");a.set(u,a.has(u)?a.get(u)+1:1)}let l=0;for(let c=0;c<s-(o-1);c++){const u=[...r].slice(c,c+o).join(""),f=a.has(u)?a.get(u):0;f>0&&(a.set(u,f-1),l+=1)}return l*2/(i+s-(o-1)*2)}function Qm(t,e,n,r){throw console.log(t,e,n,r),new Error(t)}function Ov(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g;fe(t,kt,_e=>n(31,a=_e)),fe(t,Ct,_e=>n(32,l=_e)),fe(t,Ho,_e=>n(33,c=_e)),fe(t,Ri,_e=>n(34,u=_e)),fe(t,ns,_e=>n(35,f=_e)),fe(t,Pr,_e=>n(9,y=_e)),fe(t,yi,_e=>n(10,g=_e));const w=new Set(["rt"]),{isIOS:_}=Bo("context"),{matchLineIgnoreRp$:b,matchLineSimilarityThreshold$:E,matchLineMaxAttempts$:R}=_t;fe(t,b,_e=>n(24,m=_e)),fe(t,E,_e=>n(30,o=_e)),fe(t,R,_e=>n(36,p=_e));const h=Mi();let k,L=new AbortController,$=L.signal,P=0,I=0,H="n/a",ae="n/a",V=[],v=[],D=[],F,Y;async function K(){document.addEventListener("click",W,{once:!0,capture:!1}),h("selectHint")}function Q(){n(21,F=void 0),n(22,Y=void 0)}function W({x:_e,y:Ae}){const Ee=qm(document.elementFromPoint(_e,Ae));if(Ee){const Ve=M1(Ee);Ve!=null&&Ve.id&&(n(21,F=Ee.textContent),n(22,Y=Ve.id),Ee.parentElement.style.visibility="hidden",setTimeout(()=>Ee.parentElement.style.visibility="",500))}h("hintSelected")}function O(){pe(kt,a=!0,a);let _e="";for(let Ae=0,{length:Ee}=D;Ae<Ee;Ae+=1){const Ve=D[Ae];_e+=`${Ve.id}
${Ve.text}

`}du(document,new Blob([_e],{type:"text/plain;charset=utf-8"}),`${f.name.split(/\.(?=[^\.]+$)/)[0]}_unmatched.txt`,_),pe(kt,a=!1,a)}async function C(){pe(kt,a=!0,a),pe(Ct,l="",l),n(4,H="n/a"),n(5,ae="n/a"),V=[],n(6,v=[]),n(7,D=[]),n(3,I=y.size);try{const _e=[],Ae=[...y.values()],Ee=Math.min(Ae.length,p),Ve=new Map,Te=new Map,Le=[...lu].join(",");let Ie=[],et="",B="",x=0,Ne=!r,{currentSubtitle:We,currentSubtitleLength:tt}=R1(Ae,x);n(0,k=uu(new DOMParser,u.elementHtml));const ke=document.createTreeWalker(k,NodeFilter.SHOW_TEXT,{acceptNode(N){var j;if(r&&!Ne&&(Ne=F===N.textContent&&((j=M1(N))==null?void 0:j.id)===Y,Ne&&(N.parentElement.dataset.ttuWhispersyncStartNode="")),Ne){const ee=Ni(N.textContent);ie(Ve,N,ee),ee&&_e.push(N)}return NodeFilter.FILTER_ACCEPT}});for(;ke.nextNode(););let Pe=0,Xe=1,qe=0,it=0,Je=_e.length;for(;qe<Je&&x<Ae.length;){fu($);const N=Ka(x+1,I);let j=_e[qe],ee=j.parentElement;if(N!==P&&(n(2,P=N),await new Promise(se=>setTimeout(se))),ee.closest(s)||(et+=j.textContent),Zm(et)>=tt){const se=Jm(et,tt),be=[...se].length;let he=0,Ce=be,Re=L1(se,We);Ie.push(j);const Fe=G(We,tt,se,be,he,Re,Ie,_e,qe),nt=Fe.bestLineSimiliarityValue>=o;for(nt&&({bestLineSimiliarityStartIndex:he,bestLineSimiliarityEndIndex:Ce,currentNodes:Ie,currentTextNodeIndex:qe}=Fe),j=_e[qe],ee=j.parentElement,qe+=1;ee.closest(s)&&qe<Je;)j=_e[qe],ee=j.parentElement,ee.closest(s)&&Ie.push(j),qe+=1;if(qe-=1,nt){let pt=Ce-he,je=0,ft=!1;if(he!==0){const Oe=Ie[0],$e=Oe.textContent||"",at=document.createTextNode([...$e].slice(0,he).join("")),Ge=document.createTextNode([...$e].slice(he).join(""));Oe.parentElement.replaceChild(at,Oe),at.after(Ge),Ie[0]=Ge}for(let Oe=0,{length:$e}=Ie;Oe<$e;Oe+=1){const at=Ie[Oe],Ge=at.parentElement,mt=at.textContent||"",Qe=[...mt].length,vt=!!Ge.closest(s),Lt=document.createElement("span"),lt=vt?[...mt].slice(0).join(""):[...mt].slice(0,pt).join(""),Et=document.createTextNode(lt),dt=[...lt].length,Gt=Qe-dt;if(pt){const Qt=Ae[x];Lt.classList.add(V_(Qt.id)),Lt.appendChild(Et),Ge.replaceChild(Lt,at),Ge.closest(Le)||(B+=lt)}if(je+=vt?0:dt,pt=Ce-he-je,!pt&&Gt){const Qt=[];Oe+=dt?0:1;let Kt=dt;for(;Oe<$e;){const zt=Ie[Oe],nn=zt.textContent||"",Ln=document.createTextNode([...nn].slice(Kt).join(""));if(!nn)throw new Error("charactersToProcess without remaining text found");zt.parentElement||(Lt.after(Ln),Qt.push(Ln)),Oe+=1,Kt=0}Qt.length&&_e.splice(qe,Qt.length,...Qt),ft=!0}}z(Ae[x],B),et="",B="",ft||(qe+=1),it=qe,x+=1,Pe+=1,Xe=1,x<Ae.length&&({currentSubtitle:We,currentSubtitleLength:tt}=R1(Ae,x))}else{qe=it+Xe,Xe+=1,et="",B="";const pt=qe>_e.length,je=Xe>Ee;(je||pt)&&(console.log(je?`Max match attempts for ${We} (${Ae[x].id}) reached - reset`:`End of Text before max attempt for ${We} (${Ae[x].id}) reached - reset`),D.push(Ae[x]),z(Ae[x],B),Xe=1,x+=1,x<Ae.length?(qe=it,{currentSubtitle:We,currentSubtitleLength:tt}=R1(Ae,x)):qe=Je)}Ie=[]}else Ie.push(j),qe+=1;Je=_e.length}Ne=!r;const U=document.createTreeWalker(k,NodeFilter.SHOW_TEXT,{acceptNode(N){var j;return r&&!Ne&&(Ne=!!((j=N.parentElement)!=null&&j.closest("*[data-ttu-whispersync-start-node]"))),Ne&&ie(Te,N,Ni(N.textContent)),NodeFilter.FILTER_ACCEPT}});for(;U.nextNode(););const T=[...Ve.entries()],d=[...Te.entries()];for(let N=0,{length:j}=T;N<j;N+=1){const[ee,te]=T[N],[se,be]=d[N]||[],he=M1(ee);ee!==se&&Qm(`element mismatch on index ${N}`,ee,se,he);const Ce=[...te],Re=[...be];for(let Fe=0,{length:nt}=Ce;Fe<nt;Fe+=1){const pt=Ce[Fe],je=Re[Fe];pt!==je&&Qm(`mismatch on index ${N}, position ${Fe}: ${[...te].slice(Math.max(0,Fe-10),Math.min(Ce.length,Fe+10)).join("")} | vs | ${[...be].slice(Math.max(0,Fe-10),Math.min(Re.length,Fe+10)).join("")}`,ee,se,he)}}const A=Ae[Ae.length-1];et&&(D.push(A),console.log(`End of Text before max attempt for ${A.text} (${A.id}) reached - reset`)),V.length&&V[V.length-1].id!==A.id&&z(A,B),n(4,H=`${Pe} / ${Ae.length} (${Ka(Pe,Ae.length,!1)}%)`),n(5,ae=`${v.length} / ${Pe} (${Ka(v.length,Pe,!1)}%)`),k.firstElementChild instanceof HTMLElement&&(n(0,k.firstElementChild.dataset.ttuWhispersyncMatchedBy=f.name,k),n(0,k.firstElementChild.dataset.ttuWhispersyncMatchedOn=`${Date.now()}`,k),n(0,k.firstElementChild.dataset.ttuWhispersyncMatchedSource="default",k))}catch(_e){n(4,H="n/a"),n(5,ae="n/a"),n(0,k=void 0),V=[],n(6,v=[]),n(7,D=[]),!L.signal.aborted&&_e.name!=="AbortError"&&pe(Ct,l=`Failed to match: ${_e.message}`,l)}n(2,P=0),n(3,I=0),L=new AbortController,n(1,$=L.signal),pe(kt,a=!1,a)}function S(){$.aborted||L.abort("user aborted")}function M(){pe(kt,a=!0,a);let _e="";for(let Ae=0,{length:Ee}=V;Ae<Ee;Ae+=1){const Ve=V[Ae];_e+=`${Ve.id}
${Ve.startTime} --> ${Ve.endTime}
${Ve.text}

`}du(document,new Blob([_e],{type:`${_?"text/plain":"application/x-subrip"};charset=utf-8`}),`${f.name.split(/\.(?=[^\.]+$)/)[0]}_adjusted.srt`,_),pe(kt,a=!1,a)}async function X(){pe(kt,a=!0,a);try{const _e={...u,htmlBackup:u.elementHtml,elementHtml:k.innerHTML,lastBookModified:Date.now()};await c.put("data",_e),window.location.reload()}catch({message:_e}){pe(Ct,l=`Failed to save data: ${_e}`,l),pe(kt,a=!1,a)}}function ie(_e,Ae,Ee){const Ve=Ae.parentElement instanceof HTMLSpanElement&&jc(Ae.parentElement)!=="not existing"?Ae.parentElement.parentElement:Ae.parentElement;_e.set(Ve,`${_e.get(Ve)||""}${Ee}`)}function G(_e,Ae,Ee,Ve,Te,Le,Ie,et,B){let x=Te,Ne=Ve,We=Le;if(We!==1){for(let U=Ne;U>Te;U-=1)if(Ni(_e)===Ni([...Ee].slice(Te,U).join(""))){x=Te,Ne=U,We=1;break}}if(We!==1)for(let U=Te;U<Ne;U+=1){const T=L1(_e,[...Ee].slice(U,Ne).join(""));T>We&&(x=U,Ne=Ve,We=T)}if(Te===x||We===1||We<o){if(We!==1){We=-1;for(let N=Ne;N>Te;N-=1){const j=L1(_e,[...Ee].slice(Te,N).join(""));j>We&&(x=Te,Ne=N,We=j)}}if(We<o||We===1)return{bestLineSimiliarityStartIndex:x,bestLineSimiliarityEndIndex:Ne,bestLineSimiliarityValue:We,currentNodes:Ie,currentTextNodeIndex:B};const U=[],T=Ie.length,d=Ne-x;let A=0;for(;A<d&&Ie.length;){const N=Ie.shift(),j=N.parentElement;A+=j.closest(s)?0:[...N.textContent||""].length,U.push(N)}return{bestLineSimiliarityStartIndex:x,bestLineSimiliarityEndIndex:Ne,bestLineSimiliarityValue:We,currentNodes:U,currentTextNodeIndex:B-(T-U.length)}}let tt=0,ke=0,Pe=x;for(let U=0,{length:T}=Ie;U<T;U+=1){let d=Ie[U],N=d.parentElement.closest(s)?0:[...d.textContent||""].length;const j=Pe-N;if(ke+=N,Pe=j<0?Pe:j,ke>=x){tt=U+(ke===x?1:0);break}}const Xe=[];let qe="",it=0,Je=B-(Ie.length-(tt+1));for(;it<=Ae&&Je<et.length;){const U=et[Je];U.parentElement.closest(s)||(qe+=U.textContent),Xe.push(U),Je+=1,it=Zm(qe)}return Je=Je-1,qe=Jm(qe,Ae),G(_e,Ae,qe,[...qe].length,Pe,We,Xe,et,Je)}function z(_e,Ae){const Ee=Ni(_e.text,!0),Ve=Ni(Ae,!0);V.push({..._e}),Ae&&Ee!==Ve&&(V[V.length-1].text=Ae,v.push({id:_e.id,original:_e.text,adjusted:Ae}))}const le=()=>r?Q():K(),Me=()=>xo.add({component:wv,props:{subtitleDiffDetails:v}});return t.$$.update=()=>{t.$$.dirty[0]&6291456&&n(8,r=F!==void 0&&Y!==void 0),t.$$.dirty[0]&16777216&&n(23,i=m?lu:w),t.$$.dirty[0]&8388608&&(s=[...i].join(","))},[k,$,P,I,H,ae,v,D,r,y,g,b,E,R,K,Q,O,C,S,M,X,F,Y,i,m,le,Me]}class Dv extends In{constructor(e){super(),Pn(this,e,Ov,Iv,Tn,{},null,[-1,-1])}}function Nv(t){let e,n,r,i,s,o,a,l;return r=new Tt({props:{path:Pd}}),s=new ff({props:{subtitle:t[1],buttonClasses:t[4]?"p-y-xs":"p-x-xs",listItems:t[3]}}),s.$on("executed",t[11]),{c(){e=ge("div"),n=ge("button"),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),re(n,"title","Close menu"),ht(n,"p-y-xs",t[4]),ht(n,"p-x-xs",!t[4]),re(e,"class","ttu-whispersync-container popover reader-menu"),ht(e,"flex-col",t[4]),ht(e,"hidden",!t[0])},m(c,u){de(c,e,u),oe(e,n),we(r,n,null),oe(e,i),we(s,e,null),t[12](e),o=!0,a||(l=Ke(n,"click",t[6]),a=!0)},p(c,[u]){const f={};u&2&&(f.subtitle=c[1]),u&8&&(f.listItems=c[3]),s.$set(f),(!o||u&1)&&ht(e,"hidden",!c[0])},i(c){o||(J(r.$$.fragment,c),J(s.$$.fragment,c),o=!0)},o(c){ne(r.$$.fragment,c),ne(s.$$.fragment,c),o=!1},d(c){c&&ce(e),ye(r),ye(s),t[12](null),a=!1,l()}}}function Fv(t,e,n){let r,i,s,o;fe(t,xi,I=>n(8,r=I)),fe(t,Ls,I=>n(9,i=I)),fe(t,Pr,I=>n(10,s=I));let{range:a}=e,{subtitle:l}=e;function c(I){return!I||!b?!1:b.contains(I)}const{bookContentElement:u,isVertical:f,isPaginated:p}=Bo("context"),{actionListOfReader$:y}=_t;fe(t,y,I=>n(3,o=I));const m=f?"left-start":"top-start",g=f?["right-start","left-end","right-end"]:["bottom-start","top-end","bottom-end"],w=Mi();let _,b,E;Gl(()=>_==null?void 0:_());function R(){w("close")}async function h(I){_==null||_(),I&&(await Rr(),_=um(I,b,k))}function k(){a&&fm({getBoundingClientRect:()=>a.getBoundingClientRect(),getClientRects:()=>{if(!p)return a.getClientRects();const I=L(),H=[...a.getClientRects()],ae=H.filter(v=>v.bottom>I.top&&v.right>I.left&&v.top<I.bottom&&v.left<I.right),V=(ae.length?ae:H).filter(v=>{var F;return!((F=document.elementFromPoint(v.x,v.y))==null?void 0:F.closest("rt"))});return V.length?V:H}},b,{placement:m,middleware:[Zp(5),ny(),cm({fallbackPlacements:g})]}).then(({x:I,y:H})=>{n(2,b.style.left=`${I}px`,b),n(2,b.style.top=`${H}px`,b)}).catch(()=>{})}function L(){E||(E=window.getComputedStyle(u));const I=u.getBoundingClientRect(),H=f?I.top:I.top+Number.parseFloat(E.paddingTop.replace("px","")),ae=f?I.right-Number.parseFloat(E.paddingRight.replace("px","")):I.right,V=f?I.bottom:I.bottom-Number.parseFloat(E.paddingBottom.replace("px","")),v=f?I.left+Number.parseFloat(E.paddingLeft.replace("px","")):I.left;return{top:H,right:ae,left:v,bottom:V}}const $=({detail:I})=>{I===Be.COPY_SUBTITLE&&R()};function P(I){$t[I?"unshift":"push"](()=>{b=I,n(2,b)})}return t.$$set=I=>{"range"in I&&n(0,a=I.range),"subtitle"in I&&n(1,l=I.subtitle)},t.$$.update=()=>{t.$$.dirty&1794&&(l||s.size),t.$$.dirty&1&&h(a)},[a,l,b,o,f,y,R,c,r,i,s,$,P]}class $v extends In{constructor(e){super(),Pn(this,e,Fv,Nv,Tn,{range:0,subtitle:1,isInReaderMenu:7})}get isInReaderMenu(){return this.$$.ctx[7]}}function Vv(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m;return f=new Tt({props:{path:Hd}}),{c(){e=ge("label"),n=Ft(t[1]),r=me(),i=ge("div"),s=ge("input"),a=me(),l=ge("input"),c=me(),u=ge("button"),ve(f.$$.fragment),re(e,"for",t[4]),re(s,"type","text"),Mr(s,"max-width","50%"),s.value=t[2],re(l,"class","flex-1 m-l-s"),re(l,"type","color"),re(l,"id",t[4]),re(i,"class","flex items-center"),re(u,"title","Reset Color")},m(g,w){de(g,e,w),oe(e,n),de(g,r,w),de(g,i,w),oe(i,s),oe(i,a),oe(i,l),Ci(l,t[2]),de(g,c,w),de(g,u,w),we(f,u,null),p=!0,y||(m=[Ke(s,"blur",t[6]),ka(o=Su.call(null,s,{document,isSkipped:t[3]})),Ke(l,"input",t[8]),Ke(l,"change",t[7]),Ke(u,"click",t[9])],y=!0)},p(g,[w]){(!p||w&2)&&ln(n,g[1]),(!p||w&4&&s.value!==g[2])&&(s.value=g[2]),o&&Ai(o.update)&&w&8&&o.update.call(null,{document,isSkipped:g[3]}),w&4&&Ci(l,g[2])},i(g){p||(J(f.$$.fragment,g),p=!0)},o(g){ne(f.$$.fragment,g),p=!1},d(g){g&&(ce(e),ce(r),ce(i),ce(c),ce(u)),ye(f),y=!1,vn(m)}}}function xv(t,e,n){let r,i=wt,s=()=>(i(),i=ts(a,g=>n(2,r=g)),a),o;fe(t,En,g=>n(3,o=g)),t.$$.on_destroy.push(()=>i());let{targetStore$:a}=e;s();let{label:l}=e;const c=a.key(),u=Mi();function f({currentTarget:g}){g.value.match(/^#[0-9A-F]{6}$/i)?(pe(a,r=g.value,r),u("change")):g.value=r}function p(g){wn.call(this,t,g)}function y(){r=this.value,a.set(r)}const m=()=>{a.set(Zl(c)),u("reset")};return t.$$set=g=>{"targetStore$"in g&&s(n(0,a=g.targetStore$)),"label"in g&&n(1,l=g.label)},[a,l,r,o,c,u,f,p,y,m]}class e2 extends In{constructor(e){super(),Pn(this,e,xv,Vv,Tn,{targetStore$:0,label:1})}}function Hv(t){let e,n,r,i,s,o=t[2]?" for active subtitle":"",a,l,c;return{c(){e=ge("div"),n=Ft(t[0]),r=me(),i=ge("div"),s=Ft(t[1]),a=Ft(o),l=me(),c=ge("div")},m(u,f){de(u,e,f),oe(e,n),de(u,r,f),de(u,i,f),oe(i,s),oe(i,a),de(u,l,f),de(u,c,f)},p(u,[f]){f&1&&ln(n,u[0]),f&2&&ln(s,u[1]),f&4&&o!==(o=u[2]?" for active subtitle":"")&&ln(a,o)},i:wt,o:wt,d(u){u&&(ce(e),ce(r),ce(i),ce(l),ce(c))}}}function Uv(t,e,n){let{key:r}=e,{description:i}=e,{extendDescription:s=!0}=e;return t.$$set=o=>{"key"in o&&n(0,r=o.key),"description"in o&&n(1,i=o.description),"extendDescription"in o&&n(2,s=o.extendDescription)},[r,i,s]}class mr extends In{constructor(e){super(),Pn(this,e,Uv,Hv,Tn,{key:0,description:1,extendDescription:2})}}function Wv(t){let e,n,r,i,s,o,a,l;const c=t[5].default,u=Ro(c,t,t[4],null);return{c(){e=ge("details"),n=ge("summary"),r=Ft(t[0]),i=me(),s=ge("div"),u&&u.c(),re(s,"class","settings-grid"),e.open=t[1]},m(f,p){de(f,e,p),oe(e,n),oe(n,r),oe(e,i),oe(e,s),u&&u.m(s,null),o=!0,a||(l=Ke(n,"click",Aa(Wl(t[2]))),a=!0)},p(f,[p]){(!o||p&1)&&ln(r,f[0]),u&&u.p&&(!o||p&16)&&Po(u,c,f,f[4],o?Lo(c,f[4],p,null):Io(f[4]),null),(!o||p&2)&&(e.open=f[1])},i(f){o||(J(u,f),o=!0)},o(f){ne(u,f),o=!1},d(f){f&&ce(e),u&&u.d(f),a=!1,l()}}}function jv(t,e,n){let r,{$$slots:i={},$$scope:s}=e,{openSettingsMenu:o}=e,{settingsMenu:a}=e;function l(){n(3,o=r?li.NONE:a)}return t.$$set=c=>{"openSettingsMenu"in c&&n(3,o=c.openSettingsMenu),"settingsMenu"in c&&n(0,a=c.settingsMenu),"$$scope"in c&&n(4,s=c.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&n(1,r=o===a)},[a,r,l,o,s,i]}class vs extends In{constructor(e){super(),Pn(this,e,jv,Wv,Tn,{openSettingsMenu:3,settingsMenu:0})}}function t2(t,e,n){const r=t.slice();return r[12]=e[n],r}function n2(t,e){let n,r=e[12]+"",i,s,o;return{key:t,first:null,c(){n=ge("option"),i=Ft(r),s=me(),n.__value=o=e[12],Ci(n,n.__value),this.first=n},m(a,l){de(a,n,l),oe(n,i),oe(n,s)},p(a,l){e=a,l&2&&r!==(r=e[12]+"")&&ln(i,r),l&2&&o!==(o=e[12])&&(n.__value=o,Ci(n,n.__value))},d(a){a&&ce(n)}}}function Gv(t){let e;return{c(){e=ge("div")},m(n,r){de(n,e,r)},p:wt,i:wt,o:wt,d(n){n&&ce(e)}}}function zv(t){let e,n,r;return n=new Tt({props:{path:t[4]}}),n.$on("click",t[11]),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title",t[5])},m(i,s){de(i,e,s),we(n,e,null),r=!0},p(i,s){const o={};s&16&&(o.path=i[4]),n.$set(o),(!r||s&32)&&re(e,"title",i[5])},i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Xv(t){let e,n;return e=new pi({props:{$$slots:{icon:[Kv],default:[Yv]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i&32776&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function Yv(t){let e,n;return{c(){e=ge("div"),n=Ft(t[3])},m(r,i){de(r,e,i),oe(e,n)},p(r,i){i&8&&ln(n,r[3])},d(r){r&&ce(e)}}}function Kv(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function qv(t){let e,n,r,i,s=[],o=new Map,a,l,c,u,f,p,y,m,g=Kr(t[1]);const w=R=>R[12];for(let R=0;R<g.length;R+=1){let h=t2(t,g,R),k=w(h);o.set(k,s[R]=n2(k,h))}const _=[Xv,zv,Gv],b=[];function E(R,h){return R[3]?0:R[4]?1:2}return c=E(t),u=b[c]=_[c](t),{c(){e=ge("label"),n=Ft(t[2]),r=me(),i=ge("select");for(let R=0;R<s.length;R+=1)s[R].c();l=me(),u.c(),f=Dr(),re(e,"for",t[8]),i.disabled=a=!t[1].length||t[6],re(i,"id",t[8]),t[7]===void 0&&Cs(()=>t[10].call(i))},m(R,h){de(R,e,h),oe(e,n),de(R,r,h),de(R,i,h);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(i,null);jl(i,t[7],!0),de(R,l,h),b[c].m(R,h),de(R,f,h),p=!0,y||(m=[Ke(i,"change",t[10]),Ke(i,"change",t[9])],y=!0)},p(R,[h]){(!p||h&4)&&ln(n,R[2]),h&2&&(g=Kr(R[1]),s=Ks(s,h,w,1,R,g,o,i,Pa,n2,null,t2)),(!p||h&66&&a!==(a=!R[1].length||R[6]))&&(i.disabled=a),h&130&&jl(i,R[7]);let k=c;c=E(R),c===k?b[c].p(R,h):(Wt(),ne(b[k],1,1,()=>{b[k]=null}),jt(),u=b[c],u?u.p(R,h):(u=b[c]=_[c](R),u.c()),J(u,1),u.m(f.parentNode,f))},i(R){p||(J(u),p=!0)},o(R){ne(u),p=!1},d(R){R&&(ce(e),ce(r),ce(i),ce(l),ce(f));for(let h=0;h<s.length;h+=1)s[h].d();b[c].d(R),y=!1,vn(m)}}}function Zv(t,e,n){let r,i=wt,s=()=>(i(),i=ts(o,_=>n(7,r=_)),o);t.$$.on_destroy.push(()=>i());let{targetStore$:o}=e;s();let{options:a}=e,{label:l}=e,{helpText:c=""}=e,{buttonIcon:u=""}=e,{buttonTitle:f=""}=e,{disabled:p=!1}=e;const y=o.key();function m(_){wn.call(this,t,_)}function g(){r=Q1(this),o.set(r),n(1,a)}function w(_){wn.call(this,t,_)}return t.$$set=_=>{"targetStore$"in _&&s(n(0,o=_.targetStore$)),"options"in _&&n(1,a=_.options),"label"in _&&n(2,l=_.label),"helpText"in _&&n(3,c=_.helpText),"buttonIcon"in _&&n(4,u=_.buttonIcon),"buttonTitle"in _&&n(5,f=_.buttonTitle),"disabled"in _&&n(6,p=_.disabled)},[o,a,l,c,u,f,p,r,y,m,g,w]}class Br extends In{constructor(e){super(),Pn(this,e,Zv,qv,Tn,{targetStore$:0,options:1,label:2,helpText:3,buttonIcon:4,buttonTitle:5,disabled:6})}}function Jv(t){let e;return{c(){e=ge("div")},m(n,r){de(n,e,r)},p:wt,i:wt,o:wt,d(n){n&&ce(e)}}}function Qv(t){let e,n,r;return n=new Tt({props:{path:t[3]}}),n.$on("click",t[10]),{c(){e=ge("button"),ve(n.$$.fragment),re(e,"title",t[4])},m(i,s){de(i,e,s),we(n,e,null),r=!0},p(i,s){const o={};s&8&&(o.path=i[3]),n.$set(o),(!r||s&16)&&re(e,"title",i[4])},i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function e9(t){let e,n;return e=new pi({props:{$$slots:{icon:[n9],default:[t9]},$$scope:{ctx:t}}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i&2052&&(s.$$scope={dirty:i,ctx:r}),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function t9(t){let e,n;return{c(){e=ge("div"),n=Ft(t[2])},m(r,i){de(r,e,i),oe(e,n)},p(r,i){i&4&&ln(n,r[2])},d(r){r&&ce(e)}}}function n9(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function r9(t){let e,n,r,i,s,o,a,l,c,u,f,p;const y=[e9,Qv,Jv],m=[];function g(w,_){return w[2]?0:w[3]?1:2}return a=g(t),l=m[a]=y[a](t),{c(){e=ge("label"),n=Ft(t[1]),r=me(),i=ge("input"),o=me(),l.c(),c=Dr(),re(e,"for",t[7]),i.value=t[5],re(i,"id",t[7])},m(w,_){de(w,e,_),oe(e,n),de(w,r,_),de(w,i,_),de(w,o,_),m[a].m(w,_),de(w,c,_),u=!0,f||(p=[Ke(i,"blur",t[8]),Ke(i,"change",t[9]),ka(s=Su.call(null,i,{document,isSkipped:t[6]}))],f=!0)},p(w,[_]){(!u||_&2)&&ln(n,w[1]),(!u||_&32&&i.value!==w[5])&&(i.value=w[5]),s&&Ai(s.update)&&_&64&&s.update.call(null,{document,isSkipped:w[6]});let b=a;a=g(w),a===b?m[a].p(w,_):(Wt(),ne(m[b],1,1,()=>{m[b]=null}),jt(),l=m[a],l?l.p(w,_):(l=m[a]=y[a](w),l.c()),J(l,1),l.m(c.parentNode,c))},i(w){u||(J(l),u=!0)},o(w){ne(l),u=!1},d(w){w&&(ce(e),ce(r),ce(i),ce(o),ce(c)),m[a].d(w),f=!1,vn(p)}}}function i9(t,e,n){let r,i=wt,s=()=>(i(),i=ts(a,w=>n(5,r=w)),a),o;fe(t,En,w=>n(6,o=w)),t.$$.on_destroy.push(()=>i());let{targetStore$:a}=e;s();let{label:l}=e,{helpText:c=""}=e,{buttonIcon:u=""}=e,{buttonTitle:f=""}=e;const p=a.key();function y(w){wn.call(this,t,w)}const m=w=>H_(w,a);function g(w){wn.call(this,t,w)}return t.$$set=w=>{"targetStore$"in w&&s(n(0,a=w.targetStore$)),"label"in w&&n(1,l=w.label),"helpText"in w&&n(2,c=w.helpText),"buttonIcon"in w&&n(3,u=w.buttonIcon),"buttonTitle"in w&&n(4,f=w.buttonTitle)},[a,l,c,u,f,r,o,p,y,m,g]}class uc extends In{constructor(e){super(),Pn(this,e,i9,r9,Tn,{targetStore$:0,label:1,helpText:2,buttonIcon:3,buttonTitle:4})}}/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function r2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function qi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r2(Object(n),!0).forEach(function(r){s9(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function cc(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?cc=function(e){return typeof e}:cc=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(t)}function s9(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Zi(){return Zi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Zi.apply(this,arguments)}function o9(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function a9(t,e){if(t==null)return{};var n=o9(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}var l9="1.15.2";function Es(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Ss=Es(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Sl=Es(/Edge/i),i2=Es(/firefox/i),Tl=Es(/safari/i)&&!Es(/chrome/i)&&!Es(/android/i),s2=Es(/iP(ad|od|hone)/i),o2=Es(/chrome/i)&&Es(/android/i),a2={capture:!1,passive:!1};function An(t,e,n){t.addEventListener(e,n,!Ss&&a2)}function yn(t,e,n){t.removeEventListener(e,n,!Ss&&a2)}function fc(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function u9(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Fi(t,e,n,r){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&fc(t,e):fc(t,e))||r&&t===n)return t;if(t===n)break}while(t=u9(t))}return null}var l2=/\s+/g;function Hr(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var r=(" "+t.className+" ").replace(l2," ").replace(" "+e+" "," ");t.className=(r+(n?" "+e:"")).replace(l2," ")}}function Ht(t,e,n){var r=t&&t.style;if(r){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in r)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),r[e]=n+(typeof n=="string"?"":"px")}}function _a(t,e){var n="";if(typeof t=="string")n=t;else do{var r=Ht(t,"transform");r&&r!=="none"&&(n=r+" "+n)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function u2(t,e,n){if(t){var r=t.getElementsByTagName(e),i=0,s=r.length;if(n)for(;i<s;i++)n(r[i],i);return r}return[]}function Ji(){var t=document.scrollingElement;return t||document.documentElement}function _r(t,e,n,r,i){if(!(!t.getBoundingClientRect&&t!==window)){var s,o,a,l,c,u,f;if(t!==window&&t.parentNode&&t!==Ji()?(s=t.getBoundingClientRect(),o=s.top,a=s.left,l=s.bottom,c=s.right,u=s.height,f=s.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,f=window.innerWidth),(e||n)&&t!==window&&(i=i||t.parentNode,!Ss))do if(i&&i.getBoundingClientRect&&(Ht(i,"transform")!=="none"||n&&Ht(i,"position")!=="static")){var p=i.getBoundingClientRect();o-=p.top+parseInt(Ht(i,"border-top-width")),a-=p.left+parseInt(Ht(i,"border-left-width")),l=o+s.height,c=a+s.width;break}while(i=i.parentNode);if(r&&t!==window){var y=_a(i||t),m=y&&y.a,g=y&&y.d;y&&(o/=g,a/=m,f/=m,u/=g,l=o+u,c=a+f)}return{top:o,left:a,bottom:l,right:c,width:f,height:u}}}function c2(t,e,n){for(var r=Vs(t,!0),i=_r(t)[e];r;){var s=_r(r)[n],o=void 0;if(n==="top"||n==="left"?o=i>=s:o=i<=s,!o)return r;if(r===Ji())break;r=Vs(r,!1)}return!1}function ga(t,e,n,r){for(var i=0,s=0,o=t.children;s<o.length;){if(o[s].style.display!=="none"&&o[s]!==Vt.ghost&&(r||o[s]!==Vt.dragged)&&Fi(o[s],n.draggable,t,!1)){if(i===e)return o[s];i++}s++}return null}function P1(t,e){for(var n=t.lastElementChild;n&&(n===Vt.ghost||Ht(n,"display")==="none"||e&&!fc(n,e));)n=n.previousElementSibling;return n||null}function ei(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==Vt.clone&&(!e||fc(t,e))&&n++;return n}function f2(t){var e=0,n=0,r=Ji();if(t)do{var i=_a(t),s=i.a,o=i.d;e+=t.scrollLeft*s,n+=t.scrollTop*o}while(t!==r&&(t=t.parentNode));return[e,n]}function c9(t,e){for(var n in t)if(t.hasOwnProperty(n)){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t[n][r])return Number(n)}return-1}function Vs(t,e){if(!t||!t.getBoundingClientRect)return Ji();var n=t,r=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=Ht(n);if(n.clientWidth<n.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Ji();if(r||e)return n;r=!0}}while(n=n.parentNode);return Ji()}function f9(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function I1(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var kl;function d2(t,e){return function(){if(!kl){var n=arguments,r=this;n.length===1?t.call(r,n[0]):t.apply(r,n),kl=setTimeout(function(){kl=void 0},e)}}}function d9(){clearTimeout(kl),kl=void 0}function h2(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function p2(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function m2(t,e,n){var r={};return Array.from(t.children).forEach(function(i){var s,o,a,l;if(!(!Fi(i,e.draggable,t,!1)||i.animated||i===n)){var c=_r(i);r.left=Math.min((s=r.left)!==null&&s!==void 0?s:1/0,c.left),r.top=Math.min((o=r.top)!==null&&o!==void 0?o:1/0,c.top),r.right=Math.max((a=r.right)!==null&&a!==void 0?a:-1/0,c.right),r.bottom=Math.max((l=r.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var mi="Sortable"+new Date().getTime();function h9(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(i){if(!(Ht(i,"display")==="none"||i===Vt.ghost)){t.push({target:i,rect:_r(i)});var s=qi({},t[t.length-1].rect);if(i.thisAnimationDuration){var o=_a(i,!0);o&&(s.top-=o.f,s.left-=o.e)}i.fromRect=s}})}},addAnimationState:function(r){t.push(r)},removeAnimationState:function(r){t.splice(c9(t,{target:r}),1)},animateAll:function(r){var i=this;if(!this.options.animation){clearTimeout(e),typeof r=="function"&&r();return}var s=!1,o=0;t.forEach(function(a){var l=0,c=a.target,u=c.fromRect,f=_r(c),p=c.prevFromRect,y=c.prevToRect,m=a.rect,g=_a(c,!0);g&&(f.top-=g.f,f.left-=g.e),c.toRect=f,c.thisAnimationDuration&&I1(p,f)&&!I1(u,f)&&(m.top-f.top)/(m.left-f.left)===(u.top-f.top)/(u.left-f.left)&&(l=m9(m,p,y,i.options)),I1(f,u)||(c.prevFromRect=u,c.prevToRect=f,l||(l=i.options.animation),i.animate(c,m,f,l)),l&&(s=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof r=="function"&&r()},o):typeof r=="function"&&r(),t=[]},animate:function(r,i,s,o){if(o){Ht(r,"transition",""),Ht(r,"transform","");var a=_a(this.el),l=a&&a.a,c=a&&a.d,u=(i.left-s.left)/(l||1),f=(i.top-s.top)/(c||1);r.animatingX=!!u,r.animatingY=!!f,Ht(r,"transform","translate3d("+u+"px,"+f+"px,0)"),this.forRepaintDummy=p9(r),Ht(r,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),Ht(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){Ht(r,"transition",""),Ht(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},o)}}}}function p9(t){return t.offsetWidth}function m9(t,e,n,r){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*r.animation}var ba=[],B1={initializeByDefault:!0},Al={mount:function(e){for(var n in B1)B1.hasOwnProperty(n)&&!(n in e)&&(e[n]=B1[n]);ba.forEach(function(r){if(r.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ba.push(e)},pluginEvent:function(e,n,r){var i=this;this.eventCanceled=!1,r.cancel=function(){i.eventCanceled=!0};var s=e+"Global";ba.forEach(function(o){n[o.pluginName]&&(n[o.pluginName][s]&&n[o.pluginName][s](qi({sortable:n},r)),n.options[o.pluginName]&&n[o.pluginName][e]&&n[o.pluginName][e](qi({sortable:n},r)))})},initializePlugins:function(e,n,r,i){ba.forEach(function(a){var l=a.pluginName;if(!(!e.options[l]&&!a.initializeByDefault)){var c=new a(e,n,e.options);c.sortable=e,c.options=e.options,e[l]=c,Zi(r,c.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var o=this.modifyOption(e,s,e.options[s]);typeof o<"u"&&(e.options[s]=o)}},getEventProperties:function(e,n){var r={};return ba.forEach(function(i){typeof i.eventProperties=="function"&&Zi(r,i.eventProperties.call(n[i.pluginName],e))}),r},modifyOption:function(e,n,r){var i;return ba.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[n]=="function"&&(i=s.optionListeners[n].call(e[s.pluginName],r))}),i}};function _9(t){var e=t.sortable,n=t.rootEl,r=t.name,i=t.targetEl,s=t.cloneEl,o=t.toEl,a=t.fromEl,l=t.oldIndex,c=t.newIndex,u=t.oldDraggableIndex,f=t.newDraggableIndex,p=t.originalEvent,y=t.putSortable,m=t.extraEventProperties;if(e=e||n&&n[mi],!!e){var g,w=e.options,_="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!Ss&&!Sl?g=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent(r,!0,!0)),g.to=o||n,g.from=a||n,g.item=i||n,g.clone=s,g.oldIndex=l,g.newIndex=c,g.oldDraggableIndex=u,g.newDraggableIndex=f,g.originalEvent=p,g.pullMode=y?y.lastPutMode:void 0;var b=qi(qi({},m),Al.getEventProperties(r,e));for(var E in b)g[E]=b[E];n&&n.dispatchEvent(g),w[_]&&w[_].call(e,g)}}var g9=["evt"],ti=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.evt,s=a9(r,g9);Al.pluginEvent.bind(Vt)(e,n,qi({dragEl:yt,parentEl:rr,ghostEl:Zt,rootEl:Xn,nextEl:wo,lastDownEl:dc,cloneEl:Zn,cloneHidden:xs,dragStarted:Ml,putSortable:Fr,activeSortable:Vt.active,originalEvent:i,oldIndex:wa,oldDraggableIndex:Cl,newIndex:_i,newDraggableIndex:Hs,hideGhostForTarget:E2,unhideGhostForTarget:S2,cloneNowHidden:function(){xs=!0},cloneNowShown:function(){xs=!1},dispatchSortableEvent:function(a){Yr({sortable:n,name:a,originalEvent:i})}},s))};function Yr(t){_9(qi({putSortable:Fr,cloneEl:Zn,targetEl:yt,rootEl:Xn,oldIndex:wa,oldDraggableIndex:Cl,newIndex:_i,newDraggableIndex:Hs},t))}var yt,rr,Zt,Xn,wo,dc,Zn,xs,wa,_i,Cl,Hs,hc,Fr,ya=!1,pc=!1,mc=[],yo,$i,O1,D1,_2,g2,Ml,va,Rl,Ll=!1,_c=!1,gc,Ur,N1=[],F1=!1,bc=[],wc=typeof document<"u",yc=s2,b2=Sl||Ss?"cssFloat":"float",b9=wc&&!o2&&!s2&&"draggable"in document.createElement("div"),w2=function(){if(wc){if(Ss)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),y2=function(e,n){var r=Ht(e),i=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),s=ga(e,0,n),o=ga(e,1,n),a=s&&Ht(s),l=o&&Ht(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+_r(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+_r(o).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&a.float&&a.float!=="none"){var f=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===f)?"vertical":"horizontal"}return s&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=i&&r[b2]==="none"||o&&r[b2]==="none"&&c+u>i)?"vertical":"horizontal"},w9=function(e,n,r){var i=r?e.left:e.top,s=r?e.right:e.bottom,o=r?e.width:e.height,a=r?n.left:n.top,l=r?n.right:n.bottom,c=r?n.width:n.height;return i===a||s===l||i+o/2===a+c/2},y9=function(e,n){var r;return mc.some(function(i){var s=i[mi].options.emptyInsertThreshold;if(!(!s||P1(i))){var o=_r(i),a=e>=o.left-s&&e<=o.right+s,l=n>=o.top-s&&n<=o.bottom+s;if(a&&l)return r=i}}),r},v2=function(e){function n(s,o){return function(a,l,c,u){var f=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(s==null&&(o||f))return!0;if(s==null||s===!1)return!1;if(o&&s==="clone")return s;if(typeof s=="function")return n(s(a,l,c,u),o)(a,l,c,u);var p=(o?a:l).options.group.name;return s===!0||typeof s=="string"&&s===p||s.join&&s.indexOf(p)>-1}}var r={},i=e.group;(!i||cc(i)!="object")&&(i={name:i}),r.name=i.name,r.checkPull=n(i.pull,!0),r.checkPut=n(i.put),r.revertClone=i.revertClone,e.group=r},E2=function(){!w2&&Zt&&Ht(Zt,"display","none")},S2=function(){!w2&&Zt&&Ht(Zt,"display","")};wc&&!o2&&document.addEventListener("click",function(t){if(pc)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),pc=!1,!1},!0);var vo=function(e){if(yt){e=e.touches?e.touches[0]:e;var n=y9(e.clientX,e.clientY);if(n){var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);r.target=r.rootEl=n,r.preventDefault=void 0,r.stopPropagation=void 0,n[mi]._onDragOver(r)}}},v9=function(e){yt&&yt.parentNode[mi]._isOutsideThisEl(e.target)};function Vt(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Zi({},e),t[mi]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return y2(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Vt.supportPointer!==!1&&"PointerEvent"in window&&!Tl,emptyInsertThreshold:5};Al.initializePlugins(this,t,n);for(var r in n)!(r in e)&&(e[r]=n[r]);v2(e);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=e.forceFallback?!1:b9,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?An(t,"pointerdown",this._onTapStart):(An(t,"mousedown",this._onTapStart),An(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(An(t,"dragover",this),An(t,"dragenter",this)),mc.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Zi(this,h9())}Vt.prototype={constructor:Vt,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(va=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,yt):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,r=this.el,i=this.options,s=i.preventOnFilter,o=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(a||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=i.filter;if(R9(r),!yt&&!(/mousedown|pointerdown/.test(o)&&e.button!==0||i.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Tl&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Fi(l,i.draggable,r,!1),!(l&&l.animated)&&dc!==l)){if(wa=ei(l),Cl=ei(l,i.draggable),typeof u=="function"){if(u.call(this,e,l,this)){Yr({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:r,fromEl:r}),ti("filter",n,{evt:e}),s&&e.cancelable&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(f){if(f=Fi(c,f.trim(),r,!1),f)return Yr({sortable:n,rootEl:f,name:"filter",targetEl:l,fromEl:r,toEl:r}),ti("filter",n,{evt:e}),!0}),u)){s&&e.cancelable&&e.preventDefault();return}i.handle&&!Fi(c,i.handle,r,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(e,n,r){var i=this,s=i.el,o=i.options,a=s.ownerDocument,l;if(r&&!yt&&r.parentNode===s){var c=_r(r);if(Xn=s,yt=r,rr=yt.parentNode,wo=yt.nextSibling,dc=r,hc=o.group,Vt.dragged=yt,yo={target:yt,clientX:(n||e).clientX,clientY:(n||e).clientY},_2=yo.clientX-c.left,g2=yo.clientY-c.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,yt.style["will-change"]="all",l=function(){if(ti("delayEnded",i,{evt:e}),Vt.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!i2&&i.nativeDraggable&&(yt.draggable=!0),i._triggerDragStart(e,n),Yr({sortable:i,name:"choose",originalEvent:e}),Hr(yt,o.chosenClass,!0)},o.ignore.split(",").forEach(function(u){u2(yt,u.trim(),$1)}),An(a,"dragover",vo),An(a,"mousemove",vo),An(a,"touchmove",vo),An(a,"mouseup",i._onDrop),An(a,"touchend",i._onDrop),An(a,"touchcancel",i._onDrop),i2&&this.nativeDraggable&&(this.options.touchStartThreshold=4,yt.draggable=!0),ti("delayStart",this,{evt:e}),o.delay&&(!o.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Sl||Ss))){if(Vt.eventCanceled){this._onDrop();return}An(a,"mouseup",i._disableDelayedDrag),An(a,"touchend",i._disableDelayedDrag),An(a,"touchcancel",i._disableDelayedDrag),An(a,"mousemove",i._delayedDragTouchMoveHandler),An(a,"touchmove",i._delayedDragTouchMoveHandler),o.supportPointer&&An(a,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){yt&&$1(yt),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;yn(e,"mouseup",this._disableDelayedDrag),yn(e,"touchend",this._disableDelayedDrag),yn(e,"touchcancel",this._disableDelayedDrag),yn(e,"mousemove",this._delayedDragTouchMoveHandler),yn(e,"touchmove",this._delayedDragTouchMoveHandler),yn(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?An(document,"pointermove",this._onTouchMove):n?An(document,"touchmove",this._onTouchMove):An(document,"mousemove",this._onTouchMove):(An(yt,"dragend",this),An(Xn,"dragstart",this._onDragStart));try{document.selection?Ec(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(ya=!1,Xn&&yt){ti("dragStarted",this,{evt:n}),this.nativeDraggable&&An(document,"dragover",v9);var r=this.options;!e&&Hr(yt,r.dragClass,!1),Hr(yt,r.ghostClass,!0),Vt.active=this,e&&this._appendGhost(),Yr({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if($i){this._lastX=$i.clientX,this._lastY=$i.clientY,E2();for(var e=document.elementFromPoint($i.clientX,$i.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint($i.clientX,$i.clientY),e!==n);)n=e;if(yt.parentNode[mi]._isOutsideThisEl(e),n)do{if(n[mi]){var r=void 0;if(r=n[mi]._onDragOver({clientX:$i.clientX,clientY:$i.clientY,target:e,rootEl:n}),r&&!this.options.dragoverBubble)break}e=n}while(n=n.parentNode);S2()}},_onTouchMove:function(e){if(yo){var n=this.options,r=n.fallbackTolerance,i=n.fallbackOffset,s=e.touches?e.touches[0]:e,o=Zt&&_a(Zt,!0),a=Zt&&o&&o.a,l=Zt&&o&&o.d,c=yc&&Ur&&f2(Ur),u=(s.clientX-yo.clientX+i.x)/(a||1)+(c?c[0]-N1[0]:0)/(a||1),f=(s.clientY-yo.clientY+i.y)/(l||1)+(c?c[1]-N1[1]:0)/(l||1);if(!Vt.active&&!ya){if(r&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}if(Zt){o?(o.e+=u-(O1||0),o.f+=f-(D1||0)):o={a:1,b:0,c:0,d:1,e:u,f};var p="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");Ht(Zt,"webkitTransform",p),Ht(Zt,"mozTransform",p),Ht(Zt,"msTransform",p),Ht(Zt,"transform",p),O1=u,D1=f,$i=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Zt){var e=this.options.fallbackOnBody?document.body:Xn,n=_r(yt,!0,yc,!0,e),r=this.options;if(yc){for(Ur=e;Ht(Ur,"position")==="static"&&Ht(Ur,"transform")==="none"&&Ur!==document;)Ur=Ur.parentNode;Ur!==document.body&&Ur!==document.documentElement?(Ur===document&&(Ur=Ji()),n.top+=Ur.scrollTop,n.left+=Ur.scrollLeft):Ur=Ji(),N1=f2(Ur)}Zt=yt.cloneNode(!0),Hr(Zt,r.ghostClass,!1),Hr(Zt,r.fallbackClass,!0),Hr(Zt,r.dragClass,!0),Ht(Zt,"transition",""),Ht(Zt,"transform",""),Ht(Zt,"box-sizing","border-box"),Ht(Zt,"margin",0),Ht(Zt,"top",n.top),Ht(Zt,"left",n.left),Ht(Zt,"width",n.width),Ht(Zt,"height",n.height),Ht(Zt,"opacity","0.8"),Ht(Zt,"position",yc?"absolute":"fixed"),Ht(Zt,"zIndex","100000"),Ht(Zt,"pointerEvents","none"),Vt.ghost=Zt,e.appendChild(Zt),Ht(Zt,"transform-origin",_2/parseInt(Zt.style.width)*100+"% "+g2/parseInt(Zt.style.height)*100+"%")}},_onDragStart:function(e,n){var r=this,i=e.dataTransfer,s=r.options;if(ti("dragStart",this,{evt:e}),Vt.eventCanceled){this._onDrop();return}ti("setupClone",this),Vt.eventCanceled||(Zn=p2(yt),Zn.removeAttribute("id"),Zn.draggable=!1,Zn.style["will-change"]="",this._hideClone(),Hr(Zn,this.options.chosenClass,!1),Vt.clone=Zn),r.cloneId=Ec(function(){ti("clone",r),!Vt.eventCanceled&&(r.options.removeCloneOnHide||Xn.insertBefore(Zn,yt),r._hideClone(),Yr({sortable:r,name:"clone"}))}),!n&&Hr(yt,s.dragClass,!0),n?(pc=!0,r._loopId=setInterval(r._emulateDragOver,50)):(yn(document,"mouseup",r._onDrop),yn(document,"touchend",r._onDrop),yn(document,"touchcancel",r._onDrop),i&&(i.effectAllowed="move",s.setData&&s.setData.call(r,i,yt)),An(document,"drop",r),Ht(yt,"transform","translateZ(0)")),ya=!0,r._dragStartId=Ec(r._dragStarted.bind(r,n,e)),An(document,"selectstart",r),Ml=!0,Tl&&Ht(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,r=e.target,i,s,o,a=this.options,l=a.group,c=Vt.active,u=hc===l,f=a.sort,p=Fr||c,y,m=this,g=!1;if(F1)return;function w(K,Q){ti(K,m,qi({evt:e,isOwner:u,axis:y?"vertical":"horizontal",revert:o,dragRect:i,targetRect:s,canSort:f,fromSortable:p,target:r,completed:b,onMove:function(O,C){return vc(Xn,n,yt,i,O,_r(O),e,C)},changed:E},Q))}function _(){w("dragOverAnimationCapture"),m.captureAnimationState(),m!==p&&p.captureAnimationState()}function b(K){return w("dragOverCompleted",{insertion:K}),K&&(u?c._hideClone():c._showClone(m),m!==p&&(Hr(yt,Fr?Fr.options.ghostClass:c.options.ghostClass,!1),Hr(yt,a.ghostClass,!0)),Fr!==m&&m!==Vt.active?Fr=m:m===Vt.active&&Fr&&(Fr=null),p===m&&(m._ignoreWhileAnimating=r),m.animateAll(function(){w("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(r===yt&&!yt.animated||r===n&&!r.animated)&&(va=null),!a.dragoverBubble&&!e.rootEl&&r!==document&&(yt.parentNode[mi]._isOutsideThisEl(e.target),!K&&vo(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function E(){_i=ei(yt),Hs=ei(yt,a.draggable),Yr({sortable:m,name:"change",toEl:n,newIndex:_i,newDraggableIndex:Hs,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),r=Fi(r,a.draggable,n,!0),w("dragOver"),Vt.eventCanceled)return g;if(yt.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||m._ignoreWhileAnimating===r)return b(!1);if(pc=!1,c&&!a.disabled&&(u?f||(o=rr!==Xn):Fr===this||(this.lastPutMode=hc.checkPull(this,c,yt,e))&&l.checkPut(this,c,yt,e))){if(y=this._getDirection(e,r)==="vertical",i=_r(yt),w("dragOverValid"),Vt.eventCanceled)return g;if(o)return rr=Xn,_(),this._hideClone(),w("revert"),Vt.eventCanceled||(wo?Xn.insertBefore(yt,wo):Xn.appendChild(yt)),b(!0);var R=P1(n,a.draggable);if(!R||k9(e,y,this)&&!R.animated){if(R===yt)return b(!1);if(R&&n===e.target&&(r=R),r&&(s=_r(r)),vc(Xn,n,yt,i,r,s,e,!!r)!==!1)return _(),R&&R.nextSibling?n.insertBefore(yt,R.nextSibling):n.appendChild(yt),rr=n,E(),b(!0)}else if(R&&T9(e,y,this)){var h=ga(n,0,a,!0);if(h===yt)return b(!1);if(r=h,s=_r(r),vc(Xn,n,yt,i,r,s,e,!1)!==!1)return _(),n.insertBefore(yt,h),rr=n,E(),b(!0)}else if(r.parentNode===n){s=_r(r);var k=0,L,$=yt.parentNode!==n,P=!w9(yt.animated&&yt.toRect||i,r.animated&&r.toRect||s,y),I=y?"top":"left",H=c2(r,"top","top")||c2(yt,"top","top"),ae=H?H.scrollTop:void 0;va!==r&&(L=s[I],Ll=!1,_c=!P&&a.invertSwap||$),k=A9(e,r,s,y,P?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,_c,va===r);var V;if(k!==0){var v=ei(yt);do v-=k,V=rr.children[v];while(V&&(Ht(V,"display")==="none"||V===Zt))}if(k===0||V===r)return b(!1);va=r,Rl=k;var D=r.nextElementSibling,F=!1;F=k===1;var Y=vc(Xn,n,yt,i,r,s,e,F);if(Y!==!1)return(Y===1||Y===-1)&&(F=Y===1),F1=!0,setTimeout(S9,30),_(),F&&!D?n.appendChild(yt):r.parentNode.insertBefore(yt,F?D:r),H&&h2(H,0,ae-H.scrollTop),rr=yt.parentNode,L!==void 0&&!_c&&(gc=Math.abs(L-_r(r)[I])),E(),b(!0)}if(n.contains(yt))return b(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){yn(document,"mousemove",this._onTouchMove),yn(document,"touchmove",this._onTouchMove),yn(document,"pointermove",this._onTouchMove),yn(document,"dragover",vo),yn(document,"mousemove",vo),yn(document,"touchmove",vo)},_offUpEvents:function(){var e=this.el.ownerDocument;yn(e,"mouseup",this._onDrop),yn(e,"touchend",this._onDrop),yn(e,"pointerup",this._onDrop),yn(e,"touchcancel",this._onDrop),yn(document,"selectstart",this)},_onDrop:function(e){var n=this.el,r=this.options;if(_i=ei(yt),Hs=ei(yt,r.draggable),ti("drop",this,{evt:e}),rr=yt&&yt.parentNode,_i=ei(yt),Hs=ei(yt,r.draggable),Vt.eventCanceled){this._nulling();return}ya=!1,_c=!1,Ll=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),V1(this.cloneId),V1(this._dragStartId),this.nativeDraggable&&(yn(document,"drop",this),yn(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Tl&&Ht(document.body,"user-select",""),Ht(yt,"transform",""),e&&(Ml&&(e.cancelable&&e.preventDefault(),!r.dropBubble&&e.stopPropagation()),Zt&&Zt.parentNode&&Zt.parentNode.removeChild(Zt),(Xn===rr||Fr&&Fr.lastPutMode!=="clone")&&Zn&&Zn.parentNode&&Zn.parentNode.removeChild(Zn),yt&&(this.nativeDraggable&&yn(yt,"dragend",this),$1(yt),yt.style["will-change"]="",Ml&&!ya&&Hr(yt,Fr?Fr.options.ghostClass:this.options.ghostClass,!1),Hr(yt,this.options.chosenClass,!1),Yr({sortable:this,name:"unchoose",toEl:rr,newIndex:null,newDraggableIndex:null,originalEvent:e}),Xn!==rr?(_i>=0&&(Yr({rootEl:rr,name:"add",toEl:rr,fromEl:Xn,originalEvent:e}),Yr({sortable:this,name:"remove",toEl:rr,originalEvent:e}),Yr({rootEl:rr,name:"sort",toEl:rr,fromEl:Xn,originalEvent:e}),Yr({sortable:this,name:"sort",toEl:rr,originalEvent:e})),Fr&&Fr.save()):_i!==wa&&_i>=0&&(Yr({sortable:this,name:"update",toEl:rr,originalEvent:e}),Yr({sortable:this,name:"sort",toEl:rr,originalEvent:e})),Vt.active&&((_i==null||_i===-1)&&(_i=wa,Hs=Cl),Yr({sortable:this,name:"end",toEl:rr,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ti("nulling",this),Xn=yt=rr=Zt=wo=Zn=dc=xs=yo=$i=Ml=_i=Hs=wa=Cl=va=Rl=Fr=hc=Vt.dragged=Vt.ghost=Vt.clone=Vt.active=null,bc.forEach(function(e){e.checked=!0}),bc.length=O1=D1=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":yt&&(this._onDragOver(e),E9(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,r=this.el.children,i=0,s=r.length,o=this.options;i<s;i++)n=r[i],Fi(n,o.draggable,this.el,!1)&&e.push(n.getAttribute(o.dataIdAttr)||M9(n));return e},sort:function(e,n){var r={},i=this.el;this.toArray().forEach(function(s,o){var a=i.children[o];Fi(a,this.options.draggable,i,!1)&&(r[s]=a)},this),n&&this.captureAnimationState(),e.forEach(function(s){r[s]&&(i.removeChild(r[s]),i.appendChild(r[s]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return Fi(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var r=this.options;if(n===void 0)return r[e];var i=Al.modifyOption(this,e,n);typeof i<"u"?r[e]=i:r[e]=n,e==="group"&&v2(r)},destroy:function(){ti("destroy",this);var e=this.el;e[mi]=null,yn(e,"mousedown",this._onTapStart),yn(e,"touchstart",this._onTapStart),yn(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(yn(e,"dragover",this),yn(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),mc.splice(mc.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!xs){if(ti("hideClone",this),Vt.eventCanceled)return;Ht(Zn,"display","none"),this.options.removeCloneOnHide&&Zn.parentNode&&Zn.parentNode.removeChild(Zn),xs=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(xs){if(ti("showClone",this),Vt.eventCanceled)return;yt.parentNode==Xn&&!this.options.group.revertClone?Xn.insertBefore(Zn,yt):wo?Xn.insertBefore(Zn,wo):Xn.appendChild(Zn),this.options.group.revertClone&&this.animate(yt,Zn),Ht(Zn,"display",""),xs=!1}}};function E9(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function vc(t,e,n,r,i,s,o,a){var l,c=t[mi],u=c.options.onMove,f;return window.CustomEvent&&!Ss&&!Sl?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=n,l.draggedRect=r,l.related=i||e,l.relatedRect=s||_r(e),l.willInsertAfter=a,l.originalEvent=o,t.dispatchEvent(l),u&&(f=u.call(c,l,o)),f}function $1(t){t.draggable=!1}function S9(){F1=!1}function T9(t,e,n){var r=_r(ga(n.el,0,n.options,!0)),i=m2(n.el,n.options,Zt),s=10;return e?t.clientX<i.left-s||t.clientY<r.top&&t.clientX<r.right:t.clientY<i.top-s||t.clientY<r.bottom&&t.clientX<r.left}function k9(t,e,n){var r=_r(P1(n.el,n.options.draggable)),i=m2(n.el,n.options,Zt),s=10;return e?t.clientX>i.right+s||t.clientY>r.bottom&&t.clientX>r.left:t.clientY>i.bottom+s||t.clientX>r.right&&t.clientY>r.top}function A9(t,e,n,r,i,s,o,a){var l=r?t.clientY:t.clientX,c=r?n.height:n.width,u=r?n.top:n.left,f=r?n.bottom:n.right,p=!1;if(!o){if(a&&gc<c*i){if(!Ll&&(Rl===1?l>u+c*s/2:l<f-c*s/2)&&(Ll=!0),Ll)p=!0;else if(Rl===1?l<u+gc:l>f-gc)return-Rl}else if(l>u+c*(1-i)/2&&l<f-c*(1-i)/2)return C9(e)}return p=p||o,p&&(l<u+c*s/2||l>f-c*s/2)?l>u+c/2?1:-1:0}function C9(t){return ei(yt)<ei(t)?1:-1}function M9(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,r=0;n--;)r+=e.charCodeAt(n);return r.toString(36)}function R9(t){bc.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var r=e[n];r.checked&&bc.push(r)}}function Ec(t){return setTimeout(t,0)}function V1(t){return clearTimeout(t)}wc&&An(document,"touchmove",function(t){(Vt.active||ya)&&t.cancelable&&t.preventDefault()}),Vt.utils={on:An,off:yn,css:Ht,find:u2,is:function(e,n){return!!Fi(e,n,e,!1)},extend:f9,throttle:d2,closest:Fi,toggleClass:Hr,clone:p2,index:ei,nextTick:Ec,cancelNextTick:V1,detectDirection:y2,getChild:ga},Vt.get=function(t){return t[mi]},Vt.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(Vt.utils=qi(qi({},Vt.utils),r.utils)),Al.mount(r)})},Vt.create=function(t,e){return new Vt(t,e)},Vt.version=l9;var gr=[],Pl,x1,H1=!1,U1,W1,Sc,Il;function L9(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(n){var r=n.originalEvent;this.sortable.nativeDraggable?An(document,"dragover",this._handleAutoScroll):this.options.supportPointer?An(document,"pointermove",this._handleFallbackAutoScroll):r.touches?An(document,"touchmove",this._handleFallbackAutoScroll):An(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var r=n.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?yn(document,"dragover",this._handleAutoScroll):(yn(document,"pointermove",this._handleFallbackAutoScroll),yn(document,"touchmove",this._handleFallbackAutoScroll),yn(document,"mousemove",this._handleFallbackAutoScroll)),T2(),Tc(),d9()},nulling:function(){Sc=x1=Pl=H1=Il=U1=W1=null,gr.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,r){var i=this,s=(n.touches?n.touches[0]:n).clientX,o=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(s,o);if(Sc=n,r||this.options.forceAutoScrollFallback||Sl||Ss||Tl){j1(n,this.options,a,r);var l=Vs(a,!0);H1&&(!Il||s!==U1||o!==W1)&&(Il&&T2(),Il=setInterval(function(){var c=Vs(document.elementFromPoint(s,o),!0);c!==l&&(l=c,Tc()),j1(n,i.options,c,r)},10),U1=s,W1=o)}else{if(!this.options.bubbleScroll||Vs(a,!0)===Ji()){Tc();return}j1(n,this.options,Vs(a,!1),!1)}}},Zi(t,{pluginName:"scroll",initializeByDefault:!0})}function Tc(){gr.forEach(function(t){clearInterval(t.pid)}),gr=[]}function T2(){clearInterval(Il)}var j1=d2(function(t,e,n,r){if(e.scroll){var i=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,o=e.scrollSensitivity,a=e.scrollSpeed,l=Ji(),c=!1,u;x1!==n&&(x1=n,Tc(),Pl=e.scroll,u=e.scrollFn,Pl===!0&&(Pl=Vs(n,!0)));var f=0,p=Pl;do{var y=p,m=_r(y),g=m.top,w=m.bottom,_=m.left,b=m.right,E=m.width,R=m.height,h=void 0,k=void 0,L=y.scrollWidth,$=y.scrollHeight,P=Ht(y),I=y.scrollLeft,H=y.scrollTop;y===l?(h=E<L&&(P.overflowX==="auto"||P.overflowX==="scroll"||P.overflowX==="visible"),k=R<$&&(P.overflowY==="auto"||P.overflowY==="scroll"||P.overflowY==="visible")):(h=E<L&&(P.overflowX==="auto"||P.overflowX==="scroll"),k=R<$&&(P.overflowY==="auto"||P.overflowY==="scroll"));var ae=h&&(Math.abs(b-i)<=o&&I+E<L)-(Math.abs(_-i)<=o&&!!I),V=k&&(Math.abs(w-s)<=o&&H+R<$)-(Math.abs(g-s)<=o&&!!H);if(!gr[f])for(var v=0;v<=f;v++)gr[v]||(gr[v]={});(gr[f].vx!=ae||gr[f].vy!=V||gr[f].el!==y)&&(gr[f].el=y,gr[f].vx=ae,gr[f].vy=V,clearInterval(gr[f].pid),(ae!=0||V!=0)&&(c=!0,gr[f].pid=setInterval((function(){r&&this.layer===0&&Vt.active._onTouchMove(Sc);var D=gr[this.layer].vy?gr[this.layer].vy*a:0,F=gr[this.layer].vx?gr[this.layer].vx*a:0;typeof u=="function"&&u.call(Vt.dragged.parentNode[mi],F,D,t,Sc,gr[this.layer].el)!=="continue"||h2(gr[this.layer].el,F,D)}).bind({layer:f}),24))),f++}while(e.bubbleScroll&&p!==l&&(p=Vs(p,!1)));H1=c}},30),k2=function(e){var n=e.originalEvent,r=e.putSortable,i=e.dragEl,s=e.activeSortable,o=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(n){var c=r||s;a();var u=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,f=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(f)&&(o("spill"),this.onSpill({dragEl:i,putSortable:r}))}};function G1(){}G1.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,r=e.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var i=ga(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(n,i):this.sortable.el.appendChild(n),this.sortable.animateAll(),r&&r.animateAll()},drop:k2},Zi(G1,{pluginName:"revertOnSpill"});function z1(){}z1.prototype={onSpill:function(e){var n=e.dragEl,r=e.putSortable,i=r||this.sortable;i.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),i.animateAll()},drop:k2},Zi(z1,{pluginName:"removeOnSpill"});var Ti;function P9(){function t(){this.defaults={swapClass:"sortable-swap-highlight"}}return t.prototype={dragStart:function(n){var r=n.dragEl;Ti=r},dragOverValid:function(n){var r=n.completed,i=n.target,s=n.onMove,o=n.activeSortable,a=n.changed,l=n.cancel;if(o.options.swap){var c=this.sortable.el,u=this.options;if(i&&i!==c){var f=Ti;s(i)!==!1?(Hr(i,u.swapClass,!0),Ti=i):Ti=null,f&&f!==Ti&&Hr(f,u.swapClass,!1)}a(),r(!0),l()}},drop:function(n){var r=n.activeSortable,i=n.putSortable,s=n.dragEl,o=i||this.sortable,a=this.options;Ti&&Hr(Ti,a.swapClass,!1),Ti&&(a.swap||i&&i.options.swap)&&s!==Ti&&(o.captureAnimationState(),o!==r&&r.captureAnimationState(),I9(s,Ti),o.animateAll(),o!==r&&r.animateAll())},nulling:function(){Ti=null}},Zi(t,{pluginName:"swap",eventProperties:function(){return{swapItem:Ti}}})}function I9(t,e){var n=t.parentNode,r=e.parentNode,i,s;!n||!r||n.isEqualNode(e)||r.isEqualNode(t)||(i=ei(t),s=ei(e),n.isEqualNode(r)&&i<s&&s++,n.insertBefore(e,n.children[i]),r.insertBefore(t,r.children[s]))}Vt.mount(new L9),Vt.mount(z1,G1);function A2(t,e,n){const r=t.slice();return r[13]=e[n],r[14]=e,r[15]=n,r}function C2(t,e){let n,r=e[13].action+"",i,s,o,a,l,c,u,f;function p(){e[9].call(a,e[14],e[15])}return{key:t,first:null,c(){n=ge("div"),i=Ft(r),s=me(),o=ge("div"),a=ge("input"),l=me(),re(a,"type","checkbox"),re(o,"class","disable-sort"),re(n,"class","sortable-list-item"),re(n,"data-id",c=e[13].action),this.first=n},m(y,m){de(y,n,m),oe(n,i),oe(n,s),oe(n,o),oe(o,a),a.checked=e[13].enabled,oe(n,l),u||(f=[Ke(a,"change",p),Ke(a,"change",e[4])],u=!0)},p(y,m){e=y,m&2&&r!==(r=e[13].action+"")&&ln(i,r),m&2&&(a.checked=e[13].enabled),m&2&&c!==(c=e[13].action)&&re(n,"data-id",c)},d(y){y&&ce(n),u=!1,vn(f)}}}function B9(t){let e,n,r,i,s,o,a,l,c,u,f,p=[],y=new Map,m,g,w;r=new Tt({props:{path:ag}}),o=new Tt({props:{path:fg}}),o.$on("click",t[8]),c=new Tt({props:{path:qo}}),c.$on("click",t[3]);let _=Kr(t[1]);const b=E=>E[13].action;for(let E=0;E<_.length;E+=1){let R=A2(t,_,E),h=b(R);y.set(h,p[E]=C2(h,R))}return{c(){e=ge("div"),n=ge("button"),ve(r.$$.fragment),i=me(),s=ge("button"),ve(o.$$.fragment),a=me(),l=ge("button"),ve(c.$$.fragment),u=me(),f=ge("div");for(let E=0;E<p.length;E+=1)p[E].c();re(n,"title","Select all"),re(n,"class","m-r-s"),re(s,"title","Remove all"),re(s,"class","m-r-s"),re(l,"title","Restore defaults"),re(e,"class","sortable-list-icons"),re(f,"class","sortable-list-container")},m(E,R){de(E,e,R),oe(e,n),we(r,n,null),oe(e,i),oe(e,s),we(o,s,null),oe(e,a),oe(e,l),we(c,l,null),de(E,u,R),de(E,f,R);for(let h=0;h<p.length;h+=1)p[h]&&p[h].m(f,null);t[10](f),m=!0,g||(w=Ke(n,"click",t[7]),g=!0)},p(E,[R]){R&18&&(_=Kr(E[1]),p=Ks(p,R,b,1,E,_,y,f,Pa,C2,null,A2))},i(E){m||(J(r.$$.fragment,E),J(o.$$.fragment,E),J(c.$$.fragment,E),m=!0)},o(E){ne(r.$$.fragment,E),ne(o.$$.fragment,E),ne(c.$$.fragment,E),m=!1},d(E){E&&(ce(e),ce(u),ce(f)),ye(r),ye(o),ye(c);for(let R=0;R<p.length;R+=1)p[R].d();t[10](null),g=!1,w()}}}function O9(t,e,n){let{actionList:r}=e,{defaultActions:i}=e,s,o,a=[];La(()=>{const w=[...i.entries()],_=new Set,b=[];for(let E=0,{length:R}=r;E<R;E+=1){const{action:h,enabled:k}=r[E];i.has(h)&&(b.push({action:h,enabled:k}),_.add(h))}for(let E=0,{length:R}=w;E<R;E+=1){const[h,k]=w[E];_.has(h)||(b.push({action:h,enabled:k}),_.add(h))}n(1,a=b);try{Vt.mount(new P9)}catch{}return o=Vt.create(s,{swap:!0,swapClass:"swap",animation:150,filter:".disable-sort",store:{get:()=>[..._],set:u}}),()=>{o.destroy()}});function l(w){const _=f();n(1,a=_.map(b=>({action:b.action,enabled:w}))),n(5,r=a)}function c(){const w=[],_=[...i.entries()];for(let b=0,{length:E}=_;b<E;b+=1){const[R,h]=_[b];w.push({action:R,enabled:h})}n(1,a=w),n(5,r=w),o.sort([...i.keys()],!1)}function u(){n(5,r=f())}function f(){const w=o.toArray();return a.slice().sort((_,b)=>w.indexOf(_.action)-w.indexOf(b.action))}const p=()=>l(!0),y=()=>l(!1);function m(w,_){w[_].enabled=this.checked,n(1,a)}function g(w){$t[w?"unshift":"push"](()=>{s=w,n(0,s)})}return t.$$set=w=>{"actionList"in w&&n(5,r=w.actionList),"defaultActions"in w&&n(6,i=w.defaultActions)},[s,a,l,c,u,r,i,p,y,m,g]}class X1 extends In{constructor(e){super(),Pn(this,e,O9,B9,Tn,{actionList:5,defaultActions:6})}}const{Map:D9}=Ic;function M2(t,e,n){const r=t.slice();return r[147]=e[n],r}function R2(t){let e,n;return e=new Hn({props:{label:"Enable auto reload",helpText:"If enabled the reader will attempt to reload last used files from filesystem automatically without the need for opening the side menu",targetStore$:_t.readerEnableAutoReload$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function N9(t){let e,n;return e=new Hn({props:{label:"Enable filesystem api",helpText:"If enabled the reader will use the filsystem api for storing and reading files",targetStore$:_t.readerEnableFilesystemApi$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function L2(t){let e,n;return e=new Hn({props:{label:"Enable tracker pause",helpText:"If enabled user triggered changes to the playback position (e. g. click action, player controls etc.) will auto pause and unpause the reading tracker",targetStore$:_t.readerEnableTrackerAutoPause$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function P2(t){let e,n;return e=new Hn({props:{label:"Prevent action on selection",helpText:"If enabled click/hold will not execute any action / open the reader menu in case any text is selected",targetStore$:_t.readerPreventActionOnSelection$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function I2(t){let e,n;return e=new Hn({props:{label:"Enable menu target",helpText:"If enabled keybindings will prioritize the active menu subtitle over the current played one",targetStore$:_t.readerEnableMenuTarget$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function B2(t){let e,n,r,i;return e=new Br({props:{label:"Continuous scroll",helpText:t[11],targetStore$:t[57],options:t[43]}}),r=new Br({props:{label:"Scroll behavior",helpText:"Determines the used scroll animation",targetStore$:_t.readerScrollBehavior$,options:t[44]}}),{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment)},m(s,o){we(e,s,o),de(s,n,o),we(r,s,o),i=!0},p(s,o){const a={};o[0]&2048&&(a.helpText=s[11]),e.$set(a)},i(s){i||(J(e.$$.fragment,s),J(r.$$.fragment,s),i=!0)},o(s){ne(e.$$.fragment,s),ne(r.$$.fragment,s),i=!1},d(s){s&&ce(n),ye(e,s),ye(r,s)}}}function O2(t){let e,n;return e=new Br({props:{label:"Click Action",helpText:"Determines the action executed when clicking on book text - requires matched book/line and subtitle/audio file",targetStore$:_t.readerClickAction$,options:t[42]}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p:wt,i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function D2(t){let e,n;return e=new Br({props:{label:"Menu pause",helpText:"Determines if playback is automatilcally paused when opening the reader menu or not",targetStore$:_t.readerMenuPauseMode$,options:t[46]}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p:wt,i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function N2(t){let e,n;return e=new Xr({props:{label:"Menu open time",helpText:"# of ms to hold down on book text to open the reader menu - requires matched book/line. If released earlier the configured click action is executed instead",targetStore$:_t.readerMenuOpenTime$,min:100}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function F9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k;e=new e2({props:{label:"Line highlight",targetStore$:t[52]}}),e.$on("change",t[96]),e.$on("reset",t[96]),r=new e2({props:{label:"Line text color",targetStore$:t[53]}}),r.$on("change",t[96]),r.$on("reset",t[96]),s=new Hn({props:{label:"Enable line highlight",helpText:"If enabled active subtitles will be highlighted in the reader - requires matched book/line and subtitle/audio file",targetStore$:t[54]}}),a=new Hn({props:{label:"Enable line text highlight",helpText:"If enabled text of active subtitles will be highlighted in the reader - requires matched book/line and subtitle/audio file",targetStore$:t[55]}});let L=t[12]&&R2(),$=t[41]&&N9();f=new Hn({props:{label:"Enable auto scroll",helpText:"If enabled the reader will automatically scroll to active subtitles - requires matched book/line and subtitle/audio file",targetStore$:t[56]}});let P=t[13]&&L2(),I=(t[14]!==Be.NONE||t[15]!==er.DISABLED)&&P2(),H=t[15]!==er.DISABLED&&I2(),ae=t[13]&&B2(t),V=t[15]!==er.CLICK&&O2(t);b=new Br({props:{label:"Menu mode",helpText:"Determines the action for opening the reader menu - requires matched book/line",targetStore$:t[59],options:t[45]}});let v=t[15]!==er.DISABLED&&D2(t),D=t[15]===er.HOLD&&N2();return{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),L&&L.c(),c=me(),$&&$.c(),u=me(),ve(f.$$.fragment),p=me(),P&&P.c(),y=me(),I&&I.c(),m=me(),H&&H.c(),g=me(),ae&&ae.c(),w=me(),V&&V.c(),_=me(),ve(b.$$.fragment),E=me(),v&&v.c(),R=me(),D&&D.c(),h=Dr()},m(F,Y){we(e,F,Y),de(F,n,Y),we(r,F,Y),de(F,i,Y),we(s,F,Y),de(F,o,Y),we(a,F,Y),de(F,l,Y),L&&L.m(F,Y),de(F,c,Y),$&&$.m(F,Y),de(F,u,Y),we(f,F,Y),de(F,p,Y),P&&P.m(F,Y),de(F,y,Y),I&&I.m(F,Y),de(F,m,Y),H&&H.m(F,Y),de(F,g,Y),ae&&ae.m(F,Y),de(F,w,Y),V&&V.m(F,Y),de(F,_,Y),we(b,F,Y),de(F,E,Y),v&&v.m(F,Y),de(F,R,Y),D&&D.m(F,Y),de(F,h,Y),k=!0},p(F,Y){F[12]?L?Y[0]&4096&&J(L,1):(L=R2(),L.c(),J(L,1),L.m(c.parentNode,c)):L&&(Wt(),ne(L,1,1,()=>{L=null}),jt()),F[13]?P?Y[0]&8192&&J(P,1):(P=L2(),P.c(),J(P,1),P.m(y.parentNode,y)):P&&(Wt(),ne(P,1,1,()=>{P=null}),jt()),F[14]!==Be.NONE||F[15]!==er.DISABLED?I?Y[0]&49152&&J(I,1):(I=P2(),I.c(),J(I,1),I.m(m.parentNode,m)):I&&(Wt(),ne(I,1,1,()=>{I=null}),jt()),F[15]!==er.DISABLED?H?Y[0]&32768&&J(H,1):(H=I2(),H.c(),J(H,1),H.m(g.parentNode,g)):H&&(Wt(),ne(H,1,1,()=>{H=null}),jt()),F[13]?ae?(ae.p(F,Y),Y[0]&8192&&J(ae,1)):(ae=B2(F),ae.c(),J(ae,1),ae.m(w.parentNode,w)):ae&&(Wt(),ne(ae,1,1,()=>{ae=null}),jt()),F[15]!==er.CLICK?V?(V.p(F,Y),Y[0]&32768&&J(V,1)):(V=O2(F),V.c(),J(V,1),V.m(_.parentNode,_)):V&&(Wt(),ne(V,1,1,()=>{V=null}),jt()),F[15]!==er.DISABLED?v?(v.p(F,Y),Y[0]&32768&&J(v,1)):(v=D2(F),v.c(),J(v,1),v.m(R.parentNode,R)):v&&(Wt(),ne(v,1,1,()=>{v=null}),jt()),F[15]===er.HOLD?D?Y[0]&32768&&J(D,1):(D=N2(),D.c(),J(D,1),D.m(h.parentNode,h)):D&&(Wt(),ne(D,1,1,()=>{D=null}),jt())},i(F){k||(J(e.$$.fragment,F),J(r.$$.fragment,F),J(s.$$.fragment,F),J(a.$$.fragment,F),J(L),J($),J(f.$$.fragment,F),J(P),J(I),J(H),J(ae),J(V),J(b.$$.fragment,F),J(v),J(D),k=!0)},o(F){ne(e.$$.fragment,F),ne(r.$$.fragment,F),ne(s.$$.fragment,F),ne(a.$$.fragment,F),ne(L),ne($),ne(f.$$.fragment,F),ne(P),ne(I),ne(H),ne(ae),ne(V),ne(b.$$.fragment,F),ne(v),ne(D),k=!1},d(F){F&&(ce(n),ce(i),ce(o),ce(l),ce(c),ce(u),ce(p),ce(y),ce(m),ce(g),ce(w),ce(_),ce(E),ce(R),ce(h)),ye(e,F),ye(r,F),ye(s,F),ye(a,F),L&&L.d(F),$&&$.d(F),ye(f,F),P&&P.d(F),I&&I.d(F),H&&H.d(F),ae&&ae.d(F),V&&V.d(F),ye(b,F),v&&v.d(F),D&&D.d(F)}}}function F2(t){let e,n;return e=new Hn({props:{label:"Prevent action on selection",helpText:"If enabled click/hold will not execute any action / open the subtitle action list in case any text is selected",targetStore$:_t.subtitlePreventActionOnSelection$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function $2(t){let e,n;return e=new Xr({props:{label:"Visibility toggle time",helpText:"# of ms to hold down to toggle the action list. If released earlier the configured click action is executed instead",targetStore$:_t.subtitlesActionsVisibilityTime$,min:100}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function V2(t){let e,n;return e=new uc({props:{label:"Font",helpText:"Font name to use for the subtitle list - needs to be installed on the device or via reader",targetStore$:_t.subtitlesFontFamily$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function x2(t){let e,n;return e=new Xr({props:{label:"Font size",helpText:"Font size to use for the subtitle list",targetStore$:_t.subtitlesFontSize$,min:1,step:1}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function H2(t){let e,n;return e=new Xr({props:{label:"Line height",helpText:"Line height to use for the subtitle list",targetStore$:_t.subtitlesLineHeight$,min:1,step:.05}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function $9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$;e=new Hn({props:{label:"Persist subtitles",helpText:"If enabled loading subtitles or changes to them will be stored locally in your browser and can be used as data fallback/source. May takes more storage quota and increased update times",targetStore$:t[60]}}),e.$on("change",t[97]),r=new Hn({props:{label:"Enable auto scroll",helpText:"If enabled the subtitle list will automatically scroll to active subtitles",targetStore$:_t.subtitlesEnableAutoScroll$}}),s=new Hn({props:{label:"Copy font",helpText:"If enabled the configured font of the reader is used for the subtitle list",targetStore$:t[61]}}),a=new Hn({props:{label:"Copy font size",helpText:"If enabled the configured font size of the reader is used for the subtitle list",targetStore$:t[62]}}),c=new Hn({props:{label:"Copy line height",helpText:"If enabled the configured line height of the reader is used for the subtitle list",targetStore$:t[63]}});let P=(t[16]!==Be.NONE||t[17]===Sr.TOGGLE)&&F2();p=new Br({props:{label:"Click Action",helpText:"Determines the action executed when clicking on a subtitle",targetStore$:t[64],options:t[42]}}),m=new Br({props:{label:"Actions visibility",helpText:"Determines the conditions for showing actions in the subtitle list",targetStore$:t[65],options:t[47]}});let I=t[17]===Sr.TOGGLE&&$2();_=new Xr({props:{label:"Global start padding",helpText:"# of ms by which all subtitle start times are shifted",disabled:!!t[18],targetStore$:t[66],blurHandler:t[98]}}),E=new Xr({props:{label:"Global end padding",helpText:"# of ms by which all subtitle end times are shifted",disabled:!!t[18],targetStore$:t[67],blurHandler:t[98]}});let H=!t[19]&&V2(),ae=!t[20]&&x2(),V=!t[21]&&H2();return{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),ve(c.$$.fragment),u=me(),P&&P.c(),f=me(),ve(p.$$.fragment),y=me(),ve(m.$$.fragment),g=me(),I&&I.c(),w=me(),ve(_.$$.fragment),b=me(),ve(E.$$.fragment),R=me(),H&&H.c(),h=me(),ae&&ae.c(),k=me(),V&&V.c(),L=Dr()},m(v,D){we(e,v,D),de(v,n,D),we(r,v,D),de(v,i,D),we(s,v,D),de(v,o,D),we(a,v,D),de(v,l,D),we(c,v,D),de(v,u,D),P&&P.m(v,D),de(v,f,D),we(p,v,D),de(v,y,D),we(m,v,D),de(v,g,D),I&&I.m(v,D),de(v,w,D),we(_,v,D),de(v,b,D),we(E,v,D),de(v,R,D),H&&H.m(v,D),de(v,h,D),ae&&ae.m(v,D),de(v,k,D),V&&V.m(v,D),de(v,L,D),$=!0},p(v,D){v[16]!==Be.NONE||v[17]===Sr.TOGGLE?P?D[0]&196608&&J(P,1):(P=F2(),P.c(),J(P,1),P.m(f.parentNode,f)):P&&(Wt(),ne(P,1,1,()=>{P=null}),jt()),v[17]===Sr.TOGGLE?I?D[0]&131072&&J(I,1):(I=$2(),I.c(),J(I,1),I.m(w.parentNode,w)):I&&(Wt(),ne(I,1,1,()=>{I=null}),jt());const F={};D[0]&262144&&(F.disabled=!!v[18]),_.$set(F);const Y={};D[0]&262144&&(Y.disabled=!!v[18]),E.$set(Y),v[19]?H&&(Wt(),ne(H,1,1,()=>{H=null}),jt()):H?D[0]&524288&&J(H,1):(H=V2(),H.c(),J(H,1),H.m(h.parentNode,h)),v[20]?ae&&(Wt(),ne(ae,1,1,()=>{ae=null}),jt()):ae?D[0]&1048576&&J(ae,1):(ae=x2(),ae.c(),J(ae,1),ae.m(k.parentNode,k)),v[21]?V&&(Wt(),ne(V,1,1,()=>{V=null}),jt()):V?D[0]&2097152&&J(V,1):(V=H2(),V.c(),J(V,1),V.m(L.parentNode,L))},i(v){$||(J(e.$$.fragment,v),J(r.$$.fragment,v),J(s.$$.fragment,v),J(a.$$.fragment,v),J(c.$$.fragment,v),J(P),J(p.$$.fragment,v),J(m.$$.fragment,v),J(I),J(_.$$.fragment,v),J(E.$$.fragment,v),J(H),J(ae),J(V),$=!0)},o(v){ne(e.$$.fragment,v),ne(r.$$.fragment,v),ne(s.$$.fragment,v),ne(a.$$.fragment,v),ne(c.$$.fragment,v),ne(P),ne(p.$$.fragment,v),ne(m.$$.fragment,v),ne(I),ne(_.$$.fragment,v),ne(E.$$.fragment,v),ne(H),ne(ae),ne(V),$=!1},d(v){v&&(ce(n),ce(i),ce(o),ce(l),ce(u),ce(f),ce(y),ce(g),ce(w),ce(b),ce(R),ce(h),ce(k),ce(L)),ye(e,v),ye(r,v),ye(s,v),ye(a,v),ye(c,v),P&&P.d(v),ye(p,v),ye(m,v),I&&I.d(v),ye(_,v),ye(E,v),H&&H.d(v),ae&&ae.d(v),V&&V.d(v)}}}function U2(t){let e,n;return e=new Hn({props:{label:"Dictionary detection",helpText:"If enabled auto pause is skipped if open yomitan/jpdb-browser-reader was detected - yomitan requires disabled 'Secure Container' settings",targetStore$:_t.playerEnableDictionaryDetection$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function V9(t){let e,n;return e=new Hn({props:{label:"Enable WakeLock",helpText:"If enabled the sites attempts to request a WakeLock during audio play that prevents device screens from dimming or locking",targetStore$:_t.playerEnableWakeLock$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function x9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L=t[3]!==ui.DISABLED&&U2();n=new Hn({props:{label:"Enable cover",helpText:"If enabled the audio file is searched through for a cover with a cost of slightly longer loading time",targetStore$:t[68]}}),n.$on("change",t[99]),i=new Hn({props:{label:"Enable chapters",helpText:"If enabled the audio file is searched through for chapter metadata with a cost of slightly longer loading time",targetStore$:t[69]}}),i.$on("change",t[100]);let $=t[40]&&V9();return a=new Hn({props:{label:"Enable subtitle copy",helpText:"If enabled an active subtitle will automatically be copied to the clipboard (chromium only;site needs to stay in focus)",targetStore$:_t.playerEnableSubtitleCopy$}}),c=new Br({props:{label:"Auto pause",helpText:t[4],targetStore$:t[70],options:t[48]}}),f=new Xr({props:{label:"Rewind",helpText:"# of seconds used for the regular rewind action",targetStore$:_t.playerRewindTime$,min:1,step:1}}),y=new Xr({props:{label:"Rewind #2",helpText:"# of seconds used for the alternative rewind action",targetStore$:_t.playerAltRewindTime$,min:1,step:1}}),g=new Xr({props:{label:"Fast-Forward",helpText:"# of seconds used for the regular fast-forward action",targetStore$:_t.playerFastForwardTime$,min:1,step:1}}),_=new Xr({props:{label:"Fast-Forward #2",helpText:"# of seconds used for the alternative fast-forward action",targetStore$:_t.playerAltFastForwardTime$,min:1,step:1}}),E=new Xr({props:{label:"Playback decrease time",helpText:"# of seconds used for the playback rate decrease action",targetStore$:_t.playerPlaybackRateDecreaseTime$,min:.05,max:1,step:.05}}),h=new Xr({props:{label:"Playback increase time",helpText:"# of seconds used for the playback rate increase action",targetStore$:_t.playerPlaybackRateIncreaseTime$,min:.05,max:1,step:.05}}),{c(){L&&L.c(),e=me(),ve(n.$$.fragment),r=me(),ve(i.$$.fragment),s=me(),$&&$.c(),o=me(),ve(a.$$.fragment),l=me(),ve(c.$$.fragment),u=me(),ve(f.$$.fragment),p=me(),ve(y.$$.fragment),m=me(),ve(g.$$.fragment),w=me(),ve(_.$$.fragment),b=me(),ve(E.$$.fragment),R=me(),ve(h.$$.fragment)},m(P,I){L&&L.m(P,I),de(P,e,I),we(n,P,I),de(P,r,I),we(i,P,I),de(P,s,I),$&&$.m(P,I),de(P,o,I),we(a,P,I),de(P,l,I),we(c,P,I),de(P,u,I),we(f,P,I),de(P,p,I),we(y,P,I),de(P,m,I),we(g,P,I),de(P,w,I),we(_,P,I),de(P,b,I),we(E,P,I),de(P,R,I),we(h,P,I),k=!0},p(P,I){P[3]!==ui.DISABLED?L?I[0]&8&&J(L,1):(L=U2(),L.c(),J(L,1),L.m(e.parentNode,e)):L&&(Wt(),ne(L,1,1,()=>{L=null}),jt());const H={};I[0]&16&&(H.helpText=P[4]),c.$set(H)},i(P){k||(J(L),J(n.$$.fragment,P),J(i.$$.fragment,P),J($),J(a.$$.fragment,P),J(c.$$.fragment,P),J(f.$$.fragment,P),J(y.$$.fragment,P),J(g.$$.fragment,P),J(_.$$.fragment,P),J(E.$$.fragment,P),J(h.$$.fragment,P),k=!0)},o(P){ne(L),ne(n.$$.fragment,P),ne(i.$$.fragment,P),ne($),ne(a.$$.fragment,P),ne(c.$$.fragment,P),ne(f.$$.fragment,P),ne(y.$$.fragment,P),ne(g.$$.fragment,P),ne(_.$$.fragment,P),ne(E.$$.fragment,P),ne(h.$$.fragment,P),k=!1},d(P){P&&(ce(e),ce(r),ce(s),ce(o),ce(l),ce(u),ce(p),ce(m),ce(w),ce(b),ce(R)),L&&L.d(P),ye(n,P),ye(i,P),$&&$.d(P),ye(a,P),ye(c,P),ye(f,P),ye(y,P),ye(g,P),ye(_,P),ye(E,P),ye(h,P)}}}function W2(t){let e,n;return e=new Hn({props:{label:"Enable FFMPEG log",helpText:"If enabled ffmpeg logs will be printed out on console during export",targetStore$:_t.enableFFMPEGLog$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function H9(t){let e,n,r,i,s,o,a,l,c,u,f,p;e=new Br({props:{label:"Field mode",helpText:"Determines if the card data will be added before/after any current field value or if it will replace it",targetStore$:_t.exportFieldMode$,options:t[49]}}),r=new Br({props:{label:"Audio processor",helpText:t[10],disabled:!!t[18],targetStore$:t[75],options:t[50]}}),r.$on("change",t[101]),s=new Br({props:{label:"Audio Format",helpText:"Audio format used for exported audio",targetStore$:t[76],options:t[9]}}),a=new Xr({props:{label:"Bitrate",helpText:"Approximate Kbps bitrate target used for exported audio",disabled:!!t[18],targetStore$:_t.exportAudioBitrate$,min:64,step:10}}),c=new Br({props:{label:"Image Format",helpText:"Image format used for exported cover (.png fallback)",targetStore$:t[77],options:t[95]}});let y=t[2]===Tr.FFMPEG&&W2();return{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),ve(c.$$.fragment),u=me(),y&&y.c(),f=Dr()},m(m,g){we(e,m,g),de(m,n,g),we(r,m,g),de(m,i,g),we(s,m,g),de(m,o,g),we(a,m,g),de(m,l,g),we(c,m,g),de(m,u,g),y&&y.m(m,g),de(m,f,g),p=!0},p(m,g){const w={};g[0]&1024&&(w.helpText=m[10]),g[0]&262144&&(w.disabled=!!m[18]),r.$set(w);const _={};g[0]&512&&(_.options=m[9]),s.$set(_);const b={};g[0]&262144&&(b.disabled=!!m[18]),a.$set(b),m[2]===Tr.FFMPEG?y?g[0]&4&&J(y,1):(y=W2(),y.c(),J(y,1),y.m(f.parentNode,f)):y&&(Wt(),ne(y,1,1,()=>{y=null}),jt())},i(m){p||(J(e.$$.fragment,m),J(r.$$.fragment,m),J(s.$$.fragment,m),J(a.$$.fragment,m),J(c.$$.fragment,m),J(y),p=!0)},o(m){ne(e.$$.fragment,m),ne(r.$$.fragment,m),ne(s.$$.fragment,m),ne(a.$$.fragment,m),ne(c.$$.fragment,m),ne(y),p=!1},d(m){m&&(ce(n),ce(i),ce(o),ce(l),ce(u),ce(f)),ye(e,m),ye(r,m),ye(s,m),ye(a,m),ye(c,m),y&&y.d(m)}}}function j2(t){let e,n;return e=new Hn({props:{label:"Allow empty key field",helpText:"If enabled the export will set an empty key field to a zero-width character in order to avoid export errors",targetStore$:_t.ankiAllowEmptyKeyField$}}),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function G2(t,e){let n,r=e[147]+"",i,s;return{key:t,first:null,c(){n=ge("option"),i=Ft(r),s=me(),n.__value=e[147],Ci(n,n.__value),this.first=n},m(o,a){de(o,n,a),oe(n,i),oe(n,s)},p(o,a){e=o},d(o){o&&ce(n)}}}function U9(t){let e;return{c(){e=ge("div"),e.textContent=`Anki export settings for the respective operation. Leaving sentence and sound field empty for 'Update
				card' will automatically use all values from 'Create card' as fallback`},m(n,r){de(n,e,r)},p:wt,d(n){n&&ce(e)}}}function W9(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function j9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E=[],R=new D9,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q;e=new Hn({props:{label:"Add subtitle tag",helpText:"If enabled the name of the current loaded subtitle file will be added to the card tag list",targetStore$:_t.ankiAddSubtitleTag$}}),r=new Hn({props:{label:"Add audio tag",helpText:"If enabled the name of the current loaded audio file will be added to the card tag list",targetStore$:_t.ankiAddAudioTag$}}),s=new Hn({props:{label:"Open in browser",helpText:"If enabled an exported card will automatically open/show in the anki gui browser",targetStore$:_t.ankiEnableOpenInBrowser$}});let W=t[22]===ci.DISABLED&&j2();l=new uc({props:{label:"Card tags",helpText:"Comma separated list of tags added to the card tag list. Tags in card updates are supported on desktop only",targetStore$:_t.ankiTagList$}}),u=new Br({props:{label:"Check duplicates",helpText:"Sets the respective options for Anki-Connect - works only on desktop and for creating new cards",targetStore$:t[78],options:t[51]}}),p=new uc({props:{label:"Anki url",buttonTitle:"Reload Anki data",targetStore$:t[79],buttonIcon:Hd}}),p.$on("click",t[111]),m=new uc({props:{helpText:"Anki API key",label:"Anki key",targetStore$:t[80]}}),m.$on("blur",t[112]);let O=Kr(t[94]);const C=S=>S[147];for(let S=0;S<O.length;S+=1){let M=M2(t,O,S),X=C(M);R.set(X,E[S]=G2(X,M))}return k=new pi({props:{$$slots:{icon:[W9],default:[U9]},$$scope:{ctx:t}}}),$=new Br({props:{label:"Anki deck",helpText:"Target anki deck for exporting",targetStore$:t[8]?t[81]:t[82],options:t[5]}}),I=new Br({props:{label:"Anki model",helpText:"Target anki model for exporting",targetStore$:t[8]?t[83]:t[84],options:t[6]}}),I.$on("change",t[115]),ae=new Br({props:{label:"Sentence field",buttonTitle:"Clear field",targetStore$:t[8]?t[85]:t[86],buttonIcon:Zo,options:t[7]}}),ae.$on("click",t[116]),v=new Br({props:{label:"Sound field",buttonTitle:"Clear field",targetStore$:t[8]?t[87]:t[88],buttonIcon:Zo,options:t[7]}}),v.$on("click",t[117]),F=new Br({props:{label:"Cover field",buttonTitle:"Clear field",targetStore$:t[8]?t[89]:t[90],buttonIcon:Zo,options:t[7]}}),F.$on("click",t[118]),{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),o=me(),W&&W.c(),a=me(),ve(l.$$.fragment),c=me(),ve(u.$$.fragment),f=me(),ve(p.$$.fragment),y=me(),ve(m.$$.fragment),g=me(),w=ge("label"),w.textContent="Anki settings",_=me(),b=ge("select");for(let S=0;S<E.length;S+=1)E[S].c();h=me(),ve(k.$$.fragment),L=me(),ve($.$$.fragment),P=me(),ve(I.$$.fragment),H=me(),ve(ae.$$.fragment),V=me(),ve(v.$$.fragment),D=me(),ve(F.$$.fragment),re(w,"for","anki-settings-mode"),re(b,"id","anki-settings-mode"),t[0]===void 0&&Cs(()=>t[113].call(b))},m(S,M){we(e,S,M),de(S,n,M),we(r,S,M),de(S,i,M),we(s,S,M),de(S,o,M),W&&W.m(S,M),de(S,a,M),we(l,S,M),de(S,c,M),we(u,S,M),de(S,f,M),we(p,S,M),de(S,y,M),we(m,S,M),de(S,g,M),de(S,w,M),de(S,_,M),de(S,b,M);for(let X=0;X<E.length;X+=1)E[X]&&E[X].m(b,null);jl(b,t[0],!0),de(S,h,M),we(k,S,M),de(S,L,M),we($,S,M),de(S,P,M),we(I,S,M),de(S,H,M),we(ae,S,M),de(S,V,M),we(v,S,M),de(S,D,M),we(F,S,M),Y=!0,K||(Q=[Ke(b,"change",t[113]),Ke(b,"change",t[114])],K=!0)},p(S,M){S[22]===ci.DISABLED?W?M[0]&4194304&&J(W,1):(W=j2(),W.c(),J(W,1),W.m(a.parentNode,a)):W&&(Wt(),ne(W,1,1,()=>{W=null}),jt()),M[3]&2&&(O=Kr(S[94]),E=Ks(E,M,C,1,S,O,R,b,Pa,G2,null,M2)),M[0]&1|M[3]&2&&jl(b,S[0]);const X={};M[4]&67108864&&(X.$$scope={dirty:M,ctx:S}),k.$set(X);const ie={};M[0]&256&&(ie.targetStore$=S[8]?S[81]:S[82]),M[0]&32&&(ie.options=S[5]),$.$set(ie);const G={};M[0]&256&&(G.targetStore$=S[8]?S[83]:S[84]),M[0]&64&&(G.options=S[6]),I.$set(G);const z={};M[0]&256&&(z.targetStore$=S[8]?S[85]:S[86]),M[0]&128&&(z.options=S[7]),ae.$set(z);const le={};M[0]&256&&(le.targetStore$=S[8]?S[87]:S[88]),M[0]&128&&(le.options=S[7]),v.$set(le);const Me={};M[0]&256&&(Me.targetStore$=S[8]?S[89]:S[90]),M[0]&128&&(Me.options=S[7]),F.$set(Me)},i(S){Y||(J(e.$$.fragment,S),J(r.$$.fragment,S),J(s.$$.fragment,S),J(W),J(l.$$.fragment,S),J(u.$$.fragment,S),J(p.$$.fragment,S),J(m.$$.fragment,S),J(k.$$.fragment,S),J($.$$.fragment,S),J(I.$$.fragment,S),J(ae.$$.fragment,S),J(v.$$.fragment,S),J(F.$$.fragment,S),Y=!0)},o(S){ne(e.$$.fragment,S),ne(r.$$.fragment,S),ne(s.$$.fragment,S),ne(W),ne(l.$$.fragment,S),ne(u.$$.fragment,S),ne(p.$$.fragment,S),ne(m.$$.fragment,S),ne(k.$$.fragment,S),ne($.$$.fragment,S),ne(I.$$.fragment,S),ne(ae.$$.fragment,S),ne(v.$$.fragment,S),ne(F.$$.fragment,S),Y=!1},d(S){S&&(ce(n),ce(i),ce(o),ce(a),ce(c),ce(f),ce(y),ce(g),ce(w),ce(_),ce(b),ce(h),ce(L),ce(P),ce(H),ce(V),ce(D)),ye(e,S),ye(r,S),ye(s,S),W&&W.d(S),ye(l,S),ye(u,S),ye(p,S),ye(m,S);for(let M=0;M<E.length;M+=1)E[M].d();ye(k,S),ye($,S),ye(I,S),ye(ae,S),ye(v,S),ye(F,S),K=!1,vn(Q)}}}function z2(t){let e,n,r;function i(o){t[121](o)}let s={settingsMenu:li.READER_ACTIONS,$$slots:{default:[G9]},$$scope:{ctx:t}};return t[1]!==void 0&&(s.openSettingsMenu=t[1]),e=new vs({props:s}),$t.push(()=>qn(e,"openSettingsMenu",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};a[1]&2|a[4]&67108864&&(l.$$scope={dirty:a,ctx:o}),!n&&a[0]&2&&(n=!0,l.openSettingsMenu=o[1],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function G9(t){let e,n,r;function i(o){t[120](o)}let s={defaultActions:ad};return t[32]!==void 0&&(s.actionList=t[32]),e=new X1({props:s}),$t.push(()=>qn(e,"actionList",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};!n&&a[1]&2&&(n=!0,l.actionList=o[32],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function X2(t){let e,n,r;function i(o){t[123](o)}let s={settingsMenu:li.SUBTITLE_ACTIONS,$$slots:{default:[z9]},$$scope:{ctx:t}};return t[1]!==void 0&&(s.openSettingsMenu=t[1]),e=new vs({props:s}),$t.push(()=>qn(e,"openSettingsMenu",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};a[1]&4|a[4]&67108864&&(l.$$scope={dirty:a,ctx:o}),!n&&a[0]&2&&(n=!0,l.openSettingsMenu=o[1],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function z9(t){let e,n,r;function i(o){t[122](o)}let s={defaultActions:ld};return t[33]!==void 0&&(s.actionList=t[33]),e=new X1({props:s}),$t.push(()=>qn(e,"actionList",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};!n&&a[1]&4&&(n=!0,l.actionList=o[33],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function X9(t){let e,n,r;function i(o){t[124](o)}let s={defaultActions:xc};return t[34]!==void 0&&(s.actionList=t[34]),e=new X1({props:s}),$t.push(()=>qn(e,"actionList",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};!n&&a[1]&8&&(n=!0,l.actionList=o[34],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function Y2(t){let e,n,r;function i(o){t[126](o)}let s={settingsMenu:li.KEYBINDINGS,$$slots:{default:[Y9]},$$scope:{ctx:t}};return t[1]!==void 0&&(s.openSettingsMenu=t[1]),e=new vs({props:s}),$t.push(()=>qn(e,"openSettingsMenu",i)),{c(){ve(e.$$.fragment)},m(o,a){we(e,o,a),r=!0},p(o,a){const l={};a[1]&480|a[4]&67108864&&(l.$$scope={dirty:a,ctx:o}),!n&&a[0]&2&&(n=!0,l.openSettingsMenu=o[1],Kn(()=>n=!1)),e.$set(l)},i(o){r||(J(e.$$.fragment,o),r=!0)},o(o){ne(e.$$.fragment,o),r=!1},d(o){ye(e,o)}}}function Y9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie;return e=new Hn({props:{label:"Enable time fallback",helpText:"If enabled and no subtitle is currently active the current time is used as fallback to search for the closest subtitle",targetStore$:_t.keybindingsEnableTimeFallback$}}),r=new mr({props:{key:"Cmd + Space",description:Be.TOGGLE_PLAYBACK,extendDescription:!1}}),s=new mr({props:{key:"Alt + j",description:Be.TOGGLE_PLAYBACK,extendDescription:!1}}),a=new mr({props:{key:"Cmd + d",description:Be.RESTART_PLAYBACK}}),c=new mr({props:{key:"Alt + d",description:Be.TOGGLE_PLAY_PAUSE}}),f=new mr({props:{key:"Cmd + l",description:Be.TOGGLE_PLAYBACK_LOOP}}),y=new mr({props:{key:"Cmd + b",description:Be.TOGGLE_BOOKMARK}}),g=new mr({props:{key:"Cmd + m",description:Be.TOGGLE_MERGE}}),_=new mr({props:{key:"Cmd + e",description:Be.EXPORT_NEW}}),E=new mr({props:{key:"Alt + e",description:Be.EXPORT_UPDATE}}),h=new mr({props:{key:"Alt + g",description:Be.EDIT_SUBTITLE,extendDescription:!1}}),L=new mr({props:{key:"Alt + z",description:Be.COPY_SUBTITLE,extendDescription:!1}}),P=new mr({props:{key:"Cmd + q",description:Be.PREVIOUS_SUBTITLE,extendDescription:!1}}),H=new mr({props:{key:"Alt + q",description:Be.NEXT_SUBTITLE,extendDescription:!1}}),V=new mr({props:{key:"Cmd + k",description:"Decrease playbackrate",extendDescription:!1}}),D=new mr({props:{key:"Alt + k",description:"Increase playbackrate",extendDescription:!1}}),Y=new mr({props:{key:"Cmd + Arrow Left",description:`Rewind ${t[36]} seconds`,extendDescription:!1}}),Q=new mr({props:{key:"Cmd + Arrow Down",description:`Rewind ${t[37]} seconds`,extendDescription:!1}}),O=new mr({props:{key:"Cmd + Arrow Right",description:`Fast-Forward ${t[38]} seconds`,extendDescription:!1}}),S=new mr({props:{key:"Cmd + Arrow Up",description:`Fast-Forward ${t[39]} seconds`,extendDescription:!1}}),X=new mr({props:{key:"Alt + h",description:"Toggle visibility of footer actions",extendDescription:!1}}),{c(){ve(e.$$.fragment),n=me(),ve(r.$$.fragment),i=me(),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),ve(c.$$.fragment),u=me(),ve(f.$$.fragment),p=me(),ve(y.$$.fragment),m=me(),ve(g.$$.fragment),w=me(),ve(_.$$.fragment),b=me(),ve(E.$$.fragment),R=me(),ve(h.$$.fragment),k=me(),ve(L.$$.fragment),$=me(),ve(P.$$.fragment),I=me(),ve(H.$$.fragment),ae=me(),ve(V.$$.fragment),v=me(),ve(D.$$.fragment),F=me(),ve(Y.$$.fragment),K=me(),ve(Q.$$.fragment),W=me(),ve(O.$$.fragment),C=me(),ve(S.$$.fragment),M=me(),ve(X.$$.fragment)},m(G,z){we(e,G,z),de(G,n,z),we(r,G,z),de(G,i,z),we(s,G,z),de(G,o,z),we(a,G,z),de(G,l,z),we(c,G,z),de(G,u,z),we(f,G,z),de(G,p,z),we(y,G,z),de(G,m,z),we(g,G,z),de(G,w,z),we(_,G,z),de(G,b,z),we(E,G,z),de(G,R,z),we(h,G,z),de(G,k,z),we(L,G,z),de(G,$,z),we(P,G,z),de(G,I,z),we(H,G,z),de(G,ae,z),we(V,G,z),de(G,v,z),we(D,G,z),de(G,F,z),we(Y,G,z),de(G,K,z),we(Q,G,z),de(G,W,z),we(O,G,z),de(G,C,z),we(S,G,z),de(G,M,z),we(X,G,z),ie=!0},p(G,z){const le={};z[1]&32&&(le.description=`Rewind ${G[36]} seconds`),Y.$set(le);const Me={};z[1]&64&&(Me.description=`Rewind ${G[37]} seconds`),Q.$set(Me);const _e={};z[1]&128&&(_e.description=`Fast-Forward ${G[38]} seconds`),O.$set(_e);const Ae={};z[1]&256&&(Ae.description=`Fast-Forward ${G[39]} seconds`),S.$set(Ae)},i(G){ie||(J(e.$$.fragment,G),J(r.$$.fragment,G),J(s.$$.fragment,G),J(a.$$.fragment,G),J(c.$$.fragment,G),J(f.$$.fragment,G),J(y.$$.fragment,G),J(g.$$.fragment,G),J(_.$$.fragment,G),J(E.$$.fragment,G),J(h.$$.fragment,G),J(L.$$.fragment,G),J(P.$$.fragment,G),J(H.$$.fragment,G),J(V.$$.fragment,G),J(D.$$.fragment,G),J(Y.$$.fragment,G),J(Q.$$.fragment,G),J(O.$$.fragment,G),J(S.$$.fragment,G),J(X.$$.fragment,G),ie=!0)},o(G){ne(e.$$.fragment,G),ne(r.$$.fragment,G),ne(s.$$.fragment,G),ne(a.$$.fragment,G),ne(c.$$.fragment,G),ne(f.$$.fragment,G),ne(y.$$.fragment,G),ne(g.$$.fragment,G),ne(_.$$.fragment,G),ne(E.$$.fragment,G),ne(h.$$.fragment,G),ne(L.$$.fragment,G),ne(P.$$.fragment,G),ne(H.$$.fragment,G),ne(V.$$.fragment,G),ne(D.$$.fragment,G),ne(Y.$$.fragment,G),ne(Q.$$.fragment,G),ne(O.$$.fragment,G),ne(S.$$.fragment,G),ne(X.$$.fragment,G),ie=!1},d(G){G&&(ce(n),ce(i),ce(o),ce(l),ce(u),ce(p),ce(m),ce(w),ce(b),ce(R),ce(k),ce($),ce(I),ce(ae),ce(v),ce(F),ce(K),ce(W),ce(C),ce(M)),ye(e,G),ye(r,G),ye(s,G),ye(a,G),ye(c,G),ye(f,G),ye(y,G),ye(g,G),ye(_,G),ye(E,G),ye(h,G),ye(L,G),ye(P,G),ye(H,G),ye(V,G),ye(D,G),ye(Y,G),ye(Q,G),ye(O,G),ye(S,G),ye(X,G)}}}function K9(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k;function L(C){t[107](C)}let $={settingsMenu:li.READER,$$slots:{default:[F9]},$$scope:{ctx:t}};t[1]!==void 0&&($.openSettingsMenu=t[1]),n=new vs({props:$}),$t.push(()=>qn(n,"openSettingsMenu",L));function P(C){t[108](C)}let I={settingsMenu:li.SUBTITLES,$$slots:{default:[$9]},$$scope:{ctx:t}};t[1]!==void 0&&(I.openSettingsMenu=t[1]),s=new vs({props:I}),$t.push(()=>qn(s,"openSettingsMenu",P));function H(C){t[109](C)}let ae={settingsMenu:li.PLAYER,$$slots:{default:[x9]},$$scope:{ctx:t}};t[1]!==void 0&&(ae.openSettingsMenu=t[1]),l=new vs({props:ae}),$t.push(()=>qn(l,"openSettingsMenu",H));function V(C){t[110](C)}let v={settingsMenu:li.EXPORT,$$slots:{default:[H9]},$$scope:{ctx:t}};t[1]!==void 0&&(v.openSettingsMenu=t[1]),f=new vs({props:v}),$t.push(()=>qn(f,"openSettingsMenu",V));function D(C){t[119](C)}let F={settingsMenu:li.ANKI,$$slots:{default:[j9]},$$scope:{ctx:t}};t[1]!==void 0&&(F.openSettingsMenu=t[1]),m=new vs({props:F}),$t.push(()=>qn(m,"openSettingsMenu",D));let Y=t[15]!==er.DISABLED&&z2(t),K=t[17]!==Sr.HIDDEN&&X2(t);function Q(C){t[125](C)}let W={settingsMenu:li.FOOTER_ACTIONS,$$slots:{default:[X9]},$$scope:{ctx:t}};t[1]!==void 0&&(W.openSettingsMenu=t[1]),E=new vs({props:W}),$t.push(()=>qn(E,"openSettingsMenu",Q));let O=!t[35]&&Y2(t);return{c(){e=ge("div"),ve(n.$$.fragment),i=me(),ve(s.$$.fragment),a=me(),ve(l.$$.fragment),u=me(),ve(f.$$.fragment),y=me(),ve(m.$$.fragment),w=me(),Y&&Y.c(),_=me(),K&&K.c(),b=me(),ve(E.$$.fragment),h=me(),O&&O.c()},m(C,S){de(C,e,S),we(n,e,null),oe(e,i),we(s,e,null),oe(e,a),we(l,e,null),oe(e,u),we(f,e,null),oe(e,y),we(m,e,null),oe(e,w),Y&&Y.m(e,null),oe(e,_),K&&K.m(e,null),oe(e,b),we(E,e,null),oe(e,h),O&&O.m(e,null),k=!0},p(C,S){const M={};S[0]&63488|S[4]&67108864&&(M.$$scope={dirty:S,ctx:C}),!r&&S[0]&2&&(r=!0,M.openSettingsMenu=C[1],Kn(()=>r=!1)),n.$set(M);const X={};S[0]&4128768|S[4]&67108864&&(X.$$scope={dirty:S,ctx:C}),!o&&S[0]&2&&(o=!0,X.openSettingsMenu=C[1],Kn(()=>o=!1)),s.$set(X);const ie={};S[0]&24|S[4]&67108864&&(ie.$$scope={dirty:S,ctx:C}),!c&&S[0]&2&&(c=!0,ie.openSettingsMenu=C[1],Kn(()=>c=!1)),l.$set(ie);const G={};S[0]&263684|S[4]&67108864&&(G.$$scope={dirty:S,ctx:C}),!p&&S[0]&2&&(p=!0,G.openSettingsMenu=C[1],Kn(()=>p=!1)),f.$set(G);const z={};S[0]&2143289825|S[1]&1|S[4]&67108864&&(z.$$scope={dirty:S,ctx:C}),!g&&S[0]&2&&(g=!0,z.openSettingsMenu=C[1],Kn(()=>g=!1)),m.$set(z),C[15]!==er.DISABLED?Y?(Y.p(C,S),S[0]&32768&&J(Y,1)):(Y=z2(C),Y.c(),J(Y,1),Y.m(e,_)):Y&&(Wt(),ne(Y,1,1,()=>{Y=null}),jt()),C[17]!==Sr.HIDDEN?K?(K.p(C,S),S[0]&131072&&J(K,1)):(K=X2(C),K.c(),J(K,1),K.m(e,b)):K&&(Wt(),ne(K,1,1,()=>{K=null}),jt());const le={};S[1]&8|S[4]&67108864&&(le.$$scope={dirty:S,ctx:C}),!R&&S[0]&2&&(R=!0,le.openSettingsMenu=C[1],Kn(()=>R=!1)),E.$set(le),C[35]?O&&(Wt(),ne(O,1,1,()=>{O=null}),jt()):O?(O.p(C,S),S[1]&16&&J(O,1)):(O=Y2(C),O.c(),J(O,1),O.m(e,null))},i(C){k||(J(n.$$.fragment,C),J(s.$$.fragment,C),J(l.$$.fragment,C),J(f.$$.fragment,C),J(m.$$.fragment,C),J(Y),J(K),J(E.$$.fragment,C),J(O),k=!0)},o(C){ne(n.$$.fragment,C),ne(s.$$.fragment,C),ne(l.$$.fragment,C),ne(f.$$.fragment,C),ne(m.$$.fragment,C),ne(Y),ne(K),ne(E.$$.fragment,C),ne(O),k=!1},d(C){C&&ce(e),ye(n),ye(s),ye(l),ye(f),ye(m),Y&&Y.d(),K&&K.d(),ye(E),O&&O.d()}}}function q9(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x;fe(t,kt,Ue=>n(127,a=Ue)),fe(t,Ct,Ue=>n(128,l=Ue)),fe(t,Oa,Ue=>n(130,f=Ue)),fe(t,Zs,Ue=>n(131,p=Ue)),fe(t,qs,Ue=>n(134,g=Ue)),fe(t,ns,Ue=>n(135,w=Ue)),fe(t,Pr,Ue=>n(137,b=Ue)),fe(t,as,Ue=>n(138,E=Ue)),fe(t,Ql,Ue=>n(12,V=Ue)),fe(t,yi,Ue=>n(18,Q=Ue)),fe(t,Ba,Ue=>n(35,Le=Ue));const Ne="wakeLock"in navigator,{supportsFileSystem:We,sandboxElement:tt}=Bo("context"),ke=[Be.NONE,Be.RESTART_PLAYBACK,Be.TOGGLE_PLAY_PAUSE,Be.TOGGLE_PLAYBACK_LOOP,Be.TOGGLE_BOOKMARK,Be.TOGGLE_MERGE,Be.EDIT_SUBTITLE,Be.RESTORE_SUBTITLE,Be.COPY_SUBTITLE,Be.EXPORT_NEW,Be.EXPORT_UPDATE],Pe=[Yl.ALWAYS,Yl.PAGE],Xe=[Kl.AUTO,Kl.INSTANT,Kl.SMOOTH],qe=[er.DISABLED,er.CLICK,er.HOLD],it=[ql.DISABLED,ql.PAUSE],Je=[Sr.HIDDEN,Sr.ALWAYS,Sr.HOVER,Sr.TOGGLE],U=[ui.DISABLED,ui.MODERATE,ui.STRICT],T=[Rs.BEFORE,Rs.AFTER,Rs.REPLACE],d=[Tr.RECORDER,Tr.FFMPEG],A=[ci.DISABLED,ci.DECK,ci.SUBDECK,ci.COLLECTION],{readerLineHighlightColor$:N,readerLineTextHighlightColor$:j,readerEnableLineHighlight$:ee,readerEnableLineTextHighlight$:te,readerEnableAutoScroll$:se,readerScrollMode$:be,readerClickAction$:he,readerMenuOpenMode$:Ce,subtitlesEnablePersist$:Re,subtitlesCopyFontFamily$:Fe,subtitlesCopyFontSize$:nt,subtitlesCopyLineHeight$:pt,subtitlesClickAction$:je,subtitlesActionsVisibility$:ft,subtitlesGlobalStartPadding$:Oe,subtitlesGlobalEndPadding$:$e,playerEnableCover$:at,playerEnableChapters$:Ge,playerAutoPauseMode$:mt,playerRewindTime$:Qe,playerAltRewindTime$:vt,playerFastForwardTime$:Lt,playerAltFastForwardTime$:lt,exportAudioProcessor$:Et,exportAudioFormat$:dt,exportCoverFormat$:Gt,ankiDuplicateMode$:Qt,ankiUrl$:Kt,ankiKey$:zt,ankiDeck$:nn,ankiUpdateDeck$:Ln,ankiModel$:On,ankiUpdateModel$:xn,ankiSentenceField$:Ut,ankiUpdateSentenceField$:Nt,ankiSoundField$:en,ankiUpdateSoundField$:on,ankiCoverField$:Ye,ankiUpdateCoverField$:ct,actionListOfReader$:br,actionListOfSubtitles$:Un,actionListOfFooter$:tn}=_t;fe(t,N,Ue=>n(141,k=Ue)),fe(t,j,Ue=>n(142,L=Ue)),fe(t,ee,Ue=>n(105,P=Ue)),fe(t,te,Ue=>n(104,$=Ue)),fe(t,se,Ue=>n(13,v=Ue)),fe(t,be,Ue=>n(106,ae=Ue)),fe(t,he,Ue=>n(14,D=Ue)),fe(t,Ce,Ue=>n(15,F=Ue)),fe(t,Re,Ue=>n(136,_=Ue)),fe(t,Fe,Ue=>n(19,W=Ue)),fe(t,nt,Ue=>n(20,O=Ue)),fe(t,pt,Ue=>n(21,C=Ue)),fe(t,je,Ue=>n(16,Y=Ue)),fe(t,ft,Ue=>n(17,K=Ue)),fe(t,Oe,Ue=>n(140,h=Ue)),fe(t,$e,Ue=>n(139,R=Ue)),fe(t,at,Ue=>n(133,m=Ue)),fe(t,Ge,Ue=>n(132,y=Ue)),fe(t,mt,Ue=>n(3,H=Ue)),fe(t,Qe,Ue=>n(36,Ie=Ue)),fe(t,vt,Ue=>n(37,et=Ue)),fe(t,Lt,Ue=>n(38,B=Ue)),fe(t,lt,Ue=>n(39,x=Ue)),fe(t,Et,Ue=>n(2,u=Ue)),fe(t,dt,Ue=>n(143,I=Ue)),fe(t,Qt,Ue=>n(22,S=Ue)),fe(t,Kt,Ue=>n(129,c=Ue)),fe(t,zt,Ue=>n(23,M=Ue)),fe(t,On,Ue=>n(24,X=Ue)),fe(t,xn,Ue=>n(25,ie=Ue)),fe(t,Ut,Ue=>n(26,G=Ue)),fe(t,Nt,Ue=>n(27,z=Ue)),fe(t,en,Ue=>n(28,le=Ue)),fe(t,on,Ue=>n(29,Me=Ue)),fe(t,Ye,Ue=>n(30,_e=Ue)),fe(t,ct,Ue=>n(31,Ae=Ue)),fe(t,br,Ue=>n(32,Ee=Ue)),fe(t,Un,Ue=>n(33,Ve=Ue)),fe(t,tn,Ue=>n(34,Te=Ue));const Yn=new Map,wr=[Ia.CREATE,Ia.UPDATE],Wn=[$o.AUTO,$o.JPEG,$o.PNG,$o.WEBP];let Jn=Ia.CREATE,fn=li.NONE,Ar="",yr=[],dn=[],fr=[];async function ri(...Ue){await Rr();const dr="ttu-whispersync-color-styles",ir=[];P&&$?ir.push("span[class^='ttu-whispersync-line-highlight-'].active,","span[class^='ttu-whispersync-line-highlight-'].menu-open ",`{color: ${L};background-color: ${k};}`):P?ir.push("span[class^='ttu-whispersync-line-highlight-'].active,","span[class^='ttu-whispersync-line-highlight-'].menu-open ",`{background-color: ${k};}`):$?ir.push("span[class^='ttu-whispersync-line-highlight-'].active,","span[class^='ttu-whispersync-line-highlight-'].menu-open ",`{color: ${L};}`):ir.push("span[class^='ttu-whispersync-line-highlight-'].menu-open ",`{color: ${L};background-color: ${k};}`);const si=document.createTextNode(ir.join(""));let hr=document.getElementById(dr);if(hr)return hr.replaceChild(si,hr.firstChild);hr=document.createElement("style"),hr.id=dr,hr.appendChild(si),document.head.append(hr)}async function bi(){!_||!w||(pe(kt,a=!0,a),pe(Ct,l="",l),await Ps({name:w.name,subtitles:[...b.values()]}).catch(({message:Ue})=>pe(Ct,l=Ue,l)),pe(kt,a=!1,a))}async function jn(Ue,dr){pe(kt,a=!0,a);const ir=h,si=R;if(await dd(Ue,dr),!b.size||ir===h&&si===R){pe(kt,a=!1,a);return}const hr=[],jr=new Map,Qi=[...b.entries()],$l=h/1e3,Ao=R/1e3;for(let ks=0,{length:Vl}=Qi;ks<Vl;ks+=1){const[xl,Se]=Qi[ks],Ot=Se.adjustedStartSeconds??Math.max(0,Se.originalStartSeconds+$l),Cn=Se.adjustedEndSeconds??(E?Ui(0,E,Se.originalEndSeconds+Ao):Math.max(0,Se.originalEndSeconds+Ao)),un={...Se,startSeconds:Ot,startTime:qr(Ot),endSeconds:Cn,endTime:qr(Cn)};hr.push(un),jr.set(xl,un)}pe(Pr,b=jr,b),Xa.set({subtitles:hr,replaceTrack:!0}),_&&(pe(Ct,l="",l),await Ps({name:w.name,subtitles:hr}).catch(({message:ks})=>pe(Ct,l=ks,l))),pe(kt,a=!1,a)}async function Wr(){pe(kt,a=!0,a),pe(Ct,l="",l);try{await(tt?Wc(tt,{action:"setMediaInfoInstance",enableCover:m,url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm")}):pf(m,!0,""))}catch({message:Ue}){pe(Ct,l=`MediaInfo failure: ${Ue}`,l),pe(kt,a=!1,a);return}if(m&&f)try{const{coverUrl:Ue}=await Jo(f,tt,!1,!0);URL.revokeObjectURL(g),pe(qs,g=Ue,g)}catch({message:Ue}){pe(Ct,l=`Failed to set cover: ${Ue}`,l)}else m||(URL.revokeObjectURL(g),pe(qs,g="",g));pe(kt,a=!1,a)}async function He(){pe(kt,a=!0,a),pe(Ct,l="",l);try{await(tt?Wc(tt,{action:"setMediaInfoInstance",enableCover:m,url:chrome.runtime.getURL("src/assets/js/MediaInfoModule_0.2.1.wasm")}):pf(m,!0,""))}catch({message:Ue}){pe(Ct,l=`MediaInfo failure: ${Ue}`,l),pe(kt,a=!1,a);return}if(y&&f)try{let{chapters:Ue}=await Jo(f,tt,!1,!0);!Ue.length&&u===Tr.FFMPEG&&(Ue=await Kc(f)),pe(Zs,p=Ue,p)}catch({message:Ue}){pe(Ct,l=`Failed to set chapters: ${Ue}`,l)}else y||pe(Zs,p=[],p);pe(kt,a=!1,a)}async function Bt({currentTarget:Ue}){if(!(Ue instanceof HTMLSelectElement))return;pe(kt,a=!0,a),pe(Ct,l="",l);let dr=Tr.RECORDER;if(u===Tr.FFMPEG)try{await bd(),await wd(f),dr=Tr.FFMPEG}catch({message:ir}){pe(Ct,l=`Update to FFMPEG failed: ${ir}`,l)}if(dr===Tr.FFMPEG&&!p.length&&y&&f&&pe(Zs,p=await Kc(f),p),dr===Tr.RECORDER)try{z_()}catch{}Ue.value=dr,pe(Et,u=dr,u),pe(kt,a=!1,a)}async function Pt(Ue=!1,dr=!1){if(!(!Ue&&!dr&&yr.length&&dn.length)){pe(kt,a=!0,a),pe(Ct,l="",l);try{(Ue||!yr.length||!dn.length)&&n(5,[yr,dn]=await Ed(c),yr,n(6,dn)),Ue&&Yn.clear();let ir=o?nn:Ln,si=o?On:xn,hr=Mt(ir),jr=Mt(si);hr&&!yr.find(Qi=>Qi===hr)&&ir.set(""),jr&&!dn.find(Qi=>Qi===jr)&&(si.set(""),jr=""),jr&&await xt(jr)}catch({message:ir}){pe(Ct,l=`Failed to get Anki data: ${ir}`,l),rn()}pe(kt,a=!1,a)}}async function xt(Ue){pe(kt,a=!0,a),pe(Ct,l="",l);try{n(7,fr=await(Yn.has(Ue)?Promise.resolve(Yn.get(Ue)):Sd(c,Ue))),Yn.set(Ue,fr);let dr=o?Ut:Nt,ir=o?en:on,si=Mt(dr),hr=Mt(ir);si&&!fr.find(jr=>jr===si)&&dr.set(""),hr&&!fr.find(jr=>jr===hr)&&ir.set("")}catch({message:dr}){pe(Ct,l=`Failed to get Anki data: ${dr}`,l),rn()}pe(kt,a=!1,a)}function rn(){Td(!o),Yn.clear(),n(5,yr=[]),n(6,dn=[]),n(7,fr=[])}function xe(Ue){fn=Ue,n(1,fn)}function Rt(Ue){fn=Ue,n(1,fn)}function At(Ue){fn=Ue,n(1,fn)}function sn(Ue){fn=Ue,n(1,fn)}const Dn=()=>Pt(!0),It=()=>{J_(M)};function Xt(){Jn=Q1(this),n(0,Jn),n(94,wr)}const Nn=()=>Pt(!1,!0),Cr=()=>xt(o?X:ie),Ws=()=>{o?pe(Ut,G="",G):pe(Nt,z="",z)},ii=()=>{o?pe(en,le="",le):pe(on,Me="",Me)},To=()=>{o?pe(Ye,_e="",_e):pe(ct,Ae="",Ae)};function js(Ue){fn=Ue,n(1,fn)}function Ea(Ue){Ee=Ue,br.set(Ee)}function Ol(Ue){fn=Ue,n(1,fn)}function ko(Ue){Ve=Ue,Un.set(Ve)}function Dl(Ue){fn=Ue,n(1,fn)}function Sa(Ue){Te=Ue,tn.set(Te)}function Nl(Ue){fn=Ue,n(1,fn)}function Fl(Ue){fn=Ue,n(1,fn)}return t.$$.update=()=>{t.$$.dirty[3]&8192&&n(11,r=ae===Yl.ALWAYS?"The reader scrolls on every subtitle change":"The reader will only scroll if the subtitle is not fully visibile on the page"),t.$$.dirty[0]&4&&n(10,i=u===Tr.RECORDER?"Use realtime audio recording - requires to block certain actions during export":"Use background transcoding (file limit ~1.8 GB) - has certain performance requirements and may crash the site but is non blocking. Reload the page/use recorder in case of issues"),t.$$.dirty[0]&4&&n(9,s=u===Tr.FFMPEG?[Ms.MP3,Ms.OGG,Ms.OPUS]:[Ms.MP3]),t.$$.dirty[0]&1&&n(8,o=Jn===Ia.CREATE),t.$$.dirty[0]&8&&(H===ui.DISABLED?n(4,Ar="Player does not auto pause"):n(4,Ar=H===ui.MODERATE?"Player will auto pause when the browser tab loses focus":"Player will auto pause on any kind of site focus loss (e. g. different window etc.)")),t.$$.dirty[0]&4&&u===Tr.RECORDER&&pe(dt,I=Ms.MP3,I),t.$$.dirty[0]&2&&fn===li.ANKI&&Pt(),t.$$.dirty[3]&6144&&ri(P,$)},[Jn,fn,u,H,Ar,yr,dn,fr,o,s,i,r,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,ke,Pe,Xe,qe,it,Je,U,T,d,A,N,j,ee,te,se,be,he,Ce,Re,Fe,nt,pt,je,ft,Oe,$e,at,Ge,mt,Qe,vt,Lt,lt,Et,dt,Gt,Qt,Kt,zt,nn,Ln,On,xn,Ut,Nt,en,on,Ye,ct,br,Un,tn,wr,Wn,ri,bi,jn,Wr,He,Bt,Pt,xt,$,P,ae,xe,Rt,At,sn,Dn,It,Xt,Nn,Cr,Ws,ii,To,js,Ea,Ol,ko,Dl,Sa,Nl,Fl]}class Z9 extends In{constructor(e){super(),Pn(this,e,q9,K9,Tn,{},null,[-1,-1,-1,-1,-1])}}const{window:K2}=Ic;function q2(t){let e,n;return e=new ff({props:{isFooter:!0,buttonClasses:"h-full hover:opacity-70",listItems:t[6],hideCancelAction:!t[2],subtitle:t[14]||t[4].get(t[21].current||t[21].previous)}}),e.$on("executed",t[80]),{c(){ve(e.$$.fragment)},m(r,i){we(e,r,i),n=!0},p(r,i){const s={};i[0]&64&&(s.listItems=r[6]),i[0]&4&&(s.hideCancelAction=!r[2]),i[0]&2113552&&(s.subtitle=r[14]||r[4].get(r[21].current||r[21].previous)),e.$set(s)},i(r){n||(J(e.$$.fragment,r),n=!0)},o(r){ne(e.$$.fragment,r),n=!1},d(r){ye(e,r)}}}function J9(t){let e;return{c(){e=ge("ol"),e.innerHTML=`<li>Install Anki and configure deck and note type</li> <li>Install AnkiConnect and configure deck and note type</li> <li>Add https://reader.ttsu.app to the webCorsOriginList of AnkiConnect</li> <li>Load subtitle/audio files</li> <li>Switch to &quot;Match&quot; Tab, match the subtitle against your book and click on &quot;Save &amp; reload
							page&quot; to enable full functionality like reader highlighting, reader menu, autoscroll etc.
							after the page was reloaded</li> <li>Configure your experience to your preferences by going to the settings tab</li> <li>Read <a href="https://github.com/Renji-XD/ttu-whispersync" target="_blank">FAQ &amp; more</a> for
							further Information</li>`,re(e,"class","getting-started")},m(n,r){de(n,e,r)},p:wt,d(n){n&&ce(e)}}}function Q9(t){let e,n,r;return n=new Tt({props:{path:to}}),{c(){e=ge("div"),ve(n.$$.fragment),re(e,"slot","icon")},m(i,s){de(i,e,s),we(n,e,null),r=!0},p:wt,i(i){r||(J(n.$$.fragment,i),r=!0)},o(i){ne(n.$$.fragment,i),r=!1},d(i){i&&ce(e),ye(n)}}}function Z2(t){let e,n,r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k=t[4].size&&!t[5].matchedBy&&J2(t),L=t[27].length&&Q2(t),$={showMenu:t[11]};return c=new zy({props:$}),t[91](c),p=new Dv({}),p.$on("selectHint",t[92]),p.$on("hintSelected",t[93]),g=new Ky({}),b=new Z9({}),{c(){e=ge("div"),n=ge("button"),n.textContent=`${pn.AUDIOBOOK}`,r=me(),k&&k.c(),i=me(),L&&L.c(),s=me(),o=ge("button"),o.textContent=`${pn.SETTINGS}`,a=me(),l=ge("div"),ve(c.$$.fragment),u=me(),f=ge("div"),ve(p.$$.fragment),y=me(),m=ge("div"),ve(g.$$.fragment),w=me(),_=ge("div"),ve(b.$$.fragment),re(n,"title","Switch to Audiobook tab"),ht(n,"tab-active",t[26]===pn.AUDIOBOOK),re(o,"title","Switch to Settings tab"),ht(o,"tab-active",t[26]===pn.SETTINGS),re(e,"class","flex justify-between w-full tabs m-b-s"),re(l,"class","flex-col flex-1 m-b-s"),ht(l,"hidden",t[26]!==pn.AUDIOBOOK),ht(l,"flex",t[26]===pn.AUDIOBOOK),re(f,"class","flex flex-col flex-1"),ht(f,"hidden",t[26]!==pn.MATCH),re(m,"class","overflow-auto"),ht(m,"hidden",t[26]!==pn.CHAPTERS),re(_,"class","overflow-auto"),ht(_,"hidden",t[26]!==pn.SETTINGS)},m(P,I){de(P,e,I),oe(e,n),oe(e,r),k&&k.m(e,null),oe(e,i),L&&L.m(e,null),oe(e,s),oe(e,o),de(P,a,I),de(P,l,I),we(c,l,null),de(P,u,I),de(P,f,I),we(p,f,null),de(P,y,I),de(P,m,I),we(g,m,null),de(P,w,I),de(P,_,I),we(b,_,null),E=!0,R||(h=[Ke(n,"click",t[87]),Ke(o,"click",t[90])],R=!0)},p(P,I){(!E||I[0]&67108864)&&ht(n,"tab-active",P[26]===pn.AUDIOBOOK),P[4].size&&!P[5].matchedBy?k?k.p(P,I):(k=J2(P),k.c(),k.m(e,i)):k&&(k.d(1),k=null),P[27].length?L?L.p(P,I):(L=Q2(P),L.c(),L.m(e,s)):L&&(L.d(1),L=null),(!E||I[0]&67108864)&&ht(o,"tab-active",P[26]===pn.SETTINGS);const H={};I[0]&2048&&(H.showMenu=P[11]),c.$set(H),(!E||I[0]&67108864)&&ht(l,"hidden",P[26]!==pn.AUDIOBOOK),(!E||I[0]&67108864)&&ht(l,"flex",P[26]===pn.AUDIOBOOK),(!E||I[0]&67108864)&&ht(f,"hidden",P[26]!==pn.MATCH),(!E||I[0]&67108864)&&ht(m,"hidden",P[26]!==pn.CHAPTERS),(!E||I[0]&67108864)&&ht(_,"hidden",P[26]!==pn.SETTINGS)},i(P){E||(J(c.$$.fragment,P),J(p.$$.fragment,P),J(g.$$.fragment,P),J(b.$$.fragment,P),E=!0)},o(P){ne(c.$$.fragment,P),ne(p.$$.fragment,P),ne(g.$$.fragment,P),ne(b.$$.fragment,P),E=!1},d(P){P&&(ce(e),ce(a),ce(l),ce(u),ce(f),ce(y),ce(m),ce(w),ce(_)),k&&k.d(),L&&L.d(),t[91](null),ye(c),ye(p),ye(g),ye(b),R=!1,vn(h)}}}function J2(t){let e,n,r;return{c(){e=ge("button"),e.textContent=`${pn.MATCH}`,re(e,"title","Switch to Match tab"),ht(e,"tab-active",t[26]===pn.MATCH)},m(i,s){de(i,e,s),n||(r=Ke(e,"click",t[88]),n=!0)},p(i,s){s[0]&67108864&&ht(e,"tab-active",i[26]===pn.MATCH)},d(i){i&&ce(e),n=!1,r()}}}function Q2(t){let e,n,r;return{c(){e=ge("button"),e.textContent=`${pn.CHAPTERS}`,re(e,"title","Switch to Chapters tab"),ht(e,"tab-active",t[26]===pn.CHAPTERS)},m(i,s){de(i,e,s),n||(r=Ke(e,"click",t[89]),n=!0)},p(i,s){s[0]&67108864&&ht(e,"tab-active",i[26]===pn.CHAPTERS)},d(i){i&&ce(e),n=!1,r()}}}function e7(t){var X,ie;let e,n,r,i,s,o,a,l,c,u,f,p=(t[1]||t[16])+"",y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O;n=new Tt({props:{path:pg}});let C=t[3]&&q2(t);s=new ev({});let S={range:t[0],subtitle:t[14]};a=new $v({props:S}),t[81](a),a.$on("close",t[82]),_=new Tt({props:{path:Pd}}),R=new pi({props:{$$slots:{icon:[Q9],default:[J9]},$$scope:{ctx:t}}}),L=new Tt({props:{path:bg}}),H=new Tt({props:{path:_g}}),v=new Tt({props:{path:sg}});let M=!t[1]&&((X=t[20])==null?void 0:X.elementHtml)&&((ie=t[17])==null?void 0:ie.title)&&Z2(t);return{c(){e=ge("button"),ve(n.$$.fragment),r=me(),C&&C.c(),i=me(),ve(s.$$.fragment),o=me(),ve(a.$$.fragment),l=me(),c=ge("div"),u=ge("div"),f=ge("button"),y=Ft(p),m=me(),g=ge("div"),w=ge("button"),ve(_.$$.fragment),b=me(),E=ge("div"),ve(R.$$.fragment),h=me(),k=ge("button"),ve(L.$$.fragment),P=me(),I=ge("button"),ve(H.$$.fragment),ae=me(),V=ge("button"),ve(v.$$.fragment),D=me(),F=ge("div"),M&&M.c(),Y=me(),K=ge("div"),K.innerHTML='<span class="spinner"></span>',re(e,"class","h-full hover:opacity-70"),ht(e,"text-red-500",t[1]||t[16]),ht(e,"animate-pulse",t[1]||t[16]),re(w,"title","Close menu"),ht(w,"m-l-b",t[13]),ht(w,"m-r-b",!t[13]),re(E,"title","Getting started"),ht(E,"m-l-b",t[13]),ht(E,"m-r-b",!t[13]),re(k,"title",$=`Switch menu position to ${t[13]?"right":"left"}`),re(k,"class","side-menu-only"),ht(k,"m-l-s",t[13]),ht(k,"m-r-s",!t[13]),re(I,"title","Reset menu width"),re(I,"class","side-menu-only"),ht(I,"m-l-s",t[13]),ht(I,"m-r-s",!t[13]),re(V,"title","Resize menu width"),re(V,"class","resize-cursor side-menu-only"),ht(V,"m-l-s",t[13]),ht(V,"m-r-s",!t[13]),re(g,"class","flex right-menu"),ht(g,"left-menu",t[13]),re(u,"class","flex justify-between right-menu p-4"),ht(u,"left-menu",t[13]),re(F,"class","flex flex-col flex-1 p-x-b p-y-s"),ht(F,"overflow-auto",t[26]===pn.SETTINGS||t[26]===pn.CHAPTERS),re(K,"class","backdrop"),ht(K,"hidden",!t[15]),re(c,"class","ttu-whispersync-container side-menu flex-col justify-between fixed top-0 left-0 h-full writing-horizontal-tb z-[60]"),ht(c,"left-0",t[13]),ht(c,"right-0",!t[13]),ht(c,"hidden",!t[11]),ht(c,"flex",t[11]),Mr(c,"width",t[12]||null)},m(G,z){de(G,e,z),we(n,e,null),de(G,r,z),C&&C.m(G,z),de(G,i,z),we(s,G,z),de(G,o,z),we(a,G,z),de(G,l,z),de(G,c,z),oe(c,u),oe(u,f),oe(f,y),oe(u,m),oe(u,g),oe(g,w),we(_,w,null),oe(g,b),oe(g,E),we(R,E,null),oe(g,h),oe(g,k),we(L,k,null),oe(g,P),oe(g,I),we(H,I,null),oe(g,ae),oe(g,V),we(v,V,null),oe(c,D),oe(c,F),M&&M.m(F,null),oe(c,Y),oe(c,K),t[94](c),Q=!0,W||(O=[Ke(K2,"resize",t[51]),Ke(K2,"keydown",t[50]),Ke(e,"click",Aa(t[79])),Ke(f,"click",t[83]),Ke(w,"click",t[84]),Ke(k,"click",t[85]),Ke(I,"click",t[86]),Ke(V,"pointerdown",Wl(t[52])),Ke(c,"wheel",Aa(t[78]),{passive:!0})],W=!0)},p(G,z){var _e,Ae;(!Q||z[0]&65538)&&ht(e,"text-red-500",G[1]||G[16]),(!Q||z[0]&65538)&&ht(e,"animate-pulse",G[1]||G[16]),G[3]?C?(C.p(G,z),z[0]&8&&J(C,1)):(C=q2(G),C.c(),J(C,1),C.m(i.parentNode,i)):C&&(Wt(),ne(C,1,1,()=>{C=null}),jt());const le={};z[0]&1&&(le.range=G[0]),z[0]&16384&&(le.subtitle=G[14]),a.$set(le),(!Q||z[0]&65538)&&p!==(p=(G[1]||G[16])+"")&&ln(y,p),(!Q||z[0]&8192)&&ht(w,"m-l-b",G[13]),(!Q||z[0]&8192)&&ht(w,"m-r-b",!G[13]);const Me={};z[5]&16&&(Me.$$scope={dirty:z,ctx:G}),R.$set(Me),(!Q||z[0]&8192)&&ht(E,"m-l-b",G[13]),(!Q||z[0]&8192)&&ht(E,"m-r-b",!G[13]),(!Q||z[0]&8192&&$!==($=`Switch menu position to ${G[13]?"right":"left"}`))&&re(k,"title",$),(!Q||z[0]&8192)&&ht(k,"m-l-s",G[13]),(!Q||z[0]&8192)&&ht(k,"m-r-s",!G[13]),(!Q||z[0]&8192)&&ht(I,"m-l-s",G[13]),(!Q||z[0]&8192)&&ht(I,"m-r-s",!G[13]),(!Q||z[0]&8192)&&ht(V,"m-l-s",G[13]),(!Q||z[0]&8192)&&ht(V,"m-r-s",!G[13]),(!Q||z[0]&8192)&&ht(g,"left-menu",G[13]),(!Q||z[0]&8192)&&ht(u,"left-menu",G[13]),!G[1]&&((_e=G[20])!=null&&_e.elementHtml)&&((Ae=G[17])!=null&&Ae.title)?M?(M.p(G,z),z[0]&1179650&&J(M,1)):(M=Z2(G),M.c(),J(M,1),M.m(F,null)):M&&(Wt(),ne(M,1,1,()=>{M=null}),jt()),(!Q||z[0]&67108864)&&ht(F,"overflow-auto",G[26]===pn.SETTINGS||G[26]===pn.CHAPTERS),(!Q||z[0]&32768)&&ht(K,"hidden",!G[15]),(!Q||z[0]&8192)&&ht(c,"left-0",G[13]),(!Q||z[0]&8192)&&ht(c,"right-0",!G[13]),(!Q||z[0]&2048)&&ht(c,"hidden",!G[11]),(!Q||z[0]&2048)&&ht(c,"flex",G[11]),z[0]&4096&&Mr(c,"width",G[12]||null)},i(G){Q||(J(n.$$.fragment,G),J(C),J(s.$$.fragment,G),J(a.$$.fragment,G),J(_.$$.fragment,G),J(R.$$.fragment,G),J(L.$$.fragment,G),J(H.$$.fragment,G),J(v.$$.fragment,G),J(M),Q=!0)},o(G){ne(n.$$.fragment,G),ne(C),ne(s.$$.fragment,G),ne(a.$$.fragment,G),ne(_.$$.fragment,G),ne(R.$$.fragment,G),ne(L.$$.fragment,G),ne(H.$$.fragment,G),ne(v.$$.fragment,G),ne(M),Q=!1},d(G){G&&(ce(e),ce(r),ce(i),ce(o),ce(l),ce(c)),ye(n),C&&C.d(G),ye(s,G),t[81](null),ye(a,G),ye(_),ye(R),ye(L),ye(H),ye(v),M&&M.d(),t[94](null),W=!1,vn(O)}}}const kc="ttu-whispersync-side-menu-width";function t7(t,e,n){let r,i,s,o,a,l,c,u,f,p,y,m,g,w,_,b,E,R,h,k,L,$,P,I,H,ae,V,v,D,F,Y,K,Q,W,O,C,S,M,X,ie,G,z,le,Me,_e,Ae,Ee,Ve,Te,Le,Ie,et,B,x,Ne,We,tt,ke,Pe,Xe,qe,it,Je,U,T,d,A,N,j,ee,te,se;fe(t,Ga,Se=>n(14,a=Se)),fe(t,Pr,Se=>n(4,f=Se)),fe(t,Ba,Se=>n(104,y=Se)),fe(t,kt,Se=>n(15,m=Se)),fe(t,Ct,Se=>n(16,g=Se)),fe(t,Lr,Se=>n(17,w=Se)),fe(t,as,Se=>n(18,_=Se)),fe(t,ns,Se=>n(62,R=Se)),fe(t,Da,Se=>n(107,h=Se)),fe(t,qs,Se=>n(108,k=Se)),fe(t,Ql,Se=>n(109,L=Se)),fe(t,En,Se=>n(111,P=Se)),fe(t,Hi,Se=>n(19,I=Se)),fe(t,Ri,Se=>n(20,H=Se)),fe(t,Uo,Se=>n(5,ae=Se)),fe(t,Ho,Se=>n(112,V=Se)),fe(t,iu,Se=>n(63,v=Se)),fe(t,os,Se=>n(21,F=Se)),fe(t,yi,Se=>n(64,K=Se)),fe(t,kn,Se=>n(115,Q=Se)),fe(t,xi,Se=>n(65,W=Se)),fe(t,ss,Se=>n(116,C=Se)),fe(t,Fa,Se=>n(67,S=Se)),fe(t,Na,Se=>n(68,M=Se)),fe(t,Yo,Se=>n(117,X=Se)),fe(t,is,Se=>n(118,ie=Se)),fe(t,rs,Se=>n(119,G=Se)),fe(t,Ls,Se=>n(70,le=Se)),fe(t,eu,Se=>n(72,_e=Se)),fe(t,ru,Se=>n(120,Ae=Se)),fe(t,nu,Se=>n(121,Ee=Se)),fe(t,ja,Se=>n(122,Ve=Se)),fe(t,Wa,Se=>n(123,Te=Se)),fe(t,Xo,Se=>n(124,Le=Se)),fe(t,zo,Se=>n(125,Ie=Se)),fe(t,Go,Se=>n(126,et=Se)),fe(t,jo,Se=>n(127,B=Se)),fe(t,Wo,Se=>n(128,x=Se)),fe(t,Ua,Se=>n(129,Ne=Se)),fe(t,Ha,Se=>n(130,We=Se)),fe(t,xa,Se=>n(131,tt=Se)),fe(t,Va,Se=>n(132,ke=Se)),fe(t,$a,Se=>n(133,Pe=Se)),fe(t,ud,Se=>n(7,T=Se)),fe(t,Js,Se=>n(26,te=Se)),fe(t,Zs,Se=>n(27,se=Se));let{componentContainerElement:be}=e,{bookContentElement:he}=e,{sandboxElement:Ce}=e,{currentBookId:Re}=e;const Fe="showOpenFilePicker"in window,nt=(window.localStorage.getItem("writingMode")||"vertical-rl")==="vertical-rl",pt=(window.localStorage.getItem("viewMode")||"paginated")==="paginated",je=`-${window.localStorage.getItem("firstDimensionMargin")||0}px`,ft=pt?void 0:new IntersectionObserver(Ea,{rootMargin:nt?`0px ${je} 0px ${je}`:`${je} 0px ${je} 0px`}),Oe=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="iPad"||navigator.platform==="iPhone"||navigator.platform==="iPod",{readerEnableAutoReload$:$e,readerEnableFilesystemApi$:at,readerPreventActionOnSelection$:Ge,readerEnableMenuTarget$:mt,readerClickAction$:Qe,readerMenuOpenMode$:vt,readerMenuPauseMode$:Lt,readerMenuOpenTime$:lt,subtitlesGlobalStartPadding$:Et,subtitlesGlobalEndPadding$:dt,playerAltRewindTime$:Gt,playerRewindTime$:Qt,playerFastForwardTime$:Kt,playerAltFastForwardTime$:zt,ankiUrl$:nn,ankiDeck$:Ln,ankiModel$:On,ankiSoundField$:xn,ankiSentenceField$:Ut,exportAudioProcessor$:Nt,actionListOfFooter$:en,keybindingsEnableTimeFallback$:on}=_t;fe(t,$e,Se=>n(110,$=Se)),fe(t,at,Se=>n(77,d=Se)),fe(t,Ge,Se=>n(102,u=Se)),fe(t,mt,Se=>n(114,Y=Se)),fe(t,Qe,Se=>n(60,l=Se)),fe(t,vt,Se=>n(61,c=Se)),fe(t,Lt,Se=>n(66,O=Se)),fe(t,lt,Se=>n(103,p=Se)),fe(t,Et,Se=>n(106,E=Se)),fe(t,dt,Se=>n(105,b=Se)),fe(t,Gt,Se=>n(22,A=Se)),fe(t,Qt,Se=>n(23,N=Se)),fe(t,Kt,Se=>n(24,j=Se)),fe(t,zt,Se=>n(25,ee=Se)),fe(t,nn,Se=>n(76,U=Se)),fe(t,Ln,Se=>n(75,Je=Se)),fe(t,On,Se=>n(74,it=Se)),fe(t,xn,Se=>n(71,Me=Se)),fe(t,Ut,Se=>n(69,z=Se)),fe(t,Nt,Se=>n(73,qe=Se)),fe(t,en,Se=>n(6,Xe=Se)),fe(t,on,Se=>n(113,D=Se));let Ye,ct,br,Un,tn,Yn,wr=!1,Wn="",Jn=window.matchMedia("(min-width: 1000px)").matches&&window.localStorage.getItem(kc)||"",fn=0,Ar=0,yr=0,dn=0,fr;pe(Ba,y=navigator.maxTouchPoints>0,y),f_("context",{bookContentElement:he,sandboxElement:Ce,isVertical:nt,isPaginated:pt,supportsFileSystem:Fe,isIOS:Oe}),La(Bt),Gl(()=>{Nn(),document.removeEventListener("ttsu:skipKeyListener",Pt,!1),document.removeEventListener("ttsu:page.change",xt,!1),ft==null||ft.disconnect(),K&&K.abort("user aborted"),Is(k,h)});function ri(Se){var sr;if(P||Se.repeat||!(Se.ctrlKey||Se.metaKey||Se.altKey))return;const Ot=Se.code||((sr=Se.key)==null?void 0:sr.toLowerCase()),Cn=Y&&c!==er.DISABLED?a:void 0;let un,Fn=Cn||f.get(F.current||F.previous);if(!Fn&&D&&(Fn=[...f.values()].findLast(vr=>I>=vr.startSeconds)),Se.altKey)switch(Ot){case"KeyE":case"e":un=Be.EXPORT_UPDATE;break;case"KeyG":case"g":un=Be.EDIT_SUBTITLE;break;case"KeyZ":case"z":un=Be.COPY_SUBTITLE;break;case"KeyH":case"h":un=Be.NONE,pe(iu,v=!v,v);break;default:un=Be.NONE;break}else switch(Ot){case"KeyB":case"b":un=Be.TOGGLE_BOOKMARK;break;case"KeyM":case"m":un=Be.TOGGLE_MERGE;break;case"KeyE":case"e":un=Be.EXPORT_NEW;break;case"KeyO":case"o":Fn=mn(0),un=Be.OPEN_LAST_EXPORTED_CARD;break;default:un=Be.NONE;break}un!==Be.NONE&&(Se.preventDefault(),Se.stopPropagation(),Bn(un,Fn))}function bi(){window.clearTimeout(fr),fr=window.setTimeout(()=>{fr=void 0,n(12,Jn=window.matchMedia("(min-width: 1000px)").matches&&window.localStorage.getItem(kc)||""),ct==null||ct.resetSubtitleContainerHeight(),ct==null||ct.scrollToSubtitle()},1e3)}function jn(Se){fn=Ye.getBoundingClientRect().width,Ar=Se.pageX,window.addEventListener("pointermove",Wr,!1),window.addEventListener("pointerup",He,!1)}function Wr(Se){n(12,Jn=r?`${fn+(Se.pageX-Ar)}px`:`${fn-(Se.pageX-Ar)}px`)}function He(){window.removeEventListener("pointermove",Wr,!1),window.removeEventListener("pointerup",He,!1),window.localStorage.setItem(kc,Jn),ct==null||ct.resetSubtitleContainerHeight()}async function Bt(){let Se;document.addEventListener("ttsu:skipKeyListener",Pt,!1),pe(kt,m=!0,m);try{if(!V){const vr=await new Promise((Gs,es)=>{document.addEventListener("ttsu:db.version",({detail:Mc})=>{if(Mc>5)return Gs(Mc);es(new Error("Invalid ttu version"))},{once:!0,capture:!1}),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"dbVersion"}})),setTimeout(()=>es(new Error("Invalid ttu version")),5e3)});await hv(vr)}await new Promise(vr=>{document.addEventListener("ttsu:synced",vr,{once:!0,capture:!1}),document.dispatchEvent(new CustomEvent("ttu-action",{detail:{type:"waitForSync"}}))});const Ot=await V.get("data",Re);if(!Ot||!Ot.title||!Ot.elementHtml&&!Ot.storageSource)throw new Error(`required data for id ${Re} not found`);if(!Ot.elementHtml&&Ot.storageSource)throw new Error("books from external storage sources are currently not supported");Se=uu(new DOMParser,Ot.elementHtml);const Cn=Se.firstElementChild,[un,Fn,sr,oi]=await Promise.all([V.get("audioBook",Ot.title),V.get("subtitle",Ot.title),...L?[V.get("handle",[Ot.title,"audioBook"]),V.get("handle",[Ot.title,"subtitle"])]:[]]);Cn instanceof HTMLElement&&pe(Uo,ae={matchedBy:Cn.dataset.ttuWhispersyncMatchedBy||"",matchedOn:Number.parseInt(Cn.dataset.ttuWhispersyncMatchedOn||"0",10)},ae),pe(Ri,H=Ot,H),pe(Lr,w={title:Ot.title,lastAudio:(sr==null?void 0:sr.handle)instanceof FileSystemFileHandle?sr.handle:void 0,lastSubtitle:(oi==null?void 0:oi.handle)instanceof FileSystemFileHandle?oi.handle:void 0,playbackPosition:(un==null?void 0:un.playbackPosition)||0,subtitleData:Fn==null?void 0:Fn.subtitleData},w),pe(Hi,I=(un==null?void 0:un.playbackPosition)||0,I)}catch({message:Ot}){n(1,Wn=`Initialization failed: ${Ot}`)}if(Wn){pe(kt,m=!1,m);return}pt&&document.addEventListener("ttsu:page.change",xt,!1),await rn()}function Pt({detail:Se}){pe(En,P=Se,P)}function xt(){ii()}async function rn(Se=!1){Se&&pe(kt,m=!0,m),($||Se)&&await xe(),await Rt(!h||Se)}async function xe(Se=!0){const Ot=!R&&w.lastSubtitle?w.lastSubtitle:void 0,Cn=!h&&w.lastAudio?w.lastAudio:void 0;if(!L||!Ot&&!Cn)return;try{await yh([Ot,Cn])}catch({message:Fn}){if(!Fn.includes("activation is required"))pe(Ct,g=`Failed to reload file(s): ${Fn}`,g);else{if(Se)return!await new Promise(oi=>xo.add({component:Sh,props:{dialogHeader:"Reopen files",dialogMessage:"Click confirm to reopen files",isFileReopen:Fe,resolver:oi}}))&&L?xe(!1):void 0;pe(Ct,g=`Failed to acccess files: ${Fn}`,g)}}if(g)return;const un=[];if(Ot)try{const Fn=await Ot.getFile();await ku(Fn,document,!0)}catch({message:Fn}){un.push(`Failed to load subtitle file: ${Fn}`),us()}if(Cn)try{const Fn=await Cn.getFile();await Jo(Fn,Ce,!0)}catch({message:Fn}){un.push(`Failed to load audio file: ${Fn}`),await Is(k,h)}un.length&&pe(Ct,g=un.join("; "),g)}async function Rt(Se=!1){if(g||R||!w.subtitleData||!w.subtitleData.subtitles.length){Se&&pe(kt,m=!1,m);return}try{const Ot=new Map,Cn=E/1e3,un=b/1e3;for(let sr=0,{length:oi}=w.subtitleData.subtitles;sr<oi;sr+=1){const vr=w.subtitleData.subtitles[sr],Gs=Math.max(0,vr.adjustedStartSeconds??vr.originalStartSeconds+Cn),es=_?Ui(0,_,vr.adjustedEndSeconds??vr.originalEndSeconds+un):Math.max(0,vr.adjustedEndSeconds??vr.originalEndSeconds+un);Ot.set(vr.id,{...vr,startSeconds:Gs,startTime:qr(Gs),endSeconds:es,endTime:qr(es)})}const Fn=new Blob([""],{type:"application/x-subrip;charset=utf-8"});us(new File([Fn],w.subtitleData.name,{type:Fn.type}),Ot)}catch({message:Ot}){pe(Ct,g=`Failed to load persisted subtitle: ${Ot}`,g),us()}Se&&pe(kt,m=!1,m)}function At(Se,Ot,Cn){Nn(),ii(),Se===er.CLICK||Se===er.DISABLED&&Ot!==Be.NONE?he.addEventListener("click",sn,!1):Se===er.HOLD&&he.addEventListener("pointerdown",Dn,!1)}function sn(Se){Se.button!==0||!Ws(Se)||js()}function Dn(Se){var Ot;Se.button!==0||!Ws(Se)||(pt||(yr=nt?Se.pageX:Se.pageY,dn=0,window.addEventListener("pointermove",It,!1)),u&&y&&((Ot=window.getSelection())==null||Ot.removeAllRanges(),document.body.style.userSelect="none"),he.addEventListener("pointerup",Xt,!1),br=window.setTimeout(js,p))}function It(Se){const Ot=nt?Se.pageX:Se.pageY;dn=Math.abs(Ot-yr)}function Xt(){var Se;Cr()||((!u||!((Se=window.getSelection())!=null&&Se.toString().trim()))&&(To(),Bn(l,a)),ii())}function Nn(){Cr(),he.removeEventListener("click",sn,!1),he.removeEventListener("pointerdown",Dn,!1)}function Cr(){return clearTimeout(br),window.removeEventListener("pointermove",It,!1),he.removeEventListener("pointerup",Xt,!1),document.body.style.userSelect="auto",!pt&&dn>10}function Ws(Se){const Ot=document.elementFromPoint(Se.x,Se.y),Cn=Ot==null?void 0:Ot.closest(cu());return Cn instanceof HTMLSpanElement?Un=Cn:Yn!=null&&Yn.isInReaderMenu(Ot)||ii(),Un}function ii(Se=!0){const Ot=he.querySelectorAll(`${cu()}.menu-open`);for(let Cn=0,{length:un}=Ot;Cn<un;Cn+=1)Ot[Cn].classList.remove("menu-open");ft==null||ft.disconnect(),Se&&(Un=void 0,n(0,tn=void 0),pe(Ga,a=void 0,a))}function To(){if(!Un)return["",""];const Se=jc(Un),Ot=a==null?void 0:a.id;return pe(Ga,a=f.get(Se),a),[Ot,Se]}function js(){var oi;if(Cr())return;if(!Un||u&&((oi=window.getSelection())!=null&&oi.toString().trim()))return ii();if(c===er.DISABLED&&l!==Be.NONE)return Xt();const[Se,Ot]=To();if(Se===Ot)return;const Cn=[...he.querySelectorAll(Qs(Ot))],un=Cn[0],Fn=Cn[Cn.length-1],sr=document.createRange();sr.setStart(un,0),sr.setEnd(Fn,Fn.childNodes.length),ii(!1);for(let vr=0,{length:Gs}=Cn;vr<Gs;vr+=1)Cn[vr].classList.add("menu-open");n(0,tn=sr),ft==null||ft.observe(Fn)}function Ea(Se){Se.every(Ot=>!Ot.isIntersecting)&&ii()}function Ol(Se){a&&pe(Ga,a=Se.get(a.id),a)}function ko(Se){wn.call(this,t,Se)}const Dl=()=>{n(11,wr=!0),!Wn&&!m&&rn(!0)},Sa=({detail:Se})=>{Se===Be.REWIND_ALT?Bn(Be.RESTART_PLAYBACK,mn(Math.max(0,I-A)),{keepPauseState:!0}):Se===Be.REWIND?Bn(Be.RESTART_PLAYBACK,mn(Math.max(0,I-N)),{keepPauseState:!0}):Se===Be.FAST_FORWARD?Bn(Be.RESTART_PLAYBACK,mn(Math.min(_,I+j)),{keepPauseState:!0}):Se===Be.FAST_FORWARD_ALT&&Bn(Be.RESTART_PLAYBACK,mn(Math.min(_,I+ee)),{keepPauseState:!0})};function Nl(Se){$t[Se?"unshift":"push"](()=>{Yn=Se,n(10,Yn)})}const Fl=()=>ii(),Ue=()=>pe(Ct,g="",g),dr=()=>n(11,wr=!1),ir=()=>pe(ud,T=r?"right":"left",T),si=()=>{n(12,Jn=`${36*parseFloat(window.getComputedStyle(document.documentElement).fontSize)}px`),window.localStorage.removeItem(kc),ct==null||ct.resetSubtitleContainerHeight()},hr=()=>pe(Js,te=pn.AUDIOBOOK,te),jr=()=>pe(Js,te=pn.MATCH,te),Qi=()=>pe(Js,te=pn.CHAPTERS,te),$l=()=>pe(Js,te=pn.SETTINGS,te);function Ao(Se){$t[Se?"unshift":"push"](()=>{ct=Se,n(9,ct)})}const ks=()=>n(11,wr=!1),Vl=()=>n(11,wr=!0);function xl(Se){$t[Se?"unshift":"push"](()=>{Ye=Se,n(8,Ye)})}return t.$$set=Se=>{"componentContainerElement"in Se&&n(55,be=Se.componentContainerElement),"bookContentElement"in Se&&n(56,he=Se.bookContentElement),"sandboxElement"in Se&&n(57,Ce=Se.sandboxElement),"currentBookId"in Se&&n(58,Re=Se.currentBookId)},t.$$.update=()=>{t.$$.dirty[2]&32768&&pe(Ql,L=Fe&&d,L),t.$$.dirty[0]&128&&n(13,r=T==="left"),t.$$.dirty[2]&29568&&pe(eu,_e=!!U&&!!Je&&!!it&&!!(Me&&le||z),_e),t.$$.dirty[2]&2052&&pe(xi,W=qe===Tr.RECORDER&&!!K,W),t.$$.dirty[0]&64&&n(59,i=Xe.filter(Se=>Se.enabled)),t.$$.dirty[1]&268435456|t.$$.dirty[2]&4&&n(2,s=!!K&&!!i.find(({action:Se})=>Se===Be.EXPORT_NEW||Se===Be.EXPORT_UPDATE)),t.$$.dirty[1]&268435456|t.$$.dirty[2]&2&&n(3,o=i.length&&!v),t.$$.dirty[0]&12|t.$$.dirty[1]&268435456&&n(55,be.style.width=o?`${1.9+1.9*i.length+(s?1.9:0)}rem`:"1.9rem",be),t.$$.dirty[2]&264&&(le?W?(pe($a,Pe="Recording in progress",Pe),pe(Va,ke="Recording in progress",ke),pe(xa,tt="Recording in progress",tt),pe(Ha,We="Recording in progress",We),pe(Ua,Ne="Recording in progress",Ne)):(pe($a,Pe=Be.TOGGLE_PLAYBACK,Pe),pe(Va,ke=Be.REWIND,ke),pe(xa,tt=Be.REWIND_ALT,tt),pe(Ha,We=Be.FAST_FORWARD,We),pe(Ua,Ne=Be.FAST_FORWARD_ALT,Ne)):(pe($a,Pe="Audio file required",Pe),pe(Va,ke="Audio file required",ke),pe(xa,tt="Audio file required",tt),pe(Ha,We="Audio file required",We),pe(Ua,Ne="Audio file required",Ne))),t.$$.dirty[0]&16|t.$$.dirty[2]&264&&(f.size?le?W?(pe(Wo,x="Recording in progress",x),pe(jo,B="Recording in progress",B),pe(Go,et="Recording in progress",et),pe(zo,Ie="Recording in progress",Ie),pe(Xo,Le="Recording in progress",Le)):(pe(Wo,x=Be.PREVIOUS_SUBTITLE,x),pe(jo,B=Be.NEXT_SUBTITLE,B),pe(Go,et=Be.RESTART_PLAYBACK,et),pe(zo,Ie=Be.TOGGLE_PLAY_PAUSE,Ie),pe(Xo,Le=Be.TOGGLE_PLAYBACK_LOOP,Le)):(pe(Wo,x="Audio file required",x),pe(jo,B="Audio file required",B),pe(Go,et="Audio file required",et),pe(zo,Ie="Audio file required",Ie),pe(Xo,Le="Audio file required",Le)):(pe(Wo,x="Subtitle file required",x),pe(jo,B="Subtitle file required",B),pe(Go,et="Subtitle file required",et),pe(zo,Ie="Subtitle file required",Ie),pe(Xo,Le="Subtitle file required",Le))),t.$$.dirty[0]&16|t.$$.dirty[2]&4&&(f.size?K?(pe(Wa,Te="Export in progress",Te),pe(ja,Ve="Export in progress",Ve)):(pe(Wa,Te=Be.EDIT_SUBTITLE,Te),pe(ja,Ve=Be.RESTORE_SUBTITLE,Ve)):(pe(Wa,Te="Subtitle file required",Te),pe(ja,Ve="Subtitle file required",Ve))),t.$$.dirty[0]&16&&(f.size?(pe(nu,Ee=Be.TOGGLE_BOOKMARK,Ee),pe(ru,Ae=Be.TOGGLE_MERGE,Ae)):(pe(nu,Ee="Subtitle file required",Ee),pe(ru,Ae="Subtitle file required",Ae))),t.$$.dirty[0]&16|t.$$.dirty[2]&1924&&(_e?f.size?Me&&!le&&!z?(pe(rs,G="Audio file required",G),pe(is,ie="Audio file required",ie)):K?(pe(rs,G="Export in progress",G),pe(is,ie="Export in progress",ie),pe(Yo,X=Be.CANCEL_EXPORT,X)):(pe(rs,G=Be.EXPORT_NEW,G),pe(is,ie=Be.EXPORT_UPDATE,ie),pe(Yo,X="Export not started",X)):(pe(rs,G="Subtitle file required",G),pe(is,ie="Subtitle file required",ie)):(pe(rs,G="Anki configuration required",G),pe(is,ie="Anki configuration required",ie))),t.$$.dirty[2]&100&&(M?pe(ss,C="Device not supported",C):K?pe(ss,C="Export in progress",C):S?pe(ss,C=Be.OPEN_LAST_EXPORTED_CARD,C):pe(ss,C="No card exported",C)),t.$$.dirty[0]&34|t.$$.dirty[1]&1610612736|t.$$.dirty[2]&1&&!Wn&&ae.matchedBy&&At(c,l),t.$$.dirty[0]&1|t.$$.dirty[2]&24&&tn&&O===ql.PAUSE&&!W&&pe(kn,Q=!0,Q),t.$$.dirty[0]&16&&Ol(f)},[tn,Wn,s,o,f,ae,Xe,T,Ye,ct,Yn,wr,Jn,r,a,m,g,w,_,I,H,F,A,N,j,ee,te,se,$e,at,Ge,mt,Qe,vt,Lt,lt,Et,dt,Gt,Qt,Kt,zt,nn,Ln,On,xn,Ut,Nt,en,on,ri,bi,jn,rn,ii,be,he,Ce,Re,i,l,c,R,v,K,W,O,S,M,z,le,Me,_e,qe,it,Je,U,d,ko,Dl,Sa,Nl,Fl,Ue,dr,ir,si,hr,jr,Qi,$l,Ao,ks,Vl,xl]}class n7 extends In{constructor(e){super(),Pn(this,e,t7,e7,Tn,{componentContainerElement:55,bookContentElement:56,sandboxElement:57,currentBookId:58},null,[-1,-1,-1,-1,-1,-1])}}const r7=".ttu-whispersync-container,.ttu-whispersync-container input:not([type=checkbox]),.ttu-whispersync-container select,.ttu-whispersync-container .player-progress-tooltip{background-color:var(--ttu-whispersync-background-color);color:var(--ttu-whispersync-color)}.ttu-whispersync-container .tabs button:not(.tab-active),.ttu-whispersync-container button:disabled,.ttu-whispersync-container .btn:not(:disabled):hover,.ttu-whispersync-container button.inactive-chapter{opacity:.5}.ttu-whispersync-container button:not(:disabled):hover,.ttu-whispersync-container .dropzone:hover{opacity:.7}.ttu-whispersync-container button{text-align:left}.ttu-whispersync-container button:disabled,.ttu-whispersync-container select:disabled,.ttu-whispersync-container button:disabled [role=button]{cursor:not-allowed}.ttu-whispersync-container .m-b{margin:1rem}.ttu-whispersync-container .m-y-xs{margin-top:.25rem;margin-bottom:.25rem}.ttu-whispersync-container .m-y-s{margin-top:.5rem;margin-bottom:.5rem}.ttu-whispersync-container .m-y-b{margin-top:1rem;margin-bottom:1rem}.ttu-whispersync-container .m-x-xs{margin-left:.25rem;margin-right:.25rem}.ttu-whispersync-container .m-x-s{margin-left:.5rem;margin-right:.5rem}.ttu-whispersync-container .m-t-xs{margin-top:.25rem}.ttu-whispersync-container .m-t-s{margin-top:.5rem}.ttu-whispersync-container .m-t-b{margin-top:1rem}.ttu-whispersync-container .m-r-s{margin-right:.5rem}.ttu-whispersync-container .m-r-b{margin-right:.75rem}.ttu-whispersync-container .m-b-s{margin-bottom:.5rem}.ttu-whispersync-container .m-l-s{margin-left:.5rem}.ttu-whispersync-container .m-l-b{margin-left:.75rem}.ttu-whispersync-container .p-s{padding:.5rem}.ttu-whispersync-container .p-b{padding:1rem}.ttu-whispersync-container .p-y-s{padding-top:.5rem;padding-bottom:.5rem}.ttu-whispersync-container .p-y-xs{padding-top:.25rem;padding-bottom:.25rem}.ttu-whispersync-container .p-x-xs{padding-left:.25rem;padding-right:.25rem}.ttu-whispersync-container .p-x-b{padding-right:1rem;padding-left:1rem}.ttu-whispersync-container .backdrop{flex-direction:column;position:absolute;width:100%;height:100%;top:0;left:0;z-index:100;background-color:#00000052;justify-content:center;align-items:center}.ttu-whispersync-container .backdrop:not(.hidden){display:flex}.ttu-whispersync-container .backdrop .spinner{width:48px;height:48px;border:5px solid;border-radius:50%;border-bottom-color:var(--ttu-whispersync-background-color);display:inline-block;box-sizing:border-box;animation:ttu-whispersync-spinner-rotation 1s linear infinite}.ttu-whispersync-dialog{z-index:70}.ttu-whispersync-container .slot-content{max-height:70vh;overflow:auto}.ttu-whispersync-container.popover{position:absolute;width:max-content;max-width:100%;top:0;left:0;padding:.25rem;margin:.25rem;border:1px solid;border-radius:4px;word-break:break-word;z-index:50;background-color:var(--ttu-whispersync-background-color);color:var(--ttu-whispersync-color)}.ttu-whispersync-container .getting-started{list-style:decimal;padding-left:1.5rem;max-width:75vw}.ttu-whispersync-container .getting-started a{opacity:.5}.ttu-whispersync-container .waveform{width:100;margin:1.5rem 0rem}.ttu-whispersync-container .waveform ::part(region){opacity:.1}.ttu-whispersync-container .waveform ::part(region active){opacity:.5;z-index:10}.ttu-whispersync-container .time-edit span:not(.m-b){margin:.5rem}.ttu-whispersync-container .time-edit>div{flex-direction:column;align-items:center}.ttu-whispersync-container .time-input{width:70px;height:35px;text-align:center}.ttu-whispersync-container .side-menu-only{display:none}.ttu-whispersync-container.side-menu{cursor:initial;width:100vw;border:1px solid}.ttu-whispersync-container div.right-menu{flex-direction:row-reverse}.ttu-whispersync-container div.left-menu{flex-direction:row}.ttu-whispersync-container .resize-cursor,.ttu-whispersync-container .resize-cursor [role=button]{cursor:w-resize}.ttu-whispersync-container.subtitle-container{overflow-y:auto}.ttu-whispersync-container .sub-action.show,.ttu-whispersync-container .sub.on-hover:hover .sub-action{visibility:visible}.ttu-whispersync-container .sub-action .grid,.ttu-whispersync-container .sub.on-hover:hover .sub-action .grid{grid-template-columns:repeat(3,1fr);grid-auto-flow:row;row-gap:.25rem}.ttu-whispersync-container .audio-time{font-size:smaller;font-style:italic}.ttu-whispersync-container .bg-inverted{background-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .bg-inverted>div{background-color:var(--ttu-whispersync-background-color)}.ttu-whispersync-container .color-inverted,.ttu-whispersync-container .color-inverted-hover:hover{background-color:var(--ttu-whispersync-color);color:var(--ttu-whispersync-background-color)}.ttu-whispersync-container .dropzone{border:1px solid transparent}.ttu-whispersync-container .dropzone.on-drag{border-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .tabs button:not(.tab-active):not(:disabled):hover,.ttu-whispersync-container button:not(.recording).inactive-chapter:hover{opacity:1}.ttu-whispersync-container .header-icons{align-items:flex-start;flex-wrap:wrap}.ttu-whispersync-container .cover{width:110px;height:110px;align-self:center;margin-right:1rem}.ttu-whispersync-container .match-btns{z-index:200;position:relative}.ttu-whispersync-container .diff-grid{display:grid;grid-template-columns:auto auto auto;grid-column-gap:2rem;grid-row-gap:.5rem}.ttu-whispersync-container .btn{padding:.4rem;border-radius:5px;border:1px solid}.ttu-whispersync-container .sub{cursor:pointer;border-left:1px solid transparent}.ttu-whispersync-container .sub.active{border-color:var(--ttu-whispersync-color)}.ttu-whispersync-container .player-progress-tooltip{display:none;position:absolute;top:-2rem;border:1px solid}.ttu-whispersync-container .player-progress-tooltip-button:not(.recording){opacity:1!important}.ttu-whispersync-container .playback-rates{display:flex;flex-direction:column;width:6rem;align-items:center}.ttu-whispersync-container .playback-rates input{writing-mode:vertical-lr;direction:rtl;-webkit-appearance:slider-vertical;-moz-appearance:slider-vertical;appearance:slider-vertical}.ttu-whispersync-container .playback-display{width:100%;justify-content:space-between;align-items:end}.ttu-whispersync-container details{margin-bottom:1rem}.ttu-whispersync-container summary{cursor:pointer}.ttu-whispersync-container .settings-grid{display:grid;grid-template-columns:1fr 200px .2fr;gap:.75rem;align-items:center;margin-right:.5rem}.ttu-whispersync-container .pos-nav{display:grid;grid-template-columns:auto auto auto;row-gap:1rem}.ttu-whispersync-container .truncate{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ttu-whispersync-container.reader-menu.flex-col:not(.hidden){display:flex}.ttu-whispersync-container.reader-menu:not(.hidden,.flex-col){display:grid;grid-template-columns:repeat(8,.75fr);row-gap:.25rem}.ttu-whispersync-container .sortable-list-container,.ttu-whispersync-container .sortable-list-icons{grid-column:1/4;width:90%}.ttu-whispersync-container .sortable-list-icons{display:flex;justify-content:end}.ttu-whispersync-container .sortable-list-item{border:1px solid var(--ttu-whispersync-color);margin:.25rem 0;padding:.5rem;cursor:grab;display:flex;align-items:center;justify-content:space-between}.ttu-whispersync-container .sortable-list-item.swap{opacity:.2}@keyframes ttu-whispersync-spinner-rotation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media screen and (min-width: 550px){.ttu-whispersync-container.reader-menu:not(.hidden){display:flex}}@media screen and (min-width: 1000px){.ttu-whispersync-container .diff-grid{max-width:70vw}.ttu-whispersync-container .time-edit>div{flex-direction:row}.ttu-whispersync-container .side-menu-only{display:block}.ttu-whispersync-container.side-menu{width:36rem;min-width:425px;max-width:40vw}.ttu-whispersync-container .header-icon{display:block}.ttu-whispersync-container .cover{width:160px;height:160px}.ttu-whispersync-container .waveform{width:70vw}.ttu-whispersync-container .player-progress-tooltip-button:not(.recording):hover .player-progress-tooltip{display:block;text-align:center}}";let Y1=!1,K1=0,Ac,Bl;async function e_(){var n;if(Bl)return;Bl=window.setTimeout(()=>Bl=void 0,1e3);const t=new URL(window.location.href),e=t.href.startsWith("https://reader.ttsu.app/b")||t.href.startsWith("http://localhost:5173/b")?t.searchParams.has("id"):!1;if(e&&!Y1){Y1=!0;let r=document.querySelector(".book-content");await new Promise(w=>{if(r)return w();const _=setInterval(()=>{r=document.querySelector(".book-content"),r&&(clearInterval(_),w())},500)});const i=document.querySelector(".z-10.flex.h-8.w-full");if(!r||!i||!i.firstElementChild)return;const s=window.localStorage.getItem("ttu-whispersync-reader-footer-actions");if(s){const w=JSON.parse(s),_=[];for(let b=0,{length:E}=w;b<E;b+=1){const R=w[b];xc.has(R)&&_.push({action:R,enabled:!0})}window.localStorage.setItem("ttu-whispersync-action-list-of-footer",JSON.stringify(_)),window.localStorage.removeItem("ttu-whispersync-reader-footer-actions")}K1=Number.parseInt(t.searchParams.get("id")||"0",10);const o=document.querySelector(":root"),a=document.createElement("div"),l="ttu-whispersync-styles",c="ttu-whispersync-sandbox",[u,f,p]=(((n=r.style.color.match(/rgb[a]{0,1}\((.+)\)/))==null?void 0:n[1])||"0,0,0,1").split(",").map(w=>parseFloat(w.trim()));let y=document.getElementById(c),m=document.getElementById(l),g="";m||(m=document.createElement("style"),m.id=l,m.innerText=r7,document.head.appendChild(m)),!y&&window.chrome&&chrome.runtime&&chrome.runtime.id&&(y=document.createElement("iframe"),y.id=c,y.style.display="none",y.src=chrome.runtime.getURL("src/sandbox/sandbox.html"),await new Promise(w=>{y.addEventListener("load",w,!1),document.body.appendChild(y)})),a.classList.add("flex","h-full","items-center","justify-center","text-sm","sm:text-lg"),a.addEventListener("click",i7,!1),i.classList.remove("justify-between"),i.firstElementChild.insertAdjacentElement("beforebegin",a),await new Promise(w=>{const _=setInterval(()=>{g=document.body.style.backgroundColor,g&&(clearInterval(_),w())},500)}),o.style.setProperty("--ttu-whispersync-background-color",g),o.style.setProperty("--ttu-whispersync-color",`rgb(${u},${f},${p})`),Ac=new n7({target:a,props:{componentContainerElement:a,bookContentElement:r,sandboxElement:y,currentBookId:K1}})}else e||(Ac==null||Ac.$destroy(),clearTimeout(Bl),K1=0,Y1=!1,Bl=void 0)}function i7(t){t.stopPropagation()}new MutationObserver(e_).observe(document.body,{attributes:!0}),e_()})();
