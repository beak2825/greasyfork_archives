// ==UserScript==
// @name         vSprint Opisy Baselinker
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  Modyfikowanie opisów baselinker po API claude
// @author       Paweł Kaczmarek
// @match        https://*.baselinker.com/inventory_products.php*
// @grant        GM_xmlhttpRequest
// @downloadURL https://update.greasyfork.org/scripts/511181/vSprint%20Opisy%20Baselinker.user.js
// @updateURL https://update.greasyfork.org/scripts/511181/vSprint%20Opisy%20Baselinker.meta.js
// ==/UserScript==

!function(){"use strict";function e(e){let o=document.createElement("button");o.textContent="vSprint Opisy ",o.style.padding="10px 20px",o.style.backgroundColor="#ff5a00",o.style.color="white",o.style.border="none",o.style.borderRadius="5px",o.style.cursor="pointer",o.style.marginLeft="10px",o.onclick=e=>{e.stopPropagation(),e.preventDefault(),function(){const e=document.createElement("div");e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.zIndex="10000",e.style.backgroundColor="white",e.style.padding="20px",e.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)",e.style.borderRadius="8px",e.style.width="800px",e.style.maxHeight="80%",e.style.overflowY="auto",e.style.color="black";const o=document.createElement("div");o.style.display="flex",o.style.cursor="pointer";const n=document.createElement("div");n.textContent="Zapytanie",n.style.flex="1",n.style.padding="10px",n.style.textAlign="center",n.style.border="1px solid #ccc",n.style.borderBottom="none",n.style.backgroundColor="#f1f1f1",n.onclick=()=>{s.style.display="block",r.style.display="none",n.style.backgroundColor="#f1f1f1",l.style.backgroundColor="white"};const l=document.createElement("div");l.textContent="Prompt",l.style.flex="1",l.style.padding="10px",l.style.textAlign="center",l.style.border="1px solid #ccc",l.style.borderBottom="none",l.style.backgroundColor="white",l.onclick=()=>{s.style.display="none",r.style.display="block",l.style.backgroundColor="#f1f1f1",n.style.backgroundColor="white"},o.appendChild(n),o.appendChild(l),e.appendChild(o);const s=document.createElement("textarea");s.placeholder="Wpisz swoje zapytanie...",s.style.width="100%",s.style.height="400px",s.style.marginBottom="10px",s.style.padding="8px",s.style.border="1px solid #ccc",s.style.borderRadius="4px",s.style.resize="none";const r=document.createElement("textarea");r.placeholder="Wpisz swój prompt...",r.style.width="100%",r.style.height="400px",r.style.marginBottom="10px",r.style.padding="8px",r.style.border="1px solid #ccc",r.style.borderRadius="4px",r.style.display="none",r.style.resize="none",r.value="";const d=document.createElement("button");d.textContent="Wyślij",d.style.padding="10px 20px",d.style.backgroundColor="#ff5a00",d.style.color="white",d.style.border="none",d.style.borderRadius="5px",d.style.cursor="pointer",d.onclick=()=>{const e=s.value.trim(),o=r.value.trim(),n=o?`${o} ${e}`:e;n?(t(!0),function(e){GM_xmlhttpRequest({method:"POST",url:"https://api.anthropic.com/v1/messages",headers:{"x-api-key":"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","anthropic-version":"2023-06-01","Content-Type":"application/json"},data:JSON.stringify({model:"claude-3-5-sonnet-20240620",max_tokens:4e3,messages:[{role:"user",content:e}]}),onload:function(e){if(t(!1),200===e.status){!function(e){const t=document.querySelector("textarea.text_field.synchronized-to-uploader");t?(t.value=e,console.log("Zaktualizowano wartość textarea.")):console.warn("Textarea nie znaleziona.")}(JSON.parse(e.responseText).content[0].text)}else console.error("Błąd w odpowiedzi API:",e.statusText)},onerror:function(e){t(!1),console.error("Błąd żądania:",e)}})}(n)):alert("Nie wpisano żadnego zapytania ani promptu!")};const a=document.createElement("button");a.textContent="Zamknij",a.style.padding="10px 20px",a.style.backgroundColor="#f44336",a.style.color="white",a.style.border="none",a.style.borderRadius="5px",a.style.cursor="pointer",a.style.marginTop="10px",a.style.marginLeft="10px",a.onclick=()=>{e.remove(),i.remove()},e.appendChild(s),e.appendChild(r),e.appendChild(d),e.appendChild(a),document.body.appendChild(e);const i=document.createElement("div");i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0, 0, 0, 0.5)",i.style.zIndex="9999",document.body.appendChild(i),i.onclick=()=>{e.remove(),i.remove()};const c=document.querySelector("textarea.text_field.synchronized-to-uploader");c?s.value=c.value:console.warn("Textarea nie znaleziona.")}()},e.insertAdjacentElement("beforeend",o),console.log("Znaleziono div o klasie inblock-group i dodano przycisk.")}function t(e){let t=document.getElementById("loadingIndicator");e?t||(t=document.createElement("div"),t.id="loadingIndicator",t.textContent="Ładowanie...",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="10001",t.style.padding="10px 20px",t.style.backgroundColor="#333",t.style.color="white",t.style.borderRadius="5px",t.style.fontSize="16px",t.style.opacity="0.8",document.body.appendChild(t)):t&&t.remove()}new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{1===t.nodeType&&"form_inventory_products"===t.id&&t.querySelectorAll("label.h16").forEach((t=>{if("Opis"===t.textContent.trim()){const o=t.closest(".inblock-group");o&&e(o)}}))}))}))})).observe(document.body,{childList:!0,subtree:!0})}();