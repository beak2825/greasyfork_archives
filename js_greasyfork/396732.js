// ==UserScript==
// @name         ceeeeeeeeeeeeeek
// @namespace    https://github.com/wolf-scream
// @version      121
// @description  ç§äººç”¨é€”
// @icon         https://rawcdn.githack.com/popzoo/pop/9d4121eed5cbb035e55203b8a9e56a73dcf2e6bf/images/favicon.ico
// @icon64URL    https://rawcdn.githack.com/popzoo/pop/9d4121eed5cbb035e55203b8a9e56a73dcf2e6bf/images/favicon-64.ico
// @include      https://www.douyu.com/0*
// @include      https://www.douyu.com/1*
// @include      https://www.douyu.com/2*
// @include      https://www.douyu.com/3*
// @include      https://www.douyu.com/4*
// @include      https://www.douyu.com/5*
// @include      https://www.douyu.com/6*
// @include      https://www.douyu.com/7*
// @include      https://www.douyu.com/8*
// @include      https://www.douyu.com/9*
// @include      https://www.douyu.com/topic/*
// @include      https://www.douyu.com/*?rid=*
// @include      https://www.douyu.com/room/follow?page=*
// @run-at       document-start
// @grant        GM_openInTab
// @grant        GM_xmlhttpRequest
// @grant        window.close
// @grant        unsafeWindow
// @connect      coding.net
// @connect      yuba.douyu.com
// @connect      firepower-1253626683.cos.ap-beijing.myqcloud.com
// @connect      api.rongyisou.com
// @connect      apiv2.douyucdn.cn
// @connect      api.lovelive.tools
// @connect      chp.shadiao.app
// @connect      api.ai.qq.com
// @connect      bojianger.com
// @connect      www.xiaohulu.com
// @connect      helper.rongyisou.com
// @downloadURL https://update.greasyfork.org/scripts/396732/ceeeeeeeeeeeeeek.user.js
// @updateURL https://update.greasyfork.org/scripts/396732/ceeeeeeeeeeeeeek.meta.js
// ==/UserScript==
var self_host="http://api.rongyisou.com";var ZhiBoHelperHost="http://helper.rongyisou.com:7001";var ZhiBoHelperUserId="5e834c260c4404754cf2be20";var Fan_room;var DoTaskFlag;var wxid="ChanKnight666";var fksTimeout;function md5(r){var e=0,c=8;function n(r){return f(t(u(r),r.length*c))}function t(r,n){r[n>>5]|=128<<n%32,r[14+(n+64>>>9<<4)]=n;for(var t=1732584193,u=-271733879,e=-1732584194,c=271733878,f=0;f<r.length;f+=16){var o=t,a=u,i=e,h=c;t=v(t,u,e,c,r[f+0],7,-680876936),c=v(c,t,u,e,r[f+1],12,-389564586),e=v(e,c,t,u,r[f+2],17,606105819),u=v(u,e,c,t,r[f+3],22,-1044525330),t=v(t,u,e,c,r[f+4],7,-176418897),c=v(c,t,u,e,r[f+5],12,1200080426),e=v(e,c,t,u,r[f+6],17,-1473231341),u=v(u,e,c,t,r[f+7],22,-45705983),t=v(t,u,e,c,r[f+8],7,1770035416),c=v(c,t,u,e,r[f+9],12,-1958414417),e=v(e,c,t,u,r[f+10],17,-42063),u=v(u,e,c,t,r[f+11],22,-1990404162),t=v(t,u,e,c,r[f+12],7,1804603682),c=v(c,t,u,e,r[f+13],12,-40341101),e=v(e,c,t,u,r[f+14],17,-1502002290),t=A(t,u=v(u,e,c,t,r[f+15],22,1236535329),e,c,r[f+1],5,-165796510),c=A(c,t,u,e,r[f+6],9,-1069501632),e=A(e,c,t,u,r[f+11],14,643717713),u=A(u,e,c,t,r[f+0],20,-373897302),t=A(t,u,e,c,r[f+5],5,-701558691),c=A(c,t,u,e,r[f+10],9,38016083),e=A(e,c,t,u,r[f+15],14,-660478335),u=A(u,e,c,t,r[f+4],20,-405537848),t=A(t,u,e,c,r[f+9],5,568446438),c=A(c,t,u,e,r[f+14],9,-1019803690),e=A(e,c,t,u,r[f+3],14,-187363961),u=A(u,e,c,t,r[f+8],20,1163531501),t=A(t,u,e,c,r[f+13],5,-1444681467),c=A(c,t,u,e,r[f+2],9,-51403784),e=A(e,c,t,u,r[f+7],14,1735328473),t=g(t,u=A(u,e,c,t,r[f+12],20,-1926607734),e,c,r[f+5],4,-378558),c=g(c,t,u,e,r[f+8],11,-2022574463),e=g(e,c,t,u,r[f+11],16,1839030562),u=g(u,e,c,t,r[f+14],23,-35309556),t=g(t,u,e,c,r[f+1],4,-1530992060),c=g(c,t,u,e,r[f+4],11,1272893353),e=g(e,c,t,u,r[f+7],16,-155497632),u=g(u,e,c,t,r[f+10],23,-1094730640),t=g(t,u,e,c,r[f+13],4,681279174),c=g(c,t,u,e,r[f+0],11,-358537222),e=g(e,c,t,u,r[f+3],16,-722521979),u=g(u,e,c,t,r[f+6],23,76029189),t=g(t,u,e,c,r[f+9],4,-640364487),c=g(c,t,u,e,r[f+12],11,-421815835),e=g(e,c,t,u,r[f+15],16,530742520),t=l(t,u=g(u,e,c,t,r[f+2],23,-995338651),e,c,r[f+0],6,-198630844),c=l(c,t,u,e,r[f+7],10,1126891415),e=l(e,c,t,u,r[f+14],15,-1416354905),u=l(u,e,c,t,r[f+5],21,-57434055),t=l(t,u,e,c,r[f+12],6,1700485571),c=l(c,t,u,e,r[f+3],10,-1894986606),e=l(e,c,t,u,r[f+10],15,-1051523),u=l(u,e,c,t,r[f+1],21,-2054922799),t=l(t,u,e,c,r[f+8],6,1873313359),c=l(c,t,u,e,r[f+15],10,-30611744),e=l(e,c,t,u,r[f+6],15,-1560198380),u=l(u,e,c,t,r[f+13],21,1309151649),t=l(t,u,e,c,r[f+4],6,-145523070),c=l(c,t,u,e,r[f+11],10,-1120210379),e=l(e,c,t,u,r[f+2],15,718787259),u=l(u,e,c,t,r[f+9],21,-343485551),t=d(t,o),u=d(u,a),e=d(e,i),c=d(c,h)}return Array(t,u,e,c)}function o(r,n,t,u,e,c){return d((f=d(d(n,r),d(u,c)))<<(o=e)|f>>>32-o,t);var f,o}function v(r,n,t,u,e,c,f){return o(n&t|~n&u,r,n,e,c,f)}function A(r,n,t,u,e,c,f){return o(n&u|t&~u,r,n,e,c,f)}function g(r,n,t,u,e,c,f){return o(n^t^u,r,n,e,c,f)}function l(r,n,t,u,e,c,f){return o(t^(n|~u),r,n,e,c,f)}function d(r,n){var t=(65535&r)+(65535&n);return(r>>16)+(n>>16)+(t>>16)<<16|65535&t}function u(r){for(var n=Array(),t=(1<<c)-1,u=0;u<r.length*c;u+=c)n[u>>5]|=(r.charCodeAt(u/c)&t)<<u%32;return n}function f(r){for(var n=e?"0123456789ABCDEF":"0123456789abcdef",t="",u=0;u<4*r.length;u++)t+=n.charAt(r[u>>2]>>u%4*8+4&15)+n.charAt(r[u>>2]>>u%4*8&15);return t}return n(r)}async function sleep(ms){return new Promise(resolve=>{setTimeout(()=>{resolve()},ms)})}function dateFormat(fmt,date){let ret;let opt={"Y+":date.getFullYear().toString(),"m+":(date.getMonth()+1).toString(),"d+":date.getDate().toString(),"H+":date.getHours().toString(),"M+":date.getMinutes().toString(),"S+":date.getSeconds().toString()};for(let k in opt){ret=new RegExp("("+k+")").exec(fmt);if(ret){fmt=fmt.replace(ret[1],ret[1].length==1?opt[k]:opt[k].padStart(ret[1].length,"0"))}}return fmt}function roomScript(){var arrCommon=["ä¸»æ’­åŠ æ²¹ğŸ’ª","å¥½å¥ˆæ–¯","ç‚¹å‡»å…³æ³¨ï¼Œä¸ä¼šè¿·è·¯","å¼¹å¹•å†²é¸­å†²é¸­","æˆ‘æ¥å†’ä¸ªæ³¡","ç«åŠ›å…¨å¼€æš´èºèµ·æ¥","å°ç¤¼ç‰©åˆ·èµ·æ¥","ä¸€å‘å…¥é­‚","æ°´å†›æ¥æ§ï¼Œä¸»æ’­å¨çŒ›","é“ç²‰é©¾åˆ°ï¼Œçƒ­åº¦å¿…çˆ†","è‡ªå®¶äººï¼Œåˆ«è¯¯ä¼¤","ä¸»æ’­è´¼6ï¼","à¸à¸´à¸´à¸´à¸´à¸´è§à¸à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´å…‰à¸à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´à¸´æ£’à¸à¸´à¸´à¸´à¸´à¸´"];var arrPoetry=["å±±é‡æ°´å¤ç–‘æ— è·¯ï¼Œå…³æ³¨ä¸»æ’­ä¸è¿·è·¯ï¼","å¤§é£èµ·å…®äº‘é£æ‰¬ï¼Œå¼¹å¹•å†²å…®äººæ»¡æˆ¿ï¼","æµ·é˜”å‡­é±¼è·ƒï¼Œå¼¹å¹•æ»¡å±é£ï¼"];const royalTime=300;var awardWeight=100;var fireWait=1;var jumpCount=2e4;var jumpDelay=1;var roomStay=180;var danmuGap=25e3;var msgTxt,msgBtn,firePowerTime,fireJumpTime,popLoopTime,roomAssignTime;var uid="0_0",uname="0_0",giftInfoStr="0_0",aiAppId="0_0",roomId="99999",vipList=[],banRoom=[],banName=[];var fireFlag=true,deityFlag=false,welfareFlag=true,activeFlag=true,followFlag=false,thankFlag=false,selfDanmuFlag=false,mixedFlag=true,anonymousFlag=false;var sbts=(new Date).getTime();var tkAdTM=(new Date).getTime();var radioStorage=localStorage.getItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼")!=null?localStorage.getItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼"):"ceaseFire";var switchStatus=localStorage.getItem("switchStatusğŸ®ğŸğŸ®")!=null?localStorage.getItem("switchStatusğŸ®ğŸğŸ®"):"off";var AIwordFilter=[],donatorThank=[],arrWinning=[],arrNoPrize=[];var level,newAccountFlag;var FishBallCount,CashAwardCount;var TakePartInFlag=false;var TakePartInActId;var FollowStatus;var jumpFlag=true;var GlobalFollowFlag=false;var GlobalSendBarrageFlag=false;var GlobalVerifyCode=false;function userConfig(){let configInfo=localStorage.getItem("collectUserBarrage");if(!configInfo)configInfo=[];if(configInfo!=null&&uid!="-"){if(configInfo.indexOf("ğŸ€„ç¤¼ç‰©ç­”è°¢ğŸ€„")>-1){thankFlag=true;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€å¼€å¯ç¤¼ç‰©ç­”è°¢åŠŸèƒ½ã€‘")}if(configInfo.indexOf("ğŸ€„è‡ªåŠ¨å–å…³ğŸ€„")>-1){followFlag=true;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€å¼€å¯è‡ªåŠ¨å–å…³åŠŸèƒ½ã€‘")}if(configInfo.indexOf("ğŸ€„åŒ¿åç”¨æˆ·ğŸ€„")>-1){anonymousFlag=true;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€å¼€å¯åŒ¿åç”¨æˆ·åŠŸèƒ½ã€‘")}if(configInfo.indexOf("ğŸ€„å¼¹å¹•æ··ç”¨ğŸ€„")>-1){mixedFlag=true;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€AIä¸ç§æœ‰å¼¹å¹•æ··ç”¨ã€‘")}if(configInfo.indexOf("ğŸ€„å…³é—­å¹»ç¥ğŸ€„")>-1){deityFlag=false;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€å…³é—­å¹»ç¥ç‰¹æ•ˆæ¨¡å¼ã€‘")}else{msgBtn.addEventListener("mouseup",clickBtnEvent);document.onkeydown=function(e){e.keyCode==13?clickBtnEvent():false}}if(configInfo.indexOf("__æ–°ç”¨æˆ·__")>-1){newAccountFlag=true;jumpCount=100;danmuGap=35e3;console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€æ–°ç”¨æˆ·æ¨¡å¼ã€‘")}configInfo=JSON.parse(configInfo);configInfo=JSON.parse(configInfo.v);console.log(configInfo,uid);var collectArr=[].concat(configInfo[uid])}if(!Fan_room){Fan_room="312407";localStorage.setItem("__FanRoom__",Fan_room);console.info("è·å–ç”¨æˆ·é…ç½®--\x3eã€ç²‰ä¸æˆ¿é—´:"+Fan_room)}}function AppSign(){var date=dateFormat("YYYY-mm-dd",new Date);var hour=dateFormat("HH",new Date);if(hour<19)return;if(localStorage.getItem("__AppSign__")!=date){localStorage.setItem("__AppSign__",date)}else{return}function getStrMiddle(str,before,after){let m=str.match(new RegExp(before+"(.*?)"+after));return m?m[1]:false}function getToken(){let cookie=document.cookie;let ret=getStrMiddle(cookie,"acf_uid=",";")+"_"+getStrMiddle(cookie,"acf_biz=",";")+"_"+getStrMiddle(cookie,"acf_stk=",";")+"_"+getStrMiddle(cookie,"acf_ct=",";")+"_"+getStrMiddle(cookie,"acf_ltkid=",";");return ret}var dyToken=getToken();GM_xmlhttpRequest({method:"POST",url:"https://apiv2.douyucdn.cn/h5nc/sign/sendSign",data:"token="+dyToken,responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(response){let ret=response.response;if(ret.data.length==0){popupToast("ã€å®¢æˆ·ç«¯ã€‘ä»Šæ—¥å·²ç­¾åˆ°",3)}else{if(ret.data.sign_pl.length!=0){let recv="";for(let i=0;i<ret.data.sign_pl.length;i++){recv=recv+ret.data.sign_pl[i].cnt+"ä¸ª"+ret.data.sign_pl[i].name+","}popupToast("ã€å®¢æˆ·ç«¯ã€‘ç­¾åˆ°æˆåŠŸ! è·å¾—ç‰©å“:"+recv,3)}else{popupToast("ã€å®¢æˆ·ç«¯ã€‘ç­¾åˆ°æˆåŠŸ! å¯æƒœæ²¡æœ‰è·å¾—ä¸œè¥¿",3)}}}})}function cloudBarrage(){var roomCategory=document.getElementsByClassName("Title-categoryItem")[1];roomCategory=roomCategory.innerText;let publicDanmuCache=sessionStorage.getItem("publicDanmuCacheğŸ¥ğŸ’¾ğŸ¥");let selfDanmuCache=sessionStorage.getItem("selfDanmuCacheğŸ¥ğŸ’¾ğŸ¥");if(selfDanmuCache!=null){let json=JSON.parse(selfDanmuCache);arrCommon=json.é€šç”¨!=undefined?[].concat(json.é€šç”¨):arrCommon;arrCommon=json[roomCategory]!=undefined?arrCommon.concat(json[roomCategory]):arrCommon;arrPoetry=json.ç²¾é€‰!=undefined?[].concat(json.ç²¾é€‰):arrPoetry;donatorThank=json.giftThank!=undefined?donatorThank.concat(json.giftThank):donatorThank;arrWinning=json.winning!=undefined?arrWinning.concat(json.winning):arrWinning;arrNoPrize=json.noprize!=undefined?arrNoPrize.concat(json.noprize):arrNoPrize;console.info("é‡‡ç”¨ç¼“å­˜ç§æœ‰äº‘å¼¹å¹•ï¼Œå¦‚æ‚¨ä¸Šä¼ /æ›´æ–°äº†ç§æœ‰å¼¹å¹•ï¼Œéœ€è¦é‡å¯æµè§ˆå™¨å“¦ï¼");selfDanmuFlag=true}else if(publicDanmuCache!=null){let json=JSON.parse(publicDanmuCache);arrCommon=json.é€šç”¨!=undefined?[].concat(json.é€šç”¨):arrCommon;arrCommon=json[roomCategory]!=undefined?arrCommon.concat(json[roomCategory]):arrCommon;arrPoetry=json.ç²¾é€‰!=undefined?[].concat(json.ç²¾é€‰):arrPoetry;donatorThank=json.giftThank!=undefined?donatorThank.concat(json.giftThank):donatorThank;arrWinning=json.winning!=undefined?arrWinning.concat(json.winning):arrWinning;arrNoPrize=json.noprize!=undefined?arrNoPrize.concat(json.noprize):arrNoPrize;console.info("é‡‡ç”¨ç¼“å­˜å…¬ç”¨äº‘å¼¹å¹•ï¼Œå¦‚æ‚¨ä¸Šä¼ /æ›´æ–°äº†ç§æœ‰å¼¹å¹•ï¼Œéœ€è¦é‡å¯æµè§ˆå™¨å“¦ï¼")}else{getSelfDanmu()}var date=dateFormat("YYYY-mm-dd",new Date);var hour=dateFormat("HH",new Date);if(hour<4)return;if(localStorage.getItem("__updateBarrage__")!=date){localStorage.setItem("__updateBarrage__",date);getSelfDanmu()}function getSelfDanmu(){GM_xmlhttpRequest({method:"GEt",url:"https://chanknight.coding.net/p/cdn/d/cdn/git/raw/c1d82acbddfaabef60cfb9bfd554b8f74e70ffd9/%E4%B8%8D%E5%B0%8F%E7%9A%84%E5%B0%8Fk.json",onload:function(response){let jsonData=JSON.parse(response.response);let json=jsonData.data;arrCommon=json.é€šç”¨!=undefined?[].concat(json.é€šç”¨):arrCommon;arrCommon=json[roomCategory]!=undefined?arrCommon.concat(json[roomCategory]):arrCommon;arrCommon.concat(json[sessionStorage.getItem("gender")]);arrPoetry=json.ç²¾é€‰!=undefined?[].concat(json.ç²¾é€‰):arrPoetry;donatorThank=json.giftThank!=undefined?donatorThank.concat(json.giftThank):donatorThank;arrWinning=json.winning!=undefined?arrWinning.concat(json.winning):arrWinning;arrNoPrize=json.noprize!=undefined?arrNoPrize.concat(json.noprize):arrNoPrize;console.info("å·²è·å–åˆ°æ‚¨çš„ä¸“å±äº‘å¼¹å¹•ï¼Œå¼¹å¹•åˆå§‹åŒ–å®Œæ¯•ï¼");sessionStorage.setItem("selfDanmuCacheğŸ¥ğŸ’¾ğŸ¥",JSON.stringify(json));selfDanmuFlag=true},onerror:err=>{console.info("æ²¡æœ‰æ‰¾åˆ°æ‚¨çš„ä¸“å±äº‘å¼¹å¹•")}})}function getpublicDanmuCoding(){GM_xmlhttpRequest({method:"GET",url:"https://coding.net/u/lvlanxing/p/popzoo/git/raw/master/json/cloudDanmu.json",onload:function(response){if(response.responseText.indexOf("404")==-1){let json=JSON.parse(response.responseText);json=json.data;arrCommon=json.é€šç”¨!=undefined?[].concat(json.é€šç”¨):arrCommon;arrCommon=json[roomCategory]!=undefined?arrCommon.concat(json[roomCategory]):arrCommon;arrPoetry=json.ç²¾é€‰!=undefined?[].concat(json.ç²¾é€‰):arrPoetry;donatorThank=json.giftThank!=undefined?donatorThank.concat(json.giftThank):donatorThank;arrWinning=json.winning!=undefined?arrWinning.concat(json.winning):arrWinning;arrNoPrize=json.noprize!=undefined?arrNoPrize.concat(json.noprize):arrNoPrize;console.info("å·²è·å–åˆ°å…¬æœ‰äº‘å¼¹å¹•ï¼Œå¼¹å¹•åˆå§‹åŒ–å®Œæ¯•ï¼");sessionStorage.setItem("publicDanmuCacheğŸ¥ğŸ’¾ğŸ¥",JSON.stringify(json))}else{getPublicDanmuAbroad()}},onerror:function(err){console.error(err);getPublicDanmuAbroad()}})}function getPublicDanmuAbroad(){fetch("https://cdn.statically.io/gh/popzoo/barrage/master/danmu.json",{method:"GET",mode:"cors",cache:"no-store",credentials:"omit"}).then(res=>{return res.json()}).then(json=>{json=json.data;arrCommon=json.é€šç”¨!=undefined?[].concat(json.é€šç”¨):arrCommon;arrCommon=json[roomCategory]!=undefined?arrCommon.concat(json[roomCategory]):arrCommon;arrPoetry=json.ç²¾é€‰!=undefined?[].concat(json.ç²¾é€‰):arrPoetry;donatorThank=json.giftThank!=undefined?donatorThank.concat(json.giftThank):donatorThank;arrWinning=json.winning!=undefined?arrWinning.concat(json.winning):arrWinning;arrNoPrize=json.noprize!=undefined?arrNoPrize.concat(json.noprize):arrNoPrize;console.info("å·²è·å–åˆ°å…¬æœ‰äº‘å¼¹å¹•ï¼Œå¼¹å¹•åˆå§‹åŒ–å®Œæ¯•ï¼");sessionStorage.setItem("danmuCacheğŸ¥ğŸ’¾ğŸ¥",JSON.stringify(json))}).catch(err=>{console.error("REQUEST ERROR",err)})}}function captureBarrage(){let danmuLength=document.getElementsByClassName("Barrage-content").length;if(danmuLength>2){var danmuCount=1;var barrageArr=document.getElementsByClassName("Barrage-content");function loopSeek(){let danmuMsg=barrageArr[barrageArr.length-danmuCount];if(danmuMsg!=undefined&&escape(danmuMsg.innerText).indexOf("%u")!=-1&&danmuMsg.innerText.length>3){robotAIChat(danmuMsg.innerText.trim())}else{if(danmuCount<=Math.min(20,danmuLength)){danmuCount++;loopSeek()}else{bombBarrage(true);return}}}loopSeek()}else{bombBarrage(true)}}function robotAIChat(question){function getParam(question){var params={app_id:"2128598514",session:String(Math.random()).slice(0,5),question:question,time_stamp:Math.floor((new Date).getTime()/1e3),nonce_str:String(Math.random()).slice(0,5),sign:""};var str="";str+="app_id=2128598514&";str+="nonce_str="+params.nonce_str+"&";str+="question="+encodeURI(question)+"&";str+="session="+params.session+"&";str+="time_stamp="+params.time_stamp+"&";str+="app_key=owf98IPKyw5l6LY5";params.sign=md5(str).toUpperCase();var fd=new FormData;fd.append("app_id",params.app_id);fd.append("session",params.session);fd.append("question",params.question);fd.append("time_stamp",params.time_stamp);fd.append("nonce_str",params.nonce_str);fd.append("sign",params.sign);return fd}GM_xmlhttpRequest({method:"POST",url:"https://api.ai.qq.com/fcgi-bin/nlp/nlp_textchat",data:getParam(question),onload:function(response){var text=response.responseText;var answer=JSON.parse(text).data.answer;var sendflag=false;if(answer.length<33){for(let i=0;i<AIwordFilter.length;i++){if(answer.indexOf(AIwordFilter[i])>-1){sendflag=true;break}}}else{sendflag=true}if(sendflag||typeof answer!="string"||answer.trim()==""){bombBarrage(true)}else{msgTxt.value=answer;msgBtn.click();console.info("è…¾è®¯æœºå™¨äººå¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>ã€é—®ã€‘"+question+"ã€ç­”ã€‘"+answer);clickBtnEvent()}},onerror:function(err){bombBarrage(true);console.warn("AIæœºå™¨äººåˆåŒå’å•æŒ‚äº†ï¼Œè¯·è”ç³»å¤§ä½¬å¥½å¥½è°ƒæ•™AIï¼")}})}let bombBarrageFirst=true;function bombBarrage(flag){let sendFlag=false;if(bombBarrageFirst){bombBarrageFirst=false;takePartInFire()}if(!flag){console.log("å¼€å¯AIå¼¹å¹•");captureBarrage()}else{let probNum=parseInt(Math.random()*4);if(probNum==0){msgTxt.value=arrPoetry[parseInt(Math.random()*arrPoetry.length)];console.info("ç²¾é€‰å¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+msgTxt.value);msgBtn.click();clickBtnEvent()}else if(probNum>=1&&probNum<4){msgTxt.value=arrCommon[parseInt(Math.random()*arrCommon.length)];console.info("æ™®é€šå¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+msgTxt.value);msgBtn.click();clickBtnEvent()}else if(probNum==4){console.log("å¼€å§‹ä¸€è¨€å¼¹å¹•");fetch("https://v1.hitokoto.cn").then(response=>response.json()).then(data=>{msgTxt.value=data.hitokoto;console.info("ä¸€è¨€å¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+msgTxt.value);msgBtn.click();clickBtnEvent()}).catch(err=>{console.error(err);bombBarrage()})}else if(probNum==5){console.log("å¼€å§‹åœŸå‘³æƒ…è¯å¼¹å¹•");GM_xmlhttpRequest({method:"GET",url:"https://api.lovelive.tools/api/SweetNothings",onload:function(response){let ret=response.response;msgTxt.value=ret;console.info("åœŸå‘³æƒ…è¯å¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+msgTxt.value);msgBtn.click();clickBtnEvent()},onerror:function(err){console.err(err);bombBarrage()}})}else if(probNum==6){console.log("å¼€å§‹å½©è™¹å±å¼¹å¹•");GM_xmlhttpRequest({method:"GET",url:"https://chp.shadiao.app/api.php",onload:function(response){let ret=response.response;msgTxt.value=ret;console.info("å½©è™¹å±å¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+msgTxt.value);msgBtn.click();clickBtnEvent()}})}}setTimeout(async()=>{if(!await checkSendStatus()){let risk=JSON.parse(localStorage.getItem("__Risk__"));risk.sendLevel+=1;localStorage.setItem("__Risk__",JSON.stringify(risk));if(TakePartInFlag){GM_xmlhttpRequest({method:"GET",url:self_host+`:3434?type=takePartInFire&actId=${TakePartInActId}&num=-1`,onload:function(response){TakePartInFlag=false}})}}else{GlobalSendBarrageFlag=true;let risk=JSON.parse(localStorage.getItem("__Risk__"));risk.sendLevel=0;localStorage.setItem("__Risk__",JSON.stringify(risk))}},10)}function giftTankBarrage(isFire){let giftBannerList=document.querySelector(".BarrageBanner").children;if(thankFlag&&giftBannerList.length>0&&radioStorage==="bombFire"){for(let i=0;i<giftBannerList.length;i++){let giftBanner=giftBannerList.item(i);if(giftBanner!=undefined){let giftWords="æ„Ÿè°¢"+giftBanner.innerText.replace(/\s/g,"")+"ï¼Œ";if(giftInfoStr.indexOf(giftWords)==-1&&giftWords.indexOf(uname)==-1){giftWords+=donatorThank[parseInt(Math.random()*donatorThank.length)];msgTxt.value=giftWords;msgBtn.click();giftInfoStr=(giftWords+giftInfoStr).substr(0,120);if(isFire!=undefined){console.info("è°¢ç¤¼å¼¹å¹•,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+giftWords);clickBtnEvent()}else{console.info("è°¢ç¤¼å¼¹å¹•,åœæ­¢ç´¯è®¡<"+((new Date).getTime()-sbts)/1e3+"s>"+giftWords);setTimeout(function(){royalChatEffect()},royalTime);setTimeout(function(){screenEmpireBarrage()},royalTime)}return false}}}}return true}function countBarrageGap(num){var gapFlag=true;var count=0;var chatList=document.getElementsByClassName("Barrage-listItem");for(let i=chatList.length-1;i>-1;i--){if(chatList[i].innerText.indexOf("æ‚¨çš„è´¦å·åœ¨å¦ä¸€åœ°ç‚¹ç™»å½•ï¼Œå¼¹å¹•è¿æ¥å·²æ–­å¼€")>-1){jumpDelayConfig();break}let lastGap=chatList.length-i-1;if(chatList[i].innerHTML.indexOf("is-self")!=-1){if(lastGap>=num){gapFlag=true;break}else{gapFlag=false;console.info("å¼¹å¹•ç­‰å€™,è·è‡ªå·±ä¸Šæ¡å¼¹å¹•é—´éš”æ•°:"+lastGap+"/"+num);break}}if(count===5){break}else{count++}}return gapFlag}async function checkSendStatus(){return new Promise(resolve=>{setTimeout(async()=>{let waitFlag=true;while(waitFlag){let count=document.getElementsByClassName("Barrage-nickName").length;if(count==0){await sleep(1e3)}else{break}}var flag=document.getElementsByClassName("Barrage-nickName is-self").length!=0;resolve(flag)},2500)})}async function firePowerController(otherLoginFlag2){let fireCheck=document.getElementsByClassName("FirePowerChatModal-Notice")[0];let fireCheck2=document.getElementsByClassName("MuteStatus is-noLogin").length;let otherLoginFlag=document.getElementsByClassName("js-danmu-reconnect").length==0;if(!otherLoginFlag&&otherLoginFlag2==undefined){await sleep(5e3);document.getElementsByClassName("js-danmu-reconnect")[0].click();await sleep(5e3);firePowerController(true);return}if(giftTankBarrage(fireCheck)){if(fireCheck2==0&&fireCheck!=undefined&&awardJudge()&&!joinCondition()&&!banSpeak()&&checkRisk()){let num=parseInt(Math.random()*4)+2;if(radioStorage==="bombFire"&&countBarrageGap(num)&&!nameFilter()&&activeFlag){bombBarrage()}}else{if(!fireFlag){sbts=(new Date).getTime();fireFlag=true;clearTimeout(firePowerTime);refreshFishballHarvest(false)}console.info("ç«åŠ›å¼¹å¹•åœæ­¢,æ—¶é—´ç´¯è®¡ï¼š"+((new Date).getTime()-sbts)/1e3+"s");if(radioStorage==="bombFire"&&switchStatus==="on"&&(new Date).getTime()-sbts>1e3*fireWait&&getDailyRedirect()<parseInt(jumpCount)){if(cancelFollowRoom()){popupToast("ã€Šç«åŠ›æœå¯»è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç«åŠ›<br>è·³è½¬å‰å°†å–å…³<br>æµ®çª—å…³é—­åè·³è½¬ï¼",3);msgTxt.value="#å–å…³";msgBtn.click()}else{popupToast("ã€Šç«åŠ›æœå¯»è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç«åŠ›<br>æµ®çª—å…³é—­åè·³è½¬ï¼",3)}popupToast("ã€Šç«åŠ›æœå¯»è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç«åŠ›<br>æµ®çª—å…³é—­åè·³è½¬ï¼",3);fireJumpTime=setTimeout(randomFireRequest,3500)}}}randomTime()}function randomTime(){let tmRandom=danmuGap+parseInt(Math.random()*1500);if(radioStorage==="openFire"){firePowerTime=setTimeout(welfareController,tmRandom)}else{firePowerTime=setTimeout(firePowerController,tmRandom)}autoPlayMemory(false)}async function getRoom(flag,failTime){var rooms=localStorage.getItem("_complete_room_");rooms=JSON.parse(rooms);var temp=[];var param="?c=t&complete=";if(rooms!=null){rooms.forEach(room=>{if(room.endTime-(new Date).getTime()/1e3>0){param+=room.roomId+",";temp.push(room)}})}let fireCheck=document.getElementsByClassName("FirePowerChatModal-Notice")[0];let fireCheck2=document.getElementsByClassName("MuteStatus is-noLogin").length;localStorage.setItem("_complete_room_",JSON.stringify(temp));param+=roomId;param+="&isGoing="+(!flag&&fireCheck!=undefined&&awardJudge()&&!joinCondition()&&!banSpeak()&&fireCheck2==0);param+="&failTime="+failTime;console.log(param);return new Promise(resolve=>{GM_xmlhttpRequest({method:"GET",url:self_host+":3434"+param,onload:function(response){var json=JSON.parse(response.responseText);resolve(json)},onerror:function(err){resolve({roomId:-1});console.warn("getRoomè·å–æˆ¿é—´å¤±è´¥")}})})}async function geli(){console.log("éš”ç¦»è§‚å¯Ÿ......");fksTimeout&&clearTimeout(fksTimeout);await sleep(30*1e3);var risk=JSON.parse(localStorage.getItem("__Risk__"));var flag1,flag2;if(risk.sendLevel!=0){msgTxt.value="666666";msgBtn.click();flag2=await checkSendStatus()}if(risk.followLevel!=0){var subObj=document.getElementsByClassName("Title-followBtn")[0];var followCheck=document.getElementsByClassName("Title-followBtnBox is-followed")[0];if(subObj!=undefined&&followCheck==undefined){subObj.click();await sleep(2e3);flag1=await checkFollowStaus()}else{randomFireRequest(true);return}}if(flag1!=false&&flag2!=false){switchStatus="on";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","on");localStorage.setItem("__Risk__",JSON.stringify({followLevel:0,sendLevel:0,time:(new Date).getTime()/1e3}));randomFireRequest(true)}else{setInterval(keepAlive,3*60*1e3);var waitTime;if(flag1==false){waitTime=3*60*1e3;console.error("è¿˜åœ¨è§‚å¯ŸæœŸï¼Œæ— æ³•å…³æ³¨ä¸»æ’­")}if(flag2==false){waitTime=5*60*1e3;if(document.getElementsByClassName("Barrage-nickName").length==0){waitTime=2*60*1e3}else{wechatNotice("æ— æ³•å‘é€å¼¹å¹•");console.error("è¿˜åœ¨è§‚å¯ŸæœŸï¼Œæ— æ³•å‘é€å¼¹å¹•")}}popupToast("è·ç¦»ä¸‹æ¬¡æ£€æµ‹æ—¶é—´è¿˜æœ‰",waitTime/1e3);setTimeout(()=>{randomFireRequest(true)},waitTime)}}var isFirstrandomFireRequest=true;var failTime=0;async function randomFireRequest(flag){if(switchStatus==="on"&&getDailyRedirect()>=parseInt(jumpCount)){popupToast("ã€ŠäºŒåˆä¸€åŠŸèƒ½å—é™ã€‹<br>ä»Šæ—¥è‡ªåŠ¨è·³è½¬å·²è¾¾ä¸Šé™("+jumpCount+"æ¬¡)<br>è‹¥è¦ç»§ç»­è·³è½¬è¯·å¼€å¯éšè—åŠŸèƒ½",3);var date=new Date;var m1=date.getTime();date.setHours(0);date.setMinutes(0);date.setSeconds(0);var m0=date.getTime();var m=60*60*24-(m1-m0)/1e3+(Math.random()*55+5);setTimeout(function(){(async()=>{while(DoTaskFlag){await sleep(2e3)}location.reload()})()},m*1e3)}else{async function gogogo(){var risk=JSON.parse(localStorage.getItem("__Risk__"));if(switchStatus!="on"&&risk.sendLevel<=3&&risk.followLevel<=3)return;risk.followLevel==1&&await sleep(60*1e3);var room=await getRoom(flag,failTime);if(room.roomId=="-1"){failTime+=1;popupToast("æš‚æ—¶æ²¡æœ‰ç¬¦åˆæ¡ä»¶æˆ¿é—´",2);return}if(room.roomId==roomId&&risk.sendLevel<=3&&risk.followLevel<=3){clearTimeout(fireJumpTime);clearTimeout(firePowerTime);bombFireFilter();return}var rooms=localStorage.getItem("_complete_room_");if(rooms==null){rooms="[]"}rooms=JSON.parse(rooms);rooms.push(room);localStorage.setItem("_complete_room_",JSON.stringify(rooms));localStorage.setItem("_nowTaskPartInRoom_",JSON.stringify(room));let tpiRooms=localStorage.getItem("_takePartInRooms_")||"[]";tpiRooms=JSON.parse(tpiRooms);if(tpiRooms.lastIndexOf(room.actId)==-1){tpiRooms.push(room.actId);if(tpiRooms.length>1e3){tpiRooms=tpiRooms.slice(200)}localStorage.setItem("_takePartInRooms_",JSON.stringify(tpiRooms))}else{failTime+=1;popupToast("æš‚æ—¶æ²¡æœ‰ç¬¦åˆæ¡ä»¶æˆ¿é—´",2);return}fireRequestFilter(room.roomId)}flag&&gogogo();if(isFirstrandomFireRequest){isFirstrandomFireRequest=false;setRandomTimeout(true)}function setRandomTimeout(isFirst){var waitTime=Math.random()*15*1e3;if(isFirst){var hour=dateFormat("HH",new Date);waitTime=(20+Math.random()*20)*1e3;newAccountFlag&&(waitTime=80*1e3)}flag&&(waitTime=2e3);var rooms=localStorage.getItem("_complete_room_");if(rooms==null){rooms="[]"}rooms=JSON.parse(rooms);rooms.forEach(room=>{if(room.roomId==roomId&&room.condition==0){GlobalFollowFlag=true}});console.log("ç­‰å¾…æ—¶é—´waitTime",waitTime);window.location.href.search(Fan_room)!=-1&&(waitTime=60*1e3);let timeout=setTimeout(async()=>{setRandomTimeout();var hour=dateFormat("HH",new Date);if(newAccountFlag&&hour<19)return;gogogo()},waitTime);if(isFirst){let interval=setInterval(()=>{console.log(GlobalFollowFlag,GlobalSendBarrageFlag);if(GlobalVerifyCode){clearTimeout(timeout);timeout=setTimeout(async()=>{setRandomTimeout();gogogo()},1.5*60*1e3);clearInterval(interval)}else if(GlobalFollowFlag&&GlobalSendBarrageFlag){clearTimeout(timeout);waitTime=15*Math.random()*1e3;timeout=setTimeout(async()=>{setRandomTimeout();gogogo()},waitTime);clearInterval(interval)}},1e3)}}}}function fireRequestFilter(fireUrl){if(!roomFilter(fireUrl)){var myRequest=new Request("https://www.douyu.com/swf_api/h5room/"+fireUrl);fetch(myRequest,{method:"GET",mode:"no-cors",cache:"default",credentials:"omit"}).then(result=>{return result.json()}).then(async json=>{var jsonData=json.data;console.info("ä¸»æ’­æ˜µç§°:ã€"+jsonData.nickname+"ã€‘+++æ¸¸æˆåç§°:ã€"+jsonData.game_name+"ã€‘+++è·³è½¬é“¾æ¥=>https://www.douyu.com/"+fireUrl);if(jsonData.game_name.indexOf("ä¸€èµ·çœ‹")==-1&&jsonData.game_name.indexOf("äºŒæ¬¡å…ƒ")==-1&&jsonData.game_name.indexOf("æˆ·å¤–")==-1&&jsonData.game_name.indexOf("æ±½è½¦")==-1){getOnlineAudience()}else{randomFireRequest()}}).catch(err=>{console.warn("æˆ¿é—´APIæ¥å£è·å–å¤±è´¥");(async()=>{while(DoTaskFlag){await sleep(2e3)}location.reload()})()})}else{randomFireRequest()}function getOnlineAudience(){let jumpRoomId=localStorage.getItem("ğŸ jumpRoomIdğŸ ");if(jumpRoomId!=null&&fireUrl==jumpRoomId){randomFireRequest()}else{localStorage.setItem("ğŸ jumpRoomIdğŸ ",fireUrl);fireUrl="https://www.douyu.com/"+fireUrl;let dailyJumpTimes=getDailyRedirect();dailyJumpTimes!=-1?localStorage.setItem((new Date).toLocaleDateString()+"ğŸ“±ğŸŒğŸ“±["+uname+"]",1+dailyJumpTimes):false;(async()=>{while(DoTaskFlag){await sleep(2e3)}if(jumpFlag){jumpFlag=false;if(Math.random()*1e3>960){GM_openInTab(fireUrl,{active:true});window.close()}else{location.href=fireUrl}}})()}}}var pageNum=sessionStorage.getItem("pageNumğŸ—ğŸ“‘ğŸ—")!=null?sessionStorage.getItem("pageNumğŸ—ğŸ“‘ğŸ—"):1;function randomWelfareRequest(){if(switchStatus==="on"&&getDailyRedirect()>=parseInt(jumpCount)){popupToast("ã€ŠäºŒåˆä¸€åŠŸèƒ½å—é™ã€‹<br>ä»Šæ—¥è‡ªåŠ¨è·³è½¬å·²è¾¾ä¸Šé™("+jumpCount+"æ¬¡)<br>è‹¥è¦ç»§ç»­è·³è½¬è¯·å¼€å¯éšè—åŠŸèƒ½",3)}else{fetch("https://www.douyu.com/japi/weblist/apinc/rec/lottery?num=1&page="+pageNum,{method:"GET",mode:"cors",cache:"default",credentials:"include"}).then(res=>{return res.json()}).then(json=>{var welFareList=json.data;if(welFareList[0]!=undefined&&pageNum<50){pageNum=parseInt(pageNum)+1;sessionStorage.setItem("pageNumğŸ—ğŸ“‘ğŸ—",pageNum);if((welFareList[0].roomName.indexOf("é±¼ç¿…")>-1||welFareList[0].roomName.indexOf("å…ƒ")>-1)&&!roomFilter(welFareList[0].roomId)){let jumpRoomId=localStorage.getItem("ğŸ jumpRoomIdğŸ ");if(jumpRoomId!=null&&welFareList[0].roomId==jumpRoomId){randomFireRequest()}else{localStorage.setItem("ğŸ jumpRoomIdğŸ ",welFareList[0].roomId);console.info(welFareList[0]);let dailyJumpTimes=getDailyRedirect();dailyJumpTimes!=-1?localStorage.setItem((new Date).toLocaleDateString()+"ğŸ“±ğŸŒğŸ“±["+uname+"]",1+dailyJumpTimes):false;(async()=>{while(DoTaskFlag){await sleep(2e3)}window.location.href="https://www.douyu.com/"+welFareList[0].roomId})()}}else{randomWelfareRequest()}}else{pageNum=1;sessionStorage.setItem("pageNumğŸ—ğŸ“‘ğŸ—",pageNum);randomWelfareRequest()}}).catch(err=>{pageNum=1;sessionStorage.setItem("pageNumğŸ—ğŸ“‘ğŸ—",pageNum);randomWelfareRequest()})}}function welfareFilter(){let welfareEntrance=document.getElementsByClassName("LotteryDrawEnter-enter")[0];if(welfareEntrance!=undefined&&document.getElementsByClassName("ULotteryStart-topMain")[0]==undefined){welfareEntrance.click()}let welfareObj=document.getElementsByClassName("ULotteryStart-topMain")[0];welfareObj!=undefined?console.info(welfareObj.innerText.replace(/\s/g,"|")):false;if(welfareObj!=undefined&&(welfareObj.innerText.indexOf("å‚ä¸æ¡ä»¶ï¼šå‘å¼¹å¹•+å…³æ³¨ä¸»æ’­")>-1||welfareObj.innerText.indexOf("å‚ä¸æ¡ä»¶ï¼šå‘å¼¹å¹•")>-1)){console.info("ç¬¦åˆå‚ä¸ğŸ°æ¡ä»¶ï¼");welfareController()}else{if(switchStatus==="on"){jumpDelayConfig()}else{welfareController()}}let closeObj=document.getElementsByClassName("LotteryContainer-close")[0];closeObj!=undefined?closeObj.click():false}function welfareController(){let welfareEntrance=document.getElementsByClassName("LotteryDrawEnter-enter")[0];if(welfareEntrance!=undefined&&document.getElementsByClassName("ULotteryStart-topMain")[0]==undefined){welfareEntrance.click()}let welfareObj=document.getElementsByClassName("ULotteryStart-topMain")[0];if(welfareObj!=undefined&&(welfareObj.innerText.indexOf("å‚ä¸æ¡ä»¶ï¼šå‘å¼¹å¹•+å…³æ³¨ä¸»æ’­")>-1||welfareObj.innerText.indexOf("å‚ä¸æ¡ä»¶ï¼šå‘å¼¹å¹•")>-1)){welfareObj=welfareObj.innerText.replace(/\s/g,",");let remainTime=welfareEntrance.innerText.split(":");remainTime=parseInt(remainTime[0])*60+parseInt(remainTime[1]);let joinBtn=document.getElementsByClassName("ULotteryStart-joinBtn is-disabled")[0];if(joinBtn!=undefined){let danmuContent=document.getElementsByClassName("ULotteryStart-demandDanmu")[0].innerText;danmuContent=danmuContent.substring(danmuContent.indexOf("å¼¹å¹•ï¼š")+3,danmuContent.indexOf("å¤åˆ¶"));let num=parseInt(Math.random()*5)+2;if(countBarrageGap(num)&&!banSpeak()&&!nameFilter()&&activeFlag){msgTxt.value=danmuContent;msgBtn.click();console.info("ç¦åˆ©æŠ½å¥–,æ—¶é—´é—´éš”<"+((new Date).getTime()-sbts)/1e3+"s>"+danmuContent);clickBtnEvent()}}else{document.getElementsByClassName("ULotteryStart-joinBtn")[0].click()}}else{if(!welfareFlag){welfareFlag=true}console.info("ç¦åˆ©å¼¹å¹•åœæ­¢,æ—¶é—´ç´¯è®¡ï¼š"+((new Date).getTime()-sbts)/1e3+"s");if(radioStorage==="openFire"&&switchStatus==="on"&&(new Date).getTime()-sbts>1e3*fireWait&&getDailyRedirect()<parseInt(jumpCount)){if(cancelFollowRoom()){popupToast("ã€Šç²‰ä¸ç¦åˆ©è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç¦åˆ©<br>è·³è½¬å‰å°†å–å…³<br>æµ®çª—å…³é—­åè·³è½¬ï¼",3);msgTxt.value="#å–å…³";msgBtn.click()}else{popupToast("ã€Šç²‰ä¸ç¦åˆ©è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç¦åˆ©<br>3ç§’åè‡ªåŠ¨è·³è½¬ï¼",3)}popupToast("ã€Šç²‰ä¸ç¦åˆ©è·³è½¬ã€‹<br>å·²è¶…è¿‡"+fireWait+"sæ²¡é‡å¼€ç¦åˆ©<br>3ç§’åè‡ªåŠ¨è·³è½¬ï¼",3);fireJumpTime=setTimeout(randomWelfareRequest,3500)}}let closeObj=document.getElementsByClassName("LotteryContainer-close")[0];closeObj!=undefined?closeObj.click():false;randomTime()}function resetRisk(){var obj={time:(new Date).getTime()/1e3,sendLevel:0,followLevel:0};localStorage.setItem("__Risk__",JSON.stringify(obj));switchStatus="on";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","on")}function fireBtnBinding(){if(radioStorage==="openFire"){randomWelfareRequest()}else{randomFireRequest(true)}}function clickBtnEvent(){sbts=(new Date).getTime()}function royalChatEffect(){let barrageArr=document.getElementsByClassName("Barrage-listItem");if(barrageArr.length>1){for(let i=barrageArr.length-1;i>-1;i--){if(barrageArr[i].lastElementChild!=null&&barrageArr[i].lastElementChild.innerHTML.indexOf("Barrage-nobleImg")==-1&&barrageArr[i].lastElementChild.innerHTML.indexOf("is-self")!=-1){barrageArr[i].className="Barrage-listItem js-noblefloating-barrage";let chatArea=barrageArr[i].lastElementChild;chatArea.className="js-noblefloating-barragecont Barrage-notice--noble";chatArea.setAttribute("style","background-color: #fff3df");let nickNameObj=chatArea.getElementsByClassName("Barrage-nickName")[0];nickNameObj.setAttribute("class","Barrage-nickName is-self js-nick");let motorFlagObj=chatArea.querySelector(".Motor");if(motorFlagObj==null){let iconTag=document.createElement("span");iconTag.className="Motor";iconTag.setAttribute("title","ä¸­");iconTag.setAttribute("data-motorcade","ä¸­");iconTag.setAttribute("style","background-image:url(https://img.douyucdn.cn/data/yuba/admin/2019/01/07/201901071437499042327937962.png)");let iconSpan=document.createElement("span");iconSpan.className="Motor-flag";iconSpan.innerText="ä¸­";iconTag.appendChild(iconSpan);chatArea.insertBefore(iconTag,nickNameObj)}let userLevelObj=chatArea.querySelector(".UserLevel");if(userLevelObj!=null){userLevelObj.className="UserLevel UserLevel--120";userLevelObj.setAttribute("title","ç”¨æˆ·ç­‰çº§ï¼š120")}let roomLevelObj=chatArea.querySelector(".RoomLevel");if(roomLevelObj!=null){roomLevelObj.className="RoomLevel RoomLevel--18";roomLevelObj.setAttribute("title","æˆ¿é—´ç­‰çº§ï¼š18")}else{let roomTag=document.createElement("span");roomTag.className="RoomLevel RoomLevel--18";roomTag.setAttribute("title","æˆ¿é—´ç­‰çº§ï¼š18");chatArea.insertBefore(roomTag,motorFlagObj)}let barrageColorObj=chatArea.querySelector(".Barrage-content");if(barrageColorObj!=null){barrageColorObj.className="Barrage-content Barrage-content--color0"}let kingIconUrl=["https://sta-op.douyucdn.cn/douyu/412bc7d49e40c245a0b140b8d2ae5f2db420e36c.gif","https://sta-op.douyucdn.cn/douyu/3d416f83fb2de6e4e8de5ce4e24b424e4eccc705.gif","https://sta-op.douyucdn.cn/douyu/7ac49673ae22983ca626a55a607e39ef0d3df5f0.gif","https://sta-op.douyucdn.cn/douyu/6467a61a8e57944b09ddb68a7673c9f6164335e9.gif","https://cs-op.douyucdn.cn/dy-activity/2017/12/20/a7e16d5efd74e3b6bc82ff690c387c95.gif","https://sta-op.douyucdn.cn/dy-activity/2018/08/02/cf7ae36b23d47cc0bd0762d1776b7a6f.gif","https://cs-op.douyucdn.cn/dy-activity/2018/06/27/4855683291eb04fae38a73003946fd1b.gif","https://cs-op.douyucdn.cn/dy-activity/2018/06/27/ba0d92fc83b0f34c378ef81e21325fe0.gif","https://sta-op.douyucdn.cn/dy-activity/2018/09/11/939a31aa442d07da9133987d18191d75.gif","https://sta-op.douyucdn.cn/dy-activity/2019/01/30/3443c9004fa48fee0bb00f906a168246.gif","https://sta-op.douyucdn.cn/douyu/0b9f31cf073fa88c1daade3a08252f90bdd18a0a.gif"];let tailTagObj=chatArea.querySelector(".Baby");if(tailTagObj!=null){let kingIconImg=document.createElement("img");kingIconImg.setAttribute("class","Baby-image is-achievement");kingIconImg.setAttribute("src",kingIconUrl[parseInt(Math.random()*kingIconUrl.length)]);tailTagObj.insertBefore(kingIconImg,tailTagObj.firstElementChild)}else{let signTag=document.createElement("a");signTag.setAttribute("class","Baby");let kingIconImg=document.createElement("img");kingIconImg.setAttribute("class","Baby-image is-achievement");kingIconImg.setAttribute("src",kingIconUrl[parseInt(Math.random()*kingIconUrl.length)]);signTag.appendChild(kingIconImg);let fireIconObj=chatArea.getElementsByClassName("FirePowerIcon")[0];fireIconObj!=undefined?chatArea.insertBefore(signTag,fireIconObj):chatArea.appendChild(signTag)}let fansMedalName=document.getElementsByClassName("FansMedal-name")[0];let fansBackgroundImg=document.getElementsByClassName("FansRankList-item FansRankList-item--top")[0];if(fansMedalName!=undefined&&roomId!=undefined&&fansBackgroundImg!=undefined){if(fansBackgroundImg.innerHTML.indexOf("background-image:")==-1){let fansTag=document.createElement("div");let fansSpan=document.createElement("span");fansTag.className="FansMedal level-30 js-fans-dysclick Barrage-icon";fansTag.setAttribute("data-rid",roomId);fansSpan.className="FansMedal-name js-fans-dysclick";fansSpan.setAttribute("data-rid",roomId);fansSpan.innerHTML=fansMedalName.innerText;fansTag.appendChild(fansSpan);chatArea.insertBefore(fansTag,chatArea.firstElementChild)}else{let fansTag1=document.createElement("div");fansTag1.className="FansMedal is-made js-fans-dysclick Barrage-icon";fansTag1.setAttribute("style",fansBackgroundImg.getElementsByClassName("FansMedal is-made")[0].getAttribute("style"));fansTag1.setAttribute("data-rid",roomId);let fansSpan1=document.createElement("span");fansSpan1.className="FansMedal-name js-fans-dysclick";fansSpan1.setAttribute("data-rid",roomId);fansSpan1.innerHTML=fansMedalName.innerText;fansTag1.appendChild(fansSpan1);chatArea.insertBefore(fansTag1,chatArea.firstElementChild)}}else{let fansTag2=document.createElement("div");fansTag2.className="FansMedal is-made js-fans-dysclick Barrage-icon";fansTag2.setAttribute("style","background-image: url('https://gfs-op.douyucdn.cn/fans_medal_resource/2019/07/12/5a5efaca4d1250413ed9c3c36438f6cb.gif')");fansTag2.setAttribute("data-rid","4615502");let fansSpan2=document.createElement("span");fansSpan2.className="FansMedal-name js-fans-dysclick";fansSpan2.setAttribute("data-rid","4615502");fansSpan2.innerHTML="çŒªå«å›¢";fansTag2.appendChild(fansSpan2);chatArea.insertBefore(fansTag2,chatArea.firstElementChild)}let nobleIconObj=barrageArr[i].getElementsByClassName("Barrage-icon Barrage-noble")[0];if(nobleIconObj==undefined){let royalTag=document.createElement("span");let royalImg=document.createElement("img");royalTag.className="Barrage-icon Barrage-noble";royalImg.className="Barrage-nobleImg";royalImg.setAttribute("src","//res.douyucdn.cn/resource/2019/08/15/common/4e85776071ffbae2867bb9d116e9a43c.gif");royalImg.setAttribute("title","å¹»ç¥");royalTag.appendChild(royalImg);chatArea.insertBefore(royalTag,chatArea.firstElementChild)}let adminIconObj=barrageArr[i].getElementsByClassName("Barrage-icon Barrage-icon--roomAdmin")[0];if(adminIconObj==undefined){let adminTag=document.createElement("span");adminTag.setAttribute("class","Barrage-icon Barrage-icon--roomAdmin");chatArea.insertBefore(adminTag,chatArea.firstElementChild)}break}}}}function screenEmpireBarrage(){let fatherNode=document.querySelector(".danmu-6e95c1");for(let i=fatherNode.children.length-1;i>=0;i--){if(fatherNode.children[i].className.indexOf("noble-bf13ad")==-1&&fatherNode.children[i].innerHTML.indexOf("border: 2px solid rgb(2, 255, 255)")!=-1){let liStyle=fatherNode.children[i].getAttribute("style");let characterLength=liStyle.substring(liStyle.indexOf("translateX(-")+12,liStyle.indexOf("px); transition"));let transformLength=liStyle.substring(liStyle.indexOf("transform ")+10,liStyle.indexOf("s linear"));let screenOpacity=liStyle.substring(liStyle.indexOf("opacity:")+8,liStyle.indexOf("; z-index:"));let characterStyle="opacity: "+screenOpacity+"; z-index: 30; background: rgba(0, 0, 0, 0); top: 4px; transform: translateX(-"+characterLength+"px); transition: transform "+transformLength+"s linear 0s;";fatherNode.children[i].className="danmuItem-31f924 noble-bf13ad";fatherNode.children[i].setAttribute("style",characterStyle);let nobleImgTag=document.createElement("img");nobleImgTag.className="super-noble-icon-9aacaf";nobleImgTag.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/h1_dcd226.png");nobleImgTag.setAttribute("style","margin-left: -57px; margin-top: -4px;");fatherNode.children[i].insertBefore(nobleImgTag,fatherNode.children[i].firstElementChild);let userIconTag=document.createElement("img");userIconTag.className="super-user-icon-574f31";let userIconObj=document.getElementsByClassName("Avatar is-circle")[0];if(userIconObj!=undefined){userIconObj=userIconObj.getElementsByTagName("img")[0].getAttribute("src");userIconTag.setAttribute("src",userIconObj.replace(new RegExp("_middle"),"_small"))}else{console.error("æœªèƒ½è·å–åˆ°ç”¨æˆ·å¤´åƒ")}fatherNode.children[i].insertBefore(userIconTag,fatherNode.children[i].firstElementChild);let tailTag=fatherNode.children[i].getElementsByClassName("afterpic-8a2e13")[0];tailTag.remove();let textContent=fatherNode.children[i].getElementsByClassName("text-879f3e")[0];textContent.className="super-text-0281ca";textContent.setAttribute("style","font: bold 23px SimHei, 'Microsoft JhengHei', Arial, Helvetica, sans-serif; color: rgb(255, 255, 255); background: url('https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/h2_8e5e64.png'); height: 44px;");let afterpicTag=document.createElement("div");afterpicTag.setAttribute("class","afterpic-8a2e13");afterpicTag.setAttribute("style","margin-top: 7px; margin-left: -1px;");if(document.querySelector(".FirePowerChatModal-Notice")==null){let signImg=document.createElement("img");signImg.setAttribute("class","afterpic-8a2e13");let signImgUrl=["https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/lucky_c5d02e.png","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/first_e511ac.png"];signImg.setAttribute("src",signImgUrl[parseInt(Math.random()*2)]);signImg.setAttribute("style","width: 28.8px; height: 28.8px;");afterpicTag.appendChild(signImg)}else{let fireImg=document.createElement("img");fireImg.setAttribute("class","afterpic-8a2e13");fireImg.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/hlqk_61648e.svg");fireImg.setAttribute("style","width: 28.8px; height: 28.8px;");afterpicTag.appendChild(fireImg)}textContent.appendChild(afterpicTag);let superTailImg=document.createElement("img");superTailImg.className="super-tail-bffa58";superTailImg.setAttribute("src","https://shark2.douyucdn.cn/front-publish/live_player-master/assets/images/h3_fd2e5b.png");fatherNode.children[i].appendChild(superTailImg)}}}function createUIElement(){var radioStyle=document.createElement("style");radioStyle.type="text/css";radioStyle.innerHTML=`.radio{display:inline-block;position: relative;line-height: 18px;margin-right: 8px;cursor: pointer;}\n        .radio input{display: none;}\n        .radio .radio-bg{display: inline-block;height: 18px;width: 18px;margin-right: 0px;padding:;background-color: #45bcb8;border-radius: 100%;vertical-align: top;box-shadow: 0 1px 15px rgba(0, 0, 0, 0.1) inset, 0 1px 4px rgba(0, 0, 0, 0.1) inset, 1px -1px 2px rgba(0, 0, 0, 0.1);cursor: pointer;transition: all 0.2s ease;}\n        .radio .radio-on{display: true;}\n        .radio input:checked + span.radio-on{width: 10px;height: 10px;position: absolute;border-radius: 100%;background: #FFFFFF;top: 4px;left: 4px;box-shadow: 0 2px 5px 1px rgba(0, 0, 0, 0.3), 0 0 1px rgba(255, 255, 255, 0.4) inset;background-image: linear-gradient(#ffffff 0, #e7e7e7 100%);transform: scale(0, 0);transition: all 0.2s ease;transform: scale(1, 1);display: inline-block;}\n        dfn {padding: 0 0.4em;cursor: help;font-style: normal;position: relative;}\n        dfn::after {content: attr(data-info);display: inline;white-space: pre-wrap;z-index: 999;border-radius: 4px;position: absolute;top: 22px; left: 0;opacity: 0;width: 310px;font-size: 13px;font-weight: 300;line-height: 1.5em;padding: 0.5em 0.8em;background: rgba(0,0,0,0.8);color: #fff;pointer-events: none;transition: opacity 150ms, top 150ms;}\n        dfn::before {content: '';display: block;position: absolute;top: 12px; left: 20px;opacity: 0;width: 0; height: 0;border: solid transparent 5px;border-bottom-color: rgba(0,0,0,0.8);transition: opacity 150ms, top 150ms;}\n        dfn:hover {z-index: 200;}\n        dfn:hover::after,\n        dfn:hover::before {opacity: 1;}\n        dfn:hover::after {top: 30px;z-index:999;}\n        dfn:hover::before {top: 20px;}\n        .model_toast {width: 452px;background: rgba(0,0,0,.5);border-radius: 8px;text-align: center;position: fixed;top: 50%;left: 50%;margin-top: -120px;margin-left: -226px;}\n        .model_toast .popup-toast {padding: 38px 40px;text-align: center;font-size: 16px;color: #fff;z-index: 300;}\n        .mui-switch {margin:16px 0;width: 52px;height: 31px; position: relative;border: 1px solid #dfdfdf;background-color: #fdfdfd;box-shadow: #dfdfdf 0 0 0 0 inset;border-radius: 20px;border-top-left-radius: 20px;border-top-right-radius: 20px;border-bottom-left-radius: 20px;border-bottom-right-radius: 20px;background-clip: content-box;display: inline-block;-webkit-appearance: none;user-select: none;outline: none; }\n        .mui-switch:before {content: '';width: 29px;height: 29px;position: absolute;top: 0px;left: 0;border-radius: 20px;border-top-left-radius: 20px;border-top-right-radius: 20px;border-bottom-left-radius: 20px;border-bottom-right-radius: 20px;background-color: #fff;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4); }\n        .mui-switch:checked {border-color: #64bd63;box-shadow: #64bd63 0 0 0 16px inset;background-color: #64bd63; }\n        .mui-switch:checked:before {left: 21px; }\n        .mui-switch.mui-switch-anim {transition: border cubic-bezier(0, 0, 0, 1) 0.4s, box-shadow cubic-bezier(0, 0, 0, 1) 0.4s; }\n        .mui-switch.mui-switch-anim:before {transition: left 0.3s; }\n        .mui-switch.mui-switch-anim:checked {box-shadow: #64bd63 0 0 0 16px inset;background-color: #64bd63;transition: border ease 0.4s, box-shadow ease 0.4s, background-color ease 1.2s; }\n        .mui-switch.mui-switch-anim:checked:before {transition: left 0.3s; }`;document.head.appendChild(radioStyle);var radioBtnTag=`<dfn style="font-size:16px;" data-info="ğŸ§-æ‰‹åŠ¨ç«åŠ›/æŠ½å¥–æˆ¿é—´æœç´¢,ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»è·³è½¬ï¼›â›”-ç«åŠ›åœæ­¢çŠ¶æ€ï¼Œåˆå§‹åŒ–ç»„ä»¶å±•ç¤ºæ•°æ®æˆ–åœæ­¢å¼¹å¹•ï¼›å½“å¼€å¯äºŒåˆä¸€å¼€å…³ï¼Œå˜æ›´ä¸ºâš¡æé€Ÿç­¾åˆ°æ¨¡å¼(æŠ¢ç­¾åˆ°æ‰‹é€Ÿç‹)ï¼Œéœ€å°†æˆ¿é—´åŠ å…¥[ç‰¹åˆ«å…³æ³¨]ï¼Œå¼€æ’­ç¬é—´æé€Ÿç­¾åˆ°ï¼Œç­¾åˆ°åè‡ªåŠ¨åœæ­¢ä¿æŒé™é»˜ï¼Œä¸å»ºè®®é•¿æ—¶é—´å¼€å¯ï¼›ğŸ°-ç²‰ä¸ç¦åˆ©æŠ½å¥–ï¼Œè‡ªåŠ¨å‚ä¸å½“å‰æˆ¿é—´ç²‰ä¸ç¦åˆ©ç¤¾æŠ½å¥–æ´»åŠ¨ï¼Œå¦‚æœæ²¡æœ‰æ´»åŠ¨åˆ™ä¿æŒé™é»˜çŠ¶æ€ï¼Œæ ¹æ®æŠ½å¥–æœ‰æ— è‡ªåŠ¨å‘åœï¼Œè‹¥å¼€å¯äºŒåˆä¸€å¼€å…³ï¼Œåˆ™å…¨è‡ªåŠ¨æœå¯»å‚ä¸ï¼›ğŸ’¥-ç«åŠ›å…¨å¼€å¼¹å¹•ï¼Œè‡ªåŠ¨å‚ä¸å½“å‰æˆ¿é—´ç«åŠ›å…¨å¼€æ´»åŠ¨ï¼Œå¦‚æ²¡æœ‰ç«åŠ›æˆ–ä¸æ»¡è¶³æ¡ä»¶åˆ™ä¿æŒé™é»˜çŠ¶æ€ï¼Œæ ¹æ®ç«åŠ›æœ‰æ— è‡ªåŠ¨å‘åœï¼Œå¼¹å¹•å†…å®¹ä¸ºAI+äº‘å¼¹å¹•åº“æˆ–ç§æœ‰å¼¹å¹•åº“ï¼Œè‹¥å¼€å¯äºŒåˆä¸€å¼€å…³ï¼Œåˆ™å…¨è‡ªåŠ¨æœå¯»å¹¶å‚ä¸æ´»åŠ¨ï¼›">\n        <label for="ceaseFire" class="radio" id="label_cease_fire">\n            <span class="radio-bg"></span>\n            <input type="radio" name="radio_fire" id="ceaseFire" value="â›”" />â›”\n            <span class="radio-on"></span>\n        </label>\n        <label for="openFire" class="radio" id="label_open_fire">\n            <span class="radio-bg"></span>\n            <input type="radio" name="radio_fire" id="openFire" value="ğŸ°" />ğŸ°\n            <span class="radio-on"></span>\n        </label>\n        <label for="bombFire" class="radio" id="label_bomb_fire" >\n            <span class="radio-bg"></span>\n            <input type="radio" name="radio_fire" id="bombFire" value="ğŸ’¥" />ğŸ’¥\n            <span class="radio-on"></span>\n        </label>\n        </dfn>`;var outSpan=document.createElement("span");var fireSeekBtn=document.createElement("button");outSpan.className="Title-blockInline";fireSeekBtn.innerHTML="ğŸ§æ‰‹è·³";fireSeekBtn.className="Wallet-content-recharge";fireSeekBtn.addEventListener("click",fireBtnBinding);var riskBtn=document.createElement("button");var risk=JSON.parse(localStorage.getItem("__Risk__"));var sendLevel=0,followLevel=0;if(risk){sendLevel=risk.sendLevel?risk.sendLevel:0;followLevel=risk.followLevel?risk.followLevel:0}riskBtn.innerHTML=sendLevel+":"+followLevel;riskBtn.className="Wallet-content-recharge";riskBtn.addEventListener("click",resetRisk);var blankTag=document.createElement("span");blankTag.innerHTML="&nbsp;&nbsp;&nbsp;";var tipTag=document.createElement("span");tipTag.innerHTML="å‘é€:å…³æ³¨";var reportNode=document.querySelector(".Title-blockInline");if(reportNode!=null){outSpan.appendChild(blankTag);outSpan.appendChild(riskBtn);outSpan.appendChild(tipTag);outSpan.appendChild(fireSeekBtn);reportNode.appendChild(outSpan)}else{location.reload();console.warn("æœªæ‰¾åˆ°æ ‡é¢˜å…ƒç´ ï¼Œæ— æ³•åˆ›å»ºã€ğŸ”¥ã€‘æŒ‰é’®")}var sortNode=document.querySelector(".Title-category");var seekTag=document.createElement("div");seekTag.className="Title-anchorInfo";seekTag.innerHTML=radioBtnTag;if(sortNode!=null){sortNode.firstChild.append(seekTag);sortNode.insertBefore(seekTag,sortNode.firstElementChild.nextSibling);var anchor1=document.getElementById("ceaseFire");anchor1.addEventListener("change",function(){radioChange("ceaseFire")});var anchor2=document.getElementById("openFire");anchor2.addEventListener("change",function(){radioChange("openFire")});var anchor3=document.getElementById("bombFire");anchor3.addEventListener("change",function(){radioChange("bombFire")})}else{location.reload();console.warn("æœªæ‰¾åˆ°æˆ¿é—´ç±»åˆ«å…ƒç´ ï¼Œæ— æ³•åˆ›å»ºå•é€‰æ¡†")}var radioNode=document.getElementById(radioStorage);radioNode&&radioNode.setAttribute("checked","checked");let menuNode=document.querySelector(".Header-menu");var outLiTag=document.createElement("li");outLiTag.className="Header-menu-link";var switchContent="<dfn data-info='äºŒåˆä¸€åŠŸèƒ½(ç¦åˆ©ç¤¾æœå¯»/ç«åŠ›å…¨å¼€æœå¯»+è‡ªåŠ¨å‘å¼¹å¹•)å¼€å…³ï¼Œå¼€å¯æ­¤å¼€å…³+åœç•™â›”å¤„ï¼Œå¼€å¯âš¡æé€Ÿç­¾åˆ°æ¨¡å¼(æŠ¢ç­¾åˆ°æ‰‹é€Ÿç‹)ï¼›å¼€å¯æ­¤å¼€å…³+åœç•™ğŸ°/ğŸ’¥å¤„ï¼Œä¼šè‡ªåŠ¨æœç´¢ç¦åˆ©ç¤¾æŠ½å¥–/ç«åŠ›å…¨å¼€+å‘é€æŠ½å¥–å¼¹å¹•ï¼Œæ¯å¤©è·³è½¬è¶…è¿‡100æ¬¡åï¼Œåˆ™åœæ­¢è‡ªåŠ¨è·³è½¬ï¼›å¼€å¯éšè—åŠŸèƒ½ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è·³è½¬ä¸Šé™ã€‚æ¸©é¦¨æç¤º:é¢‘ç¹è·³è½¬+é¢‘å‘å¼¹å¹•=å…³å°é»‘å±‹å“¦!'>";if(switchStatus==="on"){switchContent+="<input class='mui-switch mui-switch-anim' type='checkbox' checked></dfn>";document.getElementById("ceaseFire").nextSibling.nodeValue="âš¡"}else{switchContent+="<input class='mui-switch mui-switch-anim' type='checkbox'></dfn>"}outLiTag.innerHTML=switchContent;menuNode.appendChild(outLiTag);let bilingObj=document.getElementsByClassName("mui-switch-anim")[0];bilingObj.addEventListener("change",function(){switchChange()})}function popupToast(text,time){let model=document.getElementById("toast-popup");if(model!=undefined){clearTimeout(popLoopTime)}else{let editText=text+"<br><br>("+time+"såè‡ªåŠ¨å…³é—­)";var creatediv=document.createElement("div");creatediv.className="model_toast";creatediv.setAttribute("id","toast-popup");var contentHtml='<div class="popup-toast" id="toast-content">'+editText+"</div>";creatediv.innerHTML=contentHtml;document.body.appendChild(creatediv)}time==undefined?3:time;var loopRefresh=function(){let modelObj=document.getElementById("toast-popup");if(time==0){modelObj.style.display="none";return}else{let editText=text+"<br><br>("+time+"såè‡ªåŠ¨å…³é—­)";var content=document.getElementById("toast-content");content.innerHTML=editText;modelObj.style.display="block";time--;popLoopTime=setTimeout(loopRefresh,1e3)}};loopRefresh()}function uncompileStr(code){code=unescape(code);var c=String.fromCharCode(code.charCodeAt(0)+1);for(var i=1;i<code.length;i++){c+=String.fromCharCode(code.charCodeAt(i)+1)}return c}function storageOperate(){var storage=window.localStorage;var clearList=new Array;storage.removeItem("game_recode_listdata_h5p_room");for(let i=0;i<storage.length;i++){if(storage.key(i).indexOf("FIRE_POWER_ACT_")!=-1||storage.key(i).indexOf("RankCoverage_vesion_")!=-1||storage.key(i).indexOf("carAssignedğŸš¦ğŸšğŸš¦")!=-1&&storage.key(i).indexOf("carAssignedğŸš¦ğŸšğŸš¦"+(new Date).toLocaleDateString())==-1||storage.key(i).indexOf("giftNumberğŸ’–ğŸğŸ’–")!=-1&&storage.key(i).indexOf("giftNumberğŸ’–ğŸğŸ’–"+(new Date).toLocaleDateString())==-1||storage.key(i).indexOf("ğŸ“±ğŸŒğŸ“±")!=-1&&storage.key(i).indexOf((new Date).toLocaleDateString()+"ğŸ“±ğŸŒğŸ“±["+uname+"]")==-1||storage.key(i).indexOf("ğŸŒ€ğŸ“‹ğŸŒ€")!=-1&&storage.key(i).indexOf((new Date).toLocaleDateString()+"ğŸŒ€ğŸ“‹ğŸŒ€["+uname+"]")==-1){clearList.push(storage.key(i))}}var num=0;function loopClearStorage(){if(num==clearList.length){console.info("å†å²å­˜å‚¨åƒåœ¾æ¸…ç©ºå®Œæ¯•ï¼")}else{storage.removeItem(clearList[num]);num++}}loopClearStorage()}function banSpeak(){var banObj=document.getElementsByClassName("MuteStatus is-mute")[0];if(banObj!=undefined&&(banObj.innerHTML.indexOf("ç¦è¨€")>-1||banObj.innerHTML.indexOf("ç²‰ä¸ä¸“åœºå“¦")>-1)){return true}else{return false}}function joinCondition(){var joinFlag=false;var joinObj=document.querySelector(".FirePowerChatModal-joinCondition");if(joinObj!=null){joinObj=joinObj.innerText;if(joinObj.indexOf("ç²‰ä¸å›¢æˆå‘˜ã€‚é€6é±¼ç¿…çš„åŠå¡å°±å¯å‚ä¸")!=-1){joinFlag=true;console.info("åªæœ‰ç²‰ä¸å›¢æ‰èƒ½å‚ä¸ï¼")}}return joinFlag}function activePageCheck(){var hiddenProperty="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null;var visibilityChangeEvent=hiddenProperty.replace(/hidden/i,"visibilitychange");var onVisibilityChange=function(){if(document[hiddenProperty]){activeFlag=false;console.log("é¡µé¢çŠ¶æ€ï¼šå¤±æ´»")}else{activeFlag=true;console.log("é¡µé¢çŠ¶æ€ï¼šæ¿€æ´»")}};document.addEventListener(visibilityChangeEvent,onVisibilityChange)}function awardJudge(){return true}function screenBarrageMemory(){var closeBarrageObj=document.getElementsByClassName("showdanmu-42b0ac")[0];var closeBarrageViceObj=document.getElementsByClassName("hidedanmu-5d54e2")[0];if(closeBarrageObj!=undefined){var scrollStatus=localStorage.getItem("scrollBarrageâ°ğŸšâ°");if(scrollStatus=="close"){closeBarrageObj.click()}closeBarrageObj.addEventListener("mouseup",getScrollStatus);closeBarrageViceObj.addEventListener("mouseup",getScrollStatus)}else{checkDelayCallback(4)}}function getScrollStatus(){var scrollBarrageObj=document.getElementsByClassName("showdanmu-42b0ac removed-9d4c42")[0];scrollBarrageObj==undefined?localStorage.setItem("scrollBarrageâ°ğŸšâ°","close"):localStorage.setItem("scrollBarrageâ°ğŸšâ°","open")}function autoPlayMemory(isFirst){var playObj=document.getElementsByClassName("play-8dbf03")[0];var playBtnObj=document.getElementsByClassName("play-8dbf03 removed-9d4c42")[0];var pauseObj=document.getElementsByClassName("pause-c594e8")[0];var autoPlayStatus=localStorage.getItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€");if(isFirst){if(pauseObj!=undefined){if(autoPlayStatus==="close"){pauseObj.click()}playObj.addEventListener("mouseup",getAutoPlayStatus);pauseObj.addEventListener("mouseup",getAutoPlayStatus)}else{checkDelayCallback(8)}}else{if(playBtnObj!=undefined&&autoPlayStatus==="close"){pauseObj.click()}}}function getAutoPlayStatus(){var autoPlayObj=document.getElementsByClassName("pause-c594e8 removed-9d4c42")[0];autoPlayObj==undefined?localStorage.setItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€","close"):localStorage.setItem("autoPlayStatusğŸ“€ğŸ“ºğŸ“€","open")}function getUserInfo(){let uidObj=document.querySelector(".UserInfo-avatar");uid=uidObj!=null?uidObj.firstElementChild.getAttribute("uid"):"unlogin";let sessUname=sessionStorage.getItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´");if(sessUname!=null){uname=sessUname}else{let localUname=localStorage.getItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´");if(localUname!=null){uname=localUname}else{updateUserName()}}document.title=uname;function updateNoble(noble_name){!noble_name&&(noble_name="æ— ");let robotId=getCookie("acf_uid");let config=JSON.parse(localStorage.getItem("_AccountConfig_")||"{}");if(config.noble_name!=noble_name){config.noble_name=noble_name;GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config),onload:function(response){let ret=JSON.parse(response.response);if(ret.success){localStorage.setItem("_AccountConfig_",JSON.stringify(config))}else{console.error("æ›´æ–°è´µæ—ä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("æ›´æ–°è´µæ—ä¿¡æ¯å¤±è´¥")}})}}fetch("https://www.douyu.com/member/cp/cp_rpc_ajax",{method:"GET",mode:"no-cors",cache:"default",credentials:"include"}).then(res=>{return res.json()}).then(json=>{level=json.exp_info.current.lv;console.log("ç”¨æˆ·ç­‰çº§ï¼š",level);let follow_num=json.follow_num;let time=localStorage.getItem("__NoFollowTime__");if(time==null){time=(new Date).getTime();localStorage.setItem("__NoFollowTime__",(new Date).getTime())}if((new Date).getTime()-time>2*60*1e3){if(follow_num>5950){localStorage.setItem("__NoFollowTime__",(new Date).getTime());let page=Math.floor(Math.random()*295);GM_openInTab("https://www.douyu.com/room/follow?page="+page,{active:false})}}let noble_name=json.noble_name;updateNoble(noble_name)}).catch(err=>{console.error("è·å–ç”¨æˆ·ç­‰çº§å¤±è´¥",err)})}function updateUserName(){var ajax=new XMLHttpRequest;ajax.timeout=8e3;ajax.responseType="document";ajax.open("get","https://www.douyu.com/member/cp",true);ajax.send();ajax.onreadystatechange=function(){if(ajax.readyState==4&&Math.floor(ajax.status/100)==2){var htmlDoc=ajax.responseXML;uname=htmlDoc.querySelector(".uname_con").innerText.trim();sessionStorage.setItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´",uname);localStorage.setItem(uid+"ğŸŒ´ğŸ”®ğŸŒ´",uname)}}}function getDailyRedirect(){var dailyRedirect=0;if(uname!="-"&&uname!=null){dailyRedirect=localStorage.getItem((new Date).toLocaleDateString()+"ğŸ“±ğŸŒğŸ“±["+uname+"]");if(dailyRedirect==null){localStorage.setItem((new Date).toLocaleDateString()+"ğŸ“±ğŸŒğŸ“±["+uname+"]",0);dailyRedirect=0}else{dailyRedirect=parseInt(dailyRedirect)}}else{dailyRedirect=-1}return dailyRedirect}function getDailyDanmuCount(){var danmuItem=localStorage.getItem((new Date).toLocaleDateString()+"ğŸŒ€ğŸ“‹ğŸŒ€["+uname+"]");if(danmuItem==null){localStorage.setItem((new Date).toLocaleDateString()+"ğŸŒ€ğŸ“‹ğŸŒ€["+uname+"]",0);danmuItem=0}else{danmuItem=parseInt(danmuItem)}return danmuItem}function jumpDelayConfig(){if(radioStorage==="openFire"){popupToast("ã€Šç²‰ä¸ç¦åˆ©æœå¯»ã€‹<br>ä¸ç¬¦åˆå‚ä¸æ¡ä»¶<br>æµ®çª—å…³é—­åè·³è½¬ï¼",jumpDelay);fireJumpTime=setTimeout(randomWelfareRequest,jumpDelay*1e3)}else if(radioStorage==="bombFire"){popupToast("ã€Šç«åŠ›å…¨å¼€æœå¯»ã€‹<br>ä¸ç¬¦åˆå¼€ç«æ¡ä»¶<br>æµ®çª—å…³é—­åè·³è½¬ï¼",jumpDelay);fireJumpTime=setTimeout(randomFireRequest,jumpDelay*1e3)}}function getPhoneStatus(){var a=sessionStorage.getItem("phoneStatusğŸ“â³ğŸ“");if(a!=null){if(a=="0"){checkDelayCallback(6)}}else{fetch("https://www.douyu.com/member/cp/cp_rpc_ajax",{method:"GET",mode:"no-cors",cache:"default",credentials:"include"}).then(res=>{return res.json()}).then(json=>{let a=json.info.phonestatus;sessionStorage.setItem("phoneStatusğŸ“â³ğŸ“",a);if(a==0){checkDelayCallback(6)}}).catch(err=>{console.error("REQUEST ERROR",err)})}}function releasePhoneLimit(){var chatLogin=document.getElementsByClassName("MuteStatus is-noLogin")[0];if(chatLogin!=undefined){chatLogin.remove();let btnGray=document.getElementsByClassName("ChatSend-button is-gray")[0];btnGray!=undefined?btnGray.className="ChatSend-button":""}else{checkDelayCallback(6)}}function jsonAnalytics(code){code===0?localStorage.setItem((new Date).toLocaleDateString()+"ğŸŒ€ğŸ“‹ğŸŒ€["+uname+"]",getDailyDanmuCount()+1):false;let siteId=code==1?"1278051049":"1278115154";var statJs=document.createElement("script");statJs.type="text/javascript";statJs.async=true;statJs.charset="utf-8";statJs.src="https://w.cnzz.com/c.php?async=1&id="+siteId;var rootJs=document.getElementsByTagName("script")[0];rootJs.parentNode.insertBefore(statJs,rootJs)}function getGFVersionNumber(){let userVersion=GM_info.script.version;fetch("https://greasyfork.org/zh-CN/scripts/396732-ceeeeeeeeeeeeeek",{method:"GET",mode:"cors",cache:"no-store",credentials:"omit"}).then(res=>{return res.text()}).then(txt=>{txt=(new DOMParser).parseFromString(txt,"text/html");let versionNumber=txt.getElementsByClassName("script-show-version")[1];if(versionNumber!=undefined){versionNumber=versionNumber.innerText;versionTipInfo(versionNumber,userVersion)}}).catch(err=>{console.error("REQUEST ERROR",err)})}function versionTipInfo(newVersion,userVersion){console.info(userVersion+"<ç”¨æˆ·---ç½‘ç»œ>"+newVersion);if(userVersion!=newVersion){GM_info.scriptWillUpdate=true}}function getRoomId(){var reg=/(\d+)/;reg.exec(location.href)&&(roomId=reg.exec(location.href)[1])}function getGender(){function getUpId(){return new Promise(function(resolve,reject){GM_xmlhttpRequest({method:"GET",url:"https://yuba.douyu.com/wbapi/web/anchorGameComments?room_id="+roomId,onload:function(result){resolve(JSON.parse(result.response).data.uid)}})})}getUpId().then(id=>{GM_xmlhttpRequest({method:"GET",url:"https://yuba.douyu.com/wbapi/web/user/detail/"+id,onload:function(result){var gender=JSON.parse(result.response).data.gender;console.log("ä¸»æ’­æ€§åˆ«",gender);let selfDanmuCache=sessionStorage.getItem("selfDanmuCacheğŸ¥ğŸ’¾ğŸ¥");let json=JSON.parse(selfDanmuCache);if(gender==1){arrCommon=arrCommon.concat(json["ç”·"])}else if(gender==2){arrCommon=arrCommon.concat(json["å¥³"])}}})})}function titleAreaRefresh(){anchorCreditRefresh();anchorInfoRefresh()}function anchorCreditRefresh(){fetch("https://www.douyu.com/swf_api/h5room/"+roomId).then(res=>{return res.json()}).then(json=>{let curCredit=json.data.cur_credit;let liveStatus=json.data.show_status;var liveTime=json.data.show_time;if(liveStatus=="1"){liveTime=new Date(liveTime*1e3);liveTime=(new Date).getDate()===liveTime.getDate()?dateFormat("HH:MM:SS",liveTime):dateFormat("mm-dd HH:MM:SS",liveTime)}else{liveTime="æœªæ’­"}let peopleObj=document.getElementById("real_person_num");if(peopleObj!=undefined&&switchStatus==="off"){peopleObj.removeAttribute("style");peopleObj.innerHTML="ğŸŒ"+getDailyRedirect()+"æ¬¡&nbsp;ğŸ’"+curCredit+"åˆ†&nbsp;ğŸ¬"+liveTime}else{peopleObj.setAttribute("style","display:none;")}}).catch(err=>{console.error("æ— æ³•è·å–ä¸»æ’­ä¿¡ç”¨å€¼")})}function anchorInfoRefresh(){fetch("https://bojianger.com/data/api/common/search.do?keyword="+roomId,{method:"GET",mode:"cors",cache:"default",credentials:"omit"}).then(result=>{return result.text()}).then(txt=>{let json=JSON.parse(txt);let peopleNum=json.data.anchorVo.audience_count;if(peopleNum==0){anchorInfoFromHulu();return 0}let giftValue=json.data.anchorVo.yc_gift_value;let anchorObj=document.getElementById("anchor_detail_info");if(anchorObj!=undefined&&switchStatus==="off"){anchorObj.setAttribute("data-info","ğŸ…-å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°(å‰ä¸¤ç»„æ•°æ®å‡æ¥æºäºæ’­é…±ç½‘)ï¼›ğŸ’²-ä»Šæ—¥ä¸»æ’­çš„æ€»æ”¶ç›Š(ç‚¹å‡»ä»»æ„å›¾æ ‡å³å¯åˆ·æ–°æ•°æ®)ï¼›ğŸ’­-ä»Šæ—¥ä¸ªäººå¼¹å¹•ç»Ÿè®¡(ç»Ÿè®¡è„šæœ¬è‡ªåŠ¨å‘é€çš„å¼¹å¹•æ•°)ï¼›");anchorObj.innerHTML="ğŸ…"+peopleNum+"äºº&nbsp;ğŸ’²"+giftValue+"å…ƒ&nbsp;ğŸ’­"+getDailyDanmuCount()+"æ¡"}else{let dfnTagObj=document.getElementById("anchor_detail_info");dfnTagObj.setAttribute("data-info","ğŸ…-å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°(å‰ä¸¤ç»„æ•°æ®å‡æ¥æºäºæ’­é…±ç½‘)ï¼›ğŸ’²-ä¸»æ’­ä»Šæ—¥çš„æ€»æ”¶ç›Š(ç‚¹å‡»ä»»æ„å›¾æ ‡å³å¯åˆ·æ–°æ•°æ®)ï¼›ğŸŒ-ä»Šæ—¥è·³è½¬æ¬¡æ•°(ç»Ÿè®¡ç”¨æ­¤è„šæœ¬è‡ªåŠ¨æˆ–æ‰‹åŠ¨è·³è½¬)ï¼›");anchorObj.innerHTML="ğŸ…"+peopleNum+"äºº&nbsp;ğŸ’²"+giftValue+"å…ƒ&nbsp;ğŸŒ"+getDailyRedirect()+"æ¬¡"}}).catch(err=>{anchorInfoFromHulu();console.error("æ’­é…±æ•°æ®è·å–å¤±è´¥")})}function anchorInfoFromHulu(){fetch("https://www.xiaohulu.com/apis/bd/index/anchor/anchorLiveComprehensiveData?platId=2&roomId="+roomId+"&type=1&dateId=",{method:"GET",mode:"cors",cache:"default",credentials:"omit"}).then(result=>{return result.json()}).then(json=>{json=json.data;let peopleNum=json.active_sender;let giftValue=json.all_gift_price;let anchorObj=document.getElementById("anchor_detail_info");if(anchorObj!=undefined&&switchStatus==="off"){anchorObj.setAttribute("data-info","ğŸ…-å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°(å‰ä¸¤ç»„æ•°æ®å‡æ¥æºäºå°è‘«èŠ¦)ï¼›ğŸ’²-ä»Šæ—¥ä¸»æ’­çš„æ€»æ”¶ç›Š(ç‚¹å‡»ä»»æ„å›¾æ ‡å³å¯åˆ·æ–°æ•°æ®)ï¼›ğŸ’­-ä»Šæ—¥ä¸ªäººå¼¹å¹•ç»Ÿè®¡(ç»Ÿè®¡è„šæœ¬è‡ªåŠ¨å‘é€çš„å¼¹å¹•æ•°)ï¼›");anchorObj.innerHTML="ğŸ…"+peopleNum+"äºº&nbsp;ğŸ’²"+giftValue+"å…ƒ&nbsp;ğŸ’­"+getDailyDanmuCount()+"æ¡"}else{let dfnTagObj=document.getElementById("anchor_detail_info");dfnTagObj.setAttribute("data-info","ğŸ…-å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°(å‰ä¸¤ç»„æ•°æ®å‡æ¥æºäºå°è‘«èŠ¦)ï¼›ğŸ’²-ä¸»æ’­ä»Šæ—¥çš„æ€»æ”¶ç›Š(ç‚¹å‡»ä»»æ„å›¾æ ‡å³å¯åˆ·æ–°æ•°æ®)ï¼›ğŸŒ-ä»Šæ—¥è·³è½¬æ¬¡æ•°(ç»Ÿè®¡ç”¨æ­¤è„šæœ¬è‡ªåŠ¨æˆ–æ‰‹åŠ¨è·³è½¬)ï¼›");anchorObj.innerHTML="ğŸ…"+peopleNum+"äºº&nbsp;ğŸ’²"+giftValue+"å…ƒ&nbsp;ğŸŒ"+getDailyRedirect()+"æ¬¡"}}).catch(err=>{console.error("å°è‘«èŠ¦æ•°æ®è·å–å¤±è´¥")})}function cancelFollowRoom(){var cancelCareFlag=true;var careList=sessionStorage.getItem("noCancelListğŸ’–ğŸ‘¸ğŸ’–");careList=JSON.parse(careList);if(careList!=null&&careList.length>0){for(let i=0;i<careList.length;i++){if(careList[i]==roomId){cancelCareFlag=false}}}else{cancelCareFlag=false;getFansRoomList()}return cancelCareFlag&&followFlag}function dakaqingbao(){var date=dateFormat("YYYY-mm-dd",new Date);var hour=dateFormat("HH",new Date);var minute=dateFormat("MM",new Date);console.log("ç²‰ä¸æˆ¿é—´:",Fan_room);if(Fan_room){if(localStorage.getItem("__dakaqingbao__")!=date&&hour>2&&minute>55+Math.random()*4){if(window.location.href.search(Fan_room)==-1){(async()=>{while(DoTaskFlag){await sleep(2e3)}window.location.href="https://www.douyu.com/"+Fan_room})();return}localStorage.setItem("__dakaqingbao__",date);setTimeout(()=>{getAllFishFood(100)},3*1e3)}}}function getFansRoomList(){var roomSet=new Set;fetch("https://www.douyu.com/member/cp/getFansBadgeList",{method:"GET",mode:"no-cors",cache:"no-store",credentials:"include"}).then(res=>{return res.text()}).then(txt=>{txt=(new DOMParser).parseFromString(txt,"text/html");let badgeList=txt.getElementsByClassName("fans-badge-list")[0].lastElementChild.children;if(badgeList.length>0){for(let i=0;i<badgeList.length;i++){roomSet.add(badgeList[i].getAttribute("data-fans-room"));roomSet.add("99999");getSpecialFollowList(roomSet)}}}).catch(err=>{console.error("REQUEST ERROR",err)})}function getSpecialFollowList(roomSet){fetch("https://www.douyu.com/wgapi/livenc/liveweb/follow/special",{method:"GET",mode:"cors",cache:"no-store",credentials:"include"}).then(res=>{return res.text()}).then(json=>{var followList=JSON.parse(json);followList=followList.data;for(let i=0;i<followList.length;i++){roomSet.add(followList[i].room_id.toString())}followList=Array.from(roomSet);sessionStorage.setItem("noCancelListğŸ’–ğŸ‘¸ğŸ’–",JSON.stringify(followList))}).catch(err=>{console.error("REQUEST ERROR",err)})}function checkFollowStaus(){return new Promise(resolve=>{if(document.getElementsByClassName("geetest_panel").length!=0){var risk=JSON.parse(localStorage.getItem("__Risk__"));risk.followLevel+=1;localStorage.setItem("__Risk__",JSON.stringify(risk));GlobalVerifyCode=true;wechatNotice("æœ‰éªŒè¯ç ")}let updateFlag=false;let robotId=getCookie("acf_uid");let config=JSON.parse(localStorage.getItem("_AccountConfig_")||"{}");console.log("FollowStatus",FollowStatus,"CanGiveRedPackets",config.CanGiveRedPackets);if(FollowStatus=="Error"&&config.CanGiveRedPackets!=false){config.CanGiveRedPackets=false;updateFlag=true}else if(FollowStatus=="Success"&&config.CanGiveRedPackets!=true){config.CanGiveRedPackets=true;updateFlag=true}if(updateFlag){GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config),onload:function(response){let ret=JSON.parse(response.response);if(ret.success){localStorage.setItem("_AccountConfig_",JSON.stringify(config))}else{console.error("æ›´æ–°configä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("æ›´æ–°configä¿¡æ¯å¤±è´¥")}})}resolve(FollowStatus!="Error")})}function followRoom(){var subObj=document.getElementsByClassName("Title-followBtn")[0];var followCheck=document.getElementsByClassName("Title-followBtnBox is-followed")[0];if(subObj!=undefined&&followCheck==undefined){console.log("å¼€å§‹å…³æ³¨");subObj.click();setTimeout(async()=>{console.log("æ£€æµ‹å…³æ³¨æƒ…å†µ");if(!await checkFollowStaus()){console.error("å…³æ³¨å¤±è´¥");GlobalFollowFlag=true;if(TakePartInFlag){GM_xmlhttpRequest({method:"GET",url:self_host+`:3434?type=takePartInFire&actId=${TakePartInActId}&num=-1`,onload:function(response){TakePartInFlag=false}})}}else{console.log("å·²ç»å…³æ³¨ğŸ’“ä¸»æ’­ï¼");var risk=JSON.parse(localStorage.getItem("__Risk__"));risk.followLevel=0;localStorage.setItem("__Risk__",JSON.stringify(risk))}},3e3);roomAssignTime=setTimeout(autoAssign,3e3)}else{GlobalFollowFlag=true}}function checkRisk(){var risk=localStorage.getItem("__Risk__");if(risk==null)risk='{"followLevel":0,"sendLevel":0,"time":0}';risk=JSON.parse(risk);if((new Date).getTime()/1e3-risk.time>15*60){risk.followLevel=0;risk.sendLevel=0;risk.time=(new Date).getTime()/1e3}localStorage.setItem("__Risk__",JSON.stringify(risk));if(risk.followLevel>3||risk.sendLevel>3){switchStatus="off";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","off")}else{switchStatus="on";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","on")}return risk.sendLevel<=3&&risk.followLevel<=3}function wechatNotice(msg){GM_xmlhttpRequest({method:"GET",url:self_host+":2019/send?wxid="+wxid+"&msg="+uname+":"+msg,onerror:function(err){console.error("å¾®ä¿¡é€šçŸ¥å¤±è´¥:",msg)}})}function roomFilter(roomNB){var roomFlag=false;if(banRoom.length>0){for(let i=0;i<banRoom.length;i++){if(banRoom[i]==roomNB){roomFlag=true;break}}}return roomFlag}function nameFilter(){var nameFlag=false;if(banName.length>0){for(let j=0;j<banName.length;j++){if(banName[j]==uname){nameFlag=true;break}}}return nameFlag}function getFilterConfigCoding(){GM_xmlhttpRequest({method:"GET",url:"https://chanknight.coding.net/p/cdn/d/cdn/git/raw/master/filterConfig.json",onload:function(response){if(response.responseText.indexOf("404")==-1){let jsonData=JSON.parse(response.responseText);banRoom=jsonData.roomFilter!=undefined?[].concat(jsonData.roomFilter):banRoom;banName=jsonData.nameFilter!=undefined?[].concat(jsonData.nameFilter):banName;aiAppId=jsonData.aiAppId!=undefined?[].concat(jsonData.aiAppId):aiAppId;AIwordFilter=jsonData.AIFilter!=undefined?[].concat(jsonData.AIFilter):AIwordFilter}},onerror:function(err){console.error("FilterConfig:Failure")}})}function thunderRoomAssign(){var ajax=new XMLHttpRequest;ajax.responseType="json";ajax.open("post","https://www.douyu.com/japi/roomuserlevel/apinc/checkIn",true);ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset-UTF-8");let paramStr="rid="+roomId+"&ctn="+getEffectCookie("acf_ccn");ajax.send(paramStr);ajax.onreadystatechange=function(){if(ajax.readyState==4&&Math.floor(ajax.status/100)==2){var json=ajax.response;if(json.data.rank!=-1){let expireTime=(new Date).setHours(0,0,0,0)+3600*24*1e3;localStorage.setItem("USER_ROOM_LEVEL_SIGN_"+roomId,'{"c":'+(new Date).getTime()+',"e":'+expireTime+',"v":"1","r":1}');console.info("APIæ¥å£è‡ªåŠ¨ç­¾åˆ°ğŸ“æˆåŠŸï¼Œç­¾åˆ°æ’åï¼š["+json.data.rank+"],ç­¾åˆ°æ—¶é—´:"+(new Date).toLocaleTimeString());popupToast("ã€Šæé€Ÿæˆ¿é—´ç­¾åˆ°ã€‹<br>APIæ¥å£è‡ªåŠ¨ç­¾åˆ°ğŸ“æˆåŠŸï¼Œç­¾åˆ°æ’åï¼šã€"+json.data.rank+"ã€‘<br>ç­¾åˆ°æ—¶é—´:"+(new Date).toLocaleTimeString()+"<br>æé€Ÿç­¾åˆ°åŠŸèƒ½å…³é—­",6)}}}}function prepareThunderAssign(){var anchorLevel=document.getElementsByClassName("AnchorLevel")[0].getAttribute("class").substring(24);fetch("https://www.douyu.com/wgapi/livenc/liveweb/follow/special",{method:"GET",mode:"cors",cache:"no-store",credentials:"include"}).then(res=>{return res.text()}).then(json=>{var followList=JSON.parse(json);followList=followList.data;var roomFlag=false;for(let i=0;i<followList.length;i++){if(followList[i].room_id==roomId){roomFlag=true;break}}if(roomFlag){if(anchorLevel>=30){let acfCookie=getEffectCookie("acf_ccn");getAnchorStatus();popupToast("ã€Šæé€Ÿæˆ¿é—´ç­¾åˆ°ã€‹<br>æé€Ÿç­¾åˆ°åŠŸèƒ½å·²å¼€å¯<br>è¯·F12æ§åˆ¶å°æŸ¥çœ‹åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼",4)}else{console.info("ä¸»æ’­ç­‰çº§<Lv.30ï¼Œæ— æˆ¿é—´å¯ç­¾åˆ°ï¼")}}else{popupToast("ã€Šæé€Ÿæˆ¿é—´ç­¾åˆ°ã€‹<br>å½“å‰æˆ¿é—´æœªæ·»åŠ åˆ°ã€ç‰¹åˆ«å…³æ³¨ã€‘<br>è¯·æ·»åŠ å¹¶é‡åˆ‡åˆ°âš¡æ‰èƒ½å¼€å¯ï¼",4)}}).catch(err=>{console.error("REQUEST ERROR",err)})}function getAnchorStatus(){fetch("https://www.douyu.com/wgapi/livenc/liveweb/follow/special",{method:"GET",mode:"cors",cache:"no-store",credentials:"include"}).then(res=>{return res.text()}).then(json=>{var followList=JSON.parse(json);followList=followList.data;for(let i=0;i<followList.length;i++){if(followList[i].room_id==roomId){if(followList[i].show_status=="1"){thunderRoomAssign();console.info("å·²ç»å¼€æ’­å•¦")}else if(radioStorage==="thunderAssign"){}else if(radioStorage==="ceaseFire"&&switchStatus==="on"){getAnchorStatus();console.info("æœªå¼€æ’­["+followList[i].show_status+"]æ£€æµ‹ä¸­")}break}}}).catch(err=>{console.error("REQUEST ERROR",err)})}function autoAssign(){if(window.location.href.search(Fan_room)==-1)return;let anchorLevel=document.getElementsByClassName("AnchorLevel")[0].getAttribute("class").substring(24);if(anchorLevel>=30){let assignObj=document.getElementsByClassName("RoomLevelDetail-icon")[0];let followCheck=document.getElementsByClassName("Title-followBtnBox is-followed")[0];if(assignObj!=undefined&&followCheck!=undefined){let unassign=document.getElementsByClassName("RoomLevelDetail-icon RoomLevelDetail-icon--zn")[0];if(unassign!=undefined){unassign.click();clearTimeout(roomAssignTime);popupToast("ã€Šæˆ¿é—´è‡ªåŠ¨ç­¾åˆ°ã€‹<br>æˆ¿é—´è‡ªåŠ¨ç‚¹å‡»ç­¾åˆ°ğŸ“æˆåŠŸ!",3);console.info("æˆ¿é—´ç­¾åˆ°ğŸ“å®Œæ¯•ï¼")}}else{checkDelayCallback(5)}}}function guid(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function setCookie(cookiename,value){var exp=new Date;exp.setTime(exp.getTime()+3*60*60*1e3);document.cookie=cookiename+"="+escape(value)+"; path=/; expires="+exp.toGMTString()}function getEffectCookie(cookiename){let cookie=getCookie(cookiename);if(cookie!=null&&cookie!=""){return cookie}else{setCookie(cookiename,guid());return getCookie(cookiename)}}function getCookie(cookieName){var acf_ccn="";var strCookie=document.cookie;var arrCookie=strCookie.split("; ");for(var i=0;i<arrCookie.length;i++){var arr=arrCookie[i].split("=");if(cookieName==arr[0]){acf_ccn=arr[1]}}return acf_ccn}function getFishballHarvest(){let showPlace=document.getElementsByClassName("PlayerToolbar-ywInfo")[0];if(showPlace!=undefined){let ballTag=document.createElement("dfn");ballTag.innerHTML="<a id ='fish_ball_profit' href='https://popzoo.github.io/zoo/' target='_blank'>ğŸŒ•èµšä¸¸-</a>";ballTag.setAttribute("class","PlayerToolbar-ywInfo");ballTag.setAttribute("style","text-align:left;margin-right:0px;");ballTag.setAttribute("data-info","ğŸŒ•-ç«åŠ›ä¸¸å­æ”¶ç›Šï¼Œè¿™é‡Œæ˜¾ç¤ºä»Šæ—¥å‚ä¸ç«åŠ›å…¨å¼€è·å¾—çš„é±¼ä¸¸æ”¶ç›Šåˆè®¡ï¼Œä¸­å¥–åæ•°æ®ä¸€èˆ¬ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œç‚¹å‡»è¿™é‡Œå¯ä»¥è¿›å…¥è–…ç¾Šæ¯›é¦–é¡µ;");showPlace.parentNode.insertBefore(ballTag,showPlace);let cashTag=document.createElement("dfn");cashTag.innerHTML="<a id ='red_cash_income' href='https://www.douyu.com/member/lottery/lotteryFirepower' target='_blank'>ğŸ’°çº¢åŒ…-</a>";cashTag.setAttribute("class","PlayerToolbar-ywInfo");cashTag.setAttribute("style","text-align:left;margin-right:6px;");cashTag.setAttribute("data-info","ğŸ’°-ç«åŠ›çº¢åŒ…æ”¶ç›Šï¼Œæ­¤å¤„æ˜¾ç¤ºä»Šæ—¥å‚ä¸ç«åŠ›å…¨å¼€(æš‚ä¸å«ç²‰ä¸ç¦åˆ©ç¤¾)è·å¾—çš„çº¢åŒ…æ”¶ç›Šåˆè®¡ï¼Œä¸­å¥–åæ•°æ®ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œç‚¹å‡»å¯ä»¥æŸ¥çœ‹ä¸­å¥–è®°å½•;");showPlace.parentNode.insertBefore(cashTag,showPlace);document.getElementById("fish_ball_profit").addEventListener("click",refreshFishballHarvest);refreshFishballHarvest(true)}else{checkDelayCallback(10)}}function refreshFishballHarvest(isFirst){let curDate=dateFormat("YYYY-mm-dd",new Date);fetch("https://www.douyu.com/japi/firepower/apinc/getLotteryRecord?pageSize=600&startTime="+curDate+"&endTime="+curDate,{method:"GET",mode:"no-cors",cache:"no-store",credentials:"include"}).then(res=>{return res.json()}).then(json=>{json=json.data.list;var fishBallCount=0;var cashAwardCount=0;let tpiRooms=JSON.parse(localStorage.getItem("_takePartInRooms_")||"[]");let reportedRooms=JSON.parse(localStorage.getItem("_reportedRooms_")||"[]");if(json.length>0){for(let i=0;i<json.length;i++){let actId=String(json[i].actId);if(json[i].prize.indexOf("é±¼ä¸¸")>-1){fishBallCount+=parseInt(json[i].prize.replace("é±¼ä¸¸",""))}else if(json[i].prize.indexOf("å…ƒçº¢åŒ…")>-1){if(isNaN(json[i].prize.replace("å…ƒçº¢åŒ…","")))continue;cashAwardCount+=parseInt(json[i].prize.replace("å…ƒçº¢åŒ…",""))}else{let gifts=JSON.parse(localStorage.getItem("_gifts_")||"[]");if(gifts.lastIndexOf(actId)==-1){wechatNotice("å¥–å“:"+json[i].prize+" actId:"+actId);gifts.push(actId);localStorage.setItem("_gifts_",JSON.stringify(gifts))}}if(tpiRooms.lastIndexOf(actId)!=-1){if(reportedRooms.lastIndexOf(actId)==-1){GM_xmlhttpRequest({method:"GET",url:self_host+":3434?type=luckFire&actId="+actId,onload:function(response){reportedRooms.push(actId);if(reportedRooms.length>300){reportedRooms=reportedRooms.slice(100)}localStorage.setItem("_reportedRooms_",JSON.stringify(reportedRooms))}})}}}}FishBallCount=fishBallCount;CashAwardCount=cashAwardCount;document.getElementById("fish_ball_profit").innerText="ğŸŒ•èµšä¸¸"+fishBallCount;document.getElementById("red_cash_income").innerText="ğŸ’°çº¢åŒ…"+cashAwardCount}).catch(err=>{console.error("æ— æ³•è·å–æ”¶ç›Šåˆ—è¡¨")})}function sendAllPackageGift(){let showPlace=document.getElementsByClassName("PlayerToolbar-ywInfo")[0];if(showPlace!=undefined){let giftTag=document.createElement("dfn");giftTag.innerText="ğŸæ¸…åŒ…";giftTag.setAttribute("class","PlayerToolbar-ywInfo");giftTag.setAttribute("style","text-align:left;margin-right:0px;");giftTag.addEventListener("click",getPackageGiftList);giftTag.setAttribute("data-info","ğŸ-ä¸€é”®æ¸…ç©ºèƒŒåŒ…ç¤¼ç‰©ï¼Œå…¨éƒ¨èµ é€ç»™å½“å‰çš„ç›´æ’­é—´ï¼Œç”±äºç›´æ¥é‡‡ç”¨æ¥å£èµ é€ï¼Œæ‰€ä»¥æ²¡æœ‰æ˜¾ç¤ºç‰¹æ•ˆï¼Œå¤§å®¶å¯ä»¥å†æ¬¡æ‰“å¼€èƒŒåŒ…æŸ¥çœ‹ç¤¼ç‰©æ˜¯å¦ä¸ºç©ºï¼Œéƒ¨åˆ†ç¨€æœ‰ç¤¼ç‰©å¯èƒ½ä¸æ”¯æŒæ¸…ç©º;");showPlace.parentNode.insertBefore(giftTag,showPlace)}else{checkDelayCallback(11)}}function getPackageGiftList(){let count=0;let packageBtn=document.getElementsByClassName("BackpackButton")[0];if(packageBtn!=undefined){packageBtn.click();getPackageGift()}function getPackageGift(){Fan_room&&fetch("https://www.douyu.com/japi/prop/backpack/web/v1?rid="+Fan_room).then(result=>{return result.json()}).then(json=>{if(json.data&&json.data.list&&json.data.list.length){var datas=[];let roomId=8651862;json.data.list.forEach(gift=>{var giftNum=gift.count;let giftId=gift.id;if(giftId==268){let postData="propId="+giftId+"&propCount=1&roomId="+Fan_room+"&bizExt=%7B%22yzxq%22%3A%7B%7D%7D";datas.push(postData);giftNum-=1}var postData="propId="+giftId+"&propCount="+giftNum+"&roomId="+roomId+"&bizExt=%7B%22yzxq%22%3A%7B%7D%7D";if(giftId==912||giftId==178||giftId==179||giftId==180||giftId==4||giftId==5){postData="propId="+giftId+"&propCount=1&roomId="+roomId+"&bizExt=%7B%22yzxq%22%3A%7B%7D%7D";for(var i=0;i<giftNum;i++){datas.push(postData)}}else{datas.push(postData)}});var tempInterval=setInterval(()=>{var temp_data=datas.pop();if(temp_data){loopSendGift(temp_data)}else{clearInterval(tempInterval)}},103);popupToast("ã€Šä¸€é”®æ¸…ç©ºèƒŒåŒ…ã€‹<br>èƒŒåŒ…ç¤¼ç‰©æ¸…ç©ºæˆåŠŸï¼",3)}});function loopSendGift(postData){fetch("https://www.douyu.com/japi/prop/donate/mainsite/v1",{method:"POST",mode:"no-cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:postData}).then(result=>{return result.json()}).then(json=>{console.info("é€ç¤¼çŠ¶æ€:"+json.msg)}).catch(err=>{console.error("REQUEST ERROR",err)})}}}function addFansClickBtn(){let fishballBtn=document.getElementsByClassName("PlayerToolbar-ywInfo")[0];if(fishballBtn!=undefined){let dfnTag=document.createElement("dfn");dfnTag.className="PlayerToolbar-ywInfo";dfnTag.setAttribute("style","text-align:left;margin-right:0;");dfnTag.setAttribute("data-info","ğŸ¯-æ‰“å¡ç»­ç‰Œå­ï¼Œä¸€é”®ç»™è‡ªå·±æ‰€æœ‰å¸¦ç²‰ä¸ç‰Œçš„æˆ¿é—´è‡ªåŠ¨èµ é€ä¸€ä¸ªè§å…‰æ£’ï¼Œè‡ªåŠ¨ç»­ç‰Œå­é˜²æ­¢æ‰äº²å¯†åº¦å‘¦ï¼");dfnTag.innerText="ğŸ¯æ‰“å¡";dfnTag.addEventListener("click",getFansMedalList);fishballBtn.parentNode.insertBefore(dfnTag,fishballBtn)}else{checkDelayCallback(12)}}function getFansMedalList(){var badgeStr="";popupToast("ã€Šç²‰ä¸ç»­ç‰Œå­æ‰“å¡ã€‹<br>æ­£åœ¨æ‰“å¡ä¸­...",2);fetch("https://www.douyu.com/member/cp/getFansBadgeList",{method:"GET",mode:"no-cors",cache:"default",credentials:"include"}).then(res=>{return res.text()}).then(txt=>{txt=(new DOMParser).parseFromString(txt,"text/html");let badgeList=txt.getElementsByClassName("fans-badge-list")[0].lastElementChild;var i=0;console.info("è·å–éœ€è¦æ‰“å¡çš„ç‰Œå­æ•°ï¼š"+badgeList.children.length);function loopDonate(){if(i==badgeList.children.length){badgeStr=badgeStr.substr(0,badgeStr.length-1);popupToast("ã€Šç²‰ä¸ç»­ç‰Œå­æ‰“å¡ã€‹<br>"+badgeStr+"<br>ä»¥ä¸Šå¸¦ç²‰ä¸ç‰Œæˆ¿é—´æ‰“å¡æˆåŠŸï¼",4)}else{let room_id=badgeList.children[i].getAttribute("data-fans-room");let room_name=badgeList.children[i].firstElementChild.nextElementSibling.innerText.trim();let postData="propId=268&propCount=1&roomId="+room_id+"&bizExt=%7B%22yzxq%22%3A%7B%7D%7D";fetch("https://www.douyu.com/japi/prop/donate/mainsite/v1",{method:"POST",mode:"no-cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:postData}).then(result=>{return result.json()}).then(json=>{console.info("ã€"+room_name+"ã€‘:"+json.msg);if(json.error==0){badgeStr+="ã€"+room_name+"ã€‘,"}else if(json.error==1&&json.msg.indexOf("ç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„é“å…·")>-1){popupToast("ã€Šç²‰ä¸æ‰“å¡å¤±è´¥ã€‹<br>é“å…·ä¸è¶³ï¼Œæ— æ³•å®Œæˆæ‰“å¡ï¼",3);if(badgeStr.indexOf("ã€‘")>-1){badgeStr=badgeStr.substr(0,badgeStr.length-1);setTimeout(function(){popupToast("ã€Šç²‰ä¸ç»­ç‰Œå­æ‰“å¡ã€‹<br>"+badgeStr+"<br>ä»¥ä¸Šå¸¦ç²‰ä¸ç‰Œæˆ¿é—´æ‰“å¡æˆåŠŸï¼",3)},2500)}return}i++;loopDonate()}).catch(err=>{console.error("REQUEST ERROR",err)})}}if(badgeList.innerText.indexOf("æš‚æ— æ•°æ®")==-1){loopDonate()}else{popupToast("ã€Šç²‰ä¸ç»­ç‰Œå­æ‰“å¡ã€‹<br>æ²¡æœ‰æ£€æµ‹åˆ°æ‚¨æœ‰ç²‰ä¸ç‰Œ<br>ä¸å¿˜åˆå¿ƒï¼Œæ‹’ç»åŠå¡ï¼Œç™½å«–å¤§å†›å¨æ­¦ï¼",3)}}).catch(err=>{console.error("ç²‰ä¸åˆ—è¡¨è·å–å¤±è´¥")})}function addFishFoodClickBtn(){let fishballBtn=document.getElementsByClassName("PlayerToolbar-ywInfo")[0];if(fishballBtn!=undefined){let divTag=document.createElement("dfn");divTag.className="PlayerToolbar-ywInfo";divTag.setAttribute("style","text-align:left;margin-right:0;");divTag.setAttribute("id","fish_food_tag");divTag.setAttribute("data-info","ğŸ°-é¢†é±¼ç²®å’Œå°ç¤¼ç‰©ï¼Œä¸€é”®é¢†å–æ‰€æœ‰é±¼ç²®ï¼Œå¹¶è‡ªåŠ¨å‚ä¸ä¸€æ¬¡é±¼ç²®æŠ½å¥–ï¼ŒæŠ½å–å°ç¤¼ç‰©ã€‚æ¯æ¬¡é¡µé¢åˆ·æ–°æˆ–è·³è½¬ï¼Œä¹Ÿä¼šè‡ªåŠ¨é¢†å–é±¼ç²®ï¼Œä½†ä¸å‚ä¸æŠ½å¥–å“Ÿï¼");divTag.innerText="ğŸ°é±¼ç²®";divTag.addEventListener("click",function(){getAllFishFood(100)});fishballBtn.parentNode.insertBefore(divTag,fishballBtn)}else{checkDelayCallback(13)}}function getAllFishFood(sign){var minute=dateFormat("MM",new Date);if(minute<55)return;if(window.location.href.search(Fan_room)!=-1){getPackageGiftList()}}function getFishFoodGift(){let postData="rid="+roomId+"&ctn="+getEffectCookie("acf_ccn");fetch("https://www.douyu.com/japi/activepointnc/api/dolottery",{method:"POST",mode:"no-cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:postData}).then(res=>{return res.json()}).then(json=>{if(json.data!=null&&json.data.msg!=null){popupToast("ã€Šé¢†é±¼ç²®+å°ç¤¼ç‰©ã€‹<br>æ‰€æœ‰é±¼ç²®é¢†å–å®Œæ¯•<br>"+json.data.msg,3)}else{popupToast("ã€Šé¢†é±¼ç²®+å°ç¤¼ç‰©ã€‹<br>"+json.msg,3)}}).catch(err=>{console.error("é±¼ç²®æŠ½å¥–å‚ä¸å¤±è´¥")})}function bombFireFilter(){setTimeout(randomFireRequest,100);let fireCheck=document.getElementsByClassName("FirePowerChatModal-Notice")[0];let fireCheck2=document.getElementsByClassName("MuteStatus is-noLogin").length;if(fireCheck!=undefined&&!joinCondition()&&awardJudge()&&!banSpeak()&&fireCheck2==0){console.info("ç¬¦åˆå¼¹å¹•ğŸ’¥å‘é€ï¼");var joinObj=document.querySelector(".FirePowerChatModal-joinCondition");if(joinObj!=null){joinObj=joinObj.innerText;if(joinObj.indexOf("å…³æ³¨ä¸»æ’­")!=-1){console.info("å…³æ³¨ä¸»æ’­æ‰èƒ½å‚ä¸ï¼");followRoom()}}firePowerController()}else{if(switchStatus==="on"){jumpDelayConfig()}else{firePowerController()}}}function switchChange(){clearTimeout(fireJumpTime);clearTimeout(firePowerTime);if(switchStatus==="on"){switchStatus="off";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","off");document.getElementById("ceaseFire").nextSibling.nodeValue="â›”";if(radioStorage==="openFire"){welfareFilter()}else if(radioStorage==="bombFire"){bombFireFilter()}else if(radioStorage==="ceaseFire"){console.info("â›”-é™é»˜åœæ­¢")}}else{switchStatus="on";localStorage.setItem("switchStatusğŸ®ğŸğŸ®","on");document.getElementById("ceaseFire").nextSibling.nodeValue="âš¡";if(radioStorage==="openFire"){welfareFilter()}else if(radioStorage==="bombFire"){bombFireFilter()}else if(radioStorage==="ceaseFire"){console.info("âš¡-æé€Ÿç­¾åˆ°");prepareThunderAssign()}}}function removeSomeAds(){let signToolBar=document.querySelector(".PlayerToolbar-signCont");signToolBar!=null?signToolBar.remove():false;let signBarrage=document.querySelector(".SignBarrage");signBarrage!=null?signBarrage.remove():false;let titleAd=document.querySelector(".Title-ad");titleAd!=null?titleAd.remove():false;let changeStyle=document.getElementById("guess-main-panel");changeStyle!=undefined?changeStyle.setAttribute("style","z-index:10;"):false;var title=document.querySelector(".Title-header");title!=undefined?title.remove():false;checkDelayCallback(9)}function report2wechat(){async function getProfit(){return new Promise(resolve=>{var zuotian=(new Date).getTime()-24*60*60*1e3;zuotian=dateFormat("YYYY-mm-dd",new Date(zuotian));fetch("https://www.douyu.com/japi/firepower/apinc/getLotteryRecord?pageSize=600&startTime="+zuotian+"&endTime="+zuotian,{method:"GET",mode:"no-cors",cache:"no-store",credentials:"include"}).then(res=>{return res.json()}).then(json=>{json=json.data.list;var fishBallCount=0;var cashAwardCount=0;if(json.length>0){for(let i=0;i<json.length;i++){if(json[i].prize.indexOf("é±¼ä¸¸")>-1){fishBallCount+=parseInt(json[i].prize.replace("é±¼ä¸¸",""))}else if(json[i].prize.indexOf("å…ƒçº¢åŒ…")>-1){if(isNaN(json[i].prize.replace("å…ƒçº¢åŒ…","")))continue;cashAwardCount+=parseInt(json[i].prize.replace("å…ƒçº¢åŒ…",""))}}}resolve({fishBallCount:fishBallCount,cashAwardCount:cashAwardCount})}).catch(err=>{console.error("æ— æ³•è·å–æ”¶ç›Šåˆ—è¡¨");resolve({fishBallCount:-1,cashAwardCount:-1})})})}setTimeout(async()=>{var date=dateFormat("YYYY-mm-dd",new Date);if(localStorage.getItem("__report2wechat__")!=date){var profit=await getProfit();let robotId=getCookie("acf_uid");let yesterdayBenfit=JSON.stringify([profit.fishBallCount,profit.cashAwardCount]);GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/reportYesterdayBenfit/${robotId}/${yesterdayBenfit}`,onload:function(response){let ret=JSON.parse(response.response);if(ret.success){localStorage.setItem("__report2wechat__",date)}else{console.error("æ›´æ–°æ˜¨å¤©æ”¶ç›Šä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("æ›´æ–°æ˜¨å¤©æ”¶ç›Šä¿¡æ¯å¤±è´¥")}})}else{return}},100)}function radioChange(msg){clearTimeout(firePowerTime);clearTimeout(fireJumpTime);if(msg==="ceaseFire"){radioStorage="ceaseFire";if(switchStatus==="on"){console.info("âš¡-æé€Ÿç­¾åˆ°");prepareThunderAssign()}else{console.info("â›”-é™é»˜åœæ­¢")}localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg)}else if(msg==="openFire"){radioStorage="openFire";console.info("ğŸ°-ç²‰ä¸æŠ½å¥–");localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg);welfareFilter()}else if(msg==="bombFire"){radioStorage="bombFire";console.info("ğŸ’¥-å¼¹å¹•è½°ç‚¸");localStorage.setItem("radioTagStatusğŸŒ¼ğŸ„ğŸŒ¼",msg);bombFireFilter()}}function checkAccountStatus(){let robotId=getCookie("acf_uid");GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/getConfig/${robotId}`,onload:function(response){let ret=JSON.parse(response.response);if(ret.success){console.log("CONFIG:",ret);!ret.data&&(ret.data="{}");localStorage.setItem("_AccountConfig_",ret.data);updateGMVersion()}else{console.error("è·å–configä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("è·å–configä¿¡æ¯å¤±è´¥")}});function updateGMVersion(){let config=JSON.parse(localStorage.getItem("_AccountConfig_")||"{}");if(config.GMVersion!=GM_info.script.version){config.GMVersion=GM_info.script.version;GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config),onload:function(response){console.log(ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config));console.log(response.response);let ret=JSON.parse(response.response);if(ret.success){localStorage.setItem("_AccountConfig_",JSON.stringify(config))}else{console.error("æ›´æ–°GM_versionä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("æ›´æ–°GM_versionä¿¡æ¯å¤±è´¥")}})}}function updateAccountStatus(){fetch("https://www.douyu.com/japi/tasksys/ytxb/getPrize",{headers:{accept:"application/json, text/plain, */*","accept-language":"zh-CN,zh;q=0.9","content-type":"application/x-www-form-urlencoded; charset=UTF-8","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest"},referrer:"https://www.douyu.com/7672892",referrerPolicy:"no-referrer-when-downgrade",body:"id=212&roomId=7672892",method:"POST",mode:"cors",credentials:"include"}).then(res=>res.json()).then(json=>{let config=JSON.parse(localStorage.getItem("_AccountConfig_")||"{}");let updateFlag=false;if(json.error==1011&&config.CanGiveRedPackets!=false){config.CanGiveRedPackets=false;updateFlag=true}else if(json.error!=1011&&config.CanGiveRedPackets!=true){config.CanGiveRedPackets=true;updateFlag=true}if(updateFlag){GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config),onload:function(response){console.log(ZhiBoHelperHost+`/robot/updateConfig/${robotId}/`+JSON.stringify(config));console.log(response.response);let ret=JSON.parse(response.response);if(ret.success){localStorage.setItem("_AccountConfig_",JSON.stringify(config))}else{console.error("æ›´æ–°configä¿¡æ¯å¤±è´¥")}},onerror:err=>{console.error(err);console.error("æ›´æ–°configä¿¡æ¯å¤±è´¥")}})}})}}function keepAlive(){GM_xmlhttpRequest({method:"GET",url:self_host+":3434/?type=keepalive&wxid="+wxid+"&name="+uname,onload:function(response){console.log("ä¿æŒå¿ƒè·³ing....")},onerror:function(err){console.log("ä¿æŒå¿ƒè·³å¤±è´¥....")}})}function ZhiBoHelper(){let robotId,name,YuWan,YuChi,todayBenfit,keepAlive;let robot=JSON.parse(localStorage.getItem("robot"));robotId=getCookie("acf_uid");name=uname;let Span=document.getElementsByClassName("PlayerToolbar-wealthNum");Span&&Span[0]&&(YuWan=Span[0].innerText);Span&&Span[1]&&(YuChi=Span[1].innerText);FishBallCount!=undefined&&CashAwardCount!=undefined&&(todayBenfit=[FishBallCount,CashAwardCount]);keepAlive=(new Date).getTime();updateInfo();function updateInfo(){if(robotId!=""&&name!="0_0"&&YuWan!=undefined&&YuChi!=undefined&&todayBenfit!=undefined&&level!=undefined){if(ZhiBoHelperUserId==undefined){alert("è¯·è¾“å…¥ç”¨æˆ·Id")}if(!whetherChange()){console.log("updateRobotInfo,æ— éœ€æ›´æ–°");return}let Benfit=JSON.stringify(todayBenfit);GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/robot/updateRobotInfo/${ZhiBoHelperUserId}/${robotId}/${name}/${YuWan}/${YuChi}/${Benfit}/${keepAlive}/${level}`,onload:function(response){let ret=response.response;ret=JSON.parse(ret);localStorage.setItem("robot",JSON.stringify(ret.data));console.log("æ›´æ–°robotæˆåŠŸ")},onerror:function(err){console.error(err);console.error("æ›´æ–°robotå¤±è´¥");console.log(ZhiBoHelperHost+`/robot/updateRobotInfo/${ZhiBoHelperUserId}/${robotId}/${name}/${YuWan}/${YuChi}/${todayBenfit}/${keepAlive}/${level}`)}})}else{setTimeout(ZhiBoHelper,2e3)}}function whetherChange(){return robot==null||robot.todayBenfit[0]!=todayBenfit[0]||robot.todayBenfit[1]!=todayBenfit[1]}}async function doTask(){let robotId=getCookie("acf_uid");let banTaskIds=JSON.parse(localStorage.getItem("banTaskIds")||"[]");let TaskType={CouRenTou:0,SendGift:1};GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/task/getOnGoingTasks/${robotId}`,onload:function(response){let ret=response.response;console.log(ret);ret=JSON.parse(ret);let tasks=ret.data;console.log("æ‰€æœ‰ä»»åŠ¡:",tasks);tasks.length!=0&&(DoTaskFlag=true);tasks.forEach(async task=>{if(banTaskIds.indexOf(task._id)!=-1)return;if(task.type==TaskType.CouRenTou||task.type==TaskType.SendGift){let endTime=new Date(task.endTime).getTime();let curTime=(new Date).getTime();if(curTime<endTime){let i=0;let failTime=0;while(i<task.giftNum&&failTime<3){let res=await fetch("https://www.douyu.com/japi/gift/donate/mainsite/v2",{headers:{"content-type":"application/x-www-form-urlencoded"},body:`giftId=${task.giftId}&giftCount=1&roomId=${task.roomId}&bizExt=%7B%22yzxq%22%3A%7B%7D%7D`,method:"POST"});let json=await res.json();if(json.msg=="success"){i+=1;console.log(`å¾ªç¯èµ é€--æˆ¿é—´å·:${task.roomId}--ç¤¼ç‰©Id:${task.giftId}--ç¤¼ç‰©æ•°é‡:1`)}else{failTime+=1}i<task.giftNum&&await sleep(300);console.log("i==task.giftNum",i,task.giftNum,i==task.giftNum);if(i==task.giftNum){GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/task/changeTaskStatus/Robot/${robotId}/${task._id}`,onload:function(response){let ret=JSON.parse(response.response);if(ret.success){DoTaskFlag=false;console.log(`æ€»ç»“--æˆ¿é—´å·:${task.roomId}--ç¤¼ç‰©Id:${task.giftId}--ç¤¼ç‰©æ•°é‡:${task.giftNum}`)}else{banTaskIds.push(task._id);console.error("ä»»åŠ¡çŠ¶æ€æŠ¥å‘Šå¤±è´¥");wechatNotice("ä»»åŠ¡çŠ¶æ€æŠ¥å‘Šå¤±è´¥");DoTaskFlag=false}},onerror:err=>{banTaskIds.push(task._id);console.error(err);console.error("ä»»åŠ¡çŠ¶æ€æŠ¥å‘Šå¤±è´¥");wechatNotice("ä»»åŠ¡çŠ¶æ€æŠ¥å‘Šå¤±è´¥");DoTaskFlag=false}})}}if(failTime>=3){banTaskIds.push(task._id);wechatNotice("èµ é€ç¤¼ç‰©å¤±è´¥");DoTaskFlag=false}}else{GM_xmlhttpRequest({method:"GET",url:ZhiBoHelperHost+`/task/setTaskExpired/${robotId}/${task._id}`,onload:function(response){let ret=JSON.parse(response.response);if(ret.success){console.log(`è®¾ç½®ä»»åŠ¡è¿‡æœŸå®Œæ¯•`);DoTaskFlag=false}else{console.error("è®¾ç½®ä»»åŠ¡è¿‡æœŸå¤±è´¥");wechatNotice("è®¾ç½®ä»»åŠ¡è¿‡æœŸå¤±è´¥");DoTaskFlag=false}},onerror:err=>{console.error(err);console.error("è®¾ç½®ä»»åŠ¡è¿‡æœŸå¤±è´¥");wechatNotice("è®¾ç½®ä»»åŠ¡è¿‡æœŸå¤±è´¥");DoTaskFlag=false}})}}});localStorage.setItem("banTaskIds",JSON.stringify(banTaskIds))},onerror:function(err){console.error(err);console.error("è·å–ä»»åŠ¡å¤±è´¥")}})}function takePartInFire(){let room=JSON.parse(localStorage.getItem("_nowTaskPartInRoom_"));if(room==null){return}GM_xmlhttpRequest({method:"GET",url:self_host+`:3434?type=takePartInFire&actId=${room.actId}&num=1`,onload:function(response){localStorage.removeItem("_nowTaskPartInRoom_");TakePartInFlag=true;TakePartInActId=room.actId}})}function changeH5(){const switchCheck=setInterval(function(){console.log("changeH5...",unsafeWindow.__player);if(unsafeWindow.__player&&unsafeWindow.__player.switchPlayer){console.log("current player:",unsafeWindow.__player.getsessionStorage("ds_player_remeber_key"));if(unsafeWindow.__player.getsessionStorage("ds_player_remeber_key")=="flash"){unsafeWindow.__player.switchPlayer("h5")}clearInterval(switchCheck)}},1e3)}function addXHRInterceptor(){(function(open){console.log("æ·»åŠ xhræ‹¦æˆªå™¨");XMLHttpRequest.prototype.open=function(){if(arguments[1].indexOf("wgapi/livenc/liveweb/follow/add")!=-1){console.log("xhræ‹¦æˆªå™¨æ·»åŠ æˆåŠŸ");this.addEventListener("load",function(){if(this.responseURL.startsWith("")){console.log(JSON.parse(this.responseText));let errorCode=JSON.parse(this.responseText).error;if(errorCode!=0){console.log("å…³æ³¨å¤±è´¥");FollowStatus="Error"}else{console.log("å…³æ³¨æˆåŠŸ");FollowStatus="Success"}}},false)}open.apply(this,arguments)}})(XMLHttpRequest.prototype.open)}function programInitCheck(){var chatCheck=document.querySelector(".ChatSend");if(chatCheck==null){checkDelayCallback(0)}else{sbts=(new Date).getTime();msgTxt=document.querySelector(".ChatSend-txt");msgBtn=document.querySelector(".ChatSend-button");addXHRInterceptor();createUIElement();jsonAnalytics(1);screenBarrageMemory();autoPlayMemory(true);getUserInfo();getPhoneStatus();getRoomId();userConfig();changeH5();removeSomeAds();keepAlive();if(!checkRisk()){geli();return}ZhiBoHelper();checkAccountStatus();doTask();activePageCheck();getFilterConfigCoding();getFishballHarvest();addFansClickBtn();addFishFoodClickBtn();cloudBarrage();getGender();autoAssign();AppSign();report2wechat();setTimeout(storageOperate,1e4);sbts=(new Date).getTime();checkDelayCallback(1)}}function checkDelayCallback(code){if(code===0){setTimeout(programInitCheck,1e3)}else if(code===1){setTimeout(barrageInitCheck,1e3)}else if(code===2){if(((new Date).getTime()-sbts)/1e3<25){setTimeout(barrageInitCheck,1e3)}else{switchStatus==="on"?jumpDelayConfig():welfareController()}}else if(code===3){if(((new Date).getTime()-sbts)/1e3<25){setTimeout(barrageInitCheck,1e3)}else{switchStatus==="on"?jumpDelayConfig():firePowerController()}}else if(code===4){if(((new Date).getTime()-sbts)/1e3<15){setTimeout(screenBarrageMemory,1500)}}else if(code===5){if(((new Date).getTime()-sbts)/1e3<15){setTimeout(autoAssign,2e3)}}else if(code===6){if(((new Date).getTime()-sbts)/1e3<15){setTimeout(releasePhoneLimit,3e3)}}else if(code===7){setTimeout(getAllFishFood,7e3)}else if(code===8){if(((new Date).getTime()-sbts)/1e3<15){setTimeout(function(){autoPlayMemory(true)},1e3)}}else if(code===9){setTimeout(removeSomeAds,5e3)}else if(code===10){if(((new Date).getTime()-sbts)/1e3<10){setTimeout(getFishballHarvest,1e3)}else{console.warn("æ— çº¢åŒ…æ˜¾ç¤ºä½ç½®")}}else if(code===11){if(((new Date).getTime()-sbts)/1e3<10){setTimeout(sendAllPackageGift,1e3)}else{console.warn("æ— æ¸…åŒ…æ˜¾ç¤ºä½ç½®")}}else if(code===12){if(((new Date).getTime()-sbts)/1e3<10){setTimeout(addFansClickBtn,1e3)}else{console.warn("æ— æ‰“å¡æ˜¾ç¤ºä½ç½®")}}else if(code===13){if(((new Date).getTime()-sbts)/1e3<10){setTimeout(addFishFoodClickBtn,1e3)}else{console.warn("æ— é±¼ç²®æ˜¾ç¤ºä½ç½®")}}}function barrageInitCheck(){if(radioStorage==="openFire"){let fansCheck=document.getElementsByClassName("LotteryDrawEnter-enter")[0];if(fansCheck!=undefined){setTimeout(welfareFilter,3500)}else{checkDelayCallback(2)}}else if(radioStorage==="bombFire"){let fireCheck=document.getElementsByClassName("FirePowerChatModal-Notice")[0];if(fireCheck!=undefined){setTimeout(bombFireFilter,2e3)}else{checkDelayCallback(3)}}else{if(switchStatus==="on"&&radioStorage==="ceaseFire"){console.info("âš¡-æé€Ÿç­¾åˆ°");prepareThunderAssign()}else{console.info("é™é»˜åœæ­¢â›”")}}}setTimeout(programInitCheck,4e3)}let NoFollowFailTime=0;async function NoFollow(){try{let totalpage;document.getElementById("totalRecords")&&document.getElementById("totalRecords").innerText&&(totalpage=Number(document.getElementById("totalRecords").innerText.split(" ")[1]));if(totalpage==undefined){NoFollowFailTime++;await sleep(2e3);if(NoFollowFailTime<5){NoFollow()}else{window.close()}return}let standarCount=295;var Whitelists=["åè‚†åè‚†"];let intervalTime=100;let completeFlags=[];if(totalpage>=standarCount){fksTimeout&&clearTimeout(fksTimeout);var infos=document.getElementsByClassName("v_info");for(var i=infos.length-1;i>=0;i--){let href=infos[i].children[0].children[0].href;let index=href.lastIndexOf("/");let roomId=href.substr(index+1);var username=infos[i].children[1].innerText;if(!Whitelists.includes(username)){GM_xmlhttpRequest({method:"GET",url:self_host+":3434?type=noFollow&roomId="+roomId,onload:function(response){var json=JSON.parse(response.responseText);if(json){completeFlags.push(roomId)}}})}}setInterval(()=>{console.log("è¦å–å…³çš„æˆ¿é—´å·ï¼š",completeFlags);completeFlags.forEach(room=>{let infos=document.getElementsByClassName("v_info");for(var i=infos.length-1;i>=0;i--){let href=infos[i].children[0].children[0].href;let index=href.lastIndexOf("/");let roomId=href.substr(index+1);if(roomId==room){infos[i].children[3].children[1].click()}}});completeFlags=[]},7e3);setInterval(()=>{if(completeFlags.length==0){if(totalpage<standarCount){window.close();return}else{window.location.href="https://www.douyu.com/room/follow?page="+Math.floor(Math.random()*(totalpage-1))}}},12*1e3)}else{console.log("å–å…³å®Œæ¯•");window.close()}}catch(e){console.error(e);window.close()}}(async function(){fksTimeout=setTimeout(()=>{(async()=>{while(DoTaskFlag){await sleep(2e3)}location.reload()})()},2*60*1e3);if(document.title.indexOf("æ–—é±¼-ç«™å†…ä¿¡")!=-1)return;if(document.title.indexOf("é±¼å§-æ–—é±¼ç¤¾åŒº,ç›´æ’­çˆ±å¥½è€…çš„èšé›†åœ°")!=-1)return;if(document.title.length==0)return;if(window.location.href.includes("https://www.douyu.com/room/follow")){NoFollow()}else if(window.location.host=="www.douyu.com"){roomScript()}})();
