// ==UserScript==
// @name         –Ø–Ω–¥–µ–∫—Å –ü–í–ó ‚Äî –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
// @namespace    http://tampermonkey.net/
// @version      5.0
// @description  –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É –Ø–Ω–¥–µ–∫—Å –î–æ—Å—Ç–∞–≤–∫–∏
// @author       B
// @match        *://*.yandex.ru/*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/561571/%D0%AF%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%20%D0%9F%D0%92%D0%97%20%E2%80%94%20%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%89%D1%91%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D1%8B.user.js
// @updateURL https://update.greasyfork.org/scripts/561571/%D0%AF%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%20%D0%9F%D0%92%D0%97%20%E2%80%94%20%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%89%D1%91%D0%BD%D0%BD%D1%8B%D0%B5%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D1%8B.meta.js
// ==/UserScript==

(() => {
  'use strict';

  /* ================= CONFIG ================= */

  const CONFIG = {
    debounceMs: 300
  };

  /* ================= REGULATIONS ================= */

  const DENY_CATEGORIES = {
    explosives: {
      title: '–í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '–ø–æ—Ä–æ—Ö','—Ç—Ä–æ—Ç–∏–ª','–¥–∏–Ω–∞–º–∏—Ç','–ø–∏—Ä–æ—Ç–µ—Ö–Ω–∏–∫',
        '—Å–∏–≥–Ω–∞–ª—å–Ω.*—Ä–∞–∫–µ—Ç','–≤–∑—Ä—ã–≤–Ω.*–∫–∞–ø—Å—É–ª'
      ]
    },

    flammable_gases: {
      title: '–õ–µ–≥–∫–æ–≤–æ—Å–ø–ª–∞–º–µ–Ω—è—é—â–∏–µ—Å—è –≥–∞–∑—ã',
      words: ['–ø—Ä–æ–ø–∞–Ω','–±—É—Ç–∞–Ω','–∏–∑–æ–±—É—Ç–∞–Ω','–∞—Ü–µ—Ç–∏–ª–µ–Ω','–º–µ—Ç–∞–Ω']
    },

    flammable_liquids: {
      title: '–õ–µ–≥–∫–æ–≤–æ—Å–ø–ª–∞–º–µ–Ω—è—é—â–∏–µ—Å—è –∂–∏–¥–∫–æ—Å—Ç–∏',
      words: [
        '–±–µ–Ω–∑–∏–Ω','–∞—Ü–µ—Ç–æ–Ω','—ç—Ç–∞–Ω–æ–ª','–º–µ—Ç–∞–Ω–æ–ª',
        '—Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª','–∫–µ—Ä–æ—Å–∏–Ω', '–∞–Ω—Ç–∏—Ñ—Ä–∏–∑',
        '—Ç–æ—Å–æ–ª'
      ]
    },

    flammable_solids: {
      title: '–õ–µ–≥–∫–æ–≤–æ—Å–ø–ª–∞–º–µ–Ω—è—é—â–∏–µ—Å—è —Ç–≤—ë—Ä–¥—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '–±–µ–ª.*—Ñ–æ—Å—Ñ–æ—Ä','–º–∞–≥–Ω–∏–π','–∞–ª—é–º–∏–Ω–∏–µ–≤.*–ø–æ—Ä–æ—à–æ–∫',
        '–Ω–∞–ø–∞–ª–º','–∫–∞—Ä–±–∏–¥ –∫–∞–ª—å—Ü–∏—è','—Ç–µ—Ä–º–∏—Ç'
      ]
    },

    oxidizers: {
      title: '–û–∫–∏—Å–ª—è—é—â–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '–∞–º–º–∏–∞—á–Ω.*—Å–µ–ª–∏—Ç—Ä','—Ö–ª–æ—Ä–∞—Ç –∫–∞–ª—å—Ü–∏—è',
        '–ø–µ—Ä–º–∞–Ω–≥–∞–Ω–∞—Ç –∫–∞–ª–∏—è','–Ω–∏—Ç—Ä–∞—Ç –∞–º–º–æ–Ω–∏—è',
        '–ø–µ—Ä–µ–∫–∏—Å—å –≤–æ–¥–æ—Ä–æ–¥–∞'
      ]
    },

    toxic: {
      title: '–¢–æ–∫—Å–∏—á–Ω—ã–µ –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '—Ä—Ç—É—Ç—å','–ø–µ—Å—Ç–∏—Ü–∏–¥','–≥–µ—Ä–±–∏—Ü–∏–¥',
        '–º–µ–¥–∏—Ü–∏–Ω—Å–∫.*–æ—Ç—Ö–æ–¥','—è–¥','—Ñ–µ–Ω–æ–ª','—Ü–∏–∞–Ω–∏–¥'
      ]
    },

    radioactive: {
      title: '–†–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
      words: [
        '—Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤','–∏–∑–æ—Ç–æ–ø','—É—Ä–∞–Ω','—É—Ä–∞–Ω–æ–≤.*—Ä—É–¥–∞',
        '—Ä–∞–¥–∏–π','—Ç–µ—Ö–Ω–µ—Ü–∏–π'
      ]
    },

    corrosive: {
      title: '–ö–æ—Ä—Ä–æ–∑–∏–æ–Ω–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '—Å–µ—Ä–Ω.*–∫–∏—Å–ª–æ—Ç','—Å–æ–ª—è–Ω.*–∫–∏—Å–ª–æ—Ç',
        '—â–µ–ª–æ—á','–∞–º–º–∏–∞–∫','–≥–∏–¥—Ä–æ–∫—Å–∏–¥ –Ω–∞—Ç—Ä–∏—è',
        '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä.*–∫–∏—Å–ª–æ—Ç'
      ]
    },

    drugs: {
      title: '–ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Å–∏—Ö–æ—Ç—Ä–æ–ø–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
      words: [
        '–≥–µ—Ä–æ–∏–Ω','–∫–æ–∫–∞–∏–Ω','–ª—Å–¥','—ç–∫—Å—Ç–∞–∑–∏',
        '–±–∞—Ä–±–∏—Ç—É—Ä–∞—Ç','–∞–º—Ñ–µ—Ç–∞–º–∏–Ω'
      ]
    },

    weapons: {
      title: '–û—Ä—É–∂–∏–µ –∏ –±–æ–µ–ø—Ä–∏–ø–∞—Å—ã',
      words: [
        '–æ—Ä—É–∂–∏–µ','–æ–≥–Ω–µ—Å—Ç—Ä–µ–ª','–ø–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫','—Å—Ç—Ä–∞–π–∫–±–æ–ª',
        '–≥–∞–∑–æ–≤.*–æ—Ä—É–∂','—Ö–æ–ª–æ–¥–Ω.*–æ—Ä—É–∂','–º–µ—Ç–∞—Ç–µ–ª—å–Ω',
        '–ø–µ—Ä—Ü–æ–≤.*–±–∞–ª–ª–æ–Ω—á–∏–∫','–≥–∞–∑–æ–≤.*–±–∞–ª–ª–æ–Ω—á–∏–∫',
        '—à–æ–∫–µ—Ä','—ç–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä','–∏—Å–∫—Ä–æ–≤.*—Ä–∞–∑—Ä—è–¥–Ω–∏–∫',
        '—Ç–∞–∫—Ç–∏—á–µ—Å–∫.*—Ä—É—á–∫','—è–≤–∞—Ä–∞','–∫—É–±–æ—Ç–∞–Ω'
      ]
    },

    dual_use: {
      title: '–¢–æ–≤–∞—Ä—ã –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è',
      words: [
        '–±–ø–ª–∞','–¥—Ä–æ–Ω','–∫–≤–∞–¥—Ä–æ–∫–æ–ø—Ç–µ—Ä',
        'gps.*–ø–æ–¥–∞–≤–∏—Ç–µ–ª','—à–∏—Ñ—Ä–æ–≤–∞–ª—å–Ω.*—É—Å—Ç—Ä–æ–π—Å—Ç–≤',
        '–¥–≤–æ–π–Ω.*–Ω–∞–∑–Ω–∞—á–µ–Ω–∏'
      ]
    },

    documents: {
      title: '–î–æ–∫—É–º–µ–Ω—Ç—ã, —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–µ –ª–∏—á–Ω–æ—Å—Ç—å',
      words: [
        '–ø–∞—Å–ø–æ—Ä—Ç','–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫.*—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏',
        '–≤–æ–µ–Ω–Ω.*–±–∏–ª–µ—Ç','–∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç','–≤–∏–¥ –Ω–∞ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–æ'
      ]
    },

    finance: {
      title: '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
      words: [
        '–±–∞–Ω–∫–Ω–æ—Ç','–Ω–∞–ª–∏—á–Ω','—Ü–µ–Ω–Ω.*–±—É–º–∞–≥',
        '–∞–∫—Ü–∏–∑–Ω.*–º–∞—Ä–∫–∏','–ª–æ—Ç–µ—Ä–µ–π–Ω.*–±–∏–ª–µ—Ç'
      ]
    },

    porn: {
      title: '–ü–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
      words: ['–ø–æ—Ä–Ω–æ','–ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ']
    },

    antiques: {
      title: '–ê–Ω—Ç–∏–∫–≤–∞—Ä–∏–∞—Ç –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ',
      words: ['–∞–Ω—Ç–∏–∫–≤–∞—Ä–∏–∞—Ç','–∏–∫–æ–Ω','–∫–∞—Ä—Ç–∏–Ω']
    },

    precious: {
      title: '–î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã –∏ –∫–∞–º–Ω–∏',
      words: ['–∑–æ–ª–æ—Ç','—Å–µ—Ä–µ–±—Ä','–ø–ª–∞—Ç–∏–Ω','–ø–∞–ª–ª–∞–¥–∏–π','–±—Ä–∏–ª–ª–∏–∞–Ω—Ç','—Å–∞–ø—Ñ–∏—Ä']
    },

    animals: {
      title: '–ñ–∏–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º—ã –∏ —Ç—Ä–æ—Ñ–µ–∏',
      words: ['–∂–∏–≤–æ—Ç–Ω','–∂–∏–≤.*–Ω–∞—Å–µ–∫–æ–º','—à–∫—É—Ä','—Ä–æ–≥','–∫–æ–ø—ã—Ç']
    },

    human_remains: {
      title: '–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞–Ω–∫–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
      words: ['–ø—Ä–∞—Ö','–æ—Ä–≥–∞–Ω','–∫—Ä–æ–≤','—Ç–∫–∞–Ω','–∫–æ—Å—Ç','–≤–æ–ª–æ—Å']
    },

    alcohol: {
      title: '–ê–ª–∫–æ–≥–æ–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è',
      words: ['–∞–ª–∫–æ–≥–æ–ª','–ø–∏–≤','–≤–∏–Ω','–≤–æ–¥–∫','–ª–∏–∫–µ—Ä','–≤–∏—Å–∫','–∫–æ–Ω—å—è–∫']
    },

    tobacco: {
      title: '–¢–∞–±–∞—á–Ω–∞—è –∏ –Ω–∏–∫–æ—Ç–∏–Ω–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è',
      words: [
        '—Å–∏–≥–∞—Ä–µ—Ç','—Å–∏–≥–∞—Ä','—Å—Ç–∏–∫','—Ç–∞–±–∞–∫',
        '–≤–µ–π–ø','—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω.*—Å–∏–≥–∞—Ä–µ—Ç',
        '–∂–∏–¥–∫–æ—Å—Ç.*–Ω–∏–∫–æ—Ç–∏–Ω','–∏—Å–ø–∞—Ä–∏—Ç–µ–ª','–∫–∞—Ä—Ç—Ä–∏–¥–∂'
      ]
    },

    unknown: {
      title: '–ì—Ä—É–∑—ã –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞',
      words: [
        '–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏','–Ω–µ–æ–±–æ–∑–Ω–∞—á–µ–Ω.*–∂–∏–¥–∫–æ—Å—Ç',
        '–±–µ–∑—ã–º—è–Ω.*–ø–æ—Ä–æ—à–æ–∫','–µ–º–∫–æ—Å—Ç.*–±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–∫'
      ]
    }
  };

  /* ================= COMPILE ================= */

  const COMPILED = [];

  for (const key in DENY_CATEGORIES) {
    const cat = DENY_CATEGORIES[key];
    cat.regex = cat.words.map(w =>
      new RegExp(`(^|\\W)${w}(\\W|$)`, 'i')
    );
    COMPILED.push(cat);
  }

  /* ================= CHECK ================= */

  function checkText(text) {
    const value = text.toLowerCase();

    for (const cat of COMPILED) {
      const hits = cat.regex
        .map((re, i) => re.test(value) ? cat.words[i] : null)
        .filter(Boolean);

      if (hits.length) {
        return {
          level: 'deny',
          category: cat.title,
          words: hits
        };
      }
    }
    return { level: 'ok' };
  }

  /* ================= UI ================= */

  const style = document.createElement('style');
  style.textContent = `
    .pvz-deny { border:2px solid red!important }
    .pvz-ok { border:2px solid green!important }
    .pvz-info { margin-top:6px;font-size:13px;font-weight:bold }
  `;
  document.head.appendChild(style);

  const debounce = (fn, ms) => {
    let t;
    return (...a) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...a), ms);
    };
  };

  function attach(field) {
    if (field.dataset.pvzAttached) return;
    field.dataset.pvzAttached = '1';

    const info = document.createElement('div');
    info.className = 'pvz-info';
    field.after(info);

    const handler = debounce(() => {
      field.classList.remove('pvz-deny','pvz-ok');

      if (!field.value.trim()) {
        info.textContent = '';
        return;
      }

      const res = checkText(field.value);

      if (res.level === 'deny') {
        field.classList.add('pvz-deny');
        info.style.color = 'red';
        info.textContent =
          `üî¥ –û–¢–ö–ê–ó–ê–¢–¨ ‚Äî ${res.category} (${res.words.join(', ')})`;
      } else {
        field.classList.add('pvz-ok');
        info.style.color = 'green';
        info.textContent = 'üü¢ –ú–û–ñ–ù–û –ü–†–ò–ù–ò–ú–ê–¢–¨';
      }
    }, CONFIG.debounceMs);

    field.addEventListener('input', handler);
  }

  /* ================= OBSERVER ================= */

  new MutationObserver(() => {
    document
      .querySelectorAll('textarea, input[type="text"][placeholder*="–æ–ø–∏—Å"]')
      .forEach(attach);
  }).observe(document.body, { childList: true, subtree: true });

})();
