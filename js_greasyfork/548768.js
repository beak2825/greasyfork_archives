// ==UserScript==
// @name         ScanEngine 2.1 WEB CN
// @version      1.01
// @description  将ScanEngine 2.1WEB控制台的指定英文文本替换为简体中文。
// @author       ste
// @match        https://192.168.31.76/*
// @grant        none
// @run-at       document-end
// @namespace http://tampermonkey.net/
// @downloadURL https://update.greasyfork.org/scripts/548768/ScanEngine%2021%20WEB%20CN.user.js
// @updateURL https://update.greasyfork.org/scripts/548768/ScanEngine%2021%20WEB%20CN.meta.js
// ==/UserScript==
 
(function() {
    'use strict';
 
    // --- 翻译配置 ---
 
    // 基于文本内容的通用翻译 (用于标题、按钮、标签、卡片内容等)
    const textTranslations = {
        'Sign In': '登录',
        'User name': '用户名',
        'Scan Engine': '扫描引擎',
        'Account': '账户',
        'Profile': '个人资料',
        'Logout': '注销',
        'Additional information': '附加信息',
        'Help': '帮助',
        'User profile': '用户个人资料',
        'User settings': '用户设置',
        'Login': '登录',
        'Full name': '全名',
        'Role': '角色',
        'Use local timezone': '使用本地时区',
        'Off': '关',
        'By default, the date and time are displayed in UTC.': '默认情况下，日期和时间以 UTC 显示。',
        'Change password': '更改密码',
        'Current password': '当前密码',
        'Enter your current password only if you want to change it.': '仅当您想更改密码时才输入当前密码。',
        'New password': '新密码',
        'Confirm new password': '确认新密码',
        'Only Latin letters, digits, and the following special characters are allowed:': '仅允许使用拉丁字母、数字和以下特殊字符:',
        'Up to 16 characters': '最多 16 个字符',
        'At least 6 characters': '至少 6 个字符',
        'Passwords match': '密码匹配',
        'Must contain:': '必须包含:',
        'At least one uppercase Latin letter': '至少一个大写拉丁字母',
        'At least one lowercase Latin letter': '至少一个小写拉丁字母',
        'At least one digit': '至少一个数字',
        'At least one special character (!, #, @, and so on)': '至少一个特殊字符 (!, #, @ 等)',
        'Save': '保存',
        'Cancel': '取消',
        'Dashboard': '仪表板',
        'Scan results': '扫描结果',
        'Settings': '设置',
        'Cluster': '集群',
        'Working': '工作中',
        'Anti-virus database': '反病毒数据库',
        'Critically out of date': '严重过期',
        'Update from scratch': '从头更新',
        'Updating...': '正在更新...',
        'Last update:': '上次更新:',
        'Database version:': '数据库版本:',
        'Hostname:': '主机名:',
        'Up to date': '最新',
        'Kaspersky Security Network': '卡巴斯基安全网络',
        'Connected': '已连接',
        'Last sync:': '上次同步:',
        'License': '授权许可',
        'Application is activated': '应用程序已激活',
        'Expiration date:': '到期日期:',
        'Export': '导出',
        'Refresh': '刷新',
        'Date': '日期',
        'Hostname': '主机名',
        'Initiator': '发起者',
        'Module': '模块',
        'Severity': '严重性',
        'Details': '详情',
        'Scan results': '扫描结果',
        'Total scan status': '总扫描状态',
        'Total': '总计',
        'Malware': '恶意软件',
        'Adware, etc.': '广告软件等',
        'Clean': '干净',
        'Reset statistics': '重置统计信息',
        'Export': '导出',
        'Refresh': '刷新',
        'Client': '客户端',
        'Info': '信息',
        'Scan result': '扫描结果',
        'virware:': '病毒软件:',
        'Action:': '操作:',
        'Scanned with database version:': '扫描时使用的数据库版本:',
        'Service': '服务',
        'Scanning': '扫描',
        'Authorization': '授权',
        'Update': '更新',
        'Logging': '日志记录',
        'Proxy': '代理',
        'Users': '用户',
        'HTTP mode': 'HTTP 模式',
        'Protocol': '协议',
        'HTTPS': 'HTTPS',
        'HTTP': 'HTTP',
        'IP address and port': 'IP 地址和端口',
        'IP address and port used by Kaspersky Scan Engine': 'Kaspersky Scan Engine 使用的 IP 地址和端口',
        'UNIX socket': 'UNIX 套接字',
        'UNIX socket used by Kaspersky Scan Engine': 'Kaspersky Scan Engine 使用的 UNIX 套接字',
        'Keep-alive': '保持活动',
        'Keep-alive connection': '保持活动连接',
        'On': '开',
        'Use Keep-alive unconditionally': '无条件使用 Keep-alive',
        'Off': '关',
        'Use Keep-alive connections even if the client has not explicitly requested it': '即使客户端未明确请求，也使用 Keep-alive 连接',
        'Connection timeout': '连接超时',
        'The amount of time an idle connection has to be kept open': '空闲连接必须保持打开的时间',
        'Maximum requests per connection': '每个连接的最大请求数',
        'The maximum number of requests for one connection before the connection is closed': '在连接关闭前一个连接的最大请求数',
        'Locations where remote scanning is allowed': '允许远程扫描的位置',
        'The HTTP client can send remote requests to scan files that are located on the computer with Kaspersky Scan Engine. Specify the paths to the locations where scanning is allowed or a slash (/) to scan all files.': 'HTTP 客户端可以发送远程请求来扫描位于装有 Kaspersky Scan Engine 的计算机上的文件。指定允许扫描的位置路径或使用斜杠 (/) 扫描所有文件。',
        'Add path': '添加路径',
        'Maximum values': '最大值',
        'Sessions': '会话',
        'Connections': '连接',
        'Threads': '线程',
        'Processes': '进程',
        'Cross-origin resource sharing': '跨源资源共享',
        'List of origins that are allowed to send scan requests to Kaspersky Scan Engine. When specifying a host name, include the protocol. For example https://kaspersky.com.': '允许向 Kaspersky Scan Engine 发送扫描请求的源列表。指定主机名时，请包括协议。例如 https://kaspersky.com。',
        'Add origin': '添加源',
        'Export configuration files': '导出配置文件',
        'Enable reputation checking': '启用信誉检查',
        'Kaspersky Scan Engine includes the Cloud Reputation component that allows you to improve the efficiency of the scanning and monitoring functions by using the cloud technologies provided by Kaspersky Security Network. For more information, refer to the Kaspersky Scan Engine': 'Kaspersky Scan Engine 包含云信誉组件，该组件允许您通过使用卡巴斯基安全网络提供的云技术来提高扫描和监控功能的效率。有关更多信息，请参阅 Kaspersky Scan Engine',
        'Enable Phishing Protection': '启用钓鱼防护',
        'The Phishing Protection component helps prevent fraudulent attempts by an attacker to collect sensitive information and private data of your clients. For more information, refer to the Kaspersky Scan Engine': '钓鱼防护组件有助于防止攻击者通过欺诈手段收集您客户的敏感信息和私密数据。有关更多信息，请参阅 Kaspersky Scan Engine',
        'Object scan timeout': '对象扫描超时',
        'Heuristic analysis level': '启发式分析级别',
        'Disabled': '已禁用',
        'By setting a higher level of heuristic analysis, you improve the quality of scanning, but at the same time increase the load on system resources and the scan time. For more information about heuristics, refer to the': '设置更高级别的启发式分析可以提高扫描质量，但同时也会增加系统资源负载和扫描时间。有关启发式分析的更多信息，请参阅...',
        'Actions on detected objects': '对检测到的对象执行的操作',
        'Disinfect and delete if cannot be disinfected': '清除，如果无法清除则删除',
        'Disinfect and skip if cannot be disinfected': '清除，如果无法清除则跳过',
        'Delete': '删除',
        'Skip': '跳过',
        'Size limit for the received file': '接收文件的体积限制',
        'Maximum size of a file that Kaspersky Scan Engine can scan. For no limit, set to 0.': 'Kaspersky Scan Engine 可以扫描的文件的最大体积。设置为 0 表示无限制。',
        'Maximum depth': '最大深度',
        'Maximum depth of nested archives to be unpacked during scanning': '扫描期间要解包的嵌套压缩包的最大深度',
        'Scan scope': '扫描范围',
        'Types of files to scan': '要扫描的文件类型',
        'Packed objects': '加壳对象',
        'Archives': '压缩包',
        'Email databases': '电子邮件数据库',
        'Emails': '电子邮件',
        'Macros in Microsoft Office documents': 'Microsoft Office 文档中的宏',
        'Exclusions by file formats': '按文件格式排除',
        'File formats to exclude': '要排除的文件格式',
        'Multimedia formats': '多媒体格式',
        'Executable formats': '可执行格式',
        'Office suite formats': '办公套件格式',
        'Database files': '数据库文件',
        'Archive files': '压缩包文件',
        'Text formats': '文本格式',
        'Miscellaneous': '其他',
        'Web archive files': 'Web 压缩包文件',
        'To use API tokens, you need to configure an HTTPS connection. For more information, see the Kaspersky Scan Engine': '要使用 API 令牌，您需要配置 HTTPS 连接。有关更多信息，请参阅 Kaspersky Scan Engine',
        'Authorization for HTTP clients': 'HTTP 客户端授权',
        'Enable authorization for HTTP clients': '为 HTTP 客户端启用授权',
        'Off': '关',
        'Requests must be authorized with an API token.': '请求必须使用 API 令牌进行授权。',
        'Authorization header field': '授权标头字段',
        'Authorization': '授权',
        'Specify the name of the request header field used for authorization.': '指定用于授权的请求标头字段的名称。',
        'Add bearer prefix': '添加 bearer 前缀',
        'Requests must use the Bearer authentication scheme.': '请求必须使用 Bearer 身份验证方案。',
        'API tokens': 'API 令牌',
        'Add token': '添加令牌',
        'Description': '描述',
        'Status': '状态',
        'Automatic updates': '自动更新',
        'Enable automatic updates': '启用自动更新',
        'Enable automatic updates to keep the detection rate high.': '启用自动更新以保持高检测率。',
        'Automatic update period': '自动更新周期',
        'Update sources': '更新源',
        'Update from Kaspersky servers': '从卡巴斯基服务器更新',
        'Custom sources': '自定义源',
        'IP address or host name': 'IP 地址或主机名',
        'Add source': '添加源',
        'Use Kaspersky servers if custom sources are unavailable': '如果自定义源不可用，则使用卡巴斯基服务器',
        'Back up the anti-virus database': '备份反病毒数据库',
        'Application is activated': '应用程序已激活',
        'This host is connected to a cluster. The license key will be applied to the entire cluster.': '此主机已连接到集群。授权许可密钥将应用于整个集群。',
        'Key file': '密钥文件',
        'Expiration date': '到期日期',
        'Choose file': '选择文件',
        'Activation code': '激活码',
        'Use the format xxxxx-xxxxx-xxxxx-xxxxx': '使用格式 xxxxx-xxxxx-xxxxx-xxxxx',
        'Activate': '激活',
        'Logging': '日志记录',
        'You do not need to restart Kaspersky Scan Engine to enable or disable logging': '启用或禁用日志记录无需重启 Kaspersky Scan Engine',
        'Logging in syslog or CEF formats.': '以 syslog 或 CEF 格式记录日志。',
        'Events': '事件',
        'Audit, Init, Deinit, Update, License, Engine, ScanResultClean, ScanResultDetect, ScanResultOther': '审计, 初始化, 取消初始化, 更新, 授权许可, 引擎, 扫描结果干净, 扫描结果检测, 扫描结果其他',
        'Format': '格式',
        'Target': '目标',
        'Syslog daemon': 'Syslog 守护进程',
        'Add': '添加',
        'Log files': '日志文件',
        'Logging in the Kaspersky Scan Engine custom format. Log files help you analyze problems that may arise while the application is running.': '以 Kaspersky Scan Engine 自定义格式记录日志。日志文件可帮助您分析应用程序运行时可能出现的问题。',
        'Log directory': '日志目录',
        'Log size (MB)': '日志大小 (MB)',
        'Export log files': '导出日志文件',
        'Delete logs': '删除日志',
        'We recommend to create backup copies of log files that are larger than 800 MB. The backup copies must be stored on another computer.': '我们建议为大于 800 MB 的日志文件创建备份副本。备份副本必须存储在另一台计算机上。',
        'Use proxy server': '使用代理服务器',
        'Proxy address': '代理地址',
        'Port': '端口',
        'User name (optional)': '用户名 (可选)',
        'Password (optional)': '密码 (可选)',
        'Users': '用户',
        'Add new user': '添加新用户',
        'Local accounts': '本地账户',
        'Login': '登录名',
        'Full name': '全名',
        'Role': '角色',
        'Last login': '上次登录',
        'Use local timezone': '使用本地时区',
        'User': '用户',
        'Administrator': '管理员',
        'Use local timezone': '使用本地时区',
        'Password': '密码',
        'Confirm password': '确认密码',
        'Hosts': '主机',
        'Settings profiles': '设置配置文件',
        'Cluster settings': '集群设置',
        'To add a new host to the cluster, follow the instructions in the': '要将新主机添加到集群，请按照...中的说明操作',
        'Integration mode': '集成模式',
        'Anti-virus database version': '反病毒数据库版本',
        'Settings profile': '设置配置文件',
        'Failed. Kaspersky Scan Engine not running. An error occurred when running Kaspersky Scan Engine.': '失败。Kaspersky Scan Engine 未运行。运行 Kaspersky Scan Engine 时发生错误。',
        'This host is connected to a cluster. The license key will be applied to the entire cluster.': '此主机已连接到集群。授权许可密钥将应用于整个集群。',
        'Profile info': '配置文件信息',
        'Summary': '摘要',
        'Service mode': '服务模式',
        'Use these host settings as base': '使用这些主机设置作为基础',
        'Next': '下一步',
        'General': '常规',
        'Description:': '描述:',
        'Kaspersky ScanEngine default settings for HTTP mode': 'Kaspersky Scan Engine 的 HTTP 模式默认设置',
        'Proxy enabled:': '代理已启用:',
        'Automatic update period (min)': '自动更新周期 (分钟)',
        'Syslog enabled': 'Syslog 已启用',
        'Scan settings': '扫描设置',
        'Actions on detected objects:': '对检测到的对象执行的操作:',
        'Types of files to scan:': '要扫描的文件类型:',
        'Packed objects, Archives, Email databases, Emails, Macros in Microsoft Office documents': '加壳对象, 压缩包, 电子邮件数据库, 电子邮件, Microsoft Office 文档中的宏',
        'Use KSN:': '使用 KSN:',
        'Use anti-phishing:': '使用反钓鱼:',
        'Max scanners:': '最大扫描器数:',
        'Max threads:': '最大线程数:',
        'Object scan timeout (ms):': '对象扫描超时 (毫秒):',
        'Automatic removal of inactive cluster instances': '自动移除不活动的集群实例',
        'Enable automatic removal': '启用自动移除',
        'If a cluster instance is inactive for the specified period of time (inactivity period), Kaspersky Scan Engine removes this instance from the cluster.': '如果集群实例在指定时间段内（非活动期）处于不活动状态，Kaspersky Scan Engine 会将该实例从集群中移除。',
        'Inactivity period': '非活动期',
        'Proxy server settings requested to establish connection to the cloud': '请求代理服务器设置以建立与云的连接',
        'Update succeeded': '更新成功',
        'Started downloading updates': '已开始下载更新',
        'Succeeded. Kaspersky Scan Engine running. System audit enabled.': '成功。Kaspersky Scan Engine 正在运行。系统审计已启用。',
        'Succeeded. Kaspersky Scan Engine was stopped.': '成功。Kaspersky Scan Engine 已停止。',
        'Succeeded. Kaspersky Scan Engine GUI is running.': '成功。Kaspersky Scan Engine GUI 正在运行。',
        'Succeeded. Kaspersky Scan Engine GUI was stopped.': '成功。Kaspersky Scan Engine GUI 已停止。',
        'Restart': '重启'
    };
 
 
    /**
     * 翻译页面上的静态文本内容
     */
    function translatePageContent() {
        // 执行基于文本的通用翻译
        const allTextNodes = document.evaluate(
            "//body//text()[normalize-space() and not(ancestor::script) and not(ancestor::style)]",
            document,
            null,
            XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
            null
        );
 
        for (let i = 0; i < allTextNodes.snapshotLength; i++) {
            const node = allTextNodes.snapshotItem(i);
            const originalText = node.textContent.trim();
            if (textTranslations[originalText] && node.textContent !== textTranslations[originalText]) {
                // 使用 replace 替换，避免影响同一节点内的其他文本
                node.textContent = node.textContent.replace(originalText, textTranslations[originalText]);
            }
        }
    }
 
    // --- 脚本执行逻辑 ---
 
    // 使用 MutationObserver 来监视页面的动态变化
    const observer = new MutationObserver((mutationsList, observer) => {
        // 在每次DOM变化时都尝试运行一次翻译函数
        translatePageContent();
    });
 
    // 配置观察器：监视整个<body>，包括所有子孙元素的变化。
    observer.observe(document.body, {
        childList: true, // 监视子元素的添加或删除
        subtree: true    // 监视所有后代元素
    });
 
    // 在页面初始加载完成后也执行一次翻译
    window.addEventListener('load', translatePageContent);
 
})();