// ==UserScript==
// @name         JFK Ally Block
// @namespace    ally.block
// @version      1.1.8
// @description  Adds a warning to the attack page of our allies (JFK Alliance Only).
// @author       Skeletron [318855] (Original by Heasleys4hemp [1468764])
// @match        https://www.torn.com/loader.php?sid=attack&user2ID=*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=torn.com
// @grant        GM_addStyle
// @license      MIT
// @downloadURL https://update.greasyfork.org/scripts/473059/JFK%20Ally%20Block.user.js
// @updateURL https://update.greasyfork.org/scripts/473059/JFK%20Ally%20Block.meta.js
// ==/UserScript==

// Original by Heasleys4hemp [1468764]: https://greasyfork.org/en/scripts/461547-obn-ally-block

const allyArray = [80339,258814,420120,444118,453122,551603,965606,980326,987206,1018532,1292128,1363448,1423318,1465453,1516889,1594886,1633026,1977339,1993409,2015606,2139321,2141391,2171290,2258479,2310077,2321356,2404393,2412573,2435710,2459564,2483194,2499994,2500619,2557791,2562264,2571968,2606131,2633092,2771102,2771108,2893185,2908952,2910387,2916693,2931056,3004999,3082884,3101390,776,7800,24557,59922,63384,74835,78601,100814,122268,138635,179706,184337,191408,200267,246888,247674,247787,250755,253041,253934,264054,271021,277624,294501,309230,318855,329437,337027,354206,380980,381842,385128,390615,422033,422147,424998,463500,471591,509465,621230,642144,847571,887159,902374,912780,914212,938138,988807,992219,1015444,1042944,1064389,1176287,1333992,1459431,1506600,1518389,1570125,1577993,1609046,1609308,1611194,1615339,1676696,1679929,1690582,1725559,1815519,1846174,1876106,2014817,2087825,2122284,2165616,2220399,2299647,2401309,2402410,2427764,2565380,2745651,2751804,2816884,2948158,790,15457,44394,66590,67769,83808,90007,102841,105083,109192,117976,120351,122369,136084,163772,202687,241277,258329,268095,279474,313482,317444,329461,349008,382815,387969,429478,446477,461514,469324,478606,487848,490463,493795,544071,581715,606779,631929,634051,673647,692571,692719,693575,768116,887289,899431,914520,952429,959750,970144,979994,1028930,1131108,1198956,1260826,1281130,1293957,1310389,1345615,1378809,1385862,1407977,1414266,1445530,1454137,1455047,1465084,1480425,1498456,1640970,1699655,1708715,1722008,1772814,1778428,1813796,1857138,1868280,2005385,2080958,2083878,2241319,2408592,170748,214062,229217,482273,642909,1170253,1199885,1200759,1389080,1419791,1478581,1627710,1700043,1813492,1837767,1844126,1917084,1993415,2040981,2092342,2111792,2112863,2117276,2130818,2145650,2157880,2162214,2176546,2216943,2220265,2220432,2227435,2264379,2264642,2268209,2268293,2271086,2325196,2331960,2455572,2603329,2618561,2704838,2799891,2857469,2857684,250518,280544,671900,869374,895804,1288496,1337649,1470023,1500591,1525056,1552097,1552376,1605151,1842584,1861188,1870268,1879665,1909327,1965284,1991178,2009127,2009486,2014763,2014982,2015290,2015430,2019135,2031824,2053892,2061512,2080174,2095654,2117127,2118937,2145580,2184051,2202393,2246467,2382460,2401162,2427499,2441394,2497536,2500343,2506267,2509619,2513257,2514450,2515185,2518253,2521807,2523240,2524749,2524822,2525918,2526265,2526540,2528283,2534405,2539486,2541376,2610846,2623521,2652477,2670309,2678054,2685460,2689461,2702438,2735845,2736573,2783707,2800884,2835742,2857341,2870989,2876705,2908108,2994092,3050822,3060376,3103584,3146105,12,82966,195548,245796,250739,337378,513794,611076,681273,864898,865545,892012,983774,986337,1008563,1162823,1309151,1732128,1748825,1779805,1865293,1867047,1877910,1885249,1943968,1956982,1958985,2009538,2015029,2037714,2073390,2082997,2141055,2141533,2160486,2256994,2281293,2294904,2321743,2337207,2367854,2372404,2375431,2377651,2394436,2404979,2411200,2413730,2424580,2427917,2428355,2460408,2468536,2475742,2489777,2564862,2565350,2582215,2585629,2586363,2606427,2614499,2625366,2629796,2634457,2649398,2659803,2664462,2682969,2688307,2689859,2690655,2693902,2694507,2706135,2733245,2738557,2755115,2760081,2762484,2765285,2767950,2768268,2770276,2772780,2803088,2818091,2824542,2834572,2838371,2976546,3100624,55115,63690,83384,474281,479655,520414,796969,856025,906770,1144761,1160000,1162761,1184330,1371943,1380405,1398623,1415271,1483522,1507037,1522363,1534164,1554065,1570597,1594661,1605207,1610898,1701946,1774300,1808794,1852316,1855981,1871615,1879353,1939505,1980106,1984387,1991903,2005208,2015912,2016902,2029117,2030763,2040790,2052685,2057218,2071072,2074333,2074521,2081037,2123633,2128052,2160619,2165470,2167520,2180445,2200587,2204723,2223621,2245396,2249291,2253917,2283908,2318975,2337532,2346230,2346872,2390680,2395677,2396932,2437004,2452749,2455894,2471654,2482370,2507441,2516273,2517458,2553909,2554385,2600959,2645149,2645473,2647088,2659227,2662830,2678478,2776748,2791877,4794,20228,22408,42397,46821,307651,315823,379779,559314,561149,666118,674394,744530,920743,1043388,1473577,1478113,1519366,1539090,1569996,1616904,1693300,1723071,1734569,1844487,1891335,1900524,1902445,1954087,1955080,2005010,2032416,2059361,2076260,2077403,2078587,2104559,2110279,2133452,2154505,2167471,2167818,2182722,2200354,2218967,2227533,2240494,2290622,2324833,2354326,2412811,2540399,2543922,2561853,2613589,2627934,2674186,2696278,2706127,2845888,2864580,2932523,2991497,3031624,3045037,3050366,3075067,42304,56106,62912,69248,76495,135825,185567,206592,255858,306659,343267,390687,434780,449632,632053,856568,860380,1019193,1037464,1335603,1352761,1385260,1532551,1585279,1607788,1671532,1675654,1737077,1868553,1869311,1872470,1897325,1900989,1968437,1977333,2000947,2009984,2011382,2027195,2047589,2050939,2087102,2092792,2095845,2102238,2103253,2106526,2129875,2146909,2165187,2167947,2208959,2226777,2235785,2255530,2271267,2271272,2318684,2320158,2324276,2348539,2349717,2364764,2365114,2404580,2489987,2500494,2506438,2511348,2527073,2534256,2561579,2563083,2576071,2584072,2591964,2602492,2603798,2638036,2649618,2683211,2699692,2700428,2724680,2734217,2737218,2742151,2751434,2811275,2811445,2816711,2817210,2837817,2844269,2892568,2893462,2899416,2908990,2956578,2970393,60827,145912,210613,214123,256850,319127,320210,452527,464913,520849,525636,539089,573498,585812,592686,688884,759678,902946,935765,985283,1060365,1133596,1266413,1286893,1290526,1300884,1461009,1505069,1551441,1567187,1568978,1569797,1572263,1580396,1598729,1649413,1690243,1691090,1700033,1701390,1784533,1822922,1836734,1852855,1867864,1886958,1925343,1948134,1971416,1978690,1993355,2009144,2016825,2019938,2038846,2060828,2081928,2083544,2089826,2097454,2102067,2140405,2150607,2155045,2161724,2163874,2166235,2189761,2210003,2228237,2261969,2270765,2290428,2296796,2318096,2350522,2412838,2439280,2500586,2507667,2528530,2528682,2648988,2670497,2686038,2744797,2752691,2876495,2880895,2953590,34013,88497,120274,163981,166801,177889,180202,211088,226831,250698,273777,288536,304168,328231,453063,517092,518466,581165,594063,607550,636513,641520,653876,684633,685083,744625,807411,864830,867628,867659,871862,879721,969080,982521,1151936,1407331,1520872,1574514,1634988,1653406,1690692,1694357,1721375,1758760,1762095,1767859,1830596,1849848,1874738,1891280,1912669,1961735,1972571,1977555,1990607,2003412,2031080,2032117,2038695,2083525,2093719,2102731,2151953,2269743,2291312,2296176,2298663,2309885,2404933,2425950,2488170,2498520,2503297,2505503,2509902,2513891,2524997,2561062,2562325,2602983,2634674,2644602,2644825,2803029,2805525,2808985,12207,26376,52106,56713,69679,174619,255814,328029,340014,341685,474849,478555,510893,662496,899415,936251,966287,1040542,1052701,1163521,1560089,1604292,1604376,1745412,1890780,2069887,2113132,2137041,2165445,2165836,2233406,2242871,2279653,2349542,2356074,2389847,2417896,2462968,2512923,2546988,2561102,2562724,2586998,2631142,2637581,2639289,2639905,2640498,2641809,2646210,2699010,2719787,2738140,2769676,2787076,2810695,2872514,2902401,3010615,3054525,3055076,3075965,3116798,3138788,3138866,3138884,67589,239149,289313,478450,976649,1273015,1383299,1438961,1556532,1569359,1573814,1574941,1594988,1635311,1636763,1677910,1701766,1708601,1733786,1898201,1972608,2042756,2045995,2047719,2058198,2061295,2087028,2111193,2198554,2235898,2337981,2343604,2482659,2515065,2534844,2536045,2558180,2585382,2608460,2664544,2669219,2694539,2714399,2723107,2736891,2740598,2749399,2752435,2765984,2768755,2788048,2823179,2830029,2832281,2833003,2839196,2850901,2853792,2859953,2867000,2867567,2904847,2907778,2921743,2944715,2959959,2984682,3043759,21837,75086,92188,246493,270923,473700,488099,788429,958018,1172347,1179947,1200106,1309544,1384061,1393307,1497925,1498446,1568795,1602475,1672824,1687363,1721513,1740689,1803901,1871862,1898004,1901801,1927463,1961434,1968449,1970406,2008928,2065355,2074368,2111142,2133855,2141517,2161567,2179037,2214403,2287457,2303784,2310266,2311655,2413776,2424213,2449741,2502785,2591522,2592188,2601790,2622031,2674008,2699794,2705576,2729972,2736222,2737797,2752379,2753930,2758602,2800860,2803072,2819574,2824689,2832665,2839460,2852514,2861069,2868218,2902344,2912588,2915605,2918222,2926125,2926968,2930065,2948708,2949695,2969778,2989206,3009188,3073183,3082313,9338,44469,79649,227473,331637,332073,477315,557767,1047419,1204156,1281415,1551430,1707870,1825632,1895784,1935081,1951347,1985528,2014517,2014627,2118337,2147441,2227026,2322465,2328618,2414438,2439383,2442882,2486847,2557728,2574671,2589755,2596940,2640068,2674256,2675624,2676009,2677844,2685392,2685416,2698273,2698493,2721192,2733267,2736720,2744790,2744977,2755406,2772036,2808462,2809355,2868859,2873114,2882858,2889448,2897395,2970644,2985771,2994694,3015926,3067959,16352,235181,283717,385375,954102,1262874,1278175,1491862,1550082,1580868,1978997,2009563,2047548,2068194,2080009,2099336,2106424,2155708,2186154,2216754,2232136,2246640,2318880,2385890,2389838,2452880,2466484,2474725,2517557,2533006,2534899,2630659,2673487,2706089,2763062,2763194,2814836,2818591,2830188,2872279,2880814,2892448,2923002,2941650,2945778,2949115,2971436,2977727,3009844,3009926,3012231,3016164,3023972,3028769,3029798,3034762,3043686,3044072,3052300,3057386,3080807,3094659,3096129,3098005,3110252,3116328,3116624,3116697,3117664,3119520,3129069,3129967,3135204,3135211,608938,860086,1608404,1639937,1702304,1861462,1946051,1973986,2053616,2198442,2282899,2364881,2369867,2434584,2443331,2531225,2619647,2637921,2643065,2665449,2679720,2690367,2702804,2734026,2737015,2738679,2741746,2743967,2747686,2811137,2840742,2844516,2853898,2857726,2868752,2880599,2893108,2910604,2916425,2922097,2933037,3056122,3070439,3122966,3123638,602621,2160475,2288414,2355997,2479572,2501795,2505718,2506152,2549985,2561428,2561900,2635708,2638536,2644019,2733035,2751205,2983016,3003869,3004129,3025269,3028574,645856,681665,1032325,1263991,1857423,1906752,1986658,1995652,2014611,2028618,2162421,2165484,2197248,2203576,2215613,2246480,2268129,2294217,2301323,2311062,2317895,2318661,2322079,2330283,2332501,2336785,2343416,2344864,2345651,2352371,2374932,2383070,2386380,2388372,2392381,2393566,2396736,2402678,2403932,2404027,2408064,2408620,2408894,2411385,2413884,2414430,2416884,2425548,2456607,2479145,2481941,2487448,2498542,2498573,2509803,2524884,2526224,2529143,2534817,2545843,2558363,2563590,2588950,2590588,2590694,2593979,2597214,2602341,2622871,2653431,2667500,2672767,2682020,2682577,2706392,2735181,2747048,2751689,2768754,2792477,2803117,2810800,2811974,2855343,2864910,2872555,2878662,2878672,3046831,3070719,329046,446436,466148,543121,854587,862918,885465,1006354,1207018,1363773,1415505,1417772,1830195,2072386,2122809,2132787,2135754,2216201,2256269,2369726,2493687,2507952,2524156,2552638,2581038,2589078,2678755,2728653,2781617,2790292,2818873,2832298,2847392,2861507,2861545,2862693,2865741,2868789,2869832,2871598,2875994,2883551,2889754,2890287,2893335,3022555,3131610];

GM_addStyle(`
.dialogBox {
    position: relative;
    z-index: 9999999;
    opacity: 1;
    max-width: 90%;
    overflow: hidden;
    width: 235px;
    background: rgba(0,0,0,0) linear-gradient(180deg,rgba(0,0,0,.302),rgba(0,0,0,.102)) 0 0 no-repeat padding-box;
    border: 1px solid #444;
    border-radius: 5px;
    box-shadow: 0 1px 2px #000;
}
.coloredBox {
    background-color: lightgrey;
    opacity: 1;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -webkit-box-align: center;
    -ms-flex-align: center;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    align-items: center;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
    flex-direction: column;
    height: 100%;
    justify-content: center;
    max-height: 400px;
    min-height: 80px;
    padding: 10px;
}
.dark-mode .coloredBox {
    background-color: grey;
}

.dark-mode .coloredBox .titleThing {
    color: #94d82d;
}
.coloredBox .titleThing {
    color: #698c00;
    font-size: 14px;
    font-weight: 700;
    line-height: 20px;
    text-align: center;
    text-transform: uppercase;
}

.dialogButtonDiv {
    text-align: center;
    color: var(--user-status-red-color);
}

[class*="modal_"][class*="defender_"] > [class*="dialog_"] {
    position: absolute;
}

.dialogBox .XButton {
    position: absolute;
    right: 0;
    padding: 5px;
    cursor: pointer;
}
.dialogBox .XButton:hover {
    opacity: 0.6;
}

`);
const theBlockerBox = `
    <div class="dialogBox" id="BlockerBox">
    <span id="xit" class="XButton">âœ•</span>
       <div class="coloredBox">
          <div class="titleThing">This player is an ally</div>
          <div class="dialogButtonDiv">Please do not attack them</div>
       </div>
    </div>
    `;
const numRegex = /\D/g;

var allyObserver = new MutationObserver(function (mutations) {
  const theModel = $(
    '[class*="playerWindow_"] [class*="modal_"][class*="defender_"]'
  );
  if (document.getElementById("BlockerBox")) {
    allyObserver.disconnect();
  } else {
    if (theModel.length) {
      allyObserver.disconnect();
      theModel.prepend(theBlockerBox);
      $("#xit").click(function () {
        $("#BlockerBox").remove();
      });
    }
  }
});

(function () {
  "use strict";
  if (location && location.href) {
    const userid = parseInt(
      location.href.split("=").pop().replace(numRegex, "")
    );
    if (userid && allyArray.includes(userid)) {
      allyObserver.observe(document, {
        attributes: false,
        childList: true,
        characterData: false,
        subtree: true,
      });
    }
  }
})();
