// ==UserScript==
// @name         Symfony 翻译文档 controller/upload_file.html
// @namespace    fireloong
// @version      0.1.3
// @description  翻译文档 controller/upload_file.html
// @author       Itsky71
// @match        https://symfony.com/doc/5.x/controller/upload_file.html
// @match        https://symfony.com/doc/6.4/controller/upload_file.html
// @match        https://symfony.com/doc/7.1/controller/upload_file.html
// @match        https://symfony.com/doc/7.2/controller/upload_file.html
// @match        https://symfony.com/doc/current/controller/upload_file.html
// @icon         https://www.google.com/s2/favicons?sz=64&domain=symfony.com
// @require      https://unpkg.com/jquery@3.7.1/dist/jquery.min.js
// @require      https://update.greasyfork.org/scripts/503008/fanyi.js
// @grant        none
// @license      MIT
// @downloadURL https://update.greasyfork.org/scripts/500825/Symfony%20%E7%BF%BB%E8%AF%91%E6%96%87%E6%A1%A3%20controllerupload_filehtml.user.js
// @updateURL https://update.greasyfork.org/scripts/500825/Symfony%20%E7%BF%BB%E8%AF%91%E6%96%87%E6%A1%A3%20controllerupload_filehtml.meta.js
// ==/UserScript==

(function($) {
    'use strict';

    const translates = {
        '\n        \n                    How to Upload Files\n        \n            ': '如何上传文件',
        "Instead of handling file uploading yourself, you may consider using the\nVichUploaderBundle community bundle. This bundle provides all the common\noperations (such as file renaming, saving and deleting) and it's tightly\nintegrated with Doctrine ORM, MongoDB ODM, PHPCR ODM and Propel.": '与其自己处理文件上传，您可以考虑使用 <a href="https://github.com/dustin10/VichUploaderBundle" class="reference external" rel="external noopener noreferrer" target="_blank">VichUploaderBundle</a> 社区包。这个包提供了所有常见的操作（如文件重命名、保存和删除），并且它与 Doctrine ORM、MongoDB ODM、PHPCR ODM 和 Propel 紧密集成。',
        'Imagine that you have a Product entity in your application and you want to\nadd a PDF brochure for each product. To do so, add a new property called\nbrochureFilename in the Product entity:': '假设你的应用程序中有一个 <code translate="no" class="notranslate">Product</code> 实体，并且你想为每个产品添加一个 PDF 手册。为此，请在 <code translate="no" class="notranslate">Product</code> 实体中添加一个新属性，名为 <code translate="no" class="notranslate">brochureFilename</code>：',
        'Note that the type of the brochureFilename column is string instead of\nbinary or blob because it only stores the PDF file name instead of the\nfile contents.': '请注意，<code translate="no" class="notranslate">brochureFilename</code> 列的类型是 <code translate="no" class="notranslate">string</code> 而不是 <code translate="no" class="notranslate">binary</code> 或 <code translate="no" class="notranslate">blob</code>，因为它只存储 PDF 文件名而不是文件内容。',
        'The next step is to add a new field to the form that manages the Product\nentity. This must be a FileType field so the browsers can display the file\nupload widget. The trick to make it work is to add the form field as "unmapped",\nso Symfony doesn\'t try to get/set its value from the related entity:': '下一步是向管理 <code translate="no" class="notranslate">Product</code> 实体的表单中添加一个新字段。这必须是一个<code translate="no" class="notranslate">FileType</code> 字段，以便浏览器可以显示文件上传小部件。要使它工作，诀窍是将表单字段添加为“unmapped”，这样 Symfony 就不会尝试从相关实体中获取/设置其值：',
        'Now, update the template that renders the form to display the new brochure\nfield (the exact template code to add depends on the method used by your application\nto customize form rendering):': '现在，更新渲染表单的模板以显示新的  <code translate="no" class="notranslate">brochure</code> 字段（要添加的确切模板代码取决于您的应用程序用于<a href="../form/form_customization.html" class="reference internal">自定义表单渲染</a>的方法）：',
        'Finally, you need to update the code of the controller that handles the form:': '最后，您需要更新处理表单的控制器代码：',
        'Now, create the brochures_directory parameter that was used in the\ncontroller to specify the directory in which the brochures should be stored:': '现在，创建在控制器中使用的 <code translate="no" class="notranslate">brochures_directory</code> 参数，以指定手册应存储的目录：',
        'There are some important things to consider in the code of the above controller:': '在上面的控制器代码中，有一些重要的事情需要考虑：',
        'In Symfony applications, uploaded files are objects of the\nUploadedFile class. This class\nprovides methods for the most common operations when dealing with uploaded files;': '在 Symfony 应用程序中，上传的文件是 <a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/UploadedFile.php" class="reference external" title="Symfony\Component\HttpFoundation\File\UploadedFile" rel="external noopener noreferrer" target="_blank">UploadedFile</a> 类的对象。这个类提供了处理上传文件时最常用的方法；',
        "A well-known security best practice is to never trust the input provided by\nusers. This also applies to the files uploaded by your visitors. The UploadedFile\nclass provides methods to get the original file extension\n(getClientOriginalExtension()),\nthe original file size (getSize())\nand the original file name (getClientOriginalName()).\nHowever, they are considered not safe because a malicious user could tamper\nthat information. That's why it's always better to generate a unique name and\nuse the guessExtension()\nmethod to let Symfony guess the right extension according to the file MIME type;": '一个广为人知的最佳安全实践是永远不要信任用户提供的输入。这也适用于你的访问者上传的文件。<code translate="no" class="notranslate">UploadedFile</code> 类提供了方法来获取原始文件扩展名（<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/UploadedFile.php#:~:text=function%20getClientOriginalExtension" class="reference external" title="Symfony\Component\HttpFoundation\File\UploadedFile::getClientOriginalExtension()" rel="external noopener noreferrer" target="_blank">getClientOriginalExtension()</a>）、原始文件大小（<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/UploadedFile.php#:~:text=function%20getSize" class="reference external" title="Symfony\Component\HttpFoundation\File\UploadedFile::getSize()" rel="external noopener noreferrer" target="_blank">getSize()</a>）和原始文件名（<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/UploadedFile.php#:~:text=function%20getClientOriginalName" class="reference external" title="Symfony\Component\HttpFoundation\File\UploadedFile::getClientOriginalName()" rel="external noopener noreferrer" target="_blank">getClientOriginalName()</a>）。然而，这些都被认为是不安全的，因为恶意用户可能会篡改这些信息。这就是为什么最好始终生成一个唯一的名称，并使用 <a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/UploadedFile.php#:~:text=function%20guessExtension" class="reference external" title="Symfony\Component\HttpFoundation\File\UploadedFile::guessExtension()" rel="external noopener noreferrer" target="_blank">guessExtension()</a> 方法让 Symfony 根据文件的 MIME 类型猜测正确的扩展名；',
        'You can use the following code to link to the PDF brochure of a product:': '你可以使用以下代码来链接到一个产品的 PDF 手册：',
        'When creating a form to edit an already persisted item, the file form type\nstill expects a File\ninstance. As the persisted entity now contains only the relative file path,\nyou first have to concatenate the configured upload path with the stored\nfilename and create a new File class:': '当创建一个表单来编辑已经持久化的项目时，文件表单类型仍然期望得到一个 <a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/File.php" class="reference external" title="Symfony\Component\HttpFoundation\File\File" rel="external noopener noreferrer" target="_blank">File</a> 实例。由于持久化的实体现在只包含相对文件路径，你首先需要将配置的上传路径与存储的文件名连接起来，并创建一个新的 <code translate="no" class="notranslate">File</code> 类：',
        'Creating an Uploader Service': '创建一个上传服务',
        'To avoid logic in controllers, making them big, you can extract the upload\nlogic to a separate service:': '为了避免控制器中的逻辑过多、使它们变得庞大，您可以将上传逻辑提取到一个单独的服务中：',
        'In addition to the generic FileException\nclass there are other exception classes to handle failed file uploads:\nCannotWriteFileException,\nExtensionFileException,\nFormSizeFileException,\nIniSizeFileException,\nNoFileException,\nNoTmpDirFileException,\nand PartialFileException.': '除了通用的 <a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/FileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\FileException" rel="external noopener noreferrer" target="_blank">FileException</a> 类之外，还有其它异常类来处理文件上传失败的情况：<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/CannotWriteFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\CannotWriteFileException" rel="external noopener noreferrer" target="_blank">CannotWriteFileException</a>、<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/ExtensionFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\ExtensionFileException" rel="external noopener noreferrer" target="_blank">ExtensionFileException</a>、<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/FormSizeFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\FormSizeFileException" rel="external noopener noreferrer" target="_blank">FormSizeFileException</a>、<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/IniSizeFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\IniSizeFileException" rel="external noopener noreferrer" target="_blank">IniSizeFileException</a>、<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/NoFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\NoFileException" rel="external noopener noreferrer" target="_blank">NoFileException</a>、<a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/NoTmpDirFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\NoTmpDirFileException" rel="external noopener noreferrer" target="_blank">NoTmpDirFileException</a> 和 <a href="https://github.com/symfony/symfony/blob/'+doc_version+'/src/Symfony/Component/HttpFoundation/File/Exception/PartialFileException.php" class="reference external" title="Symfony\Component\HttpFoundation\File\Exception\PartialFileException" rel="external noopener noreferrer" target="_blank">PartialFileException</a>。',
        'Then, define a service for this class:': '然后，为这个类定义一个服务：',
        "Now you're ready to use this service in the controller:": '现在您可以在控制器中使用这个服务了：',
        'Using a Doctrine Listener': '使用 Doctrine 监听器',
        "The previous versions of this article explained how to handle file uploads using\nDoctrine listeners. However, this is no longer\nrecommended, because Doctrine events shouldn't be used for your domain logic.": '本文的早期版本解释了如何使用 <a href="../doctrine/events.html#doctrine-lifecycle-listener" class="reference internal">Doctrine 监听器</a>来处理文件上传。然而，这不再被推荐，因为不应使用 Doctrine 事件来处理域逻辑。',
        'Moreover, Doctrine listeners are often dependent on internal Doctrine behavior\nwhich may change in future versions. Also, they can introduce performance issues\nunwillingly (because your listener persists entities which cause other entities to\nbe changed and persisted).': '此外，Doctrine 监听器通常依赖于 Doctrine 的内部行为，这些行为在未来的版本中可能会发生变化。而且，它们还可能会无意中引入性能问题（因为您的监听器持久化了实体，从而导致其它实体被更改和持久化）。',
        'As an alternative, you can use Symfony events, listeners and subscribers.': '作为替代方案，您可以使用 <a href="../event_dispatcher.html" class="reference internal">Symfony 事件、监听器和订阅者</a>。',
    };

    fanyi(translates, 1);
})($);
