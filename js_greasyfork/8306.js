// ==UserScript==
// @name           Sale-envd
// @namespace      http://virtonomic*.*/*/main/unit/view/*/sale
// @description    Установка цены на производстве по ставке ЕНВД
// @include        http*://virtonomic*.*/*/main/unit/view/*/sale
// @version        0.254
// @downloadURL https://update.greasyfork.org/scripts/8306/Sale-envd.user.js
// @updateURL https://update.greasyfork.org/scripts/8306/Sale-envd.meta.js
// ==/UserScript==
var win = (typeof (unsafeWindow) != 'undefined' ? unsafeWindow : top.window);
$ = win.$;
//В складе нам это не нужно
if (!(/(?:Склад)/.test($('div[class*="officePlace"]').prop('textContent')))) {
  //arr_envd - массив ставок ЕНВД, при изменении сохранять в Unicode
  var arr_envd = {
    'Алмазы': 100,
    'Марганец': 100,
    'Медный колчедан': 100,
    'Хром': 100,
    'Бокситы': 100,
    'Глина': 100,
    'Древесина': 30,
    'Железная руда': 100,
    'Золото': 100,
    'Кремний': 100,
    'Нефть': 100,
    'Природные минералы': 100,
    'Уголь': 100,
    'Углепластик' : 10,
    'Автозапчасти': 20,
    'Зеркальный лист': 20,
    'Косметическое масло':20,
    'Картон': 5,
    'Корпус яхты': 15,
    'Косметические компоненты': 20,
    'LED': 20,
    'Авионика': 10,
    'Интерьер самолета': 10,
    'Элементы авиакрыла': 10,
    'Авиадвигатель': 10,
    'Секция фюзеляжа': 10,
    'Элементы авиаоперения': 10,
    'Авиашасси': 10,
    'Медь': 20,
    'Натуральные лекарственные компоненты': 20,
    'Парфюмерная эссенция': 20,
    'Оснащение яхты': 15,
    'Отходы хлопчатника': 10,
    'Рыболовная сеть': 10,
    'Сверхлёгкий алюминиевый сплав': 20,
    'Синтетические лекарственные компоненты': 20,
    'Термоэлемент': 15,
    'Упаковка': 5,
    'Хлопковая ткань': 20,
    'Хлопковое волокно': 10,
    'Электропривод': 15,
    'Алюминий': 20,
    'Бумага': 5,
    'Двигатель': 15,
    'Кожа': 5,
    'Комплектующие': 20,
    'Краска': 5,
    'Чистящие средства': 20,
    'Пластмасса': 10,
    'Резина': 10,
    'Синтетическая ткань': 5,
    'Сталь': 10,
    'Стекло': 20,
    'Ткань': 20,
    'Одеяло': 20,
    'Полотенце': 20,
    'Ковер': 20,
    'Химикаты': 20,
    'Шерсть': 20,
    'Электронные компоненты': 20,
    'Картофель': 10,
    'Комбикорм': 10,
    'Кормовые культуры': 10,
    'Подсолнечник': 15,
    'Помидоры': 5,
    'Рыбная мука': 10,
    'Цветы и эфиромасличные культуры': 5,
    'Зерно': 10,
    'Какао': 10,
    'Молоко': 15,
    'Мясо': 20,
    'Сахар': 10,
    'Фрукты': 5,
    'Чайный лист': 5,
    'Оливки': 10,
    'Кофе' : 10,
    'Натуральный кофе': 20,
    'Растворимый кофе': 5,
    'Хлопок': 10,
    'Яйца': 15,
    'Бурбон': 10,
    'Джем': 10,
    'Зеленый чай': 10,
    'Красная икра': 20,
    'Масло': 10,
    'Продукты быстрого приготовления': 5,
    'Рыбные деликатесы': 20,
    'Рыбные консервы': 15,
    'Соусы': 5,
    'Сыр': 10,
    'Черная икра': 50,
    'Чипсы': 5,
    'Колбасные изделия': 15,
    'Кондитерские изделия': 15,
    'Макаронные изделия': 5,
    'Молочные продукты': 10,
    'Мороженое': 15,
    'Мука': 10,
    'Пиво': 10,
    'Прохладительные напитки': 10,
    'Пуэр': 50,
    'Сок': 10,
    'Спиртные напитки': 10,
    'Хлеб': 10,
    'Шоколад': 10,
    'Конфеты': 10,
    'Консервы': 15,
    'Бронзовый декор': 30,
    'Верхняя одежда': 20,
    'Деловая одежда': 20,
    'Газонокосилка':20,
    'Внедорожник': 100,
    'Зеркало': 20,
    'Зонт': 20,
    'Кожгалантерея': 20,
    'Кондиционер': 50,
    'Косметика': 15,
    'Кухонная мебель': 20,
    'Кухонные плиты': 50,
    'Мебель': 20,
    'Моторное масло': 20,
    'Садовый декор': 20,
    'Светодиодная лампа': 15,
    'Нижнее белье': 20,
    'Парфюмерия': 20,
    'Подарки и Сувениры': 20,
    'Постельное белье': 20,
    'Посудомоечные машины': 50,
    'Садовый инвентарь': 20,
    'Пылесос': 50,
    'Седан': 100,
    'Спорт-кар': 100,
    'Сумки и портфели': 20,
    'Тренажер': 5,
    'Утюг': 20,
    'Фен': 20,
    'Электроинструмент': 20,
    'Автомобиль': 100,
    'Холодильники': 50,
    'Чайник': 20,
    'Бытовая химия': 20,
    'Аудиотехника': 50,
    'Велосипед': 20,
    'Игрушки': 20,
    'Компьютер': 30,
    'Спальная мебель': 20,
    'Мобильный телефон': 20,
    'Мотоцикл': 30,
    'Обувь': 20,
    'Одежда': 20,
    'Посуда': 20,
    'Пресса': 15,
    'Фототехника': 20,
    'Часы': 30,
    'Шины': 20,
    'Автомобильные диски': 20,
    'Бижутерия': 20,
    'Бриллианты': 30,
    'Ювелирные украшения': 50,
    'GPS-навигаторы': 20,
    'Канцтовары': 20,
    'Стиральные машины': 50,
    'LED-телевизоры': 50,
    'Телевизоры': 50,
    'Сантехника': 20,
    'Автомобильные багажники': 20,
    'Кузовные запчасти': 20,
    'Светильники': 20,
    'Душевые кабинки': 5,
    'Книги': 15,
    'Гормональные препараты': 10,
    'Лекарственные травы': 20,
    'Никотиновый пластырь': 15,
    'Спортивное питание': 10,
    'Медицинский антисептик': 10,
    'Электронный тонометр': 20,
    'Медицинский инструментарий': 20,
    'Природные лекарства': 20,
    'Синтетические лекарства': 10,
    'Средства гигиены': 20,
    'Горно-шахтное оборудование': 30,
    'Медицинское оборудование': 30,
    'Мазутный энергоблок': 30,
    'Мусоросжигательный энергоблок': 30,
    'Угольный энергоблок': 30,
    'Паровой котел': 30,
    'Система очисти дымовых газов': 30,
    'Узкофюзеляжный самолет': 10,
    'Мусороприёмное оборудование': 30,
    'Паровая турбина': 30,
    'Теплообменно оборудование': 30,
    'Угольная мельница': 30,
    'Парикмахерское оборудование': 30,
    'Пилорама': 30,
    'Ресторанное оборудование': 30,
    'Рыболовецкий траулер': 30,
    'Прибор': 30,
    'Станок': 30,
    'Трактор': 30,
    'Крабы': 20,
    'Лосось': 20,
    'Осетр': 10,
    'Промысловая рыба': 20,
    'Устрицы': 20,
    'Жемчуг': 100,
    'Домашняя птица': 20,
    'Коровы': 20,
    'Овцы': 20,
    'Свиньи': 20,
    'Арт декор': 30,
    'Интерьер яхты': 100,
    'Яхта': 100,
    'Жемчужные украшения': 50,
    'Заварочный чайник': 20,
    'Энергетические напитки': 10,
    'Бейсболка': 20,
    'Джинсы': 20,
    'Консервированный корм для животных': 15,
    'Сигареты': 20,
    'Сигары': 10,
    'Смартфон': 20,
    'Сухой корм для животных': 15,
    'Сыр фета': 10,
    'Фруктовый чай': 10,
    'Черный чай': 10,
    'Кофе-машина': 50,
    'Спортинвентарь': 20,
    'Носки': 10,
    'Табак': 5,
    'Столовое и постельное бельё': 20,
    'Консервированные оливки':15,
    'Оливковое масло':20,
    'Консервированная кукуруза': 15,
    'Кукуруза': 5,
    'Кукурузная мука': 10,
    'Специи': 5,
    'Этанол': 20,
    'Антифриз': 20,
    'Омыватель стекол': 20,
    'Сомбреро': 20,
    'Пончо': 20,
    'Кукурузные хлопья': 5,
    'Авторемонтное оборудование': 30,
    'Бензин Нормаль-80': 100,
    'Бензин Регуляр-92': 100,
    'Бензин Премиум-95': 100,
    'Мазут': 100,
    'Дизельное топливо': 100,
    'Автозаправочное оборудование': 30,
    'Топливное оборудование': 30,
    'Топливораздаточная колонка': 30
  };
  $('table.grid>tbody>tr:gt(0)').each(function () {
    var altt = $('td[title*="маркетинг"]>a>img', this).attr('alt');
    var sbst = ($('td.nowrap td:contains("Себестоимость")', this).next().prop('textContent').slice(0,1)=='$'?$('td.nowrap td:contains("Себестоимость")', this).next().prop('textContent'):$('td[align*="right"] td:contains("Себестоимость")', this).next().prop('textContent')).replace(/[^\d\.]/g, '');
    var btn = $('<td><button id="btn1"></button></td>');
    btn.insertBefore($('input.money[name*="[price]"]', this));
    $('button#btn1', this).prop('textContent', 'ЕНВД ' + arr_envd[altt]).click(function () {
      $(btn).next().attr('value', (sbst * (1 + arr_envd[altt] / 100)).toFixed(2));
      return false;
    })
  })
}
