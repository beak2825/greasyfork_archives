// ==UserScript==
// @name                WME Ottawa Error Sheets Overlay
// @namespace           
// @description         Creates polygons for Ottawa area error sheets in a WME ""Ottawa Error Sheets" layer
// @include             https://www.waze.com/editor/*
// @include             https://www.waze.com/*/editor/*
// @include             https://editor-beta.waze.com/*
// @version             1.4
// @grant               none
// @copyright           2014 davielde
// @downloadURL https://update.greasyfork.org/scripts/7767/WME%20Ottawa%20Error%20Sheets%20Overlay.user.js
// @updateURL https://update.greasyfork.org/scripts/7767/WME%20Ottawa%20Error%20Sheets%20Overlay.meta.js
// ==/UserScript==


//---------------------------------------------------------------------------------------


//generated by kkarkid



function bootstrap_MapRaidOverlay()
{
  var bGreasemonkeyServiceDefined = false;

  try {
    bGreasemonkeyServiceDefined = (typeof Components.interfaces.gmIGreasemonkeyService === "object");
  }
  catch (err) { /* Ignore */ }

  if (typeof unsafeWindow === "undefined" || ! bGreasemonkeyServiceDefined) {
    unsafeWindow    = ( function () {
      var dummyElem = document.createElement('p');
      dummyElem.setAttribute('onclick', 'return window;');
      return dummyElem.onclick();
    }) ();
  }

    /* begin running the code! */
    setTimeout(InitMapRaidOverlay, 1000);
}

function AddRaidPolygon(raidLayer,groupPoints,groupColor,groupNumber){
    
    var mro_Map = unsafeWindow.Waze.map;
    var mro_OL = unsafeWindow.OpenLayers;
    var raidGroupLabel = 'Sheet ' + groupNumber;
    var groupName = 'Sheet' + groupNumber;
    
    var style = {
        strokeColor: "black",
        strokeOpacity: .8,
        strokeWidth: 10,
        fillColor: groupColor,
        fillOpacity: 0,
        label: raidGroupLabel,
        labelOutlineColor: "black",
        labelOutlineWidth: 0,
        fontSize: 200,
        fontColor: "black",
        fontOpacity: .85,
        fontWeight: "bold"  
    };
    
    var attributes = {
        name: groupName,
        number: groupNumber
    };
    
    var pnt= [];
    for(i=0;i<groupPoints.length;i++){
        convPoint = new OpenLayers.Geometry.Point(groupPoints[i].lon,groupPoints[i].lat).transform(new OpenLayers.Projection("EPSG:4326"), mro_Map.getProjectionObject());
        //console.log('MapRaid: ' + JSON.stringify(groupPoints[i]) + ', ' + groupPoints[i].lon + ', ' + groupPoints[i].lat);
        pnt.push(convPoint);
    }
		       
    var ring = new mro_OL.Geometry.LinearRing(pnt);
    var polygon = new mro_OL.Geometry.Polygon([ring]);
    
    var feature = new mro_OL.Feature.Vector(polygon,attributes,style);
    raidLayer.addFeatures([feature]);

}

//function CurrentRaidLocation(raid_mapLayer){
//    var mro_Map = unsafeWindow.Waze.map;
//
//    for(i=0;i<raid_mapLayer.features.length;i++){
//        var raidMapCenter = mro_Map.getCenter();
//        var raidCenterPoint = new OpenLayers.Geometry.Point(raidMapCenter.lon,raidMapCenter.lat);
//        var raidCenterCheck = raid_mapLayer.features[i].geometry.components[0].containsPoint(raidCenterPoint);
//        //console.log('MapRaid: ' + raid_mapLayer.features[i].attributes.number + ': ' + raidCenterCheck);
//        if(raidCenterCheck === true){
//        	var raidLocationLabel = 'Sheet ' + raid_mapLayer.features[i].attributes.number + ' - ' + $('.WazeControlLocationInfo').text();
//    		setTimeout(function(){$('.WazeControlLocationInfo').text(raidLocationLabel)},200);
//        }
//    }
//}

function InitMapRaidOverlay(){

    var mro_Map = unsafeWindow.Waze.map;
    var mro_OL = unsafeWindow.OpenLayers;

    //if (!mro_Map) return;
	
    //if (!mro_OL) return;

    var mro_mapLayers = mro_Map.getLayersBy("uniqueName","__OttawaErrorSheets");
        
    var raid_mapLayer = new mro_OL.Layer.Vector("Ottawa Error Sheets", {
        displayInLayerSwitcher: true,
        uniqueName: "__OttawaErrorSheets"
    });
        
    I18n.translations.en.layers.name["__OttawaErrorSheets"] = "Ottawa Error Sheets";
    mro_Map.addLayer(raid_mapLayer);
    raid_mapLayer.setVisibility(true);
    
   
var VGroup1 = [{lon:'-75.12460195255107',lat:'45.23296051195537'},{lon:'-75.51032705582037',lat:'45.283492371701485'},{lon:'-75.65760073420776',lat:'44.99703077630977'},{lon:'-75.27544780955287',lat:'44.94749575320313'},{lon:'-75.12460195255107',lat:'45.23296051195537'}];
AddRaidPolygon(raid_mapLayer, VGroup1,"#009D57","1");

var VGroup2 = [{lon:'-75.89511146166747',lat:'45.33252016169173'},{lon:'-76.27890377749145',lat:'45.38005234856801'},{lon:'-76.418981853709',lat:'45.09167872586083'},{lon:'-76.03879544128505',lat:'45.04508892800799'},{lon:'-75.89511146166747',lat:'45.33252016169173'}];
AddRaidPolygon(raid_mapLayer, VGroup2,"#A61B4A","2");

var VGroup3 = [{lon:'-75.51032705582037',lat:'45.283492371701485'},{lon:'-75.89511146166747',lat:'45.33252016169173'},{lon:'-76.03879544128505',lat:'45.04508892800799'},{lon:'-75.65760073420776',lat:'44.99703077630977'},{lon:'-75.51032705582037',lat:'45.283492371701485'}];
AddRaidPolygon(raid_mapLayer, VGroup3,"#F4B400","3");

var VGroup4 = [{lon:'-75.05396501641185',lat:'46.15192903281946'},{lon:'-75.44981029623132',lat:'46.20398691805603'},{lon:'-75.60067174717571',lat:'45.91198477616756'},{lon:'-75.20856275147433',lat:'45.860957508896995'},{lon:'-75.05396501641185',lat:'46.15192903281946'}];
AddRaidPolygon(raid_mapLayer, VGroup4,"#3F5BA9","4");

var VGroup5 = [{lon:'-76.27890377749145',lat:'45.38005234856801'},{lon:'-76.66165309407852',lat:'45.42609796571374'},{lon:'-76.79811038073338',lat:'45.13680923535665'},{lon:'-76.418981853709',lat:'45.09167872586083'},{lon:'-76.27890377749145',lat:'45.38005234856801'}];
AddRaidPolygon(raid_mapLayer, VGroup5,"#795046","5");

var VGroup6 = [{lon:'-75.65760073420776',lat:'44.99703077630977'},{lon:'-76.03879544128505',lat:'45.04508892800799'},{lon:'-76.18019027607816',lat:'44.75921114966883'},{lon:'-75.80253779339495',lat:'44.71210307827216'},{lon:'-75.65760073420776',lat:'44.99703077630977'}];
AddRaidPolygon(raid_mapLayer, VGroup6,"#62AF44","6");

var VGroup7 = [{lon:'-75.27544780955287',lat:'44.94749575320313'},{lon:'-75.65760073420776',lat:'44.99703077630977'},{lon:'-75.80253779339495',lat:'44.71210307827216'},{lon:'-75.42391059505988',lat:'44.66354488062658'},{lon:'-75.27544780955287',lat:'44.94749575320313'}];
AddRaidPolygon(raid_mapLayer, VGroup7,"#A61B4A","7");

var VGroup8 = [{lon:'-76.03879544128505',lat:'45.04508892800799'},{lon:'-76.418981853709',lat:'45.09167872586083'},{lon:'-76.55681924562518',lat:'44.80487765458101'},{lon:'-76.18019027607816',lat:'44.75921114966883'},{lon:'-76.03879544128505',lat:'45.04508892800799'}];
AddRaidPolygon(raid_mapLayer, VGroup8,"#7C3592","8");

var VGroup9 = [{lon:'-74.58110766422296',lat:'45.46683542194151'},{lon:'-74.971320959377',lat:'45.519924048624375'},{lon:'-75.12460195255107',lat:'45.23296051195537'},{lon:'-74.7379879960829',lat:'45.18091669400136'},{lon:'-74.58110766422296',lat:'45.46683542194151'}];
AddRaidPolygon(raid_mapLayer, VGroup9,"#F8971B","9");

var VGroup10 = [{lon:'-75.99182420804915',lat:'45.9614605364062'},{lon:'-76.38196647357061',lat:'46.00939373244752'},{lon:'-76.52295532460577',lat:'45.716964274924386'},{lon:'-76.13653502553329',lat:'45.66998455433452'},{lon:'-75.99182420804915',lat:'45.9614605364062'}];
AddRaidPolygon(raid_mapLayer, VGroup10,"#0BA9CC","10");

var VGroup11 = [{lon:'-74.89238720051853',lat:'44.89647590036436'},{lon:'-75.27544780955287',lat:'44.94749575320313'},{lon:'-75.42391059505988',lat:'44.66354488062658'},{lon:'-75.04435793825074',lat:'44.61352853782813'},{lon:'-74.89238720051853',lat:'44.89647590036436'}];
AddRaidPolygon(raid_mapLayer, VGroup11,"#B29189","11");

var VGroup12 = [{lon:'-74.971320959377',lat:'45.519924048624375'},{lon:'-75.36066533769299',lat:'45.57147314077262'},{lon:'-75.51032705582037',lat:'45.283492371701485'},{lon:'-75.12460195255107',lat:'45.23296051195537'},{lon:'-74.971320959377',lat:'45.519924048624375'}];
AddRaidPolygon(raid_mapLayer, VGroup12,"#009D57","12");
    
var VGroup13 = [{lon:'-76.13653502553329',lat:'45.66998455433452'},{lon:'-76.52295532460577',lat:'45.716964274924386'},{lon:'-76.66165309407852',lat:'45.42609796571374'},{lon:'-76.27890377749145',lat:'45.38005234856801'},{lon:'-76.13653502553329',lat:'45.66998455433452'}];
AddRaidPolygon(raid_mapLayer, VGroup13,"#A61B4A","13");
    
var VGroup14 = [{lon:'-74.81555135609445',lat:'45.80837039793239'},{lon:'-75.20856275147433',lat:'45.860957508896995'},{lon:'-75.36066533769299',lat:'45.57147314077262'},{lon:'-74.971320959377',lat:'45.519924048624375'},{lon:'-74.81555135609445',lat:'45.80837039793239'}];
AddRaidPolygon(raid_mapLayer, VGroup14,"#F4B400","14");
    
var VGroup15 = [{lon:'-75.74908760807244',lat:'45.621490507171984'},{lon:'-76.13653502553329',lat:'45.66998455433452'},{lon:'-76.27890377749145',lat:'45.38005234856801'},{lon:'-75.89511146166747',lat:'45.33252016169173'},{lon:'-75.74908760807244',lat:'45.621490507171984'}];
AddRaidPolygon(raid_mapLayer, VGroup15,"#3F5BA9","15");
    
var VGroup16 = [{lon:'-75.20856275147433',lat:'45.860957508896995'},{lon:'-75.60067174717571',lat:'45.91198477616756'},{lon:'-75.74908760807244',lat:'45.621490507171984'},{lon:'-75.36066533769299',lat:'45.57147314077262'},{lon:'-75.20856275147433',lat:'45.860957508896995'}];
AddRaidPolygon(raid_mapLayer, VGroup16,"#795046","16");

var VGroup17 = [{lon:'-75.60067174717571',lat:'45.91198477616756'},{lon:'-75.99182420804915',lat:'45.9614605364062'},{lon:'-76.13653502553329',lat:'45.66998455433452'},{lon:'-75.74908760807244',lat:'45.621490507171984'},{lon:'-75.60067174717571',lat:'45.91198477616756'}];
AddRaidPolygon(raid_mapLayer, VGroup17,"#62AF44","17");
    
var VGroup18 = [{lon:'-74.7379879960829',lat:'45.18091669400136'},{lon:'-75.12460195255107',lat:'45.23296051195537'},{lon:'-75.27544780955287',lat:'44.94749575320313'},{lon:'-74.89238720051853',lat:'44.89647590036436'},{lon:'-74.7379879960829',lat:'45.18091669400136'}];
AddRaidPolygon(raid_mapLayer, VGroup18,"#A61B4A","18");
    
var VGroup19 = [{lon:'-75.36066533769299',lat:'45.57147314077262'},{lon:'-75.74908760807244',lat:'45.621490507171984'},{lon:'-75.89511146166747',lat:'45.33252016169173'},{lon:'-75.51032705582037',lat:'45.283492371701485'},{lon:'-75.36066533769299',lat:'45.57147314077262'}];
AddRaidPolygon(raid_mapLayer, VGroup19,"#7C3592","19");
    
    
    
    //setTimeout(function(){CurrentRaidLocation(raid_mapLayer)},3000);
    //mro_Map.events.register("moveend", Waze.map, function(){CurrentRaidLocation(raid_mapLayer)});
    //mro_Map.events.register("zoomend", Waze.map, function(){CurrentRaidLocation(raid_mapLayer)});
       
}

bootstrap_MapRaidOverlay(); 
