// ==UserScript==
// @name         Trade percentages
// @namespace    http://tampermonkey.net/
// @version      1.0.0
// @description  trade percentage
// @include      https://*.grepolis.com/game/*
// @author       You
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/550277/Trade%20percentages.user.js
// @updateURL https://update.greasyfork.org/scripts/550277/Trade%20percentages.meta.js
// ==/UserScript==

(function() {
    'use strict';
    window.woodpercentage = 0;
    window.stonepercentage = 0;
    window.ironpercentage = 0;
    window.wwtrade = false;
        if(Game.world_id == "ts1"){
        	voegSettingsIcoonToe()
        }

        function voegSettingsIcoonToe() {			// module die het instellingenknopje rechtsboven maakt
            if(document.getElementById('tradePercentages') == null){ // indien er nog geen knopje is, doe het volgende
                // het volgende blok code maakt een instellingenknopje en stel in
                var a = document.createElement('div');
                a.id = "tradePercentages";
                a.className = 'btn_settings circle_button';
                var img = document.createElement('div');
                img.style.margin = '6px 0px 0px 5px';
                img.style.background = "url(https://gpnl.innogamescdn.com/images/game/autogenerated/layout/layout_095495a.png) no-repeat -648px -647px";
                img.style.width = '22px';
                img.style.height = '22px';
                img.style.backgroundSize = '100%';
                a.style.top = '145px';
                a.style.right = '110px';
                a.style.zIndex = '10000';
                a.appendChild(img);
                document.getElementById('ui_box').appendChild(a);
               $("#tradePercentages").click(function() {
                   maakInstellingMenu();
               });
            }}


function maakInstellingMenu() {
    var windowExists = false;
    var windowItem = null;
    for (var item of document.getElementsByClassName('ui-dialog-title')) {
        if (item.innerHTML == "TradePercentages") {
            windowExists = true;
            windowItem = item;
        }
    }
    console.log(windowExists);
    console.log("test");
    if (!windowExists) {
        var wnd = Layout.wnd.Create(Layout.wnd.TYPE_DIALOG, "TradePercentages");
        wnd.setContent('');
    }
    for (var item of document.getElementsByClassName('ui-dialog-title')) {
        if (item.innerHTML == "TradePercentages") {
            windowItem = item;
        }
    }
    wnd.setHeight('300');
    wnd.setWidth('185');
    wnd.setTitle("TradePercentages");
    var title = windowItem;
    var frame = title.parentElement.parentElement.children[1].children[4];
    frame.innerHTML = '';
    var html = document.createElement('html');
    var body = document.createElement('div');
    var head = document.createElement('head');
    var element = document.createElement('h3');
    element.innerHTML = "TradePercentages";
    element.style.margin = '0 auto';
    body.appendChild(element);

    // Create wood icon
    var woodIcon = document.createElement('div');
    woodIcon.className = 'icon wood';
    woodIcon.style.width = '30px';
    woodIcon.style.height = '30px';
    woodIcon.style.backgroundImage = 'url("https://gpnl.innogamescdn.com/images/game/layout/resources_2.32.png")';
    woodIcon.style.backgroundPosition = '0 0'; // Wood icon starts at top left
    woodIcon.style.backgroundSize = 'cover';
    woodIcon.style.margin = '0 auto';

    // Create container for wood input
    var woodInputContainer = document.createElement('div');
    woodInputContainer.style.textAlign = 'center';
    woodInputContainer.appendChild(woodIcon);

    // Create wood input field
    var woodInput = document.createElement('input');
    woodInput.className = 'cbx_caption';
    woodInput.type = "number";
    woodInput.placeholder = "Wood Percentage";
    woodInput.id = "woodPercentageInput";
    woodInput.value = window.woodpercentage || 0;
    woodInputContainer.appendChild(woodInput);

    // Create stone icon
    var stoneIcon = document.createElement('div');
    stoneIcon.className = 'icon stone';
    stoneIcon.style.width = '30px';
    stoneIcon.style.height = '30px';
    stoneIcon.style.backgroundImage = 'url("https://gpnl.innogamescdn.com/images/game/layout/resources_2.32.png")';
    stoneIcon.style.backgroundPosition = '0 -30px'; // Stone icon starts at 30px from left
    stoneIcon.style.backgroundSize = 'cover';
    stoneIcon.style.margin = '0 auto';

    // Create container for stone input
    var stoneInputContainer = document.createElement('div');
    stoneInputContainer.style.textAlign = 'center';
    stoneInputContainer.appendChild(stoneIcon);

    // Create stone input field
    var stoneInput = document.createElement('input');
    stoneInput.className = 'cbx_caption';
    stoneInput.type = "number";
    stoneInput.placeholder = "Stone Percentage";
    stoneInput.id = "stonePercentageInput";
    stoneInput.value = window.stonepercentage || 0;
    stoneInputContainer.appendChild(stoneInput);

    // Create iron icon
    var ironIcon = document.createElement('div');
    ironIcon.className = 'icon iron';
    ironIcon.style.width = '30px';
    ironIcon.style.height = '30px';
    ironIcon.style.backgroundImage = 'url("https://gpnl.innogamescdn.com/images/game/layout/resources_2.32.png")';
    ironIcon.style.backgroundPosition = '0 -60px'; // Iron icon starts at 60px from left
    ironIcon.style.backgroundSize = 'cover';
    ironIcon.style.margin = '0 auto';

    // Create container for iron input
    var ironInputContainer = document.createElement('div');
    ironInputContainer.style.textAlign = 'center';
    ironInputContainer.appendChild(ironIcon);

    // Create iron input field
    var ironInput = document.createElement('input');
    ironInput.className = 'cbx_caption';
    ironInput.type = "number";
    ironInput.placeholder = "Iron Percentage";
    ironInput.id = "ironPercentageInput";
    ironInput.value = window.ironpercentage || 0;
    ironInputContainer.appendChild(ironInput);

    // Create checkbox for wwtrade
    var wwtradeCheckbox = document.createElement('input');
    wwtradeCheckbox.type = "checkbox";
    wwtradeCheckbox.id = "wwtradeCheckbox";
    wwtradeCheckbox.checked = window.wwtrade || false; // Default to false if not set
    wwtradeCheckbox.style.marginTop = '10px';
    var wwtradeLabel = document.createElement('label');
    wwtradeLabel.for = "wwtradeCheckbox";
    wwtradeLabel.innerHTML = "Enable Scheefstorten";

    // Event listener to update window.wwtrade on checkbox change
    wwtradeCheckbox.addEventListener("change", function () {
        window.wwtrade = wwtradeCheckbox.checked;
    });

    // Event listeners to update window variables on input change
    woodInput.addEventListener("input", function () {
        window.woodpercentage = parseFloat(woodInput.value);
    });

    stoneInput.addEventListener("input", function () {
        window.stonepercentage = parseFloat(stoneInput.value);
    });

    ironInput.addEventListener("input", function () {
        window.ironpercentage = parseFloat(ironInput.value);
    });

    var applyButton = document.createElement('button');
    applyButton.innerHTML = "Apply";
    applyButton.style.marginTop = "10px";
    applyButton.addEventListener("click", function () {
        window.woodpercentage = parseFloat(woodInput.value);
        window.stonepercentage = parseFloat(stoneInput.value);
        window.ironpercentage = parseFloat(ironInput.value);
    });

    // Appending elements to the body
    body.appendChild(woodIcon);
    body.appendChild(woodInput);
    body.appendChild(document.createElement('br')); // Line break for spacing
    body.appendChild(stoneIcon);
    body.appendChild(stoneInput);
    body.appendChild(document.createElement('br')); // Line break for spacing
    body.appendChild(ironIcon);
    body.appendChild(ironInput);
    body.appendChild(document.createElement('br'));
    body.appendChild(wwtradeCheckbox);
    body.appendChild(wwtradeLabel);
    body.appendChild(document.createElement('br'));
    body.appendChild(applyButton);

    // Append body to the frame
    frame.appendChild(body);
}
})();