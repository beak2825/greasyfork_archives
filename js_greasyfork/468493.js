// ==UserScript==
// @name         从豆瓣、爱奇艺直接跳转哦牛牛搜索资源
// @namespace    https://oniuniu.com/
// @version      1.0.2
// @author       Oniuniu
// @require      https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js
// @match        *://movie.douban.com/subject/*
// @match        *://*.iqiyi.com/*
// @description 哦牛牛是一个影视资源聚合搜索引擎。安装脚本后豆瓣电影标题旁和爱奇艺电影标题旁会显示哦牛牛的logo，点击就可以搜索影视资源了。
// @downloadURL https://update.greasyfork.org/scripts/468493/%E4%BB%8E%E8%B1%86%E7%93%A3%E3%80%81%E7%88%B1%E5%A5%87%E8%89%BA%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%E5%93%A6%E7%89%9B%E7%89%9B%E6%90%9C%E7%B4%A2%E8%B5%84%E6%BA%90.user.js
// @updateURL https://update.greasyfork.org/scripts/468493/%E4%BB%8E%E8%B1%86%E7%93%A3%E3%80%81%E7%88%B1%E5%A5%87%E8%89%BA%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%E5%93%A6%E7%89%9B%E7%89%9B%E6%90%9C%E7%B4%A2%E8%B5%84%E6%BA%90.meta.js
// ==/UserScript==

(function () {
    var svg = `<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="32px" height="32px" viewBox="0 0 2148.000000 2148.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,2148.000000) scale(0.100000,-0.100000)"
fill="#d81e06" stroke="none">
<path d="M17720 20207 c0 -10 14 -77 30 -150 64 -279 72 -323 90 -482 6 -49
18 -142 25 -205 11 -87 12 -132 4 -185 -5 -38 -7 -90 -3 -115 7 -48 6 -372 -1
-409 -2 -12 -7 -77 -10 -144 -8 -177 -15 -257 -25 -297 -5 -19 -14 -69 -19
-110 -15 -113 -45 -245 -108 -485 -53 -197 -190 -616 -245 -750 -16 -38 -33
-81 -37 -95 -11 -33 -151 -352 -161 -365 -4 -5 -24 -41 -45 -80 -57 -106 -256
-383 -392 -545 -178 -212 -239 -279 -453 -492 -377 -376 -774 -687 -1150 -900
-25 -14 -85 -49 -135 -78 -108 -64 -315 -163 -445 -214 -52 -21 -106 -42 -120
-48 -122 -50 -348 -108 -520 -133 -197 -29 -287 -16 -520 75 -151 59 -332 124
-400 145 -25 7 -67 20 -95 28 -67 21 -248 74 -310 91 -63 18 -132 34 -215 50
-36 7 -75 16 -87 20 -21 7 -119 26 -243 46 -182 31 -241 40 -310 45 -41 4 -93
11 -115 15 -22 5 -78 11 -125 14 -47 3 -139 9 -205 13 -251 16 -783 7 -985
-18 -41 -5 -120 -14 -175 -20 -55 -6 -128 -17 -162 -25 -34 -8 -79 -14 -100
-14 -21 0 -54 -5 -73 -11 -19 -5 -69 -16 -110 -23 -41 -8 -95 -18 -120 -24
-25 -6 -88 -21 -140 -32 -52 -12 -117 -27 -145 -35 -47 -14 -102 -29 -255 -70
-194 -52 -308 -93 -456 -166 -185 -91 -283 -116 -486 -126 -320 -15 -769 101
-1203 313 -112 54 -178 91 -409 226 -72 43 -341 224 -426 288 -493 369 -1015
906 -1367 1408 -146 208 -230 377 -386 782 -32 83 -183 532 -196 585 -5 22
-20 74 -32 115 -24 86 -37 138 -72 305 -74 348 -100 661 -94 1140 4 332 14
473 42 620 33 174 67 340 70 345 9 15 36 162 32 173 -10 24 -207 -207 -329
-383 -149 -216 -320 -551 -452 -882 -230 -580 -396 -1288 -470 -2003 -42 -403
-41 -535 4 -840 41 -274 35 -248 140 -560 73 -216 161 -427 281 -667 72 -146
80 -160 202 -368 111 -189 146 -243 276 -425 189 -263 365 -469 593 -690 209
-204 294 -277 513 -442 323 -242 703 -449 1105 -602 64 -24 91 -47 83 -69 -4
-10 -50 -68 -102 -130 -53 -63 -114 -138 -136 -167 -22 -29 -80 -105 -129
-170 -175 -230 -360 -521 -511 -800 -75 -139 -195 -379 -195 -389 0 -3 -16
-39 -36 -83 -20 -43 -42 -91 -49 -108 -22 -50 -107 -267 -121 -310 -7 -22 -25
-71 -39 -110 -14 -38 -32 -90 -39 -115 -8 -25 -24 -76 -35 -115 -12 -38 -26
-89 -31 -113 -5 -23 -14 -50 -19 -60 -5 -9 -12 -37 -16 -62 -4 -25 -11 -53
-16 -62 -5 -10 -16 -48 -23 -85 -8 -37 -24 -111 -36 -163 -11 -52 -25 -124
-31 -160 -5 -36 -14 -78 -19 -95 -5 -16 -14 -72 -19 -122 -6 -51 -12 -97 -15
-101 -5 -9 -28 -224 -48 -447 -21 -248 -14 -867 13 -1075 5 -41 12 -111 15
-155 3 -44 10 -93 15 -109 5 -15 13 -67 19 -115 6 -47 17 -115 25 -151 8 -36
19 -92 25 -125 27 -143 83 -381 117 -495 42 -145 124 -402 139 -437 8 -17 14
-36 14 -42 0 -6 7 -25 15 -43 8 -18 35 -85 59 -148 204 -527 556 -1148 905
-1595 68 -87 164 -208 171 -215 3 -3 34 -39 70 -80 124 -143 145 -166 330
-351 521 -523 1119 -950 1773 -1267 82 -40 150 -72 153 -72 2 0 32 -14 66 -31
35 -16 92 -41 128 -55 36 -14 74 -30 85 -35 39 -17 162 -63 315 -116 137 -48
312 -102 430 -133 47 -12 108 -28 135 -35 28 -7 93 -23 145 -34 52 -11 115
-26 140 -32 25 -6 74 -15 110 -19 36 -5 92 -16 125 -24 32 -9 77 -16 100 -16
22 0 76 -6 120 -14 218 -39 420 -51 870 -51 451 0 675 13 859 51 38 8 81 14
96 14 42 0 293 47 455 86 39 9 88 20 110 24 47 9 152 36 215 55 25 7 79 23
120 35 77 23 386 125 424 140 11 5 75 30 141 56 499 195 1000 469 1440 787
112 82 372 286 435 342 19 18 80 71 135 120 135 118 365 352 528 537 139 158
168 193 314 388 131 174 130 174 233 329 189 287 341 556 478 851 67 144 137
309 177 415 14 39 30 79 34 90 38 94 125 369 171 535 39 144 48 176 70 275 12
55 28 125 35 155 12 52 24 113 46 255 6 33 16 98 24 145 8 47 17 121 20 165 4
44 12 118 19 165 7 47 15 148 17 225 7 246 0 838 -10 936 -22 197 -41 347 -51
414 -26 163 -69 387 -92 480 -5 22 -16 67 -23 100 -104 461 -342 1089 -581
1535 -70 131 -194 350 -214 380 -9 14 -33 51 -54 83 -77 122 -115 177 -215
317 -126 176 -268 355 -416 525 -29 33 -55 70 -59 82 -9 27 10 40 119 83 100
40 379 179 510 255 574 333 1121 836 1522 1400 243 342 415 640 576 995 126
280 181 427 282 762 7 25 19 84 25 130 6 45 18 121 25 168 8 47 17 119 19 161
3 41 8 100 12 130 7 68 -10 382 -31 554 -78 654 -187 1155 -362 1675 -204 607
-446 1068 -754 1435 -91 108 -139 154 -139 132z m-6000 -8497 c364 -48 606
-111 955 -248 670 -262 1251 -710 1676 -1292 485 -663 737 -1466 716 -2277
-16 -602 -129 -1080 -377 -1598 -202 -423 -431 -752 -755 -1084 -344 -352
-693 -606 -1140 -828 -178 -89 -510 -219 -640 -252 -22 -6 -94 -24 -160 -40
-173 -44 -237 -58 -350 -75 -476 -74 -1071 -62 -1465 29 -402 93 -633 173
-947 330 -343 170 -574 328 -890 607 -337 298 -693 789 -883 1218 -47 106
-147 373 -174 465 -9 33 -23 80 -31 105 -7 25 -18 71 -24 103 -6 32 -13 62
-16 67 -9 15 -45 240 -62 390 -22 196 -22 621 0 822 91 821 427 1577 980 2204
179 204 435 437 553 504 32 19 149 92 259 163 414 268 594 370 784 443 36 14
82 32 101 39 19 8 67 24 105 35 39 12 88 28 110 35 63 21 323 83 399 95 38 6
72 13 76 15 11 7 262 37 383 45 203 14 639 4 817 -20z"/>
<path d="M9719 10291 c-108 -35 -224 -132 -273 -228 -51 -102 -53 -241 -4
-337 29 -56 105 -134 158 -161 194 -98 424 -11 530 200 33 66 35 76 35 170 0
75 -5 113 -19 150 -24 62 -92 136 -164 177 -48 27 -65 31 -146 34 -50 2 -103
0 -117 -5z"/>
<path d="M11933 10291 c-45 -12 -126 -65 -169 -113 -62 -69 -78 -118 -79 -233
0 -97 2 -104 38 -177 41 -85 124 -170 199 -207 278 -134 591 119 514 417 -14
54 -54 130 -98 183 -23 28 -109 89 -157 111 -50 23 -189 34 -248 19z"/>
<path d="M9060 7006 c-96 -22 -185 -73 -254 -147 -209 -220 -199 -553 24 -884
213 -316 628 -640 915 -716 216 -57 441 3 564 150 60 72 105 173 121 274 12
76 11 98 -3 177 -22 121 -97 276 -220 453 -127 182 -213 284 -317 375 -297
260 -589 372 -830 318z"/>
<path d="M12535 7006 c-245 -50 -556 -259 -753 -507 -204 -258 -319 -462 -354
-628 -21 -100 -21 -104 -4 -194 76 -397 448 -551 852 -353 378 187 767 585
876 896 25 72 48 193 48 252 0 26 -7 79 -15 119 -65 307 -333 478 -650 415z"/>
</g>
</svg>`;
    var host = location.hostname;
    if (host === 'movie.douban.com') {
        const title = encodeURIComponent(document.querySelector('title').innerText.replace(/(^\s*)|(\s*$)/g, '').replace(' (豆瓣)', ''));
        const subjectwrap = document.querySelector('h1');
        const subject = document.querySelector('.year');
        if (!subjectwrap || !subject) {
            return;
        }
        const sectl = document.createElement('span');
        subjectwrap.insertBefore(sectl, subject.nextSibling);
        sectl.insertAdjacentHTML('beforebegin',
            `<style>.cupfox{vertical-align: middle;}.cupfox:hover{background: #fff!important;}</style>
            <a href="https://oniuniu.com/s/${title}" class="cupfox" target="_blank">${svg}</a>`
        );
    }
    if(host==='www.iqiyi.com'){
        setTimeout(function(){
            const content = $('meta[name="irAlbumName"]').attr('content');
            const upperCaseNums = ['','一','二','三','四','五','六','七','八','九','十','十一','十二','十三','十四','十五','十六','十七','十八','十九','二十'];
            const pattern = /\d+/g; // 匹配连续的数字
            let result = content.replace(pattern, function(match) {
                return upperCaseNums[match]; // 将匹配到的数字转换为大写
            });
            const title = encodeURIComponent(result);
            const subjectwrap = document.querySelector('.header-link');
            if (!subjectwrap) {
                return;
            }
            const sectl = document.createElement('span');
            subjectwrap.insertBefore(sectl, subjectwrap.nextSibling);
            sectl.insertAdjacentHTML('beforebegin',
                                     `<style>.cupfox{vertical-align: middle;}</style><a href="https://oniuniu.com/s/${title}" class="cupfox" target="_blank">${svg}</a>`
                                    );
        },1500)
    }
})();
