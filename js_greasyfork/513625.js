// ==UserScript==
// @name         Danbooru Copy Tags Optimized
// @namespace    http://tampermonkey.net/
// @version      1.61
// @description  修复角色标签复制问题，优化过滤逻辑
// @match        https://danbooru.donmai.us/posts/*
// @match        https://aibooru.online/posts/*
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/513625/Danbooru%20Copy%20Tags%20Optimized.user.js
// @updateURL https://update.greasyfork.org/scripts/513625/Danbooru%20Copy%20Tags%20Optimized.meta.js
// ==/UserScript==

(function () {
    'use strict';

    const BUTTON_STYLE = `
        position: absolute;
        right: 10px;
        z-index: 9999;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 5px;
        transition: background-color 0.3s;
    `;

    const BUTTON_COLORS = {
        general: '#28a745',        // 绿色
        nonCharacter: '#dc3545',   // 红色
        character: '#17a2b8',      // 蓝色
        clothing: '#ffc107',       // 黄色
        allExceptArtist: '#6f42c1',// 紫色
        combinedRole: '#007bff'    // 天蓝色
    };

    const TAG_LISTS = {
        general: '.general-tag-list a',
        characters: '.character-tag-list a',
        artists: '.artist-tag-list a'
    };

    // 创建独立单词匹配的过滤函数
    const createWordFilter = (keywords) => {
        if (!keywords || !keywords.length) return () => false;
        const regex = new RegExp(`\\b(${keywords.join('|')})\\b`, 'i');
        return tag => regex.test(tag) &&
                      !blacklist.some(b => b.toLowerCase() === tag.toLowerCase());
    };

    // 角色特征词
    const characterFeatures = [
        'bun','kemonomimi mode','sidelocks','eyes','hair','girl','forehead','forehead jewel','forehead kiss','forehead mark','head bump','head down','head mounted display','head out of frame','head rest','head tilt','head wings','face','eyes','eyebrows','mouth','nose','ears','chin','cheek','forehead','hairstyle','hair','bald','bob cut','bowl cut','double bun','drill','hachimaki','hair behind ear','hair bell','hair bun','hair down','hair flaps','hair flip','hair flower','hair spread out','hair up','japari bun','kerchief','one side up','twin drills','updo','wet hair','adjusting headwear','bear hair ornament','brown headwear','horned headwear','horns through headwear','no headwear','object on head','print headwear','bone hair ornament','bunny hair ornament','horn ornament','animal on head','bird on head','cat ear headphones','cat on head','eyewear on head','headwear','headpiece','headwear removed','head wreath','crown','mini crown','tiara','diadem','tilted headwear','head fins','maid headdress','bridal veil','headband','helmet','alternate headwear','goggles on headwear','earphones','earmuffs','ears through headwear','xx on head','leaf on head','topknot','suigintou','triangular headpiece','forehead protector','radio antenna','animal hood','axe','bandana','circlet','double dildo','faucet','helm','helmet removed','horned helmet','mami mogu mogu','mob cap','owl','pier','pillow','raised fist','skull and crossbones','stone','turban','adjusting headwear','hat','no hat','large hat','mini hat','witch hat','mini witch hat','wizard hat','party hat','jester cap','tokin hat','top hat','mini top hat','bowler hat','pillbox hat','cloche hat','side cap','military hat','beret','garrison cap','police hat','nurse cap','chef hat','school hat','pirate hat','cabbie hat','bucket hat','hardhat','straw hat','sun hat','rice hat','animal hat','fur hat','hat with ears','bobblehat','pillow hat','pumpkin hat','baseball cap','flat cap','torn hat','mob cap','newsboy cap','bowknot over white beret','backwards hat','bowl hat','cat hat','chat log','cowboy hat','dixie cup hat','hat bow','hat feather','hat flower','hat ornament','hat over one eye','hat removed','hat ribbon','hat tip','porkpie hat','sailor hat','santa hat','sideways hat','hair ribbon','hairband','hair tie','lolita hairband','frilled hairband','hair bobbles','hair ornament','hair flower','x hair ornament','hair bow','frog hair ornament','heart hair ornament','butterfly hair ornament','star hair ornament','anchor hair ornament','bat hair ornament','carrot hair ornament','cat hair ornament','clover hair ornament','crescent hair ornament','cross hair ornament','fish hair ornament','hairpods','leaf hair ornament','musical note hair ornament','pumpkin hair ornament','skull hair ornament','snake hair ornament','snowflake hair ornament','strawberry hair ornament','sunflower hair ornament','hairpin','hairclip','hair tubes','hair stick','hair bun','single hair bun','hair bell','hair rings','glasses','eyewear','monocle','rimless eyewear','round eyewear','tinted eyewear','medical eyepatch','bandage over one eye','crooked eyewear','eyewear removed','sunglasses','goggles','Blindfold','eyepatch','visor','bespectacled','no eyewear','opaque glasses','mask','half mask','masked','mask lift','mask on head','mask removed','mouth mask','surgical mask','plague doctor mask','gas mask','visor','helmet','fox mask','diving mask','diving mask on head','oni mask','tengu mask','ninja mask','skull mask','hockey mask','bird mask','stone mask','horse mask','masquerade mask','domino mask','earrings','cross earrings','crystal earrings','flower earrings','heart earrings','hoop earrings','multiple earrings','pill earrings','single earring','skull earrings','star earrings','halo','mechanical halo','neck','necklace','choker','black choker','belt collar','frilled choker','neckerchief','red neckerchief','necktie','short necktie','white necktie','bowtie','headphones around neck','goggles around neck','neck bell','neck ruff','towel around neck','loose necktie','neck tattoo','ascot','ribbon choker','latex','torn clothes','iron cross','chinese knot','cross necklace','bead necklace','pearl necklace','heart necklace','carrot necklace','chain necklace','magatama necklace','tooth necklace','key necklace','anchor necklace','skull necklace','shell necklace','gold necklace','crescent necklace','ring necklace','feather necklace','bone necklace','ankh necklace','multiple necklaces','bullet necklace','holding necklace','necklace removed','brown neckwear','checkered neckwear','halterneck','mole on neck','neck ribbon','neck ring','plunging neckline','print neckwear','sleeveless turtleneck','star necklace','striped neckwear','turtleneck ','weater','undone necktie','whistle around neck','little girl','little boy','shota','loli','kawaii','mesugaki','adorable girl','bishoujo','gyaru','sisters','ojousama','female','mature female','mature','female pervert','male','milf','otoko no ko','crossdressing','lifeguard','boxer','scientist','athletes','monk','acrobat','nun','nurse','stewardess','student','waitress','teacher','racer','police','soldier','cheerleader','actor','actress','spy','agent','assassin','poet','samurai','motorcyclist','hacker','magician','detective','doll','maid','pilot','diver','missionary','firefighter','goalkeeper','chef','astronaut','cashier','mailman','barista','makihitsuji','office lady','race queen','queen','doctor','knight','housemaid','dancer','ballerina','gym leader','trap','female','harem','idol','male','priest','cleric','wa maid','yaoi','yuri','albino','amputee','princess','pokemon','mario','pikachu','doraemon','avengers','mazinger','witch','miko','ninja','vampire','knight','magical girl','orc','druid','elf','fairy','furry','mermaid','magister','monster girl','cat girl','dog girl','fox girl','kitsune','kyuubi','raccoon girl','wolf girl','bunny girl','horse girl','cow girl','dragon girl','centaur','slime musume','spider girl','dominatrix','sailor senshi','mecha','mecha musume','humanoid robot ','cyborg','angel','devil','dark elf','imp','succubus','giantess','minigirl','monster','toddler','kindergartener','child','underage','teenager','teen','adult','elder','old','loli','shota','white skin','pale skin','fair skin','brown skin','deep skin','dark skin','black skin','shiny skin','white marble glowing skin','tattoo','tan','tanlines','oil','skinny','plump','curvy','gyaru','pregnant','fat','thin','slender','glamor','tall','petite','chibi','muscular','straight hair','bunches','twintails','ponytail','bangs','side blunt bangs','ahoge','forehead','hair flaps','makeup','fundoshi','eyeshadow','lipstick','mascara','long eyelashes','red lips ','facepaint','lipgloss','colored eyelashes','blush','light blush','anime style blush','nose blush','nosebleed','bruise on face','facial mark','forehead mark','anger vein','mole','mole under eye','freckles','food on face','rice on face','cream on face','mustache','goatee','whisker markings','scar','scar across eye','smoking pipe','tattoo','ear blush','ear ornament','ear piercing','animal ears','ears down','fake animal ears','floppy ears','animal ear fluff','fox ears','cat ears','lion ears','jaguar ears','tiger ears','dog ears','coyote ears','bunny ears','horse ears','pointy ears','long pointy ears','mouse ears','raccoon ears','squirrel ears','bear ears','panda ears','bat ears','robot ears','extra ears','ears through headwear','alpaca ears','horns','fake horns','dragon horns','oni horns','antlers','curled horns','goat horns','hair on horn','eyeshadow','tsurime','tareme','heterochromia','longeyelashes','light eyes','glowing eye','shiny eyes','sparkling eyes','gradient eyes','anime style eyes','water eyes','beautiful detailed eyes','solid oval eyes ','solid circle pupils','blush stickers','heart in eye','evil eyes','crazy eyes','empty eyes','covered eyes','hollow eyes','multicolored eyes','ringed eyes','sanpaku','mismatched sclera','eye relfection','mechanical eye','cephalopod eyes','clock eyes','compound eyes','fisheye','devil eyes','bloodshot eyes','blood from eyes','aqua eyes','solid eyes','sparkling anime eyes','blue eyes','brown eyes','closed eyes','crying with eyes open','extra eyes','eye contact','eye of horus','eyeball','eyeliner','eyes','glint','glowing eyes','horizontal pupils','jitome','light brown eyes','no eyes','reflective eyes','silver eyes','spiral eyes','third eye','uneven eyes','flaming eye','eyes closed','half closed eyes','narrowed eyes','squinting','tears','sharp eyes','slanted eyes','upturned eyes','hair over eyes','eyes visible through hair','hair over one eye','one eye covered','bags under eyes','eyepatch','medical eyepatch','scar across eye','no blindfold','no eyepatch','ahegao','pupils','bright pupils','heterochromia','slit pupils','snake pupils','dilated pupils','no pupils','ringed eyes','constricted pupils','star in eye','horizontal pupils','dashed eyes','rectangular pupils','square pupils','dot pupils','extra pupils','mismatched pupils','purple pupils','orange pupils','blue pupils','symbol in eye','no nose','dot nose','nose bubble','smelling','nose','nosebleed','snot','snout','lipstick','pout','open mouth','gasping','Slightly open mouth','wavy mouth','close mouth','dot mouth','no mouth','gag','gnaw','parted lips','bit gag','chestnut mouth','cleave gag','closed mouth','covered mouth','extra mouth','hair in mouth','hair tie in mouth','homu','lips','mouth','mouth hold','oral','pacifier','sideways mouth','spoon in mouth','triangle mouth','saliva','drooling','mouth drool','teeth','upper teeth','fang','skin fang','round teeth','sharp teeth','clenched teeth','tongue','buck teeth','fang out','fangs','spiked club','tooth','toothbrush','tusks','shark mouth','french kiss','long tongue','oral invitation','tongue','tongue out','uvula','fingernails','toenails','nail polish','toenail polish','black nails','red nails','pink nails','long fingernails','nail','multicolored nails','nail art','brown vest','collarbonea','armpits','armpit crease','chest','small breasts','cleavage','areola','pectorals','large pectorals','narrow waist','slender waist','midriff','belly','absolute territory','inflation','navel','groin','pregnant','wings','bat wings','butterfly wings','black wings','demon wings','asymmetrical wings','detached wings','fairy wings','fake wings','fiery wings','insect wings','large wings','low wings','mini wings','multicolored wings','multiple wings','no wings','winged helmet','pointy ears','animal ears','cat ears','arknights','earrings','wuthering waves','mouse girl','mole','wolf girl',' genshin',' dog girl','hair bow','cow girl','headgear','blue archive','bangs','ears',' head','side up','cat','hair','rose','plum blossoms','ears','elf','feline-eared elf','pointed ears','daisy','hibiscus','headpiece','tiara','piercing','screw','screw in head','hat','sun hat','sclera','hair flower','two side up','white feathers','falling feather_hair_ornament','feathers','stuffed winged furry','furry girl','unicorn','heterochromia','back tattoo','tattoo','elf','tiger ears','tiger girl','horse girl','double bun','short eyebrows','rabbit-shaped pupils','rabbit girl','jewelry','eyewear','sunglasses','glasses','wings','braided ponytail','braid','beret','hat','headwear','sun hat','braid','official alternate costume','tentacle hair','red ribbon','tentacle hair','red headwear','harvin','erune','animal ear fluff','hair','eyes','choker','medium reindeer stuffed winged unicorn','antlers','fake antlers','hair','1girl','large breasts','twintails','girl on top','multiple girls','hair ornament','animal ears','hairband','symbol-shaped pupils','fake animal ears','heart-shaped pupils','mouse ears','long hair','one eye closed','dark skin','pubic hair','upper teeth only','looking over eyewear','red-tinted eyewear','eyeshadow','v-shaped eyebrows','wide-eyed','constricted pupils','bloodshot eyes','tail','cat ears','cat tail','half-closed eyes','cat girl','eyepatch','empty eyes','medical eyepatch','very long hair','hair bow','hairclip','green eyes','rabbit ears','streaked hair','hair tie','adjusting hair','hair tie in mouth','earrings','ribbon','halo','braid','pointy ears','feathered wings','angel wings','single side bun','low twintails','alternate costume','closed eyes','long bangs','absurdly long hair','blue halo','mechanical halo','facial hair','ahoge','two-tone hair','gradient hair','eyelashes','straight hair','pale skin','black wings','detached wings','energy wings','hair flowing over','broken halo','dark halo','ponytail','round eyewear','pearl earrings','glowing eyes','cowgirl position','drill hair','horns','demon horns','shiny skin','crossed bangs','fox ears','necklace','wavy hair','wolf ears','wolf tail','extra ears','bead necklace','scar across eye','colored eyelashes','butterfly hair ornament','dark-skinned female','covering face','ringed eyes','frilled hair tubes','ear piercing','cow horns','draph','cow tail','monkey tail','forehead','red ribbon','fox tail','skull hair ornament','eyes visible through hair','asymmetrical hair','official alternate hairstyle','mini wings','multicolored wings','star halo','heart hair ornament','spiked choker','high ponytail','tentacle hair','choker','fangs','pom pom hair ornament','floating hair','forked tail','ribbon-trimmed skirt','leaf hair ornament','short hair with long locks','fake horns','blood in hair','diamond hair ornament','skin fang','braided ponytail','multicolored eyes','demon tail','o-ring choker','playboy bunny','bob cut','button eyes','braided bangs','heart choker','tassel hair ornament','asymmetrical horns','demon wings','butterfly wings','horse ears','horse tail','side ponytail','diamond-shaped pupils','dog ears','bandaid hair ornament','neck ribbon','ribbon hair ornament','sharp teeth','messy hair','bright pupils','one side up','bags under eyes','hairband','braid','blue wings','star hair ornament','side ponytail','twisted horns','swirling eyes','vampire teeth',
    ];

    // 服装特征词
    const clothingFeatures = [
        'footwear','petticoat','buttons',' frills','sleeves','bodysuit','obijime','obiage','suit','tuxedo','formal dress','evening gown','canonicals','cocktail dress','gown','japanese clothes','kimono','sleeveless kimono','short kimono','print kimono','furisode','obi','sash','cheongsam','china dress','print cheongsam','pelvic curtain','wedding dress','uchikake','school uniform','sailor','serafuku','summer uniform','kindergarten uniform','police uniform','naval uniform','military uniform','maid','stile uniform','miko','overalls','business suit','nurse','chef uniform','labcoat','cheerleader','band uniform','space suit','leotard','domineering','china dress','chinese style','traditional clothes','japanese clothes','hanbok','korean clothes','western','german clothes','gothic','lolita','gothic lolita','byzantine fashion','Tropical','indian style','Ao Dai','ainu clothes','arabian clothes','egyptian clothes','costume','animal costume','bunny costume','adapted costume','cat costume','dog costume','bear costume','embellished costume','santa costume','halloween costume','kourindou tengu costume','alternate costume','costume switch','meme attire','casual','loungewear','hoodie','homewear','pajamas','nightgown','sleepwear','babydoll','print pajamas','polka dot pajamas','yukata','chinese clothes','hanfu','robe','robe of blending','cloak','hooded cloak','winter clothes','santa','harem outfit','sportswear','gym uniform','athletic leotard','tennis uniform','baseball uniform','letterman jacket','volleyball uniform','biker clothes','bikesuit','wrestling outfit','dougi','swimsuit','swimwear','wet swimsuit','school swimsuit','new school swimsuit','old school swimsuit','competition school swimsuit','competition swimsuit','front zipper swimsuit','highleg swimsuit','swimsuit of perpetual summer','bikini','highleg bikini','lowleg bikini','slingshot swimsuit','sailor bikini','shell bikini','sports bikini','string bikini','strapless sleeves','bikini','thong bikini','frilled bikini','eyepatch bikini','layered bikini','bow bikini','frilled swimsuit','polka dot swimsuit','striped swimsuit','striped bikini','plaid bikini','polka dot bikini','print bikini','american flag bikini','german flag bikini','impossible swimsuit','bikini top','bikini top torn','bikini top removed','bikini bottom only','bikini bottom','untied bikini','bikini aside','swimsuit aside','swimsuit under clothes','torn swimsuit','bikini skirt','swim briefs','swim cap','swim trunks','male swimwear','adapted uniform','anzio military uniform','anzio school uniform','aria company uniform','ashford academy uniform','bc freedom military uniform','chaldea uniform','fleur de lapin uniform','garreg mach monastery uniform','hanasakigawa school uniform','hikarizaka private high school uniform','homurahara academy uniform','kamiyama high school uniform','keizoku military uniform','kita high school uniform','kiyosumi school uniform','luna nova school uniform','meiji schoolgirl uniform','mitakihara school uniform','nami junior high school uniform','nanairogaoka middle school uniform','nanamori school uniform','naoetsu high school uniform','national shin ooshima school uniform','ooarai military uniform','ooarai school uniform','otonokizaka school uniform','paradis military uniform','polar chaldea uniform','pravda military uniform','pravda school uniform','rabbit house uniform','raimon soccer uniform','ryouou school uniform','sailor senshi uniform','sakugawa school uniform','sakuragaoka high school uniform','saunders military uniform','saunders school uniform','seishou elementary school uniform','shinda sekai sensen uniform','shuuchiin academy uniform','shuujin academy uniform','s military uniform','s school uniform','starlight academy uniform','tokisadame school uniform','tokiwadai school uniform','tomoeda elementary school uniform','tsab ground military uniform','uranohoshi school uniform','yasogami school uniform','mismatched bikini','multicolored bikini','blouse','white shirt','collared shirt','dress shirt','sailor shirt','cropped shirt','cardigan','frilled shirt','sweatshirt','hawaiian shirt','hoodie','kappougi','plaid shirt','polo shirt','print shirt','shirt','sleeveless hoodie','sleeveless shirt','striped shirt','tank top','vest','waistcoat','camisole','tied shirt','undershirt','crop top','highleg','clothing cutout','back cutout','cleavage cutout','navel cutout','midriff','heart cutout','torn clothes','torn shirt','undressing','clothes down','shirt lift','shirt pull','shirt tucked in','clothes tug','shirt tug','untucked shirt','lifted by self','untied','open clothes','button gap','partially unbuttoned','partially unzipped','clothes removed','shirt removed','wardrobe error','undersized clothes','tight','wedgie','wardrobe malfunction','taut shirt','taut clothes','underbust','oversized clothes','oversized shirt','borrowed garments','strap slip','wet shirt','clothes theft','blazer','overcoat','long coat','haori','winter coat','hooded coat','fur coat','duffel coat','fishnet top','parka','jacket','jacket partially removed','jacket removed','open jacket','cropped jacket','track jacket','hooded track jacket','military jacket','camouflage jacket','leather jacket','letterman jacket','bomber jacket','denim jacket','loating jacket','trench coat','furisode','windbreaker','raincoat','hagoromo','tunic','cape','capelet','winter clothes','sweater','pullover sweaters','ribbed sweater','sweater vest','backless sweater','aran sweater','beige sweater','brown sweater','hooded sweater','striped sweater','virgin killer sweater','down jacket','puffer jacket','transparent','burnt clothes','dissolving clothes','dirty clothes','expressive clothes','impossible clothes','living clothes','leotard under clothes','multicolored clothes','ofuda on clothes','wringing clothes','clothesline','shiny clothes','kariginu','jacket on shoulders','short jumpsuit','harness','rigging','aiguillette','apron','waist apron','maid apron','waist cape','clothes around waist','jacket around waist','sweater around waist','loincloth','bustier','corset','girdle','armor','bikini armor','full armor','plate armor','japanese armor','kusazuri','power armor','mecha','helmet','kabuto','shoulder armor','muneate','breastplate','faulds','greaves','shin guards','armored boots','dress','microdress','long dress','strapless dress','backless dress','halter dress','sundress','sleeveless dress','sailor dress','summer dress','china dress','pinafore dress','sweater dress','wedding dress','armored dress','frilled dress','collared dress','layered dress','pleated dress','taut dress','pencil dress','impossible dress','multicolored dress','striped dress','checkered skirt','plaid dress','ribbed dress','polka dot dress','print dress','skirt','microskirt','miniskirt','skirt suit','bikini skirt','pleated skirt','pencil skirt','bubble skirt','tutu','ballgown','pettiskirt','showgirl skirt','beltskirt','denim skirt','suspender skirt','skirt set','long skirt','summer long skirt','overskirt','hakama skirt','kimono skirt','suspender long skirt','chiffon skirt','frilled skirt','lace skirt','layered skirt','print skirt','multicolored skirt','striped skirt','plaid skirt','flared skirt','floral skirt','skirt hold','skirt tug','dress tug','skirt lift','skirt around one leg','skirt removed','dress removed','open skirt','dress bow','dressing another','shorts under skirt','side slit','shorts','micro shorts','short shorts','hot pants','cutoffs','striped shorts','suspender shorts','denim shorts','puffy shorts','dolphin shorts','dolfin shorts','tight pants','crotchless pants','track pants','yoga pants','bike shorts','gym shorts','pants','puffy pants','pumpkin pants','hakama pants','harem pants','bloomers','buruma','jeans','cargo pants','camouflage pants','capri pants','chaps','jumpsuit','lowleg pants','plaid pants','single pantsleg','striped pants','asymmetrical legwear','leotard aside','open fly','pants down','pants rolled up','pants tucked in','torn jeans','torn pants','torn shorts','bodystocking','pantyhose','leggings','legwear','thighhighs','kneehighs','socks','bare legs','black bodystocking','white bodystocking','stocking under clothes','black pantyhose','white pantyhose','thighband pantyhose','pantylines','single leg pantyhose','panties under pantyhose','fishnets','stirrup legwear','toeless legwear','mismatched legwear','asymmetrical legwear','uneven legwear','white thighhighs','black thighhighs','pink thighhighs','suspenders','garter straps','torn legwear','torn thighhighs','frilled legwear','seamed legwear','animal ear legwear','striped legwear','polka dot legwear','print legwear','legwear under shorts','bobby socks','tabi','loose socks','ankle socks','leg warmers','single sock','striped socks','leg cutout','thighhighs under boots','adjusting legwear','pantyhose pull','socks removed','sock pull','thighhighs pull','garters','leg garter','garter straps','thigh strap','thigh ribbon','leg ribbon','bandaid on leg','bandaged leg','thigh holster','bandaid on knee','argyle legwear','bow legwear','arm garter','armored','canvas','denim','fluffy','fur','latex','leather','spandex','tight','frilled','center frills','crease','layered','lace','fur trim','fine fabric emphasis','latex thighhighs','ass cutout','asymmetrical clothes','back bow','costume switch','double vertical stripe','halter top','multicolored legwear','navy blue legwear','nontraditional miko','side cutout','side slit','sideless outfit','single kneehigh','single vertical stripe','turtleneck','fringe trim','loose belt','drawstring','gathers','gusset','breast pocket','argyle','checkered','colored stripes','diagonal stripes','horizontal stripes','multicolored stripes','polka dot ','ribbed','striped','unmoving pattern','vertical stripes','plaid','animal print','cat print','bear print','bird print','bunny print','cow print','dragon print','fish print','frog print','shark print','snake print','zebra print','tiger print','leopard print','jaguar print','bat print','aardwolf print','african wild dog print','cheetah print','dog print','fox print','giraffe print','panda print','sand cat print','whale print','white tiger print','goldfish print','wing print','spider web print','butterfly print','floral print','leaf print','clover print','maple leaf print','rose print','strawberry print','cherry print','bamboo print','carrot print','hibiscus print','petal print','sunflower print','watermelon print','sky print','cloud print','lightning bolt print','rainbow print','snowflake print','starry sky print','crescent print','star print','moon print','sun print','character print','clothes writing ','anchor print','cherry blossom print','musical note print','triangle print','arrow print','wave print','peace symbol','heart print','flame print','hitodama print','paw print','skeleton print','skull print','sparkle print','yin yang print','cross print','camoflage','flag print','bone print','ghost print','mushroom print','onigiri print','cat ear','cat ear cutout','barefoot','no shoes','shoes removed','single shoe','the only shoe','black loafers','shoes','uwabaki','platform footwear','high heels','stiletto heels','strappy heels','platform heels ','rudder footwear','sandals','barefoot sandals','clog sandals','geta','slippers','skates','roller skates','animal feet','animal slippers','anklet','shackles','brown footwear','loafers','mary janes','mismatched footwear','pointy footwear','pumps','sandals removed','shoe soles','shoelaces','sneakers','winged footwear','zouri','boots','boots removed','thigh boots','knee boots','ankle boots','high heel boots','toeless boots','snow boots','anklet','rubber boots','santa boots','leather boots','thighhighs under boots','combat boots','doc martens','rain boots','belt boots','fur boots','single boot','shoe soles','arched soles','paw print soles','horseshoe','sailor collar','fur collar','frilled collar','popped collar','neck','necklace','choker','black choker','belt collar','frilled choker','neckerchief','red neckerchief','necktie','short necktie','white necktie','bowtie','headphones around neck','goggles around neck','neck bell',
    ];

    const blacklist = [
        'lowres', 'jpeg artifacts', 'signature', 'watermark',
        'censored', 'character name', 'artist name', 'sample', 'unknown'
    ];

    // 标签清洗和格式化
    const sanitizeTags = tags => {
        if (!tags || !tags.length) return '';
        return [...new Set(tags)] // 去重
            .filter(tag => tag.trim()) // 过滤空标签
            .join(', ')
            .replace(/,\s+/g, ', ') // 标准化逗号间隔
            .trim();
    };

    // 复制所有标签（除画师）
    const copyAllExceptArtists = () => {
        const generalTags = Array.from(document.querySelectorAll(TAG_LISTS.general))
            .map(el => el.innerText.replace(/^\?+/, '').trim()); // 移除前置问号
        const characterTags = Array.from(document.querySelectorAll(TAG_LISTS.characters))
            .map(el => el.innerText.replace(/^\?+/, '').trim());

        const result = sanitizeTags([...generalTags, ...characterTags]);
        if (!result) return alert('未找到可复制的标签');

        navigator.clipboard.writeText(result)
            .then(() => alert(`已复制所有标签（除画师）: ${result}`))
            .catch(err => alert(`复制失败: ${err}`));
    };

    // 复制角色相关（名+特征+服装）
    const copyCombinedRoleTags = () => {
        // 角色名
        const roleNames = Array.from(document.querySelectorAll(TAG_LISTS.characters))
            .map(el => el.innerText.replace(/^\?+/, '').trim());

        // 角色特征标签
        const roleFeatures = Array.from(document.querySelectorAll(TAG_LISTS.general))
            .map(el => el.innerText.replace(/^\?+/, '').trim())
            .filter(createWordFilter(characterFeatures));

        // 服装标签
        const clothingTags = Array.from(document.querySelectorAll(TAG_LISTS.general))
            .map(el => el.innerText.replace(/^\?+/, '').trim())
            .filter(createWordFilter(clothingFeatures));

        const combined = [...roleNames, ...roleFeatures, ...clothingTags];
        const result = sanitizeTags(combined);

        if (!result) return alert('未找到角色相关标签');
        navigator.clipboard.writeText(result)
            .then(() => alert(`已复制角色相关标签: ${result}`))
            .catch(err => alert(`复制失败: ${err}`));
    };

    // 复制特定类型标签
    const copyFilteredTags = (selector, filter, messagePrefix) => {
        setTimeout(() => {
            const tags = Array.from(document.querySelectorAll(selector))
                .map(el => el.innerText.replace(/^\?+/, '').trim())
                .filter(filter);

            const result = sanitizeTags(tags);
            if (!result) return alert(`未找到${messagePrefix}标签`);

            navigator.clipboard.writeText(result)
                .then(() => alert(`已复制${messagePrefix}标签: ${result}`))
                .catch(err => alert(`复制失败: ${err}`));
        }, 100);
    };

    // 创建按钮函数
    const createButton = (text, color, top, callback) => {
        const button = document.createElement('button');
        button.innerText = text;
        button.style.cssText = `${BUTTON_STYLE} top: ${top}px; background-color: ${color};`;
        button.addEventListener('mouseenter', () => button.style.backgroundColor = color.replace('#', '#').replace('#', '#d'));
        button.addEventListener('mouseleave', () => button.style.backgroundColor = color);
        document.querySelector('.image-container')?.appendChild(button);
        button.addEventListener('click', callback);
    };

    // 按钮布局
    createButton('复制所有标签（除画师）', BUTTON_COLORS.allExceptArtist, 10, copyAllExceptArtists);
    createButton('复制角色相关（名+特征+服装）', BUTTON_COLORS.combinedRole, 50, copyCombinedRoleTags);
    createButton('复制角色特征标签', BUTTON_COLORS.character, 90,
        () => copyFilteredTags(TAG_LISTS.general, createWordFilter(characterFeatures), '角色特征'));
    createButton('仅复制服装标签', BUTTON_COLORS.clothing, 130,
        () => copyFilteredTags(TAG_LISTS.general, createWordFilter(clothingFeatures), '服装'));
    createButton('复制非角色标签', BUTTON_COLORS.nonCharacter, 170,
        () => copyFilteredTags(TAG_LISTS.general,
            tag => !createWordFilter([...characterFeatures, ...clothingFeatures])(tag) &&
                  !blacklist.some(b => b.toLowerCase() === tag.toLowerCase()),
            '非角色'));
    createButton('复制角色名字', BUTTON_COLORS.character, 210,
        () => copyFilteredTags(TAG_LISTS.characters, () => true, '角色名字'));
    createButton('复制艺术家名字', BUTTON_COLORS.artistNames, 250,
        () => copyFilteredTags(TAG_LISTS.artists, () => true, '艺术家名字'));
})();