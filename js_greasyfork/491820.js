// ==UserScript==
// @name         ç”Ÿè´¢æœ‰æœ¯èˆªæµ·å®æˆ˜è¯ä¹¦è·å–-è·¯äººç”²ä¹™ä¸™
// @namespace    è·¯äººç”²ä¹™ä¸™
// @version      1.3
// @description  æ”¯æŒè·å–è‡ªå·±æˆ–å…¶å®ƒäººå‚ä¸è¿‡çš„æ‰€æœ‰å†å²èˆªæµ·çš„æ¯å¤©è¯ä¹¦
// @author       è·¯äººç”²ä¹™ä¸™
// @match        *://scys.com/*
// @license      Apache License, Version 2.0
// @grant        GM_xmlhttpRequest
// @downloadURL https://update.greasyfork.org/scripts/491820/%E7%94%9F%E8%B4%A2%E6%9C%89%E6%9C%AF%E8%88%AA%E6%B5%B7%E5%AE%9E%E6%88%98%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96-%E8%B7%AF%E4%BA%BA%E7%94%B2%E4%B9%99%E4%B8%99.user.js
// @updateURL https://update.greasyfork.org/scripts/491820/%E7%94%9F%E8%B4%A2%E6%9C%89%E6%9C%AF%E8%88%AA%E6%B5%B7%E5%AE%9E%E6%88%98%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96-%E8%B7%AF%E4%BA%BA%E7%94%B2%E4%B9%99%E4%B8%99.meta.js
// ==/UserScript==

"use strict";!function(){function e(e){try{var t=e.split(".")[1],o=t.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(o).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}catch(e){return console.error("JWT è§£ç å¤±è´¥:",e),null}}var t=localStorage.getItem("__user_token.v3");if(null!==t){var o=function(t){try{return e(t).number}catch(e){return console.error("è§£æ__user_token.v3æ—¶å‡ºé”™:",e),null}}(t);if(null!==o){console.log("ä»__user_token.v3ä¸­è·å–çš„useridä¸º:",o);var r=document.createElement("button");r.innerHTML="ğŸ‘‰ è·å–èˆªæµ·å®æˆ˜è¯ä¹¦",r.style.position="fixed",r.style.bottom="20px",r.style.right="20px",r.style.padding="10px 10px",r.style.backgroundColor="#006659",r.style.color="#fff",r.style.border="none",r.style.borderRadius="5px",r.style.cursor="pointer",r.onclick=function(){var e=new URLSearchParams(window.location.search),r=e.get("id");if(null==r&&(r=e.get("activity_id")),null===r||!window.location.href.startsWith("https://scys.com/mobile/activity/landing")&&!window.location.href.startsWith("https://scys.com/activity/landing"))return void alert("è¯·è¿›å…¥èˆªæµ·å®æˆ˜é¡µé¢åå†ç‚¹å‡»è·å–");console.log("å½“å‰é¡µé¢ä¸­çš„activity_idä¸º:",r);var n=prompt("è¯·è¾“å…¥ç”Ÿè´¢ç¼–å·ï¼ˆé»˜è®¤ä¸ºå½“å‰ç™»å½•ç”¨æˆ·ç”Ÿè´¢ç¼–å·ï¼‰:",o);if(null!==n){var s=n.trim()||o,l={form:{activity_id:r},page:1,perPage:10},a={method:"POST",headers:{"Content-Type":"application/json","X-Token":t},data:JSON.stringify(l)};GM_xmlhttpRequest({method:a.method,url:"https://scys.com/search/activity/stage/ajax/search",headers:a.headers,data:a.data,onload:function(e){console.log("è¯·æ±‚æˆåŠŸ:",e.responseText);var o=JSON.parse(e.responseText),n=o.data.items[0].stage_id;console.log("ä»å“åº”æ•°æ®ä¸­è·å–çš„stage_idä¸º:",n);var l="https://scys.com/search/activity/project/submit/poster?id="+r+"&number="+s+"&stage="+n;GM_xmlhttpRequest({method:"GET",url:l,headers:{"X-Token":t},onload:function(e){if(console.log("è·å–å›¾ç‰‡ç»“æœ:",e.responseText),null==JSON.parse(e.responseText).data)return void alert("è·å–æ•°æ®å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥è¾“å…¥çš„ç”Ÿè´¢ç¼–å·æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¡®è®¤æ­¤ç¼–å·æ˜¯å¦æœ‰å‚åŠ æ­¤èˆªæµ·ã€‚");var o=JSON.parse(e.responseText).data.poster,l=document.createElement("div");l.style.position="fixed",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.backgroundColor="rgba(0, 0, 0, 0.7)",l.style.zIndex="9999";var a=document.createElement("img");a.src=o,a.style.position="absolute",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.maxWidth="30%",l.onclick=function(e){e.target===l&&(document.body.removeChild(l),document.body.removeChild(i),dayButtons.forEach(function(e){return document.body.removeChild(e)}))},l.appendChild(a),document.body.appendChild(l);var i=document.createElement("button");i.innerHTML="ğŸš€ è·å–é€å¤©è¯ä¹¦",i.style.position="fixed",i.style.bottom="60px",i.style.right="20px",i.style.padding="10px 10px",i.style.backgroundColor="#006659",i.style.color="#fff",i.style.border="none",i.style.borderRadius="5px",i.style.cursor="pointer",i.onclick=function(){GM_xmlhttpRequest({method:"GET",url:"https://scys.com/search/activity/stage?activity_id="+r,headers:{"X-Token":t},onload:function(e){console.log("è·å–é€å¤©è¯ä¹¦ç»“æœ:",e.responseText);var o=[],a=[];if(null==JSON.parse(e.responseText).data)for(var i=1;i<=21;i++)o.push(n+i-21);else{a=JSON.parse(e.responseText).data.project;for(var c=0;c<21;c++)o.push(a[0]+c)}var d=[],p=0;o.slice().reverse().forEach(function(e,n){var i=document.createElement("button");if(i.innerHTML="ç¬¬"+(o.length-n)+"å¤©",i.style.position="fixed",i.style.bottom=70+30*(n+1)+"px",i.style.right="20px",i.style.padding="5px 10px",i.style.backgroundColor="#006659",i.style.color="#fff",i.style.border="none",i.style.borderRadius="5px",i.style.cursor="pointer",a.includes(e)){var c=" ("+(a.length-p++)+"/21)";i.textContent+=c}i.onclick=function(){GM_xmlhttpRequest({method:"GET",url:"https://scys.com/search/activity/project/submit/poster?id="+r+"&number="+s+"&stage="+e,headers:{"X-Token":t},onload:function(e){console.log("è·å–ç¬¬",o.length-n,"å¤©å›¾ç‰‡æˆåŠŸ:",e.responseText);var t=JSON.parse(e.responseText).data.poster,r=document.createElement("div");r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.backgroundColor="rgba(0, 0, 0, 0.7)",r.style.zIndex="9999";var s=document.createElement("img");s.src=t,s.style.position="absolute",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.maxWidth="30%",r.onclick=function(e){e.target===r&&l.removeChild(r)},r.appendChild(s),l.appendChild(r),document.body.appendChild(l)},onerror:function(e){console.error("è·å–ç¬¬",n+1,"å¤©å›¾ç‰‡å¤±è´¥:",e)}})},d.push(i),l.appendChild(i),document.body.appendChild(l)})},onerror:function(e){console.error("è·å–é€å¤©è¯ä¹¦å¤±è´¥:",e)}})},l.appendChild(a),l.appendChild(i),document.body.appendChild(l)},onerror:function(e){console.error("è·å–å›¾ç‰‡å¤±è´¥:",e)}})},onerror:function(e){console.error("è¯·æ±‚å¤±è´¥:",e)}})}},document.body.appendChild(r)}else console.log("æ— æ³•è§£æuseridï¼Œ__user_token.v3çš„å€¼å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„JWT")}else console.log("__user_token.v3 çš„å€¼ä¸å­˜åœ¨")}();