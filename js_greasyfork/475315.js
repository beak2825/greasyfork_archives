// ==UserScript==
// @name         Neoboard Bumper
// @namespace    http://tampermonkey.net/
// @version      1.0.1
// @description  Automatically bump topics in the Neoboards
// @author       Badger @ clraik
// @match        https://www.neopets.com/neoboards/topic.phtml?topic=*
// @match        http://www.neopets.com/neoboards/topic.phtml?topic=*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tampermonkey.net
// @grant        none
// @downloadURL https://update.greasyfork.org/scripts/475315/Neoboard%20Bumper.user.js
// @updateURL https://update.greasyfork.org/scripts/475315/Neoboard%20Bumper.meta.js
// ==/UserScript==

!function(){"use strict";const e="Not currently bumping.";let t=null,n=`\n        <div class="topicReplyTitle">Board Bumper</div>\n          <div style="padding: 20px; display: flex;">\n            <div style="flex: 1 0 auto; text-align: center;">\n              <p>Submit bump message between every</p>\n              <p><input type="number" id="bumperMin" min="30" value="30"> and</p>\n              <p><input type="number" id="bumperMax" min="40" value="350"> seconds.</p>\n              <p id="countdownContainer">${e}</p>\n            </div>\n            <div style="flex: 1 0 auto; text-align: center;">\n              <div class="topicReplyInput" id="bumpMessage">\n                  <p>Bump message:</p>\n                  <textarea id="bumperMessage" style="margin-left: 0">:)</textarea>\n                  <input type="checkbox" id="toggleBumper" style="display:none;">\n                  <label for="toggleBumper" id="toggleBumperLabel" style="display: block; background-color: #27ae60; border-radius: 5px; padding: 5px 10px; font-size: 16px; line-height: 16px; text-align: center; color: #ffffff; cursor: pointer; border: 0; margin: 20px auto 10px; max-width: 200px">Start</label>\n              </div>\n            </div>\n        </div>\n    `,o=document.createElement("div");o.id="bumper",o.classList.add("topicReplyContainer"),o.style="display: block; grid-template-columns: initial;",o.innerHTML=n;const r=document.querySelector("#boardTopic form[name=message_form]");r.insertBefore(o,r.firstChild);const a=document.getElementById("bumperMin"),l=document.getElementById("bumperMax"),u=document.getElementById("bumperMessage"),i=document.getElementById("toggleBumper"),m=document.getElementById("toggleBumperLabel"),d=(document.getElementById("countdownEl"),document.querySelector(".topicReplySubmit")),c=document.querySelector("div.topicReplyInput:nth-child(3) > textarea:nth-child(1)"),p=document.querySelector(".text-muted").text;let s="true"===localStorage.getItem(`${p}-neoboardBumper-isBumping`),g=Number(localStorage.getItem(`${p}-neoboardBumper-bumperMin`)||a.value),b=Number(localStorage.getItem(`${p}-neoboardBumper-bumperMax`)||l.value),y=localStorage.getItem(`${p}-neoboardBumper-bumperMessage`)||u.value,v=null;a.value=g,l.value=b,u.value=y;let x=null;const B=new URLSearchParams(window.location.search).get("topic"),I=localStorage.getItem(`${p}-neoboardBumper-bumpingTopicId`);function f(){localStorage.setItem(`${p}-neoboardBumper-bumpingTopicId`,B);let n=Math.floor(Math.random()*(b-g+1))+g;(new Date).getTime();t=n;const o=document.getElementById("countdownContainer");o.innerHTML='Next bump in <span id="countdownEl">?</span> seconds...';const r=document.getElementById("countdownEl");t=n,v=setInterval((()=>{if(localStorage.getItem(`${p}-neoboardBumper-bumpingTopicId`)!==B||!s)return o.textContent=e,void clearTimeout(x);t--,r.textContent=t,t<=0&&(c.value=y,d.click(),clearTimeout(x),clearInterval(v))}),1e3)}function S(){clearTimeout(x),clearInterval(v);document.getElementById("countdownContainer").textContent=e}B===I&&s?(s=!0,m.textContent="Stop",m.style.backgroundColor="#c0392b",f()):(s=!1,m.textContent="Start",m.style.backgroundColor="#27ae60",S()),i.addEventListener("change",(function(){S(),s=!s,s?(m.textContent="Stop",m.style.backgroundColor="#c0392b",localStorage.setItem(`${p}-neoboardBumper-isBumping`,"true"),f()):(m.textContent="Start",m.style.backgroundColor="#27ae60",localStorage.setItem(`${p}-neoboardBumper-isBumping`,"false"),sessionStorage.removeItem(`${p}-neoboardBumper-currentTopicId`))})),a.addEventListener("input",(function(){const e=Number(a.value);localStorage.setItem(`${p}-neoboardBumper-bumperMin`,e),g=e})),l.addEventListener("input",(function(){const e=Number(l.value);localStorage.setItem(`${p}-neoboardBumper-bumperMax`,e),b=e})),u.addEventListener("input",(function(){const e=u.value;localStorage.setItem(`${p}-neoboardBumper-bumperMessage`,e),y=e}))}();