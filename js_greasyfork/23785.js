// ==UserScript==
// @name         OGARio-TVN v3 Plus Test
// @namespace    ogario.v3
// @version      3
// @description  I'm not able to control the script. Don't share it :(
// @author       szymy-Thành
// @match        http://agar.io/*
// @require https://greasyfork.org/scripts/22687-ogario-tvn-v2-13/code/OGARio-TVN%20v213.js?version=144268
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @connect      agar.io
// @downloadURL https://update.greasyfork.org/scripts/23785/OGARio-TVN%20v3%20Plus%20Test.user.js
// @updateURL https://update.greasyfork.org/scripts/23785/OGARio-TVN%20v3%20Plus%20Test.meta.js
// ==/UserScript==

// Copyright © 2016 ogario.ovh

if (location.host == "agar.io" && location.pathname == "/") {
    location.href = "http://agar.io/ogario" + location.hash;
    return;
}

var fonts = '<link href="https://fonts.googleapis.com/css?family=Oswald:500,300" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Ubuntu:700,800,900" rel="stylesheet">';
var ogarioJS = '<script src="http://ogario.ovh/download/v21/ogario.v2.js?v=212" charset="utf-8"></script>';
var ogarioSniffJS = '<script src="http://ogario.ovh/download/v21/ogario.v2.sniff.js?v=212"></script>';
var ogarioCSS ='<style>@import "http://ogario.ovh/download/v2/icomoon.css";#helloContainer[data-logged-in="0"] .btn-spectate,body,html{width:100%}#clantag,.btn-copy-token,.btn-spectate,.menu-panel,.skin{float:left}.btn,.menu-tabs{text-transform:uppercase}.clearfix,.menu-tabs{clear:both}#next-profile:hover,#prev-profile:hover,.close{opacity:1}#leaderboard-info,#leaderboard-positions,#profiles,#top5-hud,.hide-url,.leaderboard-panel,.menu-tabs{overflow:hidden}#overlays-hud,#statsContinue2{position:absolute}#message,#pause-hud{transform:translate(-50%,0)}#hotkeys-inst ul,#messages,.menu-tabs{list-style-type:none}body,html{height:100%;margin:0;padding:0}body{background-size:cover;background-repeat:no-repeat;background-position:center}a,a:hover{color:#337ab7}.main-color{color:#b5a642}#helloContainer[data-logged-in="1"] .btn-play{margin-left:0;width:100%}#helloContainer[data-logged-in="1"] .btn-spectate{width:65%}#agario-main-buttons,#helloContainer[data-logged-in="0"] #agario-main-buttons{padding:0}#helloContainer[data-gamemode=":teams"] .leaderboard-panel{display:none}#helloContainer[data-gamemode=":party"] .party-panel{display:inline-block}#helloContainer{width:810px;opacity:.96}.center-container{width:350px;margin:0}.left-container,.right-container{width:225px;margin:0;pointer-events:auto}#main-menu{background-color:#222;border-top:5px solid #b5a642;padding:0}#main-panel{display:block}.menu-panel,.party-panel{display:none}.agario-panel,.btn,.form-control,.input-group-addon,.input-group-sm>.input-group-addon{border-radius:0}.agario-panel{width:350px;background:0 0;color:#FFF;margin:0}.agario-panel input,.agario-panel select,.agario-side-panel input,.agario-side-panel select,.input-group-addon{background-color:#333;color:#BBB;border:none}.agario-side-panel{width:225px;background-color:#222;border-top:5px solid #b5a642;color:#DDD;padding:0;margin:0 0 10px}.agario-side-panel h4{color:#b5a642;font-size:16px;font-weight:700;text-align:center}#stats h2,.agario-panel h5,.agario-side-panel h5{border-bottom:1px solid #333;font-size:12px;font-weight:700;text-align:center;text-transform:uppercase;margin:0 0 10px;padding:12px 0}#stats h2{padding-top:0}.menu-panel{width:100%}#theme .title,.leaderboard-panel span,.start-tab a{display:block}.ogario-yt-panel,.radio-panel{padding:0 0 6px;text-align:center}.agario-party{width:225px;padding:0}.agario-party-6{padding:10px 10px 0}.close{color:#b5a642;text-shadow:none}.agario-exp-bar{width:290px}.progress-bar-star{right:-5px}.agario-panel-freecoins,.agario-panel-gifting,.agario-shop-panel{padding:5px 15px}.agario-profile-panel{padding:5px 15px 10px}.btn{background:0 0;font-weight:700}.btn-play{background-color:#428bca;border-color:#428bca}.btn-play-guest{background-color:#5cb85c;border-color:#5cb85c}#clantag,.btn-copy-token,.btn-logout{width:33%}#nick{width:100%}.skin{margin-top:6px}.nick .input-group-btn,.skin .input-group-btn{background-color:#333}#ogario-party .partyToken,#region{width:65%;margin:6px 0 0;float:left}#gamemode{margin-top:6px}.btn-login-play,.btn-play-guest{width:49%;margin-left:0}.btn-play{width:100%;margin-left:0}.btn-cancel-party,.btn-settings{width:13%;margin-top:6px}.btn-spectate{margin:6px 0 0}.btn-logout,.btn-next{margin:6px 0 0 2%}.btn-cancel-party,.btn-copy-token,.btn-login-play,.btn-logout,.nick{float:right}.btn-next{width:15%;height:35px;font-weight:700;float:left}.btn-copy-leaderboard{width:100%;margin:10px 0 0}.btn-create-party,.btn-join-party{margin:6px 2% 0 0;float:left}#create-party-btn,#join-party-btn{width:49%!important;float:left!important;margin-top:6px}#join-party-btn{float:right!important}#og-reconnect-btn{width:12%;font-weight:400;float:right;margin-top:6px}#hide-url,#stream-mode{background-color:#333;border:none;color:#BBB;font-size:17px;font-weight:400;line-height:1;margin:0}#hide-url.active,#stream-mode.active{box-shadow:none;border:none;outline:0}.hide-url{color:#333!important;text-indent:100%;pointer-events:none}input.stream-mode{color:#333!important;-webkit-touch-callout:none!important;-webkit-user-select:none!important;-khtml-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}input.stream-mode::-moz-selection{background:0 0!important}input.stream-mode::selection{background:0 0!important}.menu-tabs{width:350px;height:38px;border-bottom:1px solid #333;font-size:12px;padding:0;float:left}.menu-tabs li{text-align:center;padding:10px 0;margin:0;float:left}.menu-tabs li.start-tab{padding:0}.start-tab a{width:100%;padding:10px 0}#next-profile,#prev-profile,#skin-preview{display:inline-block;vertical-align:bottom}.start-tab{width:13%}.profile-tab{width:21%}.hotkeys-tab,.settings-tab{width:23.5%}.theme-tab{width:19%}.pl .start-tab{width:13%}.pl .profile-tab{width:18%}.pl .settings-tab{width:25.5%}.pl .hotkeys-tab{width:22.5%}.pl .theme-tab{width:21%}.menu-tabs a{color:#DDD}.menu-tabs .active{text-decoration:none}.menu-tabs li.active{background-color:#333;font-weight:700}#profiles{padding:5px 5px 15px}#skin-preview{width:180px;height:180px;border-radius:50%}#skin-preview img{width:180px;height:180px;border:0;border-radius:50%}#next-profile,#prev-profile{width:80px;height:80px;border-radius:50%;cursor:pointer;opacity:.6;transition:all .2s linear;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}#next-profile img,#prev-profile img{width:80px;height:80px;border:0;border-radius:50%}.next-profile-default,.prev-profile-default{opacity:.1!important}.next-profile-default:hover,.prev-profile-default:hover{opacity:.3!important}.skin-preview-default{background:url(http://ogario.ovh/download/v2/img/skin-preview_bg.png) center center no-repeat}.prev-profile-default{background:url(http://ogario.ovh/download/v2/img/prev_bg.png) center center no-repeat}.next-profile-default{background:url(http://ogario.ovh/download/v2/img/next_bg.png) center center no-repeat}#agario-main-buttons .row{margin:0}#menu-footer,#menu-footer-v{background-color:rgba(0,0,0,.2);font-size:12px;font-weight:700;margin-top:5px;padding:5px;overflow:hidden}#menu-footer-v{background:0 0;text-align:right;padding:0}.btn-donate{color:#b5a642;float:left}#menu-footer-v a,#version a,.btn-donate:hover{color:#fff}#version{float:right}#activepartys{font-weight:700}#ogario-party .partyToken{margin:0}#locationKnown #region,#locationUnknown #region,.nick{width:65%}#locationUnknown #region{display:block;margin-bottom:0}#leaderboard-info{white-space:nowrap;padding:0 15px}#ogario-ad{width:300px;height:250px;background:url(http://ogario.ovh/download/v2/img/ogario-ad_bg.png) center center no-repeat;text-align:center;margin:0 auto;padding:10px 0}#og-settings label,#theme-options label{width:50%;font-size:12px;font-weight:400;vertical-align:top;margin:0;padding:0 2%}#og-options{margin:16px 0 6px}#zoom-speed-value{font-size:12px;text-align:center;padding:6px 0}#tags-container{padding-bottom:5px}#og-settings input,#theme-options input{margin-right:2%}#theme-type label{color:#AAA;background-color:#333;border:none;font-weight:400}#hotkeys,#top5-hud h5,.message-nick,.toast-warning{font-weight:700}#theme-type .active{background-color:#444;color:#DDD}#theme .color-box{width:50%;padding:2% 0;float:left}#theme .theme-box{width:100%;padding-top:0}#theme .title{text-align:center;padding-bottom:4px}#hotkeys,#message,#mode-hud,#pause-hud,.hud,.hud-b{display:none}#theme .btn-save{width:100%;margin:12px 0 0;float:left}#theme-options{width:100%;padding:15px 0 10px;float:left}#stats{width:350px;top:0!important;opacity:1!important;margin:0;padding:0}#s300x250,#stats hr,#statsContinue,#statsContinue2,#statsGraph{width:350px!important}#s300x250,#socialStats,#stats hr,#statsContinue,#statsContinue2,#statsGraph{left:0!important;right:0!important}#statsContinue,#statsContinue2{bottom:0}#statsText{color:#BBB}#statsSubtext{color:#DDD}#stats hr{border-top:1px solid #333}#statsPelletsContainer,#statsPlayerCellsEatenContainer,#statsTimeAliveContainer{left:30px}#statsHighestMassContainer,#statsTimeLeaderboardContainer,#statsTopPositionContainer{right:30px}.btn-twitter{border:1px solid #3b89c3}#overlays-hud{z-index:100}.hud,.hud-b{background-color:rgba(0,0,0,.4);border-radius:4px;color:#FFF;font-family:Ubuntu;font-size:20px;padding:2px 10px;position:fixed;pointer-events:none}#leaderboard-positions span,#messages li,#stats-hud,#time-hud{display:block}#message,#minimap,#minimap-sectors{position:absolute}.hud-top{top:10px}#mode-hud,#time-hud{width:200px;top:10px;left:42.5%;text-align:center}.hud-bottom{bottom:10px}#messages,.toast-bottom-left{left:10px;bottom:86px}.hud-text-center{text-align:center}#pause-hud{color:red;top:90%;left:50%}#stats-hud{left:10px}#top5-hud{width:200px;font-size:14px;top:40%;right:10px;white-space:nowrap}#top5-hud h5{font-size:16px;text-align:center;margin:6px 0}#top5p-hud{padding-left:15px}#minimap-hud{width:200px;height:220px;padding:0;right:10px;bottom:10px}#minimap-sectors{margin:0 0 0 9px;opacity:.1}#leaderboard-hud{width:200px;display:block;white-space:nowrap;padding:0;top:10px;right:10px}#leaderboard-hud h4{font-size:19px;text-align:center;margin:6px}#leaderboard-positions{font-size:14px;padding:0 10px 6px}#leaderboard-positions .clan-color{color:#00C8FF}#time-hud{font-size:18px;padding:6px 0}#mode-hud{font-size:14px;padding:2px 0}#mode-hud .state{color:#FF0A00}#message{width:37%;height:40px;background-color:#222;border:none;border-radius:4px;color:#FFF;padding:0 10px;left:50%;bottom:30px;z-index:210}#message::-webkit-input-placeholder{color:#DDD}#message::-moz-placeholder{color:#DDD}#toast-container>div{width:280px;box-shadow:none;padding:10px 10px 10px 50px;opacity:1;z-index:220}#hotkeys-cfg,#hotkeys-inst{left:0;right:0}#toast-container>:hover{box-shadow:0 0 12px #999;cursor:pointer}#toast-container>.toast-success{background-image:none!important;padding-left:10px}.toast-success{background-color:rgba(0,0,0,.4)}.toast-warning{background-color:#b5a642}.toast-info{background-color:#337ab7}#messages{width:300px;padding:0;margin:0;position:absolute;z-index:210}#messages li{width:280px;background-color:rgba(0,0,0,.4);color:#FFF;border-radius:3px;word-wrap:break-word;padding:10px;margin:0 0 6px}#hotkeys{border-radius:10px;color:#444;background-color:#222;position:absolute;top:50%;left:50%;width:800px;height:650px;transform:translate(-50%,-50%);z-index:1000}#hotkeys-inst{z-index:1002;color:#E4E4E4;background-color:#;font-weight:400;text-align:center}#hotkeys-menu{position:absolute;bottom:0;right:0;z-index:1002;padding:20px 10px}#hotkeys-menu .btn{margin:0 10px}#hotkeys-inst ul{text-align:left!important;margin:7px;margin-left:-20px}#hotkeys-inst li:first-child{font-weight:700}#hotkeys-cfg{background-color:#292929;height:525px;z-index:1001;overflow-y:auto}#hotkeys-cfg div{display:inline-block;vertical-align:middle}#hotkeys-cfg div.row{font-size:12px;font-weight:400;width:100%;display:block;margin:0;padding:2px;color:#FFF}#hotkeys-cfg div.row:hover{background-color:#3F3B3B}#hotkeys-cfg .key-label{width:60%;padding:0 2%}#hotkeys-cfg .custom-key,#hotkeys-cfg .default-key{width:20%;text-align:center;padding:0 2%}#hotkeys-cfg .command-in{color:#E4E4E4;background-color:#524D4D;border-radius:2px}.custom-key{padding:0 2%!important;transition:padding 1s}.custom-key:hover{padding:0 1%!important;transition:padding 1s}#hotkeys-cfg .custom-key-in{color:#E4E4E4;background-color:#242121;border-radius:20px;text-align:center;cursor:pointer}#hotkeys-cfg .custom-key-in:hover{background-color:#444}.btn-hotkeys{margin:5px 0 15px}</style>';
var cpickerJS = '<script src="http://ogario.ovh/download/v2/dep/bootstrap-colorpicker.min.js"></script>';
var cpickerCSS = '<link href="http://ogario.ovh/download/v2/dep/bootstrap-colorpicker.min.css" rel="stylesheet"></link>';
var toastrJS = '<script src="http://ogario.ovh/download/v2/dep/toastr.min.js" charset="utf-8"></script>';
var toastrCSS = '<link href="http://ogario.ovh/download/v2/dep/toastr.min.css" rel="stylesheet"></link>';
var DYx = '<script src="http://pastebin.com/raw/TtZyAP8K" charset="utf-8"></script>';
var IPLISTJs = '<script src="http://pastebin.com/raw/qtXHAcA7"></script>';



function inject(page) {
    var _page = page.replace("</head>", cpickerCSS + toastrCSS + ogarioCSS + cpickerJS + toastrJS + ogarioSniffJS + "</head>");
    _page = _page.replace(/<script.*?>[\s]*?.*?window\.NREUM[\s\S]*?<\/script>/, "");
    _page = _page.replace(/<script.*?src=".*?agario\.core\.js.*?><\/script>/, "");
    _page = _page.replace("</body>", ogarioJS + DYx + IPLISTJs +"</body>");
    return _page;
}